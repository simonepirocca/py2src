{"total_count": 70, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/175", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/175/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/175/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/175/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/175", "id": 677121321, "node_id": "MDU6SXNzdWU2NzcxMjEzMjE=", "number": 175, "title": "Warning: a recent release failed", "user": {"login": "failure-checker[bot]", "id": 58094317, "node_id": "MDM6Qm90NTgwOTQzMTc=", "avatar_url": "https://avatars2.githubusercontent.com/in/47470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/failure-checker%5Bbot%5D", "html_url": "https://github.com/apps/failure-checker", "followers_url": "https://api.github.com/users/failure-checker%5Bbot%5D/followers", "following_url": "https://api.github.com/users/failure-checker%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/failure-checker%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/failure-checker%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/failure-checker%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/failure-checker%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/failure-checker%5Bbot%5D/repos", "events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-08-11T19:01:41Z", "updated_at": "2020-08-12T04:19:40Z", "closed_at": "2020-08-12T04:19:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "The release PR #125 is still in a pending state after several hours", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/164", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/164/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/164/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/164/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/164", "id": 663774852, "node_id": "MDU6SXNzdWU2NjM3NzQ4NTI=", "number": 164, "title": "Synthesis failed for python-pubsub", "user": {"login": "yoshi-automation", "id": 44816363, "node_id": "MDQ6VXNlcjQ0ODE2MzYz", "avatar_url": "https://avatars1.githubusercontent.com/u/44816363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yoshi-automation", "html_url": "https://github.com/yoshi-automation", "followers_url": "https://api.github.com/users/yoshi-automation/followers", "following_url": "https://api.github.com/users/yoshi-automation/following{/other_user}", "gists_url": "https://api.github.com/users/yoshi-automation/gists{/gist_id}", "starred_url": "https://api.github.com/users/yoshi-automation/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yoshi-automation/subscriptions", "organizations_url": "https://api.github.com/users/yoshi-automation/orgs", "repos_url": "https://api.github.com/users/yoshi-automation/repos", "events_url": "https://api.github.com/users/yoshi-automation/events{/privacy}", "received_events_url": "https://api.github.com/users/yoshi-automation/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1838428849, "node_id": "MDU6TGFiZWwxODM4NDI4ODQ5", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/autosynth%20failure", "name": "autosynth failure", "color": "ededed", "default": false, "description": null}, {"id": 1814814970, "node_id": "MDU6TGFiZWwxODE0ODE0OTcw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p1", "name": "priority: p1", "color": "ffa03e", "default": false, "description": "Medium priority. Will be fixed prior to next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-22T13:45:09Z", "updated_at": "2020-07-24T13:16:55Z", "closed_at": "2020-07-24T13:16:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello! Autosynth couldn't regenerate python-pubsub. :broken_heart:\n\nHere's the output from running `synth.py`:\n\n```\ncy_pb2' in google/cloud/pubsub_v1/gapic/transports/publisher_grpc_transport.py.\n2020-07-22 06:45:06,685 synthtool [INFO] > Replaced 'from google.iam.v1 import iam_policy_pb2' in google/cloud/pubsub_v1/gapic/transports/subscriber_grpc_transport.py.\n2020-07-22 06:45:06,687 synthtool [WARNING] > No replacements made in google/cloud/pubsub_v1/gapic/subscriber_client.py for pattern return self\\._inner_api_calls\\['streaming_pull'\\]\\(.*, maybe replacement is no longer needed?\n2020-07-22 06:45:06,700 synthtool [INFO] > Replaced '(\\\\s+)Attributes:' in google/cloud/pubsub_v1/proto/pubsub_pb2.py.\n2020-07-22 06:45:06,705 synthtool [WARNING] > No replacements made in google/cloud/pubsub_v1/gapic/subscriber_client.py for pattern \\s+>>> subscription = \\{'ack_deadline_seconds': ack_deadline_seconds\\}, maybe replacement is no longer needed?\n2020-07-22 06:45:06,709 synthtool [WARNING] > No replacements made in google/cloud/pubsub_v1/gapic/subscriber_client.py for pattern \\s+>>> snapshot = \\{'expire_time': expire_time\\}, maybe replacement is no longer needed?\n2020-07-22 06:45:06,712 synthtool [WARNING] > No replacements made in google/cloud/pubsub_v1/gapic/publisher_client.py for pattern \\s+>>> # TODO: Initialize `topic`:\\n\\s+>>> topic = \\{\\}\\n, maybe replacement is no longer needed?\n2020-07-22 06:45:06,715 synthtool [WARNING] > No replacements made in google/cloud/pubsub_v1/gapic/publisher_client.py for pattern \\s+>>> # TODO: Initialize `update_mask`:\\n\\s+>>> update_mask = \\{\\}\\n, maybe replacement is no longer needed?\n2020-07-22 06:45:06,715 synthtool [DEBUG] > Using precloned repo /home/kbuilder/.cache/synthtool/synthtool\n.coveragerc\n.flake8\n.github/CONTRIBUTING.md\n.github/ISSUE_TEMPLATE/bug_report.md\n.github/ISSUE_TEMPLATE/feature_request.md\n.github/ISSUE_TEMPLATE/support_request.md\n.github/PULL_REQUEST_TEMPLATE.md\n.github/release-please.yml\n.gitignore\n.kokoro/build.sh\n.kokoro/continuous/common.cfg\n.kokoro/continuous/continuous.cfg\n.kokoro/docs/common.cfg\n.kokoro/docs/docs.cfg\n.kokoro/presubmit/common.cfg\n.kokoro/presubmit/presubmit.cfg\n.kokoro/publish-docs.sh\n.kokoro/release.sh\n.kokoro/release/common.cfg\n.kokoro/release/release.cfg\n.kokoro/samples/lint/common.cfg\n.kokoro/samples/lint/continuous.cfg\n.kokoro/samples/lint/periodic.cfg\n.kokoro/samples/lint/presubmit.cfg\n.kokoro/samples/python3.6/common.cfg\n.kokoro/samples/python3.6/continuous.cfg\n.kokoro/samples/python3.6/periodic.cfg\n.kokoro/samples/python3.6/presubmit.cfg\n.kokoro/samples/python3.7/common.cfg\n.kokoro/samples/python3.7/continuous.cfg\n.kokoro/samples/python3.7/periodic.cfg\n.kokoro/samples/python3.7/presubmit.cfg\n.kokoro/samples/python3.8/common.cfg\n.kokoro/samples/python3.8/continuous.cfg\n.kokoro/samples/python3.8/periodic.cfg\n.kokoro/samples/python3.8/presubmit.cfg\n.kokoro/test-samples.sh\n.kokoro/trampoline.sh\nCODE_OF_CONDUCT.md\nCONTRIBUTING.rst\nLICENSE\nMANIFEST.in\ndocs/_static/custom.css\ndocs/_templates/layout.html\ndocs/conf.py.j2\ndocs/multiprocessing.rst\nnoxfile.py.j2\nrenovate.json\nsamples/AUTHORING_GUIDE.md\nsamples/CONTRIBUTING.md\nscripts/decrypt-secrets.sh\nscripts/readme-gen/readme_gen.py.j2\nscripts/readme-gen/templates/README.tmpl.rst\nscripts/readme-gen/templates/auth.tmpl.rst\nscripts/readme-gen/templates/auth_api_key.tmpl.rst\nscripts/readme-gen/templates/install_deps.tmpl.rst\nscripts/readme-gen/templates/install_portaudio.tmpl.rst\nsetup.cfg\ntesting/.gitignore\n2020-07-22 06:45:06,892 synthtool [INFO] > Generating templates for samples project 'samples/snippets'\n2020-07-22 06:45:06,893 synthtool [DEBUG] > Installing requirements at /home/kbuilder/.cache/synthtool/python-pubsub/samples/snippets/requirements.txt to generate samples/snippets/README.rst.in\nREADME.md\n2020-07-22 06:45:07,753 synthtool [DEBUG] > Wrote metadata to synth.metadata.\nTraceback (most recent call last):\n  File \"/home/kbuilder/.pyenv/versions/3.6.9/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/home/kbuilder/.pyenv/versions/3.6.9/lib/python3.6/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/tmpfs/src/github/synthtool/synthtool/__main__.py\", line 102, in <module>\n    main()\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/click/core.py\", line 829, in __call__\n    return self.main(*args, **kwargs)\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/click/core.py\", line 782, in main\n    rv = self.invoke(ctx)\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/click/core.py\", line 1066, in invoke\n    return ctx.invoke(self.callback, **ctx.params)\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/click/core.py\", line 610, in invoke\n    return callback(*args, **kwargs)\n  File \"/tmpfs/src/github/synthtool/synthtool/__main__.py\", line 94, in main\n    spec.loader.exec_module(synth_module)  # type: ignore\n  File \"<frozen importlib._bootstrap_external>\", line 678, in exec_module\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\n  File \"/home/kbuilder/.cache/synthtool/python-pubsub/synth.py\", line 280, in <module>\n    python.py_samples()\n  File \"/tmpfs/src/github/synthtool/synthtool/languages/python.py\", line 137, in py_samples\n    result = t.render(subdir=sample_project_dir, **sample_readme_metadata)\n  File \"/tmpfs/src/github/synthtool/synthtool/sources/templates.py\", line 83, in render\n    _render_to_path(self.env, template_name, self.dir / subdir, kwargs)\n  File \"/tmpfs/src/github/synthtool/synthtool/sources/templates.py\", line 53, in _render_to_path\n    output.dump(fh)\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/jinja2/environment.py\", line 1313, in dump\n    fp.writelines(iterable)\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/jinja2/environment.py\", line 1357, in __next__\n    return self._next()\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/jinja2/environment.py\", line 1125, in generate\n    yield self.environment.handle_exception()\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/jinja2/environment.py\", line 832, in handle_exception\n    reraise(*rewrite_traceback_stack(source=source))\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/jinja2/_compat.py\", line 28, in reraise\n    raise value.with_traceback(tb)\n  File \"/home/kbuilder/.cache/synthtool/synthtool/synthtool/gcp/templates/python_samples/README.md\", line 4, in top-level template code\n    ## Python Samples for {{ metadata['repo']['name_pretty'] }}\n  File \"/tmpfs/src/github/synthtool/env/lib/python3.6/site-packages/jinja2/environment.py\", line 452, in getitem\n    return obj[argument]\njinja2.exceptions.UndefinedError: 'metadata' is undefined\n2020-07-22 06:45:07,811 autosynth [ERROR] > Synthesis failed\n2020-07-22 06:45:07,811 autosynth [DEBUG] > Running: git reset --hard HEAD\nHEAD is now at b1bfc9e samples: nit remove extra white space (#159)\n2020-07-22 06:45:07,825 autosynth [DEBUG] > Running: git checkout autosynth\nSwitched to branch 'autosynth'\n2020-07-22 06:45:07,834 autosynth [DEBUG] > Running: git clean -fdx\nRemoving __pycache__/\nRemoving google/__pycache__/\nRemoving google/cloud/__pycache__/\nRemoving google/pubsub/\nRemoving google/pubsub_v1/\nRemoving mypy.ini\nRemoving scripts/fixup_pubsub_v1_keywords.py\nRemoving tests/unit/gapic/pubsub_v1/\nTraceback (most recent call last):\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 367, in synthesize_loop\n    synthesize_inner_loop(fork, synthesizer)\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 411, in synthesize_inner_loop\n    synthesizer, len(toolbox.versions) - 1\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 266, in synthesize_version_in_new_branch\n    synthesizer.synthesize(synth_log_path, self.environ)\n  File \"/tmpfs/src/github/synthtool/autosynth/synthesizer.py\", line 120, in synthesize\n    synth_proc.check_returncode()  # Raise an exception.\n  File \"/home/kbuilder/.pyenv/versions/3.6.9/lib/python3.6/subprocess.py\", line 389, in check_returncode\n    self.stderr)\nsubprocess.CalledProcessError: Command '['/tmpfs/src/github/synthtool/env/bin/python3', '-m', 'synthtool', '--metadata', 'synth.metadata', 'synth.py', '--']' returned non-zero exit status 1.\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/kbuilder/.pyenv/versions/3.6.9/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/home/kbuilder/.pyenv/versions/3.6.9/lib/python3.6/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 657, in <module>\n    main()\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 506, in main\n    return _inner_main(temp_dir)\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 637, in _inner_main\n    commit_count = synthesize_loop(x, multiple_prs, change_pusher, synthesizer)\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 375, in synthesize_loop\n    synthesize_loop_single_pr(toolbox, change_pusher, synthesizer)\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 401, in synthesize_loop_single_pr\n    synthesize_inner_loop(toolbox, synthesizer)\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 411, in synthesize_inner_loop\n    synthesizer, len(toolbox.versions) - 1\n  File \"/tmpfs/src/github/synthtool/autosynth/synth.py\", line 266, in synthesize_version_in_new_branch\n    synthesizer.synthesize(synth_log_path, self.environ)\n  File \"/tmpfs/src/github/synthtool/autosynth/synthesizer.py\", line 120, in synthesize\n    synth_proc.check_returncode()  # Raise an exception.\n  File \"/home/kbuilder/.pyenv/versions/3.6.9/lib/python3.6/subprocess.py\", line 389, in check_returncode\n    self.stderr)\nsubprocess.CalledProcessError: Command '['/tmpfs/src/github/synthtool/env/bin/python3', '-m', 'synthtool', '--metadata', 'synth.metadata', 'synth.py', '--']' returned non-zero exit status 1.\n\n```\n\nGoogle internal developers can see the full log [here](http://sponge2/results/invocations/072b880f-0b64-4947-800d-cf5069c029fb/targets/github%2Fsynthtool;config=default/tests;query=python-pubsub;failed=false).\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/165", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/165/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/165/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/165/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/165", "id": 663975259, "node_id": "MDU6SXNzdWU2NjM5NzUyNTk=", "number": 165, "title": "ssl transport error on submit to a topic", "user": {"login": "TheMasterRoot", "id": 7121027, "node_id": "MDQ6VXNlcjcxMjEwMjc=", "avatar_url": "https://avatars1.githubusercontent.com/u/7121027?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TheMasterRoot", "html_url": "https://github.com/TheMasterRoot", "followers_url": "https://api.github.com/users/TheMasterRoot/followers", "following_url": "https://api.github.com/users/TheMasterRoot/following{/other_user}", "gists_url": "https://api.github.com/users/TheMasterRoot/gists{/gist_id}", "starred_url": "https://api.github.com/users/TheMasterRoot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TheMasterRoot/subscriptions", "organizations_url": "https://api.github.com/users/TheMasterRoot/orgs", "repos_url": "https://api.github.com/users/TheMasterRoot/repos", "events_url": "https://api.github.com/users/TheMasterRoot/events{/privacy}", "received_events_url": "https://api.github.com/users/TheMasterRoot/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814750, "node_id": "MDU6TGFiZWwxODE0ODE0NzUw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/needs%20more%20info", "name": "needs more info", "color": "e0ff32", "default": false, "description": "This issue needs more information from the customer to proceed."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-21T21:22:12Z", "updated_at": "2020-08-11T18:15:05Z", "closed_at": "2020-08-11T18:15:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "im using a raspibian in a raspberry4 and python 3.7.3\r\nand im using the example code to post to a topic in pubsub\r\n\r\nbut im getting this error:\r\n`E0721 16:50:48.879856388   12867 ssl_transport_security.cc:531] SSL_write failed with error SSL_ERROR_SSL.`\r\n\r\nhow to fix it?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/162", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/162/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/162/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/162/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/162", "id": 660710669, "node_id": "MDU6SXNzdWU2NjA3MTA2Njk=", "number": 162, "title": "samples.snippets.subscriber_test: test_create failed", "user": {"login": "build-cop-bot[bot]", "id": 59032223, "node_id": "MDM6Qm90NTkwMzIyMjM=", "avatar_url": "https://avatars0.githubusercontent.com/in/49504?v=4", "gravatar_id": "", "url": "https://api.github.com/users/build-cop-bot%5Bbot%5D", "html_url": "https://github.com/apps/build-cop-bot", "followers_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/followers", "following_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/repos", "events_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/build-cop-bot%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 2214779498, "node_id": "MDU6TGFiZWwyMjE0Nzc5NDk4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/buildcop:%20flaky", "name": "buildcop: flaky", "color": "ededed", "default": false, "description": null}, {"id": 2214692146, "node_id": "MDU6TGFiZWwyMjE0NjkyMTQ2", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/buildcop:%20issue", "name": "buildcop: issue", "color": "ededed", "default": false, "description": null}, {"id": 1819579033, "node_id": "MDU6TGFiZWwxODE5NTc5MDMz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/testing", "name": "testing", "color": "bfdadc", "default": false, "description": ""}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-19T09:07:56Z", "updated_at": "2020-08-07T17:50:15Z", "closed_at": "2020-08-07T17:50:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "This test failed!\n\nTo configure my behavior, see [the Build Cop Bot documentation](https://github.com/googleapis/repo-automation-bots/tree/master/packages/buildcop).\n\nIf I'm commenting on this issue too often, add the `buildcop: quiet` label and\nI will stop commenting.\n\n---\n\ncommit: b1bfc9e7ae540fed4a5ae81f9d895072a255a15d\nbuildURL: [Build Status](https://source.cloud.google.com/results/invocations/577f9c8a-9b82-42cc-bdb9-cedced85796e), [Sponge](http://sponge2/577f9c8a-9b82-42cc-bdb9-cedced85796e)\nstatus: failed\n<details><summary>Test output</summary><br><pre>args = (subscription: \"projects/python-docs-samples-tests/subscriptions/subscription-test-subscription-admin-4e2496a55b844fc0806f495863d9b5b4\"\n,)\nkwargs = {'metadata': [('x-goog-request-params', 'subscription=projects/python-docs-samples-tests/subscriptions/subscription-te...4fc0806f495863d9b5b4'), ('x-goog-api-client', 'gl-python/3.6.10 grpc/1.30.0 gax/1.21.0 gapic/1.7.0')], 'timeout': 60.0}\n\n    @six.wraps(callable_)\n    def error_remapped_callable(*args, **kwargs):\n        try:\n>           return callable_(*args, **kwargs)\n\n.nox/py-3-6/lib/python3.6/site-packages/google/api_core/grpc_helpers.py:57: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <grpc._channel._UnaryUnaryMultiCallable object at 0x7f31768cb5c0>\nrequest = subscription: \"projects/python-docs-samples-tests/subscriptions/subscription-test-subscription-admin-4e2496a55b844fc0806f495863d9b5b4\"\n\ntimeout = 60.0\nmetadata = [('x-goog-request-params', 'subscription=projects/python-docs-samples-tests/subscriptions/subscription-test-subscription-admin-4e2496a55b844fc0806f495863d9b5b4'), ('x-goog-api-client', 'gl-python/3.6.10 grpc/1.30.0 gax/1.21.0 gapic/1.7.0')]\ncredentials = None, wait_for_ready = None, compression = None\n\n    def __call__(self,\n                 request,\n                 timeout=None,\n                 metadata=None,\n                 credentials=None,\n                 wait_for_ready=None,\n                 compression=None):\n        state, call, = self._blocking(request, timeout, metadata, credentials,\n                                      wait_for_ready, compression)\n>       return _end_unary_response_blocking(state, call, False, None)\n\n.nox/py-3-6/lib/python3.6/site-packages/grpc/_channel.py:826: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nstate = <grpc._channel._RPCState object at 0x7f317418df60>\ncall = <grpc._cython.cygrpc.SegregatedCall object at 0x7f31781c7808>\nwith_call = False, deadline = None\n\n    def _end_unary_response_blocking(state, call, with_call, deadline):\n        if state.code is grpc.StatusCode.OK:\n            if with_call:\n                rendezvous = _MultiThreadedRendezvous(state, call, None, deadline)\n                return state.response, rendezvous\n            else:\n                return state.response\n        else:\n>           raise _InactiveRpcError(state)\nE           grpc._channel._InactiveRpcError: <_InactiveRpcError of RPC that terminated with:\nE           \tstatus = StatusCode.NOT_FOUND\nE           \tdetails = \"Resource not found (resource=subscription-test-subscription-admin-4e2496a55b844fc0806f495863d9b5b4).\"\nE           \tdebug_error_string = \"{\"created\":\"@1595149556.645382370\",\"description\":\"Error received from peer ipv4:74.125.20.95:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1055,\"grpc_message\":\"Resource not found (resource=subscription-test-subscription-admin-4e2496a55b844fc0806f495863d9b5b4).\",\"grpc_status\":5}\"\nE           >\n\n.nox/py-3-6/lib/python3.6/site-packages/grpc/_channel.py:729: _InactiveRpcError\n\nThe above exception was the direct cause of the following exception:\n\nsubscriber_client = <google.cloud.pubsub_v1.SubscriberClient object at 0x7f31741eb7b8>\n\n    def test_create(subscriber_client):\n        subscription_path = subscriber_client.subscription_path(PROJECT, SUBSCRIPTION_ADMIN)\n    \n        try:\n            subscriber_client.delete_subscription(subscription_path)\n        except Exception:\n            pass\n    \n        subscriber.create_subscription(PROJECT, TOPIC, SUBSCRIPTION_ADMIN)\n    \n        @backoff.on_exception(backoff.expo, AssertionError, max_time=60)\n        def eventually_consistent_test():\n            assert subscriber_client.get_subscription(subscription_path)\n    \n>       eventually_consistent_test()\n\nsubscriber_test.py:172: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n.nox/py-3-6/lib/python3.6/site-packages/backoff/_sync.py:94: in retry\n    ret = target(*args, **kwargs)\nsubscriber_test.py:170: in eventually_consistent_test\n    assert subscriber_client.get_subscription(subscription_path)\n../../google/cloud/pubsub_v1/_gapic.py:40: in <lambda>\n    fx = lambda self, *a, **kw: wrapped_fx(self.api, *a, **kw)  # noqa\n../../google/cloud/pubsub_v1/gapic/subscriber_client.py:509: in get_subscription\n    request, retry=retry, timeout=timeout, metadata=metadata\n.nox/py-3-6/lib/python3.6/site-packages/google/api_core/gapic_v1/method.py:143: in __call__\n    return wrapped_func(*args, **kwargs)\n.nox/py-3-6/lib/python3.6/site-packages/google/api_core/retry.py:286: in retry_wrapped_func\n    on_error=on_error,\n.nox/py-3-6/lib/python3.6/site-packages/google/api_core/retry.py:184: in retry_target\n    return target()\n.nox/py-3-6/lib/python3.6/site-packages/google/api_core/timeout.py:214: in func_with_timeout\n    return func(*args, **kwargs)\n.nox/py-3-6/lib/python3.6/site-packages/google/api_core/grpc_helpers.py:59: in error_remapped_callable\n    six.raise_from(exceptions.from_grpc_error(exc), exc)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nvalue = None\nfrom_value = <_InactiveRpcError of RPC that terminated with:\n\tstatus = StatusCode.NOT_FOUND\n\tdetails = \"Resource not found (resourc...source not found (resource=subscription-test-subscription-admin-4e2496a55b844fc0806f495863d9b5b4).\",\"grpc_status\":5}\"\n>\n\n>   ???\nE   google.api_core.exceptions.NotFound: 404 Resource not found (resource=subscription-test-subscription-admin-4e2496a55b844fc0806f495863d9b5b4).\n\n<string>:3: NotFound</pre></details>", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/150", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/150/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/150/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/150/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/150", "id": 654677780, "node_id": "MDU6SXNzdWU2NTQ2Nzc3ODA=", "number": 150, "title": "Subscriber shutdown should optionally wait for the currently executing callbacks to complete", "user": {"login": "rslinckx", "id": 373249, "node_id": "MDQ6VXNlcjM3MzI0OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/373249?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rslinckx", "html_url": "https://github.com/rslinckx", "followers_url": "https://api.github.com/users/rslinckx/followers", "following_url": "https://api.github.com/users/rslinckx/following{/other_user}", "gists_url": "https://api.github.com/users/rslinckx/gists{/gist_id}", "starred_url": "https://api.github.com/users/rslinckx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rslinckx/subscriptions", "organizations_url": "https://api.github.com/users/rslinckx/orgs", "repos_url": "https://api.github.com/users/rslinckx/repos", "events_url": "https://api.github.com/users/rslinckx/events{/privacy}", "received_events_url": "https://api.github.com/users/rslinckx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2020-07-10T10:19:14Z", "updated_at": "2020-07-21T18:16:55Z", "closed_at": "2020-07-21T18:16:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### Environment details\r\n\r\n  - OS type and version: osx\r\n  - Python version: 3.8\r\n  - `google-cloud-pubsub` version: 1.6.1\r\n\r\n#### Steps to reproduce\r\n\r\nWhen shutting down the subscriber, in-flight messages cannot be acked because the consumer stops first, and the dispatcher checks consumer.is_active before sending any requests. The in-flight tasks are correctly waited for by the shutdown sequence, but the ack() never gets sent\r\n\r\n  1. Start subscriber\r\n  2. Shutdown subscriber by calling cancel() on the returned future\r\n  3. In-flight messages are processed and the shutdown wait for them to return\r\n  4. Calling ack() on the messages will not be sent to pubsub as the consumer is already shutting down\r\n\r\n#### Code example\r\n\r\n```python\r\nimport time\r\nfrom google.cloud import pubsub_v1\r\n\r\nproject_id = \"test\"\r\nsubscription_id = \"sub1\"\r\n\r\ndef on_message(message):\r\n    time.sleep(5)\r\n    message.ack()\r\n\r\n\r\nwith pubsub_v1.SubscriberClient() as subscriber:\r\n    subscription_path = subscriber.subscription_path(project_id, subscription_id)\r\n    streaming_pull_future = subscriber.subscribe(subscription_path, callback=on_message)\r\n\r\n    try:\r\n        streaming_pull_future.result()\r\n    except KeyboardInterrupt:\r\n        streaming_pull_future.cancel()\r\n```\r\n\r\nJust after receiving the message, hit ctrl-c, the process will shutdown, wait for the 5 seconds sleep() in the on_message callback, and then exit.\r\n\r\nThe message.ack() has no effect as it is not sent to pubsub server.\r\n\r\nIs this expected ? This means there is no way to gracefully shutdown the subscriber without loosing currently executing callbacks?\r\n\r\nI tried to switch the shutdown sequence to first stopping the scheduler, then the consumer in streaming_pull_manager.py:510 and it seems to correctly allow the callbacks to terminate and process the ack(), but i fear this is only a partial workaround because it means new messages may still come in.\r\n\r\nIdeally, the consumer would stop receiving new messages, nack() all held messages, and allow for currently executing callbacks to terminate, process the ack/nack/drop requests, then continue shutting down ?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/137", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/137/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/137/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/137/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/137", "id": 645467884, "node_id": "MDU6SXNzdWU2NDU0Njc4ODQ=", "number": 137, "title": "Add pubsub/streaming-analytics samples from the samples repo", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2020-06-25T10:57:30Z", "updated_at": "2020-06-26T05:45:25Z", "closed_at": "2020-06-26T05:45:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "A transition to the new code generator (#131) requires the code samples to be moved from the common samples repo to here.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/136", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/136/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/136/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/136/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/136", "id": 645464755, "node_id": "MDU6SXNzdWU2NDU0NjQ3NTU=", "number": 136, "title": "Add pubsub/cloud-client samples from the samples repo", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-06-25T10:52:06Z", "updated_at": "2020-06-26T17:01:01Z", "closed_at": "2020-06-26T17:01:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "A transition to the new code generator (#131) requires the code samples to be moved from the common samples repo to here.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/130", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/130/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/130/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/130/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/130", "id": 644002825, "node_id": "MDU6SXNzdWU2NDQwMDI4MjU=", "number": 130, "title": "Warning: a recent release failed", "user": {"login": "failure-checker[bot]", "id": 58094317, "node_id": "MDM6Qm90NTgwOTQzMTc=", "avatar_url": "https://avatars2.githubusercontent.com/in/47470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/failure-checker%5Bbot%5D", "html_url": "https://github.com/apps/failure-checker", "followers_url": "https://api.github.com/users/failure-checker%5Bbot%5D/followers", "following_url": "https://api.github.com/users/failure-checker%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/failure-checker%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/failure-checker%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/failure-checker%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/failure-checker%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/failure-checker%5Bbot%5D/repos", "events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": {"login": "meredithslota", "id": 5223152, "node_id": "MDQ6VXNlcjUyMjMxNTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5223152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meredithslota", "html_url": "https://github.com/meredithslota", "followers_url": "https://api.github.com/users/meredithslota/followers", "following_url": "https://api.github.com/users/meredithslota/following{/other_user}", "gists_url": "https://api.github.com/users/meredithslota/gists{/gist_id}", "starred_url": "https://api.github.com/users/meredithslota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meredithslota/subscriptions", "organizations_url": "https://api.github.com/users/meredithslota/orgs", "repos_url": "https://api.github.com/users/meredithslota/repos", "events_url": "https://api.github.com/users/meredithslota/events{/privacy}", "received_events_url": "https://api.github.com/users/meredithslota/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "meredithslota", "id": 5223152, "node_id": "MDQ6VXNlcjUyMjMxNTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5223152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meredithslota", "html_url": "https://github.com/meredithslota", "followers_url": "https://api.github.com/users/meredithslota/followers", "following_url": "https://api.github.com/users/meredithslota/following{/other_user}", "gists_url": "https://api.github.com/users/meredithslota/gists{/gist_id}", "starred_url": "https://api.github.com/users/meredithslota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meredithslota/subscriptions", "organizations_url": "https://api.github.com/users/meredithslota/orgs", "repos_url": "https://api.github.com/users/meredithslota/repos", "events_url": "https://api.github.com/users/meredithslota/events{/privacy}", "received_events_url": "https://api.github.com/users/meredithslota/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2020-06-23T17:04:34Z", "updated_at": "2020-08-11T18:17:11Z", "closed_at": "2020-08-11T18:17:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "The release PR #117 is still in a pending state after several hours", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/128", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/128/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/128/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/128/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/128", "id": 643895727, "node_id": "MDU6SXNzdWU2NDM4OTU3Mjc=", "number": 128, "title": "Explain publish flow control in docs", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-06-23T14:35:19Z", "updated_at": "2020-07-10T15:54:58Z", "closed_at": "2020-07-10T15:54:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Following a [comment](https://github.com/googleapis/python-pubsub/issues/126#issuecomment-647211361) from a user, it would make sense to briefly explain the purpose of publish flow control settings.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/126", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/126/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/126/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/126/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/126", "id": 641604802, "node_id": "MDU6SXNzdWU2NDE2MDQ4MDI=", "number": 126, "title": "\"Retrying due to 504 Deadline Exceeded, sleeping 0.0s ...\" frequently in GKE when publishing data", "user": {"login": "dboshardy", "id": 2131537, "node_id": "MDQ6VXNlcjIxMzE1Mzc=", "avatar_url": "https://avatars2.githubusercontent.com/u/2131537?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dboshardy", "html_url": "https://github.com/dboshardy", "followers_url": "https://api.github.com/users/dboshardy/followers", "following_url": "https://api.github.com/users/dboshardy/following{/other_user}", "gists_url": "https://api.github.com/users/dboshardy/gists{/gist_id}", "starred_url": "https://api.github.com/users/dboshardy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dboshardy/subscriptions", "organizations_url": "https://api.github.com/users/dboshardy/orgs", "repos_url": "https://api.github.com/users/dboshardy/repos", "events_url": "https://api.github.com/users/dboshardy/events{/privacy}", "received_events_url": "https://api.github.com/users/dboshardy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 22, "created_at": "2020-06-18T14:49:46Z", "updated_at": "2020-06-25T19:32:52Z", "closed_at": "2020-06-22T13:55:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "Using a python gunicorn/flask service to pull streaming data and then publish to pubsub running in a pod on GKE, I receive errors regardless of batch size settings (including default).\r\n\r\nUsing both the pubsub and pubsub_v1 PublisherClient, with certain sets of data and default or larger batch sizes (>1000), I get:\r\n\r\n```\r\n\"Retrying due to 504 Deadline Exceeded, sleeping 0.0s ...\"\r\n```\r\n\r\nUntil ultimately I receive the following error in the added `done_callback`.\r\n\r\n```\r\nDeadline of 60.0s exceeded while calling functools.partial(<function _wrap_unary_errors.<locals>.error_remapped_callable at 0x7f869c25ae50>\r\n```\r\n\r\n\r\nOr, in some cases, no logs at all, the gunicorn worker just reboots silently. With smaller batch sizes in the low hundreds, I typically see no indication of an error, but the worker still silently fails and reboots and does so in under 60s.\r\n\r\nThis occurs regardless of if I'm running many publish workers or 1. \r\n\r\nThe GKE cluster is on a shared private VPC and is using workload identity.\r\n\r\n\r\nThis does seem to occur with specific datasets but there seems to be no clear reason why those datasets would cause any error like this. \r\n\r\nThis is the output of `pip3 freeze`\r\n\r\n```\r\ncachetools==4.1.0\r\ncertifi==2020.4.5.2\r\nchardet==3.0.4\r\nclick==7.1.2\r\nFlask==1.1.2\r\ngevent==20.6.2\r\ngoogle-api-core==1.20.1\r\ngoogle-auth==1.17.2\r\ngoogle-cloud-bigquery==1.25.0\r\ngoogle-cloud-core==1.3.0\r\ngoogle-cloud-pubsub==1.6.0\r\ngoogle-resumable-media==0.5.1\r\ngoogleapis-common-protos==1.52.0\r\ngreenlet==0.4.16\r\ngrpc-google-iam-v1==0.12.3\r\ngrpcio==1.29.0\r\ngunicorn==20.0.4\r\nidna==2.9\r\nitsdangerous==1.1.0\r\nJinja2==2.11.2\r\nMarkupSafe==1.1.1\r\nprotobuf==3.12.2\r\npyasn1==0.4.8\r\npyasn1-modules==0.2.8\r\npytz==2020.1\r\nrequests==2.23.0\r\nrsa==4.6\r\nsix==1.15.0\r\nurllib3==1.25.9\r\nWerkzeug==1.0.1\r\nzope.event==4.4\r\nzope.interface==5.1.0\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/122", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/122/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/122/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/122/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/122", "id": 638886778, "node_id": "MDU6SXNzdWU2Mzg4ODY3Nzg=", "number": 122, "title": "Document how to nack synchronous pull messages", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-06-15T14:12:03Z", "updated_at": "2020-06-18T18:15:55Z", "closed_at": "2020-06-18T18:15:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "As discussed some time ago, there is no explicit `nack()` method on the subscriber client and it might not be immediately obvious how to nack synchronous pull messages. We should explain this in the docs.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/119", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/119/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/119/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/119/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/119", "id": 636817019, "node_id": "MDU6SXNzdWU2MzY4MTcwMTk=", "number": 119, "title": "Configure Python test session versions in noxfile.py", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814841, "node_id": "MDU6TGFiZWwxODE0ODE0ODQx", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20cleanup", "name": "type: cleanup", "color": "c5def5", "default": false, "description": "An internal cleanup or hygiene concern."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2020-06-11T08:15:54Z", "updated_at": "2020-06-12T10:38:19Z", "closed_at": "2020-06-12T10:38:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "With the recent changes in auto-generated code, the Python versions are not set anymore in `noxfile.py`, the latter only contains placeholders.\r\n\r\nWe need to update `synth.py` to insert these versions automatically whenever the noxfile is re-generated.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/118", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/118/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/118/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/118/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/118", "id": 636409996, "node_id": "MDU6SXNzdWU2MzY0MDk5OTY=", "number": 118, "title": "Warning: a recent release failed", "user": {"login": "failure-checker[bot]", "id": 58094317, "node_id": "MDM6Qm90NTgwOTQzMTc=", "avatar_url": "https://avatars2.githubusercontent.com/in/47470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/failure-checker%5Bbot%5D", "html_url": "https://github.com/apps/failure-checker", "followers_url": "https://api.github.com/users/failure-checker%5Bbot%5D/followers", "following_url": "https://api.github.com/users/failure-checker%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/failure-checker%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/failure-checker%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/failure-checker%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/failure-checker%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/failure-checker%5Bbot%5D/repos", "events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-10T17:03:47Z", "updated_at": "2020-06-23T10:35:46Z", "closed_at": "2020-06-23T10:35:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "The release PR #117 is still in a pending state after several hours", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/112", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/112/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/112/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/112/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/112", "id": 631167341, "node_id": "MDU6SXNzdWU2MzExNjczNDE=", "number": 112, "title": "Docker + pubsub + subprocess hangs with no errors", "user": {"login": "jtressle", "id": 13778165, "node_id": "MDQ6VXNlcjEzNzc4MTY1", "avatar_url": "https://avatars2.githubusercontent.com/u/13778165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jtressle", "html_url": "https://github.com/jtressle", "followers_url": "https://api.github.com/users/jtressle/followers", "following_url": "https://api.github.com/users/jtressle/following{/other_user}", "gists_url": "https://api.github.com/users/jtressle/gists{/gist_id}", "starred_url": "https://api.github.com/users/jtressle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jtressle/subscriptions", "organizations_url": "https://api.github.com/users/jtressle/orgs", "repos_url": "https://api.github.com/users/jtressle/repos", "events_url": "https://api.github.com/users/jtressle/events{/privacy}", "received_events_url": "https://api.github.com/users/jtressle/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-04T21:43:41Z", "updated_at": "2020-06-10T20:27:07Z", "closed_at": "2020-06-06T08:47:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm running pubsub in a docker container and am experiencing hangs after a few minutes.  I've been running pubsub with similar commands outside of docker, and see no hangs (over 1 year running).\r\n\r\nI was able to reproduce my issue with a simplified implementation outlined below.\r\n\r\nThe following four files (docker file, requirements.txt, worker.py, test.py) are placed into the same directory.\r\n[Dockerfile.txt](https://github.com/googleapis/python-pubsub/files/4732822/Dockerfile.txt)\r\n[requirements.txt](https://github.com/googleapis/python-pubsub/files/4732823/requirements.txt)\r\n[worker.py.txt](https://github.com/googleapis/python-pubsub/files/4732825/worker.py.txt)\r\n[test.py.txt](https://github.com/googleapis/python-pubsub/files/4732827/test.py.txt)\r\n\r\nTo build the docker file, I ran \r\n`docker build --tag=test .`\r\n\r\nTo run the docker file, I did the following:\r\n\r\n```\r\ndocker run -it \\\r\n   -e GOOGLE_APPLICATION_CREDENTIALS=/keys/service-account.json \\\r\n   -e GRPC_ENABLE_FORK_SUPPORT=false \\\r\n   -e GRPC_VERBOSITY=debug \\\r\n   -e GRPC_TRACE=all \\\r\n   -v /tmp/keys/:/keys/:ro \\\r\n   -v /tmp/logs:/logs \\\r\ntest:latest bash\r\n```\r\n\r\nTo simplify my issue, I used `subprocess.call_back()` to run test.py, which is basically a 3 second timer.  \r\n\r\nI'm running docker on my Mac, but I've also experienced the same hanging using kubernetes, and on an Ubuntu 18.04 machine running docker.  The issue is that after a few minutes, the pubsub subscriber becomes unresponsive.  The above code runs perfectly in a virtual environment without docker.  \r\n\r\nThe following log file is the publisher output, and has the message ID's.  \r\n[publish_output.txt](https://github.com/googleapis/python-pubsub/files/4732851/publish_output.txt)\r\n\r\nThe following log file is the subscriber output.  \r\n[subscriber_output.txt](https://github.com/googleapis/python-pubsub/files/4732854/subscriber_output.txt)\r\n\r\nThe last successful message received was message ID 1253690400552289 (line 9338 of subscriber_output.txt).  Messages 1253713007710668, 1253714609061509, 1253713464329969 and onward were all not received by pubsub.\r\n\r\nIs there any additional setting I need to do?  Unfortunately, I'm running custom C++ code from python so I need to use subprocesses.\r\n\r\nInside of docker, I ran `python worker.py` to start pubsub.\r\n\r\nAny help is appreciated.\r\n\r\nThanks!\r\n\r\n**Updated to show current configuration**\r\n\r\nBelow are my python packages pip downloaded:\r\n\r\n```\r\nCacheControl             0.12.6\r\ncachetools               4.1.0\r\ncertifi                  2020.4.5.1\r\nchardet                  3.0.4\r\nfirebase                 3.0.1\r\nfirebase-admin           4.3.0\r\nfirestore                0.0.8\r\ngoogle-api-core          1.18.0\r\ngoogle-api-python-client 1.9.1\r\ngoogle-auth              1.16.1\r\ngoogle-auth-httplib2     0.0.3\r\ngoogle-cloud-core        1.3.0\r\ngoogle-cloud-firestore   1.7.0\r\ngoogle-cloud-logging     1.15.0\r\ngoogle-cloud-pubsub      1.5.0\r\ngoogle-cloud-storage     1.28.1\r\ngoogle-resumable-media   0.5.1\r\ngoogleapis-common-protos 1.52.0\r\ngrpc-google-iam-v1       0.12.3\r\ngrpcio                   1.29.0\r\nhttplib2                 0.18.1\r\nidna                     2.9\r\niso8601                  0.1.12\r\nmsgpack                  1.0.0\r\npip                      20.1.1\r\nprotobuf                 3.12.2\r\npyasn1                   0.4.8\r\npyasn1-modules           0.2.8\r\npytz                     2020.1\r\nrequests                 2.23.0\r\nrsa                      4.0\r\nsetuptools               46.4.0\r\nsix                      1.15.0\r\nuritemplate              3.0.1\r\nurllib3                  1.25.9\r\nwheel                    0.34.2\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/110", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/110/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/110/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/110/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/110", "id": 627541319, "node_id": "MDU6SXNzdWU2Mjc1NDEzMTk=", "number": 110, "title": "docs: update_subscription and update_snapshot examples are wrong", "user": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-05-29T21:13:56Z", "updated_at": "2020-06-06T13:11:54Z", "closed_at": "2020-06-06T13:11:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The [example](https://github.com/googleapis/python-pubsub/blob/cf9e87c80c0771f3fa6ef784a8d76cb760ad37ef/google/cloud/pubsub_v1/gapic/subscriber_client.py#L528) subscription object doesn't have a 'name' field.  Same with [update_snapshot](https://github.com/googleapis/python-pubsub/blob/cf9e87c80c0771f3fa6ef784a8d76cb760ad37ef/google/cloud/pubsub_v1/gapic/subscriber_client.py#L1496).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/107", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/107/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/107/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/107/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/107", "id": 626116705, "node_id": "MDU6SXNzdWU2MjYxMTY3MDU=", "number": 107, "title": "Warning: a recent release failed", "user": {"login": "failure-checker[bot]", "id": 58094317, "node_id": "MDM6Qm90NTgwOTQzMTc=", "avatar_url": "https://avatars2.githubusercontent.com/in/47470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/failure-checker%5Bbot%5D", "html_url": "https://github.com/apps/failure-checker", "followers_url": "https://api.github.com/users/failure-checker%5Bbot%5D/followers", "following_url": "https://api.github.com/users/failure-checker%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/failure-checker%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/failure-checker%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/failure-checker%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/failure-checker%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/failure-checker%5Bbot%5D/repos", "events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-28T00:02:46Z", "updated_at": "2020-05-28T20:09:37Z", "closed_at": "2020-05-28T20:09:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "The release PR #88 is still in a pending state after several hours", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/106", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/106/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/106/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/106/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/106", "id": 625545916, "node_id": "MDU6SXNzdWU2MjU1NDU5MTY=", "number": 106, "title": "message.nack() will that remove the message from the topic", "user": {"login": "kthulsidoss", "id": 42998906, "node_id": "MDQ6VXNlcjQyOTk4OTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/42998906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kthulsidoss", "html_url": "https://github.com/kthulsidoss", "followers_url": "https://api.github.com/users/kthulsidoss/followers", "following_url": "https://api.github.com/users/kthulsidoss/following{/other_user}", "gists_url": "https://api.github.com/users/kthulsidoss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kthulsidoss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kthulsidoss/subscriptions", "organizations_url": "https://api.github.com/users/kthulsidoss/orgs", "repos_url": "https://api.github.com/users/kthulsidoss/repos", "events_url": "https://api.github.com/users/kthulsidoss/events{/privacy}", "received_events_url": "https://api.github.com/users/kthulsidoss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-27T09:46:31Z", "updated_at": "2020-06-05T15:17:09Z", "closed_at": "2020-06-05T15:17:09Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello\r\n\r\nGreetings. This is a question on negating the acknowledge .. let us say we want to negate the acknowledge meaning we want pub sub to remove the message from topi itself , so based on certain condition will this work\r\nmessage.nack()\r\nThanks\r\n**K.Thulsi Doss**", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/105", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/105/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/105/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/105/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/105", "id": 625536072, "node_id": "MDU6SXNzdWU2MjU1MzYwNzI=", "number": 105, "title": "unused message arg in Batch.will_accept()", "user": {"login": "IlyaFaer", "id": 26030071, "node_id": "MDQ6VXNlcjI2MDMwMDcx", "avatar_url": "https://avatars1.githubusercontent.com/u/26030071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IlyaFaer", "html_url": "https://github.com/IlyaFaer", "followers_url": "https://api.github.com/users/IlyaFaer/followers", "following_url": "https://api.github.com/users/IlyaFaer/following{/other_user}", "gists_url": "https://api.github.com/users/IlyaFaer/gists{/gist_id}", "starred_url": "https://api.github.com/users/IlyaFaer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IlyaFaer/subscriptions", "organizations_url": "https://api.github.com/users/IlyaFaer/orgs", "repos_url": "https://api.github.com/users/IlyaFaer/repos", "events_url": "https://api.github.com/users/IlyaFaer/events{/privacy}", "received_events_url": "https://api.github.com/users/IlyaFaer/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814841, "node_id": "MDU6TGFiZWwxODE0ODE0ODQx", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20cleanup", "name": "type: cleanup", "color": "c5def5", "default": false, "description": "An internal cleanup or hygiene concern."}], "state": "closed", "locked": false, "assignee": {"login": "IlyaFaer", "id": 26030071, "node_id": "MDQ6VXNlcjI2MDMwMDcx", "avatar_url": "https://avatars1.githubusercontent.com/u/26030071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IlyaFaer", "html_url": "https://github.com/IlyaFaer", "followers_url": "https://api.github.com/users/IlyaFaer/followers", "following_url": "https://api.github.com/users/IlyaFaer/following{/other_user}", "gists_url": "https://api.github.com/users/IlyaFaer/gists{/gist_id}", "starred_url": "https://api.github.com/users/IlyaFaer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IlyaFaer/subscriptions", "organizations_url": "https://api.github.com/users/IlyaFaer/orgs", "repos_url": "https://api.github.com/users/IlyaFaer/repos", "events_url": "https://api.github.com/users/IlyaFaer/events{/privacy}", "received_events_url": "https://api.github.com/users/IlyaFaer/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "IlyaFaer", "id": 26030071, "node_id": "MDQ6VXNlcjI2MDMwMDcx", "avatar_url": "https://avatars1.githubusercontent.com/u/26030071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IlyaFaer", "html_url": "https://github.com/IlyaFaer", "followers_url": "https://api.github.com/users/IlyaFaer/followers", "following_url": "https://api.github.com/users/IlyaFaer/following{/other_user}", "gists_url": "https://api.github.com/users/IlyaFaer/gists{/gist_id}", "starred_url": "https://api.github.com/users/IlyaFaer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IlyaFaer/subscriptions", "organizations_url": "https://api.github.com/users/IlyaFaer/orgs", "repos_url": "https://api.github.com/users/IlyaFaer/repos", "events_url": "https://api.github.com/users/IlyaFaer/events{/privacy}", "received_events_url": "https://api.github.com/users/IlyaFaer/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2020-05-27T09:32:08Z", "updated_at": "2020-06-09T21:13:53Z", "closed_at": "2020-06-09T21:13:53Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Looks like `message` arg is never used by `will_accept()` method:\r\nhttps://github.com/googleapis/python-pubsub/blob/cf9e87c80c0771f3fa6ef784a8d76cb760ad37ef/google/cloud/pubsub_v1/publisher/_batch/base.py#L112-L136\r\n\r\nMost likely it should be deleted to avoid any confusion, but I suppose it should be done with deprecation. `Batch()` is not something pretending to be manually used by users, but who knows.\r\n\r\n@pradn, please, comment", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/104", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/104/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/104/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/104/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/104", "id": 624914305, "node_id": "MDU6SXNzdWU2MjQ5MTQzMDU=", "number": 104, "title": "snippet to check for no messages", "user": {"login": "kthulsidoss", "id": 42998906, "node_id": "MDQ6VXNlcjQyOTk4OTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/42998906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kthulsidoss", "html_url": "https://github.com/kthulsidoss", "followers_url": "https://api.github.com/users/kthulsidoss/followers", "following_url": "https://api.github.com/users/kthulsidoss/following{/other_user}", "gists_url": "https://api.github.com/users/kthulsidoss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kthulsidoss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kthulsidoss/subscriptions", "organizations_url": "https://api.github.com/users/kthulsidoss/orgs", "repos_url": "https://api.github.com/users/kthulsidoss/repos", "events_url": "https://api.github.com/users/kthulsidoss/events{/privacy}", "received_events_url": "https://api.github.com/users/kthulsidoss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": {"login": "IlyaFaer", "id": 26030071, "node_id": "MDQ6VXNlcjI2MDMwMDcx", "avatar_url": "https://avatars1.githubusercontent.com/u/26030071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IlyaFaer", "html_url": "https://github.com/IlyaFaer", "followers_url": "https://api.github.com/users/IlyaFaer/followers", "following_url": "https://api.github.com/users/IlyaFaer/following{/other_user}", "gists_url": "https://api.github.com/users/IlyaFaer/gists{/gist_id}", "starred_url": "https://api.github.com/users/IlyaFaer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IlyaFaer/subscriptions", "organizations_url": "https://api.github.com/users/IlyaFaer/orgs", "repos_url": "https://api.github.com/users/IlyaFaer/repos", "events_url": "https://api.github.com/users/IlyaFaer/events{/privacy}", "received_events_url": "https://api.github.com/users/IlyaFaer/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "IlyaFaer", "id": 26030071, "node_id": "MDQ6VXNlcjI2MDMwMDcx", "avatar_url": "https://avatars1.githubusercontent.com/u/26030071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IlyaFaer", "html_url": "https://github.com/IlyaFaer", "followers_url": "https://api.github.com/users/IlyaFaer/followers", "following_url": "https://api.github.com/users/IlyaFaer/following{/other_user}", "gists_url": "https://api.github.com/users/IlyaFaer/gists{/gist_id}", "starred_url": "https://api.github.com/users/IlyaFaer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IlyaFaer/subscriptions", "organizations_url": "https://api.github.com/users/IlyaFaer/orgs", "repos_url": "https://api.github.com/users/IlyaFaer/repos", "events_url": "https://api.github.com/users/IlyaFaer/events{/privacy}", "received_events_url": "https://api.github.com/users/IlyaFaer/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2020-05-26T14:10:40Z", "updated_at": "2020-05-28T07:26:12Z", "closed_at": "2020-05-27T09:32:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello ,\r\n\r\nI'm using synchronous pull , there is need to check if there are no message and then process\r\nresponse = subscriber.pull(subscription_path, max_messages=NUM_MESSAGES)\r\n\r\nso how to check if there are no messages received ? can we check the length\r\n\r\ne.g \r\nif len(response) < 1: \r\nsleep for some time\r\nelse\r\ndo the processing()", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/99", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/99/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/99/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/99/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/99", "id": 616923268, "node_id": "MDU6SXNzdWU2MTY5MjMyNjg=", "number": 99, "title": "Warning: a recent release failed", "user": {"login": "failure-checker[bot]", "id": 58094317, "node_id": "MDM6Qm90NTgwOTQzMTc=", "avatar_url": "https://avatars2.githubusercontent.com/in/47470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/failure-checker%5Bbot%5D", "html_url": "https://github.com/apps/failure-checker", "followers_url": "https://api.github.com/users/failure-checker%5Bbot%5D/followers", "following_url": "https://api.github.com/users/failure-checker%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/failure-checker%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/failure-checker%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/failure-checker%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/failure-checker%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/failure-checker%5Bbot%5D/repos", "events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/failure-checker%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-12T20:02:37Z", "updated_at": "2020-05-27T23:50:07Z", "closed_at": "2020-05-27T23:50:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "The release PR #88 is still in a pending state after several hours", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/95", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/95/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/95/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/95/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/95", "id": 611132428, "node_id": "MDU6SXNzdWU2MTExMzI0Mjg=", "number": 95, "title": "Support sending nack for synchronously pulled message", "user": {"login": "accnops", "id": 4964315, "node_id": "MDQ6VXNlcjQ5NjQzMTU=", "avatar_url": "https://avatars3.githubusercontent.com/u/4964315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/accnops", "html_url": "https://github.com/accnops", "followers_url": "https://api.github.com/users/accnops/followers", "following_url": "https://api.github.com/users/accnops/following{/other_user}", "gists_url": "https://api.github.com/users/accnops/gists{/gist_id}", "starred_url": "https://api.github.com/users/accnops/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/accnops/subscriptions", "organizations_url": "https://api.github.com/users/accnops/orgs", "repos_url": "https://api.github.com/users/accnops/repos", "events_url": "https://api.github.com/users/accnops/events{/privacy}", "received_events_url": "https://api.github.com/users/accnops/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-05-02T08:11:14Z", "updated_at": "2020-05-05T08:57:58Z", "closed_at": "2020-05-05T08:57:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "Currently, sending a nack for a message is only possible when using an asynchronous pull. When pulling asynchronously, the resulting messages are `google.cloud.pubsub_v1.subscriber.message.Message` instances, which have a `nack` method. When pulling synchronously, as shown in the [documented examples](https://googleapis.dev/python/pubsub/latest/subscriber/index.html), the result is a `PullResponse` with `ReceivedMessage` instances. These instances do not provide much logic, as they seem to come from plain gRPC.\r\n\r\nSending an ack for a `ReceivedMessage` message is straightforward. As documented, this can be done with the `subscriber.acknowledge` method. Sending a nack is not possible however. Creating a `google.cloud.pubsub_v1.subscriber.message.Message` from a `ReceivedMessage` is not possible I think, since a `request_queue` is needed, which is provided by a \"Manager\" when pulling asynchronously. This manager is not available when pulling synchronously.\r\n\r\nI suggest adding a `unacknowledge` method to the [Subscriber Client API](https://googleapis.dev/python/pubsub/latest/subscriber/api/client.html).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/93", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/93/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/93/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/93/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/93", "id": 609374346, "node_id": "MDU6SXNzdWU2MDkzNzQzNDY=", "number": 93, "title": "Resolve Incompatibility with API Core >= 1.17.0", "user": {"login": "crwilcox", "id": 638797, "node_id": "MDQ6VXNlcjYzODc5Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/638797?v=4", "gravatar_id": "", "url": "https://api.github.com/users/crwilcox", "html_url": "https://github.com/crwilcox", "followers_url": "https://api.github.com/users/crwilcox/followers", "following_url": "https://api.github.com/users/crwilcox/following{/other_user}", "gists_url": "https://api.github.com/users/crwilcox/gists{/gist_id}", "starred_url": "https://api.github.com/users/crwilcox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/crwilcox/subscriptions", "organizations_url": "https://api.github.com/users/crwilcox/orgs", "repos_url": "https://api.github.com/users/crwilcox/repos", "events_url": "https://api.github.com/users/crwilcox/events{/privacy}", "received_events_url": "https://api.github.com/users/crwilcox/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2020-04-29T21:33:15Z", "updated_at": "2020-06-09T22:24:57Z", "closed_at": "2020-06-09T22:24:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Changes in 1.17.0 are causing an incompatibility with pubsub. \r\n\r\n# Related Issues: \r\n\r\nhttps://github.com/googleapis/python-api-core/issues/25\r\nhttps://github.com/googleapis/python-pubsub/issues/74\r\n\r\n# Suspected changes that caused the behavior change:\r\n\r\nhttps://github.com/googleapis/python-api-core/commit/2b103b60ece16a1e1bc98cfda7ec375191a90f75#diff-d97e81006eaaf29e33270a85aead6aafR146-R148\r\n\r\n# Repro:\r\n\r\n```\r\n\r\nfrom google.cloud import pubsub_v1\r\nimport threading\r\nfrom time import sleep\r\n\r\nimport logging\r\n\r\ndef main():\r\n    logging.basicConfig(level=logging.DEBUG)\r\n    logger = logging.getLogger('sample')\r\n    logger.setLevel(logging.DEBUG)\r\n    PROJECT_ID = \"crwilcox-test\"\r\n    TOPIC_PATH = \"my-topic\"\r\n    SUBSCRIPTION_PATH = \"my-sub\"\r\n\r\n    publisher_thread = threading.Thread(target=publisher, args=(PROJECT_ID, TOPIC_PATH))\r\n    publisher_thread.daemon = True\r\n    publisher_thread.start()\r\n\r\n    subscriber(PROJECT_ID, SUBSCRIPTION_PATH)\r\n\r\ndef publisher(\r\n    project_id, topic_name\r\n):\r\n    # TODO project_id = \"Your Google Cloud Project ID\"\r\n    # TODO topic_name = \"Your Pub/Sub topic name\"\r\n\r\n\r\n    publisher = pubsub_v1.PublisherClient()\r\n    # The `topic_path` method creates a fully qualified identifier\r\n    # in the form `projects/{project_id}/topics/{topic_name}`\r\n    topic_path = publisher.topic_path(project_id, topic_name)\r\n    #publisher.create_topic(topic_path)\r\n\r\n    for n in range(1, 100000):\r\n        data = u\"Message number {}\".format(n)\r\n        # Data must be a bytestring\r\n        data = data.encode(\"utf-8\")\r\n        # When you publish a message, the client returns a future.\r\n        future = publisher.publish(topic_path, data=data)\r\n        print(future.result())\r\n        sleep(5)\r\n\r\n    print(\"Published messages.\")\r\n\r\n\r\n\r\ndef subscriber(\r\n    project_id, subscription_name, timeout=None\r\n):\r\n    # TODO project_id = \"Your Google Cloud Project ID\"\r\n    # TODO subscription_name = \"Your Pub/Sub subscription name\"\r\n    # TODO timeout = 5.0  # \"How long the subscriber should listen for\r\n    # messages in seconds\"\r\n\r\n    subscriber = pubsub_v1.SubscriberClient()\r\n    # The `subscription_path` method creates a fully qualified identifier\r\n    # in the form `projects/{project_id}/subscriptions/{subscription_name}`\r\n    subscription_path = subscriber.subscription_path(\r\n        project_id, subscription_name\r\n    )\r\n\r\n    def callback(message):\r\n        print(\"Received message: {}\".format(message.data))\r\n        message.ack()\r\n\r\n    streaming_pull_future = subscriber.subscribe(\r\n        subscription_path, callback=callback\r\n    )\r\n    print(\"Listening for messages on {}..\\n\".format(subscription_path))\r\n\r\n    # Wrap subscriber in a 'with' block to automatically call close() when done.\r\n    with subscriber:\r\n        try:\r\n            # When `timeout` is not set, result() will block indefinitely,\r\n            # unless an exception is encountered first.\r\n            streaming_pull_future.result(timeout=timeout)\r\n        except:  # noqa\r\n            streaming_pull_future.cancel()\r\n\r\n\r\nmain()\r\n\r\n```\r\n\r\n# Result:\r\n\r\nEventually, subscription will fail and stop processing.\r\n\r\nThe failure exists in bidi on getting the next item via `__iter__`\r\n\r\n```\r\nDEBUG:google.cloud.pubsub_v1.publisher._batch.thread:gRPC Publish took 0.034303903579711914 seconds.\r\n1162512773129262\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager:Sent request(s) over unary RPC.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager:Released held message, scheduling callback for it, still on hold 0 (bytes 0).\r\nDEBUG:google.api_core.bidi:waiting for recv.\r\nReceived message: b'Message number 117'\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.dispatcher:Handling 1 batched requests\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager:Sent request(s) over unary RPC.\r\niter except: <_MultiThreadedRendezvous of RPC that terminated with:\r\n        status = StatusCode.DEADLINE_EXCEEDED\r\n        details = \"Deadline Exceeded\"\r\n        debug_error_string = \"{\"created\":\"@1588195797.686297000\",\"description\":\"Error received from peer ipv4:216.58.217.42:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1056,\"grpc_message\":\"Deadline Exceeded\",\"grpc_status\":4}\"\r\n>\r\nINFO:google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager:Observed non-terminating stream error 504 Deadline Exceeded\r\nINFO:google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager:Observed recoverable stream error 504 Deadline Exceeded\r\nDEBUG:google.api_core.bidi:Re-opening stream from gRPC callback.\r\nDEBUG:google.api_core.bidi:Empty queue and inactive call, exiting request generator.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:The current deadline value is 10 seconds.\r\n```\r\n\r\n```\r\nPYTHON_PATH/lib/python3.8/threading.py(890)_bootstrap()\r\n-> self._bootstrap_inner()\r\n  PYTHON_PATH/lib/python3.8/threading.py(932)_bootstrap_inner()\r\n-> self.run()\r\n  PYTHON_PATH/lib/python3.8/threading.py(870)run()\r\n-> self._target(*self._args, **self._kwargs)\r\n  /workspace/googleapis/python-pubsub/venv/lib/python3.8/site-packages/google/api_core/bidi.py(655)_thread_main()\r\n-> response = self._bidi_rpc.recv()\r\n  /workspace/googleapis/python-pubsub/venv/lib/python3.8/site-packages/google/api_core/bidi.py(562)recv()\r\n-> return self._recoverable(self._recv)\r\n  /workspace/googleapis/python-pubsub/venv/lib/python3.8/site-packages/google/api_core/bidi.py(505)_recoverable()\r\n-> return method(*args, **kwargs)\r\n  /workspace/googleapis/python-pubsub/venv/lib/python3.8/site-packages/google/api_core/bidi.py(559)_recv()\r\n-> return next(call)\r\n> /workspace/googleapis/python-pubsub/venv/lib/python3.8/site-packages/google/api_core/grpc_helpers.py(109)next()\r\n-> six.raise_from(exceptions.from_grpc_error(exc), exc)\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/91", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/91/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/91/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/91/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/91", "id": 609030766, "node_id": "MDU6SXNzdWU2MDkwMzA3NjY=", "number": 91, "title": "Remove test_utils directory", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814841, "node_id": "MDU6TGFiZWwxODE0ODE0ODQx", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20cleanup", "name": "type: cleanup", "color": "c5def5", "default": false, "description": "An internal cleanup or hygiene concern."}], "state": "closed", "locked": false, "assignee": null, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-04-29T12:46:47Z", "updated_at": "2020-04-30T17:55:04Z", "closed_at": "2020-04-30T17:55:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Now that test utils are available (and installed from) a GitHub repo, the `test_utils` directory is no longer needed and can be removed.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/86", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/86/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/86/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/86/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/86", "id": 604961274, "node_id": "MDU6SXNzdWU2MDQ5NjEyNzQ=", "number": 86, "title": "Remove experimental notice from DLQ related fields", "user": {"login": "hongalex", "id": 9397363, "node_id": "MDQ6VXNlcjkzOTczNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/9397363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hongalex", "html_url": "https://github.com/hongalex", "followers_url": "https://api.github.com/users/hongalex/followers", "following_url": "https://api.github.com/users/hongalex/following{/other_user}", "gists_url": "https://api.github.com/users/hongalex/gists{/gist_id}", "starred_url": "https://api.github.com/users/hongalex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hongalex/subscriptions", "organizations_url": "https://api.github.com/users/hongalex/orgs", "repos_url": "https://api.github.com/users/hongalex/repos", "events_url": "https://api.github.com/users/hongalex/events{/privacy}", "received_events_url": "https://api.github.com/users/hongalex/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-04-22T18:13:29Z", "updated_at": "2020-04-22T20:05:29Z", "closed_at": "2020-04-22T20:05:29Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "DLQ is now GA, so experimental notices should be removed.\r\n\r\nSince Python is one of the languages where the fields are passed through from the autogenerated client, I think [this](https://github.com/googleapis/python-pubsub/blob/cc3093a2c0304259bc374bc2eeec9630e4a11a5e/google/cloud/pubsub_v1/subscriber/message.py#L190) is the only place that needs to be changed but correct me if I'm wrong.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/85", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/85/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/85/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/85/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/85", "id": 604185877, "node_id": "MDU6SXNzdWU2MDQxODU4Nzc=", "number": 85, "title": "python-pubsub: add support for filtering", "user": {"login": "d-torres", "id": 46171068, "node_id": "MDQ6VXNlcjQ2MTcxMDY4", "avatar_url": "https://avatars1.githubusercontent.com/u/46171068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/d-torres", "html_url": "https://github.com/d-torres", "followers_url": "https://api.github.com/users/d-torres/followers", "following_url": "https://api.github.com/users/d-torres/following{/other_user}", "gists_url": "https://api.github.com/users/d-torres/gists{/gist_id}", "starred_url": "https://api.github.com/users/d-torres/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/d-torres/subscriptions", "organizations_url": "https://api.github.com/users/d-torres/orgs", "repos_url": "https://api.github.com/users/d-torres/repos", "events_url": "https://api.github.com/users/d-torres/events{/privacy}", "received_events_url": "https://api.github.com/users/d-torres/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2020-04-21T18:16:21Z", "updated_at": "2020-05-20T23:13:26Z", "closed_at": "2020-05-20T23:13:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "Add an additional field for subscriptions that allows [configuring a filter](https://github.com/googleapis/googleapis/blob/master/google/pubsub/v1/pubsub.proto#L682). Filters control what messages are sent to subscribers based on the message attributes.\r\n\r\nAs an example, if a message filter is the string attributes.event_type = \"1\", then messages with attributes of event_type=1 will be delivered, while everything else will be filtered out.\r\nThere will be more complicated filters to handle prefixes and non-exact matches, but any integration tests can just test the exact match case.\r\n\r\nIf empty, no messages are filtered out. Filtering can be configured only on subscription creation, not on updates.\r\n\r\nReference implementation in Go will be tracked under https://github.com/googleapis/google-cloud-go/issues/1943", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/82", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/82/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/82/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/82/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/82", "id": 603833022, "node_id": "MDU6SXNzdWU2MDM4MzMwMjI=", "number": 82, "title": "Fix 1.4.3 version heading in release notes", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-04-21T09:02:34Z", "updated_at": "2020-04-21T16:52:49Z", "closed_at": "2020-04-21T16:52:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The heading of a release should be promoted by one level (currently heading 3 instead of heading 2), which looks weird in the generated [changelog](https://googleapis.dev/python/pubsub/latest/index.html#changelog).\r\n\r\nSeems like a transitional error, as the newest auto-release PR already [has this fixed](https://github.com/googleapis/python-pubsub/pull/81/files#diff-4ac32a78649ca5bdd8e0ba38b7006a1eR7).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/79", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/79/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/79/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/79/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/79", "id": 603598678, "node_id": "MDU6SXNzdWU2MDM1OTg2Nzg=", "number": 79, "title": "python-pubsub: add support for retry policy", "user": {"login": "d-torres", "id": 46171068, "node_id": "MDQ6VXNlcjQ2MTcxMDY4", "avatar_url": "https://avatars1.githubusercontent.com/u/46171068?v=4", "gravatar_id": "", "url": "https://api.github.com/users/d-torres", "html_url": "https://github.com/d-torres", "followers_url": "https://api.github.com/users/d-torres/followers", "following_url": "https://api.github.com/users/d-torres/following{/other_user}", "gists_url": "https://api.github.com/users/d-torres/gists{/gist_id}", "starred_url": "https://api.github.com/users/d-torres/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/d-torres/subscriptions", "organizations_url": "https://api.github.com/users/d-torres/orgs", "repos_url": "https://api.github.com/users/d-torres/repos", "events_url": "https://api.github.com/users/d-torres/events{/privacy}", "received_events_url": "https://api.github.com/users/d-torres/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2020-04-20T23:23:51Z", "updated_at": "2020-05-29T18:42:37Z", "closed_at": "2020-05-29T16:36:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "Add an additional field for subscriptions that allows configuring a [RetryPolicy](https://github.com/googleapis/googleapis/blob/42ee97c1b93a0e3759bbba3013da309f670a90ab/google/pubsub/v1/pubsub.proto#L704). RetryPolicy allows configuration of how long a message can be delayed before delivery is retried. The default policy is the current behavior, in that messages are redelivered as soon as possible after a NACK or message expiration.\r\n\r\nReference implementation in Go will be tracked under https://github.com/googleapis/google-cloud-go/issues/1942\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/78", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/78/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/78/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/78/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/78", "id": 601778088, "node_id": "MDU6SXNzdWU2MDE3NzgwODg=", "number": 78, "title": "PubSub: Stream never gets re-established after being killed", "user": {"login": "GuillaumeLachaud", "id": 2076017, "node_id": "MDQ6VXNlcjIwNzYwMTc=", "avatar_url": "https://avatars1.githubusercontent.com/u/2076017?v=4", "gravatar_id": "", "url": "https://api.github.com/users/GuillaumeLachaud", "html_url": "https://github.com/GuillaumeLachaud", "followers_url": "https://api.github.com/users/GuillaumeLachaud/followers", "following_url": "https://api.github.com/users/GuillaumeLachaud/following{/other_user}", "gists_url": "https://api.github.com/users/GuillaumeLachaud/gists{/gist_id}", "starred_url": "https://api.github.com/users/GuillaumeLachaud/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/GuillaumeLachaud/subscriptions", "organizations_url": "https://api.github.com/users/GuillaumeLachaud/orgs", "repos_url": "https://api.github.com/users/GuillaumeLachaud/repos", "events_url": "https://api.github.com/users/GuillaumeLachaud/events{/privacy}", "received_events_url": "https://api.github.com/users/GuillaumeLachaud/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814762, "node_id": "MDU6TGFiZWwxODE0ODE0NzYy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/status:%20duplicate", "name": "status: duplicate", "color": "d4c5f9", "default": false, "description": "Duplicate."}, {"id": 1814815055, "node_id": "MDU6TGFiZWwxODE0ODE1MDU1", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/triage%20me", "name": "triage me", "color": "FF69B4", "default": false, "description": "I really want to be triaged."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-16T20:48:40Z", "updated_at": "2020-04-17T12:52:02Z", "closed_at": "2020-04-17T08:04:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "As I updated today from pubsub 1.1.0 to 1.4.2, I noticed something strange on my  async subscription:\r\n\r\nEvery 10 minutes, the stream dies out, but where it was getting re-established in 1.1.0, 1.4.2 ignores the error and thus all the subsequent messages:\r\n\r\n```\r\n020-04-16 22:32:16,537 - google.cloud.pubsub_v1.subscriber._protocol.leaser - DEBUG - Snoozing lease management for 6.620806 seconds.\r\n2020-04-16 22:32:23,162 - google.cloud.pubsub_v1.subscriber._protocol.leaser - DEBUG - The current deadline value is 10 seconds.\r\n2020-04-16 22:32:23,162 - google.cloud.pubsub_v1.subscriber._protocol.leaser - DEBUG - Snoozing lease management for 7.803144 seconds.\r\n2020-04-16 22:32:30,396 - google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager - INFO - Observed non-terminating stream error 504 Deadline Exceeded\r\n2020-04-16 22:32:30,463 - google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager - INFO - Observed recoverable stream error 504 Deadline Exceeded\r\n2020-04-16 22:32:30,463 - google.api_core.bidi - DEBUG - Re-opening stream from gRPC callback.\r\n2020-04-16 22:32:30,544 - google.api_core.bidi - DEBUG - Empty queue and inactive call, exiting request generator.\r\n2020-04-16 22:32:30,970 - google.cloud.pubsub_v1.subscriber._protocol.leaser - DEBUG - The current deadline value is 10 seconds.\r\n2020-04-16 22:32:30,970 - google.cloud.pubsub_v1.subscriber._protocol.leaser - DEBUG - Snoozing lease management for 8.288502 seconds.\r\n```\r\n\r\nIs this an expected behavior change?\r\n\r\nThanks", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/77", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/77/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/77/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/77/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/77", "id": 601291263, "node_id": "MDU6SXNzdWU2MDEyOTEyNjM=", "number": 77, "title": "Pin dependencies to minor versions", "user": {"login": "kamalaboulhosn", "id": 3820277, "node_id": "MDQ6VXNlcjM4MjAyNzc=", "avatar_url": "https://avatars1.githubusercontent.com/u/3820277?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kamalaboulhosn", "html_url": "https://github.com/kamalaboulhosn", "followers_url": "https://api.github.com/users/kamalaboulhosn/followers", "following_url": "https://api.github.com/users/kamalaboulhosn/following{/other_user}", "gists_url": "https://api.github.com/users/kamalaboulhosn/gists{/gist_id}", "starred_url": "https://api.github.com/users/kamalaboulhosn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kamalaboulhosn/subscriptions", "organizations_url": "https://api.github.com/users/kamalaboulhosn/orgs", "repos_url": "https://api.github.com/users/kamalaboulhosn/repos", "events_url": "https://api.github.com/users/kamalaboulhosn/events{/privacy}", "received_events_url": "https://api.github.com/users/kamalaboulhosn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-04-16T18:00:28Z", "updated_at": "2020-04-30T18:25:25Z", "closed_at": "2020-04-30T18:25:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In an attempt to minimize issues caused by bad minor releases in dependencies and to make the rollback procedure for customers easier, we should pin dependencies to a minor version. When new minor versions are released, we should increase the pinned minor version to match the new version in a PR and release a new version of the Pub/Sub client library. If there is no new code in the library, but there are new dependency minor version increments, we should release a new version at least once a month. It is fine to release at a faster cadence than that if desired. This is how things work in the Java library and in fact, the minor version increase PRs are automatically generated. Perhaps thy could be auto generated in Python as well.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/74", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/74/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/74/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/74/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/74", "id": 600813839, "node_id": "MDU6SXNzdWU2MDA4MTM4Mzk=", "number": 74, "title": "Deadlock in streaming_pull_manager and ResumableBidiRpc after receiving 504 deadline exceeded error", "user": {"login": "sweatybridge", "id": 1639722, "node_id": "MDQ6VXNlcjE2Mzk3MjI=", "avatar_url": "https://avatars3.githubusercontent.com/u/1639722?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sweatybridge", "html_url": "https://github.com/sweatybridge", "followers_url": "https://api.github.com/users/sweatybridge/followers", "following_url": "https://api.github.com/users/sweatybridge/following{/other_user}", "gists_url": "https://api.github.com/users/sweatybridge/gists{/gist_id}", "starred_url": "https://api.github.com/users/sweatybridge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sweatybridge/subscriptions", "organizations_url": "https://api.github.com/users/sweatybridge/orgs", "repos_url": "https://api.github.com/users/sweatybridge/repos", "events_url": "https://api.github.com/users/sweatybridge/events{/privacy}", "received_events_url": "https://api.github.com/users/sweatybridge/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2020-04-16T07:34:13Z", "updated_at": "2020-04-21T09:59:33Z", "closed_at": "2020-04-16T17:18:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### Environment details\r\n\r\n  - OS type and version: alpine 3.11\r\n  - Python version: 3.7.7\r\n  - pip version: 20.0.2\r\n  - `google-cloud-pubsub` version: 1.4.2\r\n\r\n#### Steps to reproduce\r\n\r\n  1. Start subscriber client\r\n  2. Wait for 10 minutes (server should return 504 Deadline Exceeded error)\r\n  3. Messages no longer received and heartbeat no longer sent\r\n\r\nHere are the debug logs just after 10 mins.\r\n```\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:The current deadline value is 10 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:Snoozing lease management for 7.152175 seconds.\r\nINFO:google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager:Observed non-terminating stream error 504 Deadline Exceeded\r\nINFO:google.cloud.pubsub_v1.subscriber._protocol.streaming_pull_manager:Observed recoverable stream error 504 Deadline Exceeded\r\nDEBUG:google.api_core.bidi:Re-opening stream from gRPC callback.\r\nDEBUG:google.api_core.bidi:Empty queue and inactive call, exiting request generator.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:The current deadline value is 10 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:Snoozing lease management for 4.379558 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:The current deadline value is 10 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:Snoozing lease management for 7.720803 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:The current deadline value is 10 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:Snoozing lease management for 3.224825 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:The current deadline value is 10 seconds.\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:Snoozing lease management for 0.857948 seconds.\r\n```\r\n\r\nLooking at the logs, I'm expected to see `_LOGGER.debug(\"Call to retryable %r caused %s.\", method, exc)` since it should be printed on error https://github.com/googleapis/python-api-core/blob/5e5559202891f7e5b6c22c2cbc549e1ec26eb857/google/api_core/bidi.py#L508. However, the message was not printed so the thread was stuck acquiring `self._operational_lock`.\r\n\r\nI've sampled the top functions running on all threads after getting into the deadlock state (attached as stacktrace below). The heartbeater's background thread seems to be frequently holding the lock as it performs the `is_active` check https://github.com/googleapis/python-pubsub/blob/master/google/cloud/pubsub_v1/subscriber/_protocol/streaming_pull_manager.py#L425. I'm not sure why it's not being released.\r\n\r\n#### Code example\r\n\r\n```python\r\nimport logging\r\n\r\nfrom google.cloud.pubsub_v1 import SubscriberClient\r\n\r\n\r\ndef main():\r\n    logging.basicConfig(level=logging.DEBUG)\r\n\r\n    client = SubscriberClient()\r\n    sub = client.subscription_path(\"project\", \"subscription\")\r\n\r\n    def callback(message):\r\n        print(message)\r\n        message.ack()\r\n\r\n    future = client.subscribe(sub, callback)\r\n\r\n    try:\r\n        future.result()\r\n    except KeyboardInterrupt:\r\n        future.cancel()\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\n#### Stack trace\r\n```\r\nCollecting samples from 'python main.py' (python v3.7.7)\r\nTotal Samples 2000\r\nGIL: 0.00%, Active: 12.00%, Threads: 17\r\n\r\n  %Own   %Total  OwnTime  TotalTime  Function (filename:line)\r\n 10.00%  10.00%    1.94s     1.94s   _worker (concurrent/futures/thread.py:78)\r\n  2.00%   2.00%   0.640s    0.640s   _recoverable (api_core/bidi.py:508)\r\n  0.00%   0.00%   0.330s    0.330s   is_active (api_core/bidi.py:578)\r\n  0.00%   0.00%   0.000s    0.330s   heartbeat (pubsub_v1/subscriber/_protocol/streaming_pull_manager.py:425)\r\n  0.00%  12.00%   0.000s     2.91s   _bootstrap (threading.py:890)\r\n  0.00%  12.00%   0.000s     2.91s   _bootstrap_inner (threading.py:926)\r\n  0.00%   2.00%   0.000s    0.640s   recv (api_core/bidi.py:562)\r\n  0.00%  12.00%   0.000s     2.91s   run (threading.py:870)\r\n  0.00%   0.00%   0.000s    0.330s   heartbeat (pubsub_v1/subscriber/_protocol/heartbeater.py:40)\r\n  0.00%   2.00%   0.000s    0.640s   _thread_main (api_core/bidi.py:655)\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/75", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/75/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/75/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/75/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/75", "id": 600871741, "node_id": "MDU6SXNzdWU2MDA4NzE3NDE=", "number": 75, "title": "PubSub: Subscriber keeps failing with 503", "user": {"login": "tameem92", "id": 3446274, "node_id": "MDQ6VXNlcjM0NDYyNzQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/3446274?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tameem92", "html_url": "https://github.com/tameem92", "followers_url": "https://api.github.com/users/tameem92/followers", "following_url": "https://api.github.com/users/tameem92/following{/other_user}", "gists_url": "https://api.github.com/users/tameem92/gists{/gist_id}", "starred_url": "https://api.github.com/users/tameem92/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tameem92/subscriptions", "organizations_url": "https://api.github.com/users/tameem92/orgs", "repos_url": "https://api.github.com/users/tameem92/repos", "events_url": "https://api.github.com/users/tameem92/events{/privacy}", "received_events_url": "https://api.github.com/users/tameem92/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-04-16T03:04:41Z", "updated_at": "2020-04-16T17:18:06Z", "closed_at": "2020-04-16T17:18:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey guys, \r\n\r\nI am seeing the pubsub client receive a 503 unavailable and instead of retrying it just exits. And it can't receive any more messages. The subscriber starts and works for a few minutes before throwing the error. I can reproduce it consistently with multiple different pubsub subscriptions. \r\n\r\n**Package**: google-cloud-pubsub==1.4.2\r\n**OS**: Mac Catalina, also tried on an Ubuntu VM. \r\n**Python**: Python 3.7.3\r\n\r\n\r\nHere is an example test case where I see the issue followed by a stack trace: \r\n\r\n```\r\nimport os\r\nimport json\r\nfrom time import sleep\r\nfrom datetime import datetime\r\nimport logging\r\nfrom google.cloud import pubsub_v1\r\nfrom config import Config\r\n\r\nlogging.basicConfig()\r\nlogging.getLogger().setLevel(logging.DEBUG)\r\n\r\ndef _callback(message):\r\n    try:\r\n        print('message', message)\r\n    except Exception:\r\n        print('exception')\r\n\r\nif __name__ == '__main__':\r\n\r\n    subscription = pubsub_v1.SubscriberClient()\r\n    subscription_path = subscription.subscription_path(\r\n        Config.PROJECT_ID,\r\n        Config.PUBSUB_SUB_NAME)\r\n\r\n\r\n    future = subscription.subscribe(\r\n        subscription_path,\r\n        _callback,\r\n        pubsub_v1.types.FlowControl(max_messages=Config.MAX_MESSAGES))\r\n\r\n    try:\r\n        future.result()\r\n    \r\n    except KeyboardInterrupt:\r\n        future.cancel()\r\n        logging.error(\"Keyboard Interrupt\")\r\n    \r\n    except Exception:\r\n        raise\r\n\r\n```\r\n\r\nAnd stack trace - \r\n\r\n```\r\nDEBUG:google.cloud.pubsub_v1.subscriber._protocol.leaser:Snoozing lease management for 8.538204 seconds.\r\nDEBUG:google.api_core.bidi:Thread-ConsumeBidirectionalStream caught error 503 The service was unable to fulfill your request. Please try again. [code=8a75] and will exit. Generally this is due to the RPC itself being cancelled and the error will be surfaced to the calling code.\r\nTraceback (most recent call last):\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/grpc_helpers.py\", line 144, in error_remapped_callable\r\n    return _StreamingResponseIterator(result)\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/grpc_helpers.py\", line 72, in __init__\r\n    self._stored_first_result = six.next(self._wrapped)\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/grpc/_channel.py\", line 416, in __next__\r\n    return self._next()\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/grpc/_channel.py\", line 706, in _next\r\n    raise self\r\ngrpc._channel._MultiThreadedRendezvous: <_MultiThreadedRendezvous of RPC that terminated with:\r\n\tstatus = StatusCode.UNAVAILABLE\r\n\tdetails = \"The service was unable to fulfill your request. Please try again. [code=8a75]\"\r\n\tdebug_error_string = \"{\"created\":\"@1587006128.267570000\",\"description\":\"Error received from peer ipv6:[]:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1056,\"grpc_message\":\"The service was unable to fulfill your request. Please try again. [code=8a75]\",\"grpc_status\":14}\"\r\n>\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/bidi.py\", line 637, in _thread_main\r\n    self._bidi_rpc.open()\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/bidi.py\", line 280, in open\r\n    call = self._start_rpc(iter(request_generator), metadata=self._rpc_metadata)\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/cloud/pubsub_v1/gapic/subscriber_client.py\", line 1059, in streaming_pull\r\n    requests, retry=retry, timeout=timeout, metadata=metadata\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/gapic_v1/method.py\", line 143, in __call__\r\n    return wrapped_func(*args, **kwargs)\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/retry.py\", line 286, in retry_wrapped_func\r\n    on_error=on_error,\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/retry.py\", line 184, in retry_target\r\n    return target()\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/timeout.py\", line 214, in func_with_timeout\r\n    return func(*args, **kwargs)\r\n  File \"/Users/tameem/pubsub-test/env/lib/python3.7/site-packages/google/api_core/grpc_helpers.py\", line 146, in error_remapped_callable\r\n    six.raise_from(exceptions.from_grpc_error(exc), exc)\r\n  File \"<string>\", line 3, in raise_from\r\ngoogle.api_core.exceptions.ServiceUnavailable: 503 The service was unable to fulfill your request. Please try again. [code=8a75]\r\nINFO:google.api_core.bidi:Thread-ConsumeBidirectionalStream exiting\r\nINFO:google.cloud.pubsub_v1.subscriber._protocol.leaser:Thread-LeaseMaintainer exiting.\r\nINFO:google.cloud.pubsub_v1.subscriber._protocol.heartbeater:Thread-Heartbeater exiting.\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/73", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/73/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/73/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/73/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/73", "id": 600418726, "node_id": "MDU6SXNzdWU2MDA0MTg3MjY=", "number": 73, "title": "Pubsub client is not correctly acknowledging the messages when sending acks in batches", "user": {"login": "immohsin", "id": 14070273, "node_id": "MDQ6VXNlcjE0MDcwMjcz", "avatar_url": "https://avatars1.githubusercontent.com/u/14070273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/immohsin", "html_url": "https://github.com/immohsin", "followers_url": "https://api.github.com/users/immohsin/followers", "following_url": "https://api.github.com/users/immohsin/following{/other_user}", "gists_url": "https://api.github.com/users/immohsin/gists{/gist_id}", "starred_url": "https://api.github.com/users/immohsin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/immohsin/subscriptions", "organizations_url": "https://api.github.com/users/immohsin/orgs", "repos_url": "https://api.github.com/users/immohsin/repos", "events_url": "https://api.github.com/users/immohsin/events{/privacy}", "received_events_url": "https://api.github.com/users/immohsin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2020-04-15T16:12:26Z", "updated_at": "2020-04-20T07:40:20Z", "closed_at": "2020-04-20T07:40:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "Google Cloud service stack I use is  Bigquery, Cloud Function, Pubsub and Cloud Scheduler. I try to process all messages in pubsub using Cloud Function and ingest them to Bigquery all at once at the end of subscription timeout and if all went good I send the acknowledgement. But in recent days, The number of messages on pubsub is growing and I have increased the frequency of cloud function scheduling and implemented sending data in batch to Bigquery since the bigquery python client has a limit on bytes you can send at once. It works good and inserts the data in Bigquery But when it comes to sending acks almost half of the messages are not getting correctly acknowledged and sometimes no messages get acknowledged. My pubsub ack deadline is 600 seconds. \r\n\r\n#### Environment details\r\nI'm working on my system with below configuration.\r\n\r\n  - OS type and version: macOS High Sierra\r\n  - Python version: `Python 3.6.5`\r\n  - pip version: `pip 20.0.2`\r\n  - `google-cloud-pubsub` version: `1.1.0`\r\n\r\n#### Steps to reproduce\r\n\r\n  1. Insert the data to Bigquery in batch\r\n  2. Send acks to only those messages which got inserted in the batch\r\n\r\n#### Code example\r\nCode Sample\r\n\r\n```python\r\nSUBSCRIPTION_TIMEOUT = 420.0\r\n\r\ndef ingest_to_bq(data, acks, valid_data):\r\n    table = TABLE if valid_data else INVALID_TABLE\r\n    start, end = 0, EVENT_CHUNK_SIZE\r\n    data_len = len(data)\r\n    print(\"Total data size:\", data_len)\r\n    while(start < data_len):\r\n        chunked_data = data[start:end]\r\n        chunked_ack_ids = acks[start:end]\r\n        errors = bigquery_client.insert_rows(table, chunked_data)\r\n        if len(errors):\r\n            print(\"Error inserting app events to bigquery\", file=sys.stderr)\r\n            break\r\n        else:\r\n            print(\"Successfully inserted {count} app events data to bigquery\".format(  # noqa\r\n                count=len(chunked_data))\r\n            )\r\n            pubsub_client.acknowledge(subscription_path, chunked_ack_ids)\r\n            start += EVENT_CHUNK_SIZE\r\n            end += EVENT_CHUNK_SIZE\r\n\r\ndef bq_ingestion_process(valid_data=True):\r\n    data = MESSAGE_LIST if valid_data else INVALID_MESSAGE_LIST\r\n    ack_ids = MESSAGE_ACK_LIST if valid_data else INVALID_MESSAGE_ACK_LIST\r\n    ingest_to_bq(data, ack_ids, valid_data)\r\n\r\ndef main(request):\r\n    streaming_pull_future = pubsub_client.subscribe(\r\n        subscription_path, callback=streaming_subscriber_callback\r\n    )\r\n\r\n    print(\"Listening for messages on {}...\".format(subscription_path))\r\n\r\n    try:\r\n        streaming_pull_future.result(timeout=SUBSCRIPTION_TIMEOUT)\r\n    except Exception:\r\n        streaming_pull_future.cancel()\r\n    finally:\r\n        # ingest entire data to bigquery after timeout.\r\n        if MESSAGE_ACK_LIST:\r\n            bq_ingestion_process()\r\n        if INVALID_MESSAGE_ACK_LIST:\r\n            bq_ingestion_process(valid_data=False)\r\n```\r\n\r\nThanks!\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/72", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/72/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/72/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/72/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/72", "id": 599622953, "node_id": "MDU6SXNzdWU1OTk2MjI5NTM=", "number": 72, "title": "PubSub Publisher 504 Deadline Exceeded when sending bulk messages", "user": {"login": "dillonjohnson", "id": 15899374, "node_id": "MDQ6VXNlcjE1ODk5Mzc0", "avatar_url": "https://avatars0.githubusercontent.com/u/15899374?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dillonjohnson", "html_url": "https://github.com/dillonjohnson", "followers_url": "https://api.github.com/users/dillonjohnson/followers", "following_url": "https://api.github.com/users/dillonjohnson/following{/other_user}", "gists_url": "https://api.github.com/users/dillonjohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/dillonjohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dillonjohnson/subscriptions", "organizations_url": "https://api.github.com/users/dillonjohnson/orgs", "repos_url": "https://api.github.com/users/dillonjohnson/repos", "events_url": "https://api.github.com/users/dillonjohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/dillonjohnson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2020-04-14T14:37:23Z", "updated_at": "2020-06-02T19:09:12Z", "closed_at": "2020-06-02T19:09:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### Environment details\r\n\r\n  - OS type and version: `PRETTY_NAME=\"Debian GNU/Linux 10 (buster)\"`\r\n  - Python version: `python --version` python3.7\r\n  - pip version: `pip --version`  20.0.2\r\n  - `google-cloud-pubsub` version: `pip show google-cloud-pubsub` 1.4.2\r\n\r\n#### Steps to reproduce\r\n\r\n  1. Send large number of messages to a PubSub Topic fails when I try to send 5000 without pausing and waiting, for example.\r\n  2. Check logs\r\n\r\n#### Code example\r\n\r\n```python\r\n# I have also tried this using the callback and hit the same error. This is what I'm doing now though.\r\niter_size = 5000\r\niter_count = 0\r\nfutures = []\r\nfor row in rows:\r\n     data = json.dumps(row, default=lambda x: str(x)).encode('utf-8')\r\n     future = publish_client.publish(topic, data, origin='xxx')\r\n     futures.append(future)\r\n     published_count += 1\r\n     iter_count += 1\r\n     if iter_count >= iter_size:\r\n           [f.result() for f in futures]\r\n           futures = []\r\n           iter_count = 0\r\n     count += 1\r\n     [f.result() for f in futures]\r\n```\r\n\r\n#### Stack trace\r\n```\r\n[2020-04-14 14:19:23,788] {{thread.py:264}} ERROR - Failed to publish 141 messages.\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python3.7/site-packages/google/api_core/grpc_helpers.py\", line 57, in error_remapped_callable\r\n     return callable_(*args, **kwargs)\r\n   File \"/usr/local/lib/python3.7/site-packages/grpc/_channel.py\", line 826, in __call__\r\n     return _end_unary_response_blocking(state, call, False, None)\r\n   File \"/usr/local/lib/python3.7/site-packages/grpc/_channel.py\", line 729, in _end_unary_response_blocking\r\n     raise _InactiveRpcError(state)\r\n grpc._channel._InactiveRpcError: <_InactiveRpcError of RPC that terminated with:\r\n \tstatus = StatusCode.DEADLINE_EXCEEDED\r\n \tdetails = \"Deadline Exceeded\"\r\n \tdebug_error_string = \"{\"created\":\"@1586873963.056617563\",\"description\":\"Error received from peer ipv4:108.177.122.95:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1056,\"grpc_message\":\"Deadline Exceeded\",\"grpc_status\":4}\"\r\n >\r\n```\r\n\r\nOther Details:\r\n\r\nI've found a similar issue here \r\nhttps://github.com/googleapis/google-cloud-java/issues/3867\r\n\r\nWhich references to this issue\r\nhttps://github.com/googleapis/google-cloud-java/issues/3003\r\n\r\nThen\r\nhttps://github.com/googleapis/java-pubsub/issues/31\r\n\r\nThis will normally be running on GKE, so I understand me running it locally may have some variation of behavior due to network speed. However, we would prefer to avoid having this issue either way.\r\n\r\nIs this something that is planned/intended to be supported or should I implement auto-throttling?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/69", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/69/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/69/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/69/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/69", "id": 597217792, "node_id": "MDU6SXNzdWU1OTcyMTc3OTI=", "number": 69, "title": "Building the docs breaks (unexpected unindent)", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-04-09T11:31:04Z", "updated_at": "2020-04-09T16:32:47Z", "closed_at": "2020-04-09T16:32:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I noticed that building the docs locally on master fails due to the following error:\r\n\r\n> sphinx.errors.SphinxWarning: <workspace_dir>/python-pubsub/docs/changelog.md:416:Bullet list ends without a blank line; unexpected unindent.\r\n\r\nHowever, it turns out that the issue does not occur with the older version of Sphinx (< 3.x), ~~thus it appears as a bug in the Sphinx package itself~~. A workaround is to pin that dependency to an older version, but preferably all new warnings emitted in Sphinx 3.x should be addressed at their sources.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/68", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/68/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/68/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/68/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/68", "id": 596573716, "node_id": "MDU6SXNzdWU1OTY1NzM3MTY=", "number": 68, "title": "Pubsub requires grpcio package without compiled wheel", "user": {"login": "shaibt", "id": 25963448, "node_id": "MDQ6VXNlcjI1OTYzNDQ4", "avatar_url": "https://avatars2.githubusercontent.com/u/25963448?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shaibt", "html_url": "https://github.com/shaibt", "followers_url": "https://api.github.com/users/shaibt/followers", "following_url": "https://api.github.com/users/shaibt/following{/other_user}", "gists_url": "https://api.github.com/users/shaibt/gists{/gist_id}", "starred_url": "https://api.github.com/users/shaibt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shaibt/subscriptions", "organizations_url": "https://api.github.com/users/shaibt/orgs", "repos_url": "https://api.github.com/users/shaibt/repos", "events_url": "https://api.github.com/users/shaibt/events{/privacy}", "received_events_url": "https://api.github.com/users/shaibt/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 19, "created_at": "2020-04-08T12:10:15Z", "updated_at": "2020-07-08T01:15:29Z", "closed_at": "2020-06-23T04:08:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### Environment details\r\n\r\nPubsub: google-cloud-pubsub 1.0.2\r\n\r\nPython 3.6.3\r\n\r\nGoogle App Engine flex python\r\n\r\n#### Steps to reproduce\r\n\r\ngoogle-cloud-pubsub requires the grpcio package w/o locking a specific version.\r\n\r\nOn April 3rd a [new grpcio version](https://pypi.org/project/grpcio/1.28.1/#files) was released w/o a pre-compiled wheel - v 1.28.1\r\n\r\nSince the new grpcio package release, GAE flex python deploys (using GAE default image) requiring google-cloud-pubsub are **timing out** because the grpcio package is being compiled during deploy time - which takes 8+ minutes.\r\n\r\ngoogle-cloud-pubsub should either lock to a specific grpcio version - one with a compiled wheel - or use a relevant pip flag to make sure it uses the latest compiled wheel available.\r\n\r\nDoesn't make sense for GAE deploys to timeout because of this.\r\nIssueTracker was opened here: https://issuetracker.google.com/issues/153468670\r\n\r\n \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/67", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/67/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/67/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/67/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/67", "id": 596236992, "node_id": "MDU6SXNzdWU1OTYyMzY5OTI=", "number": 67, "title": "pylint: Instance of 'SubscriberClient' has no 'subscription_path' member", "user": {"login": "dinvlad", "id": 137337, "node_id": "MDQ6VXNlcjEzNzMzNw==", "avatar_url": "https://avatars2.githubusercontent.com/u/137337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dinvlad", "html_url": "https://github.com/dinvlad", "followers_url": "https://api.github.com/users/dinvlad/followers", "following_url": "https://api.github.com/users/dinvlad/following{/other_user}", "gists_url": "https://api.github.com/users/dinvlad/gists{/gist_id}", "starred_url": "https://api.github.com/users/dinvlad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dinvlad/subscriptions", "organizations_url": "https://api.github.com/users/dinvlad/orgs", "repos_url": "https://api.github.com/users/dinvlad/repos", "events_url": "https://api.github.com/users/dinvlad/events{/privacy}", "received_events_url": "https://api.github.com/users/dinvlad/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": {"login": "anguillanneuf", "id": 9518298, "node_id": "MDQ6VXNlcjk1MTgyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9518298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anguillanneuf", "html_url": "https://github.com/anguillanneuf", "followers_url": "https://api.github.com/users/anguillanneuf/followers", "following_url": "https://api.github.com/users/anguillanneuf/following{/other_user}", "gists_url": "https://api.github.com/users/anguillanneuf/gists{/gist_id}", "starred_url": "https://api.github.com/users/anguillanneuf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anguillanneuf/subscriptions", "organizations_url": "https://api.github.com/users/anguillanneuf/orgs", "repos_url": "https://api.github.com/users/anguillanneuf/repos", "events_url": "https://api.github.com/users/anguillanneuf/events{/privacy}", "received_events_url": "https://api.github.com/users/anguillanneuf/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "anguillanneuf", "id": 9518298, "node_id": "MDQ6VXNlcjk1MTgyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9518298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anguillanneuf", "html_url": "https://github.com/anguillanneuf", "followers_url": "https://api.github.com/users/anguillanneuf/followers", "following_url": "https://api.github.com/users/anguillanneuf/following{/other_user}", "gists_url": "https://api.github.com/users/anguillanneuf/gists{/gist_id}", "starred_url": "https://api.github.com/users/anguillanneuf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anguillanneuf/subscriptions", "organizations_url": "https://api.github.com/users/anguillanneuf/orgs", "repos_url": "https://api.github.com/users/anguillanneuf/repos", "events_url": "https://api.github.com/users/anguillanneuf/events{/privacy}", "received_events_url": "https://api.github.com/users/anguillanneuf/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2020-04-08T00:54:45Z", "updated_at": "2020-04-16T12:49:39Z", "closed_at": "2020-04-14T23:05:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### Environment details\r\n\r\n  - OS type and version: macOS Mojave 10.14.6\r\n  - Python version: `python --version` 3.7.7\r\n  - pip version: `pip --version` 20.0.2\r\n  - `google-cloud-pubsub` version: `pip show google-cloud-pubsub` 1.4.2\r\n\r\n#### Steps to reproduce\r\n\r\n  1. Use the stock subscription example from https://github.com/googleapis/python-pubsub/blob/master/docs/subscriber/index.rst\r\n  2. Running `pylint` on it results in:\r\n```\r\nE1101: Instance of 'SubscriberClient' has no 'subscription_path' member (no-member)\r\n```\r\n\r\n#### Code example\r\n\r\n```py3\r\nfrom google.cloud import pubsub\r\nsubscriber = pubsub.SubscriberClient()\r\n\r\nsub_path = subscriber.subscription_path(PROJECT, SUBSCRIPTION)\r\n```\r\n\r\n#### Stack trace\r\nN/A\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/65", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/65/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/65/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/65/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/65", "id": 592774445, "node_id": "MDU6SXNzdWU1OTI3NzQ0NDU=", "number": 65, "title": "Monitoring batching", "user": {"login": "antoine-gallix", "id": 7696611, "node_id": "MDQ6VXNlcjc2OTY2MTE=", "avatar_url": "https://avatars0.githubusercontent.com/u/7696611?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antoine-gallix", "html_url": "https://github.com/antoine-gallix", "followers_url": "https://api.github.com/users/antoine-gallix/followers", "following_url": "https://api.github.com/users/antoine-gallix/following{/other_user}", "gists_url": "https://api.github.com/users/antoine-gallix/gists{/gist_id}", "starred_url": "https://api.github.com/users/antoine-gallix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antoine-gallix/subscriptions", "organizations_url": "https://api.github.com/users/antoine-gallix/orgs", "repos_url": "https://api.github.com/users/antoine-gallix/repos", "events_url": "https://api.github.com/users/antoine-gallix/events{/privacy}", "received_events_url": "https://api.github.com/users/antoine-gallix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2020-04-02T16:47:55Z", "updated_at": "2020-04-03T22:37:44Z", "closed_at": "2020-04-03T21:56:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've read that the pubsub client does some batching, and for what I've understood, sending of a batch is triggered once one of the three parameters is exceeded: number of messages, time since first message of the batch and size of the batch. I want to increase the speed of sending of messages to the pubsub but I don't know how to tune those parameters. Which limiting factor triggers the batches that I'm sending? How can I monitor the number of messages, size and timing of the batches the client is sending to figure this out?\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/64", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/64/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/64/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/64/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/64", "id": 591023066, "node_id": "MDU6SXNzdWU1OTEwMjMwNjY=", "number": 64, "title": "shutdown error on streaming pull callback error ", "user": {"login": "kthulsidoss", "id": 42998906, "node_id": "MDQ6VXNlcjQyOTk4OTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/42998906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kthulsidoss", "html_url": "https://github.com/kthulsidoss", "followers_url": "https://api.github.com/users/kthulsidoss/followers", "following_url": "https://api.github.com/users/kthulsidoss/following{/other_user}", "gists_url": "https://api.github.com/users/kthulsidoss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kthulsidoss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kthulsidoss/subscriptions", "organizations_url": "https://api.github.com/users/kthulsidoss/orgs", "repos_url": "https://api.github.com/users/kthulsidoss/repos", "events_url": "https://api.github.com/users/kthulsidoss/events{/privacy}", "received_events_url": "https://api.github.com/users/kthulsidoss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-03-31T11:21:13Z", "updated_at": "2020-04-03T10:52:02Z", "closed_at": "2020-04-03T10:52:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi @plamut , i recall encountering error on streaming pull callback error  (#40) . I know this is fixed .\r\nI received this again in using asynchronous call ? do i need to use a different version for this fix ?\r\nThanks\r\nK.thulsi Doss", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/63", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/63/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/63/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/63/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/63", "id": 590167875, "node_id": "MDU6SXNzdWU1OTAxNjc4NzU=", "number": 63, "title": "Need help to clear messages based on time parameter", "user": {"login": "kthulsidoss", "id": 42998906, "node_id": "MDQ6VXNlcjQyOTk4OTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/42998906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kthulsidoss", "html_url": "https://github.com/kthulsidoss", "followers_url": "https://api.github.com/users/kthulsidoss/followers", "following_url": "https://api.github.com/users/kthulsidoss/following{/other_user}", "gists_url": "https://api.github.com/users/kthulsidoss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kthulsidoss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kthulsidoss/subscriptions", "organizations_url": "https://api.github.com/users/kthulsidoss/orgs", "repos_url": "https://api.github.com/users/kthulsidoss/repos", "events_url": "https://api.github.com/users/kthulsidoss/events{/privacy}", "received_events_url": "https://api.github.com/users/kthulsidoss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-03-30T10:14:25Z", "updated_at": "2020-05-27T23:53:27Z", "closed_at": "2020-05-27T23:53:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "Google Support : After overcoming 504 deadline issue by updating the client python code , there is a need for way to clear the messages that are sitting in the publisher and getting piled up. We would need for a way to clear these messages if there are let us say more than 2 messages that are sitting for processing for over x seconds . \r\nThanks in advance", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/62", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/62/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/62/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/62/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/62", "id": 588476084, "node_id": "MDU6SXNzdWU1ODg0NzYwODQ=", "number": 62, "title": "Send client id with StreamingPullRequest", "user": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-03-26T14:45:22Z", "updated_at": "2020-04-22T11:02:06Z", "closed_at": "2020-04-22T11:02:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "- The client id should be created randomly for each StreamingPullManager and will be used to establish affinity across stream disconnections/retries.\r\n- Server-client affinity is important for ordering keys, where the backend tries to send the same keys to the same client.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/61", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/61/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/61/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/61/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/61", "id": 588008011, "node_id": "MDU6SXNzdWU1ODgwMDgwMTE=", "number": 61, "title": "The client_options.api_endpoint parameter is being ignored in both PublisherClient and SubscriberClient", "user": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-03-25T21:40:40Z", "updated_at": "2020-03-25T22:08:05Z", "closed_at": "2020-03-25T22:08:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This bug prevents users from using regional endpoints. It also makes it harder to test code against nonprod endpoints.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/60", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/60/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/60/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/60/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/60", "id": 587894573, "node_id": "MDU6SXNzdWU1ODc4OTQ1NzM=", "number": 60, "title": "Is implementing exponential backoff a valid use case for message.drop()?", "user": {"login": "chrisfrank", "id": 324705, "node_id": "MDQ6VXNlcjMyNDcwNQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/324705?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chrisfrank", "html_url": "https://github.com/chrisfrank", "followers_url": "https://api.github.com/users/chrisfrank/followers", "following_url": "https://api.github.com/users/chrisfrank/following{/other_user}", "gists_url": "https://api.github.com/users/chrisfrank/gists{/gist_id}", "starred_url": "https://api.github.com/users/chrisfrank/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chrisfrank/subscriptions", "organizations_url": "https://api.github.com/users/chrisfrank/orgs", "repos_url": "https://api.github.com/users/chrisfrank/repos", "events_url": "https://api.github.com/users/chrisfrank/events{/privacy}", "received_events_url": "https://api.github.com/users/chrisfrank/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2020-03-25T18:15:58Z", "updated_at": "2020-06-29T21:16:11Z", "closed_at": "2020-03-27T16:38:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "First, thanks for such a stable and robust client library. It's powering much of The New York Times photo archive :)\r\n\r\nOur team is trying to implement exponential backoff when retrying `StreamingPullFuture` callbacks that have failed unexpectedly. One solution under consideration relies on the `drop()` method of `google.cloud.pubsub_v1.subscriber.message.Message` \u2014\u00a0but the docs [warn against using this method](https://googleapis.dev/python/pubsub/latest/subscriber/api/message.html?highlight=drop#google.cloud.pubsub_v1.subscriber.message.Message.drop),  so @michaelplaing and I were wondering if the following (abbreviated) implementation is a valid use case:\r\n\r\n```python\r\n def retry(msg: pubsub_v1.subscriber.message.Message) -> None:\r\n        delay_seconds = calculate_delay_seconds_from_failure_count(msg)  # omitted\r\n        msg.modify_ack_deadline(delay_seconds)\r\n        msg.drop()\r\n```\r\n\r\nWithout the call to `msg.drop()`, the client seems to block this thread until the new ack deadline arrives. We would, ideally, like to release the thread so that the client's Scheduler can continue to dispatch other messages to it. It seems like `drop()` is doing the trick \u2014 we just want to make sure this is the expected behavior and safe to rely on. Thanks!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/52", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/52/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/52/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/52/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/52", "id": 586093599, "node_id": "MDU6SXNzdWU1ODYwOTM1OTk=", "number": 52, "title": "Add test for 504 DeadlineExceeded for synchronous pull without published messages", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819579033, "node_id": "MDU6TGFiZWwxODE5NTc5MDMz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/testing", "name": "testing", "color": "bfdadc", "default": false, "description": ""}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-03-23T10:19:28Z", "updated_at": "2020-03-24T17:25:01Z", "closed_at": "2020-03-24T17:25:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Related to #47 and the [pull request](https://github.com/googleapis/python-pubsub/pull/43) that will fix it.\r\n\r\nWe should cover the fix with a system test to detect if a regression occurs again.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/50", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/50/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/50/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/50/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/50", "id": 586089242, "node_id": "MDU6SXNzdWU1ODYwODkyNDI=", "number": 50, "title": "chore: group RBAC system tests into their own suite", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819579033, "node_id": "MDU6TGFiZWwxODE5NTc5MDMz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/testing", "name": "testing", "color": "bfdadc", "default": false, "description": ""}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-03-23T10:12:59Z", "updated_at": "2020-03-24T17:57:58Z", "closed_at": "2020-03-24T17:57:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Currently all RBAC system tests are placed under the `TestStreamingPull` class, even if they don't use streaming pull at all. These tests should be moved to their own class.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/48", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/48/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/48/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/48/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/48", "id": 584619838, "node_id": "MDU6SXNzdWU1ODQ2MTk4Mzg=", "number": 48, "title": "asserting throwing for async publish with currently errored batch", "user": {"login": "camerondavison", "id": 165381, "node_id": "MDQ6VXNlcjE2NTM4MQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/165381?v=4", "gravatar_id": "", "url": "https://api.github.com/users/camerondavison", "html_url": "https://github.com/camerondavison", "followers_url": "https://api.github.com/users/camerondavison/followers", "following_url": "https://api.github.com/users/camerondavison/following{/other_user}", "gists_url": "https://api.github.com/users/camerondavison/gists{/gist_id}", "starred_url": "https://api.github.com/users/camerondavison/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/camerondavison/subscriptions", "organizations_url": "https://api.github.com/users/camerondavison/orgs", "repos_url": "https://api.github.com/users/camerondavison/repos", "events_url": "https://api.github.com/users/camerondavison/events{/privacy}", "received_events_url": "https://api.github.com/users/camerondavison/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2020-03-19T18:39:43Z", "updated_at": "2020-03-23T21:44:44Z", "closed_at": "2020-03-23T18:16:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### Environment details\r\n\r\n  - OS type and version: linux\r\n  - Python version: `python --version` : Python 3.7.6\r\n  - pip version: `pip --version` :  pip 19.3.1\r\n  - `google-cloud-pubsub` version: `pip show google-cloud-pubsub` 1.3.1\r\n\r\n#### Code example\r\n\r\n```python\r\nfrom google.cloud import pubsub_v1\r\nimport time\r\n\r\n\r\ndef main():\r\n    publisher = pubsub_v1.PublisherClient()\r\n    topic_path = \"projects/*****/topics/*****\"\r\n\r\n    try:\r\n        publisher.publish(topic_path, data=b'')  # invalid\r\n    except:\r\n        pass\r\n\r\n    while True:\r\n        print('publishing')\r\n        publisher.publish(topic_path, data=b'valid')\r\n        time.sleep(1)\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\n#### Stack trace\r\n```\r\nTraceback (most recent call last):\r\n  File \"pubsub_error.py\", line 21, in <module>\r\n    main()\r\n  File \"pubsub_error.py\", line 16, in main\r\n    publisher.publish(topic_path, data=b'valid')\r\n  File \"/Users/camerondavison/Library/Python/3.7/lib/python/site-packages/google/cloud/pubsub_v1/publisher/client.py\", line 364, in publish\r\n    future = sequencer.publish(message)\r\n  File \"/Users/camerondavison/Library/Python/3.7/lib/python/site-packages/google/cloud/pubsub_v1/publisher/_sequencer/unordered_sequencer.py\", line 113, in publish\r\n    future = batch.publish(message)\r\n  File \"/Users/camerondavison/Library/Python/3.7/lib/python/site-packages/google/cloud/pubsub_v1/publisher/_batch/thread.py\", line 334, in publish\r\n    ), \"Publish after stop() or publish error.\"\r\nAssertionError: Publish after stop() or publish error.\r\n```\r\n\r\nAs I mentioned just now in https://github.com/googleapis/python-pubsub/pull/26#issuecomment-601333328 it looks like there is an assert that was added that can now trigger for an errored out batch.\r\n\r\nbatch errors could happen any time so it seems like it would be better to move the assert below the check to see if the batch is still accepting new messages so that a new batch can be created if it errored out.\r\n\r\nI validated the same code does not throw an exception on publish in `1.2.0`", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/47", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/47/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/47/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/47/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/47", "id": 582132830, "node_id": "MDU6SXNzdWU1ODIxMzI4MzA=", "number": 47, "title": "504 deadline exceeded", "user": {"login": "kthulsidoss", "id": 42998906, "node_id": "MDQ6VXNlcjQyOTk4OTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/42998906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kthulsidoss", "html_url": "https://github.com/kthulsidoss", "followers_url": "https://api.github.com/users/kthulsidoss/followers", "following_url": "https://api.github.com/users/kthulsidoss/following{/other_user}", "gists_url": "https://api.github.com/users/kthulsidoss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kthulsidoss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kthulsidoss/subscriptions", "organizations_url": "https://api.github.com/users/kthulsidoss/orgs", "repos_url": "https://api.github.com/users/kthulsidoss/repos", "events_url": "https://api.github.com/users/kthulsidoss/events{/privacy}", "received_events_url": "https://api.github.com/users/kthulsidoss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2020-03-16T09:23:32Z", "updated_at": "2020-03-24T08:11:44Z", "closed_at": "2020-03-24T08:11:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nGreetings. Way back i had reported  504 deadlines exceeded issue and we are trying with the synchronous call.Now that the issue has surfaced in the customer environment when we are trying to test the pub-sub mechanism. I have glanced the possible solutions and found an entry here :\r\nhttps://github.com/googleapis/python-pubsub/issues/9 -->\" I found the change that has been done in PR 9279 and it's related to initial_rpc_timeout_millis parameter of messaging in pubsub/google/cloud/pubsub_v1/gapic/subscriber_client_config.py file.\" it seems to me to over come this issue either use google pub sub 1.0.0 or change the parameter mentioned in subscriber_clinet_config.py.\r\nCould you please let me know how do i\r\n1.uninstall google pub sub google_cloud_pubsub-1.0.2 and make use of google_cloud_pubsub-1.0.0.\r\nor\r\nhow to find the installed folder in GCP and locate this subscriber_client_config.py in the installed directories ?\r\nsome details\r\nOS :Red Hat 4.8.5-39\r\nPython : 3.6\r\nGoogle pub sub :google_cloud_pubsub-1.0.2", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/46", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/46/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/46/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/46/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/46", "id": 578869003, "node_id": "MDU6SXNzdWU1Nzg4NjkwMDM=", "number": 46, "title": "subscriber_client.close() or subscriber.api.transport.channel.close() APIs not available", "user": {"login": "bgoyal", "id": 2764415, "node_id": "MDQ6VXNlcjI3NjQ0MTU=", "avatar_url": "https://avatars1.githubusercontent.com/u/2764415?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bgoyal", "html_url": "https://github.com/bgoyal", "followers_url": "https://api.github.com/users/bgoyal/followers", "following_url": "https://api.github.com/users/bgoyal/following{/other_user}", "gists_url": "https://api.github.com/users/bgoyal/gists{/gist_id}", "starred_url": "https://api.github.com/users/bgoyal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bgoyal/subscriptions", "organizations_url": "https://api.github.com/users/bgoyal/orgs", "repos_url": "https://api.github.com/users/bgoyal/repos", "events_url": "https://api.github.com/users/bgoyal/events{/privacy}", "received_events_url": "https://api.github.com/users/bgoyal/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814815043, "node_id": "MDU6TGFiZWwxODE0ODE1MDQz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/:rotating_light:", "name": ":rotating_light:", "color": "FFFFFF", "default": false, "description": "This issue needs some love."}, {"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815055, "node_id": "MDU6TGFiZWwxODE0ODE1MDU1", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/triage%20me", "name": "triage me", "color": "FF69B4", "default": false, "description": "I really want to be triaged."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-10T21:21:24Z", "updated_at": "2020-04-07T13:11:04Z", "closed_at": "2020-03-10T21:57:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "Thanks for stopping by to let us know something could be better!\r\n\r\n**PLEASE READ**: If you have a support contract with Google, please create an issue in the [support console](https://cloud.google.com/support/) instead of filing on GitHub. This will ensure a timely response.\r\n\r\nPlease run down the following list and make sure you've tried the usual \"quick fixes\":\r\n\r\n  - Search the issues already opened: https://github.com/googleapis/python-pubsub/issues\r\n  - Search the issues on our \"catch-all\" repository: https://github.com/googleapis/google-cloud-python\r\n  - Search StackOverflow: http://stackoverflow.com/questions/tagged/google-cloud-platform+python\r\n\r\nIf you are still having issues, please be sure to include as much information as possible:\r\n\r\n#### Environment details\r\n\r\n  - OS type and version: Ubuntu 18.04\r\n  - Python version: Python 3.6.9\r\n  - pip version: pip 20.0.2 from /usr/local/lib/python3.6/dist-packages/pip (python 3.6)\r\n  - `google-cloud-pubsub` version: \r\nName: google-cloud-pubsub\r\nVersion: 0.38.0\r\nSummary: Google Cloud Pub/Sub API client library\r\nHome-page: https://github.com/GoogleCloudPlatform/google-cloud-python\r\nAuthor: Google LLC\r\nAuthor-email: googleapis-packages@google.com\r\nLicense: Apache 2.0\r\nLocation: /usr/local/lib/python3.6/dist-packages\r\nRequires: google-api-core, grpc-google-iam-v1\r\nRequired-by: \r\n\r\n#### Steps to reproduce\r\n\r\nBoth subscriber.close() and subscriber.api.transport.channel.close() come as undefined. What's another way to close the open sockets?\r\n\r\n#### Code example\r\n\r\nHere is the code:\r\n            credentials = service_account.Credentials.from_service_account_info(creds_json)\r\n            subscriber = pubsub_v1.SubscriberClient(credentials=credentials)\r\n            subscription_path = subscriber.subscription_path(project_id, subscription_name)\r\n            NUM_MESSAGES = 3\r\n            while True:\r\n                response = subscriber.pull(subscription_path, max_messages=NUM_MESSAGES, return_immediately=True)\r\n                ack_ids = [received_message.ack_id for received_message in response.received_messages]\r\n                if ack_ids:\r\n                    subscriber.acknowledge(subscription_path, ack_ids)\r\n                else:\r\n                    break\r\n            subscriber.api.transport.channel.close()\r\n\r\n#### Stack trace\r\nOn running this, I get an error: 'SubscriberGrpcTransport' object has no attribute 'channel'. I also tried subscriber.close() and get the same error.\r\n\r\n\r\nMaking sure to follow these steps will guarantee the quickest resolution possible.\r\n\r\nThanks!\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/45", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/45/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/45/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/45/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/45", "id": 576903340, "node_id": "MDU6SXNzdWU1NzY5MDMzNDA=", "number": 45, "title": "Some of the issue links in CHANGELOG are dead", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-03-06T12:33:12Z", "updated_at": "2020-03-06T12:34:32Z", "closed_at": "2020-03-06T12:34:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Some of the issues have been opened in the old repository and released in the new (migrated) repository. The links to those issues in CHANGELOG are incorrect, as the use the old issue IDs are used with the new repo's base url.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/39", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/39/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/39/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/39/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/39", "id": 572095702, "node_id": "MDU6SXNzdWU1NzIwOTU3MDI=", "number": 39, "title": "RunTime error occurs when shutting down the streaming pull manager on user callback exception", "user": {"login": "kthulsidoss", "id": 42998906, "node_id": "MDQ6VXNlcjQyOTk4OTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/42998906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kthulsidoss", "html_url": "https://github.com/kthulsidoss", "followers_url": "https://api.github.com/users/kthulsidoss/followers", "following_url": "https://api.github.com/users/kthulsidoss/following{/other_user}", "gists_url": "https://api.github.com/users/kthulsidoss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kthulsidoss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kthulsidoss/subscriptions", "organizations_url": "https://api.github.com/users/kthulsidoss/orgs", "repos_url": "https://api.github.com/users/kthulsidoss/repos", "events_url": "https://api.github.com/users/kthulsidoss/events{/privacy}", "received_events_url": "https://api.github.com/users/kthulsidoss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 17, "created_at": "2020-02-27T13:46:30Z", "updated_at": "2020-02-28T16:21:58Z", "closed_at": "2020-02-28T16:21:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "@plamut i no longer receive the deadline exceeded error #36  however i dont see the actions being perfomed under \r\ndef callback(message)\r\nCan you please help on this", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/36", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/36/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/36/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/36/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/36", "id": 568767808, "node_id": "MDU6SXNzdWU1Njg3Njc4MDg=", "number": 36, "title": "google.api_core.exceptions.DeadlineExceeded: 504 Deadline Exceeded", "user": {"login": "kthulsidoss", "id": 42998906, "node_id": "MDQ6VXNlcjQyOTk4OTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/42998906?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kthulsidoss", "html_url": "https://github.com/kthulsidoss", "followers_url": "https://api.github.com/users/kthulsidoss/followers", "following_url": "https://api.github.com/users/kthulsidoss/following{/other_user}", "gists_url": "https://api.github.com/users/kthulsidoss/gists{/gist_id}", "starred_url": "https://api.github.com/users/kthulsidoss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kthulsidoss/subscriptions", "organizations_url": "https://api.github.com/users/kthulsidoss/orgs", "repos_url": "https://api.github.com/users/kthulsidoss/repos", "events_url": "https://api.github.com/users/kthulsidoss/events{/privacy}", "received_events_url": "https://api.github.com/users/kthulsidoss/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814815043, "node_id": "MDU6TGFiZWwxODE0ODE1MDQz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/:rotating_light:", "name": ":rotating_light:", "color": "FFFFFF", "default": false, "description": "This issue needs some love."}, {"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815055, "node_id": "MDU6TGFiZWwxODE0ODE1MDU1", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/triage%20me", "name": "triage me", "color": "FF69B4", "default": false, "description": "I really want to be triaged."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2020-02-21T06:48:14Z", "updated_at": "2020-02-27T13:55:54Z", "closed_at": "2020-02-27T13:29:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi We are using google pub sub api for implementing the publisher /subscribe pattern and we have synchronous pull implemented (ref :synchronous_pull (project_id, subscription_name).\r\nI find from viewing the topic that message has been reached the topic however it does not reach the subscriber with the above exception (google.api_core.exceptions.DeadlineExceeded: 504 Deadline Exceeded).\r\nHere are the details\r\nOS :Red Hat 4.8.5-39\r\nPython : 2.7.5\r\nWould deeply appreciate your response", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/35", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/35/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/35/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/35/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/35", "id": 568653975, "node_id": "MDU6SXNzdWU1Njg2NTM5NzU=", "number": 35, "title": "pubsub: expose a max_duration_per_lease_extension setting for subscribers", "user": {"login": "hongalex", "id": 9397363, "node_id": "MDQ6VXNlcjkzOTczNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/9397363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hongalex", "html_url": "https://github.com/hongalex", "followers_url": "https://api.github.com/users/hongalex/followers", "following_url": "https://api.github.com/users/hongalex/following{/other_user}", "gists_url": "https://api.github.com/users/hongalex/gists{/gist_id}", "starred_url": "https://api.github.com/users/hongalex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hongalex/subscriptions", "organizations_url": "https://api.github.com/users/hongalex/orgs", "repos_url": "https://api.github.com/users/hongalex/repos", "events_url": "https://api.github.com/users/hongalex/events{/privacy}", "received_events_url": "https://api.github.com/users/hongalex/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, {"login": "IlyaFaer", "id": 26030071, "node_id": "MDQ6VXNlcjI2MDMwMDcx", "avatar_url": "https://avatars1.githubusercontent.com/u/26030071?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IlyaFaer", "html_url": "https://github.com/IlyaFaer", "followers_url": "https://api.github.com/users/IlyaFaer/followers", "following_url": "https://api.github.com/users/IlyaFaer/following{/other_user}", "gists_url": "https://api.github.com/users/IlyaFaer/gists{/gist_id}", "starred_url": "https://api.github.com/users/IlyaFaer/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IlyaFaer/subscriptions", "organizations_url": "https://api.github.com/users/IlyaFaer/orgs", "repos_url": "https://api.github.com/users/IlyaFaer/repos", "events_url": "https://api.github.com/users/IlyaFaer/events{/privacy}", "received_events_url": "https://api.github.com/users/IlyaFaer/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2020-02-20T23:59:27Z", "updated_at": "2020-03-03T15:05:17Z", "closed_at": "2020-03-03T15:05:17Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "For languages that support lease management, we have bound the percentile distribution to 10s - 10m. It would be useful if the upper bound were configurable.\r\n\r\nA user might process messages very slowly (8m to ack)\r\nIf the application fails 5s after receiving a message (whose ack deadline was set to 8m, because that's the deadline the percentile distribution gave), the user has to wait 7m55s for the message to be redelivered\r\nUsers should be able to set `max_duration_per_lease_extension` = 20s, which caps an individual modAck RPC to 20s. This would have the downside of causing more modack RPCs to be sent, but the upside that the redelivery time would only be 15s\r\nThis setting differs from [`max_lease_duration`](https://github.com/googleapis/google-cloud-dotnet/blob/174e30c1ef39c5d1e1e51590b6af402aa0316c54/apis/Google.Cloud.PubSub.V1/Google.Cloud.PubSub.V1/SubscriberClient.cs#L229), which defines the total amount of time we'll hold a message.\r\n\r\nIn addition, `max_duration_per_lease_extension` should be disabled if <=0, and should default to 0.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/30", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/30/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/30/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/30/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/30", "id": 562919376, "node_id": "MDU6SXNzdWU1NjI5MTkzNzY=", "number": 30, "title": "Infinite re-deliveries when using the pubsub emulator ", "user": {"login": "rettier", "id": 7272789, "node_id": "MDQ6VXNlcjcyNzI3ODk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7272789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rettier", "html_url": "https://github.com/rettier", "followers_url": "https://api.github.com/users/rettier/followers", "following_url": "https://api.github.com/users/rettier/following{/other_user}", "gists_url": "https://api.github.com/users/rettier/gists{/gist_id}", "starred_url": "https://api.github.com/users/rettier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rettier/subscriptions", "organizations_url": "https://api.github.com/users/rettier/orgs", "repos_url": "https://api.github.com/users/rettier/repos", "events_url": "https://api.github.com/users/rettier/events{/privacy}", "received_events_url": "https://api.github.com/users/rettier/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": {"login": "anguillanneuf", "id": 9518298, "node_id": "MDQ6VXNlcjk1MTgyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9518298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anguillanneuf", "html_url": "https://github.com/anguillanneuf", "followers_url": "https://api.github.com/users/anguillanneuf/followers", "following_url": "https://api.github.com/users/anguillanneuf/following{/other_user}", "gists_url": "https://api.github.com/users/anguillanneuf/gists{/gist_id}", "starred_url": "https://api.github.com/users/anguillanneuf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anguillanneuf/subscriptions", "organizations_url": "https://api.github.com/users/anguillanneuf/orgs", "repos_url": "https://api.github.com/users/anguillanneuf/repos", "events_url": "https://api.github.com/users/anguillanneuf/events{/privacy}", "received_events_url": "https://api.github.com/users/anguillanneuf/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "anguillanneuf", "id": 9518298, "node_id": "MDQ6VXNlcjk1MTgyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9518298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anguillanneuf", "html_url": "https://github.com/anguillanneuf", "followers_url": "https://api.github.com/users/anguillanneuf/followers", "following_url": "https://api.github.com/users/anguillanneuf/following{/other_user}", "gists_url": "https://api.github.com/users/anguillanneuf/gists{/gist_id}", "starred_url": "https://api.github.com/users/anguillanneuf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anguillanneuf/subscriptions", "organizations_url": "https://api.github.com/users/anguillanneuf/orgs", "repos_url": "https://api.github.com/users/anguillanneuf/repos", "events_url": "https://api.github.com/users/anguillanneuf/events{/privacy}", "received_events_url": "https://api.github.com/users/anguillanneuf/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2020-02-10T22:22:19Z", "updated_at": "2020-02-14T23:26:07Z", "closed_at": "2020-02-14T21:24:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "We have come across an issue during development where long-running message callbacks would seem to never finish processing, when in reality the messages were redelivered indefinitely. I have distilled the problem down to the attached sample publisher and subscriber code. \r\n\r\nThe behavior appears if the delay between publishing messages in a loop went above the 0.01 latency configured in the publisher's `BatchSettings`. If this was the case the subscriber would process the messages in order, and after processing the last message would start again somewhere and keep going forever. We were not able to reproduce the behavior with the actual pubsub system, but it begs the question if there is something wrong with our understanding of the pubsub system.\r\n\r\nThe attached sample code restricts the `ack_deadline_seconds` and `FlowControl.max_messages` in order to induce the behavior on a smaller, more debuggable, scale. If you comment out the sleep in `publisher.py:19` the messages are only processed once. I have also attached the debug log output of the subscriber (cut off, as it runs indefinitely).\r\n\r\nAs far as i understand it, if the ack deadline would be exceeded by the subscriber, it will renew the ack deadline until the `max_lease_duration` is reached. So in the case of slow running tasks, they should not cause any re-deliveries as long as the subscriber is running properly.\r\n\r\nIs this a configuration/usage issue, a problem of the pub sub emulator or can a similar behavior also occur on the actual pub sub system?\r\n\r\nTested pub sub emulator version: 279.0.0 and 244.0.0\r\nClient libraries:\r\n* google-cloud-core==1.3.0\r\n* google-cloud-pubsub==1.2.0\r\n* googleapis-common-protos==1.6.0\r\n\r\n`publisher.py`\r\n```python\r\nfrom time import sleep\r\n\r\nfrom google.cloud import pubsub_v1\r\nfrom google.cloud.exceptions import NotFound\r\n\r\nproject = \"test\"\r\n\r\npub = pubsub_v1.PublisherClient()\r\ntopic_path = pub.topic_path(project, \"ackbug-test\")\r\n\r\ntry:\r\n    topic = pub.get_topic(topic_path)\r\nexcept NotFound:\r\n    topic = pub.create_topic(topic_path)\r\n\r\nfor x in range(30):\r\n    print(\"Publish\", x)\r\n\r\n    # remove the sleep to avoid the bug\r\n    sleep(0.01)\r\n\r\n    pub.publish(topic_path, str(x).encode(\"ascii\"))\r\n\r\n```\r\n\r\n\r\n`subscriber.py`\r\n```python\r\nimport logging\r\nfrom concurrent.futures.thread import ThreadPoolExecutor\r\nfrom time import sleep\r\n\r\nfrom google.api_core.exceptions import AlreadyExists\r\nfrom google.cloud import pubsub_v1\r\nfrom google.cloud.pubsub_v1.subscriber.scheduler import ThreadScheduler\r\n\r\nlogging.basicConfig(level=logging.DEBUG)\r\n\r\n\r\ndef callback(message):\r\n    logging.info(\"received message id: {}\".format(message.data.decode(\"ascii\")))\r\n    sleep(1)\r\n    message.ack()\r\n\r\n\r\nproject = \"test\"\r\nsub = pubsub_v1.SubscriberClient()\r\nsub_path = sub.subscription_path(project, \"ackbug-test-24\")\r\ntopic_path = sub.topic_path(project, \"ackbug-test\")\r\n\r\ntry:\r\n    sub.create_subscription(sub_path, topic_path, ack_deadline_seconds=5)\r\nexcept AlreadyExists:\r\n    pass\r\n\r\nexecutor = ThreadPoolExecutor(max_workers=1)\r\nscheduler = ThreadScheduler(executor)\r\nflow_control = pubsub_v1.types.FlowControl(max_messages=10)\r\n\r\nfuture = sub.subscribe(sub_path, callback, scheduler=scheduler, flow_control=flow_control)\r\nfuture.result()\r\n```\r\n\r\n[subscriber.log.gz](https://github.com/googleapis/google-cloud-python/files/4183333/subscriber.log.gz)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/29", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/29/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/29/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/29/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/29", "id": 562553513, "node_id": "MDU6SXNzdWU1NjI1NTM1MTM=", "number": 29, "title": "Synthesis failed for python-pubsub", "user": {"login": "yoshi-automation", "id": 44816363, "node_id": "MDQ6VXNlcjQ0ODE2MzYz", "avatar_url": "https://avatars1.githubusercontent.com/u/44816363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yoshi-automation", "html_url": "https://github.com/yoshi-automation", "followers_url": "https://api.github.com/users/yoshi-automation/followers", "following_url": "https://api.github.com/users/yoshi-automation/following{/other_user}", "gists_url": "https://api.github.com/users/yoshi-automation/gists{/gist_id}", "starred_url": "https://api.github.com/users/yoshi-automation/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yoshi-automation/subscriptions", "organizations_url": "https://api.github.com/users/yoshi-automation/orgs", "repos_url": "https://api.github.com/users/yoshi-automation/repos", "events_url": "https://api.github.com/users/yoshi-automation/events{/privacy}", "received_events_url": "https://api.github.com/users/yoshi-automation/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814815043, "node_id": "MDU6TGFiZWwxODE0ODE1MDQz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/:rotating_light:", "name": ":rotating_light:", "color": "FFFFFF", "default": false, "description": "This issue needs some love."}, {"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1838428849, "node_id": "MDU6TGFiZWwxODM4NDI4ODQ5", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/autosynth%20failure", "name": "autosynth failure", "color": "ededed", "default": false, "description": null}, {"id": 1814814970, "node_id": "MDU6TGFiZWwxODE0ODE0OTcw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p1", "name": "priority: p1", "color": "ffa03e", "default": false, "description": "Medium priority. Will be fixed prior to next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": {"login": "hongalex", "id": 9397363, "node_id": "MDQ6VXNlcjkzOTczNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/9397363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hongalex", "html_url": "https://github.com/hongalex", "followers_url": "https://api.github.com/users/hongalex/followers", "following_url": "https://api.github.com/users/hongalex/following{/other_user}", "gists_url": "https://api.github.com/users/hongalex/gists{/gist_id}", "starred_url": "https://api.github.com/users/hongalex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hongalex/subscriptions", "organizations_url": "https://api.github.com/users/hongalex/orgs", "repos_url": "https://api.github.com/users/hongalex/repos", "events_url": "https://api.github.com/users/hongalex/events{/privacy}", "received_events_url": "https://api.github.com/users/hongalex/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "hongalex", "id": 9397363, "node_id": "MDQ6VXNlcjkzOTczNjM=", "avatar_url": "https://avatars3.githubusercontent.com/u/9397363?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hongalex", "html_url": "https://github.com/hongalex", "followers_url": "https://api.github.com/users/hongalex/followers", "following_url": "https://api.github.com/users/hongalex/following{/other_user}", "gists_url": "https://api.github.com/users/hongalex/gists{/gist_id}", "starred_url": "https://api.github.com/users/hongalex/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hongalex/subscriptions", "organizations_url": "https://api.github.com/users/hongalex/orgs", "repos_url": "https://api.github.com/users/hongalex/repos", "events_url": "https://api.github.com/users/hongalex/events{/privacy}", "received_events_url": "https://api.github.com/users/hongalex/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2020-02-10T13:16:06Z", "updated_at": "2020-02-19T02:31:05Z", "closed_at": "2020-02-19T02:31:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello! Autosynth couldn't regenerate python-pubsub. :broken_heart:\n\nHere's the output from running `synth.py`:\n\n```\nCloning into 'working_repo'...\nSwitched to branch 'autosynth'\nRunning synthtool\n['/tmpfs/src/git/autosynth/env/bin/python3', '-m', 'synthtool', 'synth.py', '--']\nsynthtool > Executing /tmpfs/src/git/autosynth/working_repo/synth.py.\nsynthtool > Ensuring dependencies.\nsynthtool > Pulling artman image.\nlatest: Pulling from googleapis/artman\n0a01a72a686c: Pulling fs layer\ncc899a5544da: Pulling fs layer\n19197c550755: Pulling fs layer\n716d454e56b6: Pulling fs layer\n356bff9680f9: Pulling fs layer\ne9c3c22e42c0: Pulling fs layer\n942b7dc330dd: Pulling fs layer\n56709773ca4a: Pulling fs layer\n8170975fe908: Pulling fs layer\nd8b5c7fe7729: Pulling fs layer\ndccf1bbd0660: Pulling fs layer\n0f1049eb8f0b: Pulling fs layer\n0637b8e4edf2: Pulling fs layer\nfe441baf69db: Pulling fs layer\n93bd4e7a0e34: Pulling fs layer\n69ac465d8b6d: Pulling fs layer\nff53b2ac7bd7: Pulling fs layer\n7c49755f75be: Pulling fs layer\n03847e8fcbe9: Pulling fs layer\nb017baf7ee37: Pulling fs layer\nbfd64ffd417b: Pulling fs layer\n25de3dde113f: Pulling fs layer\n880ff89656a7: Pulling fs layer\n253833b214f0: Pulling fs layer\n6aff358b4b78: Pulling fs layer\nbdf245069246: Pulling fs layer\n5fa91c043e36: Pulling fs layer\na8dbf9c918af: Pulling fs layer\n716d454e56b6: Waiting\n356bff9680f9: Waiting\ne9c3c22e42c0: Waiting\n942b7dc330dd: Waiting\n56709773ca4a: Waiting\n8170975fe908: Waiting\nd8b5c7fe7729: Waiting\ndccf1bbd0660: Waiting\nff53b2ac7bd7: Waiting\n7c49755f75be: Waiting\n03847e8fcbe9: Waiting\nb017baf7ee37: Waiting\n6aff358b4b78: Waiting\nbfd64ffd417b: Waiting\n5fa91c043e36: Waiting\nbdf245069246: Waiting\n25de3dde113f: Waiting\n880ff89656a7: Waiting\na8dbf9c918af: Waiting\nfe441baf69db: Waiting\n93bd4e7a0e34: Waiting\n0637b8e4edf2: Waiting\n253833b214f0: Waiting\n69ac465d8b6d: Waiting\n19197c550755: Verifying Checksum\n19197c550755: Download complete\ncc899a5544da: Verifying Checksum\ncc899a5544da: Download complete\n0a01a72a686c: Verifying Checksum\n0a01a72a686c: Download complete\n716d454e56b6: Verifying Checksum\n716d454e56b6: Download complete\n356bff9680f9: Verifying Checksum\n356bff9680f9: Download complete\n942b7dc330dd: Verifying Checksum\n942b7dc330dd: Download complete\n56709773ca4a: Verifying Checksum\n56709773ca4a: Download complete\nd8b5c7fe7729: Verifying Checksum\nd8b5c7fe7729: Download complete\n8170975fe908: Verifying Checksum\n8170975fe908: Download complete\n0f1049eb8f0b: Verifying Checksum\n0f1049eb8f0b: Download complete\n0a01a72a686c: Pull complete\ndccf1bbd0660: Verifying Checksum\ndccf1bbd0660: Download complete\ncc899a5544da: Pull complete\n19197c550755: Pull complete\n716d454e56b6: Pull complete\nfe441baf69db: Verifying Checksum\nfe441baf69db: Download complete\ne9c3c22e42c0: Verifying Checksum\ne9c3c22e42c0: Download complete\n93bd4e7a0e34: Verifying Checksum\n93bd4e7a0e34: Download complete\n69ac465d8b6d: Verifying Checksum\n69ac465d8b6d: Download complete\n0637b8e4edf2: Verifying Checksum\n0637b8e4edf2: Download complete\nff53b2ac7bd7: Verifying Checksum\nff53b2ac7bd7: Download complete\n356bff9680f9: Pull complete\n7c49755f75be: Download complete\n03847e8fcbe9: Verifying Checksum\n03847e8fcbe9: Download complete\nbfd64ffd417b: Download complete\n880ff89656a7: Verifying Checksum\n880ff89656a7: Download complete\n253833b214f0: Download complete\n6aff358b4b78: Verifying Checksum\n6aff358b4b78: Download complete\nb017baf7ee37: Verifying Checksum\nb017baf7ee37: Download complete\nbdf245069246: Download complete\n5fa91c043e36: Verifying Checksum\n5fa91c043e36: Download complete\na8dbf9c918af: Verifying Checksum\na8dbf9c918af: Download complete\n25de3dde113f: Verifying Checksum\n25de3dde113f: Download complete\ne9c3c22e42c0: Pull complete\n942b7dc330dd: Pull complete\n56709773ca4a: Pull complete\n8170975fe908: Pull complete\nd8b5c7fe7729: Pull complete\ndccf1bbd0660: Pull complete\n0f1049eb8f0b: Pull complete\n0637b8e4edf2: Pull complete\nfe441baf69db: Pull complete\n93bd4e7a0e34: Pull complete\n69ac465d8b6d: Pull complete\nff53b2ac7bd7: Pull complete\n7c49755f75be: Pull complete\n03847e8fcbe9: Pull complete\nb017baf7ee37: Pull complete\nbfd64ffd417b: Pull complete\n25de3dde113f: Pull complete\n880ff89656a7: Pull complete\n253833b214f0: Pull complete\n6aff358b4b78: Pull complete\nbdf245069246: Pull complete\n5fa91c043e36: Pull complete\na8dbf9c918af: Pull complete\nDigest: sha256:6aec9c34db0e4be221cdaf6faba27bdc07cfea846808b3d3b964dfce3a9a0f9b\nStatus: Downloaded newer image for googleapis/artman:latest\nsynthtool > Cloning googleapis.\nsynthtool > Running generator for google/pubsub/artman_pubsub.yaml.\nsynthtool > Generated code into /home/kbuilder/.cache/synthtool/googleapis/artman-genfiles/python/pubsub-v1.\nsynthtool > Copy: /home/kbuilder/.cache/synthtool/googleapis/google/pubsub/v1/pubsub.proto to /home/kbuilder/.cache/synthtool/googleapis/artman-genfiles/python/pubsub-v1/google/cloud/pubsub_v1/proto/pubsub.proto\nsynthtool > Placed proto files into /home/kbuilder/.cache/synthtool/googleapis/artman-genfiles/python/pubsub-v1/google/cloud/pubsub_v1/proto.\nsynthtool > Replaced 'from google.cloud import pubsub_v1' in tests/unit/gapic/v1/test_publisher_client_v1.py.\nsynthtool > Replaced ' pubsub_v1' in tests/unit/gapic/v1/test_publisher_client_v1.py.\nsynthtool > Replaced 'from google.cloud import pubsub_v1' in tests/unit/gapic/v1/test_subscriber_client_v1.py.\nsynthtool > Replaced ' pubsub_v1' in tests/unit/gapic/v1/test_subscriber_client_v1.py.\nsynthtool > Replaced '# The name of the interface for this client. This is the key used to' in google/cloud/pubsub_v1/gapic/subscriber_client.py.\nsynthtool > Replaced '# The name of the interface for this client. This is the key used to' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced 'import google.api_core.gapic_v1.method\\n' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced 'DESCRIPTOR = _MESSAGESTORAGEPOLICY,\\n\\\\s+__module__.*\\n\\\\s+,\\n\\\\s+__doc__ = \"\"\"' in google/cloud/pubsub_v1/proto/pubsub_pb2.py.\nsynthtool > No replacements made in google/cloud/pubsub_v1/gapic/subscriber_client.py for pattern subscription \\(str\\): The subscription whose backlog .*\n(.*\n)+?\\s+Format is .*, maybe replacement is not longer needed?\nsynthtool > Replaced 'import functools\\n' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced 'import pkg_resources\\n' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced 'class PublisherClient' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced 'client_config \\\\(dict\\\\): DEPRECATED.' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced '# Raise deprecation warnings .*\\n.*\\n.*\\n.*\\n.*\\n.*\\n' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced '~google.api_core.page_iterator.PageIterator' in google/cloud/pubsub_v1/gapic/publisher_client.py.\nsynthtool > Replaced '~google.api_core.page_iterator.PageIterator' in google/cloud/pubsub_v1/gapic/subscriber_client.py.\nsynthtool > Replaced 'from google.iam.v1 import iam_policy_pb2' in google/cloud/pubsub_v1/gapic/transports/subscriber_grpc_transport.py.\nsynthtool > Replaced 'from google.iam.v1 import iam_policy_pb2' in google/cloud/pubsub_v1/gapic/transports/publisher_grpc_transport.py.\n.coveragerc\n.flake8\n.github/CONTRIBUTING.md\n.github/ISSUE_TEMPLATE/bug_report.md\n.github/ISSUE_TEMPLATE/feature_request.md\n.github/ISSUE_TEMPLATE/support_request.md\n.github/PULL_REQUEST_TEMPLATE.md\n.github/release-please.yml\n.gitignore\n.kokoro/build.sh\n.kokoro/continuous/common.cfg\n.kokoro/continuous/continuous.cfg\n.kokoro/docs/common.cfg\n.kokoro/docs/docs.cfg\n.kokoro/presubmit/common.cfg\n.kokoro/presubmit/presubmit.cfg\n.kokoro/publish-docs.sh\n.kokoro/release.sh\n.kokoro/release/common.cfg\n.kokoro/release/release.cfg\n.kokoro/trampoline.sh\nCODE_OF_CONDUCT.md\nCONTRIBUTING.rst\nLICENSE\nMANIFEST.in\ndocs/_static/custom.css\ndocs/_templates/layout.html\ndocs/conf.py.j2\nnoxfile.py.j2\nrenovate.json\nsetup.cfg\nsynthtool > No replacements made in noxfile.py for pattern session\\.install\\(\"-e\", \"\\.\\./test_utils/\"\\), maybe replacement is not longer needed?\nRunning session blacken\nCreating virtual environment (virtualenv) using python3.6 in .nox/blacken\npip install black==19.3b0\nError: pip is not installed into the virtualenv, it is located at /tmpfs/src/git/autosynth/env/bin/pip. Pass external=True into run() to explicitly allow this.\nSession blacken failed.\nsynthtool > Failed executing nox -s blacken:\n\nNone\nsynthtool > Wrote metadata to synth.metadata.\nTraceback (most recent call last):\n  File \"/home/kbuilder/.pyenv/versions/3.6.1/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\n    \"__main__\", mod_spec)\n  File \"/home/kbuilder/.pyenv/versions/3.6.1/lib/python3.6/runpy.py\", line 85, in _run_code\n    exec(code, run_globals)\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/synthtool/__main__.py\", line 99, in <module>\n    main()\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/click/core.py\", line 764, in __call__\n    return self.main(*args, **kwargs)\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/click/core.py\", line 717, in main\n    rv = self.invoke(ctx)\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/click/core.py\", line 956, in invoke\n    return ctx.invoke(self.callback, **ctx.params)\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/click/core.py\", line 555, in invoke\n    return callback(*args, **kwargs)\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/synthtool/__main__.py\", line 91, in main\n    spec.loader.exec_module(synth_module)  # type: ignore\n  File \"<frozen importlib._bootstrap_external>\", line 678, in exec_module\n  File \"<frozen importlib._bootstrap>\", line 205, in _call_with_frames_removed\n  File \"/tmpfs/src/git/autosynth/working_repo/synth.py\", line 205, in <module>\n    s.shell.run([\"nox\", \"-s\", \"blacken\"], hide_output=False)\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/synthtool/shell.py\", line 39, in run\n    raise exc\n  File \"/tmpfs/src/git/autosynth/env/lib/python3.6/site-packages/synthtool/shell.py\", line 33, in run\n    encoding=\"utf-8\",\n  File \"/home/kbuilder/.pyenv/versions/3.6.1/lib/python3.6/subprocess.py\", line 418, in run\n    output=stdout, stderr=stderr)\nsubprocess.CalledProcessError: Command '['nox', '-s', 'blacken']' returned non-zero exit status 1.\n\nSynthesis failed\n\n```\n\nGoogle internal developers can see the full log [here](https://sponge/71791922-d263-4d09-a962-3c1472f71410).\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/28", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/28/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/28/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/28/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/28", "id": 562428364, "node_id": "MDU6SXNzdWU1NjI0MjgzNjQ=", "number": 28, "title": "PubSub: easier way to acknowledge a message using ack_id", "user": {"login": "guyandtheworld", "id": 20072816, "node_id": "MDQ6VXNlcjIwMDcyODE2", "avatar_url": "https://avatars1.githubusercontent.com/u/20072816?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guyandtheworld", "html_url": "https://github.com/guyandtheworld", "followers_url": "https://api.github.com/users/guyandtheworld/followers", "following_url": "https://api.github.com/users/guyandtheworld/following{/other_user}", "gists_url": "https://api.github.com/users/guyandtheworld/gists{/gist_id}", "starred_url": "https://api.github.com/users/guyandtheworld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guyandtheworld/subscriptions", "organizations_url": "https://api.github.com/users/guyandtheworld/orgs", "repos_url": "https://api.github.com/users/guyandtheworld/repos", "events_url": "https://api.github.com/users/guyandtheworld/events{/privacy}", "received_events_url": "https://api.github.com/users/guyandtheworld/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-10T09:24:09Z", "updated_at": "2020-02-11T05:11:01Z", "closed_at": "2020-02-11T05:11:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was going through the PubSub pull docs [here][1]\r\n\r\n```\r\nfrom google.cloud import pubsub_v1\r\n\r\n# TODO project_id = \"Your Google Cloud Project ID\"\r\n# TODO subscription_name = \"Your Pub/Sub subscription name\"\r\n# TODO timeout = 5.0  # \"How long the subscriber should listen for\r\n# messages in seconds\"\r\n\r\nsubscriber = pubsub_v1.SubscriberClient()\r\n# The `subscription_path` method creates a fully qualified identifier\r\n# in the form `projects/{project_id}/subscriptions/{subscription_name}`\r\nsubscription_path = subscriber.subscription_path(\r\n    project_id, subscription_name\r\n)\r\n\r\ndef callback(message):\r\n    print(\"Received message: {}\".format(message))\r\n    message.ack()\r\n\r\nstreaming_pull_future = subscriber.subscribe(\r\n    subscription_path, callback=callback\r\n)\r\nprint(\"Listening for messages on {}..\\n\".format(subscription_path))\r\n\r\n# result() in a future will block indefinitely if `timeout` is not set,\r\n# unless an exception is encountered first.\r\ntry:\r\n    streaming_pull_future.result(timeout=timeout)\r\nexcept:  # noqa\r\n    streaming_pull_future.cancel()\r\n```\r\n\r\n\r\nIn the above example, the message is ack-ed as soon as it is received. But I want to acknowledge only when my local celery workers finish processing the message so that PubSub can redeliver the message if the worker fails. So I take the ack_id of the message and pass it onto the worker.\r\n\r\n\r\n    params[\"ack_id\"] = message._ack_id\r\n    start_aggregation.delay(params)\r\n\r\n \r\nI couldn't find a convenient way to ack a message using the ack_id. Does PubSub python have a method to do that? I could only find [this][2].\r\n\r\n  [1]: https://cloud.google.com/pubsub/docs/pull\r\n  [2]: https://cloud.google.com/pubsub/docs/reference/rest/v1/projects.subscriptions/acknowledge?apix_params=%7B%22subscription%22%3A%22projects%2Falrt-ai%2Fsubscriptions%2Fnews_aggregator%22%2C%22resource%22%3A%7B%22ackIds%22%3A%5B%22CypYEU4EISE-MD5FU0RQBhYsXUZIUTcZCGhRDk9eIz81IChFEAEgbwstQloeYmhcXHUHUAoZcHhpdWwPE1IIRVl-d2s5MmFbWHAGUg8Zcnpic2taEin4mIDUpKL2PHJgZIDX4s8sUpCNmsxoZh89WxJLLD5-LThFQV5AEkwmDURJUytD%22%5D%7D%7D", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/4", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/4/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/4/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/4/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/4", "id": 558131495, "node_id": "MDU6SXNzdWU1NTgxMzE0OTU=", "number": 4, "title": "PubSub: gRPC channel memory leak/not closed.", "user": {"login": "codezizo", "id": 10685570, "node_id": "MDQ6VXNlcjEwNjg1NTcw", "avatar_url": "https://avatars3.githubusercontent.com/u/10685570?v=4", "gravatar_id": "", "url": "https://api.github.com/users/codezizo", "html_url": "https://github.com/codezizo", "followers_url": "https://api.github.com/users/codezizo/followers", "following_url": "https://api.github.com/users/codezizo/following{/other_user}", "gists_url": "https://api.github.com/users/codezizo/gists{/gist_id}", "starred_url": "https://api.github.com/users/codezizo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/codezizo/subscriptions", "organizations_url": "https://api.github.com/users/codezizo/orgs", "repos_url": "https://api.github.com/users/codezizo/repos", "events_url": "https://api.github.com/users/codezizo/events{/privacy}", "received_events_url": "https://api.github.com/users/codezizo/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2019-12-11T20:32:31Z", "updated_at": "2020-02-20T07:52:08Z", "closed_at": "2020-02-20T07:52:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "Version 0.42.1\r\n\r\n#### Steps to reproduce\r\n\r\n  1. Create a SubscriberClient\r\n  2. Delete it, and run a AddressSanitizerLeakSanitizer test to detect leak.\r\n\r\n#### Code example\r\n\r\n```python\r\n    subscriber = pubsub_v1.SubscriberClient(credentials=credentials)\r\n    subscription_path = subscriber.subscription_path(project_id, subscription_id)\r\n    messages = subscriber.pull(subscription_path, max_messages=1).received_messages\r\n```\r\n--- python code ends---\r\n\r\n#### Stack trace\r\n```\r\n\r\nDirect leak of 2912 byte(s) in 4 object(s) allocated from:\r\n    #0 0x55e0cdf45ee2 in calloc llvm/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:154:3\r\n    googleapis/google-cloud-python#1 0x55e0ce6b7642 in gpr_zalloc grpc/src/core/lib/gpr/alloc.cc:43:7\r\n    googleapis/google-cloud-python#2 0x55e0ce5fafd9 in grpc_channel_stack_builder_finish(grpc_channel_stack_builder*, unsigned long, int, void (*)(void*, grpc_error*), void*, void**) grpc/src/core/lib/channel/channel_stack_builder.cc:292:13\r\n    googleapis/google-cloud-python#3 0x55e0ce68af4a in grpc_channel_create_with_builder(grpc_channel_stack_builder*, grpc_channel_stack_type) grpc/src/core/lib/surface/channel.cc:79:23\r\n    googleapis/google-cloud-python#4 0x55e0ce68bba2 in grpc_channel_create(char const*, grpc_channel_args const*, grpc_channel_stack_type, grpc_transport*, grpc_resource_user*) grpc/src/core/lib/surface/channel.cc:290:7\r\n    googleapis/google-cloud-python#5 0x55e0ce3d7ebf in grpc_core::(anonymous namespace)::CreateChannel(char const*, grpc_channel_args const*) grpc/src/core/ext/transport/chttp2/client/secure/secure_channel_create.cc:169:7\r\n    googleapis/google-cloud-python#6 0x55e0ce3d7ba3 in grpc_secure_channel_create grpc/src/core/ext/transport/chttp2/client/secure/secure_channel_create.cc:217:15\r\n    googleapis/google-cloud-python#7 0x7ff05f195052 in __pyx_pf_7google3_3net_4grpc_6python_7_cython_6cygrpc_7Channel___cinit__(__pyx_obj_7google3_3net_4grpc_6python_7_cython_6cygrpc_Channel*, _object*, _object*, __pyx_obj_7google3_3net_4grpc_6python_7_cython_6cygrpc_ChannelCredentials*) blaze-out/k8-asan-fastbuild/genfiles/net/grpc/python/_cython/cygrpc.pyx_cython_generated.cc:16812:39\r\n    googleapis/google-cloud-python#8 0x7ff05f194578 in __pyx_pw_7google3_3net_4grpc_6python_7_cython_6cygrpc_7Channel_1__cinit__(_object*, _object*, _object*) blaze-out/k8-asan-fastbuild/genfiles/net/grpc/python/_cython/cygrpc.pyx_cython_generated.cc:16602:13\r\n    googleapis/google-cloud-python#9 0x7ff05f17436d in __pyx_tp_new_7google3_3net_4grpc_6python_7_cython_6cygrpc_Channel(_typeobject*, _object*, _object*) blaze-out/k8-asan-fastbuild/genfiles/net/grpc/python/_cython/cygrpc.pyx_cython_generated.cc:64996:7\r\n    googleapis/google-cloud-python#10 0x55e0d3319338 in type_call python_runtime/v2_7/Objects/typeobject.c:749:11\r\n    googleapis/google-cloud-python#11 0x55e0d32ba471 in PyObject_Call python_runtime/v2_7/Objects/abstract.c:2544:18\r\n    googleapis/google-cloud-python#12 0x55e0d3367433 in do_call python_runtime/v2_7/Python/ceval.c:4612:18\r\n    googleapis/google-cloud-python#13 0x55e0d3367433 in call_function python_runtime/v2_7/Python/ceval.c:4417:17\r\n    googleapis/google-cloud-python#14 0x55e0d3367433 in PyEval_EvalFrameEx python_runtime/v2_7/Python/ceval.c:3013:17\r\n    googleapis/google-cloud-python#15 0x55e0d3360e59 in PyEval_EvalCodeEx python_runtime/v2_7/Python/ceval.c:3627:14\r\n    googleapis/google-cloud-python#16 0x55e0d32e7a55 in function_call python_runtime/v2_7/Objects/funcobject.c:523:14\r\n    googleapis/google-cloud-python#17 0x55e0d32ba471 in PyObject_Call python_runtime/v2_7/Objects/abstract.c:2544:18\r\n    googleapis/google-cloud-python#18 0x55e0d32c9c62 in instancemethod_call python_runtime/v2_7/Objects/classobject.c:2600:14\r\n    googleapis/google-cloud-python#19 0x55e0d32ba471 in PyObject_Call python_runtime/v2_7/Objects/abstract.c:2544:18\r\n    googleapis/google-cloud-python#20 0x55e0d331d86f in slot_tp_init python_runtime/v2_7/Objects/typeobject.c:5872:11\r\n    googleapis/google-cloud-python#21 0x55e0d3319448 in type_call python_runtime/v2_7/Objects/typeobject.c:765:13\r\n    googleapis/google-cloud-python#22 0x55e0d32ba471 in PyObject_Call python_runtime/v2_7/Objects/abstract.c:2544:18\r\n    googleapis/google-cloud-python#23 0x55e0d3367433 in do_call python_runtime/v2_7/Python/ceval.c:4612:18\r\n    googleapis/google-cloud-python#24 0x55e0d3367433 in call_function python_runtime/v2_7/Python/ceval.c:4417:17\r\n    googleapis/google-cloud-python#25 0x55e0d3367433 in PyEval_EvalFrameEx python_runtime/v2_7/Python/ceval.c:3013:17\r\n    googleapis/google-cloud-python#26 0x55e0d3360e59 in PyEval_EvalCodeEx python_runtime/v2_7/Python/ceval.c:3627:14\r\n    googleapis/google-cloud-python#27 0x55e0d32e7a55 in function_call python_runtime/v2_7/Objects/funcobject.c:523:14\r\n    googleapis/google-cloud-python#28 0x55e0d32ba471 in PyObject_Call python_runtime/v2_7/Objects/abstract.c:2544:18\r\n    googleapis/google-cloud-python#29 0x55e0d32c9c62 in instancemethod_call python_runtime/v2_7/Objects/classobject.c:2600:14\r\n    googleapis/google-cloud-python#30 0x55e0d32ba471 in PyObject_Call python_runtime/v2_7/Objects/abstract.c:2544:18\r\n    googleapis/google-cloud-python#31 0x55e0d331d86f in slot_tp_init python_runtime/v2_7/Objects/typeobject.c:5872:11\r\n    googleapis/google-cloud-python#32 0x55e0d3319448 in type_call python_runtime/v2_7/Objects/typeobject.c:765:13\r\n    googleapis/google-cloud-python#33 0x55e0d32ba471 in PyObject_Call python_runtime/v2_7/Objects/abstract.c:2544:18```\r\n\r\nAs can be seen here gRPC channels must be explicitly closes using the close() method. \r\n[https://github.com/grpc/grpc/issues/12531]\r\n\r\nThanks!\r\n\r\nLet me know if you need anymore information!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/6", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/6/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/6/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/6/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/6", "id": 558131956, "node_id": "MDU6SXNzdWU1NTgxMzE5NTY=", "number": 6, "title": "PubSub: Implement ordering keys", "user": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": null, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2019-12-06T23:24:59Z", "updated_at": "2020-02-05T22:06:11Z", "closed_at": "2020-02-05T22:06:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/7", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/7/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/7/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/7/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/7", "id": 558132094, "node_id": "MDU6SXNzdWU1NTgxMzIwOTQ=", "number": 7, "title": "PubSub: '504 Deadline Exceeded' response from 'SubscriberClient.pull' (with return_immediately=True)", "user": {"login": "tonycosentini", "id": 23467, "node_id": "MDQ6VXNlcjIzNDY3", "avatar_url": "https://avatars1.githubusercontent.com/u/23467?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tonycosentini", "html_url": "https://github.com/tonycosentini", "followers_url": "https://api.github.com/users/tonycosentini/followers", "following_url": "https://api.github.com/users/tonycosentini/following{/other_user}", "gists_url": "https://api.github.com/users/tonycosentini/gists{/gist_id}", "starred_url": "https://api.github.com/users/tonycosentini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tonycosentini/subscriptions", "organizations_url": "https://api.github.com/users/tonycosentini/orgs", "repos_url": "https://api.github.com/users/tonycosentini/repos", "events_url": "https://api.github.com/users/tonycosentini/events{/privacy}", "received_events_url": "https://api.github.com/users/tonycosentini/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819579287, "node_id": "MDU6TGFiZWwxODE5NTc5Mjg3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/flaky", "name": "flaky", "color": "e99695", "default": false, "description": ""}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [{"login": "HemangChothani", "id": 50404902, "node_id": "MDQ6VXNlcjUwNDA0OTAy", "avatar_url": "https://avatars3.githubusercontent.com/u/50404902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HemangChothani", "html_url": "https://github.com/HemangChothani", "followers_url": "https://api.github.com/users/HemangChothani/followers", "following_url": "https://api.github.com/users/HemangChothani/following{/other_user}", "gists_url": "https://api.github.com/users/HemangChothani/gists{/gist_id}", "starred_url": "https://api.github.com/users/HemangChothani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HemangChothani/subscriptions", "organizations_url": "https://api.github.com/users/HemangChothani/orgs", "repos_url": "https://api.github.com/users/HemangChothani/repos", "events_url": "https://api.github.com/users/HemangChothani/events{/privacy}", "received_events_url": "https://api.github.com/users/HemangChothani/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2019-11-27T00:42:35Z", "updated_at": "2020-06-05T06:49:09Z", "closed_at": "2020-03-24T08:14:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've seen other issues that are similar, but in the other issues, they are not using `return_immediately`. In our case, even with `return_immediately=True` the issue still happens.\r\n\r\n## Environment details\r\n\r\nLinux running on Heroku\r\nPython 3.7.4\r\ngoogle-cloud-pubsub 1.0.2\r\n\r\n#### Steps to reproduce\r\n\r\nUnfortunately, I'm unable to reproduce this on my local machine, but if happens fairly often in our production environment. If there are additional steps that would make it easier to repro let me know, I'm also happy to add more to our error reporting in production to gain more insight.\r\n\r\n#### Code example\r\n\r\nEssentially, we are just doing this (with like 5 or 6 items):\r\n```python3\r\nfor item in items_from_database_with_gcloud_credentials:\r\n    credentials = service_account.Credentials.from_service_account_info(\r\n        item.play_store_credential\r\n    )\r\n\r\n    subscriber = pubsub_v1.SubscriberClient(credentials=credentials)\r\n\r\n    try:\r\n        response = subscriber.pull(\r\n            app.google_play_pub_sub_subscription_id,\r\n            max_messages=10,\r\n            return_immediately=True,\r\n        )\r\n        for message_holder in response.received_messages:\r\n            self.__handle_message(message_holder, app)\r\n            subscriber.acknowledge(\r\n                app.google_play_pub_sub_subscription_id, [message_holder.ack_id]\r\n            )\r\n    except Exception as e:\r\n        # Handle errors here.\r\n```\r\n\r\n#### Stack trace\r\n```\r\n_Rendezvous: <_Rendezvous of RPC that terminated with:\r\n\tstatus = StatusCode.DEADLINE_EXCEEDED\r\n\tdetails = \"Deadline Exceeded\"\r\n\tdebug_error_string = \"{\"created\":\"@1574749208.529034152\",\"description\":\"Error received from peer ipv4:172.217.164.138:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1055,\"grpc_message\":\"Deadline Exceeded\",\"grpc_status\":4}\"\r\n>\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/api_core/grpc_helpers.py\", line 57, in error_remapped_callable\r\n    return callable_(*args, **kwargs)\r\n  File \"grpc/_channel.py\", line 604, in __call__\r\n    return _end_unary_response_blocking(state, call, False, None)\r\n  File \"grpc/_channel.py\", line 506, in _end_unary_response_blocking\r\n    raise _Rendezvous(state, None, None, deadline)\r\n\r\nDeadlineExceeded: 504 Deadline Exceeded\r\n  File \"/app/khepri/jobs/google_pub_sub_listener_job.py\", line 56, in _perform\r\n    return_immediately=True,\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/cloud/pubsub_v1/_gapic.py\", line 40, in <lambda>\r\n    fx = lambda self, *a, **kw: wrapped_fx(self.api, *a, **kw)  # noqa\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/cloud/pubsub_v1/gapic/subscriber_client.py\", line 1005, in pull\r\n    request, retry=retry, timeout=timeout, metadata=metadata\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/api_core/gapic_v1/method.py\", line 143, in __call__\r\n    return wrapped_func(*args, **kwargs)\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/api_core/retry.py\", line 277, in retry_wrapped_func\r\n    on_error=on_error,\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/api_core/retry.py\", line 182, in retry_target\r\n    return target()\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/api_core/timeout.py\", line 214, in func_with_timeout\r\n    return func(*args, **kwargs)\r\n  File \"/app/.heroku/python/lib/python3.7/site-packages/google/api_core/grpc_helpers.py\", line 59, in error_remapped_callable\r\n    six.raise_from(exceptions.from_grpc_error(exc), exc)\r\n  File \"<string>\", line 3, in raise_from\r\n    # Permission is hereby granted, free of charge, to any person obtaining a copy\r\n```\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/8", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/8/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/8/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/8/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/8", "id": 558132296, "node_id": "MDU6SXNzdWU1NTgxMzIyOTY=", "number": 8, "title": "PubSub: Add more system tests covering various RBAC-related scenarios", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819579033, "node_id": "MDU6TGFiZWwxODE5NTc5MDMz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/testing", "name": "testing", "color": "bfdadc", "default": false, "description": ""}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2019-11-22T18:25:43Z", "updated_at": "2020-02-21T19:13:07Z", "closed_at": "2020-02-21T19:13:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "A [regression](https://github.com/googleapis/google-cloud-python/issues/9339) introduced not so long ago could have been prevented if we had more RBAC-related system tests. A system test covering the fix was added in googleapis/google-cloud-python#9507.\r\n\r\nSince PubSub backend defines several different [user roles](https://cloud.google.com/pubsub/docs/access-control#roles), system tests must be added to cover at least the most common use case scenarios that can be affected by the user role used in the session.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/9", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/9/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/9/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/9/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/9", "id": 558132433, "node_id": "MDU6SXNzdWU1NTgxMzI0MzM=", "number": 9, "title": "PubSub: Synchronous pull raises 504 after a few seconds if no messages available", "user": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": null, "assignees": [{"login": "HemangChothani", "id": 50404902, "node_id": "MDQ6VXNlcjUwNDA0OTAy", "avatar_url": "https://avatars3.githubusercontent.com/u/50404902?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HemangChothani", "html_url": "https://github.com/HemangChothani", "followers_url": "https://api.github.com/users/HemangChothani/followers", "following_url": "https://api.github.com/users/HemangChothani/following{/other_user}", "gists_url": "https://api.github.com/users/HemangChothani/gists{/gist_id}", "starred_url": "https://api.github.com/users/HemangChothani/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HemangChothani/subscriptions", "organizations_url": "https://api.github.com/users/HemangChothani/orgs", "repos_url": "https://api.github.com/users/HemangChothani/repos", "events_url": "https://api.github.com/users/HemangChothani/events{/privacy}", "received_events_url": "https://api.github.com/users/HemangChothani/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 7, "created_at": "2019-11-18T09:42:31Z", "updated_at": "2020-03-24T08:16:54Z", "closed_at": "2020-03-24T08:16:54Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Forked from https://github.com/googleapis/google-cloud-python/issues/7709#issuecomment-550290511.\r\n\r\n#### Environment details\r\n\r\nTested with the following:\r\n- PubSub v1.0.2\r\n- Python 3.7\r\n- Ubuntu 18.04.\r\n\r\n> It is [reported](https://github.com/googleapis/google-cloud-python/issues/7709#issuecomment-554919915) that the issue does _not_ occur with in PubSub version `v0.45.0`.\r\n~~**Update:** However, this could not be confirmed.~~\r\n[Confirmed](https://github.com/googleapis/google-cloud-python/issues/9822#issuecomment-560374261) by @HemangChothani \r\n\r\n#### Steps to reproduce\r\n\r\n1. Create a topic.\r\n1. Create a subscription.\r\n1. With no messages published to the topic, perform a _synchronous_ pull. \r\n\r\n**Actual result:**\r\nAfter a few seconds a 504 DeadlineExceeded exception is raised.\r\n\r\n**Expected result:**\r\nAssuming that the network functions normally, there should be no error, and the `subscriber.pull()` should simply return an empty list of messages.\r\n\r\nMind that there is no error if the `return_immediately=True` flag is used, but the latter is set to be deprecated and should thus not be used.\r\n\r\n### Code sample\r\n\r\nThe following script might be useful:\r\n<details>\r\n<summary>reproduce.py</summary>\r\n\r\n```python\r\nimport logging\r\nimport os\r\nimport threading\r\nimport time\r\n\r\nfrom google.cloud import pubsub_v1\r\n\r\n\r\nscript_dir = os.path.dirname(os.path.realpath(__file__))\r\nlog_filename = os.path.join(script_dir, \"subscriber.log\")\r\n\r\nlog_format = (\r\n    \"%(levelname)-8s [%(asctime)s] %(threadName)-33s \"\r\n    \"[%(name)s] [%(filename)s:%(lineno)d][%(funcName)s] %(message)s\"\r\n)\r\n\r\nlogging.basicConfig(\r\n    level=logging.DEBUG,\r\n    format=log_format,\r\n)\r\n\r\nlogger = logging.getLogger(__name__)\r\n\r\nPROJECT_NAME = \"my-project\"\r\nTOPIC_NAME = \"my-events\"\r\nSUBSCRIPTION_NAME = f\"subscription_{TOPIC_NAME}\"\r\n\r\n\r\ndef main():\r\n    subscriber = pubsub_v1.SubscriberClient()\r\n\r\n    subscription_path = subscriber.subscription_path(PROJECT_NAME, SUBSCRIPTION_NAME)\r\n    topic_path = subscriber.topic_path(PROJECT_NAME, TOPIC_NAME)\r\n    # TODO: if topic does not exist, you must first create it\r\n    subscriber.create_subscription(name=subscription_path, topic=topic_path)\r\n\r\n    print(\"Starting a pull...\")\r\n    response = subscriber.pull(\r\n        subscription_path, max_messages=3,\r\n        # return_immediately=True\r\n    )\r\n\r\n    received_messages = response.received_messages\r\n\r\n    if not received_messages:\r\n        print(\"No messages received\")\r\n        return\r\n\r\n    print(\"response >>\", response)\r\n\r\n    for message in response.received_messages:\r\n        print(message.message.data.decode(\"utf-8\"))\r\n    \r\n    print(\"Sending ACK...\")\r\n    subscriber.acknowledge(\r\n        subscription_path, [msg.ack_id for msg in response.received_messages]\r\n    )\r\n    print(\"... ACK sent.\")\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n</details>\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/10", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/10/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/10/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/10/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/10", "id": 558132597, "node_id": "MDU6SXNzdWU1NTgxMzI1OTc=", "number": 10, "title": "PubSub: custom retry settings don't work with Cloud Functions", "user": {"login": "gmdev", "id": 1126031, "node_id": "MDQ6VXNlcjExMjYwMzE=", "avatar_url": "https://avatars2.githubusercontent.com/u/1126031?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gmdev", "html_url": "https://github.com/gmdev", "followers_url": "https://api.github.com/users/gmdev/followers", "following_url": "https://api.github.com/users/gmdev/following{/other_user}", "gists_url": "https://api.github.com/users/gmdev/gists{/gist_id}", "starred_url": "https://api.github.com/users/gmdev/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gmdev/subscriptions", "organizations_url": "https://api.github.com/users/gmdev/orgs", "repos_url": "https://api.github.com/users/gmdev/repos", "events_url": "https://api.github.com/users/gmdev/events{/privacy}", "received_events_url": "https://api.github.com/users/gmdev/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "mf2199", "id": 38331387, "node_id": "MDQ6VXNlcjM4MzMxMzg3", "avatar_url": "https://avatars1.githubusercontent.com/u/38331387?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mf2199", "html_url": "https://github.com/mf2199", "followers_url": "https://api.github.com/users/mf2199/followers", "following_url": "https://api.github.com/users/mf2199/following{/other_user}", "gists_url": "https://api.github.com/users/mf2199/gists{/gist_id}", "starred_url": "https://api.github.com/users/mf2199/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mf2199/subscriptions", "organizations_url": "https://api.github.com/users/mf2199/orgs", "repos_url": "https://api.github.com/users/mf2199/repos", "events_url": "https://api.github.com/users/mf2199/events{/privacy}", "received_events_url": "https://api.github.com/users/mf2199/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "mf2199", "id": 38331387, "node_id": "MDQ6VXNlcjM4MzMxMzg3", "avatar_url": "https://avatars1.githubusercontent.com/u/38331387?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mf2199", "html_url": "https://github.com/mf2199", "followers_url": "https://api.github.com/users/mf2199/followers", "following_url": "https://api.github.com/users/mf2199/following{/other_user}", "gists_url": "https://api.github.com/users/mf2199/gists{/gist_id}", "starred_url": "https://api.github.com/users/mf2199/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mf2199/subscriptions", "organizations_url": "https://api.github.com/users/mf2199/orgs", "repos_url": "https://api.github.com/users/mf2199/repos", "events_url": "https://api.github.com/users/mf2199/events{/privacy}", "received_events_url": "https://api.github.com/users/mf2199/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2019-10-22T18:53:56Z", "updated_at": "2020-05-27T23:52:54Z", "closed_at": "2020-05-27T23:52:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a Cloud Function triggered by Pub/Sub and I would like to configure custom retry times as specified in the following docs:\r\n\r\nhttps://cloud.google.com/functions/docs/bestpractices/retries\r\nhttps://cloud.google.com/pubsub/docs/publisher#retry\r\n\r\nHere is the code:\r\n\r\n```python\r\nfrom google.cloud.pubsub_v1 import PublisherClient\r\n\r\nretry_settings = {\r\n    'interfaces': {\r\n        'google.pubsub.v1.Publisher': {\r\n            'retry_params': {\r\n                'messaging': {'initial_retry_delay_millis': 30000},\r\n                'default': {'initial_retry_delay_millis': 30000},\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nPubSubPublisher(\r\n    publisher=PublisherClient(client_config=retry_settings),\r\n    project_id='some_project',\r\n)\r\n```\r\n\r\nRetry is enabled for the subscriber (`--retry` flag passed on deploy). We are using `python37` runtime.\r\n\r\nThe problem is, while it merges the configs properly, it doesn't seem to actually apply the configuration. The retry delay seems to be still the default 100ms.\r\n\r\nOne thing that I suspect may be the issue here is that Python libs only allow configuring the delay for `messaging` and not `streaming_messaging` (as `retry_params_def ` seen here: https://github.com/googleapis/googleapis/blob/master/google/pubsub/v1/pubsub_gapic.yaml ). I might be wrong, but If Google Cloud Functions use Streaming Pull, this would likely be the cause.\r\n\r\nPotential solution: allow configuring `streaming_messaging` in `retry_params`.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/11", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/11/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/11/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/11/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/11", "id": 558132800, "node_id": "MDU6SXNzdWU1NTgxMzI4MDA=", "number": 11, "title": "PubSub: Unexpected behavior for 2 or more subscribes with the same scheduler", "user": {"login": "LukasSlouka", "id": 12278213, "node_id": "MDQ6VXNlcjEyMjc4MjEz", "avatar_url": "https://avatars3.githubusercontent.com/u/12278213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LukasSlouka", "html_url": "https://github.com/LukasSlouka", "followers_url": "https://api.github.com/users/LukasSlouka/followers", "following_url": "https://api.github.com/users/LukasSlouka/following{/other_user}", "gists_url": "https://api.github.com/users/LukasSlouka/gists{/gist_id}", "starred_url": "https://api.github.com/users/LukasSlouka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LukasSlouka/subscriptions", "organizations_url": "https://api.github.com/users/LukasSlouka/orgs", "repos_url": "https://api.github.com/users/LukasSlouka/repos", "events_url": "https://api.github.com/users/LukasSlouka/events{/privacy}", "received_events_url": "https://api.github.com/users/LukasSlouka/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2019-10-17T12:35:15Z", "updated_at": "2020-05-15T08:15:16Z", "closed_at": "2020-05-15T08:13:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "#### Environment details\r\n\r\nOS: Ubuntu 18.04.3 LTS\r\nPython version: 3.7.4\r\ngoogle-cloud-pubsub version: 1.0.2\r\n\r\n#### Steps to reproduce\r\n\r\n  1. Set up a GCP project with enabled Pub/Sub and set up local environment so that the scripts can connect to it.\r\n  2. Run `server.py` (in code examples below). It should create 2 topics (`topic_a` and `topic_b`) and subscriptions to them and start listening to those subscriptions. Notice that scheduler is passed as an argument to receive messages (documentation does not indicate that this should cause any troubles)\r\n 3. Open a new terminal window and run `python3.7 client.py topic_a &` and `python3.7 client.py topic_b &`. This should start sending messages to both topics. (code in the examples below)\r\n 4. The server will output some details about all published messages on both topics. Look at the unacked messages on both subscriptions in the GCP console or stack driver. You will see that some messages are still in the pubsub (which ones is quite random). If you try to pull them, nothing is returned.\r\n 5. Terminate the running server.\r\n 6. Pull messages from either subscription - you should be able to retrieve all of them. Notice that these messages have been processed by the server, but it is as if the `ack` did nothing.\r\n 7. If you restart the server, it will process some of the messages again and some may even be acked out of the subscription. \r\n\r\nWhole time there are no error logs or exceptions thrown, messages are just stuck in the subscription even after being acked. If you change the server code to instantiate thread scheduler inside of the `receive_messages` function, everything works as expected, therefore the shared scheduler is the problem.\r\n\r\n#### Code example\r\n\r\nserver.py\r\n```python\r\nimport concurrent.futures.thread\r\nimport os\r\nimport time\r\n\r\nfrom google.api_core.exceptions import AlreadyExists\r\nfrom google.cloud import pubsub_v1\r\nfrom google.cloud.pubsub_v1.subscriber.scheduler import ThreadScheduler\r\n\r\n\r\ndef create_subscription(project_id, topic_name, subscription_name):\r\n    \"\"\"Create a new pull subscription on the given topic.\"\"\"\r\n    subscriber = pubsub_v1.SubscriberClient()\r\n    topic_path = subscriber.topic_path(project_id, topic_name)\r\n    subscription_path = subscriber.subscription_path(\r\n        project_id, subscription_name)\r\n\r\n    subscription = subscriber.create_subscription(\r\n        subscription_path, topic_path)\r\n\r\n    print('Subscription created: {}'.format(subscription))\r\n\r\n\r\ndef receive_messages(project_id, subscription_name, t_scheduler):\r\n    \"\"\"Receives messages from a pull subscription.\"\"\"\r\n    subscriber = pubsub_v1.SubscriberClient()\r\n    subscription_path = subscriber.subscription_path(\r\n        project_id, subscription_name)\r\n\r\n    def callback(message):\r\n        print('Received message: {}'.format(message.data))\r\n        message.ack()\r\n\r\n    subscriber.subscribe(subscription_path, callback=callback, scheduler=t_scheduler)\r\n    print('Listening for messages on {}'.format(subscription_path))\r\n\r\n\r\nproject_id = os.getenv(\"PUBSUB_PROJECT_ID\")\r\n\r\npublisher = pubsub_v1.PublisherClient()\r\nproject_path = publisher.project_path(project_id)\r\n\r\n# Create both topics\r\ntry:\r\n    topics = [topic.name.split('/')[-1] for topic in publisher.list_topics(project_path)]\r\n    if 'topic_a' not in topics:\r\n        publisher.create_topic(publisher.topic_path(project_id, 'topic_a'))\r\n    if 'topic_b' not in topics:\r\n        publisher.create_topic(publisher.topic_path(project_id, 'topic_b'))\r\nexcept AlreadyExists:\r\n    print('Topics already exists')\r\n\r\n# Create subscriptions on both topics\r\nsub_client = pubsub_v1.SubscriberClient()\r\nproject_path = sub_client.project_path(project_id)\r\n\r\ntry:\r\n    subs = [sub.name.split('/')[-1] for sub in sub_client.list_subscriptions(project_path)]\r\n    if 'topic_a_sub' not in subs:\r\n        create_subscription(project_id, 'topic_a', 'topic_a_sub')\r\n    if 'topic_b_sub' not in subs:\r\n        create_subscription(project_id, 'topic_b', 'topic_b_sub')\r\nexcept AlreadyExists:\r\n    print('Subscriptions already exists')\r\n\r\nscheduler = ThreadScheduler(concurrent.futures.thread.ThreadPoolExecutor(10))\r\n\r\nreceive_messages(project_id, 'topic_a_sub', scheduler)\r\nreceive_messages(project_id, 'topic_b_sub', scheduler)\r\n\r\nwhile True:\r\n    time.sleep(60)\r\n```\r\n\r\nclient.py\r\n```python\r\nimport datetime\r\nimport os\r\nimport random\r\nimport sys\r\nfrom time import sleep\r\n\r\nfrom google.cloud import pubsub_v1\r\n\r\n\r\ndef publish_messages(pid, topic_name):\r\n    \"\"\"Publishes multiple messages to a Pub/Sub topic.\"\"\"\r\n    publisher = pubsub_v1.PublisherClient()\r\n    topic_path = publisher.topic_path(pid, topic_name)\r\n\r\n    for n in range(1, 10):\r\n        data = '[{} - {}] Message number {}'.format(datetime.datetime.now().isoformat(), topic_name, n)\r\n        data = data.encode('utf-8')\r\n        publisher.publish(topic_path, data=data)\r\n        sleep(random.randint(10, 50) / 10.0)\r\n\r\n\r\nproject_id = os.getenv(\"PUBSUB_PROJECT_ID\")\r\npublish_messages(project_id, sys.argv[1])\r\n```\r\n\r\nI have created the [stack overflow thread](https://stackoverflow.com/questions/58289804/gcp-message-stays-in-the-pub-sub-after-acknowledge/58313340#58313340) first, then did my own testing. \r\n\r\n\r\nI would expect that using the same scheduler would not cause any difference in behavior or at the very least some exceptions or warnings to be raised that would indicate that something is wrong. \r\n\r\nAlso, it might be a good idea to warn people not to use the same scheduler for multiple subscriptions (even to different topics) somewhere in the documentation of the library. Due to the nature of the issue (no obvious indication that something is wrong), it might get to production quite easily. ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/12", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/12/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/12/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/12/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/12", "id": 558133285, "node_id": "MDU6SXNzdWU1NTgxMzMyODU=", "number": 12, "title": "Pub/Sub: 'test_managing_subscription_iam_policy' flakes.", "user": {"login": "tseaver", "id": 242750, "node_id": "MDQ6VXNlcjI0Mjc1MA==", "avatar_url": "https://avatars2.githubusercontent.com/u/242750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tseaver", "html_url": "https://github.com/tseaver", "followers_url": "https://api.github.com/users/tseaver/followers", "following_url": "https://api.github.com/users/tseaver/following{/other_user}", "gists_url": "https://api.github.com/users/tseaver/gists{/gist_id}", "starred_url": "https://api.github.com/users/tseaver/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tseaver/subscriptions", "organizations_url": "https://api.github.com/users/tseaver/orgs", "repos_url": "https://api.github.com/users/tseaver/repos", "events_url": "https://api.github.com/users/tseaver/events{/privacy}", "received_events_url": "https://api.github.com/users/tseaver/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819579287, "node_id": "MDU6TGFiZWwxODE5NTc5Mjg3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/flaky", "name": "flaky", "color": "e99695", "default": false, "description": ""}, {"id": 1819579033, "node_id": "MDU6TGFiZWwxODE5NTc5MDMz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/testing", "name": "testing", "color": "bfdadc", "default": false, "description": ""}, {"id": 1814814908, "node_id": "MDU6TGFiZWwxODE0ODE0OTA4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20process", "name": "type: process", "color": "c5def5", "default": false, "description": "A process-releated concern. May include testing, release, or the like."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-07-19T17:30:19Z", "updated_at": "2020-05-04T15:41:04Z", "closed_at": "2020-05-04T15:41:04Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "From [this failing Kokoro job](https://source.cloud.google.com/results/invocations/a5806937-6aac-4f1a-a4c0-056400ac466f/targets/cloud-devrel%2Fclient-libraries%2Fgoogle-cloud-python%2Fpresubmit%2Fpubsub/log):\r\n\r\nBoth an error in teardown and a deadline exceeded error in the test itself:\r\n\r\n```python\r\n__________ ERROR at teardown of test_managing_subscription_iam_policy __________\r\nargs = (subscription: \"projects/precise-truck-742/subscriptions/s-1563482466681\"\r\n,)\r\nkwargs = {'metadata': [('x-goog-request-params', 'subscription=projects/precise-truck-742/subscriptions/s-1563482466681'), ('x-goog-api-client', 'gl-python/3.7.0b3 grpc/1.22.0 gax/1.14.0 gapic/0.42.1')], 'timeout': 60.0}\r\n    @six.wraps(callable_)\r\n    def error_remapped_callable(*args, **kwargs):\r\n        try:\r\n>           return callable_(*args, **kwargs)\r\n../api_core/google/api_core/grpc_helpers.py:57:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nself = <grpc._channel._UnaryUnaryMultiCallable object at 0x7f3a8c0e49e8>\r\nrequest = subscription: \"projects/precise-truck-742/subscriptions/s-1563482466681\"\r\ntimeout = 60.0\r\nmetadata = [('x-goog-request-params', 'subscription=projects/precise-truck-742/subscriptions/s-1563482466681'), ('x-goog-api-client', 'gl-python/3.7.0b3 grpc/1.22.0 gax/1.14.0 gapic/0.42.1')]\r\ncredentials = None, wait_for_ready = None, compression = None\r\n    def __call__(self,\r\n                 request,\r\n                 timeout=None,\r\n                 metadata=None,\r\n                 credentials=None,\r\n                 wait_for_ready=None,\r\n                 compression=None):\r\n        state, call, = self._blocking(request, timeout, metadata, credentials,\r\n                                      wait_for_ready, compression)\r\n>       return _end_unary_response_blocking(state, call, False, None)\r\n.nox/system-3-7/lib/python3.7/site-packages/grpc/_channel.py:565:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nstate = <grpc._channel._RPCState object at 0x7f3a876df748>\r\ncall = <grpc._cython.cygrpc.SegregatedCall object at 0x7f3a876c1488>\r\nwith_call = False, deadline = None\r\n    def _end_unary_response_blocking(state, call, with_call, deadline):\r\n        if state.code is grpc.StatusCode.OK:\r\n            if with_call:\r\n                rendezvous = _Rendezvous(state, call, None, deadline)\r\n                return state.response, rendezvous\r\n            else:\r\n                return state.response\r\n        else:\r\n>           raise _Rendezvous(state, None, None, deadline)\r\nE           grpc._channel._Rendezvous: <_Rendezvous of RPC that terminated with:\r\nE           \tstatus = StatusCode.NOT_FOUND\r\nE           \tdetails = \"Resource not found (resource=s-1563482466681).\"\r\nE           \tdebug_error_string = \"{\"created\":\"@1563482529.379329190\",\"description\":\"Error received from peer ipv4:74.125.20.95:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1052,\"grpc_message\":\"Resource not found (resource=s-1563482466681).\",\"grpc_status\":5}\"\r\nE           >\r\n.nox/system-3-7/lib/python3.7/site-packages/grpc/_channel.py:467: _Rendezvous\r\nThe above exception was the direct cause of the following exception:\r\n    @pytest.fixture\r\n    def cleanup():\r\n        registry = []\r\n        yield registry\r\n        # Perform all clean up.\r\n        for to_call, argument in registry:\r\n>           to_call(argument)\r\ntests/system.py:72:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ngoogle/cloud/pubsub_v1/_gapic.py:40: in <lambda>\r\n    fx = lambda self, *a, **kw: wrapped_fx(self.api, *a, **kw)  # noqa\r\ngoogle/cloud/pubsub_v1/gapic/subscriber_client.py:729: in delete_subscription\r\n    request, retry=retry, timeout=timeout, metadata=metadata\r\n../api_core/google/api_core/gapic_v1/method.py:143: in __call__\r\n    return wrapped_func(*args, **kwargs)\r\n../api_core/google/api_core/retry.py:273: in retry_wrapped_func\r\n    on_error=on_error,\r\n../api_core/google/api_core/retry.py:182: in retry_target\r\n    return target()\r\n../api_core/google/api_core/timeout.py:214: in func_with_timeout\r\n    return func(*args, **kwargs)\r\n../api_core/google/api_core/grpc_helpers.py:59: in error_remapped_callable\r\n    six.raise_from(exceptions.from_grpc_error(exc), exc)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nvalue = None\r\nfrom_value = <_Rendezvous of RPC that terminated with:\r\n\tstatus = StatusCode.NOT_FOUND\r\n\tdetails = \"Resource not found (resource=s-15...b/surface/call.cc\",\"file_line\":1052,\"grpc_message\":\"Resource not found (resource=s-1563482466681).\",\"grpc_status\":5}\"\r\n>\r\n>   ???\r\nE   google.api_core.exceptions.NotFound: 404 Resource not found (resource=s-1563482466681).\r\n<string>:3: NotFound\r\n=================================== FAILURES ===================================\r\n____________________ test_managing_subscription_iam_policy _____________________\r\nargs = (name: \"projects/precise-truck-742/subscriptions/s-1563482466681\"\r\ntopic: \"projects/precise-truck-742/topics/t-1563482466681\"\r\n,)\r\nkwargs = {'metadata': [('x-goog-request-params', 'name=projects/precise-truck-742/subscriptions/s-1563482466681'), ('x-goog-api-client', 'gl-python/3.7.0b3 grpc/1.22.0 gax/1.14.0 gapic/0.42.1')], 'timeout': 60.0}\r\n    @six.wraps(callable_)\r\n    def error_remapped_callable(*args, **kwargs):\r\n        try:\r\n>           return callable_(*args, **kwargs)\r\n../api_core/google/api_core/grpc_helpers.py:57:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nself = <grpc._channel._UnaryUnaryMultiCallable object at 0x7f3a8c0e4860>\r\nrequest = name: \"projects/precise-truck-742/subscriptions/s-1563482466681\"\r\ntopic: \"projects/precise-truck-742/topics/t-1563482466681\"\r\ntimeout = 60.0\r\nmetadata = [('x-goog-request-params', 'name=projects/precise-truck-742/subscriptions/s-1563482466681'), ('x-goog-api-client', 'gl-python/3.7.0b3 grpc/1.22.0 gax/1.14.0 gapic/0.42.1')]\r\ncredentials = None, wait_for_ready = None, compression = None\r\n    def __call__(self,\r\n                 request,\r\n                 timeout=None,\r\n                 metadata=None,\r\n                 credentials=None,\r\n                 wait_for_ready=None,\r\n                 compression=None):\r\n        state, call, = self._blocking(request, timeout, metadata, credentials,\r\n                                      wait_for_ready, compression)\r\n>       return _end_unary_response_blocking(state, call, False, None)\r\n.nox/system-3-7/lib/python3.7/site-packages/grpc/_channel.py:565:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nstate = <grpc._channel._RPCState object at 0x7f3a8c0ad400>\r\ncall = <grpc._cython.cygrpc.SegregatedCall object at 0x7f3a8c0a31c8>\r\nwith_call = False, deadline = None\r\n    def _end_unary_response_blocking(state, call, with_call, deadline):\r\n        if state.code is grpc.StatusCode.OK:\r\n            if with_call:\r\n                rendezvous = _Rendezvous(state, call, None, deadline)\r\n                return state.response, rendezvous\r\n            else:\r\n                return state.response\r\n        else:\r\n>           raise _Rendezvous(state, None, None, deadline)\r\nE           grpc._channel._Rendezvous: <_Rendezvous of RPC that terminated with:\r\nE           \tstatus = StatusCode.DEADLINE_EXCEEDED\r\nE           \tdetails = \"Deadline Exceeded\"\r\nE           \tdebug_error_string = \"{\"created\":\"@1563482527.877760235\",\"description\":\"Error received from peer ipv4:74.125.20.95:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1052,\"grpc_message\":\"Deadline Exceeded\",\"grpc_status\":4}\"\r\nE           >\r\n.nox/system-3-7/lib/python3.7/site-packages/grpc/_channel.py:467: _Rendezvous\r\nThe above exception was the direct cause of the following exception:\r\npublisher = <google.cloud.pubsub_v1.PublisherClient object at 0x7f3a8e7fdc18>\r\nsubscriber = <google.cloud.pubsub_v1.SubscriberClient object at 0x7f3a8c0e4128>\r\ntopic_path = 'projects/precise-truck-742/topics/t-1563482466681'\r\nsubscription_path = 'projects/precise-truck-742/subscriptions/s-1563482466681'\r\ncleanup = [(<bound method PublisherClient.delete_topic of <google.cloud.pubsub_v1.PublisherClient object at 0x7f3a8e7fdc18>>, 'p...oud.pubsub_v1.SubscriberClient object at 0x7f3a8c0e4128>>, 'projects/precise-truck-742/subscriptions/s-1563482466681')]\r\n    def test_managing_subscription_iam_policy(\r\n        publisher, subscriber, topic_path, subscription_path, cleanup\r\n    ):\r\n        # Make sure the topic and subscription get deleted.\r\n        cleanup.append((publisher.delete_topic, topic_path))\r\n        cleanup.append((subscriber.delete_subscription, subscription_path))\r\n        # create a topic and a subscription, customize the latter's policy\r\n        publisher.create_topic(topic_path)\r\n>       subscriber.create_subscription(subscription_path, topic_path)\r\ntests/system.py:335:\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ngoogle/cloud/pubsub_v1/_gapic.py:40: in <lambda>\r\n    fx = lambda self, *a, **kw: wrapped_fx(self.api, *a, **kw)  # noqa\r\ngoogle/cloud/pubsub_v1/gapic/subscriber_client.py:398: in create_subscription\r\n    request, retry=retry, timeout=timeout, metadata=metadata\r\n../api_core/google/api_core/gapic_v1/method.py:143: in __call__\r\n    return wrapped_func(*args, **kwargs)\r\n../api_core/google/api_core/retry.py:273: in retry_wrapped_func\r\n    on_error=on_error,\r\n../api_core/google/api_core/retry.py:182: in retry_target\r\n    return target()\r\n../api_core/google/api_core/timeout.py:214: in func_with_timeout\r\n    return func(*args, **kwargs)\r\n../api_core/google/api_core/grpc_helpers.py:59: in error_remapped_callable\r\n    six.raise_from(exceptions.from_grpc_error(exc), exc)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\nvalue = None\r\nfrom_value = <_Rendezvous of RPC that terminated with:\r\n\tstatus = StatusCode.DEADLINE_EXCEEDED\r\n\tdetails = \"Deadline Exceeded\"\r\n\tdebug...0.95:443\",\"file\":\"src/core/lib/surface/call.cc\",\"file_line\":1052,\"grpc_message\":\"Deadline Exceeded\",\"grpc_status\":4}\"\r\n>\r\n>   ???\r\nE   google.api_core.exceptions.DeadlineExceeded: 504 Deadline Exceeded\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/13", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/13/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/13/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/13/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/13", "id": 558133507, "node_id": "MDU6SXNzdWU1NTgxMzM1MDc=", "number": 13, "title": "PubSub: Implement SubscriberClient.get_snapshot method", "user": {"login": "ostrokach", "id": 5614375, "node_id": "MDQ6VXNlcjU2MTQzNzU=", "avatar_url": "https://avatars2.githubusercontent.com/u/5614375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ostrokach", "html_url": "https://github.com/ostrokach", "followers_url": "https://api.github.com/users/ostrokach/followers", "following_url": "https://api.github.com/users/ostrokach/following{/other_user}", "gists_url": "https://api.github.com/users/ostrokach/gists{/gist_id}", "starred_url": "https://api.github.com/users/ostrokach/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ostrokach/subscriptions", "organizations_url": "https://api.github.com/users/ostrokach/orgs", "repos_url": "https://api.github.com/users/ostrokach/repos", "events_url": "https://api.github.com/users/ostrokach/events{/privacy}", "received_events_url": "https://api.github.com/users/ostrokach/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819575643, "node_id": "MDU6TGFiZWwxODE5NTc1NjQz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/codegen", "name": "codegen", "color": "e99695", "default": false, "description": ""}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2019-07-01T21:42:18Z", "updated_at": "2020-06-05T15:08:22Z", "closed_at": "2020-06-05T15:08:21Z", "author_association": "NONE", "active_lock_reason": null, "body": " **Is your feature request related to a problem? Please describe.**\r\n\r\nI need to make sure that a specific topic, subscription, and snapshot have already been created. In the case of topic and subscription, I can do something like:\r\n\r\n```python\r\ntry:\r\n    _ = pub_client.get_topic(self.location)\r\n    _ = sub_client.get_subscription(self.subscription_path)\r\nexcept NotFound:\r\n    ...\r\n```\r\n\r\nHowever, in the case of snapshot, I have to do something like:\r\n\r\n```python\r\nsnapshot_exists = False\r\nfor element in sub_client.list_snapshots(project):\r\n    if element.name == \"snapshot_name\":\r\n        snapshot_exists = True\r\n```\r\nwhich is both inelegant and inefficient.\r\n\r\n **Describe the solution you'd like**\r\n\r\nI would like the PubSub `SubscriberClient` to have a `.get_snapshot(...)` method. There seems to be a [`GetSnapshotRequest`](https://cloud.google.com/pubsub/docs/reference/rest/v1/GetSnapshotRequest) endpoint, so I am not sure why this method is not available? \r\n\r\n **Describe alternatives you've considered**\r\n\r\nSee the code snippet above.\r\n\r\n **Additional context**\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/14", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/14/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/14/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/14/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/14", "id": 558133689, "node_id": "MDU6SXNzdWU1NTgxMzM2ODk=", "number": 14, "title": "Pub/Sub: configure GRPC timeout when publishing a message", "user": {"login": "asnr", "id": 3961287, "node_id": "MDQ6VXNlcjM5NjEyODc=", "avatar_url": "https://avatars0.githubusercontent.com/u/3961287?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asnr", "html_url": "https://github.com/asnr", "followers_url": "https://api.github.com/users/asnr/followers", "following_url": "https://api.github.com/users/asnr/following{/other_user}", "gists_url": "https://api.github.com/users/asnr/gists{/gist_id}", "starred_url": "https://api.github.com/users/asnr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asnr/subscriptions", "organizations_url": "https://api.github.com/users/asnr/orgs", "repos_url": "https://api.github.com/users/asnr/repos", "events_url": "https://api.github.com/users/asnr/events{/privacy}", "received_events_url": "https://api.github.com/users/asnr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819572777, "node_id": "MDU6TGFiZWwxODE5NTcyNzc3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/backend", "name": "backend", "color": "bfdadc", "default": false, "description": ""}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": {"login": "meredithslota", "id": 5223152, "node_id": "MDQ6VXNlcjUyMjMxNTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5223152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meredithslota", "html_url": "https://github.com/meredithslota", "followers_url": "https://api.github.com/users/meredithslota/followers", "following_url": "https://api.github.com/users/meredithslota/following{/other_user}", "gists_url": "https://api.github.com/users/meredithslota/gists{/gist_id}", "starred_url": "https://api.github.com/users/meredithslota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meredithslota/subscriptions", "organizations_url": "https://api.github.com/users/meredithslota/orgs", "repos_url": "https://api.github.com/users/meredithslota/repos", "events_url": "https://api.github.com/users/meredithslota/events{/privacy}", "received_events_url": "https://api.github.com/users/meredithslota/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "meredithslota", "id": 5223152, "node_id": "MDQ6VXNlcjUyMjMxNTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5223152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meredithslota", "html_url": "https://github.com/meredithslota", "followers_url": "https://api.github.com/users/meredithslota/followers", "following_url": "https://api.github.com/users/meredithslota/following{/other_user}", "gists_url": "https://api.github.com/users/meredithslota/gists{/gist_id}", "starred_url": "https://api.github.com/users/meredithslota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meredithslota/subscriptions", "organizations_url": "https://api.github.com/users/meredithslota/orgs", "repos_url": "https://api.github.com/users/meredithslota/repos", "events_url": "https://api.github.com/users/meredithslota/events{/privacy}", "received_events_url": "https://api.github.com/users/meredithslota/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2019-06-26T19:42:47Z", "updated_at": "2020-04-15T01:04:17Z", "closed_at": "2020-04-15T01:04:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'd like to control the timeout of the underlying GRPC API calls when publishing a pubsub message. Currently, even if my application times out on the future returned when publishing a message,\r\n\r\n```py\r\nmessage_future = publisher.publish(\r\n    TOPIC_PATH,\r\n    \"I'm going to timeout\"\r\n)\r\ntry:\r\n    message_future.exception(timeout=10)  # 10 second timeout\r\nexcept Exception as exception:\r\n    # A timeout throws an exception and lands here\r\n    logger.info(\"Exception raised: {}\".format(exception))\r\n```\r\n\r\nthe underlying GRPC API call will continue retrying in its batch thread for 10 minutes (this time period is hard-coded [here](https://github.com/googleapis/google-cloud-python/blob/021e3fbef2fec6af38182bd37b5609022898f5ae/pubsub/google/cloud/pubsub_v1/gapic/publisher_client_config.py#L26)).\r\n\r\nThis makes it hard to reason about the behaviour of an application during intermittent pubsub client/server failures (which we commonly observe in production). For example, if some portion of our fleet of servers begin to receive 5xx errors when publishing, what happens when the failures stop after several minutes? (Again, this is something we observe in production regularly). How many duplicates of the same message will be successfully published? Each of our workers have their own internal retry mechanisms, and then if those retries fail, that work will be picked up again by another worker. Potentially, we could have several workers, each with several batch threads, trying to publish the same message that will suddenly succeed all at once, causing us to fill the downstream pubsub queue with duplicates.\r\n\r\nJust how many duplicates will get published depends on the details of how we clean up our workers and retry work, but I want to emphasise that this is hard to reason about (Will the batch threads shut down cleanly when a worker finishes working? What does this depend on?) and even harder to protect against future changes with tests/documentation.\r\n\r\nOther Pub/Sub APIs allow the application to tune the underlying GRPC timeout, e.g. [`modify_ack_deadline`](https://googleapis.github.io/google-cloud-python/latest/pubsub/subscriber/api/client.html#google.cloud.pubsub_v1.subscriber.client.Client.modify_ack_deadline), which passes the `timeout` parameter to the GRPC client [here](https://github.com/googleapis/google-cloud-python/blob/021e3fbef2fec6af38182bd37b5609022898f5ae/pubsub/google/cloud/pubsub_v1/gapic/subscriber_client.py#L803-L805). This might be difficult to replicate exactly as the client batches together messages to publish in the background, but even being able to set a default timeout at the client level, e.g.\r\n\r\n```py\r\n# Default 10 second timeout for all methods of this instance\r\nclient = google.cloud.pubsub.PublisherClient(\r\n    default_grpc_timeout=10\r\n)\r\n# Underlying grpc call times out after 10 seconds\r\nclient.publish(TOPIC, message)\r\n```\r\n\r\nwould be immensely helpful.\r\n\r\n\r\n#### Environment details\r\n\r\nOS type and version: 4.9.125-linuxkit GNU/Linux\r\nPython version and virtual environment information: Python 2.7.16\r\ngoogle-cloud-pubsub package version: 0.42.1\r\n\r\n\r\n#### Steps to reproduce & code example\r\n\r\nSee this [gist](https://gist.github.com/asnr/36b7f6ee7e2f31f50b1d07020e6ba3f9).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/15", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/15/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/15/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/15/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/15", "id": 558133873, "node_id": "MDU6SXNzdWU1NTgxMzM4NzM=", "number": 15, "title": "Pub/Sub: double definitions for lots of class properties", "user": {"login": "anguillanneuf", "id": 9518298, "node_id": "MDQ6VXNlcjk1MTgyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9518298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anguillanneuf", "html_url": "https://github.com/anguillanneuf", "followers_url": "https://api.github.com/users/anguillanneuf/followers", "following_url": "https://api.github.com/users/anguillanneuf/following{/other_user}", "gists_url": "https://api.github.com/users/anguillanneuf/gists{/gist_id}", "starred_url": "https://api.github.com/users/anguillanneuf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anguillanneuf/subscriptions", "organizations_url": "https://api.github.com/users/anguillanneuf/orgs", "repos_url": "https://api.github.com/users/anguillanneuf/repos", "events_url": "https://api.github.com/users/anguillanneuf/events{/privacy}", "received_events_url": "https://api.github.com/users/anguillanneuf/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814815007, "node_id": "MDU6TGFiZWwxODE0ODE1MDA3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20docs", "name": "type: docs", "color": "0000A0", "default": false, "description": "Improvement to the documentation for an API."}], "state": "closed", "locked": false, "assignee": {"login": "anguillanneuf", "id": 9518298, "node_id": "MDQ6VXNlcjk1MTgyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9518298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anguillanneuf", "html_url": "https://github.com/anguillanneuf", "followers_url": "https://api.github.com/users/anguillanneuf/followers", "following_url": "https://api.github.com/users/anguillanneuf/following{/other_user}", "gists_url": "https://api.github.com/users/anguillanneuf/gists{/gist_id}", "starred_url": "https://api.github.com/users/anguillanneuf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anguillanneuf/subscriptions", "organizations_url": "https://api.github.com/users/anguillanneuf/orgs", "repos_url": "https://api.github.com/users/anguillanneuf/repos", "events_url": "https://api.github.com/users/anguillanneuf/events{/privacy}", "received_events_url": "https://api.github.com/users/anguillanneuf/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "anguillanneuf", "id": 9518298, "node_id": "MDQ6VXNlcjk1MTgyOTg=", "avatar_url": "https://avatars0.githubusercontent.com/u/9518298?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anguillanneuf", "html_url": "https://github.com/anguillanneuf", "followers_url": "https://api.github.com/users/anguillanneuf/followers", "following_url": "https://api.github.com/users/anguillanneuf/following{/other_user}", "gists_url": "https://api.github.com/users/anguillanneuf/gists{/gist_id}", "starred_url": "https://api.github.com/users/anguillanneuf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anguillanneuf/subscriptions", "organizations_url": "https://api.github.com/users/anguillanneuf/orgs", "repos_url": "https://api.github.com/users/anguillanneuf/repos", "events_url": "https://api.github.com/users/anguillanneuf/events{/privacy}", "received_events_url": "https://api.github.com/users/anguillanneuf/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2019-06-12T19:21:19Z", "updated_at": "2020-03-16T16:42:07Z", "closed_at": "2020-03-16T16:42:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The [documentation](https://googleapis.github.io/google-cloud-python/latest/pubsub/types.html#google.cloud.pubsub_v1.types.AcknowledgeRequest) for `pubsub_v1.types` shows lots of double definitions: a true definition, plus one that just says `field ....`. ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/16", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/16/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/16/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/16/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/16", "id": 558134142, "node_id": "MDU6SXNzdWU1NTgxMzQxNDI=", "number": 16, "title": "Pubsub: Consider a blocking publisher to prevent OOMing", "user": {"login": "evanj", "id": 675151, "node_id": "MDQ6VXNlcjY3NTE1MQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/675151?v=4", "gravatar_id": "", "url": "https://api.github.com/users/evanj", "html_url": "https://github.com/evanj", "followers_url": "https://api.github.com/users/evanj/followers", "following_url": "https://api.github.com/users/evanj/following{/other_user}", "gists_url": "https://api.github.com/users/evanj/gists{/gist_id}", "starred_url": "https://api.github.com/users/evanj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/evanj/subscriptions", "organizations_url": "https://api.github.com/users/evanj/orgs", "repos_url": "https://api.github.com/users/evanj/repos", "events_url": "https://api.github.com/users/evanj/events{/privacy}", "received_events_url": "https://api.github.com/users/evanj/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": {"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "plamut", "id": 1235663, "node_id": "MDQ6VXNlcjEyMzU2NjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1235663?v=4", "gravatar_id": "", "url": "https://api.github.com/users/plamut", "html_url": "https://github.com/plamut", "followers_url": "https://api.github.com/users/plamut/followers", "following_url": "https://api.github.com/users/plamut/following{/other_user}", "gists_url": "https://api.github.com/users/plamut/gists{/gist_id}", "starred_url": "https://api.github.com/users/plamut/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/plamut/subscriptions", "organizations_url": "https://api.github.com/users/plamut/orgs", "repos_url": "https://api.github.com/users/plamut/repos", "events_url": "https://api.github.com/users/plamut/events{/privacy}", "received_events_url": "https://api.github.com/users/plamut/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2019-05-16T21:39:24Z", "updated_at": "2020-06-02T19:09:12Z", "closed_at": "2020-06-02T19:09:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "Publishing medium-sized (32 kiB) messages in a loop causes the process's memory usage to quickly run out. I set a 2 GiB memory limit, and the process runs out of memory after publishing about 20000 messages. I believe there are two issues:\r\n\r\n1. There is no limit to the number of queued bytes in the process.\r\n2. The client library keeps 3 copies of the messages and retains them until the batch \"monitor\" thread finishes.\r\n\r\n\r\nAs far as I can see, there no good way to use the current client library to publish large batches of messages without HUGE memory consumption. I believe this can be fixed in two ways:\r\n\r\n#### Reduce memory of the current library:\r\n\r\n1. Release messages when the batch is done: In `thread.Batch._commit`, set `self._messages` to `None` after it is published. This *seems* to make memory consumption better, but I didn't test it super carefully.\r\n\r\n2. Eliminate an extra copy: Change thread.Batch to build a PubsubRequest, and pass *that* into the gapic.PublisherClient, rather than a list of messages that then need to be copied. This reduces one copy of messages, which seems to make memory consumption better (and possibly make things faster? again not tested carefully)\r\n\r\n#### Back Pressure\r\n\r\nChange the publisher to keep a queue of batches, and block after there are more than N in flight at once.\r\n\r\nI implemented a client that takes the blocking queue approach. It can publish this workload without ever exceeding 300 MiB of memory. Only 3 in-flight batches were necessary to have the process be CPU bound when running in Google Cloud, so I don't think the queue doesn't even need to be too large.\r\n\r\n\r\n\r\n#### Environment details\r\n\r\n*OS*: Linux, ContainerOS (GKE), Container is Debian9 (using distroless)\r\n*Python*: 3.5.3\r\n*API*: google-cloud-python 0.41.0\r\n\r\n\r\n\r\n#### Steps to reproduce\r\n\r\n1. Package the following program in a Docker container.\r\n2. Run it in Kubernetes with a memory limit of 2 GiB\r\n3. Watch it blow up when you run it.\r\n\r\n\r\n#### Code example\r\n\r\n```python\r\n#!/usr/bin/env python3\r\n'''\r\nCreate the topic and a subscription:\r\n\r\ngcloud pubsub topics create deleteme_publish_memleak_test\r\ngcloud pubsub subscriptions create deleteme_memleak_subscription --topic=deleteme_publish_memleak_test\r\n'''\r\n\r\nfrom google.cloud import pubsub_v1\r\nimport argparse\r\nimport google.auth\r\nimport logging\r\nimport time\r\n\r\n\r\ndef main():\r\n    parser = argparse.ArgumentParser(description='mass publish to pub/sub')\r\n    parser.add_argument('--topic',\r\n                        default='deleteme_publish_memleak_test',\r\n                        help='topic to publish to')\r\n    parser.add_argument('--messages',\r\n                        type=int,\r\n                        default=200000,\r\n                        help='number of messages to publish')\r\n    parser.add_argument('--bytes_per_message',\r\n                        type=int,\r\n                        default=32 * 1024,\r\n                        help='bytes per message to publish')\r\n    parser.add_argument('--log_every_n', type=int, default=2000, help='log every N messages')\r\n    args = parser.parse_args()\r\n\r\n    credentials, project_id = google.auth.default()\r\n    publish_client = pubsub_v1.PublisherClient(credentials=credentials)\r\n    topic_path = publish_client.topic_path(project_id, args.topic)\r\n\r\n    logging.basicConfig(\r\n        level=logging.DEBUG,\r\n        format='%(asctime)s %(levelname)s %(name)s: %(message)s',\r\n    )\r\n    logging.info('publishing %d messages to topic %s; %d bytes per message; %.1f total MiB',\r\n                 args.messages, topic_path, args.bytes_per_message,\r\n                 (args.messages * args.bytes_per_message) / 1024. / 1024.)\r\n\r\n    start = time.time()\r\n    for i in range(args.messages):\r\n        message = (i % 256).to_bytes(1, byteorder='little') * args.bytes_per_message\r\n        publish_client.publish(topic_path, message)\r\n        if i % args.log_every_n == 0:\r\n            logging.info('published %d messages', i)\r\n\r\n    end = time.time()\r\n    logging.info('done publishing in %f s', end - start)\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/17", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/17/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/17/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/17/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/17", "id": 558134335, "node_id": "MDU6SXNzdWU1NTgxMzQzMzU=", "number": 17, "title": "Pubsub: client pull ignoring KeyboardInterrupt", "user": {"login": "jjhuff", "id": 1055147, "node_id": "MDQ6VXNlcjEwNTUxNDc=", "avatar_url": "https://avatars2.githubusercontent.com/u/1055147?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jjhuff", "html_url": "https://github.com/jjhuff", "followers_url": "https://api.github.com/users/jjhuff/followers", "following_url": "https://api.github.com/users/jjhuff/following{/other_user}", "gists_url": "https://api.github.com/users/jjhuff/gists{/gist_id}", "starred_url": "https://api.github.com/users/jjhuff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jjhuff/subscriptions", "organizations_url": "https://api.github.com/users/jjhuff/orgs", "repos_url": "https://api.github.com/users/jjhuff/repos", "events_url": "https://api.github.com/users/jjhuff/events{/privacy}", "received_events_url": "https://api.github.com/users/jjhuff/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814815043, "node_id": "MDU6TGFiZWwxODE0ODE1MDQz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/:rotating_light:", "name": ":rotating_light:", "color": "FFFFFF", "default": false, "description": "This issue needs some love."}, {"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 20, "created_at": "2019-04-10T22:49:04Z", "updated_at": "2020-04-09T18:29:44Z", "closed_at": "2020-04-09T18:29:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "Pubsub/grpc seem to ignore `KeyboardInterrupt` while blocked on a client.pull. Then you end up with a `KeyError`. Seems like it'd be better to let the KeyboardInterrupt propagate up.\r\n\r\nPython 3.5.7 on a Debian stretch Docker container\r\ngoogle-api-core==1.9.0\r\ngoogle-auth==1.6.3\r\ngoogle-cloud-core==0.29.1\r\ngoogle-cloud-pubsub==0.40.0\r\ngoogle-cloud-storage==1.14.0\r\ngoogle-resumable-media==0.3.2\r\ngoogleapis-common-protos==1.5.9\r\ngrpc-google-iam-v1==0.11.4\r\n\r\n#### Code example\r\n```python\r\n        with concurrent.futures.ThreadPoolExecutor(max_workers=max_workers) as executor:\r\n            not_done = set()\r\n            while True:\r\n                if len(not_done) < batch_size/2:\r\n                    try:\r\n                        resp = self._subscriber_client.pull(self._subscription, max_messages=batch_size)\r\n                        LOG.debug(\"Got: {}\".format(len(resp.received_messages)))\r\n\r\n                        for msg in resp.received_messages:\r\n                            not_done.add(executor.submit(message_callback, msg.ack_id, msg.message))\r\n                    except google.api_core.exceptions.DeadlineExceeded:\r\n                        # Nothing in the queue, but keep trying\r\n                        pass\r\n                    except google.api_core.exceptions.RetryError:\r\n                        pass\r\n                    except KeyboardInterrupt:\r\n                        print(\"!!!!!!!!!!!\");\r\n                        break\r\n                    except Exception as e:\r\n                        LOG.error(traceback.format_exc())\r\n```\r\n\r\n#### Log/backtrace\r\n```\r\n^CKeyboardInterrupt\r\nException ignored in: 'grpc._cython.cygrpc._next'\r\nKeyboardInterrupt\r\nERROR:amplion.utils.pubsub_queue:Traceback (most recent call last):\r\n  File \"/app/amplion/utils/pubsub_queue.py\", line 108, in listen\r\n    resp = self._subscriber_client.pull(self._subscription, max_messages=batch_size)\r\n  File \"/usr/local/lib/python3.5/site-packages/google/cloud/pubsub_v1/_gapic.py\", line 45, in <lambda>\r\n    fx = lambda self, *a, **kw: wrapped_fx(self.api, *a, **kw)  # noqa\r\n  File \"/usr/local/lib/python3.5/site-packages/google/cloud/pubsub_v1/gapic/subscriber_client.py\", line 864, in pull\r\n    request, retry=retry, timeout=timeout, metadata=metadata\r\n  File \"/usr/local/lib/python3.5/site-packages/google/api_core/gapic_v1/method.py\", line 143, in __call__\r\n    return wrapped_func(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.5/site-packages/google/api_core/retry.py\", line 270, in retry_wrapped_func\r\n    on_error=on_error,\r\n  File \"/usr/local/lib/python3.5/site-packages/google/api_core/retry.py\", line 179, in retry_target\r\n    return target()\r\n  File \"/usr/local/lib/python3.5/site-packages/google/api_core/timeout.py\", line 214, in func_with_timeout\r\n    return func(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.5/site-packages/google/api_core/grpc_helpers.py\", line 57, in error_remapped_callable\r\n    return callable_(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.5/site-packages/grpc/_channel.py\", line 548, in __call__\r\n    wait_for_ready)\r\n  File \"/usr/local/lib/python3.5/site-packages/grpc/_channel.py\", line 537, in _blocking\r\n    event = call.next_event()\r\n  File \"src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi\", line 310, in grpc._cython.cygrpc.SegregatedCall.next_event\r\n  File \"src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi\", line 151, in grpc._cython.cygrpc._next_call_event\r\n  File \"src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi\", line 152, in grpc._cython.cygrpc._next_call_event\r\n  File \"src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi\", line 308, in grpc._cython.cygrpc.SegregatedCall.next_event.on_success\r\n  File \"src/python/grpcio/grpc/_cython/_cygrpc/channel.pyx.pxi\", line 282, in grpc._cython.cygrpc._process_segregated_call_tag\r\nKeyError: None\r\n\r\n```\r\n\r\nMaking sure to follow these steps will guarantee the quickest resolution possible.\r\n\r\nThanks!\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/18", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/18/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/18/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/18/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/18", "id": 558134488, "node_id": "MDU6SXNzdWU1NTgxMzQ0ODg=", "number": 18, "title": "PubSub: non-recoverable stream error, :403 User not authorized to perform...\"", "user": {"login": "vincemartin", "id": 2902794, "node_id": "MDQ6VXNlcjI5MDI3OTQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/2902794?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vincemartin", "html_url": "https://github.com/vincemartin", "followers_url": "https://api.github.com/users/vincemartin/followers", "following_url": "https://api.github.com/users/vincemartin/following{/other_user}", "gists_url": "https://api.github.com/users/vincemartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/vincemartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vincemartin/subscriptions", "organizations_url": "https://api.github.com/users/vincemartin/orgs", "repos_url": "https://api.github.com/users/vincemartin/repos", "events_url": "https://api.github.com/users/vincemartin/events{/privacy}", "received_events_url": "https://api.github.com/users/vincemartin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814815043, "node_id": "MDU6TGFiZWwxODE0ODE1MDQz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/:rotating_light:", "name": ":rotating_light:", "color": "FFFFFF", "default": false, "description": "This issue needs some love."}, {"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1819567783, "node_id": "MDU6TGFiZWwxODE5NTY3Nzgz", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/auth", "name": "auth", "color": "c5def5", "default": false, "description": ""}, {"id": 1814814968, "node_id": "MDU6TGFiZWwxODE0ODE0OTY4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/priority:%20p2", "name": "priority: p2", "color": "fef2c0", "default": false, "description": "Lowest priority. Fix may not be included in next release."}, {"id": 1814814822, "node_id": "MDU6TGFiZWwxODE0ODE0ODIy", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20bug", "name": "type: bug", "color": "db4437", "default": false, "description": "Error or flaw in code with unintended results or allowing sub-optimal usage patterns."}], "state": "closed", "locked": false, "assignee": {"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "pradn", "id": 943279, "node_id": "MDQ6VXNlcjk0MzI3OQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/943279?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pradn", "html_url": "https://github.com/pradn", "followers_url": "https://api.github.com/users/pradn/followers", "following_url": "https://api.github.com/users/pradn/following{/other_user}", "gists_url": "https://api.github.com/users/pradn/gists{/gist_id}", "starred_url": "https://api.github.com/users/pradn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pradn/subscriptions", "organizations_url": "https://api.github.com/users/pradn/orgs", "repos_url": "https://api.github.com/users/pradn/repos", "events_url": "https://api.github.com/users/pradn/events{/privacy}", "received_events_url": "https://api.github.com/users/pradn/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 9, "created_at": "2019-02-20T10:02:34Z", "updated_at": "2020-03-26T21:24:13Z", "closed_at": "2020-03-26T21:24:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "OS - Windows Server\r\nPython version - Python 2.7.15\r\nPubsub version - google-cloud-pubsub==0.39.1\r\n\r\nCode : \r\n\r\n```python\r\ndef callback(message):\r\n    logging.info('Received message {}'.format(message))\r\n    try:\r\n        filename = message.data\r\n        global queue\r\n        queue.put_nowait(filename)\r\n\r\n        global waiting_event\r\n        waiting_event.set()\r\n    except Exception as e:\r\n        logging.error(\"Callback : {}\".format(e))\r\n    finally:\r\n        message.ack()\r\n\r\ndef Run(updateDatabase_Function, topic, timeout=60.0 * 60.0):\r\n    global queue\r\n    queue = Queue()\r\n    global waiting_event\r\n    waiting_event = threading.Event()\r\n    waiting_event.clear()\r\n\r\n    credentials = GetCredentials()\r\n    subscriber = pubsub_v1.SubscriberClient(credentials=credentials)\r\n    subscription_path = subscriber.subscription_path(credentials.project_id, source)\r\n    subscriber.subscribe(subscription_path, callback=callback)\r\n```\r\n\r\nAfter several days of good behaviour, the client sent the following messages  :\r\n\r\n```\r\n2019-02-09 01:02:22,566 INFO : Observed non-recoverable stream error 403 User not authorized to perform this action.\r\n2019-02-09 01:02:22,566 INFO : RPC termination has signaled streaming pull manager shutdown.\r\n2019-02-09 01:02:22,566 INFO : Observed non-recoverable stream error 403 User not authorized to perform this action.\r\n2019-02-09 01:02:22,566 INFO : Thread-ConsumeBidirectionalStream exiting\r\n2019-02-09 01:02:22,628 INFO : Thread-LeaseMaintainer exiting.\r\n2019-02-09 01:02:22,676 INFO : Thread-Heartbeater exiting.\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/21", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/21/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/21/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/21/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/21", "id": 558134985, "node_id": "MDU6SXNzdWU1NTgxMzQ5ODU=", "number": 21, "title": "Pub/Sub - Undelivered Messages", "user": {"login": "ryanyard", "id": 1831162, "node_id": "MDQ6VXNlcjE4MzExNjI=", "avatar_url": "https://avatars1.githubusercontent.com/u/1831162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ryanyard", "html_url": "https://github.com/ryanyard", "followers_url": "https://api.github.com/users/ryanyard/followers", "following_url": "https://api.github.com/users/ryanyard/following{/other_user}", "gists_url": "https://api.github.com/users/ryanyard/gists{/gist_id}", "starred_url": "https://api.github.com/users/ryanyard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ryanyard/subscriptions", "organizations_url": "https://api.github.com/users/ryanyard/orgs", "repos_url": "https://api.github.com/users/ryanyard/repos", "events_url": "https://api.github.com/users/ryanyard/events{/privacy}", "received_events_url": "https://api.github.com/users/ryanyard/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814947, "node_id": "MDU6TGFiZWwxODE0ODE0OTQ3", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20question", "name": "type: question", "color": "c5def5", "default": false, "description": "Request for information or clarification. Not an issue."}], "state": "closed", "locked": false, "assignee": {"login": "meredithslota", "id": 5223152, "node_id": "MDQ6VXNlcjUyMjMxNTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5223152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meredithslota", "html_url": "https://github.com/meredithslota", "followers_url": "https://api.github.com/users/meredithslota/followers", "following_url": "https://api.github.com/users/meredithslota/following{/other_user}", "gists_url": "https://api.github.com/users/meredithslota/gists{/gist_id}", "starred_url": "https://api.github.com/users/meredithslota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meredithslota/subscriptions", "organizations_url": "https://api.github.com/users/meredithslota/orgs", "repos_url": "https://api.github.com/users/meredithslota/repos", "events_url": "https://api.github.com/users/meredithslota/events{/privacy}", "received_events_url": "https://api.github.com/users/meredithslota/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "meredithslota", "id": 5223152, "node_id": "MDQ6VXNlcjUyMjMxNTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5223152?v=4", "gravatar_id": "", "url": "https://api.github.com/users/meredithslota", "html_url": "https://github.com/meredithslota", "followers_url": "https://api.github.com/users/meredithslota/followers", "following_url": "https://api.github.com/users/meredithslota/following{/other_user}", "gists_url": "https://api.github.com/users/meredithslota/gists{/gist_id}", "starred_url": "https://api.github.com/users/meredithslota/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/meredithslota/subscriptions", "organizations_url": "https://api.github.com/users/meredithslota/orgs", "repos_url": "https://api.github.com/users/meredithslota/repos", "events_url": "https://api.github.com/users/meredithslota/events{/privacy}", "received_events_url": "https://api.github.com/users/meredithslota/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 18, "created_at": "2018-10-31T16:17:29Z", "updated_at": "2020-03-25T17:48:14Z", "closed_at": "2020-03-25T17:48:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "An app attempts to run 10,000 x 5 second long jobs every 10 minutes. It uses Pub/Sub as both a \"worker\" and a \"results\" queue with the results being written to BigQuery. The app is using the latest Pub/Sub Python package (0.38.0) and is hosted on GKE per the following deployments.\r\n\r\n$ kubectl get deployments\r\n\r\nNAME      DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\r\nfeeder    1         1         1            1           7m\r\nworker    64        64        64           64          7m\r\nwriter    8         8         8            8           7m\r\n\r\nNo errors and all results seem to be properly written to BigQuery. My issue is that, per Stackdriver Monitoring, I show an increasing number of undelivered messages that makes me think that duplicates are being sent even though I'm maxing the ack_deadline_seconds parameter when creating each subscription.\r\n\r\nWhen scaled down to 1,000 messages every 10 minutes, the behavior is similar; screenshot attached :-( \r\n\r\nAny thoughts to why?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/googleapis/python-pubsub/issues/22", "repository_url": "https://api.github.com/repos/googleapis/python-pubsub", "labels_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/22/labels{/name}", "comments_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/22/comments", "events_url": "https://api.github.com/repos/googleapis/python-pubsub/issues/22/events", "html_url": "https://github.com/googleapis/python-pubsub/issues/22", "id": 558135162, "node_id": "MDU6SXNzdWU1NTgxMzUxNjI=", "number": 22, "title": "Pubsub: allow registering a callback for batches of messages.", "user": {"login": "gcbirzan", "id": 784229, "node_id": "MDQ6VXNlcjc4NDIyOQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/784229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gcbirzan", "html_url": "https://github.com/gcbirzan", "followers_url": "https://api.github.com/users/gcbirzan/followers", "following_url": "https://api.github.com/users/gcbirzan/following{/other_user}", "gists_url": "https://api.github.com/users/gcbirzan/gists{/gist_id}", "starred_url": "https://api.github.com/users/gcbirzan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gcbirzan/subscriptions", "organizations_url": "https://api.github.com/users/gcbirzan/orgs", "repos_url": "https://api.github.com/users/gcbirzan/repos", "events_url": "https://api.github.com/users/gcbirzan/events{/privacy}", "received_events_url": "https://api.github.com/users/gcbirzan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1814813078, "node_id": "MDU6TGFiZWwxODE0ODEzMDc4", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/api:%20pubsub", "name": "api: pubsub", "color": "040f8e", "default": false, "description": "Issues related to the Cloud PubSub API."}, {"id": 1814814880, "node_id": "MDU6TGFiZWwxODE0ODE0ODgw", "url": "https://api.github.com/repos/googleapis/python-pubsub/labels/type:%20feature%20request", "name": "type: feature request", "color": "c5def5", "default": false, "description": "\u2018Nice-to-have\u2019 improvement, new feature or different behavior or design."}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2018-03-06T21:13:38Z", "updated_at": "2020-03-23T22:57:15Z", "closed_at": "2020-03-23T22:57:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "The old API allowed you to operate on batches of messages. Sometimes, this is advantageous as you can aggregate other calls. With the current API, this is non trivial.\r\n\r\nSo, I think (if the underlying code supports it), adding, either a parameter to open(), or another function open_many() that'll always return a list (there could be a limit in the flow control), even if it's just with one item would be useful.", "performed_via_github_app": null, "score": 1.0}]}