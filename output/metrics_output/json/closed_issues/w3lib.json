{"total_count": 29, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/scrapy/w3lib/issues/137", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/137/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/137/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/137/events", "html_url": "https://github.com/scrapy/w3lib/issues/137", "id": 494964369, "node_id": "MDU6SXNzdWU0OTQ5NjQzNjk=", "number": 137, "title": "url.add_or_replace_parameter(s) removes param values for param with multiple values", "user": {"login": "peonone", "id": 859333, "node_id": "MDQ6VXNlcjg1OTMzMw==", "avatar_url": "https://avatars0.githubusercontent.com/u/859333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peonone", "html_url": "https://github.com/peonone", "followers_url": "https://api.github.com/users/peonone/followers", "following_url": "https://api.github.com/users/peonone/following{/other_user}", "gists_url": "https://api.github.com/users/peonone/gists{/gist_id}", "starred_url": "https://api.github.com/users/peonone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peonone/subscriptions", "organizations_url": "https://api.github.com/users/peonone/orgs", "repos_url": "https://api.github.com/users/peonone/repos", "events_url": "https://api.github.com/users/peonone/events{/privacy}", "received_events_url": "https://api.github.com/users/peonone/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-09-18T03:22:18Z", "updated_at": "2020-01-29T12:50:05Z", "closed_at": "2019-09-19T07:54:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "url.add_or_replace_parameter(s) removes param values for param with multiple values, and only the last value is kept, even if the param name is not included in the param params.\r\n\r\n```\r\nurl.add_or_replace_parameter('http://example.com/?foo=1&foo=2', 'bar', '3')                 \r\n> http://example.com/?foo=2&bar=3\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/125", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/125/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/125/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/125/events", "html_url": "https://github.com/scrapy/w3lib/issues/125", "id": 418745631, "node_id": "MDU6SXNzdWU0MTg3NDU2MzE=", "number": 125, "title": "Bug in NEW add_or_replace_parameter (w3lib 1.20.0)", "user": {"login": "kuza", "id": 907855, "node_id": "MDQ6VXNlcjkwNzg1NQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/907855?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kuza", "html_url": "https://github.com/kuza", "followers_url": "https://api.github.com/users/kuza/followers", "following_url": "https://api.github.com/users/kuza/following{/other_user}", "gists_url": "https://api.github.com/users/kuza/gists{/gist_id}", "starred_url": "https://api.github.com/users/kuza/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kuza/subscriptions", "organizations_url": "https://api.github.com/users/kuza/orgs", "repos_url": "https://api.github.com/users/kuza/repos", "events_url": "https://api.github.com/users/kuza/events{/privacy}", "received_events_url": "https://api.github.com/users/kuza/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 608725056, "node_id": "MDU6TGFiZWw2MDg3MjUwNTY=", "url": "https://api.github.com/repos/scrapy/w3lib/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-03-08T11:18:53Z", "updated_at": "2019-10-16T09:20:26Z", "closed_at": "2019-10-16T09:20:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi everybody,\r\n\r\nNew add_or_replace_parameter doesn't work correctly for list parameters in url e.g.:\r\n```\r\n>>> from w3lib.url import add_or_replace_parameter\r\n>>> add_or_replace_parameter('http://example.com/?a=1&a=2', 'b', 1)\r\n'http://example.com/?a=2&b=1'\r\n```\r\nI wait `http://example.com/?a=1&a=2&b=1` but get `http://example.com/?a=2&b=1`, also I don't have this problem with w3lib 1.19.0.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/120", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/120/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/120/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/120/events", "html_url": "https://github.com/scrapy/w3lib/issues/120", "id": 394649595, "node_id": "MDU6SXNzdWUzOTQ2NDk1OTU=", "number": 120, "title": "Many schemes for URL", "user": {"login": "maramsumanth", "id": 32808381, "node_id": "MDQ6VXNlcjMyODA4Mzgx", "avatar_url": "https://avatars0.githubusercontent.com/u/32808381?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maramsumanth", "html_url": "https://github.com/maramsumanth", "followers_url": "https://api.github.com/users/maramsumanth/followers", "following_url": "https://api.github.com/users/maramsumanth/following{/other_user}", "gists_url": "https://api.github.com/users/maramsumanth/gists{/gist_id}", "starred_url": "https://api.github.com/users/maramsumanth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maramsumanth/subscriptions", "organizations_url": "https://api.github.com/users/maramsumanth/orgs", "repos_url": "https://api.github.com/users/maramsumanth/repos", "events_url": "https://api.github.com/users/maramsumanth/events{/privacy}", "received_events_url": "https://api.github.com/users/maramsumanth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-12-28T14:33:12Z", "updated_at": "2019-03-31T10:46:57Z", "closed_at": "2019-03-31T10:46:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In the following file,\r\n```w3lib/w3lib/url.py```. \r\n\r\nThe following method checks for only 3 schemes, but there are many schemes possible out there which are valid urls.\r\n```def is_url(text):```\r\n```return text.partition(\"://\")[0] in ('file', 'http', 'https')```\r\n\r\n      ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/117", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/117/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/117/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/117/events", "html_url": "https://github.com/scrapy/w3lib/issues/117", "id": 383223398, "node_id": "MDU6SXNzdWUzODMyMjMzOTg=", "number": 117, "title": "multiple parameters for add_or_replace_parameter", "user": {"login": "ejulio", "id": 1322222, "node_id": "MDQ6VXNlcjEzMjIyMjI=", "avatar_url": "https://avatars1.githubusercontent.com/u/1322222?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ejulio", "html_url": "https://github.com/ejulio", "followers_url": "https://api.github.com/users/ejulio/followers", "following_url": "https://api.github.com/users/ejulio/following{/other_user}", "gists_url": "https://api.github.com/users/ejulio/gists{/gist_id}", "starred_url": "https://api.github.com/users/ejulio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ejulio/subscriptions", "organizations_url": "https://api.github.com/users/ejulio/orgs", "repos_url": "https://api.github.com/users/ejulio/repos", "events_url": "https://api.github.com/users/ejulio/events{/privacy}", "received_events_url": "https://api.github.com/users/ejulio/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-11-21T17:27:01Z", "updated_at": "2019-01-11T12:44:34Z", "closed_at": "2019-01-11T12:44:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Usually, when working with [`add_or_replace_parameter`](https://w3lib.readthedocs.io/en/latest/w3lib.html#w3lib.url.add_or_replace_parameter) we often end up writing something like\r\n```\r\nurl = add_or_replace_parameter(url, 'q', 'query')\r\nurl = add_or_replace_parameter(url, 'location', 'US')\r\nurl = add_or_replace_parameter(url, 'count', 10)\r\n```\r\n\r\nWhat do you think of a similar function that works with a dictionary?\r\n\r\n```\r\nurl = add_or_replace_parameters(url, {\r\n  'q': 'query',\r\n  'location': 'US',\r\n  'count': 10\r\n})\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/116", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/116/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/116/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/116/events", "html_url": "https://github.com/scrapy/w3lib/issues/116", "id": 376502365, "node_id": "MDU6SXNzdWUzNzY1MDIzNjU=", "number": 116, "title": "w3lib/encoding.py:45: DeprecationWarning: Flags not at the start of the expression", "user": {"login": "mehaase", "id": 320904, "node_id": "MDQ6VXNlcjMyMDkwNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/320904?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mehaase", "html_url": "https://github.com/mehaase", "followers_url": "https://api.github.com/users/mehaase/followers", "following_url": "https://api.github.com/users/mehaase/following{/other_user}", "gists_url": "https://api.github.com/users/mehaase/gists{/gist_id}", "starred_url": "https://api.github.com/users/mehaase/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mehaase/subscriptions", "organizations_url": "https://api.github.com/users/mehaase/orgs", "repos_url": "https://api.github.com/users/mehaase/repos", "events_url": "https://api.github.com/users/mehaase/events{/privacy}", "received_events_url": "https://api.github.com/users/mehaase/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 608725056, "node_id": "MDU6TGFiZWw2MDg3MjUwNTY=", "url": "https://api.github.com/repos/scrapy/w3lib/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-11-01T17:58:10Z", "updated_at": "2019-05-10T08:40:29Z", "closed_at": "2019-05-10T08:40:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm seeing this warning on Python 3.7. Importing the module is enough to show these warnings.\r\n\r\n```python\r\n> python -Wall\r\n/home/mhaase/.local/share/virtualenvs/starbelly-21k54S-f/lib/python3.7/site.py:165: DeprecationWarning: 'U' mode is deprecated\r\n  f = open(fullname, \"rU\")\r\n/home/mhaase/.local/share/virtualenvs/starbelly-21k54S-f/lib/python3.7/site.py:165: DeprecationWarning: 'U' mode is deprecated\r\n  f = open(fullname, \"rU\")\r\n/home/mhaase/.local/share/virtualenvs/starbelly-21k54S-f/lib/python3.7/site.py:165: DeprecationWarning: 'U' mode is deprecated\r\n  f = open(fullname, \"rU\")\r\nPython 3.7.0 (default, Sep 12 2018, 18:30:08) \r\n[GCC 8.0.1 20180414 (experimental) [trunk revision 259383]] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import w3lib.encoding\r\n/home/mhaase/.local/share/virtualenvs/starbelly-21k54S-f/lib/python3.7/site-packages/w3lib/encoding.py:45: DeprecationWarning: Flags not at the start of the expression '<\\\\s*(?:meta(?x)(?:\\\\s' (truncated)\r\n  _BODY_ENCODING_STR_RE = re.compile(_BODY_ENCODING_PATTERN, re.I)\r\n/home/mhaase/.local/share/virtualenvs/starbelly-21k54S-f/lib/python3.7/site-packages/w3lib/encoding.py:45: DeprecationWarning: Flags not at the start of the expression '<\\\\s*(?:meta(?x)(?:\\\\s' (truncated)\r\n  _BODY_ENCODING_STR_RE = re.compile(_BODY_ENCODING_PATTERN, re.I)\r\n/home/mhaase/.local/share/virtualenvs/starbelly-21k54S-f/lib/python3.7/site-packages/w3lib/encoding.py:46: DeprecationWarning: Flags not at the start of the expression b'<\\\\s*(?:meta(?x)(?:\\\\s' (truncated)\r\n  _BODY_ENCODING_BYTES_RE = re.compile(_BODY_ENCODING_PATTERN.encode('ascii'), re.I)\r\n/home/mhaase/.local/share/virtualenvs/starbelly-21k54S-f/lib/python3.7/site-packages/w3lib/encoding.py:46: DeprecationWarning: Flags not at the start of the expression b'<\\\\s*(?:meta(?x)(?:\\\\s' (truncated)\r\n  _BODY_ENCODING_BYTES_RE = re.compile(_BODY_ENCODING_PATTERN.encode('ascii'), re.I)\r\n```\r\n\r\nThis deprecation appears to result from [BPO #22493](https://bugs.python.org/issue22493): inline flags may not be used in the middle of a regex anymore. I cannot see where `encoding.py` is using inline flags, though.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/114", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/114/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/114/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/114/events", "html_url": "https://github.com/scrapy/w3lib/issues/114", "id": 373377537, "node_id": "MDU6SXNzdWUzNzMzNzc1Mzc=", "number": 114, "title": "remove_tags_with_content bug", "user": {"login": "leonharetd", "id": 10416045, "node_id": "MDQ6VXNlcjEwNDE2MDQ1", "avatar_url": "https://avatars3.githubusercontent.com/u/10416045?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leonharetd", "html_url": "https://github.com/leonharetd", "followers_url": "https://api.github.com/users/leonharetd/followers", "following_url": "https://api.github.com/users/leonharetd/following{/other_user}", "gists_url": "https://api.github.com/users/leonharetd/gists{/gist_id}", "starred_url": "https://api.github.com/users/leonharetd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leonharetd/subscriptions", "organizations_url": "https://api.github.com/users/leonharetd/orgs", "repos_url": "https://api.github.com/users/leonharetd/repos", "events_url": "https://api.github.com/users/leonharetd/events{/privacy}", "received_events_url": "https://api.github.com/users/leonharetd/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 608725056, "node_id": "MDU6TGFiZWw2MDg3MjUwNTY=", "url": "https://api.github.com/repos/scrapy/w3lib/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-10-24T09:02:19Z", "updated_at": "2019-05-09T15:56:26Z", "closed_at": "2019-05-09T15:56:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "use this \r\n`remove_tags_with_content(\"\"\"<div class=\"hqimg_related\"><div class=\"to_page\"><span>\u70ed\u70b9\u680f\u76ee</span> <s class='hotSe'></s>\"\"\", (\"s\",))`\r\nget result:\r\n`<div class=\"hqimg_related\"><div class=\"to_page\">`\r\nThere may be some mistakes\r\nthen modified the expression. \r\n`tags = '|'.join([r'<%s\\s+.*?</%s>|<%s\\s*/>' % (tag, tag, tag) for tag in which_ones])`\r\nfinally,it's work fine\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/109", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/109/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/109/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/109/events", "html_url": "https://github.com/scrapy/w3lib/issues/109", "id": 338618301, "node_id": "MDU6SXNzdWUzMzg2MTgzMDE=", "number": 109, "title": "url_query_cleaner appends ? to urls without a query string", "user": {"login": "wRAR", "id": 241039, "node_id": "MDQ6VXNlcjI0MTAzOQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/241039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wRAR", "html_url": "https://github.com/wRAR", "followers_url": "https://api.github.com/users/wRAR/followers", "following_url": "https://api.github.com/users/wRAR/following{/other_user}", "gists_url": "https://api.github.com/users/wRAR/gists{/gist_id}", "starred_url": "https://api.github.com/users/wRAR/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wRAR/subscriptions", "organizations_url": "https://api.github.com/users/wRAR/orgs", "repos_url": "https://api.github.com/users/wRAR/repos", "events_url": "https://api.github.com/users/wRAR/events{/privacy}", "received_events_url": "https://api.github.com/users/wRAR/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-07-05T15:16:33Z", "updated_at": "2018-10-05T23:17:03Z", "closed_at": "2018-10-05T23:17:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```python\r\n>>> url_query_cleaner('http://domain.tld/', ['bla'], remove=True)\r\n'http://domain.tld/?'\r\n```\r\n\r\nThis is the code which does it: `url = '?'.join([base, sep.join(querylist)]) if querylist else base` (`querylist==['']`).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/103", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/103/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/103/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/103/events", "html_url": "https://github.com/scrapy/w3lib/issues/103", "id": 301057789, "node_id": "MDU6SXNzdWUzMDEwNTc3ODk=", "number": 103, "title": "add_or_replace_parameter() when URL doesn't end on slash", "user": {"login": "stummjr", "id": 1170435, "node_id": "MDQ6VXNlcjExNzA0MzU=", "avatar_url": "https://avatars1.githubusercontent.com/u/1170435?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stummjr", "html_url": "https://github.com/stummjr", "followers_url": "https://api.github.com/users/stummjr/followers", "following_url": "https://api.github.com/users/stummjr/following{/other_user}", "gists_url": "https://api.github.com/users/stummjr/gists{/gist_id}", "starred_url": "https://api.github.com/users/stummjr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stummjr/subscriptions", "organizations_url": "https://api.github.com/users/stummjr/orgs", "repos_url": "https://api.github.com/users/stummjr/repos", "events_url": "https://api.github.com/users/stummjr/events{/privacy}", "received_events_url": "https://api.github.com/users/stummjr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-02-28T15:03:47Z", "updated_at": "2018-03-05T12:51:27Z", "closed_at": "2018-03-05T12:51:27Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Is this the expected behavior for `add_or_replace_parameter`?\r\n\r\n```python\r\n>>> from w3lib.url import add_or_replace_parameter\r\n>>> add_or_replace_parameter('http://example.com', 'foo', 'bar')\r\n'http://example.com?foo=bar'\r\n```\r\n\r\nOr should `add_or_replace_parameter` add a slash right after the netloc? Like: \r\n\r\n```http://example.com/?foo=bar```\r\n\r\nChrome seems to automatically add that slash, so I'm not sure if this should be handled by w3lib or by the http client.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/96", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/96/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/96/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/96/events", "html_url": "https://github.com/scrapy/w3lib/issues/96", "id": 246554635, "node_id": "MDU6SXNzdWUyNDY1NTQ2MzU=", "number": 96, "title": "html encoded urls", "user": {"login": "jvanasco", "id": 204779, "node_id": "MDQ6VXNlcjIwNDc3OQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/204779?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jvanasco", "html_url": "https://github.com/jvanasco", "followers_url": "https://api.github.com/users/jvanasco/followers", "following_url": "https://api.github.com/users/jvanasco/following{/other_user}", "gists_url": "https://api.github.com/users/jvanasco/gists{/gist_id}", "starred_url": "https://api.github.com/users/jvanasco/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jvanasco/subscriptions", "organizations_url": "https://api.github.com/users/jvanasco/orgs", "repos_url": "https://api.github.com/users/jvanasco/repos", "events_url": "https://api.github.com/users/jvanasco/events{/privacy}", "received_events_url": "https://api.github.com/users/jvanasco/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-07-30T00:53:47Z", "updated_at": "2019-05-09T14:26:46Z", "closed_at": "2019-05-09T14:26:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "the HTML5 spec (possibly 4) allows for urls to encode an ampersand character, which the browser will automatically decode.\r\n\r\nTo a browser, these two urls are identical:\r\n\r\n    url1 = \"http://example.com?foo=bar&bar=foo\"\r\n    url2 = \"http://example.com?foo=bar&amp;bar=foo\"\r\n\r\nTo `w3lib` (and `urlparse`) they are not:\r\n\r\n    print w3lib.url.canonicalize_url(url1)\r\n    # http://example.com/?bar=foo&foo=bar\r\n\r\n    print w3lib.url.canonicalize_url(url2)\r\n    # http://example.com/?amp=&bar=foo&foo=bar\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/90", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/90/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/90/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/90/events", "html_url": "https://github.com/scrapy/w3lib/issues/90", "id": 227307061, "node_id": "MDU6SXNzdWUyMjczMDcwNjE=", "number": 90, "title": "Header values must be of type str or bytes", "user": {"login": "jin10086", "id": 15347911, "node_id": "MDQ6VXNlcjE1MzQ3OTEx", "avatar_url": "https://avatars1.githubusercontent.com/u/15347911?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jin10086", "html_url": "https://github.com/jin10086", "followers_url": "https://api.github.com/users/jin10086/followers", "following_url": "https://api.github.com/users/jin10086/following{/other_user}", "gists_url": "https://api.github.com/users/jin10086/gists{/gist_id}", "starred_url": "https://api.github.com/users/jin10086/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jin10086/subscriptions", "organizations_url": "https://api.github.com/users/jin10086/orgs", "repos_url": "https://api.github.com/users/jin10086/repos", "events_url": "https://api.github.com/users/jin10086/events{/privacy}", "received_events_url": "https://api.github.com/users/jin10086/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-05-09T09:39:35Z", "updated_at": "2017-05-11T07:24:17Z", "closed_at": "2017-05-11T07:24:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a puzzle\uff0c\r\nwhy headers_raw_to_dict don't return to this?\r\n```\r\n>>> import w3lib.http\r\n>>> w3lib.http.headers_raw_to_dict(b\"Content-type: text/html\\n\\rAccept: gzip\\n\\n\")   \r\n{'Content-type': 'text/html', 'Accept': 'gzip'}\r\n```\r\nnow it return this \r\n```\r\n>>> import w3lib.http\r\n>>> w3lib.http.headers_raw_to_dict(b\"Content-type: text/html\\n\\rAccept: gzip\\n\\n\")   \r\n{'Content-type': ['text/html'], 'Accept': ['gzip']}\r\n```\r\ni use headers_raw_to_dict when i want to copy Request Headers from chrome,\r\n```\r\nIn [31]: copy_from_chrome = \"\"\"Accept:text/html,application/xhtml+xml,applicati\r\n    ...: on/xml;q=0.9,image/webp,*/*;q=0.8^M\r\n    ...: Accept-Encoding:gzip, deflate, sdch^M\r\n    ...: Accept-Language:zh-CN,zh;q=0.8^M\r\n    ...: Cache-Control:max-age=0^M\r\n    ...: Connection:keep-alive^M\r\n    ...: Cookie:username-pes-8888=\"2|1:0|10:1494207240|17:username-pes-8888|48:\r\n    ...: ODdmYWI4NmQtNDA0OC00Y2YzLTg3ZjYtOWE3Mzk0YmRiZTA2|3284b8f38c8d142ac8e71\r\n    ...: 21c4dfd6f04d7548ccb6680f56e74a32c5f3f9dc3d4\"^M\r\n    ...: Host:pes^M\r\n    ...: Upgrade-Insecure-Requests:1^M\r\n    ...: User-Agent:Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHT\r\n    ...: ML, like Gecko) Chrome/57.0.2987.133 Safari/537.36\"\"\"\r\n\r\nIn [32]: from w3lib.http import headers_raw_to_dict\r\n\r\nIn [33]: headers = headers_raw_to_dict(copy_from_chrome)\r\nIn [35]: headers\r\nOut[35]:\r\n{'Accept': ['text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/\r\n*;q=0.8'],\r\n 'Accept-Encoding': ['gzip, deflate, sdch'],\r\n 'Accept-Language': ['zh-CN,zh;q=0.8'],\r\n 'Cache-Control': ['max-age=0'],\r\n 'Connection': ['keep-alive'],\r\n 'Cookie': ['username-pes-8888=\"2|1:0|10:1494207240|17:username-pes-8888|48:ODdm\r\nYWI4NmQtNDA0OC00Y2YzLTg3ZjYtOWE3Mzk0YmRiZTA2|3284b8f38c8d142ac8e7121c4dfd6f04d75\r\n48ccb6680f56e74a32c5f3f9dc3d4\"'],\r\n 'Host': ['pes'],\r\n 'Upgrade-Insecure-Requests': ['1'],\r\n 'User-Agent': ['Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML,\r\nlike Gecko) Chrome/57.0.2987.133 Safari/537.36']}\r\n```\r\nthen i use this headers for requests\r\n```\r\nIn [36]: import requests\r\n\r\nIn [37]: z = requests.get(url,headers=headers)\r\n```\r\nbut Header values must be of type str or bytes\r\nso i need do this \r\n```\r\nIn [39]: {i:headers[i][0] for i in headers}\r\nOut[39]:\r\n{'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*\r\n;q=0.8',\r\n 'Accept-Encoding': 'gzip, deflate, sdch',\r\n 'Accept-Language': 'zh-CN,zh;q=0.8',\r\n 'Cache-Control': 'max-age=0',\r\n 'Connection': 'keep-alive',\r\n 'Cookie': 'username-pes-8888=\"2|1:0|10:1494207240|17:username-pes-8888|48:ODdmY\r\nWI4NmQtNDA0OC00Y2YzLTg3ZjYtOWE3Mzk0YmRiZTA2|3284b8f38c8d142ac8e7121c4dfd6f04d754\r\n8ccb6680f56e74a32c5f3f9dc3d4\"',\r\n 'Host': 'pes',\r\n 'Upgrade-Insecure-Requests': '1',\r\n 'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, l\r\nike Gecko) Chrome/57.0.2987.133 Safari/537.36'}\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/88", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/88/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/88/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/88/events", "html_url": "https://github.com/scrapy/w3lib/issues/88", "id": 207463158, "node_id": "MDU6SXNzdWUyMDc0NjMxNTg=", "number": 88, "title": "allow to customize encoding in w3lib.http.basic_auth_header ", "user": {"login": "kmike", "id": 107893, "node_id": "MDQ6VXNlcjEwNzg5Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/107893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmike", "html_url": "https://github.com/kmike", "followers_url": "https://api.github.com/users/kmike/followers", "following_url": "https://api.github.com/users/kmike/following{/other_user}", "gists_url": "https://api.github.com/users/kmike/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmike/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmike/subscriptions", "organizations_url": "https://api.github.com/users/kmike/orgs", "repos_url": "https://api.github.com/users/kmike/repos", "events_url": "https://api.github.com/users/kmike/events{/privacy}", "received_events_url": "https://api.github.com/users/kmike/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-02-14T09:37:46Z", "updated_at": "2018-01-24T17:36:49Z", "closed_at": "2018-01-24T17:36:49Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "See https://github.com/scrapy/scrapy/pull/2530", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/84", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/84/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/84/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/84/events", "html_url": "https://github.com/scrapy/w3lib/issues/84", "id": 204130826, "node_id": "MDU6SXNzdWUyMDQxMzA4MjY=", "number": 84, "title": "headers_raw_to_dict, problem with multiple headers with same name ", "user": {"login": "dmippolitov", "id": 7361539, "node_id": "MDQ6VXNlcjczNjE1Mzk=", "avatar_url": "https://avatars3.githubusercontent.com/u/7361539?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmippolitov", "html_url": "https://github.com/dmippolitov", "followers_url": "https://api.github.com/users/dmippolitov/followers", "following_url": "https://api.github.com/users/dmippolitov/following{/other_user}", "gists_url": "https://api.github.com/users/dmippolitov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmippolitov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmippolitov/subscriptions", "organizations_url": "https://api.github.com/users/dmippolitov/orgs", "repos_url": "https://api.github.com/users/dmippolitov/repos", "events_url": "https://api.github.com/users/dmippolitov/events{/privacy}", "received_events_url": "https://api.github.com/users/dmippolitov/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-01-30T21:12:12Z", "updated_at": "2017-02-08T16:54:20Z", "closed_at": "2017-02-08T16:54:20Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello. I have some problems with headers_raw_to_dict.\r\nAs you can see in a code snippet we have two X-Robots-Tag in raw headers, but i have only one in resulting dict. Thanks for your attention\r\n```\r\n>>> with open('../sandbox/response_headers', 'rb') as f:\r\n...    headers = f.read()\r\n... \r\n>>> headers\r\nb'Accept-Ranges: bytes\\r\\nEtag: \"23b8cacf-1635-546b539ee0f1a\"\\r\\nContent-Type: text/html; charset=ISO-8859-1\\r\\nLast-Modified: Sun, 22 Jan 2017 21:04:18 GMT\\r\\nX-Robots-Tag: noindex, nofollow\\r\\nX-Robots-Tag: otherbot: index, nofollow\\r\\nServer: Apache\\r\\nDate: Mon, 30 Jan 2017 20:43:35 GMT\\r\\nContent-Language: it-IT\\r\\n'\r\n\r\n>>> from w3lib.http import headers_raw_to_dict\r\n>>> import pprint\r\n\r\n>>> headers_dict = headers_raw_to_dict(headers)\r\n>>> pprint.pprint(headers_dict)\r\n{b'Accept-Ranges': [b'bytes'],\r\n b'Content-Language': [b'it-IT'],\r\n b'Content-Type': [b'text/html; charset=ISO-8859-1'],\r\n b'Date': [b'Mon, 30 Jan 2017 20:43:35 GMT'],\r\n b'Etag': [b'\"23b8cacf-1635-546b539ee0f1a\"'],\r\n b'Last-Modified': [b'Sun, 22 Jan 2017 21:04:18 GMT'],\r\n b'Server': [b'Apache'],\r\n b'X-Robots-Tag': [b'otherbot: index, nofollow']}\r\n\r\n```\r\nThe problem is here:\r\n```\r\n    headers = headers_raw.splitlines()\r\n    headers_tuples = [header.split(b':', 1) for header in headers]\r\n    return dict([\r\n        (header_item[0].strip(), [header_item[1].strip()])\r\n        for header_item in headers_tuples\r\n        if len(header_item) == 2\r\n])\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/81", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/81/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/81/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/81/events", "html_url": "https://github.com/scrapy/w3lib/issues/81", "id": 196652232, "node_id": "MDU6SXNzdWUxOTY2NTIyMzI=", "number": 81, "title": "w3lib.http.headers_raw_to_dict doesn't give output I expect", "user": {"login": "iamminji", "id": 16489612, "node_id": "MDQ6VXNlcjE2NDg5NjEy", "avatar_url": "https://avatars2.githubusercontent.com/u/16489612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iamminji", "html_url": "https://github.com/iamminji", "followers_url": "https://api.github.com/users/iamminji/followers", "following_url": "https://api.github.com/users/iamminji/following{/other_user}", "gists_url": "https://api.github.com/users/iamminji/gists{/gist_id}", "starred_url": "https://api.github.com/users/iamminji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iamminji/subscriptions", "organizations_url": "https://api.github.com/users/iamminji/orgs", "repos_url": "https://api.github.com/users/iamminji/repos", "events_url": "https://api.github.com/users/iamminji/events{/privacy}", "received_events_url": "https://api.github.com/users/iamminji/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-12-20T11:42:39Z", "updated_at": "2018-03-02T16:13:37Z", "closed_at": "2018-03-02T16:13:37Z", "author_association": "NONE", "active_lock_reason": null, "body": "My raw data is `\"Content-type: text/html\\n\\rAccept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\"`\r\n\r\nI expect to see the output as\r\n`\"{'Content-type': ['text/html'], 'Accept': ['text/html', 'application/xhtml+xml', 'application/xml;q=0.9', 'image/webp', '*/*;q=0.8']}\"`\r\n\r\nbut I got\r\n`{'Content-type': ['text/html'], 'Accept': ['text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8']}`\r\n\r\nI think [w3lib.http.headers_raw_to_dict](https://github.com/scrapy/w3lib/blob/master/w3lib/http.py) should be handled the comma.\r\n\r\nthanks and best regards", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/74", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/74/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/74/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/74/events", "html_url": "https://github.com/scrapy/w3lib/issues/74", "id": 176835506, "node_id": "MDU6SXNzdWUxNzY4MzU1MDY=", "number": 74, "title": "remove_tags_with_content not removing javascript content", "user": {"login": "steve-brandcrafter", "id": 19794030, "node_id": "MDQ6VXNlcjE5Nzk0MDMw", "avatar_url": "https://avatars0.githubusercontent.com/u/19794030?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steve-brandcrafter", "html_url": "https://github.com/steve-brandcrafter", "followers_url": "https://api.github.com/users/steve-brandcrafter/followers", "following_url": "https://api.github.com/users/steve-brandcrafter/following{/other_user}", "gists_url": "https://api.github.com/users/steve-brandcrafter/gists{/gist_id}", "starred_url": "https://api.github.com/users/steve-brandcrafter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steve-brandcrafter/subscriptions", "organizations_url": "https://api.github.com/users/steve-brandcrafter/orgs", "repos_url": "https://api.github.com/users/steve-brandcrafter/repos", "events_url": "https://api.github.com/users/steve-brandcrafter/events{/privacy}", "received_events_url": "https://api.github.com/users/steve-brandcrafter/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2016-09-14T07:32:58Z", "updated_at": "2016-09-14T11:43:23Z", "closed_at": "2016-09-14T11:43:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am using Python 3.5 & w3lib 1.14.2\n\nLet's say we have the following HTML:\n\n`Before JS \n      <script type=\"text/javascript\">\n        var _gaq = _gaq || [];\n        _gaq.push(['_setAccount', 'UA-24343546-1']);\n        _gaq.push(['_trackPageview']);\n        (function() {\n            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n        })();\n    </script>\n    After JS\n`\n\nAnd we use the following code to strip out the above section:\n\n`full_text_no_script = remove_tags_with_content(full_text_dirty[0], ('script',))`\n\nAssume full_text_dirty[0] contains the HTML above, the variable full_text_no_script will end up containing the following content:\n\n`Before JS var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-24343546-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); After JS`\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/73", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/73/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/73/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/73/events", "html_url": "https://github.com/scrapy/w3lib/issues/73", "id": 176676059, "node_id": "MDU6SXNzdWUxNzY2NzYwNTk=", "number": 73, "title": "Port of Django's urlize", "user": {"login": "Lukas0907", "id": 591792, "node_id": "MDQ6VXNlcjU5MTc5Mg==", "avatar_url": "https://avatars0.githubusercontent.com/u/591792?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Lukas0907", "html_url": "https://github.com/Lukas0907", "followers_url": "https://api.github.com/users/Lukas0907/followers", "following_url": "https://api.github.com/users/Lukas0907/following{/other_user}", "gists_url": "https://api.github.com/users/Lukas0907/gists{/gist_id}", "starred_url": "https://api.github.com/users/Lukas0907/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Lukas0907/subscriptions", "organizations_url": "https://api.github.com/users/Lukas0907/orgs", "repos_url": "https://api.github.com/users/Lukas0907/repos", "events_url": "https://api.github.com/users/Lukas0907/events{/privacy}", "received_events_url": "https://api.github.com/users/Lukas0907/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-09-13T15:42:52Z", "updated_at": "2016-10-06T09:30:34Z", "closed_at": "2016-10-06T09:30:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\n\nit would be awesome to have a port of Django's urlize (https://github.com/django/django/blob/master/django/utils/html.py#L236) in w3lib.\n\nurlize creates clickable links, i.e. `<a href=\"https://example.com>https://example.com</a>` out of every URL detected in a string.\n\nCheers,\n\nLukas\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/65", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/65/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/65/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/65/events", "html_url": "https://github.com/scrapy/w3lib/issues/65", "id": 167064158, "node_id": "MDU6SXNzdWUxNjcwNjQxNTg=", "number": 65, "title": "Add canonicalize_url() to w3lib.url", "user": {"login": "redapple", "id": 886296, "node_id": "MDQ6VXNlcjg4NjI5Ng==", "avatar_url": "https://avatars1.githubusercontent.com/u/886296?v=4", "gravatar_id": "", "url": "https://api.github.com/users/redapple", "html_url": "https://github.com/redapple", "followers_url": "https://api.github.com/users/redapple/followers", "following_url": "https://api.github.com/users/redapple/following{/other_user}", "gists_url": "https://api.github.com/users/redapple/gists{/gist_id}", "starred_url": "https://api.github.com/users/redapple/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/redapple/subscriptions", "organizations_url": "https://api.github.com/users/redapple/orgs", "repos_url": "https://api.github.com/users/redapple/repos", "events_url": "https://api.github.com/users/redapple/events{/privacy}", "received_events_url": "https://api.github.com/users/redapple/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-07-22T14:57:39Z", "updated_at": "2016-07-28T16:44:29Z", "closed_at": "2016-07-28T16:44:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The idea is to move scrapy's `canonicalize_url()` helper to `w3lib.url`\nProjects like frontera could be interested: see https://github.com/scrapinghub/frontera/pull/168#issuecomment-234558699\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/62", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/62/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/62/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/62/events", "html_url": "https://github.com/scrapy/w3lib/issues/62", "id": 165432668, "node_id": "MDU6SXNzdWUxNjU0MzI2Njg=", "number": 62, "title": "safe_url_string can raise UnicodeError ", "user": {"login": "kmike", "id": 107893, "node_id": "MDQ6VXNlcjEwNzg5Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/107893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmike", "html_url": "https://github.com/kmike", "followers_url": "https://api.github.com/users/kmike/followers", "following_url": "https://api.github.com/users/kmike/following{/other_user}", "gists_url": "https://api.github.com/users/kmike/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmike/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmike/subscriptions", "organizations_url": "https://api.github.com/users/kmike/orgs", "repos_url": "https://api.github.com/users/kmike/repos", "events_url": "https://api.github.com/users/kmike/events{/privacy}", "received_events_url": "https://api.github.com/users/kmike/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-07-13T22:06:29Z", "updated_at": "2016-07-14T11:49:44Z", "closed_at": "2016-07-14T11:49:44Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "A similar issue was fixed in scrapy 1.1.1: https://github.com/scrapy/scrapy/pull/2038, but it is still a problem in `w3lib.url.safe_url_string`.\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/60", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/60/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/60/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/60/events", "html_url": "https://github.com/scrapy/w3lib/issues/60", "id": 164376413, "node_id": "MDU6SXNzdWUxNjQzNzY0MTM=", "number": 60, "title": "url_query_cleaner and fragments", "user": {"login": "csalazar", "id": 360285, "node_id": "MDQ6VXNlcjM2MDI4NQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/360285?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csalazar", "html_url": "https://github.com/csalazar", "followers_url": "https://api.github.com/users/csalazar/followers", "following_url": "https://api.github.com/users/csalazar/following{/other_user}", "gists_url": "https://api.github.com/users/csalazar/gists{/gist_id}", "starred_url": "https://api.github.com/users/csalazar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csalazar/subscriptions", "organizations_url": "https://api.github.com/users/csalazar/orgs", "repos_url": "https://api.github.com/users/csalazar/repos", "events_url": "https://api.github.com/users/csalazar/events{/privacy}", "received_events_url": "https://api.github.com/users/csalazar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-07-07T18:28:09Z", "updated_at": "2016-11-03T17:32:39Z", "closed_at": "2016-11-03T17:32:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi guys, why `url_query_cleaner` removes the fragment part? Is it expected?\n\n```\nIn [5]: url_query_cleaner('http://domain.tld/?bla=123#123123', ['bla'], remove=True)\nOut[5]: 'http://domain.tld/'\n```\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/54", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/54/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/54/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/54/events", "html_url": "https://github.com/scrapy/w3lib/issues/54", "id": 147210538, "node_id": "MDU6SXNzdWUxNDcyMTA1Mzg=", "number": 54, "title": "w3lib 1.14 breaks scrapy 0.24.6 usage of urlparse.urldefrag", "user": {"login": "avish", "id": 557935, "node_id": "MDQ6VXNlcjU1NzkzNQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/557935?v=4", "gravatar_id": "", "url": "https://api.github.com/users/avish", "html_url": "https://github.com/avish", "followers_url": "https://api.github.com/users/avish/followers", "following_url": "https://api.github.com/users/avish/following{/other_user}", "gists_url": "https://api.github.com/users/avish/gists{/gist_id}", "starred_url": "https://api.github.com/users/avish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/avish/subscriptions", "organizations_url": "https://api.github.com/users/avish/orgs", "repos_url": "https://api.github.com/users/avish/repos", "events_url": "https://api.github.com/users/avish/events{/privacy}", "received_events_url": "https://api.github.com/users/avish/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-04-10T09:56:26Z", "updated_at": "2016-04-17T06:35:11Z", "closed_at": "2016-04-11T14:54:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "``` shell\n$ pip install scrapy==0.24.6\n```\n\nThis currently pulls in w3lib 1.14.0 or 1.14.1.\n\n``` shell\n$ python -c \"from scrapy import Request; req = Request(url='http://www.example.com')\"\n```\n\nGives:\n\n```\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/home/avish/.virtualenvs/w3lib-bug/local/lib/python2.7/site-packages/scrapy/http/request/__init__.py\", line 26, in __init__\n    self._set_url(url)\n  File \"/home/avish/.virtualenvs/w3lib-bug/local/lib/python2.7/site-packages/scrapy/http/request/__init__.py\", line 52, in _set_url\n    self._url = escape_ajax(safe_url_string(url))\n  File \"/home/avish/.virtualenvs/w3lib-bug/local/lib/python2.7/site-packages/scrapy/utils/url.py\", line 102, in escape_ajax\n    defrag, frag = urlparse.urldefrag(url)\nAttributeError: 'function' object has no attribute 'urldefrag'\n```\n\nDowngrading to `w3lib==1.13.0` fixes this issue.\n\nThe problem doesn't happen with `scrapy>=1.0` (but 1.0 introduced breaking changes so some projects still use 0.24)\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/51", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/51/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/51/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/51/events", "html_url": "https://github.com/scrapy/w3lib/issues/51", "id": 146511133, "node_id": "MDU6SXNzdWUxNDY1MTExMzM=", "number": 51, "title": "/w3lib/url.py", "user": {"login": "entergmode", "id": 7720739, "node_id": "MDQ6VXNlcjc3MjA3Mzk=", "avatar_url": "https://avatars2.githubusercontent.com/u/7720739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/entergmode", "html_url": "https://github.com/entergmode", "followers_url": "https://api.github.com/users/entergmode/followers", "following_url": "https://api.github.com/users/entergmode/following{/other_user}", "gists_url": "https://api.github.com/users/entergmode/gists{/gist_id}", "starred_url": "https://api.github.com/users/entergmode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/entergmode/subscriptions", "organizations_url": "https://api.github.com/users/entergmode/orgs", "repos_url": "https://api.github.com/users/entergmode/repos", "events_url": "https://api.github.com/users/entergmode/events{/privacy}", "received_events_url": "https://api.github.com/users/entergmode/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2016-04-07T05:09:58Z", "updated_at": "2016-04-20T11:15:19Z", "closed_at": "2016-04-11T15:19:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\n\nI'm not sure this is just me or we have this bug in this file /w3lib/url.py\nunicode_to_str is not defined there. \nIs is used to be imported from there \n(from w3lib.util import unicode_to_str)\nplease advice\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/32", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/32/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/32/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/32/events", "html_url": "https://github.com/scrapy/w3lib/issues/32", "id": 60363475, "node_id": "MDU6SXNzdWU2MDM2MzQ3NQ==", "number": 32, "title": "html.get_meta_refresh incorrectly parses url", "user": {"login": "Djayb6", "id": 357813, "node_id": "MDQ6VXNlcjM1NzgxMw==", "avatar_url": "https://avatars0.githubusercontent.com/u/357813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Djayb6", "html_url": "https://github.com/Djayb6", "followers_url": "https://api.github.com/users/Djayb6/followers", "following_url": "https://api.github.com/users/Djayb6/following{/other_user}", "gists_url": "https://api.github.com/users/Djayb6/gists{/gist_id}", "starred_url": "https://api.github.com/users/Djayb6/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Djayb6/subscriptions", "organizations_url": "https://api.github.com/users/Djayb6/orgs", "repos_url": "https://api.github.com/users/Djayb6/repos", "events_url": "https://api.github.com/users/Djayb6/events{/privacy}", "received_events_url": "https://api.github.com/users/Djayb6/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-03-09T15:47:39Z", "updated_at": "2015-07-29T14:48:08Z", "closed_at": "2015-07-15T12:40:40Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I have an example of meta refresh tag which is correctly parsed by major browsers such as Chrome and Safari, but not by `html.get_meta_refresh`. Link: http://www.moveomed.de\n\n```\n<meta http-equiv=\"refresh\" content=\"0; URL=\nhttp://www.domain.de/index.php\" />\n```\n\nNote the newline  between `URL=` and `http://`\n\nThis returns `(0.0, 'http://moveomed.de/%0Ahttp://moveomed.de/index.php')` whereas it should have returned `(0.0, 'http://moveomed.de/index.php')`\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/31", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/31/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/31/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/31/events", "html_url": "https://github.com/scrapy/w3lib/issues/31", "id": 55314441, "node_id": "MDU6SXNzdWU1NTMxNDQ0MQ==", "number": 31, "title": "remove_tags removes text inbetween < >", "user": {"login": "nramirezuy", "id": 1042865, "node_id": "MDQ6VXNlcjEwNDI4NjU=", "avatar_url": "https://avatars0.githubusercontent.com/u/1042865?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nramirezuy", "html_url": "https://github.com/nramirezuy", "followers_url": "https://api.github.com/users/nramirezuy/followers", "following_url": "https://api.github.com/users/nramirezuy/following{/other_user}", "gists_url": "https://api.github.com/users/nramirezuy/gists{/gist_id}", "starred_url": "https://api.github.com/users/nramirezuy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nramirezuy/subscriptions", "organizations_url": "https://api.github.com/users/nramirezuy/orgs", "repos_url": "https://api.github.com/users/nramirezuy/repos", "events_url": "https://api.github.com/users/nramirezuy/events{/privacy}", "received_events_url": "https://api.github.com/users/nramirezuy/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-01-23T18:22:14Z", "updated_at": "2015-01-23T20:47:36Z", "closed_at": "2015-01-23T20:47:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "``` python\n>>> from w3lib.html import remove_tags\n>>> TEXT = u'<span itemprop=\"name\"> <Afgeschermd2> </span>'\n>>> remove_tags(TEXT)\nu'  '\n>>> remove_tags(TEXT, keep=['Afgeschermd2'])\nu' <Afgeschermd2> '\n```\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/18", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/18/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/18/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/18/events", "html_url": "https://github.com/scrapy/w3lib/issues/18", "id": 26178890, "node_id": "MDU6SXNzdWUyNjE3ODg5MA==", "number": 18, "title": "w3lib.html.remove_entities have a confusing name", "user": {"login": "rmax", "id": 26015, "node_id": "MDQ6VXNlcjI2MDE1", "avatar_url": "https://avatars2.githubusercontent.com/u/26015?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmax", "html_url": "https://github.com/rmax", "followers_url": "https://api.github.com/users/rmax/followers", "following_url": "https://api.github.com/users/rmax/following{/other_user}", "gists_url": "https://api.github.com/users/rmax/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmax/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmax/subscriptions", "organizations_url": "https://api.github.com/users/rmax/orgs", "repos_url": "https://api.github.com/users/rmax/repos", "events_url": "https://api.github.com/users/rmax/events{/privacy}", "received_events_url": "https://api.github.com/users/rmax/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2014-01-23T16:30:50Z", "updated_at": "2014-07-25T20:37:56Z", "closed_at": "2014-07-25T20:37:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "The function says in [its docstring](https://github.com/scrapy/w3lib/blob/master/w3lib/html.py#L18):\n\n```\nRemove entities from the given text by converting them to\ncorresponding unicode character.\n```\n\nI understand it actually, makes the entities go away (by converting them!) but common sense tells me remove is take away something and I would expect the function to remove those characters from the text.\n\nI suggest rename `remove_entities` to `convert_entities` so it's clear what it does. (Even already uses a helper function named `convert_entity`!)\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/15", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/15/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/15/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/15/events", "html_url": "https://github.com/scrapy/w3lib/issues/15", "id": 21185972, "node_id": "MDU6SXNzdWUyMTE4NTk3Mg==", "number": 15, "title": "Add sphinx documentation", "user": {"login": "pablohoffman", "id": 185212, "node_id": "MDQ6VXNlcjE4NTIxMg==", "avatar_url": "https://avatars1.githubusercontent.com/u/185212?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pablohoffman", "html_url": "https://github.com/pablohoffman", "followers_url": "https://api.github.com/users/pablohoffman/followers", "following_url": "https://api.github.com/users/pablohoffman/following{/other_user}", "gists_url": "https://api.github.com/users/pablohoffman/gists{/gist_id}", "starred_url": "https://api.github.com/users/pablohoffman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pablohoffman/subscriptions", "organizations_url": "https://api.github.com/users/pablohoffman/orgs", "repos_url": "https://api.github.com/users/pablohoffman/repos", "events_url": "https://api.github.com/users/pablohoffman/events{/privacy}", "received_events_url": "https://api.github.com/users/pablohoffman/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2013-10-17T21:15:14Z", "updated_at": "2014-07-25T20:38:15Z", "closed_at": "2014-07-25T20:38:15Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Something simple that lists functions available and uses autodoc to pull their docstrings, should be enough.\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/14", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/14/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/14/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/14/events", "html_url": "https://github.com/scrapy/w3lib/issues/14", "id": 20571649, "node_id": "MDU6SXNzdWUyMDU3MTY0OQ==", "number": 14, "title": "deprecate w3lib.form.encode_multipart", "user": {"login": "kmike", "id": 107893, "node_id": "MDQ6VXNlcjEwNzg5Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/107893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmike", "html_url": "https://github.com/kmike", "followers_url": "https://api.github.com/users/kmike/followers", "following_url": "https://api.github.com/users/kmike/following{/other_user}", "gists_url": "https://api.github.com/users/kmike/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmike/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmike/subscriptions", "organizations_url": "https://api.github.com/users/kmike/orgs", "repos_url": "https://api.github.com/users/kmike/repos", "events_url": "https://api.github.com/users/kmike/events{/privacy}", "received_events_url": "https://api.github.com/users/kmike/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2013-10-05T22:07:56Z", "updated_at": "2014-02-01T18:49:19Z", "closed_at": "2014-02-01T18:49:19Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "w3lib.form.encode_multipart has the following issues:\n- there are no tests;\n- it uses fixed boundary that can appear in uploaded data;\n- it doesn't escape nor keys nor filenames so they can break the uploading code;\n- it doesn't support unicode keys and values (they are encoded implicitly), so users must figure RFC details themselves if they have non-ascii input;\n- minor one - it doesn't support integer values.\n\nw3lib.form.encode_multipart is based on distutils code; this code was never intended to be a general multipart encoding code, and there was veto on distutils development for several years (it was lifted not so long ago), so the code in CPython trunk is not much better.\n\nAs a part of #13 I copied distutils code from CPython trunk, wrote some tests and backported the code to make it work in Python 2.x.\n\nInstead of fixing these issues I propose to deprecate w3lib.form.encode_multipart and point users to urllib3 [implementation](https://github.com/shazow/urllib3/blob/master/urllib3/filepost.py). This implementation has similar interface and handles more edge cases; it is used by requests library, works in Python 2.x and 3.x and looks well supported.\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/9", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/9/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/9/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/9/events", "html_url": "https://github.com/scrapy/w3lib/issues/9", "id": 15400186, "node_id": "MDU6SXNzdWUxNTQwMDE4Ng==", "number": 9, "title": "get_meta_refresh() doesn't use encoding when extracting url", "user": {"login": "Mimino666", "id": 1270393, "node_id": "MDQ6VXNlcjEyNzAzOTM=", "avatar_url": "https://avatars2.githubusercontent.com/u/1270393?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Mimino666", "html_url": "https://github.com/Mimino666", "followers_url": "https://api.github.com/users/Mimino666/followers", "following_url": "https://api.github.com/users/Mimino666/following{/other_user}", "gists_url": "https://api.github.com/users/Mimino666/gists{/gist_id}", "starred_url": "https://api.github.com/users/Mimino666/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Mimino666/subscriptions", "organizations_url": "https://api.github.com/users/Mimino666/orgs", "repos_url": "https://api.github.com/users/Mimino666/repos", "events_url": "https://api.github.com/users/Mimino666/events{/privacy}", "received_events_url": "https://api.github.com/users/Mimino666/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2013-06-11T14:01:22Z", "updated_at": "2013-07-12T12:27:45Z", "closed_at": "2013-07-12T12:27:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "https://github.com/scrapy/w3lib/blob/master/w3lib/html.py#L203\n\nShouldn't it pass the `encoding` parameter into `safe_url_string()` method?\nOtherwise it is a different behavior from SGMLs in Scrapy, when response encoding IS used.\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/7", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/7/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/7/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/7/events", "html_url": "https://github.com/scrapy/w3lib/issues/7", "id": 13144637, "node_id": "MDU6SXNzdWUxMzE0NDYzNw==", "number": 7, "title": "Tests fail with PyPy 2.0beta1", "user": {"login": "kmike", "id": 107893, "node_id": "MDQ6VXNlcjEwNzg5Mw==", "avatar_url": "https://avatars3.githubusercontent.com/u/107893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kmike", "html_url": "https://github.com/kmike", "followers_url": "https://api.github.com/users/kmike/followers", "following_url": "https://api.github.com/users/kmike/following{/other_user}", "gists_url": "https://api.github.com/users/kmike/gists{/gist_id}", "starred_url": "https://api.github.com/users/kmike/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kmike/subscriptions", "organizations_url": "https://api.github.com/users/kmike/orgs", "repos_url": "https://api.github.com/users/kmike/repos", "events_url": "https://api.github.com/users/kmike/events{/privacy}", "received_events_url": "https://api.github.com/users/kmike/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2013-04-13T00:03:28Z", "updated_at": "2013-07-12T12:07:01Z", "closed_at": "2013-07-12T12:07:01Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "Traceback:\n\n```\n.......F...........................\n======================================================================\nFAIL: test_invalid_utf8_encoded_body_with_valid_utf8_BOM (w3lib.tests.test_encoding.HtmlConversionTests)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/Users/kmike/svn/w3lib/w3lib/tests/test_encoding.py\", line 115, in test_invalid_utf8_encoded_body_with_valid_utf8_BOM\n    'utf-8',u'WORD\\ufffd\\ufffd')\n  File \"/Users/kmike/svn/w3lib/w3lib/tests/test_encoding.py\", line 96, in _assert_encoding\n    self.assertEqual(body_unicode, expected_unicode)\nAssertionError: u'WORD\\ufffd' != u'WORD\\ufffd\\ufffd'\n- WORD\\ufffd\n+ WORD\\ufffd\\ufffd\n?      +\n\n```\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/6", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/6/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/6/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/6/events", "html_url": "https://github.com/scrapy/w3lib/issues/6", "id": 12651729, "node_id": "MDU6SXNzdWUxMjY1MTcyOQ==", "number": 6, "title": "Why does html_body_declared_encoding() convert 'ISO-8859-1' to 'cp1252'?", "user": {"login": "stav", "id": 204645, "node_id": "MDQ6VXNlcjIwNDY0NQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/204645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stav", "html_url": "https://github.com/stav", "followers_url": "https://api.github.com/users/stav/followers", "following_url": "https://api.github.com/users/stav/following{/other_user}", "gists_url": "https://api.github.com/users/stav/gists{/gist_id}", "starred_url": "https://api.github.com/users/stav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stav/subscriptions", "organizations_url": "https://api.github.com/users/stav/orgs", "repos_url": "https://api.github.com/users/stav/repos", "events_url": "https://api.github.com/users/stav/events{/privacy}", "received_events_url": "https://api.github.com/users/stav/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2013-04-01T03:45:46Z", "updated_at": "2013-04-12T18:13:44Z", "closed_at": "2013-04-12T18:13:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`w3lib.encoding.html_body_declared_encoding()` takes this markup which clearly states the encoding to be \"ISO-8859-1\":\n\n```\n<meta http-equiv=\"content-type\" content=\"text/html;charset=ISO-8859-1\">\n```\n\nand returns to the caller `'cp1252'`.\n\nThe following dict is providing the translation... but why is this even happening:\n\n```\nDEFAULT_ENCODING_TRANSLATION = {...\n    'latin_1': 'cp1252',...}\n```\n\nHere is a shell log to demonstrate:\n\n```\nstav@maia:$ scrapy shell http://www.highrisefire.com/career.html\n2013-03-31 21:20:00-0600 [scrapy] INFO: Scrapy 0.17.0 started (bot: def)\n...\n>>> from scrapy.contrib.linkextractors.sgml import SgmlLinkExtractor\n>>> le = SgmlLinkExtractor(allow=r'job', restrict_xpaths='//p')\n>>> response.encoding\n'cp1252'\n>>> le.extract_links(response)\nTraceback (most recent call last):\n  File \"<console>\", line 1, in <module>\n  File \"/srv/scrapy/scrapy/scrapy/contrib/linkextractors/sgml.py\", line 124\n    ).encode(response.encoding)\n  File \"/usr/lib/python2.7/encodings/cp1252.py\", line 12, in encode\n    return codecs.charmap_encode(input,errors,encoding_table)\nUnicodeEncodeError: 'charmap' codec can't encode character u'\\x96'\n    in position 674: character maps to <undefined>\n>>>\n>>> le.extract_links(response.replace(encoding='ISO-8859-1'))\n[Link(url='http://www.highrisefire.com/job1.html', text=u'Get Details',...]\n```\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/scrapy/w3lib/issues/5", "repository_url": "https://api.github.com/repos/scrapy/w3lib", "labels_url": "https://api.github.com/repos/scrapy/w3lib/issues/5/labels{/name}", "comments_url": "https://api.github.com/repos/scrapy/w3lib/issues/5/comments", "events_url": "https://api.github.com/repos/scrapy/w3lib/issues/5/events", "html_url": "https://github.com/scrapy/w3lib/issues/5", "id": 12614126, "node_id": "MDU6SXNzdWUxMjYxNDEyNg==", "number": 5, "title": "HTML Entities and Numeric character references in URL", "user": {"login": "stav", "id": 204645, "node_id": "MDQ6VXNlcjIwNDY0NQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/204645?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stav", "html_url": "https://github.com/stav", "followers_url": "https://api.github.com/users/stav/followers", "following_url": "https://api.github.com/users/stav/following{/other_user}", "gists_url": "https://api.github.com/users/stav/gists{/gist_id}", "starred_url": "https://api.github.com/users/stav/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stav/subscriptions", "organizations_url": "https://api.github.com/users/stav/orgs", "repos_url": "https://api.github.com/users/stav/repos", "events_url": "https://api.github.com/users/stav/events{/privacy}", "received_events_url": "https://api.github.com/users/stav/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2013-03-29T18:28:52Z", "updated_at": "2013-10-10T19:23:14Z", "closed_at": "2013-10-10T19:23:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "URLs on some [sites](http://www.pcrichard.com/catalog/category.jsp?categoryId=1191&parentCategoryId=7) erroneously contain valid \"safe\" characters in an invalid way and the standard Python library is unable to deal with this; therefore it might be nice if w3lib could. For example the hash character `#` normally marks the beginning of the _fragment_; but, it is possible that the url contains Numeric Character References (NCRs) like `&#174;` for example.\n\n`w3lib.url.safe_url_string()` uses `urllib.quote()` with the following safe chars:\n\n```\nABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_.-%;/?:@&=+$|,#-_.!~*'()\n```\n\nand the following (invalid) url does not get altered:\n\n```\n>>> url = \"/Pioneer_Speakers_with_iPod&reg;~iPhone&#174;_Dock?id=123#ipad\"\n>>> assert url == safe_url_string(url)\n>>> \n```\n\n`urlparse.urldefrag()` is confused:\n\n```\n>>> urlparse.urldefrag(url)\n('/Pioneer_Speakers_with_iPod&reg;~iPhone&', '174;_Dock?id=123#ipad')\n```\n\nSince `safe_url_string()` is used in `SgmlLinkExtractor`, for example with canonicalization turned on, we get fragment misinterpretation as the first hash triggers the slice:\n\n```\n/Pioneer_Speakers_with_iPod&reg;~iPhone&\n```\n\nUsing `urllib.quote()` directly does not work since it encodes all hashes, including the fragment hash:\n\n```\n>>> print urllib.quote(url)\n/Pioneer_Speakers_with_iPod%26reg%3B%7EiPhone%26%23174%3B_Dock%3Fid%3D123%23ipad\n```\n\nWhat is needed is perhaps a Entity/NCR regex that first converts the references and then does the safe encoding. So that in the end we get:\n\n```\n/Pioneer_Speakers_with_iPod%26reg%3B~iPhone%26%23174%3B_Dock?id=123#ipad\n```\n", "performed_via_github_app": null, "score": 1.0}]}