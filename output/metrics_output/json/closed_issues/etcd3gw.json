{"total_count": 9, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/41", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/41/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/41/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/41/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/41", "id": 677605757, "node_id": "MDU6SXNzdWU2Nzc2MDU3NTc=", "number": 41, "title": "Default endpoint changed causing etcd3gw.exceptions.Etcd3Exception: Not Found", "user": {"login": "yoctozepto", "id": 3455956, "node_id": "MDQ6VXNlcjM0NTU5NTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/3455956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yoctozepto", "html_url": "https://github.com/yoctozepto", "followers_url": "https://api.github.com/users/yoctozepto/followers", "following_url": "https://api.github.com/users/yoctozepto/following{/other_user}", "gists_url": "https://api.github.com/users/yoctozepto/gists{/gist_id}", "starred_url": "https://api.github.com/users/yoctozepto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yoctozepto/subscriptions", "organizations_url": "https://api.github.com/users/yoctozepto/orgs", "repos_url": "https://api.github.com/users/yoctozepto/repos", "events_url": "https://api.github.com/users/yoctozepto/events{/privacy}", "received_events_url": "https://api.github.com/users/yoctozepto/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2020-08-12T11:14:57Z", "updated_at": "2020-08-13T20:35:56Z", "closed_at": "2020-08-13T20:35:56Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In the new release (0.2.6 from Jul 30, 2020) etcd3gw ~~is unable to raise (some?) of its own exceptions~~ (the exception wording was mostly unfortunate and I guess we all fell in this trap)\r\n(the truth is:) switched from /v3alpha to /v3beta endpoints which are not available on default etcd installations on current platforms (Ubuntu Bionic, Focal; CentOS 8):\r\n\r\nExample:\r\n\r\n```\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service [-] Error starting thread.: etcd3gw.exceptions.Etcd3Exception: Not Found\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service Traceback (most recent call last):\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/oslo_service/service.py\", line 807, in run_service\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     service.start()\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/cinder/service.py\", line 220, in start\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     coordination.COORDINATOR.start()\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/cinder/coordination.py\", line 67, in start\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     self.coordinator.start(start_heart=True)\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/tooz/coordination.py\", line 689, in start\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     super(CoordinationDriverWithExecutor, self).start(start_heart)\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/tooz/coordination.py\", line 426, in start\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     self._start()\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/tooz/drivers/etcd3gw.py\", line 224, in _start\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     self._membership_lease = self.client.lease(self.membership_timeout)\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/etcd3gw/client.py\", line 122, in lease\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     json={\"TTL\": ttl, \"ID\": 0})\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service   File \"/var/lib/kolla/venv/lib/python3.6/site-packages/etcd3gw/client.py\", line 91, in post\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service     raise exceptions.Etcd3Exception(resp.text, resp.reason)\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service etcd3gw.exceptions.Etcd3Exception: Not Found\r\n2020-08-12 10:22:39.645 1787 ERROR oslo_service.service \r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/35", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/35/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/35/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/35/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/35", "id": 613987439, "node_id": "MDU6SXNzdWU2MTM5ODc0Mzk=", "number": 35, "title": "time.clock was removed in Python 3.8", "user": {"login": "tirkarthi", "id": 3972343, "node_id": "MDQ6VXNlcjM5NzIzNDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/3972343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tirkarthi", "html_url": "https://github.com/tirkarthi", "followers_url": "https://api.github.com/users/tirkarthi/followers", "following_url": "https://api.github.com/users/tirkarthi/following{/other_user}", "gists_url": "https://api.github.com/users/tirkarthi/gists{/gist_id}", "starred_url": "https://api.github.com/users/tirkarthi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tirkarthi/subscriptions", "organizations_url": "https://api.github.com/users/tirkarthi/orgs", "repos_url": "https://api.github.com/users/tirkarthi/repos", "events_url": "https://api.github.com/users/tirkarthi/events{/privacy}", "received_events_url": "https://api.github.com/users/tirkarthi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-07T11:37:12Z", "updated_at": "2020-05-07T13:12:03Z", "closed_at": "2020-05-07T13:12:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\netcd3gw/tests/test_etcd3gw.py\r\n347:        lock = self.client.lock(id='xyz-%s' % time.clock(), ttl=60)\r\n\r\netcd3gw/examples/etcd.py\r\n57:    lock = Lock('xyz-%s' % time.clock(), ttl=10000, client=client)\r\n```\r\n\r\nRef : https://github.com/python/cpython/pull/13270", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/33", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/33/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/33/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/33/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/33", "id": 556350308, "node_id": "MDU6SXNzdWU1NTYzNTAzMDg=", "number": 33, "title": "Request to have a new release cut", "user": {"login": "comay", "id": 4422155, "node_id": "MDQ6VXNlcjQ0MjIxNTU=", "avatar_url": "https://avatars3.githubusercontent.com/u/4422155?v=4", "gravatar_id": "", "url": "https://api.github.com/users/comay", "html_url": "https://github.com/comay", "followers_url": "https://api.github.com/users/comay/followers", "following_url": "https://api.github.com/users/comay/following{/other_user}", "gists_url": "https://api.github.com/users/comay/gists{/gist_id}", "starred_url": "https://api.github.com/users/comay/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/comay/subscriptions", "organizations_url": "https://api.github.com/users/comay/orgs", "repos_url": "https://api.github.com/users/comay/repos", "events_url": "https://api.github.com/users/comay/events{/privacy}", "received_events_url": "https://api.github.com/users/comay/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-01-28T17:12:09Z", "updated_at": "2020-01-28T19:29:26Z", "closed_at": "2020-01-28T18:17:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "There have been several commits since the last `etcd3-gateway` release. The ones including `resp.reason` as part of an exception are particularly of interest since it makes debugging client issues using the gateway far easier. As such, it would be much appreciate to have a new release cut.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/24", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/24/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/24/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/24/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/24", "id": 341798736, "node_id": "MDU6SXNzdWUzNDE3OTg3MzY=", "number": 24, "title": "Values are not correctly decoded in python3", "user": {"login": "huntxu", "id": 137809, "node_id": "MDQ6VXNlcjEzNzgwOQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/137809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/huntxu", "html_url": "https://github.com/huntxu", "followers_url": "https://api.github.com/users/huntxu/followers", "following_url": "https://api.github.com/users/huntxu/following{/other_user}", "gists_url": "https://api.github.com/users/huntxu/gists{/gist_id}", "starred_url": "https://api.github.com/users/huntxu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/huntxu/subscriptions", "organizations_url": "https://api.github.com/users/huntxu/orgs", "repos_url": "https://api.github.com/users/huntxu/repos", "events_url": "https://api.github.com/users/huntxu/events{/privacy}", "received_events_url": "https://api.github.com/users/huntxu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-07-17T07:32:10Z", "updated_at": "2018-07-17T10:04:58Z", "closed_at": "2018-07-17T10:04:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was trying to get the lock using this module with python3, however `lock.is_acquired()` always returned `False`. After some investigation, I found the reason is that the values are not correctly decoded. `utils._decode` returns an instance of `bytes` instead of `str` in python3.\r\n\r\nRun the unit tests with Python3 with etcd3 server running would reveal the issue.\r\n\r\n```\r\n$ tox -e py36\r\n...\r\ncollected 21 items                                                                                                                                                             \r\n\r\netcd3gw/tests/test_client.py::TestEtcd3Gateway::test_client_default PASSED                                                                                               [  4%]\r\netcd3gw/tests/test_client.py::TestEtcd3Gateway::test_client_ipv4 PASSED                                                                                                  [  9%]\r\netcd3gw/tests/test_client.py::TestEtcd3Gateway::test_client_ipv6 PASSED                                                                                                  [ 14%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_client_lease PASSED                                                                                                [ 19%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_client_lease_with_keys FAILED                                                                                      [ 23%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_client_lock_acquire_release PASSED                                                                                 [ 28%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_client_locks FAILED                                                                                                [ 33%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_client_members PASSED                                                                                              [ 38%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_client_status PASSED                                                                                               [ 42%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_client_with_keys_and_values FAILED                                                                                 [ 47%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_create_fail FAILED                                                                                                 [ 52%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_create_success FAILED                                                                                              [ 57%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_get_and_delete_prefix FAILED                                                                                       [ 61%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_get_prefix_sort_order FAILED                                                                                       [ 66%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_get_prefix_sort_order_explicit_sort_target_key FAILED                                                              [ 71%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_get_prefix_sort_order_explicit_sort_target_rev FAILED                                                              [ 76%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_replace_fail FAILED                                                                                                [ 80%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_replace_success FAILED                                                                                             [ 85%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_sequential_watch_prefix_once PASSED                                                                                [ 90%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_watch_key FAILED                                                                                                   [ 95%]\r\netcd3gw/tests/test_etcd3gw.py::TestEtcd3Gateway::test_watch_prefix FAILED                                                                                                [100%]\r\n\r\n=================================================================================== FAILURES ===================================================================================\r\n...\r\n_________________________________________________________________ TestEtcd3Gateway.test_client_lease_with_keys _________________________________________________________________\r\nNOTE: Incompatible Exception Representation, displaying natively:\r\n\r\ntesttools.testresult.real._StringException: Traceback (most recent call last):\r\n  File \"/root/src/etcd3gw/etcd3gw/tests/test_etcd3gw.py\", line 222, in test_client_lease_with_keys\r\n    self.assertIn('foo12', keys)\r\n  File \"/root/src/etcd3gw/.tox/py36/lib/python3.6/site-packages/testtools/testcase.py\", line 417, in assertIn\r\n    self.assertThat(haystack, Contains(needle), message)\r\n  File \"/root/src/etcd3gw/.tox/py36/lib/python3.6/site-packages/testtools/testcase.py\", line 498, in assertThat\r\n    raise mismatch_error\r\ntesttools.matchers._impl.MismatchError: 'foo12' not in [b'foo12', b'foo13']\r\n\r\n\r\n______________________________________________________________________ TestEtcd3Gateway.test_client_locks ______________________________________________________________________\r\nNOTE: Incompatible Exception Representation, displaying natively:\r\n\r\ntesttools.testresult.real._StringException: Traceback (most recent call last):\r\n  File \"/root/src/etcd3gw/etcd3gw/tests/test_etcd3gw.py\", line 354, in test_client_locks\r\n    self.assertTrue(lock.is_acquired())\r\n  File \"/root/src/etcd3gw/.tox/py36/lib/python3.6/site-packages/unittest2/case.py\", line 702, in assertTrue\r\n    raise self.failureException(msg)\r\nAssertionError: False is not true\r\n...\r\n===================================================================== 13 failed, 8 passed in 9.60 seconds ======================================================================\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/18", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/18/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/18/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/18/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/18", "id": 311556450, "node_id": "MDU6SXNzdWUzMTE1NTY0NTA=", "number": 18, "title": "Sort target is incorrectly mapped", "user": {"login": "fasaxc", "id": 469264, "node_id": "MDQ6VXNlcjQ2OTI2NA==", "avatar_url": "https://avatars0.githubusercontent.com/u/469264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fasaxc", "html_url": "https://github.com/fasaxc", "followers_url": "https://api.github.com/users/fasaxc/followers", "following_url": "https://api.github.com/users/fasaxc/following{/other_user}", "gists_url": "https://api.github.com/users/fasaxc/gists{/gist_id}", "starred_url": "https://api.github.com/users/fasaxc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fasaxc/subscriptions", "organizations_url": "https://api.github.com/users/fasaxc/orgs", "repos_url": "https://api.github.com/users/fasaxc/repos", "events_url": "https://api.github.com/users/fasaxc/events{/privacy}", "received_events_url": "https://api.github.com/users/fasaxc/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-04-05T10:31:16Z", "updated_at": "2018-04-10T14:38:03Z", "closed_at": "2018-04-10T14:38:03Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "If I specify `\"key\"` for the sort target then that gets mapped to `\"sort_target\": 1` on the API but the docs say that key should be 0:\r\n\r\n```\r\n  enum SortTarget {\r\n\tKEY = 0;\r\n\tVERSION = 1;\r\n\tCREATE = 2;\r\n\tMOD = 3;\r\n\tVALUE = 4;\r\n  }\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/15", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/15/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/15/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/15/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/15", "id": 309728849, "node_id": "MDU6SXNzdWUzMDk3Mjg4NDk=", "number": 15, "title": "Watch seems to leak connections", "user": {"login": "neiljerram", "id": 2089263, "node_id": "MDQ6VXNlcjIwODkyNjM=", "avatar_url": "https://avatars1.githubusercontent.com/u/2089263?v=4", "gravatar_id": "", "url": "https://api.github.com/users/neiljerram", "html_url": "https://github.com/neiljerram", "followers_url": "https://api.github.com/users/neiljerram/followers", "following_url": "https://api.github.com/users/neiljerram/following{/other_user}", "gists_url": "https://api.github.com/users/neiljerram/gists{/gist_id}", "starred_url": "https://api.github.com/users/neiljerram/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/neiljerram/subscriptions", "organizations_url": "https://api.github.com/users/neiljerram/orgs", "repos_url": "https://api.github.com/users/neiljerram/repos", "events_url": "https://api.github.com/users/neiljerram/events{/privacy}", "received_events_url": "https://api.github.com/users/neiljerram/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-03-29T12:06:20Z", "updated_at": "2018-04-04T13:42:58Z", "closed_at": "2018-04-04T13:42:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Run a local etcd server on port 2379, e.g. with `docker run --net=host quay.io/coreos/etcd`.\r\n\r\nCreate an Etcd3Client and make an initial connection to the server:\r\n```\r\n(py27) neil@smaug:~/calico/networking-calico$ python\r\nPython 2.7.14+ (default, Mar 13 2018, 15:23:44) \r\n[GCC 7.3.0] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from etcd3gw.client import Etcd3Client\r\n>>> c = Etcd3Client()\r\n>>> c.status()\r\n{u'raftTerm': u'2', u'header': {u'raft_term': u'2', u'revision': u'1', u'cluster_id': u'14841639068965178418', u'member_id': u'10276657743932975437'}, u'version': u'3.2.9', u'raftIndex': u'4', u'dbSize': u'24576', u'leader': u'10276657743932975437'}\r\n```\r\n\r\nFind out the PID of that python shell, and then in another window monitor its etcd connections with\r\n```\r\nwatch 'lsof -p 6770 | grep 2379'\r\n```\r\nYou'll initially see that there is 1 connection:\r\n```\r\npython  6770 neil    3u  IPv4 837856      0t0      TCP localhost:40306->localhost:2379 (ESTABLISHED)\r\n```\r\n\r\nStart and then cancel a watch:\r\n```\r\n>>> stream, cancel = c.watch_prefix(\"/\")\r\n>>> cancel()\r\n```\r\nThe watch still shows just 1 connection.\r\n\r\nHowever, now, for each further iteration of\r\n```\r\n>>> stream, cancel = c.watch_prefix(\"/\")\r\n>>> cancel()\r\n```\r\nwe see 1 *more* ESTABLISHED connection.  For example, after 8 more iterations, there are now 9 ESTABLISHED connections:\r\n```\r\npython  6770 neil    3u  IPv4 837856      0t0      TCP localhost:40306->localhost:2379 (ESTABLISHED)\r\npython  6770 neil    4u  IPv4 852249      0t0      TCP localhost:40374->localhost:2379 (ESTABLISHED)\r\npython  6770 neil    5u  IPv4 851242      0t0      TCP localhost:40386->localhost:2379 (ESTABLISHED)\r\npython  6770 neil    6u  IPv4 880526      0t0      TCP localhost:40580->localhost:2379 (ESTABLISHED)\r\npython  6770 neil    7u  IPv4 884101      0t0      TCP localhost:40584->localhost:2379 (ESTABLISHED)\r\npython  6770 neil    8u  IPv4 884108      0t0      TCP localhost:40588->localhost:2379 (ESTABLISHED)\r\npython  6770 neil   10u  IPv4 884113      0t0      TCP localhost:40592->localhost:2379 (ESTABLISHED)\r\npython  6770 neil   11u  IPv4 885316      0t0      TCP localhost:40596->localhost:2379 (ESTABLISHED)\r\npython  6770 neil   12u  IPv4 880574      0t0      TCP localhost:40600->localhost:2379 (ESTABLISHED)\r\n```\r\n\r\nI believe this pattern continues without any bound, because in an overnight OpenStack churn test with networking-calico, the DHCP agent (which uses etcd3gw, and creates and cancels watches as above) was found to have more than 900 open connections to etcd.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/11", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/11/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/11/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/11/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/11", "id": 272498138, "node_id": "MDU6SXNzdWUyNzI0OTgxMzg=", "number": 11, "title": "Doesn't respect the real key prefix", "user": {"login": "li-ma", "id": 5328977, "node_id": "MDQ6VXNlcjUzMjg5Nzc=", "avatar_url": "https://avatars2.githubusercontent.com/u/5328977?v=4", "gravatar_id": "", "url": "https://api.github.com/users/li-ma", "html_url": "https://github.com/li-ma", "followers_url": "https://api.github.com/users/li-ma/followers", "following_url": "https://api.github.com/users/li-ma/following{/other_user}", "gists_url": "https://api.github.com/users/li-ma/gists{/gist_id}", "starred_url": "https://api.github.com/users/li-ma/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/li-ma/subscriptions", "organizations_url": "https://api.github.com/users/li-ma/orgs", "repos_url": "https://api.github.com/users/li-ma/repos", "events_url": "https://api.github.com/users/li-ma/events{/privacy}", "received_events_url": "https://api.github.com/users/li-ma/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-11-09T09:43:38Z", "updated_at": "2017-11-28T08:46:34Z", "closed_at": "2017-11-28T08:46:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I use 'client.watch_prefix' API to watch a set of keys which start with '/tx-resource'.\r\nBut the system seems to always return the event with keys starting with '/tx-', including '/tx-status' and '/tx-resource'.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/9", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/9/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/9/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/9/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/9", "id": 258932321, "node_id": "MDU6SXNzdWUyNTg5MzIzMjE=", "number": 9, "title": "Having IPv6 addresses in client URL fails", "user": {"login": "jharbott", "id": 3973691, "node_id": "MDQ6VXNlcjM5NzM2OTE=", "avatar_url": "https://avatars0.githubusercontent.com/u/3973691?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jharbott", "html_url": "https://github.com/jharbott", "followers_url": "https://api.github.com/users/jharbott/followers", "following_url": "https://api.github.com/users/jharbott/following{/other_user}", "gists_url": "https://api.github.com/users/jharbott/gists{/gist_id}", "starred_url": "https://api.github.com/users/jharbott/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jharbott/subscriptions", "organizations_url": "https://api.github.com/users/jharbott/orgs", "repos_url": "https://api.github.com/users/jharbott/repos", "events_url": "https://api.github.com/users/jharbott/events{/privacy}", "received_events_url": "https://api.github.com/users/jharbott/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-09-19T19:16:12Z", "updated_at": "2017-09-19T20:35:38Z", "closed_at": "2017-09-19T20:35:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "See https://review.openstack.org/505168 for context, config file has:\r\n\r\n```[coordination]\r\nbackend_url = etcd3+http://[::1]:2379\r\n```\r\n\r\nbut it seems to get messed up along the way \r\n\r\n```\r\nSep 19 15:14:36.951835 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server [None req-bf45693c-0d1e-4e1f-884b-e1a5419b1a81 tempest-TestVolumeSwap-1355161147 None] Exception during message handling: InvalidURL: Failed to parse: ::1:2379\r\nSep 19 15:14:36.951988 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server Traceback (most recent call last):\r\nSep 19 15:14:36.952169 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/server.py\", line 160, in _process_incoming\r\nSep 19 15:14:36.952324 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     res = self.dispatcher.dispatch(message)\r\nSep 19 15:14:36.952500 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 222, in dispatch\r\nSep 19 15:14:36.952662 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return self._do_dispatch(endpoint, method, ctxt, args)\r\nSep 19 15:14:36.952804 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/oslo_messaging/rpc/dispatcher.py\", line 192, in _do_dispatch\r\nSep 19 15:14:36.952954 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     result = func(ctxt, **new_args)\r\nSep 19 15:14:36.953153 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"<decorator-gen-245>\", line 2, in attach_volume\r\nSep 19 15:14:36.953305 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/opt/stack/new/cinder/cinder/coordination.py\", line 169, in _synchronized\r\nSep 19 15:14:36.953439 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     with lock(blocking):\r\nSep 19 15:14:36.954766 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tooz/locking.py\", line 31, in __enter__\r\nSep 19 15:14:36.954949 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return self.lock.__enter__(*self.args, **self.kwargs)\r\nSep 19 15:14:36.955110 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tooz/locking.py\", line 52, in __enter__\r\nSep 19 15:14:36.955404 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     acquired = self.acquire(*args, **kwargs)\r\nSep 19 15:14:36.955559 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tooz/drivers/etcd3gw.py\", line 38, in wrapper\r\nSep 19 15:14:36.955711 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return func(*args, **kwargs)\r\nSep 19 15:14:36.958234 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tooz/drivers/etcd3gw.py\", line 113, in acquire\r\nSep 19 15:14:36.958396 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return _acquire()\r\nSep 19 15:14:36.958541 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tenacity/__init__.py\", line 171, in wrapped_f\r\nSep 19 15:14:36.958690 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return self.call(f, *args, **kw)\r\nSep 19 15:14:36.958850 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tenacity/__init__.py\", line 248, in call\r\nSep 19 15:14:36.959000 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     start_time=start_time)\r\nSep 19 15:14:36.959157 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tenacity/__init__.py\", line 203, in iter\r\nSep 19 15:14:36.959309 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return fut.result()\r\nSep 19 15:14:36.959461 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/concurrent/futures/_base.py\", line 422, in result\r\nSep 19 15:14:36.959612 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return self.__get_result()\r\nSep 19 15:14:36.959755 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tenacity/__init__.py\", line 251, in call\r\nSep 19 15:14:36.959902 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     result = fn(*args, **kwargs)\r\nSep 19 15:14:36.960044 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/tooz/drivers/etcd3gw.py\", line 82, in _acquire\r\nSep 19 15:14:36.960185 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     self._lease = self._coord.client.lease(self._timeout)\r\nSep 19 15:14:36.960332 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/etcd3gw/client.py\", line 113, in lease\r\nSep 19 15:14:36.960520 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     json={\"TTL\": ttl, \"ID\": 0})\r\nSep 19 15:14:36.960665 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/etcd3gw/client.py\", line 78, in post\r\nSep 19 15:14:36.960823 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     resp = self.session.post(*args, **kwargs)\r\nSep 19 15:14:36.960977 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/requests/sessions.py\", line 555, in post\r\nSep 19 15:14:36.961162 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     return self.request('POST', url, data=data, json=json, **kwargs)\r\nSep 19 15:14:36.961305 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/requests/sessions.py\", line 494, in request\r\nSep 19 15:14:36.961448 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     prep = self.prepare_request(req)\r\nSep 19 15:14:36.961607 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/requests/sessions.py\", line 437, in prepare_request\r\nSep 19 15:14:36.961757 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     hooks=merge_hooks(request.hooks, self.hooks),\r\nSep 19 15:14:36.961899 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/requests/models.py\", line 305, in prepare\r\nSep 19 15:14:36.962069 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     self.prepare_url(url, params)\r\nSep 19 15:14:36.962212 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server   File \"/usr/local/lib/python2.7/dist-packages/requests/models.py\", line 373, in prepare_url\r\nSep 19 15:14:36.962354 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server     raise InvalidURL(*e.args)\r\nSep 19 15:14:36.962495 ubuntu-xenial-infracloud-chocolate-10994920 cinder-volume[22504]: ERROR oslo_messaging.rpc.server InvalidURL: Failed to parse: ::1:2379\r\n\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/dims/etcd3-gateway/issues/2", "repository_url": "https://api.github.com/repos/dims/etcd3-gateway", "labels_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/2/labels{/name}", "comments_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/2/comments", "events_url": "https://api.github.com/repos/dims/etcd3-gateway/issues/2/events", "html_url": "https://github.com/dims/etcd3-gateway/issues/2", "id": 253163298, "node_id": "MDU6SXNzdWUyNTMxNjMyOTg=", "number": 2, "title": "RFE: Add the option to receive data in any encoding format in \"put/get\"", "user": {"login": "lihiwish", "id": 2715821, "node_id": "MDQ6VXNlcjI3MTU4MjE=", "avatar_url": "https://avatars0.githubusercontent.com/u/2715821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lihiwish", "html_url": "https://github.com/lihiwish", "followers_url": "https://api.github.com/users/lihiwish/followers", "following_url": "https://api.github.com/users/lihiwish/following{/other_user}", "gists_url": "https://api.github.com/users/lihiwish/gists{/gist_id}", "starred_url": "https://api.github.com/users/lihiwish/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lihiwish/subscriptions", "organizations_url": "https://api.github.com/users/lihiwish/orgs", "repos_url": "https://api.github.com/users/lihiwish/repos", "events_url": "https://api.github.com/users/lihiwish/events{/privacy}", "received_events_url": "https://api.github.com/users/lihiwish/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": true, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-08-27T13:21:35Z", "updated_at": "2017-09-05T13:05:13Z", "closed_at": "2017-09-05T13:05:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Currently utils._encode/utils._decode allows only utf-8. \r\nIf we want to use binary data (e.g msgpack), get returns an error:\r\nUnicodeDecodeError: 'utf8' codec can't decode byte 0x85 in position 0: invalid start byte", "performed_via_github_app": null, "score": 1.0}]}