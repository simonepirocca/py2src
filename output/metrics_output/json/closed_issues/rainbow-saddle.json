{"total_count": 2, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/14", "repository_url": "https://api.github.com/repos/flupke/rainbow-saddle", "labels_url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/14/labels{/name}", "comments_url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/14/comments", "events_url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/14/events", "html_url": "https://github.com/flupke/rainbow-saddle/issues/14", "id": 285385769, "node_id": "MDU6SXNzdWUyODUzODU3Njk=", "number": 14, "title": "The new master is orphaned", "user": {"login": "mindojo-victor", "id": 17159503, "node_id": "MDQ6VXNlcjE3MTU5NTAz", "avatar_url": "https://avatars1.githubusercontent.com/u/17159503?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mindojo-victor", "html_url": "https://github.com/mindojo-victor", "followers_url": "https://api.github.com/users/mindojo-victor/followers", "following_url": "https://api.github.com/users/mindojo-victor/following{/other_user}", "gists_url": "https://api.github.com/users/mindojo-victor/gists{/gist_id}", "starred_url": "https://api.github.com/users/mindojo-victor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mindojo-victor/subscriptions", "organizations_url": "https://api.github.com/users/mindojo-victor/orgs", "repos_url": "https://api.github.com/users/mindojo-victor/repos", "events_url": "https://api.github.com/users/mindojo-victor/events{/privacy}", "received_events_url": "https://api.github.com/users/mindojo-victor/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-01-02T09:28:28Z", "updated_at": "2018-01-15T10:32:08Z", "closed_at": "2018-01-15T10:32:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have this supervisor config:\r\n```ini\r\n[program:brain]\r\ncommand = rainbow-saddle --pid %(here)s/run/gunicorn.pid gunicorn --config=python:settings.gunicorn brain.application:application\r\n```\r\nWhen I start supervisor:\r\n![image](https://user-images.githubusercontent.com/17159503/34479447-a2c0fa8c-efaf-11e7-814a-9baaa7c70e44.png)\r\n\r\nWhen I send HUP signal to rainbow-saddle, it sends USR2 signal to Gunicorn, which forks into a new master. Then old master is killed, making the new master orphaned.\r\n\r\n**Is this the correct/expected behavior?**\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/1", "repository_url": "https://api.github.com/repos/flupke/rainbow-saddle", "labels_url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/1/labels{/name}", "comments_url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/1/comments", "events_url": "https://api.github.com/repos/flupke/rainbow-saddle/issues/1/events", "html_url": "https://github.com/flupke/rainbow-saddle/issues/1", "id": 59346343, "node_id": "MDU6SXNzdWU1OTM0NjM0Mw==", "number": 1, "title": "Sometimes HUP puts rainbow-saddle in state where gunicorn is stopped", "user": {"login": "asavoy", "id": 235466, "node_id": "MDQ6VXNlcjIzNTQ2Ng==", "avatar_url": "https://avatars1.githubusercontent.com/u/235466?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asavoy", "html_url": "https://github.com/asavoy", "followers_url": "https://api.github.com/users/asavoy/followers", "following_url": "https://api.github.com/users/asavoy/following{/other_user}", "gists_url": "https://api.github.com/users/asavoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/asavoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asavoy/subscriptions", "organizations_url": "https://api.github.com/users/asavoy/orgs", "repos_url": "https://api.github.com/users/asavoy/repos", "events_url": "https://api.github.com/users/asavoy/events{/privacy}", "received_events_url": "https://api.github.com/users/asavoy/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2015-02-28T15:57:47Z", "updated_at": "2015-04-29T07:29:43Z", "closed_at": "2015-04-29T07:26:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "Firstly, I'm not sure if rainbow-saddle is being used/maintained, and whether feedback is desired :)\n\nPresuming an affirmative to the above, I'm seeing for my project that 1 in 4 deployments that involve a HUP restart are leading to putting rainbow-saddle in a state where gunicorn is no longer running.\n\nThe sequence of events looks a bit like this:\n1. The rainbow-saddle/gunicorn process for the site is already running under `/srv/myapp/current`, which is a symlink.\n   The command is: \n   \n   ```\n   /srv/myapp/shared/env/bin/rainbow-saddle /srv/myapp/shared/env/bin/gunicorn wsgi:application -c /srv/myapp/shared/gunicorn_config.py --chdir /srv/myapp/current\n   ```\n2. Write the new version of the site into a new directory.\n3. Update symlink `/srv/myapp/current` to point to the new version of the site.\n4. Send HUP to the rainbow-saddle process, using something like `supervisorctl pid myapp | xargs kill -s HUP`.\n\nUsually this works, but sometimes it turns out that the gunicorn process has stopped (I'm not seeing any subprocess for rainbow-saddle in `htop`), and there's this in STDERR:\n\n```\n------------------------------------------------------------------------------\nStarting new arbiter\n------------------------------------------------------------------------------\nUncaught exception in signal handler <function restart_arbiter at 0x1c09cf8>\nTraceback (most recent call last):\n  File \"/srv/myapp/shared/env/local/lib/python2.7/site-packages/rainbowsaddle/__init__.py\", line 22, in wrapper\n    return func(*args, **kwargs)\n  File \"/srv/myapp/shared/env/local/lib/python2.7/site-packages/rainbowsaddle/__init__.py\", line 56, in restart_arbiter\n    os.kill(self.arbiter_pid, signal.SIGUSR2)\nOSError: [Errno 3] No such process\n```\n\nIf I try to send HUP again, I'll get that same output again.\n\nSome other things to help understand the problem:\n- I've run the restart command in a loop for a while, but it doesn't lead to this issue.\n- I'm doing a rolling deployment of 3 servers. When it fails on one, it will also fail on the other two. That would suggest the code changes deployed have something to do with it, but in my most recent instance, the code changes were merely Python tests and JavaScript changes.\n- I'm using rainbow-saddle 0.2, along with supervisor, gunicorn 19.1.1 and Django 1.6.10.\n\nWondering if there are any ideas for what I should do, that might help unearth the problem?\n", "performed_via_github_app": null, "score": 1.0}]}