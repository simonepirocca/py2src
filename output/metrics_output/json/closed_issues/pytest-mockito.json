{"total_count": 1, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/kaste/pytest-mockito/issues/1", "repository_url": "https://api.github.com/repos/kaste/pytest-mockito", "labels_url": "https://api.github.com/repos/kaste/pytest-mockito/issues/1/labels{/name}", "comments_url": "https://api.github.com/repos/kaste/pytest-mockito/issues/1/comments", "events_url": "https://api.github.com/repos/kaste/pytest-mockito/issues/1/events", "html_url": "https://github.com/kaste/pytest-mockito/issues/1", "id": 260130343, "node_id": "MDU6SXNzdWUyNjAxMzAzNDM=", "number": 1, "title": "Unused stubs causes errors in subsequent tests", "user": {"login": "ombre42", "id": 1576672, "node_id": "MDQ6VXNlcjE1NzY2NzI=", "avatar_url": "https://avatars3.githubusercontent.com/u/1576672?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ombre42", "html_url": "https://github.com/ombre42", "followers_url": "https://api.github.com/users/ombre42/followers", "following_url": "https://api.github.com/users/ombre42/following{/other_user}", "gists_url": "https://api.github.com/users/ombre42/gists{/gist_id}", "starred_url": "https://api.github.com/users/ombre42/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ombre42/subscriptions", "organizations_url": "https://api.github.com/users/ombre42/orgs", "repos_url": "https://api.github.com/users/ombre42/repos", "events_url": "https://api.github.com/users/ombre42/events{/privacy}", "received_events_url": "https://api.github.com/users/ombre42/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-09-25T01:06:10Z", "updated_at": "2018-07-11T17:20:13Z", "closed_at": "2017-09-25T11:48:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "If you have a class with say 10 tests where the class is using the unstub fixture, then, if any test causes `verifyStubbedInvocationsAreUsed` to fail by not using a stub, then that unused stub is not removed and causes errors in the teardown of all subsequent tests. This is distracting and it takes longer to find the problem due to pytest's verbosity. Calling `unstub` as test setup is also undesirable.\r\n\r\nThis is resolved by still calling `unstub` even when `verifyStubbedInvocationsAreUsed` fails.\r\nEither of the following fixes it. Not sure which one is better.\r\n\r\n```\r\n@pytest.fixture\r\ndef unstub():\r\n    from mockito import unstub, verifyStubbedInvocationsAreUsed, VerificationError\r\n    yield unstub\r\n\r\n    try:\r\n        verifyStubbedInvocationsAreUsed()\r\n    except VerificationError as e:\r\n        unstub()\r\n        raise e\r\n    else:\r\n        unstub()\r\n```\r\n\r\n```\r\n@pytest.fixture\r\ndef unstub():\r\n    from mockito import unstub, verifyStubbedInvocationsAreUsed\r\n    yield unstub\r\n\r\n    try:\r\n        verifyStubbedInvocationsAreUsed()\r\n    finally:\r\n        unstub()", "performed_via_github_app": null, "score": 1.0}]}