{"total_count": 3802, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/celery/celery/issues/6299", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6299/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6299/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6299/events", "html_url": "https://github.com/celery/celery/issues/6299", "id": 677822454, "node_id": "MDU6SXNzdWU2Nzc4MjI0NTQ=", "number": 6299, "title": "Configure celery", "user": {"login": "esloch", "id": 3450741, "node_id": "MDQ6VXNlcjM0NTA3NDE=", "avatar_url": "https://avatars3.githubusercontent.com/u/3450741?v=4", "gravatar_id": "", "url": "https://api.github.com/users/esloch", "html_url": "https://github.com/esloch", "followers_url": "https://api.github.com/users/esloch/followers", "following_url": "https://api.github.com/users/esloch/following{/other_user}", "gists_url": "https://api.github.com/users/esloch/gists{/gist_id}", "starred_url": "https://api.github.com/users/esloch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/esloch/subscriptions", "organizations_url": "https://api.github.com/users/esloch/orgs", "repos_url": "https://api.github.com/users/esloch/repos", "events_url": "https://api.github.com/users/esloch/events{/privacy}", "received_events_url": "https://api.github.com/users/esloch/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-08-12T16:25:11Z", "updated_at": "2020-08-12T16:26:48Z", "closed_at": "2020-08-12T16:26:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\nPlease fill this template entirely and do not erase parts of it.\nWe reserve the right to close without a response\nenhancement requests which are incomplete.\n-->\n# Checklist\n<!--\nTo check an item on the list replace [ ] with [x].\n-->\n\n- [ ] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Enhancement%22+-label%3A%22Category%3A+Documentation%22)\n  for similar or identical enhancement to an existing feature.\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22Issue+Type%3A+Enhancement%22+-label%3A%22Category%3A+Documentation%22)\n  for existing proposed enhancements.\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\n  to find out if the if the same enhancement was already implemented in the\n  master branch.\n- [ ] I have included all related issues and possible duplicate issues in this issue\n      (If there are none, check this box anyway).\n\n## Related Issues and Possible Duplicates\n<!--\nPlease make sure to search and mention any related issues\nor possible duplicates to this issue as requested by the checklist above.\n\nThis may or may not include issues in other repositories that the Celery project\nmaintains or other repositories that are dependencies of Celery.\n\nIf you don't know how to mention issues, please refer to Github's documentation\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\n-->\n\n#### Related Issues\n\n- None\n\n#### Possible Duplicates\n\n- None\n\n# Brief Summary\n<!--\nPlease include a brief summary of what the enhancement is\nand why it is needed.\n-->\n\n# Design\n\n## Architectural Considerations\n<!--\nIf more components other than Celery are involved,\ndescribe them here and the effect it would have on Celery.\n-->\nNone\n\n## Proposed Behavior\n<!--\nPlease describe in detail how this enhancement is going to change the behavior\nof an existing feature.\nDescribe what happens in case of failures as well if applicable.\n-->\n\n## Proposed UI/UX\n<!--\nPlease provide your ideas for the API, CLI options,\nconfiguration key names etc. that will be adjusted for this enhancement.\n-->\n\n## Diagrams\n<!--\nPlease include any diagrams that might be relevant\nto the implementation of this enhancement such as:\n* Class Diagrams\n* Sequence Diagrams\n* Activity Diagrams\nYou can drag and drop images into the text box to attach them to this issue.\n-->\nN/A\n\n## Alternatives\n<!--\nIf you have considered any alternative implementations\ndescribe them in detail below.\n-->\nNone\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6293", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6293/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6293/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6293/events", "html_url": "https://github.com/celery/celery/issues/6293", "id": 675311734, "node_id": "MDU6SXNzdWU2NzUzMTE3MzQ=", "number": 6293, "title": "Celery deamon trying to connect to amqp although configured to use redis", "user": {"login": "jameslao", "id": 5279743, "node_id": "MDQ6VXNlcjUyNzk3NDM=", "avatar_url": "https://avatars2.githubusercontent.com/u/5279743?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jameslao", "html_url": "https://github.com/jameslao", "followers_url": "https://api.github.com/users/jameslao/followers", "following_url": "https://api.github.com/users/jameslao/following{/other_user}", "gists_url": "https://api.github.com/users/jameslao/gists{/gist_id}", "starred_url": "https://api.github.com/users/jameslao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jameslao/subscriptions", "organizations_url": "https://api.github.com/users/jameslao/orgs", "repos_url": "https://api.github.com/users/jameslao/repos", "events_url": "https://api.github.com/users/jameslao/events{/privacy}", "received_events_url": "https://api.github.com/users/jameslao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-07T22:02:21Z", "updated_at": "2020-08-09T20:32:20Z", "closed_at": "2020-08-09T20:32:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "Worked fine in Celery 4.4.6. transport is configured to redis://127.0.0.1:6379/0\r\n\r\nAfter upgrading to Celery 4.4.7, running the celery by itself is fine, but when started with deamon (/etc/init.d/celeryd), it tries to connect to amqp and has the following error in the log files:\r\n\r\n```\r\n[2020-08-07 17:53:56,313: DEBUG/MainProcess] | Worker: Preparing bootsteps.\r\n[2020-08-07 17:53:56,315: DEBUG/MainProcess] | Worker: Building graph...\r\n[2020-08-07 17:53:56,315: DEBUG/MainProcess] | Worker: New boot order: {Beat, Timer, Hub, Pool, Autoscaler, StateDB, Consumer}\r\n[2020-08-07 17:53:56,321: DEBUG/MainProcess] | Consumer: Preparing bootsteps.\r\n[2020-08-07 17:53:56,322: DEBUG/MainProcess] | Consumer: Building graph...\r\n[2020-08-07 17:53:56,369: DEBUG/MainProcess] | Consumer: New boot order: {Connection, Events, Heart, Mingle, Tasks, Control, Agent, Gossip, event loop}\r\n[2020-08-07 17:53:56,384: DEBUG/MainProcess] | Worker: Starting Hub\r\n[2020-08-07 17:53:56,384: DEBUG/MainProcess] ^-- substep ok\r\n[2020-08-07 17:53:56,384: DEBUG/MainProcess] | Worker: Starting Pool\r\n[2020-08-07 17:53:56,436: DEBUG/MainProcess] ^-- substep ok\r\n[2020-08-07 17:53:56,437: DEBUG/MainProcess] | Worker: Starting Consumer\r\n[2020-08-07 17:53:56,437: DEBUG/MainProcess] | Consumer: Starting Connection\r\n[2020-08-07 17:53:56,447: ERROR/MainProcess] consumer: Cannot connect to amqp://guest:**@127.0.0.1:5672//: [Errno 111] Connection refused.\r\nTrying again in 2.00 seconds... (1/100)\r\n\r\n[2020-08-07 17:53:58,456: ERROR/MainProcess] consumer: Cannot connect to amqp://guest:**@127.0.0.1:5672//: [Errno 111] Connection refused.\r\nTrying again in 4.00 seconds... (2/100)\r\n\r\n[2020-08-07 17:54:02,467: ERROR/MainProcess] consumer: Cannot connect to amqp://guest:**@127.0.0.1:5672//: [Errno 111] Connection refused.\r\nTrying again in 6.00 seconds... (3/100)\r\n\r\n[2020-08-07 17:54:08,480: ERROR/MainProcess] consumer: Cannot connect to amqp://guest:**@127.0.0.1:5672//: [Errno 111] Connection refused.\r\nTrying again in 8.00 seconds... (4/100)\r\n```\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6292", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6292/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6292/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6292/events", "html_url": "https://github.com/celery/celery/issues/6292", "id": 674966281, "node_id": "MDU6SXNzdWU2NzQ5NjYyODE=", "number": 6292, "title": "Celery Worker not starting with queue", "user": {"login": "lshreyasharmal", "id": 22634041, "node_id": "MDQ6VXNlcjIyNjM0MDQx", "avatar_url": "https://avatars0.githubusercontent.com/u/22634041?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lshreyasharmal", "html_url": "https://github.com/lshreyasharmal", "followers_url": "https://api.github.com/users/lshreyasharmal/followers", "following_url": "https://api.github.com/users/lshreyasharmal/following{/other_user}", "gists_url": "https://api.github.com/users/lshreyasharmal/gists{/gist_id}", "starred_url": "https://api.github.com/users/lshreyasharmal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lshreyasharmal/subscriptions", "organizations_url": "https://api.github.com/users/lshreyasharmal/orgs", "repos_url": "https://api.github.com/users/lshreyasharmal/repos", "events_url": "https://api.github.com/users/lshreyasharmal/events{/privacy}", "received_events_url": "https://api.github.com/users/lshreyasharmal/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-08-07T11:56:24Z", "updated_at": "2020-08-07T19:23:41Z", "closed_at": "2020-08-07T19:23:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "`celery -A proj worker --autoscale=6,4 --loglevel=INFO -n worker_name -Q queue1,queue2`\r\n\r\nI am using django-celery to run a task which in turn schedules another task in the 2nd queue. I am using redis as the broker. The problem is that with the above command, the worker isn't running, there's no message being printed in the logs about the task after the worker is \"ready\" as seen below:\r\n\r\n> Logged in Successfully\r\n> System check identified some issues:\r\n> \r\n> WARNINGS:\r\n> ?: (urls.W005) URL namespace 'admin' isn't unique. You may not be able to reverse all URLs in this namespace\r\n>  \r\n>  -------------- celery@worker_name v3.1.25 (Cipater)\r\n> ---- **** ----- \r\n> --- * ***  * -- Linux-5.4.0-42-generic-x86_64-with-Ubuntu-18.04-bionic\r\n> -- * - **** --- \r\n> - ** ---------- [config]\r\n> - ** ---------- .> app:         proj:0x7f0d03316eb8\r\n> - ** ---------- .> transport:   redis://127.0.0.1:6379//\r\n> - ** ---------- .> results:     redis://127.0.0.1:6379/\r\n> - *** --- * --- .> concurrency: {min=4, max=6} (prefork)\r\n> -- ******* ---- \r\n> --- ***** ----- [queues]\r\n>  -------------- .> queue1           exchange=queue1(direct) key=queue1\r\n>                 .> queue2           exchange=queue2(direct) key=queue2\r\n> \r\n> [tasks]\r\n>   . proj.celery.debug_task\r\n>   . task1\r\n>   . task2\r\n> \r\n> [2020-07-31 14:53:31,916: INFO/MainProcess] Connected to redis://127.0.0.1:6379//\r\n> [2020-07-31 14:53:31,926: INFO/MainProcess] mingle: searching for neighbors\r\n> [2020-07-31 14:53:32,933: INFO/MainProcess] mingle: all alone\r\n> [2020-07-31 14:53:32,956: WARNING/MainProcess] {path}/superenv/lib/python3.6/site-packages/celery/fixups/django.py:265: UserWarning: Using settings.DEBUG leads to a memory leak, never use this setting in production environments!\r\n>   warnings.warn('Using settings.DEBUG leads to a memory leak, never '\r\n> [2020-07-31 14:53:32,956: WARNING/MainProcess] celery@worker_name ready.\r\n\r\ncelery==3.1.25\r\n\r\nDjango==2.1\r\n\r\ndjango-celery==3.2.1\r\n\r\nThe weird thing is that this command used to work earlier but now I have to run a worker separately in order to get it work using-> celery -A proj  worker --loglevel=info\r\n\r\nany ideas what I'm missing?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6280", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6280/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6280/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6280/events", "html_url": "https://github.com/celery/celery/issues/6280", "id": 671914107, "node_id": "MDU6SXNzdWU2NzE5MTQxMDc=", "number": 6280, "title": "stop loading pytest plugin by default", "user": {"login": "graingert", "id": 413772, "node_id": "MDQ6VXNlcjQxMzc3Mg==", "avatar_url": "https://avatars3.githubusercontent.com/u/413772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graingert", "html_url": "https://github.com/graingert", "followers_url": "https://api.github.com/users/graingert/followers", "following_url": "https://api.github.com/users/graingert/following{/other_user}", "gists_url": "https://api.github.com/users/graingert/gists{/gist_id}", "starred_url": "https://api.github.com/users/graingert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graingert/subscriptions", "organizations_url": "https://api.github.com/users/graingert/orgs", "repos_url": "https://api.github.com/users/graingert/repos", "events_url": "https://api.github.com/users/graingert/events{/privacy}", "received_events_url": "https://api.github.com/users/graingert/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46813, "node_id": "MDU6TGFiZWw0NjgxMw==", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Feature%20Request", "name": "Issue Type: Feature Request", "color": "0d0000", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-08-03T08:53:32Z", "updated_at": "2020-08-05T12:21:09Z", "closed_at": "2020-08-05T12:21:09Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "currently celery, by default, will add a set of fixtures and a mark, which can be confusing to new developers on a project when running `pytest --fixtures` and begin using them even through we've not yet opted into and started configuring them.\r\n\r\nAn alternative is to use an approach like https://github.com/aio-libs/pytest-aiohttp/ where there is a shim package that just lists an entrypoint, and depends on aiohttp.\r\n\r\nThose that don't want to install the shim package can add `pytest_plugins = 'celery.contrib.pytest'` to their `pytest.ini`\r\n\r\n\r\n\r\n<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nfeature requests which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n\r\n- [ ] I have checked the [issues list](https://github.com/celery/celery/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3A%22Issue+Type%3A+Feature+Request%22+)\r\n  for similar or identical feature requests.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?utf8=%E2%9C%93&q=is%3Apr+label%3A%22PR+Type%3A+Feature%22+)\r\n  for existing proposed implementations of this feature.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the if the same feature was already implemented in the\r\n  master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Brief Summary\r\n<!--\r\nPlease include a brief summary of what the feature does\r\nand why it is needed.\r\n-->\r\n\r\n# Design\r\n\r\n## Architectural Considerations\r\n<!--\r\nIf more components other than Celery are involved,\r\ndescribe them here and the effect it would have on Celery.\r\n-->\r\nNone\r\n\r\n## Proposed Behavior\r\n<!--\r\nPlease describe in detail how this feature is going to behave.\r\nDescribe what happens in case of failures as well if applicable.\r\n-->\r\n\r\n## Proposed UI/UX\r\n<!--\r\nPlease provide your ideas for the API, CLI options,\r\nconfiguration key names etc. that will be introduced for this feature.\r\n-->\r\n\r\n## Diagrams\r\n<!--\r\nPlease include any diagrams that might be relevant\r\nto the implementation of this feature such as:\r\n* Class Diagrams\r\n* Sequence Diagrams\r\n* Activity Diagrams\r\nYou can drag and drop images into the text box to attach them to this issue.\r\n-->\r\nN/A\r\n\r\n## Alternatives\r\n<!--\r\nIf you have considered any alternative implementations\r\ndescribe them in detail below.\r\n-->\r\nNone\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6278", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6278/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6278/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6278/events", "html_url": "https://github.com/celery/celery/issues/6278", "id": 671656961, "node_id": "MDU6SXNzdWU2NzE2NTY5NjE=", "number": 6278, "title": "Restore pydocstyle in CI", "user": {"login": "thedrow", "id": 48936, "node_id": "MDQ6VXNlcjQ4OTM2", "avatar_url": "https://avatars2.githubusercontent.com/u/48936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedrow", "html_url": "https://github.com/thedrow", "followers_url": "https://api.github.com/users/thedrow/followers", "following_url": "https://api.github.com/users/thedrow/following{/other_user}", "gists_url": "https://api.github.com/users/thedrow/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedrow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedrow/subscriptions", "organizations_url": "https://api.github.com/users/thedrow/orgs", "repos_url": "https://api.github.com/users/thedrow/repos", "events_url": "https://api.github.com/users/thedrow/events{/privacy}", "received_events_url": "https://api.github.com/users/thedrow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 400596400, "node_id": "MDU6TGFiZWw0MDA1OTY0MDA=", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Project%20Governance", "name": "Category: Project Governance", "color": "f9d0c4", "default": false, "description": null}, {"id": 7096, "node_id": "MDU6TGFiZWw3MDk2", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Enhancement", "name": "Issue Type: Enhancement", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2020-08-02T17:31:43Z", "updated_at": "2020-08-04T11:59:28Z", "closed_at": "2020-08-04T11:59:28Z", "author_association": "MEMBER", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nenhancement requests which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Enhancement%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical enhancement to an existing feature.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22Issue+Type%3A+Enhancement%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed enhancements.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the if the same enhancement was already implemented in the\r\n  master branch.\r\n- [x] I have included all related issues and possible duplicate issues in this issue\r\n      (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Brief Summary\r\n<!--\r\nPlease include a brief summary of what the enhancement is\r\nand why it is needed.\r\n-->\r\n\r\nI'm not sure when pydocstyle was removed from the build matrix but we I wasn't made aware of it.\r\nWe need this to ensure our documentation coverage and style are in check.\r\n\r\n# Design\r\n\r\nJust revert the commit which removed it.\r\n\r\n## Architectural Considerations\r\n<!--\r\nIf more components other than Celery are involved,\r\ndescribe them here and the effect it would have on Celery.\r\n-->\r\nNone\r\n\r\n## Proposed Behavior\r\n<!--\r\nPlease describe in detail how this enhancement is going to change the behavior\r\nof an existing feature.\r\nDescribe what happens in case of failures as well if applicable.\r\n-->\r\nN/A\r\n\r\n## Proposed UI/UX\r\n<!--\r\nPlease provide your ideas for the API, CLI options,\r\nconfiguration key names etc. that will be adjusted for this enhancement.\r\n-->\r\nN/A\r\n\r\n## Diagrams\r\n<!--\r\nPlease include any diagrams that might be relevant\r\nto the implementation of this enhancement such as:\r\n* Class Diagrams\r\n* Sequence Diagrams\r\n* Activity Diagrams\r\nYou can drag and drop images into the text box to attach them to this issue.\r\n-->\r\nN/A\r\n\r\n## Alternatives\r\n<!--\r\nIf you have considered any alternative implementations\r\ndescribe them in detail below.\r\n-->\r\nNone\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6275", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6275/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6275/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6275/events", "html_url": "https://github.com/celery/celery/issues/6275", "id": 671566891, "node_id": "MDU6SXNzdWU2NzE1NjY4OTE=", "number": 6275, "title": "celery  async send email   (Lookup timed out) ERROR", "user": {"login": "binbinjianjian", "id": 17212043, "node_id": "MDQ6VXNlcjE3MjEyMDQz", "avatar_url": "https://avatars1.githubusercontent.com/u/17212043?v=4", "gravatar_id": "", "url": "https://api.github.com/users/binbinjianjian", "html_url": "https://github.com/binbinjianjian", "followers_url": "https://api.github.com/users/binbinjianjian/followers", "following_url": "https://api.github.com/users/binbinjianjian/following{/other_user}", "gists_url": "https://api.github.com/users/binbinjianjian/gists{/gist_id}", "starred_url": "https://api.github.com/users/binbinjianjian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/binbinjianjian/subscriptions", "organizations_url": "https://api.github.com/users/binbinjianjian/orgs", "repos_url": "https://api.github.com/users/binbinjianjian/repos", "events_url": "https://api.github.com/users/binbinjianjian/events{/privacy}", "received_events_url": "https://api.github.com/users/binbinjianjian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 10795, "node_id": "MDU6TGFiZWwxMDc5NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Not%20a%20Bug", "name": "Status: Not a Bug", "color": "4c9439", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-02T07:10:35Z", "updated_at": "2020-08-03T02:57:55Z", "closed_at": "2020-08-02T11:12:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "celery start param:\r\n\r\ncelery -A ceshi worker -l info -P eventlet\r\n\r\nos:\r\nwindow10\r\n\r\n\r\n[2020-08-02 15:09:00,218: ERROR/MainProcess] Task ceshi.email[709cf57b-6a67-46c7-9d8e-56e6ce60a4a8] raised unexpected: gaierror(11002, 'Lookup timed out')\r\nTraceback (most recent call last):\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 425, in resolve\r\n    use_network=use_network)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 380, in query\r\n    return end()\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 359, in end\r\n    raise result[1]\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 340, in step\r\n    a = fun(*args, **kwargs)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\dns\\resolver.py\", line 1091, in query\r\n    True)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\dns\\resolver.py\", line 1043, in resolve\r\n    timeout = self._compute_timeout(start, lifetime)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\dns\\resolver.py\", line 950, in _compute_timeout\r\n    raise Timeout(timeout=duration)\r\ndns.exception.Timeout: The DNS operation timed out after 5.134687900543213 seconds\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\celery\\app\\trace.py\", line 385, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\celery\\app\\trace.py\", line 650, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"D:\\MyProgram\\code\\opsm-be-old\\app\\test_demo\\celery_test\\ceshi.py\", line 51, in email\r\n    yag.send(email_name, subject, contents=[body, html, img])\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\yagmail\\sender.py\", line 147, in send\r\n    self.login()\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\yagmail\\sender.py\", line 246, in login\r\n    self._login(self.credentials)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\yagmail\\sender.py\", line 192, in _login\r\n    self.smtp = self.connection(self.host, self.port, **self.kwargs)\r\n  File \"d:\\myprogram\\python36\\Lib\\smtplib.py\", line 1031, in __init__\r\n    source_address)\r\n  File \"d:\\myprogram\\python36\\Lib\\smtplib.py\", line 251, in __init__\r\n    (code, msg) = self.connect(host, port)\r\n  File \"d:\\myprogram\\python36\\Lib\\smtplib.py\", line 336, in connect\r\n    self.sock = self._get_socket(host, port, self.timeout)\r\n  File \"d:\\myprogram\\python36\\Lib\\smtplib.py\", line 1037, in _get_socket\r\n    self.source_address)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\green\\socket.py\", line 44, in create_connection\r\n    for res in getaddrinfo(host, port, 0, SOCK_STREAM):\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 517, in getaddrinfo\r\n    qname, addrs = _getaddrinfo_lookup(host, family, flags)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 490, in _getaddrinfo_lookup\r\n    raise err\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 479, in _getaddrinfo_lookup\r\n    answer = resolve(host, qfamily, False, use_network=use_network)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 432, in resolve\r\n    raise EAI_EAGAIN_ERROR\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 479, in _getaddrinfo_lookup\r\n    answer = resolve(host, qfamily, False, use_network=use_network)\r\n  File \"d:\\myprogram\\code\\project\\opsm-be\\.venv\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 432, in resolve\r\n    raise EAI_EAGAIN_ERROR\r\nsocket.gaierror: [Errno 11002] Lookup timed out", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6258", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6258/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6258/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6258/events", "html_url": "https://github.com/celery/celery/issues/6258", "id": 667973876, "node_id": "MDU6SXNzdWU2Njc5NzM4NzY=", "number": 6258, "title": "MongoDB result backend serialization logic issue", "user": {"login": "enkidulan", "id": 963412, "node_id": "MDQ6VXNlcjk2MzQxMg==", "avatar_url": "https://avatars2.githubusercontent.com/u/963412?v=4", "gravatar_id": "", "url": "https://api.github.com/users/enkidulan", "html_url": "https://github.com/enkidulan", "followers_url": "https://api.github.com/users/enkidulan/followers", "following_url": "https://api.github.com/users/enkidulan/following{/other_user}", "gists_url": "https://api.github.com/users/enkidulan/gists{/gist_id}", "starred_url": "https://api.github.com/users/enkidulan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/enkidulan/subscriptions", "organizations_url": "https://api.github.com/users/enkidulan/orgs", "repos_url": "https://api.github.com/users/enkidulan/repos", "events_url": "https://api.github.com/users/enkidulan/events{/privacy}", "received_events_url": "https://api.github.com/users/enkidulan/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235025496, "node_id": "MDU6TGFiZWwyMzUwMjU0OTY=", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20MongoDB%20Results%20Backend", "name": "Component: MongoDB Results Backend", "color": "009800", "default": false, "description": null}, {"id": 1290485221, "node_id": "MDU6TGFiZWwxMjkwNDg1MjIx", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20Task%20Serialization", "name": "Component: Task Serialization", "color": "34d3ce", "default": false, "description": ""}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 0, "created_at": "2020-07-29T16:25:01Z", "updated_at": "2020-07-30T16:14:45Z", "closed_at": "2020-07-30T16:14:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- In https://github.com/celery/celery/pull/5661 PR result encoding was removed from `_store_result` call.\r\n- In https://github.com/celery/celery/pull/5918 PR missing result encoding on storing has been attempted to be resolved by adding `encode` call on `decode` call. \r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n`store_result` uses `serializer`.\r\n\r\n# Actual Behavior\r\n`store_result` ignores `serializer`, so getting serialization errors for data types that are compatible with chosen serializer.\r\n\r\nFor more details please refer to tests in https://github.com/celery/celery/pull/6259\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6256", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6256/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6256/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6256/events", "html_url": "https://github.com/celery/celery/issues/6256", "id": 667909831, "node_id": "MDU6SXNzdWU2Njc5MDk4MzE=", "number": 6256, "title": "flakey test test_chord.test_add_chord_to_chord", "user": {"login": "graingert", "id": 413772, "node_id": "MDQ6VXNlcjQxMzc3Mg==", "avatar_url": "https://avatars3.githubusercontent.com/u/413772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graingert", "html_url": "https://github.com/graingert", "followers_url": "https://api.github.com/users/graingert/followers", "following_url": "https://api.github.com/users/graingert/following{/other_user}", "gists_url": "https://api.github.com/users/graingert/gists{/gist_id}", "starred_url": "https://api.github.com/users/graingert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graingert/subscriptions", "organizations_url": "https://api.github.com/users/graingert/orgs", "repos_url": "https://api.github.com/users/graingert/repos", "events_url": "https://api.github.com/users/graingert/events{/privacy}", "received_events_url": "https://api.github.com/users/graingert/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-07-29T14:54:48Z", "updated_at": "2020-07-31T17:32:05Z", "closed_at": "2020-07-31T17:32:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\n\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015 test_chord.test_add_chord_to_chord \u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\u2015\r\nself = <t.integration.test_canvas.test_chord object at 0x7fd694409220>\r\nmanager = <celery.contrib.testing.manager.Manager object at 0x7fd6944093a0>\r\n    @pytest.mark.flaky(reruns=5, reruns_delay=1, cause=is_retryable_exception)\r\n    def test_add_chord_to_chord(self, manager):\r\n        if not manager.app.conf.result_backend.startswith('redis'):\r\n            raise pytest.skip('Requires redis result backend.')\r\n\r\n        c = group([add_chord_to_chord.s([1, 2, 3], 4)]) | identity.s()\r\n        res = c()\r\n>       assert res.get() == [0, 5 + 6 + 7]\r\nE       assert [18, 0] == [0, 18]\r\nE         At index 0 diff: 18 != 0\r\nE         Full diff:\r\nE         - [18, 0]\r\nE         + [0, 18]\r\nt/integration/test_canvas.py:630: AssertionError\r\n------------------------------ Captured log call -------------------------------\r\n```\r\n\r\nseems some ordering issue?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6250", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6250/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6250/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6250/events", "html_url": "https://github.com/celery/celery/issues/6250", "id": 667159447, "node_id": "MDU6SXNzdWU2NjcxNTk0NDc=", "number": 6250, "title": "dependency on future module breaks many things (including vim ultisnips)", "user": {"login": "graingert", "id": 413772, "node_id": "MDQ6VXNlcjQxMzc3Mg==", "avatar_url": "https://avatars3.githubusercontent.com/u/413772?v=4", "gravatar_id": "", "url": "https://api.github.com/users/graingert", "html_url": "https://github.com/graingert", "followers_url": "https://api.github.com/users/graingert/followers", "following_url": "https://api.github.com/users/graingert/following{/other_user}", "gists_url": "https://api.github.com/users/graingert/gists{/gist_id}", "starred_url": "https://api.github.com/users/graingert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/graingert/subscriptions", "organizations_url": "https://api.github.com/users/graingert/orgs", "repos_url": "https://api.github.com/users/graingert/repos", "events_url": "https://api.github.com/users/graingert/events{/privacy}", "received_events_url": "https://api.github.com/users/graingert/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 3, "created_at": "2020-07-28T15:19:25Z", "updated_at": "2020-07-29T16:22:37Z", "closed_at": "2020-07-28T16:39:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "the dependency on future-0.18.2 adds many packages that squat on py3 stdlib names eg:\r\n\r\n```\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/_dummy_thread/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/_markupbase/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/_thread/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/builtins/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/copyreg/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/future-0.18.2.dist-info/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/future/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/html/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/http/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/libfuturize/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/libpasteurize/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/past/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/queue/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/reprlib/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/socketserver/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/tkinter/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/winreg/*\r\n    /home/graingert/.virtualenvs/celery2/lib/python2.7/site-packages/xmlrpc/*\r\n```\r\n\r\nthis breaks packages that rely on feature detection of these modules.\r\n\r\nI propose replacing future with six because:\r\n\r\n* future does not provide a wheel, six has a wheel\r\n* future last release Oct 31, 2019, six released Oct 31, 2019\r\n* future is 829.2 kB, six is (11.0 kB) \r\n* celery already depends on six, via kombu and importlib-metadata, and so swapping out future with six would save 829.2 kB, rather than just 818.2 kB\r\n\r\n<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6248", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6248/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6248/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6248/events", "html_url": "https://github.com/celery/celery/issues/6248", "id": 666867684, "node_id": "MDU6SXNzdWU2NjY4Njc2ODQ=", "number": 6248, "title": "flask celery request   django celery request ", "user": {"login": "wangguanfu", "id": 28046533, "node_id": "MDQ6VXNlcjI4MDQ2NTMz", "avatar_url": "https://avatars0.githubusercontent.com/u/28046533?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wangguanfu", "html_url": "https://github.com/wangguanfu", "followers_url": "https://api.github.com/users/wangguanfu/followers", "following_url": "https://api.github.com/users/wangguanfu/following{/other_user}", "gists_url": "https://api.github.com/users/wangguanfu/gists{/gist_id}", "starred_url": "https://api.github.com/users/wangguanfu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wangguanfu/subscriptions", "organizations_url": "https://api.github.com/users/wangguanfu/orgs", "repos_url": "https://api.github.com/users/wangguanfu/repos", "events_url": "https://api.github.com/users/wangguanfu/events{/privacy}", "received_events_url": "https://api.github.com/users/wangguanfu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-28T08:20:37Z", "updated_at": "2020-07-28T08:31:26Z", "closed_at": "2020-07-28T08:31:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "###What's the same code? Why do I use Django celery==4.4.0 request to make a false report \u3002on flask\uff0c and I can't report it wrong\r\n\r\n[tasks]\r\n  . eciTask.notifyTask.ncStatistics\r\n\r\n[2020-07-28 16:09:09,350: INFO/MainProcess] Connected to redis://127.0.0.1:6379/5\r\n[2020-07-28 16:09:09,356: INFO/MainProcess] mingle: searching for neighbors\r\n[2020-07-28 16:09:10,402: INFO/MainProcess] mingle: all alone\r\n[2020-07-28 16:09:10,415: WARNING/MainProcess] d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\celery\\fixups\\django.py:206: UserWarning: Using settings.DEBUG leads to a memory\r\n            leak, never use this setting in production environments!\r\n  leak, never use this setting in production environments!''')\r\n[2020-07-28 16:09:10,416: INFO/MainProcess] celery@D-C02200BD-1453 ready.\r\n[2020-07-28 16:09:10,424: INFO/MainProcess] pidbox: Connected to redis://127.0.0.1:6379/5.\r\n[2020-07-28 16:09:16,608: INFO/MainProcess] Received task: eciTask.notifyTask.ncStatistics[f2941166-747d-47e6-b13f-57d02f74977f]\r\n[2020-07-28 16:09:16,951: WARNING/MainProcess] {'\u62a5\u8b66': ['192.168.1.196', '192.168.1.196', '192.168.1.196', '192.168.1.196', '192.168.1.196']}\r\n[2020-07-28 16:09:26,443: INFO/MainProcess] Received task: eciTask.notifyTask.ncStatistics[d1cfad3c-0a00-4521-a791-8f2ae23caaa9]\r\n[2020-07-28 16:09:26,647: WARNING/MainProcess] {'\u62a5\u8b66': ['192.168.1.196', '192.168.1.196', '192.168.1.196', '192.168.1.196', '192.168.1.196']}\r\n[2020-07-28 16:09:27,275: ERROR/MainProcess] Task eciTask.notifyTask.ncStatistics[f2941166-747d-47e6-b13f-57d02f74977f] raised unexpected: gaierror(11002, 'Lookup timed out')\r\nTraceback (most recent call last):\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 425, in resolve\r\n    use_network=use_network)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 380, in query\r\n    return end()\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 359, in end\r\n    raise result[1]\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 340, in step\r\n    a = fun(*args, **kwargs)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\dns\\resolver.py\", line 1091, in query\r\n    True)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\dns\\resolver.py\", line 1043, in resolve\r\n    timeout = self._compute_timeout(start, lifetime)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\dns\\resolver.py\", line 950, in _compute_timeout\r\n    raise Timeout(timeout=duration)\r\ndns.exception.Timeout: The DNS operation timed out after 5.135733604431152 seconds\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\celery\\app\\trace.py\", line 412, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\celery\\app\\trace.py\", line 704, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"D:\\work\\kangaroo_monitor\\kangaroo_monitor_django\\eciTask\\notifyTask.py\", line 55, in ncStatistics\r\n    _baseSendMsg(content, 18510234326)\r\n  File \"D:\\work\\kangaroo_monitor\\kangaroo_monitor_django\\notifyHardler\\DingDingHardler.py\", line 49, in _baseSendMsg\r\n    conn.request(\"POST\", uri, json.dumps(dingMsg), headers)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\http\\client.py\", line 1252, in request\r\n    self._send_request(method, url, body, headers, encode_chunked)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\http\\client.py\", line 1298, in _send_request\r\n    self.endheaders(body, encode_chunked=encode_chunked)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\http\\client.py\", line 1247, in endheaders\r\n    self._send_output(message_body, encode_chunked=encode_chunked)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\http\\client.py\", line 1026, in _send_output\r\n    self.send(msg)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\http\\client.py\", line 966, in send\r\n    self.connect()\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\http\\client.py\", line 1414, in connect\r\n    super().connect()\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\http\\client.py\", line 938, in connect\r\n    (self.host,self.port), self.timeout, self.source_address)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\socket.py\", line 707, in create_connection\r\n    for res in getaddrinfo(host, port, 0, SOCK_STREAM):\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 517, in getaddrinfo\r\n    qname, addrs = _getaddrinfo_lookup(host, family, flags)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 490, in _getaddrinfo_lookup\r\n    raise err\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 479, in _getaddrinfo_lookup\r\n    answer = resolve(host, qfamily, False, use_network=use_network)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 432, in resolve\r\n    raise EAI_EAGAIN_ERROR\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 479, in _getaddrinfo_lookup\r\n    answer = resolve(host, qfamily, False, use_network=use_network)\r\n  File \"d:\\work\\anaconda3\\envs\\django3\\lib\\site-packages\\eventlet\\support\\greendns.py\", line 432, in resolve\r\n    raise EAI_EAGAIN_ERROR\r\nsocket.gaierror: [Errno 11002] Lookup timed out\r\n\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6247", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6247/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6247/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6247/events", "html_url": "https://github.com/celery/celery/issues/6247", "id": 666748601, "node_id": "MDU6SXNzdWU2NjY3NDg2MDE=", "number": 6247, "title": "RecursionError: maximum recursion depth exceeded while calling a Python object", "user": {"login": "wangguanfu", "id": 28046533, "node_id": "MDQ6VXNlcjI4MDQ2NTMz", "avatar_url": "https://avatars0.githubusercontent.com/u/28046533?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wangguanfu", "html_url": "https://github.com/wangguanfu", "followers_url": "https://api.github.com/users/wangguanfu/followers", "following_url": "https://api.github.com/users/wangguanfu/following{/other_user}", "gists_url": "https://api.github.com/users/wangguanfu/gists{/gist_id}", "starred_url": "https://api.github.com/users/wangguanfu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wangguanfu/subscriptions", "organizations_url": "https://api.github.com/users/wangguanfu/orgs", "repos_url": "https://api.github.com/users/wangguanfu/repos", "events_url": "https://api.github.com/users/wangguanfu/events{/privacy}", "received_events_url": "https://api.github.com/users/wangguanfu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-07-28T04:26:49Z", "updated_at": "2020-07-28T13:31:44Z", "closed_at": "2020-07-28T05:37:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "when i start a  beat\r\ncelery                 4.4.6\r\nDjango                 2.0.4\r\nrequests\r\n\r\n__init__.py\r\nfrom __future__ import absolute_import\r\nfrom celery import Celery\r\n\r\napp = Celery('tasks')\r\napp.config_from_object('celery_task.celeryconfig')\r\n\r\n\r\ncelery.py\r\nfrom __future__ import absolute_import, unicode_literals\r\nimport os\r\nfrom datetime import timedelta\r\nfrom celery import Celery\r\n\r\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'kangaroo_monitor_django.settings')\r\napp = Celery('kangaroo_monitor_django').\r\napp.config_from_object('django.conf:settings', namespace='CELERY')\r\napp.autodiscover_tasks()\r\n\r\n@app.on_after_configure.connect\r\ndef setup_periodic_tasks(sender, **kwargs):\r\n    from eciTask.notifyTask import ncStatistics\r\n    sender.add_periodic_task(10.0, ncStatistics.s(), name='nc')\r\n\r\n\r\neciTask/notifyTask.py\r\nfrom celery import shared_task\r\n\r\n@shared_task\r\ndef ncStatistics():\r\n      requests.post()\r\n\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6244", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6244/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6244/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6244/events", "html_url": "https://github.com/celery/celery/issues/6244", "id": 666581681, "node_id": "MDU6SXNzdWU2NjY1ODE2ODE=", "number": 6244, "title": "REMAP_SIGTERM=SIGQUIT not working", "user": {"login": "sayanarijit", "id": 11632726, "node_id": "MDQ6VXNlcjExNjMyNzI2", "avatar_url": "https://avatars1.githubusercontent.com/u/11632726?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sayanarijit", "html_url": "https://github.com/sayanarijit", "followers_url": "https://api.github.com/users/sayanarijit/followers", "following_url": "https://api.github.com/users/sayanarijit/following{/other_user}", "gists_url": "https://api.github.com/users/sayanarijit/gists{/gist_id}", "starred_url": "https://api.github.com/users/sayanarijit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sayanarijit/subscriptions", "organizations_url": "https://api.github.com/users/sayanarijit/orgs", "repos_url": "https://api.github.com/users/sayanarijit/repos", "events_url": "https://api.github.com/users/sayanarijit/events{/privacy}", "received_events_url": "https://api.github.com/users/sayanarijit/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-27T21:00:26Z", "updated_at": "2020-07-28T17:04:41Z", "closed_at": "2020-07-28T17:04:41Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- https://github.com/celery/celery/issues/2839\r\n- https://github.com/celery/celery/issues/4550\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.6 (cliffs) kombu:4.6.11 py:3.7.6\r\n            billiard:3.6.3.0 redis:3.5.3\r\nplatform -> system:Darwin arch:64bit\r\n            kernel version:19.6.0 imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:redis results:disabled\r\n\r\nbroker_url: 'redis://h:********@ec2-23-21-96-121.compute-1.amazonaws.com:24849//'\r\ncelery_backend_result: 'redis://h:********@ec2-23-21-96-121.compute-1.amazonaws.com:24849/'\r\ntask_acks_late: True\r\ntask_reject_on_worker_lost: True\r\ntask_time_limit: 300\r\nbroker_transport_options: {\r\n 'visibility_timeout': 3600}\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.6.0\r\nappdirs==1.4.4\r\nattrs==19.3.0\r\nbilliard==3.6.3.0\r\nblack==19.10b0\r\ncelery==4.4.6\r\nclick==7.1.2\r\nflake8==3.8.3\r\nfuture==0.18.2\r\nimportlib-metadata==1.7.0\r\nkombu==4.6.11\r\nmccabe==0.6.1\r\nmypy==0.782\r\nmypy-extensions==0.4.3\r\npathspec==0.8.0\r\npycodestyle==2.6.0\r\npyflakes==2.2.0\r\npytz==2020.1\r\nredis==3.5.3\r\nregex==2020.7.14\r\ntoml==0.10.1\r\ntyped-ast==1.4.1\r\ntyping-extensions==3.7.4.2\r\nvine==1.3.0\r\nzipp==3.1.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\nI have reproduced it here: https://github.com/sayanarijit/remap-sigterm\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nhttps://github.com/sayanarijit/remap-sigterm#what-should-happen\r\n\r\n- The task is queued by redis.\r\n- Heroku worker starts executing the task which goes to a 5 min. sleep.\r\n- When shutdown, Heroku worker sends SIGQUIT (because REMAP_SIGTERM=\"SIGQUIT\") to the worker.\r\n- The worker exists immediately never acknowledging the task (the task stays in queue).\r\n- After the worker comes back, it fetches the task from queue and starts running again.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nhttps://github.com/sayanarijit/remap-sigterm#what-happens\r\n\r\n- The task is queued by redis.\r\n- Heroku worker starts executing the task which goes to a 5 min. sleep.\r\n- When shutdown, Heroku worker sends SIGTERM to the worker.\r\n- The worker waits for the process to exit.\r\n- After 30 seconds it kills the worker.\r\n- After the worker comes back, the queue is empty. Hence task is lost.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6242", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6242/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6242/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6242/events", "html_url": "https://github.com/celery/celery/issues/6242", "id": 666290945, "node_id": "MDU6SXNzdWU2NjYyOTA5NDU=", "number": 6242, "title": "Celery with SQS - Unrestored task ", "user": {"login": "jainraj", "id": 44366505, "node_id": "MDQ6VXNlcjQ0MzY2NTA1", "avatar_url": "https://avatars0.githubusercontent.com/u/44366505?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jainraj", "html_url": "https://github.com/jainraj", "followers_url": "https://api.github.com/users/jainraj/followers", "following_url": "https://api.github.com/users/jainraj/following{/other_user}", "gists_url": "https://api.github.com/users/jainraj/gists{/gist_id}", "starred_url": "https://api.github.com/users/jainraj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jainraj/subscriptions", "organizations_url": "https://api.github.com/users/jainraj/orgs", "repos_url": "https://api.github.com/users/jainraj/repos", "events_url": "https://api.github.com/users/jainraj/events{/privacy}", "received_events_url": "https://api.github.com/users/jainraj/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-27T13:21:58Z", "updated_at": "2020-07-28T21:06:32Z", "closed_at": "2020-07-28T01:26:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.2.1 (windowlicker) kombu:4.6.7 py:3.6.5\r\n            billiard:3.5.0.5 sqs:N/A\r\nplatform -> system:Darwin arch:64bit imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:sqs results:disabled\r\n\r\nBROKER_TRANSPORT_OPTIONS: {\r\n    'polling_interval': 1,\r\n    'queue_name_prefix': 'celery_dev-',\r\n    'region': 'eu-west-1',\r\n    'sqs-creation-attributes': {'KmsMasterKeyId': '********'},\r\n    'visibility_timeout': 3600,\r\n    'wait_time_seconds': 10}\r\nBROKER_URL: 'sqs://localhost//'\r\nCELERYBEAT_SCHEDULE: {***}\r\nCELERYD_LOG_FORMAT: ('%(asctime)s %(name)s '\r\n '%(process)d-0@local '\r\n '[%(levelname)s] %(pathname)s:%(lineno)d '\r\n '%(funcName)s(): %(module)s: %(message)s')\r\nCELERY_ACKS_LATE: True\r\nCELERY_ENABLE_REMOTE_CONTROL: False\r\nCELERY_ENABLE_UTC: True\r\nCELERY_SEND_EVENTS: False\r\nCELERY_TIMEZONE: 'Asia/Kolkata'\r\nDEBUG: True\r\nDEFAULT_VISIBILITY_TIMEOUT: 3600\r\nREGION_NAME: 'eu-west-1'\r\nUSE_API_AUTH: '********'\r\ncrontab: <class 'celery.schedules.crontab'>\r\nenv: 'dev'\r\ngethostname: <built-in function gethostname>\r\nCELERY_INCLUDE: ['tasks.generic_tasks']\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: Python 3.6.5 \r\n* **Minimal Celery Version**: 4.2.1\r\n* **Minimal Kombu Version**: 4.6.7\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.5.2\r\naws-requests-auth==0.4.2\r\nawscli==1.16.53\r\nbilliard==3.5.0.5\r\nboto3==1.9.161\r\nbotocore==1.12.182\r\ncelery==4.2.1\r\ncertifi==2019.11.28\r\nchardet==3.0.4\r\ncircus==0.15.0\r\nclick==6.7\r\ncolorama==0.3.9\r\ndocutils==0.14\r\nelasticsearch==6.2.0\r\nelasticsearch-curator==5.8.0\r\nflasgger==0.9.2\r\nFlask==1.0.2\r\ngunicorn==19.9.0\r\nidna==2.7\r\nimportlib-metadata==1.3.0\r\nitsdangerous==1.1.0\r\nJinja2==2.10\r\njmespath==0.9.3\r\njsonpickle==1.0\r\njsonschema==2.6.0\r\nkombu==4.6.7\r\nMarkupSafe==1.0\r\nmistune==0.8.4\r\nmore-itertools==8.0.2\r\nmysqlclient==1.3.13\r\npsutil==5.4.8\r\npyasn1==0.4.4\r\npycurl==7.43.0.1\r\npython-dateutil==2.7.5\r\npytz==2018.7\r\nPyYAML==3.13\r\npyzmq==16.0.4\r\nredis==2.10.6\r\nrequests==2.19.1\r\nrequests-aws4auth==0.9\r\nrsa==3.4.2\r\ns3transfer==0.2.1\r\nsix==1.11.0\r\nSQLAlchemy==1.2.14\r\ntornado==4.5.3\r\nurllib3==1.22\r\nvine==1.3.0\r\nvoluptuous==0.11.7\r\nWerkzeug==0.14.1\r\nzipp==0.6.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\nObtained this issue once in production\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nTask should be processed by other available consumers\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n\r\n## Context\r\n\r\n- We have 3 machines in prod for celery workers and have a one-by-one deployment strategy. Hence, at any time, we have 2 workers available to pick up tasks \r\n- As mentioned above, the visibility timeout is kept 1 hr \r\n- We have one task which is triggered by 2 crons. One cron @ 5th, 35th and 50th minute of every hour. Another @ 20th minute. (The difference is in parameters passed to the task) \r\n\r\n## Issue \r\n- Around 9:20 PM, we had a deployment for the celery worker machines. The beat machine was deployed later. \r\n- A task, T1, was scheduled successfully. Verified by the \"Sending due task\" logs from beat machine\r\n- Ideally within a few seconds, the task is picked up by the worker machines, but no logs are found. I checked the logs of \"Received task\" \r\n- Around 10:20 PM, beat schedules another task (T2). Verified by the \"Sending due task\" logs from beat machine\r\n- This time, we see the \"Received task\" logs twice. \r\n- Verified that they are not the same task \"instance\" by comparing the task ids. This also rules out the possibility that SQS gave double delivery (at least once effort)\r\n\r\n## Hypothesis\r\nThe task, T1, was received by the master process in one machine. This triggered the visibility timer at SQS. The task was not yet passed to the worker threads. During sigterm, the task was not restored to SQS and thus, after the visibility timeout = 1 hr, the task got picked up and executed \r\n\r\n## Callouts \r\n- This issue has occurred once as per our knowledge (I discovered this while root causing another issue). Thus, unsure if this is happening already multiple times but not getting caught.\r\n- Unable to reproduce this on local / beta machines\r\n\r\n## Expectation from the community\r\n1. Does the hypothesis imply the issue? \r\n2. Any ideas on how to reproduce such a condition successfully? \r\n3. What logs would be better to switch on at celery side so that we can catch this issue next time it happens. (We can't possibly move to debug level because the sheer volume is too high) \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6240", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6240/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6240/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6240/events", "html_url": "https://github.com/celery/celery/issues/6240", "id": 665621548, "node_id": "MDU6SXNzdWU2NjU2MjE1NDg=", "number": 6240, "title": "Redis not clearing out despite having `CELERY_RESULT_EXPIRES` configuration", "user": {"login": "bonkstonk", "id": 68785571, "node_id": "MDQ6VXNlcjY4Nzg1NTcx", "avatar_url": "https://avatars3.githubusercontent.com/u/68785571?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bonkstonk", "html_url": "https://github.com/bonkstonk", "followers_url": "https://api.github.com/users/bonkstonk/followers", "following_url": "https://api.github.com/users/bonkstonk/following{/other_user}", "gists_url": "https://api.github.com/users/bonkstonk/gists{/gist_id}", "starred_url": "https://api.github.com/users/bonkstonk/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bonkstonk/subscriptions", "organizations_url": "https://api.github.com/users/bonkstonk/orgs", "repos_url": "https://api.github.com/users/bonkstonk/repos", "events_url": "https://api.github.com/users/bonkstonk/events{/privacy}", "received_events_url": "https://api.github.com/users/bonkstonk/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235025402, "node_id": "MDU6TGFiZWwyMzUwMjU0MDI=", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20Redis%20Results%20Backend", "name": "Component: Redis Results Backend", "color": "009800", "default": false, "description": null}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/7", "html_url": "https://github.com/celery/celery/milestone/7", "labels_url": "https://api.github.com/repos/celery/celery/milestones/7/labels", "id": 592, "node_id": "MDk6TWlsZXN0b25lNTky", "number": 7, "title": "v5.0.0", "description": "Release 5.0.0 which breaks backwards compatibility, drops Legacy Python (python2) support and more. asyncio and many more.", "creator": {"login": "ask", "id": 1558, "node_id": "MDQ6VXNlcjE1NTg=", "avatar_url": "https://avatars2.githubusercontent.com/u/1558?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ask", "html_url": "https://github.com/ask", "followers_url": "https://api.github.com/users/ask/followers", "following_url": "https://api.github.com/users/ask/following{/other_user}", "gists_url": "https://api.github.com/users/ask/gists{/gist_id}", "starred_url": "https://api.github.com/users/ask/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ask/subscriptions", "organizations_url": "https://api.github.com/users/ask/orgs", "repos_url": "https://api.github.com/users/ask/repos", "events_url": "https://api.github.com/users/ask/events{/privacy}", "received_events_url": "https://api.github.com/users/ask/received_events", "type": "User", "site_admin": false}, "open_issues": 26, "closed_issues": 35, "state": "open", "created_at": "2011-04-10T12:50:55Z", "updated_at": "2020-08-19T17:19:46Z", "due_on": "2020-12-16T08:00:00Z", "closed_at": null}, "comments": 2, "created_at": "2020-07-25T17:13:28Z", "updated_at": "2020-08-17T04:06:50Z", "closed_at": "2020-08-17T04:06:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [x] I have tried reproducing the issue on more than one operating system.\r\n- [x] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.6 (cliffs) kombu:4.6.11 py:3.8.2\r\n            billiard:3.6.3.0 redis:3.5.3\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:4.4.0-18362-Microsoft imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:redis results:redis://localhost:6379/0\r\n\r\nBROKER_URL: 'redis://localhost:6379/0'\r\nCELERY_RESULT_BACKEND: 'redis://localhost:6379/0'\r\nCELERY_RESULT_EXPIRES: 15\r\nBROKER_POOL_LIMIT: 0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n\r\n* **Minimal Python Version**: 3.8.2\r\n* **Minimal Celery Version**: 4.4.6 (cliffs)\r\n* **Minimal Kombu Version**: 4.6.11\r\n* **Minimal Broker Version**: Redis server v=5.0.7\r\n* **Minimal Result Backend Version**: Redis server v=5.0.7\r\n* **Minimal OS and/or Kernel Version**: WSL on Windows 10\r\n* **Minimal Broker Client Version**: redis:3.5.3\r\n* **Minimal Result Backend Client Version**: redis:3.5.3\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<p>\r\n\r\n```python\r\nfrom celery import Celery\r\n\r\nCONFIG = {\r\n    'BROKER_URL': 'redis://localhost:6379/0',\r\n    'CELERY_RESULT_BACKEND': 'redis://localhost:6379/0',\r\n    'CELERY_RESULT_EXPIRES': 15, # 15 secs\r\n    'BROKER_POOL_LIMIT': 0, # redis connection get closed once task is done..\r\n}\r\n\r\n\r\ncelery = Celery('tasks', config_source=CONFIG)\r\n\r\n@celery.task(name='tasks.say_hello')\r\ndef say_hello():\r\n    return \"Helloooooo i just came out from the background!\"\r\n\r\n\r\nif __name__ == '__main__':\r\n    say_hello.delay().get()\r\n```\r\n\r\n</p>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nShould remove the completed tasks, incase of that. in Redis I would have this output:\r\n```\r\n127.0.0.1:6379> KEYS *\r\n1) \"_kombu.binding.celery\"\r\n2) \"_kombu.binding.celery.pidbox\"\r\n3) \"_kombu.binding.celeryev\"\r\n```\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nWhen connecting to redis-cli after 10 minutes when tasks completed and do:\r\n```\r\n127.0.0.1:6379> KEYS *\r\n1) \"_kombu.binding.celery\"\r\n2) \"_kombu.binding.celery.pidbox\"\r\n3) \"_kombu.binding.celeryev\"\r\n4) \"celery-task-meta-854543d8-14ad-4bf8-9725-edcf64131bb2\"\r\n5) \"celery-task-meta-fa3e267e-46d0-4488-a766-d3276b6abdeb\"\r\n6) \"celery-task-meta-86c2d83c-cadd-41b9-b4ff-426607786299\"\r\n```\r\n\r\nAs you can see, tasks numbered from 4 to 6 which was completed are still there.\r\n\r\n\r\n### Celery was run as following:\r\n```\r\ncelery worker -A tasks-l info\r\ncelery beat -A tasks -l info\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6232", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6232/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6232/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6232/events", "html_url": "https://github.com/celery/celery/issues/6232", "id": 658150866, "node_id": "MDU6SXNzdWU2NTgxNTA4NjY=", "number": 6232, "title": "\"Received 0x01 while expecting 0xce\" errors when using python-amqp ", "user": {"login": "mskogorevrmc", "id": 59877547, "node_id": "MDQ6VXNlcjU5ODc3NTQ3", "avatar_url": "https://avatars0.githubusercontent.com/u/59877547?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mskogorevrmc", "html_url": "https://github.com/mskogorevrmc", "followers_url": "https://api.github.com/users/mskogorevrmc/followers", "following_url": "https://api.github.com/users/mskogorevrmc/following{/other_user}", "gists_url": "https://api.github.com/users/mskogorevrmc/gists{/gist_id}", "starred_url": "https://api.github.com/users/mskogorevrmc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mskogorevrmc/subscriptions", "organizations_url": "https://api.github.com/users/mskogorevrmc/orgs", "repos_url": "https://api.github.com/users/mskogorevrmc/repos", "events_url": "https://api.github.com/users/mskogorevrmc/events{/privacy}", "received_events_url": "https://api.github.com/users/mskogorevrmc/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-16T12:24:36Z", "updated_at": "2020-07-16T12:38:30Z", "closed_at": "2020-07-16T12:38:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "On Debian Linux with Python3.5 with these packages:\r\n\r\n```\r\ncelery                 4.4.0\r\nbilliard               3.6.3.0\r\nkombu                  4.6.11\r\namqp                   2.6.0\r\n```\r\nI use RabbitMQ as brocker.\r\nI occasionally get the following errors:\r\n```\r\n Received 0x00 while expecting 0xce\r\nTraceback (most recent call last):\r\n  File \"/var/www/my_app/app/mod_axmsg/dispatch.py\", line 376, in execute\r\n    result_value = func_meta.func(*task.args_list, **task.kwargs_dict)\r\n  File \"/var/www/my_app/app/mod_rmc/libs/health.py\", line 91, in update_all_health\r\n    health.update_all_health()\r\n  File \"/var/www/my_app/app/mod_core/libs/health.py\", line 515, in update_all_health\r\n    result.join()\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/result.py\", line 772, in join\r\n    disable_sync_subtasks=disable_sync_subtasks,\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/result.py\", line 228, in get\r\n    on_message=on_message,\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 193, in wait_for_pending\r\n    for _ in self._wait_for_pending(result, **kwargs):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 260, in _wait_for_pending\r\n    on_interval=on_interval):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 56, in drain_events_until\r\n    yield self.wait_for(p, wait, timeout=1)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 65, in wait_for\r\n    wait(timeout=timeout)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/rpc.py\", line 63, in drain_events\r\n    return self._connection.drain_events(timeout=timeout)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/kombu/connection.py\", line 323, in drain_events\r\n    return self.transport.drain_events(self.connection, **kwargs)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/kombu/transport/pyamqp.py\", line 103, in drain_events\r\n    return connection.drain_events(**kwargs)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/connection.py\", line 505, in drain_events\r\n    while not self.blocking_read(timeout):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/connection.py\", line 510, in blocking_read\r\n    frame = self.transport.read_frame()\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/transport.py\", line 280, in read_frame\r\n    'Received {0:#04x} while expecting 0xce'.format(ch))\r\namqp.exceptions.UnexpectedFrame: Received 0x00 while expecting 0xce\r\n\r\n----------------------------------\r\n----------------------------------\r\n\r\n Received 0x50 while expecting 0xce\r\nTraceback (most recent call last):\r\n  File \"/var/www/my_app/app/mod_axmsg/dispatch.py\", line 376, in execute\r\n    result_value = func_meta.func(*task.args_list, **task.kwargs_dict)\r\n  File \"/var/www/my_app/app/mod_rmc/libs/health.py\", line 91, in update_all_health\r\n    health.update_all_health()\r\n  File \"/var/www/my_app/app/mod_core/libs/health.py\", line 570, in update_all_health\r\n    result.join()\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/result.py\", line 772, in join\r\n    disable_sync_subtasks=disable_sync_subtasks,\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/result.py\", line 228, in get\r\n    on_message=on_message,\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 193, in wait_for_pending\r\n    for _ in self._wait_for_pending(result, **kwargs):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 260, in _wait_for_pending\r\n    on_interval=on_interval):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 56, in drain_events_until\r\n    yield self.wait_for(p, wait, timeout=1)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 65, in wait_for\r\n    wait(timeout=timeout)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/rpc.py\", line 63, in drain_events\r\n    return self._connection.drain_events(timeout=timeout)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/kombu/connection.py\", line 323, in drain_events\r\n    return self.transport.drain_events(self.connection, **kwargs)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/kombu/transport/pyamqp.py\", line 103, in drain_events\r\n    return connection.drain_events(**kwargs)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/connection.py\", line 505, in drain_events\r\n    while not self.blocking_read(timeout):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/connection.py\", line 510, in blocking_read\r\n    frame = self.transport.read_frame()\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/transport.py\", line 280, in read_frame\r\n    'Received {0:#04x} while expecting 0xce'.format(ch))\r\namqp.exceptions.UnexpectedFrame: Received 0x50 while expecting 0xce\r\n\r\n----------------------------------\r\n----------------------------------\r\n\r\n Received 0x39 while expecting 0xce\r\nTraceback (most recent call last):\r\n  File \"/var/www/my_app/app/mod_axmsg/dispatch.py\", line 376, in execute\r\n    result_value = func_meta.func(*task.args_list, **task.kwargs_dict)\r\n  File \"/var/www/my_app/app/mod_rmc/libs/health.py\", line 91, in update_all_health\r\n    health.update_all_health()\r\n  File \"/var/www/my_app/app/mod_core/libs/health.py\", line 570, in update_all_health\r\n    result.join()\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/result.py\", line 772, in join\r\n    disable_sync_subtasks=disable_sync_subtasks,\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/result.py\", line 228, in get\r\n    on_message=on_message,\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 193, in wait_for_pending\r\n    for _ in self._wait_for_pending(result, **kwargs):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 260, in _wait_for_pending\r\n    on_interval=on_interval):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 56, in drain_events_until\r\n    yield self.wait_for(p, wait, timeout=1)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/asynchronous.py\", line 65, in wait_for\r\n    wait(timeout=timeout)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/celery/backends/rpc.py\", line 63, in drain_events\r\n    return self._connection.drain_events(timeout=timeout)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/kombu/connection.py\", line 323, in drain_events\r\n    return self.transport.drain_events(self.connection, **kwargs)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/kombu/transport/pyamqp.py\", line 103, in drain_events\r\n    return connection.drain_events(**kwargs)\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/connection.py\", line 505, in drain_events\r\n    while not self.blocking_read(timeout):\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/connection.py\", line 510, in blocking_read\r\n    frame = self.transport.read_frame()\r\n  File \"/usr/local/my_app/lib/python3.5/site-packages/amqp/transport.py\", line 280, in read_frame\r\n    'Received {0:#04x} while expecting 0xce'.format(ch))\r\namqp.exceptions.UnexpectedFrame: Received 0x39 while expecting 0xce\r\n```\r\nThere are other tickets, but there is no activity in them: https://github.com/celery/celery/issues/1779 and https://github.com/celery/celery/issues/2066", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6227", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6227/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6227/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6227/events", "html_url": "https://github.com/celery/celery/issues/6227", "id": 656259210, "node_id": "MDU6SXNzdWU2NTYyNTkyMTA=", "number": 6227, "title": "Installing couchbase on celery's ubuntu:focal based Docker image no longer works", "user": {"login": "maybe-sybr", "id": 58414429, "node_id": "MDQ6VXNlcjU4NDE0NDI5", "avatar_url": "https://avatars3.githubusercontent.com/u/58414429?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maybe-sybr", "html_url": "https://github.com/maybe-sybr", "followers_url": "https://api.github.com/users/maybe-sybr/followers", "following_url": "https://api.github.com/users/maybe-sybr/following{/other_user}", "gists_url": "https://api.github.com/users/maybe-sybr/gists{/gist_id}", "starred_url": "https://api.github.com/users/maybe-sybr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maybe-sybr/subscriptions", "organizations_url": "https://api.github.com/users/maybe-sybr/orgs", "repos_url": "https://api.github.com/users/maybe-sybr/repos", "events_url": "https://api.github.com/users/maybe-sybr/events{/privacy}", "received_events_url": "https://api.github.com/users/maybe-sybr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235027123, "node_id": "MDU6TGFiZWwyMzUwMjcxMjM=", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Packaging%20and%20Release%20Management", "name": "Category: Packaging and Release Management", "color": "fef2c0", "default": false, "description": null}, {"id": 1871669854, "node_id": "MDU6TGFiZWwxODcxNjY5ODU0", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20Docker%20Image", "name": "Component: Docker Image", "color": "e07dba", "default": false, "description": ""}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 7, "created_at": "2020-07-14T01:39:02Z", "updated_at": "2020-07-28T05:57:48Z", "closed_at": "2020-07-28T05:54:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n```\r\n~/celery $ docker build -f docker/Dockerfile .\r\n```\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nNot applicable\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nThe docker image should build without error.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nThe image fails to build due to a dependency versioning issue with couchbase.\r\n\r\n```\r\n$ podman build -t celery -f docker/Dockerfile .\r\nSTEP 1: FROM ubuntu:focal\r\nSTEP 2: ENV PYTHONIOENCODING UTF-8\r\n--> Using cache acaba7be84835036fb85e90b837986d94871823c68921aca8b9bc6858f7eede6\r\nSTEP 3: ARG DEBIAN_FRONTEND=noninteractive\r\n--> Using cache f53b7bd5d6f45cd40239c7d083c268db8b62e826a8018a47c32d96c8e439952f\r\nSTEP 4: RUN apt-get update && apt-get install -y build-essential     libcurl4-openssl-dev     libffi-dev     tk-dev     xz-utils     curl     lsb-release     git     libmemcached-dev     make     liblzma-dev     libreadline-dev     libbz2-dev     llvm     libncurses5-dev     libsqlite3-dev     wget     pypy     python-openssl     libncursesw5-dev     zlib1g-dev     pkg-config     libssl-dev     sudo\r\n--> Using cache 3528dd3a7bde42f48e3f792b717ce95ad3bcc1d169b2d676abf20faaa2eaaacc\r\nSTEP 5: ENV PROVISIONING /provisioning\r\n--> Using cache 5cd403e630187ed510ed7aa5c1a7279b2e169e77a35a17dacaf82a49bbc8ce7c\r\nSTEP 6: ARG CELERY_USER=developer\r\n--> Using cache faa9faee390dded0bab0e78ebca4b9075b19f05a50bc055bb77f88efbd64682f\r\nSTEP 7: RUN : \"${CELERY_USER:?CELERY_USER build argument needs to be set and non-empty.}\"\r\n--> Using cache 43389d0aac47abf3b16a5af3689c5371180a6b3950841c179a2569affffed4eb\r\nSTEP 8: ENV HOME /home/$CELERY_USER\r\n--> Using cache ec0be7e288094b41313bd80d5ea9df3fbb44b99cd8a7299f5a4b21a4d7932b39\r\nSTEP 9: ENV PATH=\"$HOME/.pyenv/bin:$PATH\"\r\n--> Using cache e7239a2d2c12e00bfabaec790d0c1937690095b55c3473b80a13c3afbd9a0333\r\nSTEP 10: WORKDIR $PROVISIONING\r\n--> Using cache f0f43f30b813e023ba7a9edb2fdef8761187b529deb69f4e131d207665a8016b\r\nSTEP 11: COPY docker/scripts/install-couchbase.sh .\r\n--> Using cache 86faecc53eba42812d4ac16e7498707e855e93030de83e14230f5da13391ca4f\r\nSTEP 12: RUN sh install-couchbase.sh\r\nsudo: setrlimit(RLIMIT_CORE): Operation not permitted\r\nsudo: setrlimit(RLIMIT_CORE): Operation not permitted\r\n--2020-07-14 01:15:18--  http://packages.couchbase.com/ubuntu/couchbase.key\r\nResolving packages.couchbase.com (packages.couchbase.com)... 143.204.83.79, 143.204.83.24, 143.204.83.78, ...\r\nConnecting to packages.couchbase.com (packages.couchbase.com)|143.204.83.79|:80... connected.\r\nHTTP request sent, awaiting response... 200 OK\r\nLength: 4815 (4.7K) [application/pgp-keys]\r\nSaving to: 'STDOUT'\r\n\r\n-                                 100%[=============================================================>]   4.70K  --.-KB/s    in 0s\r\n\r\n2020-07-14 01:15:19 (57.3 MB/s) - written to stdout [4815/4815]\r\n\r\nOK\r\nsudo: setrlimit(RLIMIT_CORE): Operation not permitted\r\ndeb http://packages.couchbase.com/ubuntu bionic bionic/main\r\nGet:1 http://packages.couchbase.com/ubuntu bionic InRelease [2992 B]\r\nHit:2 http://security.ubuntu.com/ubuntu focal-security InRelease\r\nHit:3 http://archive.ubuntu.com/ubuntu focal InRelease\r\nGet:4 http://packages.couchbase.com/ubuntu bionic/bionic/main amd64 Packages [1419 B]\r\nHit:5 http://archive.ubuntu.com/ubuntu focal-updates InRelease\r\nHit:6 http://archive.ubuntu.com/ubuntu focal-backports InRelease\r\nFetched 4411 B in 2s (2570 B/s)\r\nReading package lists... Done\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nbuild-essential is already the newest version (12.8ubuntu1).\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n libcouchbase2-bin : Depends: libcouchbase2-libevent (= 2.10.6-1) but it is not going to be installed\r\n                     Depends: libevent-core-2.1-6 (>= 2.1.8-stable) but it is not installable\r\nE: Unable to correct problems, you have held broken packages.\r\nError: error building at STEP \"RUN sh install-couchbase.sh\": error while running runtime: exit status 100\r\n```\r\n\r\nThe dockerfile was originally changed to be based on focal in 8246f3a91, but it's likely that a more recent change in the Couchbase bionic package repo or the Ubuntu focal repos is what causes the breakage. Changing the docker image to be based on bionic again allows the image to build again.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6224", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6224/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6224/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6224/events", "html_url": "https://github.com/celery/celery/issues/6224", "id": 655754108, "node_id": "MDU6SXNzdWU2NTU3NTQxMDg=", "number": 6224, "title": "Run celery as daemon: ModuleNotFoundError: No module named '-n'", "user": {"login": "FPEPOSHI", "id": 11835889, "node_id": "MDQ6VXNlcjExODM1ODg5", "avatar_url": "https://avatars1.githubusercontent.com/u/11835889?v=4", "gravatar_id": "", "url": "https://api.github.com/users/FPEPOSHI", "html_url": "https://github.com/FPEPOSHI", "followers_url": "https://api.github.com/users/FPEPOSHI/followers", "following_url": "https://api.github.com/users/FPEPOSHI/following{/other_user}", "gists_url": "https://api.github.com/users/FPEPOSHI/gists{/gist_id}", "starred_url": "https://api.github.com/users/FPEPOSHI/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/FPEPOSHI/subscriptions", "organizations_url": "https://api.github.com/users/FPEPOSHI/orgs", "repos_url": "https://api.github.com/users/FPEPOSHI/repos", "events_url": "https://api.github.com/users/FPEPOSHI/events{/privacy}", "received_events_url": "https://api.github.com/users/FPEPOSHI/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 7192, "node_id": "MDU6TGFiZWw3MTky", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Invalid%20%E2%9C%98", "name": "Status: Invalid \u2718", "color": "f99695", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-07-13T10:52:33Z", "updated_at": "2020-07-27T08:13:39Z", "closed_at": "2020-07-13T12:12:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to run celery as a service in ubuntu but I'm having this error:\r\n`ModuleNotFoundError: No module named '-n'`\r\n\r\n```\r\n  File \"/usr/lib/python3.7/importlib/__init__.py\", line 127, in import_module\r\nreturn _bootstrap._gcd_import(name[level:], package, level)\r\nFile \"<frozen importlib._bootstrap>\", line 1006, in _gcd_import\r\nFile \"<frozen importlib._bootstrap>\", line 983, in _find_and_load\r\nFile \"<frozen importlib._bootstrap>\", line 965, in _find_and_load_unlocked\r\nModuleNotFoundError: No module named '-n'\r\ncelery multi v4.4.6 (cliffs)\r\n```\r\n\r\nI can't find any other issue related to this one", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6216", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6216/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6216/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6216/events", "html_url": "https://github.com/celery/celery/issues/6216", "id": 653271083, "node_id": "MDU6SXNzdWU2NTMyNzEwODM=", "number": 6216, "title": "CELERY_DB_REUSE_MAX possibly broken by #6134", "user": {"login": "thomas-riccardi", "id": 1730297, "node_id": "MDQ6VXNlcjE3MzAyOTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/1730297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thomas-riccardi", "html_url": "https://github.com/thomas-riccardi", "followers_url": "https://api.github.com/users/thomas-riccardi/followers", "following_url": "https://api.github.com/users/thomas-riccardi/following{/other_user}", "gists_url": "https://api.github.com/users/thomas-riccardi/gists{/gist_id}", "starred_url": "https://api.github.com/users/thomas-riccardi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thomas-riccardi/subscriptions", "organizations_url": "https://api.github.com/users/thomas-riccardi/orgs", "repos_url": "https://api.github.com/users/thomas-riccardi/repos", "events_url": "https://api.github.com/users/thomas-riccardi/events{/privacy}", "received_events_url": "https://api.github.com/users/thomas-riccardi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46818, "node_id": "MDU6TGFiZWw0NjgxOA==", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20Django", "name": "Component: Django", "color": "ededed", "default": false, "description": null}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 7192, "node_id": "MDU6TGFiZWw3MTky", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Invalid%20%E2%9C%98", "name": "Status: Invalid \u2718", "color": "f99695", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-08T12:50:18Z", "updated_at": "2020-07-31T13:04:50Z", "closed_at": "2020-07-27T08:59:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- https://github.com/celery/celery/pull/6134\r\n- https://github.com/celery/celery/issues/4116\r\n\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\ntoday master: 39209f2db2021eb0b685603ae4b6d0e3a5894849\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\nhttps://github.com/celery/celery/blob/39209f2db2021eb0b685603ae4b6d0e3a5894849/celery/fixups/django.py#L180\r\nHere maybe it should be `_close_database(force=True)`, following #6134: when celery db max reuse is reached we probably do want to really close everything and not ask django to maybe close them according to django settings.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6209", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6209/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6209/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6209/events", "html_url": "https://github.com/celery/celery/issues/6209", "id": 649901666, "node_id": "MDU6SXNzdWU2NDk5MDE2NjY=", "number": 6209, "title": "Have issue using celery with SQS when connection is being lost and recovered messages are not being served by celery.", "user": {"login": "aram2726", "id": 23030807, "node_id": "MDQ6VXNlcjIzMDMwODA3", "avatar_url": "https://avatars0.githubusercontent.com/u/23030807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aram2726", "html_url": "https://github.com/aram2726", "followers_url": "https://api.github.com/users/aram2726/followers", "following_url": "https://api.github.com/users/aram2726/following{/other_user}", "gists_url": "https://api.github.com/users/aram2726/gists{/gist_id}", "starred_url": "https://api.github.com/users/aram2726/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aram2726/subscriptions", "organizations_url": "https://api.github.com/users/aram2726/orgs", "repos_url": "https://api.github.com/users/aram2726/repos", "events_url": "https://api.github.com/users/aram2726/events{/privacy}", "received_events_url": "https://api.github.com/users/aram2726/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 60278485, "node_id": "MDU6TGFiZWw2MDI3ODQ4NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20Amazon%20SQS%20Broker", "name": "Component: Amazon SQS Broker", "color": "339999", "default": false, "description": null}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-02T12:43:44Z", "updated_at": "2020-07-27T12:57:06Z", "closed_at": "2020-07-02T12:52:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomple\r\n\r\nte.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have checked the \r\n[celery issues 3932](https://github.com/celery/celery/issues/3932/)\r\n[kombu issue 931](https://github.com/celery/kombu/issues/931)\r\n  for similar or identical bug reports.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- https://github.com/celery/celery/issues/3932/\r\n- https://github.com/celery/kombu/issues/931\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.2 (cliffs) kombu:4.6.11 py:3.7.6\r\n            billiard:3.6.3.0 py-amqp:2.6.0\r\nplatform -> system:Linux arch:64bit\r\n            kernel version:4.15.0-1065-aws imp:CPython\r\nloader   -> celery.loaders.default.Loader\r\nsettings -> transport:amqp results:disabled\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.7.6 imp: CPython\r\n* **Minimal Celery Version**: 4.4.2\r\n* **Minimal Kombu Version**: 4.6.11\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: GNU Linux Ubuntu x86_64 18.04 \r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\naiohttp==3.6.2\r\namqp==2.6.0\r\nargh==0.26.2\r\nasgiref==3.2.10\r\nasync-timeout==3.0.1\r\nattrs==19.3.0\r\nbilliard==3.6.3.0\r\nboto3==1.12.39\r\nbotocore==1.15.49\r\ncelery==4.4.2\r\ncertifi==2020.6.20\r\nchardet==3.0.4\r\nddtrace==0.37.0\r\nDjango==3.0.4\r\ndocutils==0.15.2\r\nfuture==0.18.2\r\ngunicorn==20.0.4\r\nidna==2.10\r\njmespath==0.10.0\r\nkombu==4.6.11\r\nmsgpack==1.0.0\r\nmultidict==4.7.6\r\npathtools==0.1.2\r\npsycopg2-binary==2.8.4\r\npython-dateutil==2.8.1\r\npython-dotenv==0.12.0\r\npytz==2020.1\r\nPyYAML==5.3.1\r\nrequests==2.23.0\r\ns3transfer==0.3.3\r\nsetproctitle==1.1.10\r\nsix==1.15.0\r\nslackclient==2.5.0\r\nsqlparse==0.3.1\r\nurllib3==1.25.9\r\nvine==1.3.0\r\nyarl==1.4.2\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\nIt depends. The issue is occurring when we will get a connection lost error.\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\n\r\n# Actual Behavior\r\n\r\nGot this in logs.\r\n```\r\n[2020-06-03 01:36:35,499: WARNING/MainProcess] consumer: Connection to broker lost. Trying to re-establish the connection...\r\nTraceback (most recent call last):\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/connection.py\", line 160, in _new_conn\r\n    (self._dns_host, self.port), self.timeout, **extra_kw\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/util/connection.py\", line 61, in create_connection\r\n    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):\r\n  File \"/opt/pyenv/versions/3.7.6/lib/python3.7/socket.py\", line 752, in getaddrinfo\r\n    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):\r\nsocket.gaierror: [Errno -3] Temporary failure in name resolution\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/httpsession.py\", line 263, in send\r\n    chunked=self._chunked(request.headers),\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/connectionpool.py\", line 725, in urlopen\r\n    method, url, error=e, _pool=self, _stacktrace=sys.exc_info()[2]\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/util/retry.py\", line 379, in increment\r\n    raise six.reraise(type(error), error, _stacktrace)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/packages/six.py\", line 735, in reraise\r\n    raise value\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/connectionpool.py\", line 677, in urlopen\r\n    chunked=chunked,\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/connectionpool.py\", line 381, in _make_request\r\n    self._validate_conn(conn)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/connectionpool.py\", line 976, in _validate_conn\r\n    conn.connect()\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/connection.py\", line 308, in connect\r\n    conn = self._new_conn()\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/urllib3/connection.py\", line 172, in _new_conn\r\n    self, \"Failed to establish a new connection: %s\" % e\r\nurllib3.exceptions.NewConnectionError: <botocore.awsrequest.AWSHTTPSConnection object at 0x7f910d7373d0>: Failed to establish a new connection: [Errno -3] Temporary failure in name resolution\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/celery/worker/consumer/consumer.py\", line 318, in start\r\n    blueprint.start(self)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/celery/bootsteps.py\", line 119, in start\r\n    step.start(parent)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/celery/worker/consumer/consumer.py\", line 599, in start\r\n    c.loop(*c.loop_args())\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/celery/worker/loops.py\", line 83, in asynloop\r\n    next(loop)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/kombu/asynchronous/hub.py\", line 301, in create_loop\r\n    item()\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/vine/promises.py\", line 170, in __call__\r\n    return self.throw()\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/vine/promises.py\", line 167, in __call__\r\n    retval = fun(*final_args, **final_kwargs)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/kombu/transport/SQS.py\", line 390, in _schedule_queue\r\n    queue, callback=promise(self._loop1, (queue,)),\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/kombu/transport/SQS.py\", line 406, in _get_bulk_async\r\n    return self._get_async(queue, maxcount, callback=callback)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/kombu/transport/SQS.py\", line 417, in _get_async\r\n    callback=transform(self._on_messages_ready, callback, q, queue),\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/kombu/transport/SQS.py\", line 442, in _get_from_sqs\r\n    queue_url = connection.get_queue_url(queue)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/kombu/asynchronous/aws/sqs/connection.py\", line 45, in get_queue_url\r\n    res = self.sqs_connection.get_queue_url(QueueName=queue)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/client.py\", line 316, in _api_call\r\n    return self._make_api_call(operation_name, kwargs)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/ddtrace/contrib/botocore/patch.py\", line 70, in patched_api_call\r\n    result = original_func(*args, **kwargs)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/client.py\", line 613, in _make_api_call\r\n    operation_model, request_dict, request_context)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/client.py\", line 632, in _make_request\r\n    return self._endpoint.make_request(operation_model, request_dict)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/endpoint.py\", line 102, in make_request\r\n    return self._send_request(request_dict, operation_model)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/endpoint.py\", line 137, in _send_request\r\n    success_response, exception):\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/endpoint.py\", line 231, in _needs_retry\r\n    caught_exception=caught_exception, request_dict=request_dict)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/hooks.py\", line 356, in emit\r\n    return self._emitter.emit(aliased_event_name, **kwargs)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/hooks.py\", line 228, in emit\r\n    return self._emit(event_name, kwargs)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/hooks.py\", line 211, in _emit\r\n    response = handler(**kwargs)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/retryhandler.py\", line 183, in __call__\r\n    if self._checker(attempts, response, caught_exception):\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/retryhandler.py\", line 251, in __call__\r\n    caught_exception)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/retryhandler.py\", line 277, in _should_retry\r\n    return self._checker(attempt_number, response, caught_exception)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/retryhandler.py\", line 317, in __call__\r\n    caught_exception)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/retryhandler.py\", line 223, in __call__\r\n    attempt_number, caught_exception)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/retryhandler.py\", line 359, in _check_caught_exception\r\n    raise caught_exception\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/endpoint.py\", line 200, in _do_get_response\r\n    http_response = self._send(request)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/endpoint.py\", line 244, in _send\r\n    return self.http_session.send(request)\r\n  File \"/home/$USER/.local/share/virtualenvs/$PROJECT_NAME-zlr2NI-5/lib/python3.7/site-packages/botocore/httpsession.py\", line 283, in send\r\n    raise EndpointConnectionError(endpoint_url=request.url, error=e)\r\nbotocore.exceptions.EndpointConnectionError: Could not connect to the endpoint URL: \"https://queue.amazonaws.com/\"\r\n[2020-06-03 01:36:47,080: ERROR/MainProcess] consumer: Cannot connect to sqs://localhost//: Could not connect to the endpoint URL: \"https://queue.amazonaws.com/\".\r\nTrying again in 2.00 seconds... (1/100)\r\n\r\n[2020-06-03 01:36:57,674: INFO/MainProcess] Connected to sqs://localhost//\r\n\r\n```\r\nAnd after the last line logs are empty because celery stops handling any message.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6203", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6203/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6203/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6203/events", "html_url": "https://github.com/celery/celery/issues/6203", "id": 648010721, "node_id": "MDU6SXNzdWU2NDgwMTA3MjE=", "number": 6203, "title": "how to catch WorkerLostError and handle it.", "user": {"login": "zx06", "id": 12474586, "node_id": "MDQ6VXNlcjEyNDc0NTg2", "avatar_url": "https://avatars1.githubusercontent.com/u/12474586?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zx06", "html_url": "https://github.com/zx06", "followers_url": "https://api.github.com/users/zx06/followers", "following_url": "https://api.github.com/users/zx06/following{/other_user}", "gists_url": "https://api.github.com/users/zx06/gists{/gist_id}", "starred_url": "https://api.github.com/users/zx06/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zx06/subscriptions", "organizations_url": "https://api.github.com/users/zx06/orgs", "repos_url": "https://api.github.com/users/zx06/repos", "events_url": "https://api.github.com/users/zx06/events{/privacy}", "received_events_url": "https://api.github.com/users/zx06/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-30T09:15:49Z", "updated_at": "2020-06-30T10:35:14Z", "closed_at": "2020-06-30T10:35:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "i want handle WorkerLostError and recored it, how to do\r\n`celery==4.4.6`", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6202", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6202/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6202/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6202/events", "html_url": "https://github.com/celery/celery/issues/6202", "id": 647962322, "node_id": "MDU6SXNzdWU2NDc5NjIzMjI=", "number": 6202, "title": "Celery task stuck", "user": {"login": "YXinAndy", "id": 47964538, "node_id": "MDQ6VXNlcjQ3OTY0NTM4", "avatar_url": "https://avatars2.githubusercontent.com/u/47964538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/YXinAndy", "html_url": "https://github.com/YXinAndy", "followers_url": "https://api.github.com/users/YXinAndy/followers", "following_url": "https://api.github.com/users/YXinAndy/following{/other_user}", "gists_url": "https://api.github.com/users/YXinAndy/gists{/gist_id}", "starred_url": "https://api.github.com/users/YXinAndy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/YXinAndy/subscriptions", "organizations_url": "https://api.github.com/users/YXinAndy/orgs", "repos_url": "https://api.github.com/users/YXinAndy/repos", "events_url": "https://api.github.com/users/YXinAndy/events{/privacy}", "received_events_url": "https://api.github.com/users/YXinAndy/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-30T08:07:51Z", "updated_at": "2020-06-30T10:42:01Z", "closed_at": "2020-06-30T10:42:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "When I use waete distributed calls, I call certain pretasks and, at the debug level, have no response and don't log anything, resulting in a backlog replacement.\r\nIs there a way to verify how and where the exception occurs? thank you\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6198", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6198/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6198/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6198/events", "html_url": "https://github.com/celery/celery/issues/6198", "id": 647486274, "node_id": "MDU6SXNzdWU2NDc0ODYyNzQ=", "number": 6198, "title": "Acl, user permission for celery tasks", "user": {"login": "jen-soft", "id": 20155856, "node_id": "MDQ6VXNlcjIwMTU1ODU2", "avatar_url": "https://avatars2.githubusercontent.com/u/20155856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jen-soft", "html_url": "https://github.com/jen-soft", "followers_url": "https://api.github.com/users/jen-soft/followers", "following_url": "https://api.github.com/users/jen-soft/following{/other_user}", "gists_url": "https://api.github.com/users/jen-soft/gists{/gist_id}", "starred_url": "https://api.github.com/users/jen-soft/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jen-soft/subscriptions", "organizations_url": "https://api.github.com/users/jen-soft/orgs", "repos_url": "https://api.github.com/users/jen-soft/repos", "events_url": "https://api.github.com/users/jen-soft/events{/privacy}", "received_events_url": "https://api.github.com/users/jen-soft/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46813, "node_id": "MDU6TGFiZWw0NjgxMw==", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Feature%20Request", "name": "Issue Type: Feature Request", "color": "0d0000", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-29T15:51:02Z", "updated_at": "2020-07-27T12:27:04Z", "closed_at": "2020-07-27T12:27:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "Acl, user permission for celery tasks\r\n\r\nHello, i am sorry i wasn't find solution for my problem.\r\nmay be some one know how it resolve.\r\n---\r\nat my website, django-users are able start celery tasks.\r\nbut i need to display for user only his own tasks. - need to create view \"my tasks\"\r\n\r\ni see two aways\r\n1) one away - use exra args for task\r\n- add to celery-task extra args like user-id \r\n- then  receive at django-view all celery-tasks\r\n- and filter tasks by user-id \r\n\r\n2) another away\r\ncreate new table user-tasks with two fields\r\nuser = forignkey to django-user model\r\ncelery-task-id = char field\r\nand after start task add new recrd to table user-tasks\r\nand at \"my tasks\" view just select tasks for user fo last 24 hours.\r\n\r\nmay be is passable use queue or add username to rout or tasks name\r\nand then filter ti.\r\n\r\n---\r\nthanks for any idea : )", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6195", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6195/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6195/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6195/events", "html_url": "https://github.com/celery/celery/issues/6195", "id": 646889874, "node_id": "MDU6SXNzdWU2NDY4ODk4NzQ=", "number": 6195, "title": "celery\u4efb\u52a1\u8c03\u7528\u65e0\u54cd\u5e94", "user": {"login": "YXinAndy", "id": 47964538, "node_id": "MDQ6VXNlcjQ3OTY0NTM4", "avatar_url": "https://avatars2.githubusercontent.com/u/47964538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/YXinAndy", "html_url": "https://github.com/YXinAndy", "followers_url": "https://api.github.com/users/YXinAndy/followers", "following_url": "https://api.github.com/users/YXinAndy/following{/other_user}", "gists_url": "https://api.github.com/users/YXinAndy/gists{/gist_id}", "starred_url": "https://api.github.com/users/YXinAndy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/YXinAndy/subscriptions", "organizations_url": "https://api.github.com/users/YXinAndy/orgs", "repos_url": "https://api.github.com/users/YXinAndy/repos", "events_url": "https://api.github.com/users/YXinAndy/events{/privacy}", "received_events_url": "https://api.github.com/users/YXinAndy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-28T10:29:43Z", "updated_at": "2020-06-28T11:51:05Z", "closed_at": "2020-06-28T11:51:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "\u6211\u5728\u4f7f\u7528celery\u5206\u5e03\u5f0f\u8c03\u7528\u65f6\uff0c\u8c03\u7528\u67d0\u4e9b\u5f02\u6b65\u4efb\u52a1\uff0c\u5728debug\u7ea7\u522b\u4e0b\uff0c\u65e0\u54cd\u5e94\uff0c\u4e5f\u65e0\u4efb\u4f55\u65e5\u5fd7\uff0c\u6700\u540e\u5bfc\u81f4\u4efb\u52a1\u79ef\u538b\u5835\u585e\u3002\r\n\u662f\u5426\u6709\u4ec0\u4e48\u65b9\u5f0f\u53ef\u4ee5\u786e\u8ba4\u5f02\u5e38\u5982\u4f55\u53d1\u751f\uff0c\u53d1\u751f\u5728\u54ea\u91cc?\u8c22\u8c22", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6194", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6194/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6194/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6194/events", "html_url": "https://github.com/celery/celery/issues/6194", "id": 646889094, "node_id": "MDU6SXNzdWU2NDY4ODkwOTQ=", "number": 6194, "title": "\u5b9a\u65f6\u4efb\u52a1\u65e0\u6cd5\u542f\u52a8", "user": {"login": "YXinAndy", "id": 47964538, "node_id": "MDQ6VXNlcjQ3OTY0NTM4", "avatar_url": "https://avatars2.githubusercontent.com/u/47964538?v=4", "gravatar_id": "", "url": "https://api.github.com/users/YXinAndy", "html_url": "https://github.com/YXinAndy", "followers_url": "https://api.github.com/users/YXinAndy/followers", "following_url": "https://api.github.com/users/YXinAndy/following{/other_user}", "gists_url": "https://api.github.com/users/YXinAndy/gists{/gist_id}", "starred_url": "https://api.github.com/users/YXinAndy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/YXinAndy/subscriptions", "organizations_url": "https://api.github.com/users/YXinAndy/orgs", "repos_url": "https://api.github.com/users/YXinAndy/repos", "events_url": "https://api.github.com/users/YXinAndy/events{/privacy}", "received_events_url": "https://api.github.com/users/YXinAndy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-28T10:24:45Z", "updated_at": "2020-06-28T11:50:10Z", "closed_at": "2020-06-28T11:50:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "Traceback (most recent call last):\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/kombu/utils/__init__.py\", line 323, in __get__\r\n    return obj.__dict__[self.__name__]\r\nKeyError: 'scheduler'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.6/shelve.py\", line 111, in __getitem__\r\n    value = self.cache[key]\r\nKeyError: 'entries'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/billiard/process.py\", line 292, in _bootstrap\r\n    self.run()\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/beat.py\", line 553, in run\r\n    self.service.start(embedded_process=True)\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/beat.py\", line 470, in start\r\n    humanize_seconds(self.scheduler.max_interval))\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/kombu/utils/__init__.py\", line 325, in __get__\r\n    value = obj.__dict__[self.__name__] = self.__get(obj)\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/beat.py\", line 512, in scheduler\r\n    return self.get_scheduler()\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/beat.py\", line 507, in get_scheduler\r\n    lazy=lazy)\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/utils/imports.py\", line 53, in instantiate\r\n    return symbol_by_name(name)(*args, **kwargs)\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/beat.py\", line 358, in __init__\r\n    Scheduler.__init__(self, *args, **kwargs)\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/beat.py\", line 185, in __init__\r\n    self.setup_schedule()\r\n  File \"/data/mobi-admin-panel/venv/lib/python3.6/site-packages/celery/beat.py\", line 388, in setup_schedule\r\n    self._store['entries']\r\n  File \"/usr/local/lib/python3.6/shelve.py\", line 114, in __getitem__\r\n    value = Unpickler(f).load()\r\nEOFError: Ran out of input\r\n\r\n\u4ee5\u4e0a\u4e3a\u9519\u8bef\u65e5\u5fd7\uff0c\u4e4b\u524d\u4e00\u76f4\u6b63\u5e38\uff0c\u4eca\u5929\u5ffd\u7136\u62a5\u8fd9\u4e2a\u9519\u8bef\uff0c\u671f\u95f4\u65e0\u66f4\u6539", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6193", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6193/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6193/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6193/events", "html_url": "https://github.com/celery/celery/issues/6193", "id": 646613358, "node_id": "MDU6SXNzdWU2NDY2MTMzNTg=", "number": 6193, "title": "Fetching time within the celery task.", "user": {"login": "waqashamid", "id": 10741793, "node_id": "MDQ6VXNlcjEwNzQxNzkz", "avatar_url": "https://avatars2.githubusercontent.com/u/10741793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/waqashamid", "html_url": "https://github.com/waqashamid", "followers_url": "https://api.github.com/users/waqashamid/followers", "following_url": "https://api.github.com/users/waqashamid/following{/other_user}", "gists_url": "https://api.github.com/users/waqashamid/gists{/gist_id}", "starred_url": "https://api.github.com/users/waqashamid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/waqashamid/subscriptions", "organizations_url": "https://api.github.com/users/waqashamid/orgs", "repos_url": "https://api.github.com/users/waqashamid/repos", "events_url": "https://api.github.com/users/waqashamid/events{/privacy}", "received_events_url": "https://api.github.com/users/waqashamid/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-27T05:31:28Z", "updated_at": "2020-06-27T05:55:56Z", "closed_at": "2020-06-27T05:55:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey guys,\r\nHope everyone here is doing really well.\r\nI have specific celery and celery beat related problem.\r\nSo, what we're trying to do is generate a report every two hours and collect data for the past 2 hours.\r\nFor ex. if a task is scheduled to run at 8am, 10am and 12pm and so on - every two hours.\r\nI need to get two values from which equals 8-2 which is 6am and and to which is 8-1=7am.\r\nUsing these times I need to collect all the data generated in the above time slot and run some reports.\r\nThe problem I am facing is that I am unable to get this time within the celery task which is 8am for example.\r\nI could do a timezone.now() inside the task to get the current time but that wouldn't be accurate since it might take some time for beat to queue that task and make it visible to the workers.\r\nSo, I basically need to figure out a way to get the time and schedule provided to celery beat at which it was expected to get triggered.\r\nWhile I understand that there are ways to get this time from my settings.py that I had provided to celery beat but in my specific use case, I cannot do a lookup there.\r\nI tried going through the documentation to figure this out but I did not find a way to get this time within every task.\r\nWhat are the possible ways to get the exact time from beat? Are there hooks in celery or maybe sys that I can leverage for my use case?\r\nThanks in advance :slightly_smiling_face:", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6192", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6192/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6192/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6192/events", "html_url": "https://github.com/celery/celery/issues/6192", "id": 646351596, "node_id": "MDU6SXNzdWU2NDYzNTE1OTY=", "number": 6192, "title": "how to improve publish rate in celery.", "user": {"login": "xcTorres", "id": 20572213, "node_id": "MDQ6VXNlcjIwNTcyMjEz", "avatar_url": "https://avatars3.githubusercontent.com/u/20572213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xcTorres", "html_url": "https://github.com/xcTorres", "followers_url": "https://api.github.com/users/xcTorres/followers", "following_url": "https://api.github.com/users/xcTorres/following{/other_user}", "gists_url": "https://api.github.com/users/xcTorres/gists{/gist_id}", "starred_url": "https://api.github.com/users/xcTorres/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xcTorres/subscriptions", "organizations_url": "https://api.github.com/users/xcTorres/orgs", "repos_url": "https://api.github.com/users/xcTorres/repos", "events_url": "https://api.github.com/users/xcTorres/events{/privacy}", "received_events_url": "https://api.github.com/users/xcTorres/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46813, "node_id": "MDU6TGFiZWw0NjgxMw==", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Feature%20Request", "name": "Issue Type: Feature Request", "color": "0d0000", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-26T15:46:01Z", "updated_at": "2020-06-27T05:51:47Z", "closed_at": "2020-06-27T05:51:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "When I test on my Mac, I sent 1000 tasks every second with only one producer, and every task is about 4KB. But the published rate is just 150/s, which is far below my expectation.  I have checked the memory usage, and there is no memory issue.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6191", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6191/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6191/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6191/events", "html_url": "https://github.com/celery/celery/issues/6191", "id": 646240288, "node_id": "MDU6SXNzdWU2NDYyNDAyODg=", "number": 6191, "title": "own importlib No module named 'xxx'", "user": {"login": "SoryegeToon", "id": 58411533, "node_id": "MDQ6VXNlcjU4NDExNTMz", "avatar_url": "https://avatars3.githubusercontent.com/u/58411533?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SoryegeToon", "html_url": "https://github.com/SoryegeToon", "followers_url": "https://api.github.com/users/SoryegeToon/followers", "following_url": "https://api.github.com/users/SoryegeToon/following{/other_user}", "gists_url": "https://api.github.com/users/SoryegeToon/gists{/gist_id}", "starred_url": "https://api.github.com/users/SoryegeToon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SoryegeToon/subscriptions", "organizations_url": "https://api.github.com/users/SoryegeToon/orgs", "repos_url": "https://api.github.com/users/SoryegeToon/repos", "events_url": "https://api.github.com/users/SoryegeToon/events{/privacy}", "received_events_url": "https://api.github.com/users/SoryegeToon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 10795, "node_id": "MDU6TGFiZWwxMDc5NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Not%20a%20Bug", "name": "Status: Not a Bug", "color": "4c9439", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-26T12:49:36Z", "updated_at": "2020-07-28T15:58:44Z", "closed_at": "2020-07-28T15:58:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "celery version: 4.4.6\r\npython version: 3.7\r\nMy project structure\r\napp\r\n\u251c\u2500\u2500 test1\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 b.py\r\n\u251c\u2500\u2500 test2\r\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 c.py\r\n\u2514\u2500\u2500 test.py\r\n\r\nWhen not in use celery:\r\n#test.py \r\nfrom test1.b import daoru\r\nprint(daoru())\r\n\r\n#test1/b.py\r\nimport celery\r\nimport time\r\nbackend='redis://127.0.0.1:6379/3'\r\nbroker='redis://127.0.0.1:6379/4'\r\napp=celery.Celery('test',backend=backend,broker=broker)\r\nimport importlib\r\n\r\n@app.task()\r\ndef daoru():\r\n    test = importlib.import_module('test2.c')\r\n    return test\r\n\r\n#test2/c.py\r\ndef add(name):\r\n    return name\r\n\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/58411533/85858069-8c779200-b7ed-11ea-8e7d-0a3f47f1c780.png)\r\nImportlib was successful\r\n\r\nbut i use celery:\r\n\r\nedit test.py\r\n#test.py \r\ndaoru.delay()\r\n\r\nstart celery\r\ncelery worker -A test1.b -l info\r\nrun test.py\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/58411533/85858394-26d7d580-b7ee-11ea-96ae-854453d626f9.png)\r\ncelery was importlib No module named 'test2'\r\n\r\ni try sys.append('./test2') sys.append('../test2')\r\nand move test2 in test1 dir \r\nBut it still doesn't work of celery\r\nI'm not very good at Python or it's my problem\uff0cthanks\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6190", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6190/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6190/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6190/events", "html_url": "https://github.com/celery/celery/issues/6190", "id": 645693318, "node_id": "MDU6SXNzdWU2NDU2OTMzMTg=", "number": 6190, "title": "Does anyone know how to set the route when using rabbitmq-sharding?", "user": {"login": "xcTorres", "id": 20572213, "node_id": "MDQ6VXNlcjIwNTcyMjEz", "avatar_url": "https://avatars3.githubusercontent.com/u/20572213?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xcTorres", "html_url": "https://github.com/xcTorres", "followers_url": "https://api.github.com/users/xcTorres/followers", "following_url": "https://api.github.com/users/xcTorres/following{/other_user}", "gists_url": "https://api.github.com/users/xcTorres/gists{/gist_id}", "starred_url": "https://api.github.com/users/xcTorres/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xcTorres/subscriptions", "organizations_url": "https://api.github.com/users/xcTorres/orgs", "repos_url": "https://api.github.com/users/xcTorres/repos", "events_url": "https://api.github.com/users/xcTorres/events{/privacy}", "received_events_url": "https://api.github.com/users/xcTorres/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-25T16:20:49Z", "updated_at": "2020-06-27T03:53:49Z", "closed_at": "2020-06-26T15:46:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6184", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6184/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6184/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6184/events", "html_url": "https://github.com/celery/celery/issues/6184", "id": 643049008, "node_id": "MDU6SXNzdWU2NDMwNDkwMDg=", "number": 6184, "title": "Module not found error with app install from git", "user": {"login": "probachaiyu", "id": 15349724, "node_id": "MDQ6VXNlcjE1MzQ5NzI0", "avatar_url": "https://avatars0.githubusercontent.com/u/15349724?v=4", "gravatar_id": "", "url": "https://api.github.com/users/probachaiyu", "html_url": "https://github.com/probachaiyu", "followers_url": "https://api.github.com/users/probachaiyu/followers", "following_url": "https://api.github.com/users/probachaiyu/following{/other_user}", "gists_url": "https://api.github.com/users/probachaiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/probachaiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/probachaiyu/subscriptions", "organizations_url": "https://api.github.com/users/probachaiyu/orgs", "repos_url": "https://api.github.com/users/probachaiyu/repos", "events_url": "https://api.github.com/users/probachaiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/probachaiyu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 10795, "node_id": "MDU6TGFiZWwxMDc5NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Not%20a%20Bug", "name": "Status: Not a Bug", "color": "4c9439", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-22T12:55:43Z", "updated_at": "2020-07-28T16:33:52Z", "closed_at": "2020-07-28T16:33:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm have a project split on 2 separate apps and both have another shared app as reusable one(i store my models there and install it from git link.\r\nSo when i run celery worker locally all is working perfect, but if i use docker(with celery in separate image) i got this error\r\n\r\n```Error: \r\ncelery_api           | Unable to load celery application.\r\ncelery_api           | The module common was not found.\r\n```\r\n\r\nIn some reason celery gets improper configuration from django.  \r\n\r\ncelery docker config\r\n```  celery_api:\r\n    image: celery_api\r\n    container_name: celery_api\r\n    restart: unless-stopped\r\n    build: .\r\n    command: celery worker -A djookyapi --loglevel=info\r\n    env_file:\r\n      - ./.dev.env\r\n    volumes:\r\n      - .:/usr/src/app\r\n    working_dir: /usr/src/app\r\n    networks:\r\n      - dev```\r\n\r\n\r\ncelery file in the root of project folder(near settings.py file)\r\n\r\n```from __future__ import absolute_import, unicode_literals\r\n\r\nimport os\r\nimport sys\r\n\r\nfrom celery import Celery\r\nfrom django.conf import settings\r\n\r\nBASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))\r\nsys.path.append(BASE_DIR)\r\n# set the default Django settings module for the 'celery' program.\r\n\r\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'myproj.settings')\r\nos.environ.setdefault('DJANGO_CONFIGURATION', 'Local')\r\n\r\nimport configurations\r\n\r\nconfigurations.setup()\r\n\r\napp = Celery('myproj', )\r\n\r\n# Using a string here means the worker doesn't have to serialize\r\n# the configuration object to child processes.\r\n# - namespace='CELERY' means all celery-related configuration keys\r\n#   should have a `CELERY_` prefix.\r\napp.config_from_object('django.conf:settings')\r\n\r\n# Load task modules from all registered Django app configs.\r\napp.autodiscover_tasks(lambda: settings.INSTALLED_APPS)\r\n\r\n\r\n@app.task(bind=True)\r\ndef debug_task(self):\r\n    print('Request: {0!r}'.format(self.request))\r\n```\r\nSo why celery doesn't see my app?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6182", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6182/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6182/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6182/events", "html_url": "https://github.com/celery/celery/issues/6182", "id": 642902106, "node_id": "MDU6SXNzdWU2NDI5MDIxMDY=", "number": 6182, "title": "celery 4.4.5 doesn't listen to `CELERY_RESULT_BACKEND` setting", "user": {"login": "kuba-lilz", "id": 30581417, "node_id": "MDQ6VXNlcjMwNTgxNDE3", "avatar_url": "https://avatars0.githubusercontent.com/u/30581417?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kuba-lilz", "html_url": "https://github.com/kuba-lilz", "followers_url": "https://api.github.com/users/kuba-lilz/followers", "following_url": "https://api.github.com/users/kuba-lilz/following{/other_user}", "gists_url": "https://api.github.com/users/kuba-lilz/gists{/gist_id}", "starred_url": "https://api.github.com/users/kuba-lilz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kuba-lilz/subscriptions", "organizations_url": "https://api.github.com/users/kuba-lilz/orgs", "repos_url": "https://api.github.com/users/kuba-lilz/repos", "events_url": "https://api.github.com/users/kuba-lilz/events{/privacy}", "received_events_url": "https://api.github.com/users/kuba-lilz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 150848, "node_id": "MDU6TGFiZWwxNTA4NDg=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Documentation", "name": "Issue Type: Documentation", "color": "ededed", "default": false, "description": null}, {"id": 10795, "node_id": "MDU6TGFiZWwxMDc5NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Not%20a%20Bug", "name": "Status: Not a Bug", "color": "4c9439", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-06-22T09:19:21Z", "updated_at": "2020-06-26T04:13:51Z", "closed_at": "2020-06-26T04:13:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [ ] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\nMinimal Python Version: python 3.5\r\nMinimal Celery Version: celery 4.3\r\nMinimal Kombu Version: N/A or Unknown\r\nMinimal Broker Version: redis 6.0.5\r\nMinimal Result Backend Version: redis 6.0.5\r\nMinimal OS and/or Kernel Version: osx 10.15.5, ubuntu 20.04\r\nMinimal Broker Client Version: redis==3.5.3\r\nMinimal Result Backend Client Version: redis==3.5.3\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nResults should be stored when `CELERY_RESULT_BACKEND` config setting is specified.\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n`CELERY_RESULT_BACKEND` is ignored. `result_backend` works as expected.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6175", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6175/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6175/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6175/events", "html_url": "https://github.com/celery/celery/issues/6175", "id": 641020386, "node_id": "MDU6SXNzdWU2NDEwMjAzODY=", "number": 6175, "title": "Task chains don't support Rabbitmq message priorities", "user": {"login": "amaurymercier", "id": 43336221, "node_id": "MDQ6VXNlcjQzMzM2MjIx", "avatar_url": "https://avatars1.githubusercontent.com/u/43336221?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amaurymercier", "html_url": "https://github.com/amaurymercier", "followers_url": "https://api.github.com/users/amaurymercier/followers", "following_url": "https://api.github.com/users/amaurymercier/following{/other_user}", "gists_url": "https://api.github.com/users/amaurymercier/gists{/gist_id}", "starred_url": "https://api.github.com/users/amaurymercier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amaurymercier/subscriptions", "organizations_url": "https://api.github.com/users/amaurymercier/orgs", "repos_url": "https://api.github.com/users/amaurymercier/repos", "events_url": "https://api.github.com/users/amaurymercier/events{/privacy}", "received_events_url": "https://api.github.com/users/amaurymercier/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-18T08:37:52Z", "updated_at": "2020-06-18T09:10:37Z", "closed_at": "2020-06-18T09:10:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.5 (cliffs) kombu:4.6.10 py:3.7.5\r\n            billiard:3.6.3.0 py-amqp:2.6.0\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:5.3.0-59-generic imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:amqp results:disabled\r\n\r\nbroker_url: 'amqp://guest:********@localhost:5672//'\r\ntask_default_queue: 'default'\r\ntask_queue_max_priority: 100\r\ntask_default_priority: 5\r\nworker_prefetch_multiplier: 1\r\ntask_acks_late: True\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.7.5\r\n* **Minimal Celery Version**: 4.4.2 or master\r\n* **Minimal Kombu Version**: 4.6.10\r\n* **Minimal Broker Version**: rabbitmq 3.8.2\r\n* **Minimal Result Backend Version**: N/A\r\n* **Minimal OS and/or Kernel Version**: Linux-5.3.0-59-generic-x86_64-with-Ubuntu-19.10-eoan 2020-06-18 10:30:24\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.6.0\r\nbilliard==3.6.3.0\r\ncelery==4.4.5\r\nfuture==0.18.2\r\nimportlib-metadata==1.6.1\r\nkombu==4.6.10\r\npika==1.1.0\r\npytz==2020.1\r\nvine==1.3.0\r\nzipp==3.1.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\napp.py :\r\n\r\n```python\r\nimport celery\r\nimport time\r\n\r\napp = celery.Celery(\"app\", broker=\"amqp://guest:guest@localhost//\")\r\napp.conf.task_default_queue = \"default\"\r\napp.conf.task_queue_max_priority = 100\r\napp.conf.task_default_priority = 5\r\napp.conf.worker_prefetch_multiplier = 1\r\napp.conf.task_acks_late = True\r\n\r\n\r\n@app.task\r\ndef dummy_low():\r\n    time.sleep(5)\r\n    print(\"dummy_low.\")\r\n\r\n\r\n@app.task\r\ndef dummy_high():\r\n    time.sleep(5)\r\n    print(\"dummy_high.\")\r\n\r\n\r\ndef main():\r\n    print(\"Creating low prio tasks...\")\r\n    for i in range(2000):\r\n        dummy_low.apply_async(priority=5)\r\n\r\n    print(\"Adding high prio task chain...\")\r\n    tasks = dummy_high.si()\r\n    for i in range(100):\r\n        tasks = tasks | dummy_high.si()\r\n\r\n    tasks.apply_async(priority=8)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nHigh priority tasks are executed before the low priority tasks.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nOnly one (the first of the chain) high priority task is executed right away. The others are not priorized and thus not executed before the end of the low-priority tasks.\r\n\r\nPlease note that this **doesn't happen with non-chained tasks or with grouped tasks.** (with non-chained tasks or grouped tasks, priorities are respected.)", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6172", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6172/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6172/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6172/events", "html_url": "https://github.com/celery/celery/issues/6172", "id": 639418169, "node_id": "MDU6SXNzdWU2Mzk0MTgxNjk=", "number": 6172, "title": "billiard.exceptions.TimeLimitExceeded: TimeLimitExceeded(300.0,)", "user": {"login": "Hamza-Lachi", "id": 53256322, "node_id": "MDQ6VXNlcjUzMjU2MzIy", "avatar_url": "https://avatars2.githubusercontent.com/u/53256322?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hamza-Lachi", "html_url": "https://github.com/Hamza-Lachi", "followers_url": "https://api.github.com/users/Hamza-Lachi/followers", "following_url": "https://api.github.com/users/Hamza-Lachi/following{/other_user}", "gists_url": "https://api.github.com/users/Hamza-Lachi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hamza-Lachi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hamza-Lachi/subscriptions", "organizations_url": "https://api.github.com/users/Hamza-Lachi/orgs", "repos_url": "https://api.github.com/users/Hamza-Lachi/repos", "events_url": "https://api.github.com/users/Hamza-Lachi/events{/privacy}", "received_events_url": "https://api.github.com/users/Hamza-Lachi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-16T06:53:54Z", "updated_at": "2020-06-16T12:33:54Z", "closed_at": "2020-06-16T12:33:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, I Had A Project That Enters Email in Database but when I try to get a result from the `result.collect()` method I get this issue \r\n\r\n```\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]: Traceback (most recent call last):\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/usr/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     self.run()\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/usr/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     self._target(*self._args, **self._kwargs)\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/validator/views.py\", line 2457, in chunk150\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     for r in ri.collect():\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/result.py\", line 289, in collect\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     yield R, R.get(**kwargs)\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/result.py\", line 228, in get\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     on_message=on_message,\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/backends/asynchronous.py\", line 202, in wait_for_pending\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     return result.maybe_throw(callback=callback, propagate=propagate)\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/result.py\", line 333, in maybe_throw\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     self.throw(value, self._to_remote_traceback(tb))\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/result.py\", line 326, in throw\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     self.on_ready.throw(*args, **kwargs)\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/vine/promises.py\", line 244, in throw\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     reraise(type(exc), exc, tb)\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/vine/five.py\", line 195, in reraise\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]:     raise value\r\nJun 16 02:44:47 hamza2.pawnhost.com gunicorn[740]: billiard.exceptions.TimeLimitExceeded: TimeLimitExceeded(300.0,)\r\n\r\n```\r\n\r\nHere is my `views.py`\r\n```\r\n\r\n@task(name=\"dbentry\")\r\ndef entrydb(mails,status,csvid,userid):\r\n    csv = MailCSV.objects.filter(id=csvid).first()\r\n    user = User.objects.filter(id=userid).first()\r\n    for mail in mails:\r\n        mailsave = Mail.objects.create(csv=csv,user=user,mail=mail,provider=emailtype(mail),status=status,)\r\n        mailsave.save()\r\n    \r\n    return 'Done'\r\n\r\n\r\nri = entrydb.delay(invalid,'InValid',csvid,userid,)\r\nfor r in ri.collect():\r\n    ri = r\r\n```\r\n\r\nI'm using Django, celery, MySQL\r\n\r\nif you need more details please let me know\r\n\r\nI'm using celery as a daemon\r\n\r\ni notice when invalid emails are too much then i get this issue", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6171", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6171/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6171/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6171/events", "html_url": "https://github.com/celery/celery/issues/6171", "id": 639387269, "node_id": "MDU6SXNzdWU2MzkzODcyNjk=", "number": 6171, "title": "Issue with the order of task processing", "user": {"login": "rohanjaswal2507", "id": 7920333, "node_id": "MDQ6VXNlcjc5MjAzMzM=", "avatar_url": "https://avatars3.githubusercontent.com/u/7920333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohanjaswal2507", "html_url": "https://github.com/rohanjaswal2507", "followers_url": "https://api.github.com/users/rohanjaswal2507/followers", "following_url": "https://api.github.com/users/rohanjaswal2507/following{/other_user}", "gists_url": "https://api.github.com/users/rohanjaswal2507/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohanjaswal2507/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohanjaswal2507/subscriptions", "organizations_url": "https://api.github.com/users/rohanjaswal2507/orgs", "repos_url": "https://api.github.com/users/rohanjaswal2507/repos", "events_url": "https://api.github.com/users/rohanjaswal2507/events{/privacy}", "received_events_url": "https://api.github.com/users/rohanjaswal2507/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-16T05:44:44Z", "updated_at": "2020-06-16T06:29:25Z", "closed_at": "2020-06-16T06:09:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [x] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.2.1 (windowlicker)\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.2.1 (windowlicker) kombu:4.6.3 py:3.6.6\r\n            billiard:3.5.0.5 redis:3.3.11\r\nplatform -> system:Darwin arch:64bit imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:redis results:redis://localhost:6379/9\r\n\r\nABSOLUTE_URL_OVERRIDES: {\r\n }\r\nADMINS: []\r\nALLOWED_EXTENSIONS: {'jpg', 'jpeg', 'pdf', 'png'}\r\nALLOWED_HOSTS: ['*']\r\nAPPEND_SLASH: True\r\nAUTHENTICATION_BACKENDS: ['django.contrib.auth.backends.ModelBackend']\r\nAUTH_PASSWORD_VALIDATORS: '********'\r\nAUTH_USER_MODEL: 'auth.User'\r\nBASE_DIR: '/Users/rohanjaswal/PycharmProjects/policies'\r\nCACHES: {\r\n 'default': {'BACKEND': 'django.core.cache.backends.locmem.LocMemCache'}}\r\nCACHE_MIDDLEWARE_ALIAS: 'default'\r\nCACHE_MIDDLEWARE_KEY_PREFIX: '********'\r\nCACHE_MIDDLEWARE_SECONDS: 600\r\nCELERY_BROKER_URL: 'redis://localhost:6379/10'\r\nCELERY_MAX_TASKS_PER_CHILD: 10\r\nCELERY_RESULT_BACKEND: 'redis://localhost:6379/9'\r\nCELERY_TASK_DEFAULT_QUEUE: 'policies_panel_queue'\r\nCORS_ALLOW_CREDENTIALS: True\r\nCORS_ORIGIN_WHITELIST: ['localhost',\r\n 'localhost.pasarpolis.com',\r\n 'alpha.pasarpolis.com',\r\n 'pasarpolis.com']\r\nCSRF_COOKIE_AGE: 31449600\r\nCSRF_COOKIE_DOMAIN: None\r\nCSRF_COOKIE_HTTPONLY: False\r\nCSRF_COOKIE_NAME: 'csrftoken'\r\nCSRF_COOKIE_PATH: '/'\r\nCSRF_COOKIE_SECURE: False\r\nCSRF_FAILURE_VIEW: 'django.views.csrf.csrf_failure'\r\nCSRF_HEADER_NAME: 'HTTP_X_CSRFTOKEN'\r\nCSRF_TRUSTED_ORIGINS: []\r\nCSRF_USE_SESSIONS: False\r\nDATABASES: {\r\n    'default': {   'ATOMIC_REQUESTS': False,\r\n                   'AUTOCOMMIT': True,\r\n                   'CONN_MAX_AGE': 3600,\r\n                   'ENGINE': 'mysql.connector.django',\r\n                   'HOST': 'localhost',\r\n                   'NAME': 'pp_policies',\r\n                   'OPTIONS': {'use_pure': True},\r\n                   'PASSWORD': '********',\r\n                   'PORT': '',\r\n                   'TEST': {   'CHARSET': None,\r\n                               'COLLATION': None,\r\n                               'MIRROR': None,\r\n                               'NAME': None},\r\n                   'TIME_ZONE': None,\r\n                   'USER': 'rohan'}}\r\nDATABASE_ROUTERS: '********'\r\nDATA_UPLOAD_MAX_MEMORY_SIZE: 10485760\r\nDATA_UPLOAD_MAX_NUMBER_FIELDS: 1000\r\nDATETIME_FORMAT: 'N j, Y, P'\r\nDATETIME_INPUT_FORMATS: ['%Y-%m-%d %H:%M:%S',\r\n '%Y-%m-%d %H:%M:%S.%f',\r\n '%Y-%m-%d %H:%M',\r\n '%Y-%m-%d',\r\n '%m/%d/%Y %H:%M:%S',\r\n '%m/%d/%Y %H:%M:%S.%f',\r\n '%m/%d/%Y %H:%M',\r\n '%m/%d/%Y',\r\n '%m/%d/%y %H:%M:%S',\r\n '%m/%d/%y %H:%M:%S.%f',\r\n '%m/%d/%y %H:%M',\r\n '%m/%d/%y']\r\nDATE_FORMAT: 'N j, Y'\r\nDATE_INPUT_FORMATS: ['%Y-%m-%d',\r\n '%m/%d/%Y',\r\n '%m/%d/%y',\r\n '%b %d %Y',\r\n '%b %d, %Y',\r\n '%d %b %Y',\r\n '%d %b, %Y',\r\n '%B %d %Y',\r\n '%B %d, %Y',\r\n '%d %B %Y',\r\n '%d %B, %Y']\r\nDEBUG: True\r\nDEBUG_PROPAGATE_EXCEPTIONS: False\r\nDECIMAL_SEPARATOR: '.'\r\nDEFAULT_CHARSET: 'utf-8'\r\nDEFAULT_CONTENT_TYPE: 'text/html'\r\nDEFAULT_EXCEPTION_REPORTER_FILTER: 'django.views.debug.SafeExceptionReporterFilter'\r\nDEFAULT_FILE_STORAGE: 'django.core.files.storage.FileSystemStorage'\r\nDEFAULT_FROM_EMAIL: 'webmaster@localhost'\r\nDEFAULT_INDEX_TABLESPACE: ''\r\nDEFAULT_TABLESPACE: ''\r\nDISALLOWED_USER_AGENTS: []\r\nEMAIL_BACKEND: 'django.core.mail.backends.smtp.EmailBackend'\r\nEMAIL_HOST: 'localhost'\r\nEMAIL_HOST_PASSWORD: '********'\r\nEMAIL_HOST_USER: ''\r\nEMAIL_PORT: 25\r\nEMAIL_SSL_CERTFILE: None\r\nEMAIL_SSL_KEYFILE: '********'\r\nEMAIL_SUBJECT_PREFIX: '[Django] '\r\nEMAIL_TIMEOUT: None\r\nEMAIL_USE_LOCALTIME: False\r\nEMAIL_USE_SSL: False\r\nEMAIL_USE_TLS: False\r\nENVIRONMENT: 'LOCAL'\r\nFILE_CHARSET: 'utf-8'\r\nFILE_UPLOAD_DIRECTORY_PERMISSIONS: None\r\nFILE_UPLOAD_HANDLERS: ['django.core.files.uploadhandler.MemoryFileUploadHandler',\r\n 'django.core.files.uploadhandler.TemporaryFileUploadHandler']\r\nFILE_UPLOAD_MAX_MEMORY_SIZE: 2621440\r\nFILE_UPLOAD_PERMISSIONS: None\r\nFILE_UPLOAD_TEMP_DIR: None\r\nFIRST_DAY_OF_WEEK: 0\r\nFIXTURE_DIRS: []\r\nFORCE_SCRIPT_NAME: None\r\nFORMAT_MODULE_PATH: None\r\nFORM_RENDERER: 'django.forms.renderers.DjangoTemplates'\r\nIGNORABLE_404_URLS: []\r\n 'django.contrib.auth',\r\n 'django.contrib.contenttypes',\r\n 'django.contrib.sessions',\r\n 'django.contrib.messages',\r\n 'django.contrib.staticfiles',\r\n 'rest_framework',\r\n 'core',\r\n 'api',\r\n 'corsheaders',\r\n 'raven.contrib.django.raven_compat',\r\n 'django_celery_beat']\r\nINTERNAL_IPS: []\r\n\r\nLANGUAGES: [('af', 'Afrikaans'),\r\n ('ar', 'Arabic'),\r\n ('ast', 'Asturian'),\r\n ('az', 'Azerbaijani'),\r\n ('bg', 'Bulgarian'),\r\n ('be', 'Belarusian'),\r\n ('bn', 'Bengali'),\r\n ('br', 'Breton'),\r\n ('bs', 'Bosnian'),\r\n ('ca', 'Catalan'),\r\n ('cs', 'Czech'),\r\n ('cy', 'Welsh'),\r\n ('da', 'Danish'),\r\n ('de', 'German'),\r\n ('dsb', 'Lower Sorbian'),\r\n ('el', 'Greek'),\r\n ('en', 'English'),\r\n ('en-au', 'Australian English'),\r\n ('en-gb', 'British English'),\r\n ('eo', 'Esperanto'),\r\n ('es', 'Spanish'),\r\n ('es-ar', 'Argentinian Spanish'),\r\n ('es-co', 'Colombian Spanish'),\r\n ('es-mx', 'Mexican Spanish'),\r\n ('es-ni', 'Nicaraguan Spanish'),\r\n ('es-ve', 'Venezuelan Spanish'),\r\n ('et', 'Estonian'),\r\n ('eu', 'Basque'),\r\n ('fa', 'Persian'),\r\n ('fi', 'Finnish'),\r\n ('fr', 'French'),\r\n ('fy', 'Frisian'),\r\n ('ga', 'Irish'),\r\n ('gd', 'Scottish Gaelic'),\r\n ('gl', 'Galician'),\r\n ('he', 'Hebrew'),\r\n ('hi', 'Hindi'),\r\n ('hr', 'Croatian'),\r\n ('hsb', 'Upper Sorbian'),\r\n ('hu', 'Hungarian'),\r\n ('ia', 'Interlingua'),\r\n ('id', 'Indonesian'),\r\n ('io', 'Ido'),\r\n ('is', 'Icelandic'),\r\n ('it', 'Italian'),\r\n ('ja', 'Japanese'),\r\n ('ka', 'Georgian'),\r\n ('kab', 'Kabyle'),\r\n ('kk', 'Kazakh'),\r\n ('km', 'Khmer'),\r\n ('kn', 'Kannada'),\r\n ('ko', 'Korean'),\r\n ('lb', 'Luxembourgish'),\r\n ('lt', 'Lithuanian'),\r\n ('lv', 'Latvian'),\r\n ('mk', 'Macedonian'),\r\n ('ml', 'Malayalam'),\r\n ('mn', 'Mongolian'),\r\n ('mr', 'Marathi'),\r\n ('my', 'Burmese'),\r\n ('nb', 'Norwegian Bokm\u00e5l'),\r\n ('ne', 'Nepali'),\r\n ('nl', 'Dutch'),\r\n ('nn', 'Norwegian Nynorsk'),\r\n ('os', 'Ossetic'),\r\n ('pa', 'Punjabi'),\r\n ('pl', 'Polish'),\r\n ('pt', 'Portuguese'),\r\n ('pt-br', 'Brazilian Portuguese'),\r\n ('ro', 'Romanian'),\r\n ('ru', 'Russian'),\r\n ('sk', 'Slovak'),\r\n ('sl', 'Slovenian'),\r\n ('sq', 'Albanian'),\r\n ('sr', 'Serbian'),\r\n ('sr-latn', 'Serbian Latin'),\r\n ('sv', 'Swedish'),\r\n ('sw', 'Swahili'),\r\n ('ta', 'Tamil'),\r\n ('te', 'Telugu'),\r\n ('th', 'Thai'),\r\n ('tr', 'Turkish'),\r\n ('tt', 'Tatar'),\r\n ('udm', 'Udmurt'),\r\n ('uk', 'Ukrainian'),\r\n ('ur', 'Urdu'),\r\n ('vi', 'Vietnamese'),\r\n ('zh-hans', 'Simplified Chinese'),\r\n ('zh-hant', 'Traditional Chinese')]\r\nLANGUAGES_BIDI: ['he', 'ar', 'fa', 'ur']\r\nLANGUAGE_CODE: 'en-us'\r\nLANGUAGE_COOKIE_AGE: None\r\nLANGUAGE_COOKIE_DOMAIN: None\r\nLANGUAGE_COOKIE_NAME: 'django_language'\r\nLANGUAGE_COOKIE_PATH: '/'\r\nLOCALE_PATHS: []\r\nLOGGING: {\r\n    'disable_existing_loggers': False,\r\n    'formatters': {   'standard': {   'format': '%(asctime)s [%(levelname)s] '\r\n                                                '%(name)s: %(message)s'}},\r\n    'handlers': {   'default': {   'class': 'logging.StreamHandler',\r\n                                   'formatter': 'standard',\r\n                                   'level': 'DEBUG'}},\r\n    'loggers': {   '': {   'handlers': ['default'],\r\n                           'level': 'DEBUG',\r\n                           'propagate': True},\r\n                   'django.request': {   'handlers': ['default'],\r\n                                         'level': 'DEBUG',\r\n                                         'propagate': False}},\r\n    'version': 1}\r\nLOGGING_CONFIG: 'logging.config.dictConfig'\r\nLOGGING_FOLDER: '/Users/rohanjaswal/PycharmProjects/policies/logs'\r\nLOGIN_REDIRECT_URL: '/accounts/profile/'\r\nLOGIN_URL: '/accounts/login/'\r\nLOGOUT_REDIRECT_URL: None\r\nLOG_NAME: 'POLICIES_LOG'\r\nMANAGERS: []\r\nMEDIA_ROOT: ''\r\nMEDIA_URL: ''\r\nMESSAGE_STORAGE: 'django.contrib.messages.storage.fallback.FallbackStorage'\r\nMIDDLEWARE: ['raven.contrib.django.middleware.DjangoRestFrameworkCompatMiddleware',\r\n 'raven.contrib.django.middleware.SentryMiddleware',\r\n 'django.middleware.security.SecurityMiddleware',\r\n 'django.contrib.sessions.middleware.SessionMiddleware',\r\n 'corsheaders.middleware.CorsMiddleware',\r\n 'django.middleware.common.CommonMiddleware',\r\n 'django.middleware.csrf.CsrfViewMiddleware',\r\n 'django.contrib.auth.middleware.AuthenticationMiddleware',\r\n 'django.contrib.messages.middleware.MessageMiddleware',\r\n 'django.middleware.clickjacking.XFrameOptionsMiddleware',\r\n 'middleware.request_logging_middleware.RequestLoggingMiddleware']\r\nMIGRATION_MODULES: {\r\n }\r\nMONTH_DAY_FORMAT: 'F j'\r\nNUMBER_GROUPING: 0\r\nPASSWORD_HASHERS: '********'\r\nPASSWORD_RESET_TIMEOUT_DAYS: '********'\r\nPREPEND_WWW: False\r\nPROJECT_ID: 'testing-200706'\r\nRAVEN_CONFIG: {\r\n    'dsn': '',\r\n    'environment': 'local',\r\n    'release': 'e01c8bd3d57c16718c21792ac0c11de47b72776a'}\r\nREDIS: {\r\n 'HOST': 'localhost', 'PASSWORD': '********', 'PORT': '6379'}\r\nREDIS_ACTIVATION_QR_CODE_DICT: 'activation_qr_codes'\r\nREDIS_SCREEN_CACHE: 'screen_content'\r\nREST_FRAMEWORK: {\r\n    'DEFAULT_AUTHENTICATION_CLASSES': (   'api.authentication.PPJWTAuthentication',),\r\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',\r\n    'DEFAULT_PERMISSION_CLASSES': (   'rest_framework.permissions.IsAuthenticated',),\r\n    'PAGE_SIZE': 100}\r\nROOT_URLCONF: 'policies.urls'\r\nSECRET_KEY: '********'\r\nSECURE_BROWSER_XSS_FILTER: False\r\nSECURE_CONTENT_TYPE_NOSNIFF: False\r\nSECURE_HSTS_INCLUDE_SUBDOMAINS: False\r\nSECURE_HSTS_PRELOAD: False\r\nSECURE_HSTS_SECONDS: 0\r\nSECURE_PROXY_SSL_HEADER: None\r\nSECURE_REDIRECT_EXEMPT: []\r\nSECURE_SSL_HOST: None\r\nSECURE_SSL_REDIRECT: False\r\nSERVER_EMAIL: 'root@localhost'\r\nSERVICE_NAME: 'policies_panel'\r\nSESSION_CACHE_ALIAS: 'default'\r\nSESSION_COOKIE_AGE: 1209600\r\nSESSION_COOKIE_DOMAIN: None\r\nSESSION_COOKIE_HTTPONLY: True\r\nSESSION_COOKIE_NAME: 'sessionid'\r\nSESSION_COOKIE_PATH: '/'\r\nSESSION_COOKIE_SECURE: False\r\nSESSION_ENGINE: 'django.contrib.sessions.backends.db'\r\nSESSION_EXPIRE_AT_BROWSER_CLOSE: False\r\nSESSION_FILE_PATH: None\r\nSESSION_SAVE_EVERY_REQUEST: False\r\nSESSION_SERIALIZER: 'django.contrib.sessions.serializers.JSONSerializer'\r\nSETTINGS_MODULE: 'policies.settings.defaults'\r\nSHORT_DATETIME_FORMAT: 'm/d/Y P'\r\nSHORT_DATE_FORMAT: 'm/d/Y'\r\nSIGNING_BACKEND: 'django.core.signing.TimestampSigner'\r\nSILENCED_SYSTEM_CHECKS: []\r\nSTATICFILES_DIRS: \r\n    ('/Users/rohanjaswal/PycharmProjects/policies/frontend/build/static',\r\n '/Users/rohanjaswal/PycharmProjects/policies/frontend/media')\r\nSTATICFILES_FINDERS: ['django.contrib.staticfiles.finders.FileSystemFinder',\r\n 'django.contrib.staticfiles.finders.AppDirectoriesFinder']\r\nSTATICFILES_STORAGE: 'django.contrib.staticfiles.storage.StaticFilesStorage'\r\nSTATIC_ROOT: '/Users/rohanjaswal/PycharmProjects/policies/static'\r\nSTATIC_URL: '/static/'\r\nTEMPLATES: [{'APP_DIRS': True,\r\n  'BACKEND': 'django.template.backends.django.DjangoTemplates',\r\n  'DIRS': ['/Users/rohanjaswal/PycharmProjects/policies/frontend/build'],\r\n  'OPTIONS': {'context_processors': ['django.template.context_processors.debug',\r\n                                     'django.template.context_processors.request',\r\n                                     'django.contrib.auth.context_processors.auth',\r\n                                     'django.contrib.messages.context_processors.messages']}}]\r\nTEST_NON_SERIALIZED_APPS: []\r\nTEST_RUNNER: 'django.test.runner.DiscoverRunner'\r\nTHOUSAND_SEPARATOR: ','\r\nTIME_FORMAT: 'P'\r\nTIME_INPUT_FORMATS: ['%H:%M:%S', '%H:%M:%S.%f', '%H:%M']\r\nTIME_ZONE: 'UTC'\r\nUSER_INFO_AUDIT_TOPIC: 'audit-events'\r\nUSER_SERVICE_URL: 'http://userservice'\r\nUSER_TIME_ZONE: 'Asia/Jakarta'\r\nUSE_ETAGS: False\r\nUSE_I18N: True\r\nUSE_L10N: True\r\nUSE_THOUSAND_SEPARATOR: False\r\nUSE_TZ: True\r\nUSE_X_FORWARDED_HOST: False\r\nUSE_X_FORWARDED_PORT: False\r\nWSGI_APPLICATION: 'policies.wsgi.application'\r\nX_FRAME_OPTIONS: 'SAMEORIGIN'\r\nYEAR_MONTH_FORMAT: 'F Y'\r\nis_overridden: <bound method Settings.is_overridden of <Settings \"policies.settings.defaults\">>\r\nBROKER_URL: 'redis://localhost:6379/10'\r\nCELERY_DEFAULT_QUEUE: 'my_default_queue'\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.6.6\r\n* **Minimal Celery Version**: 4.2.1\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.5.2\r\nastroid==2.4.1\r\nattrs==19.3.0\r\nbilliard==3.5.0.5\r\ncachetools==4.0.0\r\ncelery==4.2.1\r\ncertifi==2019.11.28\r\nchardet==3.0.4\r\ncoverage==5.0.3\r\nDeprecated==1.2.9\r\nDjango==2.0.5\r\ndjango-celery-beat==1.1.1\r\ndjango-cors-headers==2.3.0\r\ndjango-relativedelta==1.1.1\r\ndjangorestframework==3.8.2\r\ndjangorestframework-jwt==1.11.0\r\ngoogle-api-core==1.16.0\r\ngoogle-auth==1.11.2\r\ngoogle-cloud-core==0.28.1\r\ngoogle-cloud-logging==1.6.0\r\ngoogle-cloud-pubsub==0.41.0\r\ngoogle-cloud-storage==1.11.0\r\ngoogle-resumable-media==0.5.0\r\ngoogleapis-common-protos==1.51.0\r\ngrpc-google-iam-v1==0.11.4\r\ngrpcio==1.9.1\r\ngunicorn==19.9.0\r\nidna==2.8\r\nimportlib-metadata==1.5.0\r\nisort==4.3.21\r\nkombu==4.6.3\r\nlazy-object-proxy==1.4.3\r\nmccabe==0.6.1\r\nmore-itertools==8.2.0\r\nmysql-connector-python==8.0.11\r\nnewrelic==5.4.1.134\r\npackaging==20.1\r\npluggy==0.13.1\r\nprotobuf==3.11.3\r\npy==1.8.1\r\npyasn1==0.4.8\r\npyasn1-modules==0.2.8\r\nPyJWT==1.7.1\r\npylint==2.5.2\r\npyparsing==2.4.6\r\npytest==5.3.5\r\npytest-cov==2.8.1\r\npytest-django==3.8.0\r\npython-dateutil==2.8.1\r\npytz==2019.3\r\nraven==6.9.0\r\nredis==3.3.11\r\nrequests==2.22.0\r\nrequests-file==1.4.3\r\nrequests-mock==1.7.0\r\nrsa==4.0\r\nsix==1.14.0\r\nslackclient==1.3.0\r\nsqlparse==0.3.1\r\ntldextract==2.2.2\r\ntoml==0.10.0\r\ntyped-ast==1.4.1\r\nurllib3==1.25.8\r\nuWSGI==2.0.17\r\nvine==1.3.0\r\nwcwidth==0.1.8\r\nwebsocket-client==0.57.0\r\nwrapt==1.12.1\r\nzipp==3.0.0\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nIn our system, we have a Pub-Sub subscriber client running which listens to messages and upon receiving a message, it triggers a celery task T(m) by passing the content of the message as an argument to the task.\r\nSince, the subscriber client is single threaded, it means that tasks for messages will invoked in the order of messages received. For example, if I received m1, m2, m3, then my code will call T.delay(m1), T.delay(m2) and T.delay(m3) in the same order.\r\n\r\nMy celery worker is running with concurrency=2. So, let's name the 2 pool workers as p1 and p2\r\n\r\nSo, if I received 5 messages, let's say m1, m2, m3, m4, m5, the order of the receiving task as well as processing task should have been:\r\np2 - m1\r\np1 - m2\r\np2 - m3\r\np1 - m4\r\np2 - m5\r\n\r\n\r\n# Actual Behavior\r\n\r\nWhat happened with me was, when I received 5 messages, let's say m1, m2, m3, m4, m5, they were processed in the order.\r\np2 - m5\r\np1 - m1\r\np2 - m3\r\np1 - m2\r\np2 - m4\r\n\r\nIs there any celery configuration which could be triggering this behavior? And what can I do to avoid this. The order of these messages is important to our system.\r\n\r\n<!--\r\nDescribe in detail what actually happened.\r\n\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6167", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6167/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6167/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6167/events", "html_url": "https://github.com/celery/celery/issues/6167", "id": 638311486, "node_id": "MDU6SXNzdWU2MzgzMTE0ODY=", "number": 6167, "title": "File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/backends/asynchronous.py\", line 64, in wait_for", "user": {"login": "Hamza-Lachi", "id": 53256322, "node_id": "MDQ6VXNlcjUzMjU2MzIy", "avatar_url": "https://avatars2.githubusercontent.com/u/53256322?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Hamza-Lachi", "html_url": "https://github.com/Hamza-Lachi", "followers_url": "https://api.github.com/users/Hamza-Lachi/followers", "following_url": "https://api.github.com/users/Hamza-Lachi/following{/other_user}", "gists_url": "https://api.github.com/users/Hamza-Lachi/gists{/gist_id}", "starred_url": "https://api.github.com/users/Hamza-Lachi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Hamza-Lachi/subscriptions", "organizations_url": "https://api.github.com/users/Hamza-Lachi/orgs", "repos_url": "https://api.github.com/users/Hamza-Lachi/repos", "events_url": "https://api.github.com/users/Hamza-Lachi/events{/privacy}", "received_events_url": "https://api.github.com/users/Hamza-Lachi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-14T08:51:34Z", "updated_at": "2020-06-14T14:16:21Z", "closed_at": "2020-06-14T14:16:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm Using celery in my Django project\r\n\r\nbut I get these issues when I deploy\r\n\r\n```\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]: Traceback (most recent call last):\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/usr/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     self.run()\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/usr/lib/python3.7/multiprocessing/process.py\", line 99, in run\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     self._target(*self._args, **self._kwargs)\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/home/emailv-completed/validator/views.py\", line 1372, in ch\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     for r in res1.collect():\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/result.py\", line 289, in collect\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     yield R, R.get(**kwargs)\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/result.py\", line 228, in get\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     on_message=on_message,\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/backends/asynchronous.py\", line 200, in wait_for_pending\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     for _ in self._wait_for_pending(result, **kwargs):\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/backends/asynchronous.py\", line 268, in _wait_for_pending\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     on_interval=on_interval):\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/backends/asynchronous.py\", line 55, in drain_events_until\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:     yield self.wait_for(p, wait, timeout=interval)\r\nJun 14 04:17:01 hamza2.pawnhost.com gunicorn[24450]:   File \"/home/emailv-completed/env/lib/python3.7/site-packages/celery/backends/asynchronous.py\", line 64, in wait_for\r\n\r\n```\r\n\r\nI don't know why it's showing in gunicorn but it's celery issue\r\n\r\nVersion: celery==4.4.2,redis==3.2.1\r\n\r\nOs: Ubuntu 16.0.4\r\n\r\nPython Version: 3.7\r\n\r\nI'm running celery as a daemon", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6159", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6159/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6159/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6159/events", "html_url": "https://github.com/celery/celery/issues/6159", "id": 631625550, "node_id": "MDU6SXNzdWU2MzE2MjU1NTA=", "number": 6159, "title": "Celery 4.4.4 raises => ModuleNotFoundError: No module named 'future'", "user": {"login": "pjulian", "id": 32444116, "node_id": "MDQ6VXNlcjMyNDQ0MTE2", "avatar_url": "https://avatars0.githubusercontent.com/u/32444116?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pjulian", "html_url": "https://github.com/pjulian", "followers_url": "https://api.github.com/users/pjulian/followers", "following_url": "https://api.github.com/users/pjulian/following{/other_user}", "gists_url": "https://api.github.com/users/pjulian/gists{/gist_id}", "starred_url": "https://api.github.com/users/pjulian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pjulian/subscriptions", "organizations_url": "https://api.github.com/users/pjulian/orgs", "repos_url": "https://api.github.com/users/pjulian/repos", "events_url": "https://api.github.com/users/pjulian/events{/privacy}", "received_events_url": "https://api.github.com/users/pjulian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-05T14:14:16Z", "updated_at": "2020-06-05T14:24:22Z", "closed_at": "2020-06-05T14:24:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "This doesn't happen on 4.4.3, only on 4.4.4.\r\n\r\nHere is a traceback:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/kombu/utils/objects.py\", line 42, in __get__\r\n    return obj.__dict__[self.__name__]\r\nKeyError: 'backend'\r\nDuring handling of the above exception, another exception occurred:\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 2, in <module>\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/task.py\", line 569, in apply_async\r\n    **options\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/base.py\", line 779, in send_task\r\n    self.backend.on_task_call(P, task_id)\r\n  File \"/usr/local/lib/python3.7/site-packages/kombu/utils/objects.py\", line 44, in __get__\r\n    value = obj.__dict__[self.__name__] = self.__get(obj)\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/base.py\", line 1232, in backend\r\n    return self._get_backend()\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/base.py\", line 949, in _get_backend\r\n    self.loader)\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/backends.py\", line 74, in by_url\r\n    return by_name(backend, loader), url\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/backends.py\", line 54, in by_name\r\n    cls = symbol_by_name(backend, aliases)\r\n  File \"/usr/local/lib/python3.7/site-packages/kombu/utils/imports.py\", line 57, in symbol_by_name\r\n    module = imp(module_name, package=package, **kwargs)\r\n  File \"/usr/local/lib/python3.7/importlib/__init__.py\", line 127, in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n  File \"<frozen importlib._bootstrap>\", line 1006, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 983, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 967, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 677, in _load_unlocked\r\n  File \"<frozen importlib._bootstrap_external>\", line 728, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/backends/base.py\", line 10, in <module>\r\n    from future.utils import raise_with_traceback\r\nModuleNotFoundError: No module named 'future'\r\n```\r\n\r\nI'm running Python 3.7.4 on Debian v9.\r\n```\r\nroot@6b09806573e5:/app# cat /etc/*release*\r\nPRETTY_NAME=\"Debian GNU/Linux 9 (stretch)\"\r\nNAME=\"Debian GNU/Linux\"\r\nVERSION_ID=\"9\"\r\nVERSION=\"9 (stretch)\"\r\nVERSION_CODENAME=stretch\r\nID=debian\r\nHOME_URL=\"https://www.debian.org/\"\r\nSUPPORT_URL=\"https://www.debian.org/support\"\r\nBUG_REPORT_URL=\"https://bugs.debian.org/\"\r\n\r\nroot@6b09806573e5:/app# python --version\r\nPython 3.7.4\r\n\r\n```\r\n\r\n<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nroot@6b09806573e5:/app# pip freeze\r\namqp==2.6.0\r\nbcrypt==3.1.7\r\nbeautifulsoup4==4.7.1\r\nbilliard==3.6.3.0\r\nbleach==3.1.0\r\nblinker==1.4\r\ncelery==4.4.4\r\ncertifi==2020.4.5.1\r\ncffi==1.14.0\r\nchardet==3.0.4\r\nClick==7.0\r\ncryptography==2.9.2\r\nCvLib==3.3.7\r\ndecorator==4.4.2\r\ndocker==4.1.0\r\nFlask==1.1.1\r\nFlask-APIBlueprint==1.0.0\r\nFlask-Limiter==1.0.1\r\nFlask-SQLAlchemy==2.3.2\r\nflask-swagger==0.2.13\r\nhtml5lib==1.0.1\r\nidna==2.8\r\nimportlib-metadata==1.6.0\r\nitsdangerous==1.1.0\r\nJinja2==2.10.1\r\nkombu==4.6.10\r\nlimits==1.5.1\r\nMarkupSafe==1.1.1\r\nmarshmallow==3.0.0b2\r\nmysqlclient==1.4.6\r\nparamiko==2.4.1\r\npbr==5.4.5\r\npy==1.8.1\r\npyasn1==0.4.8\r\npycparser==2.20\r\npymssql==2.1.4\r\nPyNaCl==1.4.0\r\npython-dateutil==2.8.0\r\npytz==2017.2\r\nPyYAML==5.3.1\r\nrequests==2.21.0\r\nretry==0.9.2\r\nsix==1.15.0\r\nsoupsieve==2.0.1\r\nSQLAlchemy==1.2.18\r\nsshtunnel==0.1.5\r\nurllib3==1.24.3\r\nuWSGI==2.0.18\r\nvine==1.3.0\r\nwebencodings==0.5.1\r\nwebsocket-client==0.57.0\r\nWerkzeug==0.16.0\r\nzipp==3.1.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6157", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6157/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6157/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6157/events", "html_url": "https://github.com/celery/celery/issues/6157", "id": 630788132, "node_id": "MDU6SXNzdWU2MzA3ODgxMzI=", "number": 6157, "title": "Eager/Normal different behaviour", "user": {"login": "Ixiodor", "id": 21291221, "node_id": "MDQ6VXNlcjIxMjkxMjIx", "avatar_url": "https://avatars1.githubusercontent.com/u/21291221?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ixiodor", "html_url": "https://github.com/Ixiodor", "followers_url": "https://api.github.com/users/Ixiodor/followers", "following_url": "https://api.github.com/users/Ixiodor/following{/other_user}", "gists_url": "https://api.github.com/users/Ixiodor/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ixiodor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ixiodor/subscriptions", "organizations_url": "https://api.github.com/users/Ixiodor/orgs", "repos_url": "https://api.github.com/users/Ixiodor/repos", "events_url": "https://api.github.com/users/Ixiodor/events{/privacy}", "received_events_url": "https://api.github.com/users/Ixiodor/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-04T12:42:56Z", "updated_at": "2020-06-04T12:46:02Z", "closed_at": "2020-06-04T12:45:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [ ] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.4\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n<details>\r\n<p>\r\n\r\n```python\r\nitem = chain(*chords).apply_async(link_error=error_job, link=completed_job)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nI don't know what i should expect. In eager mode that is legit(I don't get link/link_error executed), in normal mode i get: Cannot add link to group: use a chord\r\n\"\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nSee Expected Behaviour", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6155", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6155/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6155/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6155/events", "html_url": "https://github.com/celery/celery/issues/6155", "id": 630603473, "node_id": "MDU6SXNzdWU2MzA2MDM0NzM=", "number": 6155, "title": "Celery 4.4.4 raises TypeError: set() takes 3 positional arguments but 4 were given", "user": {"login": "robvdl", "id": 1018674, "node_id": "MDQ6VXNlcjEwMTg2NzQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/1018674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/robvdl", "html_url": "https://github.com/robvdl", "followers_url": "https://api.github.com/users/robvdl/followers", "following_url": "https://api.github.com/users/robvdl/following{/other_user}", "gists_url": "https://api.github.com/users/robvdl/gists{/gist_id}", "starred_url": "https://api.github.com/users/robvdl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/robvdl/subscriptions", "organizations_url": "https://api.github.com/users/robvdl/orgs", "repos_url": "https://api.github.com/users/robvdl/repos", "events_url": "https://api.github.com/users/robvdl/events{/privacy}", "received_events_url": "https://api.github.com/users/robvdl/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 938745200, "node_id": "MDU6TGFiZWw5Mzg3NDUyMDA=", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Results%20Backend", "name": "Category: Results Backend", "color": "c5f94a", "default": false, "description": ""}, {"id": 46818, "node_id": "MDU6TGFiZWw0NjgxOA==", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20Django", "name": "Component: Django", "color": "ededed", "default": false, "description": null}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 11, "created_at": "2020-06-04T08:06:00Z", "updated_at": "2020-06-18T23:24:58Z", "closed_at": "2020-06-18T23:24:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "This doesn't happen on 4.4.3, only on 4.4.4.\r\n\r\nHere is a traceback:\r\n\r\n```\r\ncelery_default_1      | [2020-06-04 19:51:47,723: ERROR/MainProcess] Pool callback raised exception: TypeError('set() takes 3 positional arguments but 4 were given',)\r\ncelery_default_1      | Traceback (most recent call last):\r\ncelery_default_1      |   File \"/usr/share/dashboard/venv/lib/python3.6/site-packages/billiard/pool.py\", line 1796, in safe_apply_callback\r\ncelery_default_1      |     fun(*args, **kwargs)\r\ncelery_default_1      |   File \"/usr/share/dashboard/venv/lib/python3.6/site-packages/celery/worker/request.py\", line 528, in on_failure\r\ncelery_default_1      |     store_result=self.store_errors,\r\ncelery_default_1      |   File \"/usr/share/dashboard/venv/lib/python3.6/site-packages/celery/backends/base.py\", line 169, in mark_as_failure\r\ncelery_default_1      |     traceback=traceback, request=request)\r\ncelery_default_1      |   File \"/usr/share/dashboard/venv/lib/python3.6/site-packages/celery/backends/base.py\", line 443, in store_result\r\ncelery_default_1      |     request=request, **kwargs)\r\ncelery_default_1      |   File \"/usr/share/dashboard/venv/lib/python3.6/site-packages/celery/backends/base.py\", line 858, in _store_result\r\ncelery_default_1      |     self.set(self.get_key_for_task(task_id), self.encode(meta), state)\r\ncelery_default_1      | TypeError: set() takes 3 positional arguments but 4 were given\r\n```\r\n\r\nI am running on Python 3.6 on Bionic.\r\n\r\nFor now I've stuck to 4.4.3 as 4.4.4 keeps throwing this exception.\r\n\r\n<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n4.4.4\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.4 (cliffs) kombu:4.6.10 py:3.6.10\r\n            billiard:3.6.3.0 py-amqp:2.6.0\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:5.3.0-51-generic imp:CPython\r\nloader   -> celery.loaders.default.Loader\r\nsettings -> transport:amqp results:disabled\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.6.10\r\n* **Minimal Celery Version**: 4.4.4\r\n* **Minimal Kombu Version**: 4.6.10\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: Ubuntu 18.04 + 5.3 kernel\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.6.0\r\nargh==0.26.2\r\nasgiref==3.2.7\r\nBabel==2.8.0\r\nbackcall==0.1.0\r\nbilliard==3.6.3.0\r\ncelery==4.4.4\r\ncertifi==2020.4.5.1\r\nchardet==3.0.4\r\nclick==7.1.2\r\ncoverage==5.1\r\ndecorator==4.4.2\r\ndefusedxml==0.5.0\r\nDjango==2.2.13\r\ndjango-celery-beat==2.0.0\r\ndjango-celery-results==1.2.1\r\ndjango-crispy-forms==1.9.1\r\ndjango-csp==3.6\r\ndjango-extensions==2.2.9\r\ndjango-nose==1.4.6\r\ndjango-redis==4.12.1\r\ndjango-timezone-field==4.0\r\ndjangorestframework==3.11.0\r\nflower==0.9.3\r\nftputil==3.4\r\nfuture==0.18.2\r\ngunicorn==20.0.4\r\nhiredis==1.0.1\r\nicalendar==4.0.6\r\nidna==2.9\r\nimportlib-metadata==1.6.0\r\nipdb==0.13.2\r\nipdbplugin==1.5.0\r\nipython==7.15.0\r\nipython-genutils==0.2.0\r\nisort==4.3.21\r\njedi==0.17.0\r\njsonfield==2.0.2\r\nkombu==4.6.10\r\nlxml==4.3.5\r\nnose==1.3.7\r\nparso==0.7.0\r\npathtools==0.1.2\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nPillow==5.4.1\r\nprompt-toolkit==3.0.5\r\npsycopg2==2.8.5\r\nptyprocess==0.6.0\r\npycodestyle==2.6.0\r\npyflakes==2.2.0\r\nPygments==2.6.1\r\npython-crontab==2.5.1\r\npython-dateutil==2.8.1\r\npytz==2020.1\r\nPyYAML==5.2\r\nraven==6.10.0\r\nredis==3.5.3\r\nrequests==2.23.0\r\nsingle-beat==0.4.1\r\nsix==1.15.0\r\nsqlparse==0.3.1\r\nsuds-jurko==0.6\r\ntornadis==0.8.1\r\ntornado==5.1.1\r\ntraitlets==4.3.3\r\nurllib3==1.25.9\r\nvine==1.3.0\r\nwatchdog==0.9.0\r\nwcwidth==0.2.3\r\nwhitenoise==5.1.0\r\nzipp==3.1.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\n\r\n```\r\nUbuntu 18.04\r\nRedis\r\nPostgres 10\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6153", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6153/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6153/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6153/events", "html_url": "https://github.com/celery/celery/issues/6153", "id": 630324997, "node_id": "MDU6SXNzdWU2MzAzMjQ5OTc=", "number": 6153, "title": "ModuleNotFoundError: No module named 'future' in 4.4.4", "user": {"login": "rmk135", "id": 1742049, "node_id": "MDQ6VXNlcjE3NDIwNDk=", "avatar_url": "https://avatars0.githubusercontent.com/u/1742049?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rmk135", "html_url": "https://github.com/rmk135", "followers_url": "https://api.github.com/users/rmk135/followers", "following_url": "https://api.github.com/users/rmk135/following{/other_user}", "gists_url": "https://api.github.com/users/rmk135/gists{/gist_id}", "starred_url": "https://api.github.com/users/rmk135/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rmk135/subscriptions", "organizations_url": "https://api.github.com/users/rmk135/orgs", "repos_url": "https://api.github.com/users/rmk135/repos", "events_url": "https://api.github.com/users/rmk135/events{/privacy}", "received_events_url": "https://api.github.com/users/rmk135/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 9, "created_at": "2020-06-03T20:56:08Z", "updated_at": "2020-06-08T06:13:22Z", "closed_at": "2020-06-08T06:13:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "Guys, version `4.4.4` doesn't work on Python 3.8:\r\n\r\n```\r\ncelery_1         | Traceback (most recent call last):\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/worker/worker.py\", line 208, in start\r\ncelery_1         |     self.blueprint.start(self)\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/bootsteps.py\", line 115, in start\r\ncelery_1         |     self.on_start()\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/apps/worker.py\", line 139, in on_start\r\ncelery_1         |     self.emit_banner()\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/apps/worker.py\", line 154, in emit_banner\r\ncelery_1         |     ' \\n', self.startup_info(artlines=not use_image))),\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/apps/worker.py\", line 217, in startup_info\r\ncelery_1         |     results=self.app.backend.as_uri(),\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/kombu/utils/objects.py\", line 44, in __get__\r\ncelery_1         |     value = obj.__dict__[self.__name__] = self.__get(obj)\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/app/base.py\", line 1232, in backend\r\ncelery_1         |     return self._get_backend()\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/app/base.py\", line 947, in _get_backend\r\ncelery_1         |     backend, url = backends.by_url(\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/app/backends.py\", line 74, in by_url\r\ncelery_1         |     return by_name(backend, loader), url\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/app/backends.py\", line 54, in by_name\r\ncelery_1         |     cls = symbol_by_name(backend, aliases)\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/kombu/utils/imports.py\", line 57, in symbol_by_name\r\ncelery_1         |     module = imp(module_name, package=package, **kwargs)\r\ncelery_1         |   File \"/usr/local/lib/python3.8/importlib/__init__.py\", line 127, in import_module\r\ncelery_1         |     return _bootstrap._gcd_import(name[level:], package, level)\r\ncelery_1         |   File \"<frozen importlib._bootstrap>\", line 1014, in _gcd_import\r\ncelery_1         |   File \"<frozen importlib._bootstrap>\", line 991, in _find_and_load\r\ncelery_1         |   File \"<frozen importlib._bootstrap>\", line 975, in _find_and_load_unlocked\r\ncelery_1         |   File \"<frozen importlib._bootstrap>\", line 671, in _load_unlocked\r\ncelery_1         |   File \"<frozen importlib._bootstrap_external>\", line 783, in exec_module\r\ncelery_1         |   File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/django_celery_results/backends/__init__.py\", line 3, in <module>\r\ncelery_1         |     from .cache import CacheBackend\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/django_celery_results/backends/cache.py\", line 6, in <module>\r\ncelery_1         |     from celery.backends.base import KeyValueStoreBackend\r\ncelery_1         |   File \"/usr/local/lib/python3.8/site-packages/celery/backends/base.py\", line 10, in <module>\r\ncelery_1         |     from future.utils import raise_with_traceback\r\ncelery_1         | ModuleNotFoundError: No module named 'future'\r\n```\r\n\r\nPS: Apologies for not following your bug report pattern.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6149", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6149/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6149/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6149/events", "html_url": "https://github.com/celery/celery/issues/6149", "id": 630024844, "node_id": "MDU6SXNzdWU2MzAwMjQ4NDQ=", "number": 6149, "title": "Version 4.4.4 is broken because future package is not imported", "user": {"login": "marianne-butaye", "id": 17159379, "node_id": "MDQ6VXNlcjE3MTU5Mzc5", "avatar_url": "https://avatars2.githubusercontent.com/u/17159379?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marianne-butaye", "html_url": "https://github.com/marianne-butaye", "followers_url": "https://api.github.com/users/marianne-butaye/followers", "following_url": "https://api.github.com/users/marianne-butaye/following{/other_user}", "gists_url": "https://api.github.com/users/marianne-butaye/gists{/gist_id}", "starred_url": "https://api.github.com/users/marianne-butaye/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marianne-butaye/subscriptions", "organizations_url": "https://api.github.com/users/marianne-butaye/orgs", "repos_url": "https://api.github.com/users/marianne-butaye/repos", "events_url": "https://api.github.com/users/marianne-butaye/events{/privacy}", "received_events_url": "https://api.github.com/users/marianne-butaye/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-03T14:04:46Z", "updated_at": "2020-06-03T14:10:35Z", "closed_at": "2020-06-03T14:10:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [x] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.4 (celery v4.4.3 and below work fine)\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.7\r\n* **Minimal Celery Version**: 4.4.4\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\ncelery_app = Celery(\"worker\", broker=\"amqp://guest@queue//\")\r\n\r\ncelery_app.conf.task_routes = {\"app.worker.test_celery\": \"main-queue\"}\r\n\r\n@celery_app.task(acks_late=True)\r\ndef test_celery(word: str):\r\n    return f\"test task return {word}\"\r\n\r\ncelery_app.send_task(\"app.worker.test_celery\", args=[\"msg\"])\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nThe function should return successfully.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nAn error is thrown : `No module named future` in the celery package (in celery code, the error is at `celery/backends/base.py`:  `from future.utils import raise_with_traceback `", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6148", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6148/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6148/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6148/events", "html_url": "https://github.com/celery/celery/issues/6148", "id": 629859354, "node_id": "MDU6SXNzdWU2Mjk4NTkzNTQ=", "number": 6148, "title": "No module named 'future' after upgrading to 4.4.4", "user": {"login": "menecio", "id": 924245, "node_id": "MDQ6VXNlcjkyNDI0NQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/924245?v=4", "gravatar_id": "", "url": "https://api.github.com/users/menecio", "html_url": "https://github.com/menecio", "followers_url": "https://api.github.com/users/menecio/followers", "following_url": "https://api.github.com/users/menecio/following{/other_user}", "gists_url": "https://api.github.com/users/menecio/gists{/gist_id}", "starred_url": "https://api.github.com/users/menecio/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/menecio/subscriptions", "organizations_url": "https://api.github.com/users/menecio/orgs", "repos_url": "https://api.github.com/users/menecio/repos", "events_url": "https://api.github.com/users/menecio/events{/privacy}", "received_events_url": "https://api.github.com/users/menecio/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-06-03T09:55:05Z", "updated_at": "2020-06-03T11:29:29Z", "closed_at": "2020-06-03T11:29:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "This one is simple to reproduce, I just upgraded to `celery==4.4.4` and now my builds are broken.\r\n\r\n```\r\n[2020-06-03 09:48:39,517: DEBUG/MainProcess] | Worker: Preparing bootsteps.\r\n[2020-06-03 09:48:39,518: DEBUG/MainProcess] | Worker: Building graph...\r\n[2020-06-03 09:48:39,518: DEBUG/MainProcess] | Worker: New boot order: {StateDB, Beat, Timer, Hub, Pool, Autoscaler, Consumer}\r\n[2020-06-03 09:48:39,522: DEBUG/MainProcess] | Consumer: Preparing bootsteps.\r\n[2020-06-03 09:48:39,522: DEBUG/MainProcess] | Consumer: Building graph...\r\n[2020-06-03 09:48:39,538: DEBUG/MainProcess] | Consumer: New boot order: {Connection, Events, Heart, Mingle, Gossip, Agent, Tasks, Control, event loop}\r\n[2020-06-03 09:48:39,540: CRITICAL/MainProcess] Unrecoverable error: ModuleNotFoundError(\"No module named 'future'\")\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/kombu/utils/objects.py\", line 42, in __get__\r\n    return obj.__dict__[self.__name__]\r\nKeyError: 'backend'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/worker/worker.py\", line 208, in start\r\n    self.blueprint.start(self)\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/bootsteps.py\", line 115, in start\r\n    self.on_start()\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/apps/worker.py\", line 139, in on_start\r\n    self.emit_banner()\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/apps/worker.py\", line 154, in emit_banner\r\n    ' \\n', self.startup_info(artlines=not use_image))),\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/apps/worker.py\", line 217, in startup_info\r\n    results=self.app.backend.as_uri(),\r\n  File \"/usr/local/lib/python3.7/site-packages/kombu/utils/objects.py\", line 44, in __get__\r\n    value = obj.__dict__[self.__name__] = self.__get(obj)\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/base.py\", line 1232, in backend\r\n    return self._get_backend()\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/base.py\", line 949, in _get_backend\r\n    self.loader)\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/backends.py\", line 74, in by_url\r\n    return by_name(backend, loader), url\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/app/backends.py\", line 54, in by_name\r\n    cls = symbol_by_name(backend, aliases)\r\n  File \"/usr/local/lib/python3.7/site-packages/kombu/utils/imports.py\", line 57, in symbol_by_name\r\n    module = imp(module_name, package=package, **kwargs)\r\n  File \"/usr/local/lib/python3.7/importlib/__init__.py\", line 127, in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n  File \"<frozen importlib._bootstrap>\", line 1006, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 983, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 967, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 677, in _load_unlocked\r\n  File \"<frozen importlib._bootstrap_external>\", line 728, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"/usr/local/lib/python3.7/site-packages/celery/backends/base.py\", line 10, in <module>\r\n    from future.utils import raise_with_traceback\r\nModuleNotFoundError: No module named 'future'\r\n```\r\n\r\nRunning in a docker container using `python:3.7-alpine` as base image.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6145", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6145/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6145/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6145/events", "html_url": "https://github.com/celery/celery/issues/6145", "id": 629723450, "node_id": "MDU6SXNzdWU2Mjk3MjM0NTA=", "number": 6145, "title": "Missing dependency on future in 4.4.4 ", "user": {"login": "nijel", "id": 212189, "node_id": "MDQ6VXNlcjIxMjE4OQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/212189?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nijel", "html_url": "https://github.com/nijel", "followers_url": "https://api.github.com/users/nijel/followers", "following_url": "https://api.github.com/users/nijel/following{/other_user}", "gists_url": "https://api.github.com/users/nijel/gists{/gist_id}", "starred_url": "https://api.github.com/users/nijel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nijel/subscriptions", "organizations_url": "https://api.github.com/users/nijel/orgs", "repos_url": "https://api.github.com/users/nijel/repos", "events_url": "https://api.github.com/users/nijel/events{/privacy}", "received_events_url": "https://api.github.com/users/nijel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-03T06:16:40Z", "updated_at": "2020-06-03T07:38:01Z", "closed_at": "2020-06-03T07:38:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- Introduced by https://github.com/celery/celery/commit/0463bff0530b8aef8d31bd8039f245735295db59\r\n- https://github.com/celery/celery/pull/6122\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.4\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n1. Upgrade from Celery 4.4.3 to 4.4.4\r\n2. Get `ModuleNotFoundError: No module named 'future'` eror\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n\r\nIt would work after upgrade. In case new dependencies were introduced, these should be installed.\r\n<!-- Describe in detail what you expect to happen -->\r\n\r\n# Actual Behavior\r\n\r\n```\r\n weblate_1   |   File \"/usr/local/lib/python3.7/dist-packages/celery/backends/redis.py\", line 25, in <module>\r\nweblate_1   |     from .base import BaseKeyValueStoreBackend\r\nweblate_1   |   File \"/usr/local/lib/python3.7/dist-packages/celery/backends/base.py\", line 10, in <module>\r\nweblate_1   |     from future.utils import raise_with_traceback\r\nweblate_1   | ModuleNotFoundError: No module named 'future'\r\n```\r\n\r\nSee https://github.com/WeblateOrg/docker/runs/733499300\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6143", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6143/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6143/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6143/events", "html_url": "https://github.com/celery/celery/issues/6143", "id": 629265473, "node_id": "MDU6SXNzdWU2MjkyNjU0NzM=", "number": 6143, "title": "[CassandraBackend.process_cleanup] is unnecessary", "user": {"login": "baixuexue123", "id": 6227153, "node_id": "MDQ6VXNlcjYyMjcxNTM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6227153?v=4", "gravatar_id": "", "url": "https://api.github.com/users/baixuexue123", "html_url": "https://github.com/baixuexue123", "followers_url": "https://api.github.com/users/baixuexue123/followers", "following_url": "https://api.github.com/users/baixuexue123/following{/other_user}", "gists_url": "https://api.github.com/users/baixuexue123/gists{/gist_id}", "starred_url": "https://api.github.com/users/baixuexue123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/baixuexue123/subscriptions", "organizations_url": "https://api.github.com/users/baixuexue123/orgs", "repos_url": "https://api.github.com/users/baixuexue123/repos", "events_url": "https://api.github.com/users/baixuexue123/events{/privacy}", "received_events_url": "https://api.github.com/users/baixuexue123/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 235027917, "node_id": "MDU6TGFiZWwyMzUwMjc5MTc=", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Needs%20Verification%20%E2%9C%98", "name": "Status: Needs Verification \u2718", "color": "0052cc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-06-02T14:48:15Z", "updated_at": "2020-06-21T12:41:52Z", "closed_at": "2020-06-21T12:41:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.3 (cliffs) kombu:4.6.9 py:3.7.6\r\n            billiard:3.6.3.0 py-amqp:2.6.0\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:4.15.0-101-generic imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:amqp results:cassandra\r\n\r\nQueue: <class 'kombu.entity.Queue'>\r\nRoundRobinPolicy: <class 'cassandra.policies.RoundRobinPolicy'>\r\nbroker_url: 'amqp://guest:********@localhost:5672//'\r\ncassandra_auth_kwargs: {\r\n 'password': '********', 'username': 'cassandra'}\r\ncassandra_auth_provider: 'PlainTextAuthProvider'\r\ncassandra_entry_ttl: 86400\r\ncassandra_keyspace: '********'\r\ncassandra_options: {\r\n    'load_balancing_policy': <cassandra.policies.RoundRobinPolicy object at 0x7f09de9a34d0>}\r\ncassandra_servers: ['127.0.0.1']\r\ncassandra_table: 'celery_jobs_result'\r\nignore_result: False\r\nresult_backend: 'cassandra'\r\nworker_concurrency: 4\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.6.0\r\nattrs==19.3.0\r\nbilliard==3.6.3.0\r\ncase==1.5.3\r\ncassandra-driver==3.20.2\r\nfuture==0.18.2\r\ngevent==20.5.2\r\ngreenlet==0.4.15\r\nimportlib-metadata==1.6.0\r\nkombu==4.6.9\r\nlinecache2==1.0.0\r\nmock==4.0.2\r\nmore-itertools==8.3.0\r\nnose==1.3.7\r\npackaging==20.4\r\npluggy==0.13.1\r\npy==1.8.1\r\npyparsing==2.4.7\r\npytest==5.4.2\r\npytz==2020.1\r\nredis==3.5.2\r\nsix==1.15.0\r\ntraceback2==1.4.0\r\nunittest2==1.1.0\r\nvine==1.3.0\r\nwcwidth==0.1.9\r\nzipp==3.1.0\r\nzope.event==4.4\r\nzope.interface==5.1.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n\r\nCassandraBackend work fine\r\n\r\n# Actual Behavior\r\n\r\n## in prefork pool or solo:\r\n\r\nit can work, just not good, i think\r\n\r\n## in threads or gevent pool:\r\n\r\nget these error frequently\r\n\r\n<p>\r\n\r\n```\r\n[2020-06-02 21:52:19,592: ERROR/MainProcess] Task add[4bd528a0-c1ba-456c-b74e-7dee054616bb] raised unexpected: AttributeError(\"'NoneType' object has no attribute 'execute'\")\r\nTraceback (most recent call last):\r\n  File \"/home/bx/project/celery/celery/app/trace.py\", line 480, in trace_task\r\n    uuid, retval, task_request, publish_result,\r\n  File \"/home/bx/project/celery/celery/backends/base.py\", line 158, in mark_as_done\r\n    self.store_result(task_id, result, state, request=request)\r\n  File \"/home/bx/project/celery/celery/backends/base.py\", line 443, in store_result\r\n    request=request, **kwargs)\r\n  File \"/home/bx/project/celery/celery/backends/cassandra.py\", line 201, in _store_result\r\n    self._session.execute(self._write_stmt, (\r\nAttributeError: 'NoneType' object has no attribute 'execute'\r\n```\r\n<p>\r\n\r\nand \r\n\r\n<p>\r\n\r\n```\r\n[2020-06-02 21:52:29,773: ERROR/MainProcess] Task add[27c980d3-126a-430d-a8e0-92d749ceb735] raised unexpected: OperationTimedOut(\"errors=errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042, last_host=None\")\r\nTraceback (most recent call last):\r\n  File \"/home/bx/project/celery/celery/app/trace.py\", line 480, in trace_task\r\n    uuid, retval, task_request, publish_result,\r\n  File \"/home/bx/project/celery/celery/backends/base.py\", line 158, in mark_as_done\r\n    self.store_result(task_id, result, state, request=request)\r\n  File \"/home/bx/project/celery/celery/backends/base.py\", line 443, in store_result\r\n    request=request, **kwargs)\r\n  File \"/home/bx/project/celery/celery/backends/cassandra.py\", line 207, in _store_result\r\n    buf_t(self.encode(self.current_task_children(request)))\r\n  File \"cassandra/cluster.py\", line 2345, in cassandra.cluster.Session.execute\r\n  File \"cassandra/cluster.py\", line 4304, in cassandra.cluster.ResponseFuture.result\r\ncassandra.OperationTimedOut: errors=errors={'Connection defunct by heartbeat': 'Client request timeout. See Session.execute[_async](timeout)'}, last_host=127.0.0.1:9042, last_host=None\r\n```\r\n\r\n</p>\r\n\r\n# Fix it\r\n\r\nremove  method(CassandraBackend.process_cleanup), it works fine.\r\n\r\nbecause.\r\n\r\n all tasks should share one instance of cassandra.cluster.Cluster and session,   not create one ervery time. that is the correct way to use cassandra-driver\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6136", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6136/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6136/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6136/events", "html_url": "https://github.com/celery/celery/issues/6136", "id": 628434655, "node_id": "MDU6SXNzdWU2Mjg0MzQ2NTU=", "number": 6136, "title": "Celery 4.4.3 always trying create /var/run/celery directory, even if it's not needed.", "user": {"login": "kwist-sgr", "id": 4199178, "node_id": "MDQ6VXNlcjQxOTkxNzg=", "avatar_url": "https://avatars2.githubusercontent.com/u/4199178?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kwist-sgr", "html_url": "https://github.com/kwist-sgr", "followers_url": "https://api.github.com/users/kwist-sgr/followers", "following_url": "https://api.github.com/users/kwist-sgr/following{/other_user}", "gists_url": "https://api.github.com/users/kwist-sgr/gists{/gist_id}", "starred_url": "https://api.github.com/users/kwist-sgr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kwist-sgr/subscriptions", "organizations_url": "https://api.github.com/users/kwist-sgr/orgs", "repos_url": "https://api.github.com/users/kwist-sgr/repos", "events_url": "https://api.github.com/users/kwist-sgr/events{/privacy}", "received_events_url": "https://api.github.com/users/kwist-sgr/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 14, "created_at": "2020-06-01T13:23:03Z", "updated_at": "2020-07-28T23:26:37Z", "closed_at": "2020-06-02T11:10:33Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n#6017  Celery Multi creates pid and log files in the wrong directory\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n\r\n```\r\n# celery report\r\n\r\nsoftware -> celery:4.4.3 (cliffs) kombu:4.6.9 py:3.7.7\r\n            billiard:3.6.3.0 py-amqp:2.6.0\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:4.19.0-8-amd64 imp:CPython\r\nloader   -> celery.loaders.default.Loader\r\nsettings -> transport:amqp results:disabled\r\n\r\n```\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Celery Version**: 4.4.3\r\n\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n```\r\ncelery multi start ... --pidfile=/var/run/demo/celeryd-%n.pid\r\n```\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\ncelery runs\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nstart failed\r\n```\r\ncelery multi v4.4.3 (cliffs)\r\n_annotate_with_default_opts: print options\r\nOrderedDict([('--app', 'service.celery:app'),\r\n             ('--pidfile', '/var/run/demo/celeryd-%n.pid'),\r\n             ('--logfile', '/var/log/demo/celeryd-%n%I.log'),\r\n             ('--loglevel', 'INFO'),\r\n             ('--workdir', '/var/lib/demo-celery'),\r\n             ('--events', None),\r\n             ('--heartbeat-interval', '5'),\r\n             ('--without-gossip', None),\r\n             ('--queues', 'high'),\r\n             ('--concurrency', '1'),\r\n             ('-n', 'high@celeryd.worker')])\r\nTraceback (most recent call last):\r\n  File \"/var/www/misc/ve-2006011156/bin/celery\", line 8, in <module>\r\n    sys.exit(main())\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/__main__.py\", line 16, in main\r\n    _main()\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/celery.py\", line 322, in main\r\n    cmd.execute_from_commandline(argv)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/celery.py\", line 495, in execute_from_commandline\r\n    super(CeleryCommand, self).execute_from_commandline(argv)))\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/base.py\", line 305, in execute_from_commandline\r\n    return self.handle_argv(self.prog_name, argv[1:])\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/celery.py\", line 487, in handle_argv\r\n    return self.execute(command, argv)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/celery.py\", line 419, in execute\r\n    ).run_from_argv(self.prog_name, argv[1:], command=argv[0])\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/celery.py\", line 335, in run_from_argv\r\n    return cmd.execute_from_commandline([command] + argv)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/multi.py\", line 266, in execute_from_commandline\r\n    return self.call_command(argv[0], argv[1:])\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/multi.py\", line 273, in call_command\r\n    return self.commands[command](*argv) or EX_OK\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/multi.py\", line 143, in _inner\r\n    return fun(self, *args, **kwargs)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/multi.py\", line 151, in _inner\r\n    return fun(self, self.cluster_from_argv(argv), **kwargs)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/multi.py\", line 361, in cluster_from_argv\r\n    _, cluster = self._cluster_from_argv(argv, cmd=cmd)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/bin/multi.py\", line 366, in _cluster_from_argv\r\n    return p, self.Cluster(list(nodes), cmd=cmd)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/apps/multi.py\", line 306, in <genexpr>\r\n    for name in names\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/apps/multi.py\", line 314, in _node_from_options\r\n    p.optmerge(namespace, options), p.passthrough)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/apps/multi.py\", line 136, in __init__\r\n    options or OrderedDict())\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/apps/multi.py\", line 145, in _annotate_with_default_opts\r\n    self._setdefaultopt(options, ['--pidfile', '-p'], '/var/run/celery/%n.pid')\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/site-packages/celery/apps/multi.py\", line 159, in _setdefaultopt\r\n    os.makedirs(dir_path)\r\n  File \"/var/www/misc/ve-2006011156/lib/python3.7/os.py\", line 223, in makedirs\r\n    mkdir(name, mode)\r\nPermissionError: [Errno 13] Permission denied: '/var/run/celery'\r\n\r\nsystemd[1]: demo@celeryd.service: Control process exited, code=exited, status=1/FAILURE\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6135", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6135/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6135/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6135/events", "html_url": "https://github.com/celery/celery/issues/6135", "id": 628421538, "node_id": "MDU6SXNzdWU2Mjg0MjE1Mzg=", "number": 6135, "title": "Retry args change BUG", "user": {"login": "Ixiodor", "id": 21291221, "node_id": "MDQ6VXNlcjIxMjkxMjIx", "avatar_url": "https://avatars1.githubusercontent.com/u/21291221?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ixiodor", "html_url": "https://github.com/Ixiodor", "followers_url": "https://api.github.com/users/Ixiodor/followers", "following_url": "https://api.github.com/users/Ixiodor/following{/other_user}", "gists_url": "https://api.github.com/users/Ixiodor/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ixiodor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ixiodor/subscriptions", "organizations_url": "https://api.github.com/users/Ixiodor/orgs", "repos_url": "https://api.github.com/users/Ixiodor/repos", "events_url": "https://api.github.com/users/Ixiodor/events{/privacy}", "received_events_url": "https://api.github.com/users/Ixiodor/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 235027917, "node_id": "MDU6TGFiZWwyMzUwMjc5MTc=", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Needs%20Verification%20%E2%9C%98", "name": "Status: Needs Verification \u2718", "color": "0052cc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-01T13:02:16Z", "updated_at": "2020-06-01T22:56:49Z", "closed_at": "2020-06-01T22:56:49Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [ ] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: celery==4.4.2\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n[2020-05-31 23:28:34,434: INFO/MainProcess] Connected to amqp://remote_worker:**@127.0.0.1:5672//\r\n[2020-05-31 23:28:34,453: INFO/MainProcess] mingle: searching for neighbors\r\n[2020-05-31 23:28:35,487: INFO/MainProcess] mingle: all alone\r\n[2020-05-31 23:28:35,528: WARNING/MainProcess] /home/ubuntu/.local/lib/python3.7/site-packages/celery/fixups/django.py:203: UserWarning: Using settings.DEBUG leads to a memory\r\n            leak, never use this setting in production environments!\r\n  leak, never use this setting in production environments!''')\r\n[2020-05-31 23:28:35,529: INFO/MainProcess] celery@testroom ready.\r\n[2020-05-31 23:28:47,351: INFO/MainProcess] Received task: api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906]  \r\n[2020-05-31 23:28:47,689: WARNING/ForkPoolWorker-1] started\r\n[2020-05-31 23:28:47,690: WARNING/ForkPoolWorker-1] retry\r\n[2020-05-31 23:28:47,721: INFO/MainProcess] Received task: api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906]  ETA:[2020-05-31 23:28:57.692348+00:00] \r\n[2020-05-31 23:28:47,722: INFO/MainProcess] Received task: api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906]  ETA:[2020-05-31 23:28:57.716321+00:00] \r\n[2020-05-31 23:28:47,777: INFO/ForkPoolWorker-1] Task api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906] retry: Retry in 10s: Retry(Retry(...), Exception('i have filled now'), 10)\r\n[2020-05-31 23:28:57,999: WARNING/ForkPoolWorker-1] started\r\n[2020-05-31 23:28:58,000: WARNING/ForkPoolWorker-1] ended\r\n[2020-05-31 23:28:58,062: INFO/ForkPoolWorker-1] Task api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906] succeeded in 0.34440315900428686s: None\r\n[2020-05-31 23:28:58,301: WARNING/ForkPoolWorker-1] started\r\n[2020-05-31 23:28:58,302: WARNING/ForkPoolWorker-1] retry\r\n[2020-05-31 23:28:58,304: INFO/MainProcess] Received task: api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906]  ETA:[2020-05-31 23:29:08.303091+00:00] \r\n[2020-05-31 23:28:58,307: INFO/MainProcess] Received task: api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906]  ETA:[2020-05-31 23:29:08.306141+00:00] \r\n[2020-05-31 23:28:58,368: INFO/ForkPoolWorker-1] Task api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906] retry: Retry in 10s: Retry(Retry(...), Exception('i have filled now'), 10)\r\n[2020-05-31 23:29:08,572: WARNING/ForkPoolWorker-1] started\r\n[2020-05-31 23:29:08,573: WARNING/ForkPoolWorker-1] ended\r\n[2020-05-31 23:29:08,633: INFO/ForkPoolWorker-1] Task api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906] succeeded in 0.3256059319974156s: None\r\n[2020-05-31 23:29:08,872: WARNING/ForkPoolWorker-1] started\r\n[2020-05-31 23:29:08,873: WARNING/ForkPoolWorker-1] retry\r\n[2020-05-31 23:29:08,875: INFO/MainProcess] Received task: api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906]  ETA:[2020-05-31 23:29:18.873799+00:00] \r\n[2020-05-31 23:29:08,880: INFO/MainProcess] Received task: api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906]  ETA:[2020-05-31 23:29:18.877550+00:00] \r\n[2020-05-31 23:29:08,940: INFO/ForkPoolWorker-1] Task api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906] retry: Retry in 10s: Retry(Retry(...), Exception('i have filled now'), 10)\r\n[2020-05-31 23:29:19,144: WARNING/ForkPoolWorker-1] started\r\n[2020-05-31 23:29:19,145: WARNING/ForkPoolWorker-1] ended\r\n[2020-05-31 23:29:19,205: INFO/ForkPoolWorker-1] Task api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906] succeeded in 0.326258520995907s: None\r\n[2020-05-31 23:29:19,444: WARNING/ForkPoolWorker-1] started\r\n[2020-05-31 23:29:19,445: WARNING/ForkPoolWorker-1] retry\r\n[2020-05-31 23:29:19,505: ERROR/ForkPoolWorker-1] Task api_v3.tests.execute[e97d93b5-b0e5-4b87-96ab-1aab66119906] raised unexpected: Exception('i have filled now')\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/celery/app/trace.py\", line 385, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/celery/app/trace.py\", line 650, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/celery/app/base.py\", line 500, in run\r\n    raise task.retry(exc=exc, **retry_kwargs)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/celery/app/task.py\", line 704, in retry\r\n    raise_with_context(exc)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/celery/app/base.py\", line 487, in run\r\n    return task._orig_run(*args, **kwargs)\r\n  File \"/var/www/django_projects/earthalytics-api/api_v3/tests.py\", line 26, in execute\r\n    self.retry(exc=Exception(\"i have filled now\"), args=[param_a, param_b], kwargs=kwargs)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/celery/app/task.py\", line 704, in retry\r\n    raise_with_context(exc)\r\n  File \"/home/ubuntu/.local/lib/python3.7/site-packages/celery/utils/serialization.py\", line 288, in raise_with_context\r\n    _raise_with_context(exc, exc_info[1])\r\n  File \"<string>\", line 1, in _raise_with_context\r\nException: i have filled now\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\nMake a celery task with a retry changing one parameters.\r\nSet the max_retries and countdown.\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n\r\n@app_cluster.task(bind=True, autoretry_for=(Exception,), max_retries=3,\r\n                  default_retry_delay=10)\r\ndef execute(self, param_a, param_b=None, **kwargs):\r\n    print(\"started\")\r\n    if param_b is None:\r\n        param_b = \"filled\"\r\n        print(\"retry\")\r\n        self.retry(exc=Exception(\"i have filled now\"), args=[param_a, param_b], kwargs=kwargs)\r\n    print(\"ended\")\r\n\r\ndef test_celery(self):\r\n    sig = execute.si(\"something\")\r\n    t = sig.delay()\r\n    t = 0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nI expect the task get overrided with updated parameters\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n--> The task goes in retry with origianl parameters.\r\nA new task is made with new parameters and get scheduled.\r\nThe \"old\" task get executed.\r\nThe \"new\" task get executed.\r\nThe \"old\" task goes in retry making a \"new\" \"new task\" with updated parameters and the \"old\" goes scheduled again with original parameters.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6128", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6128/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6128/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6128/events", "html_url": "https://github.com/celery/celery/issues/6128", "id": 627301042, "node_id": "MDU6SXNzdWU2MjczMDEwNDI=", "number": 6128, "title": "Celery retry", "user": {"login": "Ixiodor", "id": 21291221, "node_id": "MDQ6VXNlcjIxMjkxMjIx", "avatar_url": "https://avatars1.githubusercontent.com/u/21291221?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ixiodor", "html_url": "https://github.com/Ixiodor", "followers_url": "https://api.github.com/users/Ixiodor/followers", "following_url": "https://api.github.com/users/Ixiodor/following{/other_user}", "gists_url": "https://api.github.com/users/Ixiodor/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ixiodor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ixiodor/subscriptions", "organizations_url": "https://api.github.com/users/Ixiodor/orgs", "repos_url": "https://api.github.com/users/Ixiodor/repos", "events_url": "https://api.github.com/users/Ixiodor/events{/privacy}", "received_events_url": "https://api.github.com/users/Ixiodor/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-29T14:12:48Z", "updated_at": "2020-05-29T14:36:57Z", "closed_at": "2020-05-29T14:35:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Doing:\r\n`self.retry(exc=Exception(\"not_available\"), args=[output_port, start_date, end_date, order_id], kwargs=kwargs, countdown=10)`\r\ncelery just split the task, will retry the current one and will create a new one.\r\nNow, why this happens? Cause the first time the task is called has parameters in \"kwargs\" and get unpacked in function parameters. Calling self.retry some \"kwargs\" are still there but others are moved in function parameters, so Celery retry seems just to be a \"Override this task making an equal task\" function...so you get 2 tasks:\r\n1) The one that no one will override (cause retry will never hit that cause kwargs and args changed)\r\n2) The one made \"new\" trying to override (with \"new\" args and kwargs)\r\n\r\n\r\n`    def execute(self, output_port, start_date, end_date, order_id=None, **kwargs):`\r\nThis is my task function, as i said, parameters are passed through \"kwargs\" that unpack them on \"same name\" function parameters.\r\n\r\nEDIT:\r\nforget to say, in retry i updated the parameter \"order_id\" once (first time), so i need to retry with a filled order_id(first time is None).\r\nSo i get a task with order_id=None and a task with order_id=\"Filled_value\".", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6124", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6124/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6124/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6124/events", "html_url": "https://github.com/celery/celery/issues/6124", "id": 626373715, "node_id": "MDU6SXNzdWU2MjYzNzM3MTU=", "number": 6124, "title": "Question: missed schedules in celery beat", "user": {"login": "ajaykmr2292", "id": 29298860, "node_id": "MDQ6VXNlcjI5Mjk4ODYw", "avatar_url": "https://avatars3.githubusercontent.com/u/29298860?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ajaykmr2292", "html_url": "https://github.com/ajaykmr2292", "followers_url": "https://api.github.com/users/ajaykmr2292/followers", "following_url": "https://api.github.com/users/ajaykmr2292/following{/other_user}", "gists_url": "https://api.github.com/users/ajaykmr2292/gists{/gist_id}", "starred_url": "https://api.github.com/users/ajaykmr2292/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ajaykmr2292/subscriptions", "organizations_url": "https://api.github.com/users/ajaykmr2292/orgs", "repos_url": "https://api.github.com/users/ajaykmr2292/repos", "events_url": "https://api.github.com/users/ajaykmr2292/events{/privacy}", "received_events_url": "https://api.github.com/users/ajaykmr2292/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 445647493, "node_id": "MDU6TGFiZWw0NDU2NDc0OTM=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Question", "name": "Issue Type: Question", "color": "1d76db", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-28T09:48:28Z", "updated_at": "2020-06-18T07:55:47Z", "closed_at": "2020-05-28T11:43:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am using celery beat to trigger my scheduled tasks. Suppose, my scheduler was down for some time and there were scheduled tasks in that down period. When I restart the scheduler later, will the pending task be triggered? If not, how can I trigger tasks that were missed during the down period.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6117", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6117/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6117/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6117/events", "html_url": "https://github.com/celery/celery/issues/6117", "id": 624339195, "node_id": "MDU6SXNzdWU2MjQzMzkxOTU=", "number": 6117, "title": "Celery class based task is not retrying", "user": {"login": "nanduajith", "id": 33744662, "node_id": "MDQ6VXNlcjMzNzQ0NjYy", "avatar_url": "https://avatars1.githubusercontent.com/u/33744662?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nanduajith", "html_url": "https://github.com/nanduajith", "followers_url": "https://api.github.com/users/nanduajith/followers", "following_url": "https://api.github.com/users/nanduajith/following{/other_user}", "gists_url": "https://api.github.com/users/nanduajith/gists{/gist_id}", "starred_url": "https://api.github.com/users/nanduajith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nanduajith/subscriptions", "organizations_url": "https://api.github.com/users/nanduajith/orgs", "repos_url": "https://api.github.com/users/nanduajith/repos", "events_url": "https://api.github.com/users/nanduajith/events{/privacy}", "received_events_url": "https://api.github.com/users/nanduajith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 7, "created_at": "2020-05-25T14:37:21Z", "updated_at": "2020-07-19T04:47:57Z", "closed_at": "2020-07-19T04:47:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "I defined a class-based celery task defined as follows:\r\n\r\n```python\r\nclass MyTask(Task):  \r\n    name = \"MY_TASK\"\r\n    autoretry_for = (Exception, )\r\n    retry_kwargs = {'max_retries': 5}\r\n    retry_backoff = True\r\n    retry_backoff_max = 700\r\n    retry_jitter = False\r\n\r\n    def run(self, *args, **kwargs):\r\n        pass\r\n        # do something\r\n        # return some value\r\n\r\n    def on_failure(self, exc, task_id, args, kwargs, einfo):\r\n        # can extend failure method if needed\r\n        super().on_failure(exc, task_id, args, kwargs, einfo)\r\n\r\n\r\napp.tasks.register(MyTask())\r\n```\r\n###### celery version:  4.4.2  \r\n###### python version: 3.8.2\r\n\r\n### Issue\r\nMy task is executing perfectly. But when an exception occurs, the task is not retried\r\n\r\n### Expected behaviour\r\nThe task should retry\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6110", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6110/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6110/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6110/events", "html_url": "https://github.com/celery/celery/issues/6110", "id": 620799773, "node_id": "MDU6SXNzdWU2MjA3OTk3NzM=", "number": 6110, "title": "consumer: Connection to broker lost. Trying to re-establish the connection...", "user": {"login": "girijesh97", "id": 19616698, "node_id": "MDQ6VXNlcjE5NjE2Njk4", "avatar_url": "https://avatars2.githubusercontent.com/u/19616698?v=4", "gravatar_id": "", "url": "https://api.github.com/users/girijesh97", "html_url": "https://github.com/girijesh97", "followers_url": "https://api.github.com/users/girijesh97/followers", "following_url": "https://api.github.com/users/girijesh97/following{/other_user}", "gists_url": "https://api.github.com/users/girijesh97/gists{/gist_id}", "starred_url": "https://api.github.com/users/girijesh97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/girijesh97/subscriptions", "organizations_url": "https://api.github.com/users/girijesh97/orgs", "repos_url": "https://api.github.com/users/girijesh97/repos", "events_url": "https://api.github.com/users/girijesh97/events{/privacy}", "received_events_url": "https://api.github.com/users/girijesh97/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-19T08:53:25Z", "updated_at": "2020-05-28T08:02:17Z", "closed_at": "2020-05-28T08:02:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\nI am using celery with my Django Application and I am facing connection error while executing a task for a longer time (approximately 10-15 mins). Though the connection is not getting broken for a shorter process.  Error log \r\n\r\n```\r\n[2020-05-19 08:33:35,254: WARNING/MainProcess] consumer: Connection to broker lost. Trying to re-establish the connection...\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/connection.py\", line 494, in channel\r\n    return self.channels[channel_id]\r\nKeyError: None\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/worker/consumer/consumer.py\", line 318, in start\r\n    blueprint.start(self)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/bootsteps.py\", line 119, in start\r\n    step.start(parent)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/worker/consumer/mingle.py\", line 40, in start\r\n    self.sync(c)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/worker/consumer/mingle.py\", line 44, in sync\r\n    replies = self.send_hello(c)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/worker/consumer/mingle.py\", line 57, in send_hello\r\n    replies = inspect.hello(c.hostname, our_revoked._data) or {}\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/app/control.py\", line 154, in hello\r\n    return self._request('hello', from_node=from_node, revoked=revoked)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/app/control.py\", line 106, in _request\r\n    pattern=self.pattern, matcher=self.matcher,\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/celery/app/control.py\", line 480, in broadcast\r\n    limit, callback, channel=channel,\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/pidbox.py\", line 333, in _broadcast\r\n    chan = channel or self.connection.default_channel\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/connection.py\", line 870, in default_channel\r\n    self._default_channel = self.channel()\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/connection.py\", line 288, in channel\r\n    chan = self.transport.create_channel(self.connection)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/transport/pyamqp.py\", line 100, in create_channel\r\n    return connection.channel()\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/connection.py\", line 497, in channel\r\n    channel.open()\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/channel.py\", line 435, in open\r\n    spec.Channel.Open, 's', ('',), wait=spec.Channel.OpenOk,\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/abstract_channel.py\", line 68, in send_method\r\n    return self.wait(wait, returns_tuple=returns_tuple)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/abstract_channel.py\", line 88, in wait\r\n    self.connection.drain_events(timeout=timeout)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/connection.py\", line 505, in drain_events\r\n    while not self.blocking_read(timeout):\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/connection.py\", line 511, in blocking_read\r\n    return self.on_inbound_frame(frame)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/method_framing.py\", line 79, in on_frame\r\n    callback(channel, msg.frame_method, msg.frame_args, msg)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/connection.py\", line 518, in on_inbound_method\r\n    method_sig, payload, content,\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/abstract_channel.py\", line 145, in dispatch_method\r\n    listener(*args)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/channel.py\", line 1615, in _on_basic_deliver\r\n    fun(msg)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/messaging.py\", line 624, in _receive_callback\r\n    return on_m(message) if on_m else self.receive(decoded, message)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/messaging.py\", line 590, in receive\r\n    [callback(body, message) for callback in callbacks]\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/messaging.py\", line 590, in <listcomp>\r\n    [callback(body, message) for callback in callbacks]\r\n  File \"/mnt/z/womble_backend/ml_app/TextAnalysis/tasks.py\", line 85, in handle_message\r\n    message.ack()\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/kombu/message.py\", line 126, in ack\r\n    self.channel.basic_ack(self.delivery_tag, multiple=multiple)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/channel.py\", line 1394, in basic_ack\r\n    spec.Basic.Ack, argsig, (delivery_tag, multiple),\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/abstract_channel.py\", line 59, in send_method\r\n    conn.frame_writer(1, self.channel_id, sig, args, content)\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/method_framing.py\", line 172, in write_frame\r\n    write(view[:offset])\r\n  File \"/home/ubuntu/.venv/textEnv/lib/python3.6/site-packages/amqp/transport.py\", line 284, in write\r\n    self._write(s)\r\nConnectionResetError: [Errno 104] Connection reset by peer\r\n```\r\nAlthough connection is getting restablished. I tried various methods to resolve the issue as it has been mentioned in other issue on this repo like setting `broker_hearbeat = None`, `amqp_task_result_expires = 30000` and running celery by using \r\n`celery -A MyApp worker -l info --without-heartbeat` but nothing work out for me.\r\n\r\nI am stuck at this error for quite some time. Any help would be highly appreciated.\r\n\r\nThe version of the libraries I am using are as follows:\r\n\r\n```\r\namqp==2.5.2\r\ncelery==4.4.2\r\nDjango==1.11.26\r\nkombu==4.6.8\r\n```\r\n\r\nAnd, my complete setting is like this\r\n\r\n```\r\nclass Config:\r\n    broker_url = 'amqp://user:aaaaaaaa@11.111.111.111:1111/'\r\n    broker_pool_limit = None\r\n    result_backend = \"amqp\"\r\n    accept_content = ['json']\r\n    task_serializer = 'json'\r\n    result_serializer = 'json'\r\n    amqp_task_result_expires = 30000\r\n    # CELERY_TASK_TIME_LIMIT = 86400 #24 hours\r\n    # CELERY_TASK_SOFT_TIME_LIMIT = 86400\r\n    broker_connection_timeout=86400\r\n    broker_hearbeat = None\r\n    #CELERY_BROKER_CONNECTION_RETRY = False\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6108", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6108/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6108/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6108/events", "html_url": "https://github.com/celery/celery/issues/6108", "id": 620492893, "node_id": "MDU6SXNzdWU2MjA0OTI4OTM=", "number": 6108, "title": "[FilesystemBackend] Failure in unpickling a FilesystemBackend instance for a group", "user": {"login": "singlaive", "id": 851206, "node_id": "MDQ6VXNlcjg1MTIwNg==", "avatar_url": "https://avatars3.githubusercontent.com/u/851206?v=4", "gravatar_id": "", "url": "https://api.github.com/users/singlaive", "html_url": "https://github.com/singlaive", "followers_url": "https://api.github.com/users/singlaive/followers", "following_url": "https://api.github.com/users/singlaive/following{/other_user}", "gists_url": "https://api.github.com/users/singlaive/gists{/gist_id}", "starred_url": "https://api.github.com/users/singlaive/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/singlaive/subscriptions", "organizations_url": "https://api.github.com/users/singlaive/orgs", "repos_url": "https://api.github.com/users/singlaive/repos", "events_url": "https://api.github.com/users/singlaive/events{/privacy}", "received_events_url": "https://api.github.com/users/singlaive/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 1, "created_at": "2020-05-18T20:40:52Z", "updated_at": "2020-05-30T12:20:05Z", "closed_at": "2020-05-30T12:20:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x ] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.2 (cliffs) kombu:4.6.8 py:3.7.5\r\n            billiard:3.6.3.0 py-amqp:2.5.2\r\nplatform -> system:Darwin arch:64bit\r\n            kernel version:18.7.0 imp:CPython\r\nloader   -> celery.loaders.default.Loader\r\nsettings -> transport:amqp results:disabled\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nBackend: file system\r\nsteriliser: pickle\r\n\r\nScenario: Define a group and retrieve the result, for instance, group([add.s(1,2), add.s(3,4)])().get()\r\nThis should give the correct result of two adding calculation\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n```\r\n\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nvenv3/lib/python3.7/site-packages/celery/result.py:229: in get\r\n    on_message=on_message,\r\nvenv3/lib/python3.7/site-packages/celery/backends/base.py:579: in wait_for_pending\r\n    no_ack=no_ack,\r\nvenv3/lib/python3.7/site-packages/celery/backends/base.py:606: in wait_for\r\n    meta = self.get_task_meta(task_id)\r\nvenv3/lib/python3.7/site-packages/celery/backends/base.py:457: in get_task_meta\r\n    meta = self._get_task_meta_for(task_id)\r\nvenv3/lib/python3.7/site-packages/celery/backends/base.py:791: in _get_task_meta_for\r\n    return self.decode_result(meta)\r\nvenv3/lib/python3.7/site-packages/celery/backends/base.py:322: in decode_result\r\n    return self.meta_from_decoded(self.decode(payload))\r\nvenv3/lib/python3.7/site-packages/celery/backends/base.py:333: in decode\r\n    accept=self.accept)\r\nvenv3/lib/python3.7/site-packages/kombu/serialization.py:264: in loads\r\n    return decode(data)\r\n/usr/local/Cellar/python/3.7.5/Frameworks/Python.framework/Versions/3.7/lib/python3.7/contextlib.py:130: in __exit__\r\n    self.gen.throw(type, value, traceback)\r\nvenv3/lib/python3.7/site-packages/kombu/serialization.py:54: in _reraise_errors\r\n    reraise(wrapper, wrapper(exc), sys.exc_info()[2])\r\nvenv3/lib/python3.7/site-packages/vine/five.py:194: in reraise\r\n    raise value.with_traceback(tb)\r\nvenv3/lib/python3.7/site-packages/kombu/serialization.py:50: in _reraise_errors\r\n    yield\r\nvenv3/lib/python3.7/site-packages/kombu/serialization.py:264: in loads\r\n    return decode(data)\r\nvenv3/lib/python3.7/site-packages/kombu/serialization.py:338: in unpickle\r\n    return pickle_loads(str_to_bytes(s))\r\nvenv3/lib/python3.7/site-packages/kombu/serialization.py:59: in pickle_loads\r\n    return load(BytesIO(s))\r\nvenv3/lib/python3.7/site-packages/celery/backends/base.py:69: in unpickle_backend\r\n    return cls(*args, app=current_app._get_current_object(), **kwargs)\r\nvenv3/lib/python3.7/site-packages/celery/backends/filesystem.py:53: in __init__\r\n    path = self._find_path(url)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <celery.backends.filesystem.FilesystemBackend object at 0x10b2c7c90>, url = None\r\n\r\n    def _find_path(self, url):\r\n        if not url:\r\n>           raise ImproperlyConfigured(E_NO_PATH_SET)\r\nE           kombu.exceptions.DecodeError: You need to configure a path for the file-system backend\r\n\r\nvenv3/lib/python3.7/site-packages/celery/backends/filesystem.py:77: DecodeError\r\n```\r\n\r\n# Solution\r\nFilesystemBackend class defined in https://github.com/celery/celery/blob/master/celery/backends/filesystem.py#L34, misses ```__reduce__``` method to pickle the instance properly. The following example would make it work.\r\n```\r\ndef __reduce__(self, args=(), kwargs={}):\r\n    kwargs.update(\r\n        dict(url=self.url))\r\n    return super(FilesystemBackend, self).__reduce__(args, kwargs)\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6087", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6087/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6087/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6087/events", "html_url": "https://github.com/celery/celery/issues/6087", "id": 617174553, "node_id": "MDU6SXNzdWU2MTcxNzQ1NTM=", "number": 6087, "title": "Celery worker stops receiving tasks", "user": {"login": "gundeepsn84", "id": 48553925, "node_id": "MDQ6VXNlcjQ4NTUzOTI1", "avatar_url": "https://avatars2.githubusercontent.com/u/48553925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gundeepsn84", "html_url": "https://github.com/gundeepsn84", "followers_url": "https://api.github.com/users/gundeepsn84/followers", "following_url": "https://api.github.com/users/gundeepsn84/following{/other_user}", "gists_url": "https://api.github.com/users/gundeepsn84/gists{/gist_id}", "starred_url": "https://api.github.com/users/gundeepsn84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gundeepsn84/subscriptions", "organizations_url": "https://api.github.com/users/gundeepsn84/orgs", "repos_url": "https://api.github.com/users/gundeepsn84/repos", "events_url": "https://api.github.com/users/gundeepsn84/events{/privacy}", "received_events_url": "https://api.github.com/users/gundeepsn84/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 10795, "node_id": "MDU6TGFiZWwxMDc5NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Not%20a%20Bug", "name": "Status: Not a Bug", "color": "4c9439", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-05-13T06:19:15Z", "updated_at": "2020-05-16T10:12:11Z", "closed_at": "2020-05-16T10:11:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "Following is my celery config object file:\r\n```\r\nCELERY_BROKER_URL = mongo_settings.CELERY_BROKER_URI\r\nCELERY_RESULT_BACKEND = \"mongodb\"\r\nCELERY_MONGODB_BACKEND_SETTINGS = {\r\n    \"host\": mongo_settings.HOST,\r\n    \"port\": mongo_settings.PORT,\r\n    \"database\": \"queue\" + os.getenv('Env'),\r\n    'user': mongo_settings.USER,\r\n    'password': mongo_settings.PASSWORD,\r\n    'options': {\"ssl\": False},\r\n    \"taskmeta_collection\": \"taskmeta_collection\" + os.getenv('Env'),\r\n}\r\nCELERY_INCLUDE = [\"Operations.clustering\", \"Operations.pptExport\", \"Operations.notifications\",\r\n                  \"Operations.sync_responses\", \"Operations.text_analysis_dump\"]\r\nCELERY_DEFAULT_QUEUE = 'default-' + os.getenv(\"Env\")\r\nCELERY_DEFAULT_EXCHANGE_TYPE = 'direct'\r\nCELERYD_MAX_TASKS_PER_CHILD = 2\r\nCELERY_DEFAULT_ROUTING_KEY = 'default'\r\nCELERY_QUEUES = (\r\n    Queue('default-' + os.getenv(\"Env\"), Exchange('default', 'direct'), routing_key='default'),\r\n    Queue('ta-dump-' + os.getenv(\"Env\"), Exchange('ta-dump', 'direct'), routing_key='ta-dump'),\r\n    Queue('clustering-' + os.getenv(\"Env\"), Exchange('clustering', 'direct'), routing_key='clustering'),\r\n    Queue('ppt-export-' + os.getenv(\"Env\"), Exchange('ppt-export', 'direct'), routing_key='ppt-export'),\r\n    Queue('notifications-' + os.getenv(\"Env\"), Exchange('notifications', 'direct'), routing_key='notifications')\r\n)\r\nCELERY_ROUTES = {\r\n    'PptExport': {\r\n        'queue': 'ppt-export-' + os.getenv(\"Env\"),\r\n        'routing_key': 'ppt-export'\r\n    },\r\n    'PushNotifications': {\r\n        'queue': 'notifications-' + os.getenv(\"Env\"),\r\n        'routing_key': 'notifications'\r\n    },\r\n    'TextAnalysisDump': {\r\n        'queue': 'ta-dump-' + os.getenv(\"Env\"),\r\n        'routing_key': 'ta-dump'\r\n    }\r\n}\r\n\r\nCELERYBEAT_SCHEDULE = {\r\n    'move_partial_to_final': {\r\n        'task': 'MovePartial2Final',\r\n        # Every 10 minutes\r\n        'schedule': crontab(minute=\"*/10\"),\r\n        'options': {'queue': 'default-' + os.getenv('Env')}\r\n    },\r\n    'do_keywords_clustering': {\r\n        'task': 'AutoClustering',\r\n        # After every 2 days\r\n        'schedule': crontab(minute=0,hour=0,day_of_month=\"*/2\"),  # minute=0,hour=0,day_of_month=\"*/2\"\r\n        'options': {'queue': 'clustering-' + os.getenv('Env')}\r\n    }\r\n}\r\n```\r\n\r\nAfter sometime the tasks keeps cluttering in the broker but are not executing by worker. Please help me resolve this issue as it occurs randomly.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6086", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6086/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6086/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6086/events", "html_url": "https://github.com/celery/celery/issues/6086", "id": 616986505, "node_id": "MDU6SXNzdWU2MTY5ODY1MDU=", "number": 6086, "title": "task retry does not manage argsrepr and kwargsrepr", "user": {"login": "llicour", "id": 3127713, "node_id": "MDQ6VXNlcjMxMjc3MTM=", "avatar_url": "https://avatars0.githubusercontent.com/u/3127713?v=4", "gravatar_id": "", "url": "https://api.github.com/users/llicour", "html_url": "https://github.com/llicour", "followers_url": "https://api.github.com/users/llicour/followers", "following_url": "https://api.github.com/users/llicour/following{/other_user}", "gists_url": "https://api.github.com/users/llicour/gists{/gist_id}", "starred_url": "https://api.github.com/users/llicour/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/llicour/subscriptions", "organizations_url": "https://api.github.com/users/llicour/orgs", "repos_url": "https://api.github.com/users/llicour/repos", "events_url": "https://api.github.com/users/llicour/events{/privacy}", "received_events_url": "https://api.github.com/users/llicour/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235027917, "node_id": "MDU6TGFiZWwyMzUwMjc5MTc=", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Needs%20Verification%20%E2%9C%98", "name": "Status: Needs Verification \u2718", "color": "0052cc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-12T21:54:20Z", "updated_at": "2020-05-17T20:10:06Z", "closed_at": "2020-05-16T09:00:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.2 (cliffs) kombu:4.6.8 py:3.6.10\r\n            billiard:3.6.3.0 redis:3.4.1\r\nplatform -> system:Darwin arch:64bit\r\n            kernel version:19.4.0 imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:redis results:redis://localhost:6379/1\r\n\r\nbroker_url: 'redis://localhost:6379/1'\r\nresult_backend: 'redis://localhost:6379/1'\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n\r\nretry does not handle argsrepr and kwargsrepr, so sensitive datas are not hidden.\r\nThis occurs when task retry after a failure (*repr variables seems not be part of the retry message). Exception MaxRetriesExceededError also disclose args and kwargs insteed of argsrepr and kwargsrepr, even if max_retries=0 (when no retry occurs)\r\n<p>\r\nSee following code :\r\n<details>\r\n\r\n```python\r\nfrom celery import Celery\r\nfrom tasks import demo\r\n\r\napp = Celery('tasks', broker='redis://localhost:6379/1', backend='redis://localhost:6379/1')\r\n\r\nr = demo.apply_async((\"user\", \"password\"), argsrepr=\"user:****\", kwargs={\"password\":\"secretvalue\"}, kwargsrepr=\"password:****\")\r\n```\r\n\r\n```python\r\nfrom celery import Celery\r\n\r\napp = Celery('tasks', broker='redis://localhost:6379/1', backend='redis://localhost:6379/1')\r\n\r\n@app.task(bind=True, default_retry_delay=1)\r\ndef demo(self, *args, **kwargs):\r\n    print(\"Enter task\")\r\n    print(self.request.args)\r\n    print(self.request.argsrepr)\r\n    print(self.request.kwargs)\r\n    print(self.request.kwargsrepr)\r\n    raise self.retry(max_retries=1)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nAll retries context should contain argsrepr and kwargsrepr values. Exception should report repr values also\r\n```\r\n[2020-05-12 23:10:18,349: WARNING/ForkPoolWorker-2] Enter task\r\n[2020-05-12 23:10:18,352: WARNING/ForkPoolWorker-2] ['user', 'password']\r\n[2020-05-12 23:10:18,353: WARNING/ForkPoolWorker-2] user:****\r\n[2020-05-12 23:10:18,354: WARNING/ForkPoolWorker-2] {'password': 'secretvalue'}\r\n[2020-05-12 23:10:18,355: WARNING/ForkPoolWorker-2] password:****\r\n[2020-05-12 23:10:19,704: WARNING/ForkPoolWorker-2] Enter task\r\n[2020-05-12 23:10:19,705: WARNING/ForkPoolWorker-2] ['user', 'password']\r\n[2020-05-12 23:10:19,706: WARNING/ForkPoolWorker-2] user:****\r\n[2020-05-12 23:10:19,710: WARNING/ForkPoolWorker-2] {'password': 'secretvalue'}\r\n[2020-05-12 23:10:19,712: WARNING/ForkPoolWorker-2] password:****\r\n[2020-05-12 23:10:19,721: ERROR/ForkPoolWorker-2] Task tasks.demo[97f47a98-f12a-4745-864e-deb99b9d5ab5] raised unexpected: MaxRetriesExceededError(\"Can't retry tasks.demo[97f47a98-f12a-4745-864e-deb99b9d5ab5] args:'user:****' kwargs:'password:****'\r\nTraceback (most recent call last):\r\n  File \"/Users/20010116/.pyenv/versions/3.6.10/envs/venv-test-flaskit-new/lib/python3.6/site-packages/celery/app/trace.py\", line 385, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"/Users/20010116/.pyenv/versions/3.6.10/envs/venv-test-flaskit-new/lib/python3.6/site-packages/celery/app/trace.py\", line 650, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"/Users/20010116/Documents/Workspace/beapi--flaskit-snow-demo/tasks.py\", line 12, in demo\r\n    raise self.retry(max_retries=1)\r\n  File \"/Users/20010116/.pyenv/versions/3.6.10/envs/venv-test-flaskit-new/lib/python3.6/site-packages/celery/app/task.py\", line 708, in retry\r\n    ), task_args=S.args, task_kwargs=S.kwargs\r\ncelery.exceptions.MaxRetriesExceededError: Can't retry tasks.demo[97f47a98-f12a-4745-864e-deb99b9d5ab5] args:'user:****' kwargs:'password:****'\r\n```\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nOnly first task execution contain repr value. context of retry execution does not contain repr values any more. Exception dump full args and kwargs, so sensitive values are disclosed\r\n```\r\n[2020-05-12 23:10:18,349: WARNING/ForkPoolWorker-2] Enter task\r\n[2020-05-12 23:10:18,352: WARNING/ForkPoolWorker-2] ['user', 'password']\r\n[2020-05-12 23:10:18,353: WARNING/ForkPoolWorker-2] user:****\r\n[2020-05-12 23:10:18,354: WARNING/ForkPoolWorker-2] {'password': 'secretvalue'}\r\n[2020-05-12 23:10:18,355: WARNING/ForkPoolWorker-2] password:****\r\n[2020-05-12 23:10:19,704: WARNING/ForkPoolWorker-2] Enter task\r\n[2020-05-12 23:10:19,705: WARNING/ForkPoolWorker-2] ['user', 'password']\r\n[2020-05-12 23:10:19,706: WARNING/ForkPoolWorker-2] ('user', 'password')\r\n[2020-05-12 23:10:19,710: WARNING/ForkPoolWorker-2] {'password': 'secretvalue'}\r\n[2020-05-12 23:10:19,712: WARNING/ForkPoolWorker-2] {'password': 'secretvalue'}\r\n[2020-05-12 23:10:19,721: ERROR/ForkPoolWorker-2] Task tasks.demo[97f47a98-f12a-4745-864e-deb99b9d5ab5] raised unexpected: MaxRetriesExceededError(\"Can't retry tasks.demo[97f47a98-f12a-4745-864e-deb99b9d5ab5] args:('user', 'password') kwargs:{'password': 'secretvalue'}\",)\r\nTraceback (most recent call last):\r\n  File \"/Users/20010116/.pyenv/versions/3.6.10/envs/venv-test-flaskit-new/lib/python3.6/site-packages/celery/app/trace.py\", line 385, in trace_task\r\n    R = retval = fun(*args, **kwargs)\r\n  File \"/Users/20010116/.pyenv/versions/3.6.10/envs/venv-test-flaskit-new/lib/python3.6/site-packages/celery/app/trace.py\", line 650, in __protected_call__\r\n    return self.run(*args, **kwargs)\r\n  File \"/Users/20010116/Documents/Workspace/beapi--flaskit-snow-demo/tasks.py\", line 12, in demo\r\n    raise self.retry(max_retries=1)\r\n  File \"/Users/20010116/.pyenv/versions/3.6.10/envs/venv-test-flaskit-new/lib/python3.6/site-packages/celery/app/task.py\", line 708, in retry\r\n    ), task_args=S.args, task_kwargs=S.kwargs\r\ncelery.exceptions.MaxRetriesExceededError: Can't retry tasks.demo[97f47a98-f12a-4745-864e-deb99b9d5ab5] args:('user', 'password') kwargs:{'password': 'secretvalue'}\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6083", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6083/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6083/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6083/events", "html_url": "https://github.com/celery/celery/issues/6083", "id": 616479947, "node_id": "MDU6SXNzdWU2MTY0Nzk5NDc=", "number": 6083, "title": "celery containers exits imeediately with apache superset", "user": {"login": "billy-odera", "id": 12785557, "node_id": "MDQ6VXNlcjEyNzg1NTU3", "avatar_url": "https://avatars3.githubusercontent.com/u/12785557?v=4", "gravatar_id": "", "url": "https://api.github.com/users/billy-odera", "html_url": "https://github.com/billy-odera", "followers_url": "https://api.github.com/users/billy-odera/followers", "following_url": "https://api.github.com/users/billy-odera/following{/other_user}", "gists_url": "https://api.github.com/users/billy-odera/gists{/gist_id}", "starred_url": "https://api.github.com/users/billy-odera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/billy-odera/subscriptions", "organizations_url": "https://api.github.com/users/billy-odera/orgs", "repos_url": "https://api.github.com/users/billy-odera/repos", "events_url": "https://api.github.com/users/billy-odera/events{/privacy}", "received_events_url": "https://api.github.com/users/billy-odera/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-12T08:52:07Z", "updated_at": "2020-05-15T05:44:20Z", "closed_at": "2020-05-15T05:43:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am running superset with celery in docker using the below docker run to allow asynchronus calls\r\n\r\n> sudo docker run --detach -e REDIS_SERVER_IP=xxx.xxx.xx.xx -e REDIS_PASSWORD=myredispassword -e POSTGRES_SERVER_IP=xxx.xxx.xx.xx -e POSTGRES_PASSWORD=mypostgrespassword --volume $PWD:/etc/superset --volume $PWD:/var/lib/superset amancevice/superset celery worker --app=superset.sql_lab:celery_app --pool=gevent -Ofair\r\n\r\nbut the container exits immediately after starting and I ma unable to run sql queries in superset\r\n![image](https://user-images.githubusercontent.com/12785557/81662949-f78c2580-9446-11ea-8b92-0d6e6da9a95b.png)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6082", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6082/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6082/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6082/events", "html_url": "https://github.com/celery/celery/issues/6082", "id": 615832160, "node_id": "MDU6SXNzdWU2MTU4MzIxNjA=", "number": 6082, "title": "Retry kwargs expansion BUG", "user": {"login": "Ixiodor", "id": 21291221, "node_id": "MDQ6VXNlcjIxMjkxMjIx", "avatar_url": "https://avatars1.githubusercontent.com/u/21291221?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ixiodor", "html_url": "https://github.com/Ixiodor", "followers_url": "https://api.github.com/users/Ixiodor/followers", "following_url": "https://api.github.com/users/Ixiodor/following{/other_user}", "gists_url": "https://api.github.com/users/Ixiodor/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ixiodor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ixiodor/subscriptions", "organizations_url": "https://api.github.com/users/Ixiodor/orgs", "repos_url": "https://api.github.com/users/Ixiodor/repos", "events_url": "https://api.github.com/users/Ixiodor/events{/privacy}", "received_events_url": "https://api.github.com/users/Ixiodor/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-11T12:04:42Z", "updated_at": "2020-05-16T04:58:06Z", "closed_at": "2020-05-16T04:57:55Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [ ] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n\r\n        \"Celery task conf\"\r\n        def a_method(param1, param2, **kwargs):\r\n            '''\r\n            First time get executed, second time dosn't\r\n            :return: \r\n            '''\r\n            print(param1)\r\n            print(param2)\r\n            self.retry(kwargs=kwargs, countdown=15)\r\n            \r\n        my_dict_params = {\"param1\": \"1\",\r\n                          \"param2\": \"2\"}\r\n\r\n        app.a_method(my_dict_params).delay()\r\n```\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nI expect retry do parameters expansion as the first normal call.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->Celery correcly saves \"kwargs\" state but on retry execution dosn't expand the kwargs arguments, asking for \"positional arguments\".\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6080", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6080/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6080/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6080/events", "html_url": "https://github.com/celery/celery/issues/6080", "id": 615114579, "node_id": "MDU6SXNzdWU2MTUxMTQ1Nzk=", "number": 6080, "title": "I have problem with celery beat on windows 10 ", "user": {"login": "fatemehloni", "id": 40351939, "node_id": "MDQ6VXNlcjQwMzUxOTM5", "avatar_url": "https://avatars1.githubusercontent.com/u/40351939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fatemehloni", "html_url": "https://github.com/fatemehloni", "followers_url": "https://api.github.com/users/fatemehloni/followers", "following_url": "https://api.github.com/users/fatemehloni/following{/other_user}", "gists_url": "https://api.github.com/users/fatemehloni/gists{/gist_id}", "starred_url": "https://api.github.com/users/fatemehloni/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fatemehloni/subscriptions", "organizations_url": "https://api.github.com/users/fatemehloni/orgs", "repos_url": "https://api.github.com/users/fatemehloni/repos", "events_url": "https://api.github.com/users/fatemehloni/events{/privacy}", "received_events_url": "https://api.github.com/users/fatemehloni/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-09T07:28:23Z", "updated_at": "2020-05-09T09:42:38Z", "closed_at": "2020-05-09T09:42:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "I try to run celery on windows 10,\r\nI use python 2.7+ flask and celery version=4.1.0 \r\nI run below comment for celery beat:\r\n'celery -A app.celery beat'\r\n\r\nand I faced with this error:\r\n\"[2020-05-09 11:56:51,474: ERROR/MainProcess] beat: Connection error: [Errno 10061] No connection could be made because the target machine actively refused it.\"\r\n\r\nrabbitmq and redis are start and I tried some of solution but problem did not solved yet:((\r\n\r\nplease get me advice.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6076", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6076/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6076/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6076/events", "html_url": "https://github.com/celery/celery/issues/6076", "id": 613013529, "node_id": "MDU6SXNzdWU2MTMwMTM1Mjk=", "number": 6076, "title": "Revoked LimitedSet add/update not respecting TTL/expires consistently", "user": {"login": "jheld", "id": 828813, "node_id": "MDQ6VXNlcjgyODgxMw==", "avatar_url": "https://avatars2.githubusercontent.com/u/828813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jheld", "html_url": "https://github.com/jheld", "followers_url": "https://api.github.com/users/jheld/followers", "following_url": "https://api.github.com/users/jheld/following{/other_user}", "gists_url": "https://api.github.com/users/jheld/gists{/gist_id}", "starred_url": "https://api.github.com/users/jheld/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jheld/subscriptions", "organizations_url": "https://api.github.com/users/jheld/orgs", "repos_url": "https://api.github.com/users/jheld/repos", "events_url": "https://api.github.com/users/jheld/events{/privacy}", "received_events_url": "https://api.github.com/users/jheld/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 4, "created_at": "2020-05-06T02:42:34Z", "updated_at": "2020-05-24T01:53:58Z", "closed_at": "2020-05-24T00:11:06Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\nPlease fill this template entirely and do not erase parts of it.\nWe reserve the right to close without a response\nbug reports which are incomplete.\n-->\n# Checklist\n<!--\nTo check an item on the list replace [ ] with [x].\n-->\n- [x] I have verified that the issue exists against the `master` branch of Celery.\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\n- [x] I have read the relevant section in the\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\n  on reporting bugs.\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\n  for similar or identical bug reports.\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\n  for existing proposed fixes.\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\n  to find out if the bug was already fixed in the master branch.\n- [x] I have included all related issues and possible duplicate issues\n  in this issue (If there are none, check this box anyway).\n\n## Mandatory Debugging Information\n\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\n    (if you are not able to do this, then at least specify the Celery\n     version affected).\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\n- [ ] I have included the contents of ``pip freeze`` in the issue.\n- [ ] I have included all the versions of all the external dependencies required\n  to reproduce this bug.\n\n## Optional Debugging Information\n<!--\nTry some of the below if you think they are relevant.\nIt will help us figure out the scope of the bug and how many users it affects.\n-->\n- [ ] I have tried reproducing the issue on more than one Python version\n  and/or implementation.\n- [ ] I have tried reproducing the issue on more than one message broker and/or\n  result backend.\n- [ ] I have tried reproducing the issue on more than one version of the message\n  broker and/or result backend.\n- [ ] I have tried reproducing the issue on more than one operating system.\n- [ ] I have tried reproducing the issue on more than one workers pool.\n- [ ] I have tried reproducing the issue with autoscaling, retries,\n  ETA/Countdown & rate limits disabled.\n- [ ] I have tried reproducing the issue after downgrading\n  and/or upgrading Celery and its dependencies.\n\n## Related Issues and Possible Duplicates\n<!--\nPlease make sure to search and mention any related issues\nor possible duplicates to this issue as requested by the checklist above.\n\nThis may or may not include issues in other repositories that the Celery project\nmaintains or other repositories that are dependencies of Celery.\n\nIf you don't know how to mention issues, please refer to Github's documentation\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\n-->\n\n#### Related Issues\n\n- None\n\n#### Possible Duplicates\n\n- None\n\n## Environment & Settings\n<!-- Include the contents of celery --version below -->\n**Celery version**:\n<!-- Include the output of celery -A proj report below -->\n<details>\n<summary><b><code>celery report</code> Output:</b></summary>\n<p>\n\n```\n```\n\n</p>\n</details>\n\n# Steps to Reproduce\n\n## Required Dependencies\n<!-- Please fill the required dependencies to reproduce this issue -->\n* **Minimal Python Version**: N/A or Unknown\n* **Minimal Celery Version**: N/A or Unknown\n* **Minimal Kombu Version**: N/A or Unknown\n* **Minimal Broker Version**: N/A or Unknown\n* **Minimal Result Backend Version**: N/A or Unknown\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\n* **Minimal Broker Client Version**: N/A or Unknown\n* **Minimal Result Backend Client Version**: N/A or Unknown\n\n### Python Packages\n<!-- Please fill the contents of pip freeze below -->\n<details>\n<summary><b><code>pip freeze</code> Output:</b></summary>\n<p>\n\n```\n```\n\n</p>\n</details>\n\n### Other Dependencies\n<!--\nPlease provide system dependencies, configuration files\nand other dependency information if applicable\n-->\n<details>\n<p>\nN/A\n</p>\n</details>\n\n## Minimally Reproducible Test Case\n<!--\nPlease provide a reproducible test case.\nRefer to the Reporting Bugs section in our contribution guide.\n\nWe prefer submitting test cases in the form of a PR to our integration test suite.\nIf you can provide one, please mention the PR number below.\nIf not, please attach the most minimal code example required to reproduce the issue below.\nIf the test case is too large, please include a link to a gist or a repository below.\n-->\n\n<details>\n<p>\n\n```python\n```\n\n</p>\n</details>\n\n# Expected Behavior\n<!-- Describe in detail what you expect to happen -->\n\nWhen a task is revoked and/or worker is mingling and receives revoked task data, when adding or updating it's store with the new info, it should always purge it's data (let the purge function do it's job by asking the data to decide which IDs have expired and should be discarded). It doesn't seem clear to me why this isn't the case (rational/history, etc).\n\n\n\n# Actual Behavior\n<!--\nDescribe in detail what actually happened.\nPlease include a backtrace and surround it with triple backticks (```).\nIn addition, include the Celery daemon logs, the broker logs,\nthe result backend logs and system logs below if they will help us debug\nthe issue.\n-->\n\n\nWhen revoking a task (whether by expiration or some other process/control), the documentation for the data structure on each worker holding the revoked task IDs says that when adding a task to it, if the maxlen is reached, or other items have reached expiration, those respective items will be removed from the LimitedSet data structure.\n\n\nDocs for the LimitedSet arguments (specifically on expires): https://docs.celeryproject.org/en/stable/internals/reference/celery.utils.collections.html#celery.utils.collections.LimitedSet say that when an item is added, items that should be expired will be. The add docs only mention maxlen logic being applied, for when purge is internally called. Now, I understand why this check is made, but it also leads to a bug where we're waiting (for who knows how long), for the next task to be revoked...and eventually we hope to reach the max, or another worker will come online and force us to update our set, and that method will do the proper thing, in a _small_/_wishful_ thinking number of cases. It only works well (on revoke sharing and general revocation) if maxlen is reached.\n\nBug in the docs and in the source code for the logic in add: https://docs.celeryproject.org/en/stable/internals/reference/celery.utils.collections.html#celery.utils.collections.LimitedSet.add (the source code for `add` only purges if maxlen is hit).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6074", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6074/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6074/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6074/events", "html_url": "https://github.com/celery/celery/issues/6074", "id": 612323768, "node_id": "MDU6SXNzdWU2MTIzMjM3Njg=", "number": 6074, "title": "Is MongoDB suported as result backend?", "user": {"login": "rafaelreuber", "id": 127780, "node_id": "MDQ6VXNlcjEyNzc4MA==", "avatar_url": "https://avatars1.githubusercontent.com/u/127780?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rafaelreuber", "html_url": "https://github.com/rafaelreuber", "followers_url": "https://api.github.com/users/rafaelreuber/followers", "following_url": "https://api.github.com/users/rafaelreuber/following{/other_user}", "gists_url": "https://api.github.com/users/rafaelreuber/gists{/gist_id}", "starred_url": "https://api.github.com/users/rafaelreuber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rafaelreuber/subscriptions", "organizations_url": "https://api.github.com/users/rafaelreuber/orgs", "repos_url": "https://api.github.com/users/rafaelreuber/repos", "events_url": "https://api.github.com/users/rafaelreuber/events{/privacy}", "received_events_url": "https://api.github.com/users/rafaelreuber/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1028707666, "node_id": "MDU6TGFiZWwxMDI4NzA3NjY2", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Documentation", "name": "Category: Documentation", "color": "f9dd5e", "default": false, "description": ""}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 1, "created_at": "2020-05-05T04:10:16Z", "updated_at": "2020-05-08T02:32:59Z", "closed_at": "2020-05-08T02:32:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The [documentation](https://docs.celeryproject.org/en/stable/userguide/configuration.html#task-result-backend-settings) about result backend settings does not shows MongoDB as a suported option.\r\n\r\nThe options available are:\r\n* rpc\r\n* database (SQLAlchemy)\r\n* redis\r\n* cache\r\n* cassandra\r\n* elasticsearch\r\n* ironcache\r\n* couchbase\r\n* arangodb\r\n* couchdb\r\n* cosmosdbsql (experimental)\r\n* filesystem\r\n* consul\r\n* azureblockblob\r\n* s3", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6062", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6062/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6062/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6062/events", "html_url": "https://github.com/celery/celery/issues/6062", "id": 610269712, "node_id": "MDU6SXNzdWU2MTAyNjk3MTI=", "number": 6062, "title": "Multiple Database Connections Django [Question]  ", "user": {"login": "vitormhenrique", "id": 3967383, "node_id": "MDQ6VXNlcjM5NjczODM=", "avatar_url": "https://avatars3.githubusercontent.com/u/3967383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vitormhenrique", "html_url": "https://github.com/vitormhenrique", "followers_url": "https://api.github.com/users/vitormhenrique/followers", "following_url": "https://api.github.com/users/vitormhenrique/following{/other_user}", "gists_url": "https://api.github.com/users/vitormhenrique/gists{/gist_id}", "starred_url": "https://api.github.com/users/vitormhenrique/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vitormhenrique/subscriptions", "organizations_url": "https://api.github.com/users/vitormhenrique/orgs", "repos_url": "https://api.github.com/users/vitormhenrique/repos", "events_url": "https://api.github.com/users/vitormhenrique/events{/privacy}", "received_events_url": "https://api.github.com/users/vitormhenrique/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-30T17:47:48Z", "updated_at": "2020-05-15T05:46:07Z", "closed_at": "2020-05-15T05:46:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Checklist\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug\r\n#### Related Issues\r\n\r\nhttps://github.com/celery/celery/issues/4116\r\n\r\nhttps://github.com/celery/celery/pull/4292\r\n\r\n# Environment & Settings\r\n4.3.0 (rhubarb):\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n\r\nsoftware -> celery:4.3.0 (rhubarb) kombu:4.5.0 py:3.8.2\r\n            billiard:3.6.3.0 py-amqp:2.5.2\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:4.15.0-88-generic imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:amqp results:amqp://guest:**@localhost//\r\n\r\nABSOLUTE_URL_OVERRIDES: {\r\n }\r\nACCOUNT_ADAPTER: 'lancium_box.users.adapters.AccountAdapter'\r\nACCOUNT_ALLOW_REGISTRATION: True\r\nACCOUNT_AUTHENTICATION_METHOD: 'username'\r\nACCOUNT_EMAIL_REQUIRED: True\r\nACCOUNT_EMAIL_VERIFICATION: 'mandatory'\r\nACCOUNT_FORMS: {\r\n 'login': 'lancium_box.users.forms.CustomLoginForm'}\r\nADMINS: [('Vitor de Miranda Henrique',\r\n  'vitor.henrique@lancium.com')]\r\nADMIN_URL: 'admin/'\r\nALLOWED_HOSTS: []\r\nAPPEND_SLASH: True\r\nAPPS_DIR: <Path:/home/skywalker/lancium_box/lancium_box>\r\nAUTHENTICATION_BACKENDS: ['lancium_box.users.auth_backends.CustomAuthenticationBackend',\r\n 'django.contrib.auth.backends.ModelBackend',\r\n 'allauth.account.auth_backends.AuthenticationBackend']\r\nAUTH_PASSWORD_VALIDATORS: '********'\r\nAUTH_USER_MODEL: 'users.User'\r\nCACHES: {\r\n    'default': {   'BACKEND': 'django_redis.cache.RedisCache',\r\n                   'LOCATION': 'redis://127.0.0.1:6379/1',\r\n                   'OPTIONS': {   'CLIENT_CLASS': 'django_redis.client.DefaultClient',\r\n                                  'IGNORE_EXCEPTIONS': True}}}\r\nCACHE_MIDDLEWARE_ALIAS: 'default'\r\nCACHE_MIDDLEWARE_KEY_PREFIX: '********'\r\nCACHE_MIDDLEWARE_SECONDS: 600\r\nCELERY_ACCEPT_CONTENT: ['json']\r\nCELERY_BROKER_URL: 'amqp://guest:********@localhost:5672//'\r\nCELERY_IMPORTS: ['lancium_box.monitoring.tasks']\r\nCELERY_RESULT_BACKEND: 'amqp://guest:********@localhost//'\r\nCELERY_RESULT_SERIALIZER: 'json'\r\nCELERY_TASK_SERIALIZER: 'json'\r\nCELERY_TASK_SOFT_TIME_LIMIT: 60\r\nCELERY_TASK_TIME_LIMIT: 300\r\nCELERY_TIMEZONE: 'UTC'\r\nCOMPRESSORS: {\r\n 'css': 'compressor.css.CssCompressor', 'js': 'compressor.js.JsCompressor'}\r\nCOMPRESS_CACHEABLE_PRECOMPILERS: \r\n    ()\r\nCOMPRESS_CACHE_BACKEND: 'default'\r\nCOMPRESS_CACHE_KEY_FUNCTION: '********'\r\nCOMPRESS_CLEAN_CSS_ARGUMENTS: ''\r\nCOMPRESS_CLEAN_CSS_BINARY: 'cleancss'\r\nCOMPRESS_CLOSURE_COMPILER_ARGUMENTS: ''\r\nCOMPRESS_CLOSURE_COMPILER_BINARY: 'java -jar compiler.jar'\r\nCOMPRESS_CSS_HASHING_METHOD: 'mtime'\r\nCOMPRESS_DATA_URI_MAX_SIZE: 1024\r\nCOMPRESS_DEBUG_TOGGLE: None\r\nCOMPRESS_ENABLED: True\r\nCOMPRESS_FILTERS: {\r\n    'css': ['compressor.filters.css_default.CssAbsoluteFilter'],\r\n    'js': ['compressor.filters.jsmin.JSMinFilter']}\r\nCOMPRESS_JINJA2_GET_ENVIRONMENT: <function CompressorConf.JINJA2_GET_ENVIRONMENT at 0x7f3a8e76fee0>\r\nCOMPRESS_MINT_DELAY: 30\r\nCOMPRESS_MTIME_DELAY: 10\r\nCOMPRESS_OFFLINE: True\r\nCOMPRESS_OFFLINE_CONTEXT: {\r\n 'STATIC_URL': '/static/'}\r\nCOMPRESS_OFFLINE_MANIFEST: 'manifest.json'\r\nCOMPRESS_OFFLINE_TIMEOUT: 31536000\r\nCOMPRESS_OUTPUT_DIR: 'CACHE'\r\nCOMPRESS_PARSER: 'compressor.parser.AutoSelectParser'\r\nCOMPRESS_PRECOMPILERS: \r\n    ()\r\nCOMPRESS_REBUILD_TIMEOUT: 2592000\r\nCOMPRESS_ROOT: '/home/skywalker/lancium_box/staticfiles'\r\nCOMPRESS_STORAGE: 'compressor.storage.GzipCompressorFileStorage'\r\nCOMPRESS_TEMPLATE_FILTER_CONTEXT: {\r\n 'STATIC_URL': '/static/'}\r\nCOMPRESS_URL: '/static/'\r\nCOMPRESS_URL_PLACEHOLDER: '/__compressor_url_placeholder__/'\r\nCOMPRESS_VERBOSE: False\r\nCOMPRESS_YUGLIFY_BINARY: 'yuglify'\r\nCOMPRESS_YUGLIFY_CSS_ARGUMENTS: '--terminal'\r\nCOMPRESS_YUGLIFY_JS_ARGUMENTS: '--terminal'\r\nCOMPRESS_YUI_BINARY: 'java -jar yuicompressor.jar'\r\nCOMPRESS_YUI_CSS_ARGUMENTS: ''\r\nCOMPRESS_YUI_JS_ARGUMENTS: ''\r\nCRISPY_TEMPLATE_PACK: 'bootstrap4'\r\nCSRF_COOKIE_AGE: 31449600\r\nCSRF_COOKIE_DOMAIN: None\r\nCSRF_COOKIE_HTTPONLY: True\r\nCSRF_COOKIE_NAME: 'csrftoken'\r\nCSRF_COOKIE_PATH: '/'\r\nCSRF_COOKIE_SAMESITE: 'Lax'\r\nCSRF_COOKIE_SECURE: False\r\nCSRF_FAILURE_VIEW: 'django.views.csrf.csrf_failure'\r\nCSRF_HEADER_NAME: 'HTTP_X_CSRFTOKEN'\r\nCSRF_TRUSTED_ORIGINS: []\r\nCSRF_USE_SESSIONS: False\r\nDATABASES: {\r\n    'default': {   'ATOMIC_REQUESTS': True,\r\n                   'AUTOCOMMIT': True,\r\n                   'CONN_MAX_AGE': None,\r\n                   'ENGINE': 'django.db.backends.postgresql',\r\n                   'HOST': '10.2.40.205',\r\n                   'NAME': 'lanciumdb',\r\n                   'OPTIONS': {},\r\n                   'PASSWORD': '********',\r\n                   'PORT': 5432,\r\n                   'TEST': {   'CHARSET': None,\r\n                               'COLLATION': None,\r\n                               'MIRROR': None,\r\n                               'NAME': None},\r\n                   'TIME_ZONE': None,\r\n                   'USER': 'lancium_user'}}\r\nDATABASE_ROUTERS: '********'\r\nDATACENTER_ROOM: None\r\nDATA_UPLOAD_MAX_MEMORY_SIZE: 2621440\r\nDATA_UPLOAD_MAX_NUMBER_FIELDS: 1000\r\nDATETIME_FORMAT: 'N j, Y, P'\r\nDATETIME_INPUT_FORMATS: ['%Y-%m-%d %H:%M:%S',\r\n '%Y-%m-%d %H:%M:%S.%f',\r\n '%Y-%m-%d %H:%M',\r\n '%Y-%m-%d',\r\n '%m/%d/%Y %H:%M:%S',\r\n '%m/%d/%Y %H:%M:%S.%f',\r\n '%m/%d/%Y %H:%M',\r\n '%m/%d/%Y',\r\n '%m/%d/%y %H:%M:%S',\r\n '%m/%d/%y %H:%M:%S.%f',\r\n '%m/%d/%y %H:%M',\r\n '%m/%d/%y']\r\nDATE_FORMAT: 'N j, Y'\r\nDATE_INPUT_FORMATS: ['%Y-%m-%d',\r\n '%m/%d/%Y',\r\n '%m/%d/%y',\r\n '%b %d %Y',\r\n '%b %d, %Y',\r\n '%d %b %Y',\r\n '%d %b, %Y',\r\n '%B %d %Y',\r\n '%B %d, %Y',\r\n '%d %B %Y',\r\n '%d %B, %Y']\r\nDEBUG: False\r\nDEBUG_PROPAGATE_EXCEPTIONS: False\r\nDECIMAL_SEPARATOR: '.'\r\nDEFAULT_CHARSET: 'utf-8'\r\nDEFAULT_CONTENT_TYPE: 'text/html'\r\nDEFAULT_EXCEPTION_REPORTER_FILTER: 'django.views.debug.SafeExceptionReporterFilter'\r\nDEFAULT_FILE_STORAGE: 'django.core.files.storage.FileSystemStorage'\r\nDEFAULT_FROM_EMAIL: 'Smart Response <noreply@lancium.com>'\r\nDEFAULT_INDEX_TABLESPACE: ''\r\nDEFAULT_TABLESPACE: ''\r\nDISABLE_DASHBOARD: False\r\nDISALLOWED_USER_AGENTS: []\r\nDJANGO_APPS: ['django.contrib.auth',\r\n 'django.contrib.contenttypes',\r\n 'django.contrib.sessions',\r\n 'django.contrib.sites',\r\n 'django.contrib.messages',\r\n 'django.contrib.staticfiles',\r\n 'django.contrib.humanize',\r\n 'django.contrib.admin']\r\nEMAIL_BACKEND: 'django.core.mail.backends.smtp.EmailBackend'\r\nEMAIL_HOST: 'smtp.gmail.com'\r\nEMAIL_PORT: 587\r\nEMAIL_SSL_CERTFILE: None\r\nEMAIL_SSL_KEYFILE: '********'\r\nEMAIL_SUBJECT_PREFIX: '[Smart Response]'\r\nEMAIL_TIMEOUT: 10\r\nEMAIL_USE_LOCALTIME: False\r\nEMAIL_USE_SSL: False\r\nEMAIL_USE_TLS: True\r\nFILE_CHARSET: 'utf-8'\r\nFILE_UPLOAD_DIRECTORY_PERMISSIONS: None\r\nFILE_UPLOAD_HANDLERS: ['django.core.files.uploadhandler.MemoryFileUploadHandler',\r\n 'django.core.files.uploadhandler.TemporaryFileUploadHandler']\r\nFILE_UPLOAD_MAX_MEMORY_SIZE: 2621440\r\nFILE_UPLOAD_PERMISSIONS: None\r\nFILE_UPLOAD_TEMP_DIR: None\r\nFIRST_DAY_OF_WEEK: 0\r\nFIXTURE_DIRS: \r\n    ('/home/skywalker/lancium_box/lancium_box/fixtures',)\r\nFORCE_SCRIPT_NAME: None\r\nFORMAT_MODULE_PATH: None\r\nFORM_RENDERER: 'django.forms.renderers.DjangoTemplates'\r\nIGNORABLE_404_URLS: []\r\nINSTALLED_APPS: ['django.contrib.auth',\r\n 'django.contrib.contenttypes',\r\n 'django.contrib.sessions',\r\n 'django.contrib.sites',\r\n 'django.contrib.messages',\r\n 'django.contrib.staticfiles',\r\n 'django.contrib.humanize',\r\n 'django.contrib.admin',\r\n 'crispy_forms',\r\n 'allauth',\r\n 'allauth.account',\r\n 'allauth.socialaccount',\r\n 'rest_framework',\r\n 'rest_framework.authtoken',\r\n 'django_celery_beat',\r\n 'sekizai',\r\n 'lancium_box.users.apps.UsersConfig',\r\n 'lancium_box.datacenter.apps.DatacenterConfig',\r\n 'lancium_box.monitoring.apps.MonitoringConfig',\r\n 'lancium_box.cryptocurrency.apps.CryptocurrencyConfig',\r\n 'lancium_box.dashboard.apps.DashboardConfig',\r\n 'lancium_box.remotebox.apps.RemoteboxConfig',\r\n 'lancium_box.api.apps.ApiConfig',\r\n 'lancium_box.event.apps.EventConfig',\r\n 'lancium_box.control.apps.ControlConfig',\r\n 'lancium_box.demand_response.apps.DemandResponseConfig',\r\n 'lancium_box.inventory.apps.InventoryConfig',\r\n 'compressor']\r\nINTERNAL_IPS: []\r\nLANGUAGES: [('af', 'Afrikaans'),\r\n ('ar', 'Arabic'),\r\n ('ast', 'Asturian'),\r\n ('az', 'Azerbaijani'),\r\n ('bg', 'Bulgarian'),\r\n ('be', 'Belarusian'),\r\n ('bn', 'Bengali'),\r\n ('br', 'Breton'),\r\n ('bs', 'Bosnian'),\r\n ('ca', 'Catalan'),\r\n ('cs', 'Czech'),\r\n ('cy', 'Welsh'),\r\n ('da', 'Danish'),\r\n ('de', 'German'),\r\n ('dsb', 'Lower Sorbian'),\r\n ('el', 'Greek'),\r\n ('en', 'English'),\r\n ('en-au', 'Australian English'),\r\n ('en-gb', 'British English'),\r\n ('eo', 'Esperanto'),\r\n ('es', 'Spanish'),\r\n ('es-ar', 'Argentinian Spanish'),\r\n ('es-co', 'Colombian Spanish'),\r\n ('es-mx', 'Mexican Spanish'),\r\n ('es-ni', 'Nicaraguan Spanish'),\r\n ('es-ve', 'Venezuelan Spanish'),\r\n ('et', 'Estonian'),\r\n ('eu', 'Basque'),\r\n ('fa', 'Persian'),\r\n ('fi', 'Finnish'),\r\n ('fr', 'French'),\r\n ('fy', 'Frisian'),\r\n ('ga', 'Irish'),\r\n ('gd', 'Scottish Gaelic'),\r\n ('gl', 'Galician'),\r\n ('he', 'Hebrew'),\r\n ('hi', 'Hindi'),\r\n ('hr', 'Croatian'),\r\n ('hsb', 'Upper Sorbian'),\r\n ('hu', 'Hungarian'),\r\n ('hy', 'Armenian'),\r\n ('ia', 'Interlingua'),\r\n ('id', 'Indonesian'),\r\n ('io', 'Ido'),\r\n ('is', 'Icelandic'),\r\n ('it', 'Italian'),\r\n ('ja', 'Japanese'),\r\n ('ka', 'Georgian'),\r\n ('kab', 'Kabyle'),\r\n ('kk', 'Kazakh'),\r\n ('km', 'Khmer'),\r\n ('kn', 'Kannada'),\r\n ('ko', 'Korean'),\r\n ('lb', 'Luxembourgish'),\r\n ('lt', 'Lithuanian'),\r\n ('lv', 'Latvian'),\r\n ('mk', 'Macedonian'),\r\n ('ml', 'Malayalam'),\r\n ('mn', 'Mongolian'),\r\n ('mr', 'Marathi'),\r\n ('my', 'Burmese'),\r\n ('nb', 'Norwegian Bokm\u00e5l'),\r\n ('ne', 'Nepali'),\r\n ('nl', 'Dutch'),\r\n ('nn', 'Norwegian Nynorsk'),\r\n ('os', 'Ossetic'),\r\n ('pa', 'Punjabi'),\r\n ('pl', 'Polish'),\r\n ('pt', 'Portuguese'),\r\n ('pt-br', 'Brazilian Portuguese'),\r\n ('ro', 'Romanian'),\r\n ('ru', 'Russian'),\r\n ('sk', 'Slovak'),\r\n ('sl', 'Slovenian'),\r\n ('sq', 'Albanian'),\r\n ('sr', 'Serbian'),\r\n ('sr-latn', 'Serbian Latin'),\r\n ('sv', 'Swedish'),\r\n ('sw', 'Swahili'),\r\n ('ta', 'Tamil'),\r\n ('te', 'Telugu'),\r\n ('th', 'Thai'),\r\n ('tr', 'Turkish'),\r\n ('tt', 'Tatar'),\r\n ('udm', 'Udmurt'),\r\n ('uk', 'Ukrainian'),\r\n ('ur', 'Urdu'),\r\n ('vi', 'Vietnamese'),\r\n ('zh-hans', 'Simplified Chinese'),\r\n ('zh-hant', 'Traditional Chinese')]\r\nLANGUAGES_BIDI: ['he', 'ar', 'fa', 'ur']\r\nLANGUAGE_CODE: 'en-us'\r\nLANGUAGE_COOKIE_AGE: None\r\nLANGUAGE_COOKIE_DOMAIN: None\r\nLANGUAGE_COOKIE_NAME: 'django_language'\r\nLANGUAGE_COOKIE_PATH: '/'\r\nLOCALE_PATHS: [<Path:/home/skywalker/lancium_box/locale>]\r\nLOCAL_APPS: ['lancium_box.users.apps.UsersConfig',\r\n 'lancium_box.datacenter.apps.DatacenterConfig',\r\n 'lancium_box.monitoring.apps.MonitoringConfig',\r\n 'lancium_box.cryptocurrency.apps.CryptocurrencyConfig',\r\n 'lancium_box.dashboard.apps.DashboardConfig',\r\n 'lancium_box.remotebox.apps.RemoteboxConfig',\r\n 'lancium_box.api.apps.ApiConfig',\r\n 'lancium_box.event.apps.EventConfig',\r\n 'lancium_box.control.apps.ControlConfig',\r\n 'lancium_box.demand_response.apps.DemandResponseConfig',\r\n 'lancium_box.inventory.apps.InventoryConfig']\r\nLOGGING: {\r\n    'disable_existing_loggers': False,\r\n    'filters': {   'require_debug_false': {   '()': 'django.utils.log.RequireDebugFalse'}},\r\n    'formatters': {   'verbose': {   'format': '%(levelname)s %(asctime)s '\r\n                                               '%(module)s %(process)d '\r\n                                               '%(thread)d %(message)s'}},\r\n    'handlers': {   'console': {   'class': 'logging.StreamHandler',\r\n                                   'formatter': 'verbose',\r\n                                   'level': 'DEBUG'},\r\n                    'mail_admins': {   'class': 'django.utils.log.AdminEmailHandler',\r\n                                       'filters': ['require_debug_false'],\r\n                                       'level': 'ERROR'}},\r\n    'loggers': {   'django.request': {   'handlers': ['mail_admins'],\r\n                                         'level': 'ERROR',\r\n                                         'propagate': True},\r\n                   'django.security.DisallowedHost': {   'handlers': [   'console',\r\n                                                                         'mail_admins'],\r\n                                                         'level': 'ERROR',\r\n                                                         'propagate': True}},\r\n    'root': {'handlers': ['console'], 'level': 'INFO'},\r\n    'version': 1}\r\nLOGGING_CONFIG: 'logging.config.dictConfig'\r\nLOGIN_REDIRECT_URL: 'users:redirect'\r\nLOGIN_URL: 'account_login'\r\nLOGOUT_REDIRECT_URL: None\r\nMANAGERS: [('Vitor de Miranda Henrique',\r\n  'vitor.henrique@lancium.com')]\r\nMEDIA_ROOT: '/home/skywalker/lancium_box/lancium_box/media'\r\nMEDIA_URL: '/media/'\r\nMESSAGE_STORAGE: 'django.contrib.messages.storage.fallback.FallbackStorage'\r\nMIDDLEWARE: ['whitenoise.middleware.WhiteNoiseMiddleware',\r\n 'django.contrib.sessions.middleware.SessionMiddleware',\r\n 'django.middleware.locale.LocaleMiddleware',\r\n 'django.middleware.common.CommonMiddleware',\r\n 'django.middleware.csrf.CsrfViewMiddleware',\r\n 'django.contrib.auth.middleware.AuthenticationMiddleware',\r\n 'django.contrib.messages.middleware.MessageMiddleware',\r\n 'django.middleware.clickjacking.XFrameOptionsMiddleware']\r\nMIGRATION_MODULES: {\r\n 'sites': 'lancium_box.contrib.sites.migrations'}\r\nMONTH_DAY_FORMAT: 'F j'\r\nNUMBER_GROUPING: 0\r\nPASSWORD_HASHERS: '********'\r\nPASSWORD_RESET_TIMEOUT_DAYS: '********'\r\nPREPEND_WWW: False\r\nREAD_DOT_ENV_FILE: False\r\nREST_FRAMEWORK: {\r\n    'DEFAULT_AUTHENTICATION_CLASSES': [   'rest_framework.authentication.TokenAuthentication']}\r\nROOT_DIR: <Path:/home/skywalker/lancium_box>\r\nROOT_URLCONF: 'config.urls'\r\nSECRET_KEY: '********'\r\nSECURE_BROWSER_XSS_FILTER: True\r\nSECURE_CONTENT_TYPE_NOSNIFF: False\r\nSECURE_HSTS_INCLUDE_SUBDOMAINS: False\r\nSECURE_HSTS_PRELOAD: False\r\nSECURE_HSTS_SECONDS: 0\r\nSECURE_PROXY_SSL_HEADER: None\r\nSECURE_REDIRECT_EXEMPT: []\r\nSECURE_SSL_HOST: None\r\nSECURE_SSL_REDIRECT: False\r\nSERVER_EMAIL: 'Smart Response <noreply@lancium.com>'\r\nSESSION_CACHE_ALIAS: 'default'\r\nSESSION_COOKIE_AGE: 1209600\r\nSESSION_COOKIE_DOMAIN: None\r\nSESSION_COOKIE_HTTPONLY: True\r\nSESSION_COOKIE_NAME: 'sessionid'\r\nSESSION_COOKIE_PATH: '/'\r\nSESSION_COOKIE_SAMESITE: 'Lax'\r\nSESSION_COOKIE_SECURE: False\r\nSESSION_ENGINE: 'django.contrib.sessions.backends.db'\r\nSESSION_EXPIRE_AT_BROWSER_CLOSE: False\r\nSESSION_FILE_PATH: None\r\nSESSION_SAVE_EVERY_REQUEST: False\r\nSESSION_SERIALIZER: 'django.contrib.sessions.serializers.JSONSerializer'\r\nSETTINGS_MODULE: 'config.settings.production'\r\nSHORT_DATETIME_FORMAT: 'm/d/Y P'\r\nSHORT_DATE_FORMAT: 'm/d/Y'\r\nSIGNING_BACKEND: 'django.core.signing.TimestampSigner'\r\nSILENCED_SYSTEM_CHECKS: []\r\nSITE_ID: 1\r\nSOCIALACCOUNT_ADAPTER: 'lancium_box.users.adapters.SocialAccountAdapter'\r\nSTATICFILES_DIRS: ['/home/skywalker/lancium_box/lancium_box/static']\r\nSTATICFILES_FINDERS: ['django.contrib.staticfiles.finders.FileSystemFinder',\r\n 'django.contrib.staticfiles.finders.AppDirectoriesFinder',\r\n 'compressor.finders.CompressorFinder']\r\nSTATICFILES_STORAGE: 'whitenoise.storage.CompressedManifestStaticFilesStorage'\r\nSTATIC_ROOT: '/home/skywalker/lancium_box/staticfiles'\r\nSTATIC_URL: '/static/'\r\nTEMPLATES: [{'BACKEND': 'django.template.backends.django.DjangoTemplates',\r\n  'DIRS': ['/home/skywalker/lancium_box/lancium_box/templates'],\r\n  'OPTIONS': {'context_processors': ['django.template.context_processors.debug',\r\n                                     'django.template.context_processors.request',\r\n                                     'django.contrib.auth.context_processors.auth',\r\n                                     'django.template.context_processors.i18n',\r\n                                     'django.template.context_processors.media',\r\n                                     'django.template.context_processors.static',\r\n                                     'django.template.context_processors.tz',\r\n                                     'django.contrib.messages.context_processors.messages',\r\n                                     'lancium_box.utils.context_processors.settings_context',\r\n                                     'sekizai.context_processors.sekizai'],\r\n              'loaders': [('django.template.loaders.cached.Loader',\r\n                           ['django.template.loaders.filesystem.Loader',\r\n                            'django.template.loaders.app_directories.Loader'])]}}]\r\nTEST_NON_SERIALIZED_APPS: []\r\nTEST_RUNNER: 'django.test.runner.DiscoverRunner'\r\nTHIRD_PARTY_APPS: ['crispy_forms',\r\n 'allauth',\r\n 'allauth.account',\r\n 'allauth.socialaccount',\r\n 'rest_framework',\r\n 'rest_framework.authtoken',\r\n 'django_celery_beat',\r\n 'sekizai']\r\nTHOUSAND_SEPARATOR: ','\r\nTIME_FORMAT: 'P'\r\nTIME_INPUT_FORMATS: ['%H:%M:%S', '%H:%M:%S.%f', '%H:%M']\r\nTIME_ZONE: 'UTC'\r\nUSE_I18N: True\r\nUSE_L10N: True\r\nUSE_THOUSAND_SEPARATOR: False\r\nUSE_TZ: True\r\nUSE_X_FORWARDED_HOST: False\r\nUSE_X_FORWARDED_PORT: False\r\nWSGI_APPLICATION: 'config.wsgi.application'\r\nX_FRAME_OPTIONS: 'DENY'\r\nYEAR_MONTH_FORMAT: 'F Y'\r\nis_overridden: <bound method Settings.is_overridden of <Settings \"config.settings.production\">>\r\n\r\n\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\nHello everyone, \r\n\r\nOn my project I have 5 workers on running that periodically check or insert data on database (postgress) every 5 seconds . My problem is that celery is opening too many connections to the database. I can see at least 20 connections for the same tasks hitting the database. \r\n\r\nIs there way to improve this with Django? I tried setting up `CONN_MAX_AGE = None`  on django, to have the database persist the same connection but that didn't help.\r\n\r\nI also saw a pull request and some comments on reuse the database on previous mentioned issues but they were reverted because they caused regression problems.\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\namqp==2.5.2\r\nargon2-cffi==19.2.0\r\nbcrypt==3.1.7\r\nbeautifulsoup4==4.7.1\r\nbilliard==3.6.3.0\r\nblockchain==1.4.4\r\nboto3==1.12.47\r\nbotocore==1.15.47\r\ncelery==4.3.0\r\ncertifi==2020.4.5.1\r\ncffi==1.14.0\r\nchardet==3.0.4\r\ncoreapi==2.3.3\r\ncoreschema==0.0.4\r\ncryptography==2.9.2\r\ndefusedxml==0.6.0\r\nDjango==2.2.8\r\ndjango-allauth==0.40.0\r\ndjango-anymail==7.0.0\r\ndjango-appconf==1.0.4\r\ndjango-celery-beat==1.5.0\r\ndjango-classy-tags==0.8.0\r\ndjango-compressor==2.3\r\ndjango-crispy-forms==1.8.1\r\ndjango-environ==0.4.5\r\ndjango-model-utils==3.2.0\r\ndjango-pandas==0.6.0\r\ndjango-redis==4.10.0\r\ndjango-sekizai==1.0.0\r\ndjango-storages==1.9.1\r\ndjango-timezone-field==4.0\r\ndjangorestframework==3.10.3\r\ndocutils==0.15.2\r\nenum-compat==0.0.3\r\net-xmlfile==1.0.1\r\nfuture==0.18.2\r\ngevent==20.4.0\r\ngreenlet==0.4.15\r\ngunicorn==20.0.4\r\nidna==2.8\r\nitypes==1.2.0\r\njdcal==1.4.1\r\nJinja2==2.11.2\r\njmespath==0.9.5\r\nkombu==4.5.0\r\nMarkupSafe==1.1.1\r\nnumpy==1.16.2\r\noauthlib==3.1.0\r\nopenpyxl==2.6.3\r\npandas==0.24.2\r\nparallel-ssh==1.9.1\r\nparamiko==2.7.1\r\nPillow==6.2.1\r\npsycopg2-binary==2.8.4\r\npycparser==2.20\r\npyModbusTCP==0.1.8\r\nPyNaCl==1.3.0\r\npysftp==0.2.9\r\npython-crontab==2.4.2\r\npython-dateutil==2.8.0\r\npython-slugify==4.0.0\r\npython3-openid==3.1.0\r\npytz==2019.3\r\nrcssmin==1.0.6\r\nredis==3.3.11\r\nrequests==2.21.0\r\nrequests-oauthlib==1.3.0\r\nrjsmin==1.1.0\r\ns3transfer==0.3.3\r\nsix==1.14.0\r\nsoupsieve==2.0\r\nsqlparse==0.3.1\r\nssh2-python==0.18.0.post1\r\ntext-unidecode==1.3\r\nuritemplate==3.0.1\r\nurllib3==1.24.3\r\nvine==1.3.0\r\nwhitenoise==4.1.4\r\n\r\n</p>\r\n</details>\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6060", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6060/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6060/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6060/events", "html_url": "https://github.com/celery/celery/issues/6060", "id": 608637284, "node_id": "MDU6SXNzdWU2MDg2MzcyODQ=", "number": 6060, "title": "Version 4.4.2 doesn't include 4.4.2 changes ", "user": {"login": "alexagriffith", "id": 43711982, "node_id": "MDQ6VXNlcjQzNzExOTgy", "avatar_url": "https://avatars0.githubusercontent.com/u/43711982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexagriffith", "html_url": "https://github.com/alexagriffith", "followers_url": "https://api.github.com/users/alexagriffith/followers", "following_url": "https://api.github.com/users/alexagriffith/following{/other_user}", "gists_url": "https://api.github.com/users/alexagriffith/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexagriffith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexagriffith/subscriptions", "organizations_url": "https://api.github.com/users/alexagriffith/orgs", "repos_url": "https://api.github.com/users/alexagriffith/repos", "events_url": "https://api.github.com/users/alexagriffith/events{/privacy}", "received_events_url": "https://api.github.com/users/alexagriffith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-28T21:47:35Z", "updated_at": "2020-04-28T21:58:17Z", "closed_at": "2020-04-28T21:58:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\nThe 4.4.2 version does not include the 4.4.2 changes. When SSL connections were failing, I checked. It seems like the zip files do not reflect the commits. \r\n\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6054", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6054/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6054/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6054/events", "html_url": "https://github.com/celery/celery/issues/6054", "id": 604432428, "node_id": "MDU6SXNzdWU2MDQ0MzI0Mjg=", "number": 6054, "title": "I am a celery beginner, stuck in the very elementary usages... Cannot get into the task.delay()", "user": {"login": "perfumescent", "id": 31856209, "node_id": "MDQ6VXNlcjMxODU2MjA5", "avatar_url": "https://avatars0.githubusercontent.com/u/31856209?v=4", "gravatar_id": "", "url": "https://api.github.com/users/perfumescent", "html_url": "https://github.com/perfumescent", "followers_url": "https://api.github.com/users/perfumescent/followers", "following_url": "https://api.github.com/users/perfumescent/following{/other_user}", "gists_url": "https://api.github.com/users/perfumescent/gists{/gist_id}", "starred_url": "https://api.github.com/users/perfumescent/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/perfumescent/subscriptions", "organizations_url": "https://api.github.com/users/perfumescent/orgs", "repos_url": "https://api.github.com/users/perfumescent/repos", "events_url": "https://api.github.com/users/perfumescent/events{/privacy}", "received_events_url": "https://api.github.com/users/perfumescent/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-22T03:49:52Z", "updated_at": "2020-04-22T05:34:56Z", "closed_at": "2020-04-22T05:34:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [ ] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.2\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n(base) C:\\Users\\headmaster\\Desktop\\WEB>celery -A tasks report\r\n\r\nsoftware -> celery:4.4.2 (cliffs) kombu:4.6.8 py:3.7.4\r\n            billiard:3.6.3.0 redis:3.4.1\r\nplatform -> system:Windows arch:64bit, WindowsPE\r\n            kernel version:10 imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:redis results:redis://localhost:6379/1\r\n\r\nbroker_url: 'redis://localhost:6379/0'\r\nresult_backend: 'redis://localhost:6379/1'\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.7\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: win10\r\n* **Minimal Broker Client Version**:  Redis 3.2.100\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nI was trying to add Celery asychronized feature to my simple flask web project as a flask beginner. After managing to install and launching celery, redis and related python pip thing, I got struggling with the delay() in the very beginning. It seemed I could not even get into the delay(). I am so frustrated, could you help me please?\r\n\r\nI have app.py and tasks.py under my flask project. (At first I wrote everything in app.py, then I split the celery object out, which didn't help)\r\n\r\ntasks.py:\r\n```\r\nfrom celery import Celery\r\n\r\ncelery = Celery('app', broker='redis://localhost:6379/0', backend='redis://localhost:6379/1')\r\n\r\n\r\n@celery.task\r\ndef modeling_task():\r\n    print('yes')\r\n    \r\n```\r\n\r\napp.py:\r\n```\r\n@app.route('/train', methods=['GET', 'POST'])\r\ndef train():\r\n    if request.method == \"GET\":\r\n        return render_template('train.html')\r\n    else:  # when request POST\r\n        # check if the post request has the file part\r\n        if 'file' not in request.files:\r\n            return jsonify({\"code\": 500, \"status\": 'No file is uploaded!'})\r\n\r\n        if file and allowed_file(file.filename):\r\n            print(request.files['file'].filename)\r\n            print('before task')\r\n            task = modeling_task.delay()\r\n            print('after task')\r\n            \r\n            return jsonify({\"code\": 200, \"status\": 'model training', \"task_id\": task.id})\r\n\r\n        return 'Uploading file is wrong'\r\n```\r\n\r\nIf things work well, after the server receives a uploading file, the print results on console should be\r\n```\r\nCar_TEST.csv\r\nbefore task\r\nyes\r\nafter task\r\n```\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nHowever, the console result is simply this\r\n```\r\n * Detected change in 'C:\\\\Users\\\\headmaster\\\\Desktop\\\\WEB\\\\tasks.py', reloading\r\n * Restarting with stat\r\n * Debugger is active!\r\n * Debugger PIN: 308-608-393\r\n * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)\r\n127.0.0.1 - - [22/Apr/2020 11:39:22] \"GET /train HTTP/1.1\" 200 -\r\nCar_TEST.csv\r\nbefore task\r\n\r\n```\r\nand the server got stuck in here, keeping enlessly running.\r\n\r\nSo it seems the server don't even run the \"task = modeling_task.delay()\", otherwise it should've print \"yes\" on the console, right?\r\n\r\nWould it print \"yes\" in another place? Why did it get stuck?\r\n\r\n\r\nDown below is the celery info:\r\n```\r\n(base) C:\\Users\\headmaster\\Desktop\\WEB>celery worker -A tasks.celery --loglevel=info\r\n\r\n -------------- celery@LAPTOP-KLKJCK2F v4.4.2 (cliffs)\r\n--- ***** -----\r\n-- ******* ---- Windows-10-10.0.18362-SP0 2020-04-22 10:55:13\r\n- *** --- * ---\r\n- ** ---------- [config]\r\n- ** ---------- .> app:         app:0x2526977ac08\r\n- ** ---------- .> transport:   redis://localhost:6379/0\r\n- ** ---------- .> results:     redis://localhost:6379/1\r\n- *** --- * --- .> concurrency: 4 (prefork)\r\n-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)\r\n--- ***** -----\r\n -------------- [queues]\r\n                .> celery           exchange=celery(direct) key=celery\r\n\r\n\r\n[tasks]\r\n  . tasks.modeling_task\r\n\r\n[2020-04-22 10:55:15,501: INFO/SpawnPoolWorker-1] child process 6692 calling self.run()\r\n[2020-04-22 10:55:15,511: INFO/SpawnPoolWorker-2] child process 17736 calling self.run()\r\n[2020-04-22 10:55:15,518: INFO/SpawnPoolWorker-3] child process 16320 calling self.run()\r\n[2020-04-22 10:55:15,571: INFO/SpawnPoolWorker-4] child process 5608 calling self.run()\r\n[2020-04-22 10:55:15,972: INFO/MainProcess] Connected to redis://localhost:6379/0\r\n[2020-04-22 10:55:20,332: INFO/MainProcess] mingle: searching for neighbors\r\n[2020-04-22 10:55:27,369: INFO/MainProcess] mingle: all alone\r\n[2020-04-22 10:55:35,402: INFO/MainProcess] celery@LAPTOP-KLKJCK2F ready.\r\n```\r\n\r\nredis info:\r\n```\r\nPS D:\\Applications\\Redis> redis-server redis.conf\r\n                _._\r\n           _.-``__ ''-._\r\n      _.-``    `.  `_.  ''-._           Redis 3.2.100 (00000000/0) 64 bit\r\n  .-`` .-```.  ```\\/    _.,_ ''-._\r\n (    '      ,       .-`  | `,    )     Running in standalone mode\r\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\r\n |    `-._   `._    /     _.-'    |     PID: 21420\r\n  `-._    `-._  `-./  _.-'    _.-'\r\n |`-._`-._    `-.__.-'    _.-'_.-'|\r\n |    `-._`-._        _.-'_.-'    |           http://redis.io\r\n  `-._    `-._`-.__.-'_.-'    _.-'\r\n |`-._`-._    `-.__.-'    _.-'_.-'|\r\n |    `-._`-._        _.-'_.-'    |\r\n  `-._    `-._`-.__.-'_.-'    _.-'\r\n      `-._    `-.__.-'    _.-'\r\n          `-._        _.-'\r\n              `-.__.-'\r\n\r\n[21420] 22 Apr 10:38:22.506 # Server started, Redis version 3.2.100\r\n[21420] 22 Apr 10:38:22.508 * DB loaded from disk: 0.000 seconds\r\n[21420] 22 Apr 10:38:22.508 * The server is now ready to accept connections on port 6379\r\n[21420] 22 Apr 10:43:23.025 * 10 changes in 300 seconds. Saving...\r\n[21420] 22 Apr 10:43:23.030 * Background saving started by pid 6204\r\n[21420] 22 Apr 10:43:23.231 # fork operation complete\r\n[21420] 22 Apr 10:43:23.232 * Background saving terminated with success\r\n[21420] 22 Apr 10:51:18.099 * 10 changes in 300 seconds. Saving...\r\n[21420] 22 Apr 10:51:18.103 * Background saving started by pid 10116\r\n[21420] 22 Apr 10:51:18.305 # fork operation complete\r\n[21420] 22 Apr 10:51:18.306 * Background saving terminated with success\r\n[21420] 22 Apr 10:56:19.022 * 10 changes in 300 seconds. Saving...\r\n[21420] 22 Apr 10:56:19.026 * Background saving started by pid 11748\r\n[21420] 22 Apr 10:56:19.227 # fork operation complete\r\n[21420] 22 Apr 10:56:19.227 * Background saving terminated with success\r\n```\r\n\r\nwish you a best day!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6053", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6053/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6053/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6053/events", "html_url": "https://github.com/celery/celery/issues/6053", "id": 604090662, "node_id": "MDU6SXNzdWU2MDQwOTA2NjI=", "number": 6053, "title": "How to add / remove dynamically periodic tasks", "user": {"login": "Jean-PhilippeD", "id": 14221237, "node_id": "MDQ6VXNlcjE0MjIxMjM3", "avatar_url": "https://avatars3.githubusercontent.com/u/14221237?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Jean-PhilippeD", "html_url": "https://github.com/Jean-PhilippeD", "followers_url": "https://api.github.com/users/Jean-PhilippeD/followers", "following_url": "https://api.github.com/users/Jean-PhilippeD/following{/other_user}", "gists_url": "https://api.github.com/users/Jean-PhilippeD/gists{/gist_id}", "starred_url": "https://api.github.com/users/Jean-PhilippeD/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Jean-PhilippeD/subscriptions", "organizations_url": "https://api.github.com/users/Jean-PhilippeD/orgs", "repos_url": "https://api.github.com/users/Jean-PhilippeD/repos", "events_url": "https://api.github.com/users/Jean-PhilippeD/events{/privacy}", "received_events_url": "https://api.github.com/users/Jean-PhilippeD/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-21T15:31:18Z", "updated_at": "2020-04-22T13:04:34Z", "closed_at": "2020-04-22T13:04:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [ x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- https://github.com/celery/celery/issues/5748\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.0\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\nI first start Celery with Beat option (-B).\r\nIt add_periodic_task after config as specified in the doc (https://docs.celeryproject.org/en/stable/userguide/periodic-tasks.html#starting-the-scheduler)\r\nThen, I try to add or remove a task though API Flask app, by either:\r\n\r\n* modifying the app.conf.beat_schedule (remove or add task by name\r\n* modifying the celerybeat-schedule shelve \r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.7.4\r\n* **Minimal Celery Version**: 4.4.\u00b0\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: RabboitMQ 3.8.0\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: Redhat 7\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\namqp==2.5.2\r\nastroid==2.3.3\r\nattrs==19.3.0\r\nautopep8==1.4.4\r\nBabel==2.7.0\r\nbilliard==3.6.3.0\r\ncelery==4.4.0\r\ncertifi==2019.9.11\r\nchardet==3.0.4\r\nClick==7.0\r\ncoverage==4.5.4\r\nfixtures-mongoengine==1.3.1\r\nFlask==1.1.1\r\nFlask-Babel==0.12.2\r\nFlask-Session==0.3.1\r\nFlask-WTF==0.14.2\r\nidna==2.8\r\nimportlib-metadata==1.5.0\r\nisodate==0.6.0\r\nisort==4.3.21\r\nitsdangerous==1.1.0\r\nJinja2==2.11.1\r\njsonschema==3.2.0\r\nkombu==4.6.8\r\nlazy-object-proxy==1.4.3\r\nMarkupSafe==1.1.1\r\nmccabe==0.6.1\r\nmongoengine==0.18.2\r\npaho-mqtt==1.4.0\r\npycodestyle==2.5.0\r\npylint==2.4.2\r\npymongo==3.9.0\r\npyrsistent==0.15.7\r\npytz==2019.3\r\nPyYAML==5.3\r\nrequests==2.22.0\r\nsemver==2.9.0\r\nsix==1.12.0\r\ntyped-ast==1.4.1\r\nurllib3==1.25.6\r\nvine==1.3.0\r\nWerkzeug==0.16.0\r\nwrapt==1.11.2\r\nWTForms==2.2.1\r\nzipp==2.1.0\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nI would like to be able to add or remove a task dynmically.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nIn fact nothing happen, whatever I do, If I remove the task either from shelve (as suggested here: https://stackoverflow.com/questions/10194975/how-to-dynamically-add-remove-periodic-tasks-to-celery-celerybeat proposed by Tristant Brown) or from config app.conf.beat_schedule, the task continue to be schedule at the original cron rules I provided.\r\n\r\nI first though it was an issue in the sync processed which happend every 3 minutes, and after looking at the code, I discovered that in `beat.py` file line 421, the function sync does nothing.. ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6046", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6046/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6046/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6046/events", "html_url": "https://github.com/celery/celery/issues/6046", "id": 601746556, "node_id": "MDU6SXNzdWU2MDE3NDY1NTY=", "number": 6046, "title": "Both 'task_publish_retry' and 'task_publish_retry_policy' are ignored when publishing tasks", "user": {"login": "ulyssesric", "id": 914435, "node_id": "MDQ6VXNlcjkxNDQzNQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/914435?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ulyssesric", "html_url": "https://github.com/ulyssesric", "followers_url": "https://api.github.com/users/ulyssesric/followers", "following_url": "https://api.github.com/users/ulyssesric/following{/other_user}", "gists_url": "https://api.github.com/users/ulyssesric/gists{/gist_id}", "starred_url": "https://api.github.com/users/ulyssesric/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ulyssesric/subscriptions", "organizations_url": "https://api.github.com/users/ulyssesric/orgs", "repos_url": "https://api.github.com/users/ulyssesric/repos", "events_url": "https://api.github.com/users/ulyssesric/events{/privacy}", "received_events_url": "https://api.github.com/users/ulyssesric/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-04-17T06:54:52Z", "updated_at": "2020-04-17T08:32:46Z", "closed_at": "2020-04-17T08:29:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Checklist\r\n- [X] I have verified that the issue exists against the `master` branch.\r\n- [ ] This has already been asked to the [discussion group]\r\n- [X] I have read the relevant section in the [contribution guide].\r\n- [X] I have checked the [issues list] for similar or identical bug reports.\r\n- [X] I have checked the [pull requests list]for existing proposed fixes.\r\n- [X] I have checked the [commit log] to find out if the bug was already fixed.\r\n- [X] I have included all related issues and possible duplicate issues\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [X] I have included the output of ``celery -A proj report`` in the issue.\r\n- [X] I have verified that the issue exists against the `master` branch.\r\n- [X] I have included the contents of ``pip freeze`` in the issue.\r\n- [X] I have included all the versions of all the external dependencies.\r\n\r\n## Optional Debugging Information\r\n- [X] I have tried reproducing the issue on more than one Python version\r\n- [ ] I have tried reproducing the issue on more than one message broker\r\n- [ ] I have tried reproducing the issue on more than one version of broker\r\n- [X] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n\r\n#### Related Issues\r\n\r\nhttps://github.com/celery/celery/issues/2991\r\nhttps://github.com/celery/celery/issues/2457\r\n\r\n#### Possible Duplicates\r\n\r\nhttps://github.com/celery/celery/issues/4296\r\n\r\n## Environment & Settings\r\n\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\nsoftware -> celery:4.4.2 (cliffs) kombu:4.6.8 py:3.7.7\r\n            billiard:3.6.3.0 py-amqp:2.5.2\r\nplatform -> system:Darwin arch:64bit\r\n            kernel version:19.4.0 imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:pyamqp results:disabled\r\n\r\nbroker_url: 'amqp://guest:********@localhost:5672//'\r\ntask_publish_retry: False\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n1. Shutdown broker\r\n2. Publish a task (details in \"Minimally Reproducible Test Case\" section)\r\n3. Wait indefinitely\r\n\r\n## Required Dependencies\r\n* **Minimal Python Version**: N/A\r\n* **Minimal Celery Version**: N/A\r\n* **Minimal Kombu Version**: N/A\r\n* **Minimal Broker Version**: N/A\r\n* **Minimal Result Backend Version**: N/A\r\n* **Minimal OS and/or Kernel Version**: N/A\r\n* **Minimal Broker Client Version**: N/A\r\n* **Minimal Result Backend Client Version**: N/A\r\n\r\n### Python Packages\r\n\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\namqp==2.5.2\r\nbilliard==3.6.3.0\r\ncelery==4.4.2\r\ndocutils==0.16\r\nimportlib-metadata==1.6.0\r\nkombu==4.6.8\r\nlockfile==0.12.2\r\nprotobuf==3.11.4\r\npython-daemon==2.2.4\r\npytz==2019.3\r\nsix==1.14.0\r\nvine==1.3.0\r\nzipp==3.1.0\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n\r\nStep 1: vi tasks.py\r\n\r\n<details>\r\n<p>\r\n\r\n\tfrom celery import Celery\r\n\r\n\tclass celeryconfig:\r\n\t\tbroker_url = 'pyamqp://guest@localhost//'\r\n\t\ttask_publish_retry = False\r\n\r\n\tapp = Celery('tasks')\r\n\tapp.config_from_object(celeryconfig)\r\n\r\n\t@app.task\r\n\tdef add(x, y):\r\n\t\treturn x + y\r\n\r\n</p>\r\n</details>\r\n\r\nStep 2: shutdown broker\r\nStep 3: from python prompt:\r\n\r\n\r\n<details>\r\n<p>\r\n\r\n    $ python\r\n    >>> from tasks import add\r\n    >>> add.delay(1,2)\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n\r\nQuit process due to exception:\r\n`kombu.exceptions.OperationalError: [Errno 61] Connection refused`\r\n\r\n# Actual Behavior\r\n\r\nWait **INDEFINITELY**\r\n\r\n# Analysis\r\n\r\n1.\tat line 870 of `celery/app/base.y`, parameter `transport_options` will only cite calling parameter of `calling _connection()` & `conf.broker_transport_options`. Both`task_publish_retry` and `task_publish_retry_policy` are not included.\r\n\r\n2.\tat line 1196 of `celery/app/base.y`, `self._pool` is generated for the first time by calling `connection_for_write()` **without any parameter**. So only `conf.broker_transport_options` will be used for initiaizing `Connection` instance of `kombu`, both `task_publish_retry` and `task_publish_retry_policy` will be ignored.\r\n\r\n3.\tat line 559 of `celery/app/amqp.py`, both `task_publish_retry` and `task_publish_retry_policy` is passed to function `publish()` of `kombu`, but these two parameters will be dropped when referencing `self.channel` to create a connection channel at line 174 of `kombu/messaging.py`, which will make call to `ChannelPromise(lambda: connection.default_channel)` at line 224, and get result from `Connection.default_channel`.\r\n\r\n4.\tat line 844 of `kombu/connection.py` we can find that `default_channel()` takes no parameter at all, and will only take the initialization parameters of Collection instance. As a result, settings from `task_publish_retry` and `task_publish_retry_policy` configuration are not included, because they're not part of instance initialization as mentioned above.\r\n\r\n5.\tat line 383 of `kombu/connection.py` we can further inspect that the real value of parameter `max_retries` passed to function `ensure_connection()` is **`None`**. So it will repeat indefinitely.\r\n\r\n6.\tFor the same reason, the `retry` and `retry_policy` parameter when calling `apply_async()` or `send_task()` does not work, either. Because these parameter will not reach `default_channel` of `kombu` at all.\r\n\r\nSo either the code should be fixed to include `task_publish_retry` and `task_publish_retry_policy` in `Connection` instance initialization, or the instance variables of `Connection` should be modified when calling `Producer.publish()`, or the document should be modified to clarify that these two configurations will not work as intended.\r\n\r\n# Temporary Workaround\r\n\r\nUse `broker_transport_options` instead of `task_publish_retry`/`task_publish_retry_policy`:\r\n\r\n<details>\r\n<p>\r\n\r\n\tclass celeryconfig:\r\n\t\tbroker_url = 'pyamqp://guest@localhost//'\r\n\t\tbroker_transport_options = {\r\n\t\t\t'max_retries': 1,\r\n\t\t\t'interval_start': 0,\r\n\t\t\t'interval_step': 0.2,\r\n\t\t\t'interval_max': 0.2,\r\n\t\t}\r\n\r\n\tapp.config_from_object(celeryconfig)\r\n\r\n</p>\r\n</details>\r\n\r\nDidn't find a way to turn off retries, though.\r\n\r\n## [EDIT]\r\n\r\nAdd possible duplicate through Googling: https://github.com/celery/celery/issues/4296\r\n\r\nThe conclusion is identical to my post, use `broker_transport_options` instead. This problem (or inconsistency of documentation) was reported back in 2018, but the situation still remains in v4.4.2. \r\n\r\nThe \"Calling Task\" section of document should really be modified to clarify that all `task_publish_retry`, `task_publish_retry_policy`, `retry` and `retry_policy` will not work as intended when connecting to broker for the first time.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6045", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6045/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6045/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6045/events", "html_url": "https://github.com/celery/celery/issues/6045", "id": 601558547, "node_id": "MDU6SXNzdWU2MDE1NTg1NDc=", "number": 6045, "title": "Add Ability To Specify Scheme For ElasticsearchBackend ", "user": {"login": "ctaylor4874", "id": 8881198, "node_id": "MDQ6VXNlcjg4ODExOTg=", "avatar_url": "https://avatars1.githubusercontent.com/u/8881198?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ctaylor4874", "html_url": "https://github.com/ctaylor4874", "followers_url": "https://api.github.com/users/ctaylor4874/followers", "following_url": "https://api.github.com/users/ctaylor4874/following{/other_user}", "gists_url": "https://api.github.com/users/ctaylor4874/gists{/gist_id}", "starred_url": "https://api.github.com/users/ctaylor4874/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ctaylor4874/subscriptions", "organizations_url": "https://api.github.com/users/ctaylor4874/orgs", "repos_url": "https://api.github.com/users/ctaylor4874/repos", "events_url": "https://api.github.com/users/ctaylor4874/events{/privacy}", "received_events_url": "https://api.github.com/users/ctaylor4874/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 7096, "node_id": "MDU6TGFiZWw3MDk2", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Enhancement", "name": "Issue Type: Enhancement", "color": "ededed", "default": false, "description": null}, {"id": 445647493, "node_id": "MDU6TGFiZWw0NDU2NDc0OTM=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Question", "name": "Issue Type: Question", "color": "1d76db", "default": false, "description": null}, {"id": 10795, "node_id": "MDU6TGFiZWwxMDc5NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Not%20a%20Bug", "name": "Status: Not a Bug", "color": "4c9439", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "georgepsarakis", "id": 963304, "node_id": "MDQ6VXNlcjk2MzMwNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/963304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/georgepsarakis", "html_url": "https://github.com/georgepsarakis", "followers_url": "https://api.github.com/users/georgepsarakis/followers", "following_url": "https://api.github.com/users/georgepsarakis/following{/other_user}", "gists_url": "https://api.github.com/users/georgepsarakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/georgepsarakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/georgepsarakis/subscriptions", "organizations_url": "https://api.github.com/users/georgepsarakis/orgs", "repos_url": "https://api.github.com/users/georgepsarakis/repos", "events_url": "https://api.github.com/users/georgepsarakis/events{/privacy}", "received_events_url": "https://api.github.com/users/georgepsarakis/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "georgepsarakis", "id": 963304, "node_id": "MDQ6VXNlcjk2MzMwNA==", "avatar_url": "https://avatars1.githubusercontent.com/u/963304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/georgepsarakis", "html_url": "https://github.com/georgepsarakis", "followers_url": "https://api.github.com/users/georgepsarakis/followers", "following_url": "https://api.github.com/users/georgepsarakis/following{/other_user}", "gists_url": "https://api.github.com/users/georgepsarakis/gists{/gist_id}", "starred_url": "https://api.github.com/users/georgepsarakis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/georgepsarakis/subscriptions", "organizations_url": "https://api.github.com/users/georgepsarakis/orgs", "repos_url": "https://api.github.com/users/georgepsarakis/repos", "events_url": "https://api.github.com/users/georgepsarakis/events{/privacy}", "received_events_url": "https://api.github.com/users/georgepsarakis/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2020-04-16T22:42:12Z", "updated_at": "2020-05-18T21:42:05Z", "closed_at": "2020-05-18T21:42:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nenhancement requests which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\nPlease add the ability to specify `https` scheme for results backend. Right now, it seems that http is the default with no way to change it. If this already exists can you please point me to it?\r\n\r\nhttps://github.com/celery/celery/blob/6be45237355f0f61ad9e68b018ea1c007fa66f78/celery/backends/elasticsearch.py#L38\r\n\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Enhancement%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical enhancement to an existing feature.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22Issue+Type%3A+Enhancement%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed enhancements.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the if the same enhancement was already implemented in the\r\n  master branch.\r\n- [x] I have included all related issues and possible duplicate issues in this issue\r\n      (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Brief Summary\r\n<!--\r\nPlease include a brief summary of what the enhancement is\r\nand why it is needed.\r\n-->\r\n\r\n# Design\r\n\r\n## Architectural Considerations\r\n<!--\r\nIf more components other than Celery are involved,\r\ndescribe them here and the effect it would have on Celery.\r\n-->\r\nNone\r\n\r\n## Proposed Behavior\r\n<!--\r\nPlease describe in detail how this enhancement is going to change the behavior\r\nof an existing feature.\r\nDescribe what happens in case of failures as well if applicable.\r\n-->\r\n\r\n## Proposed UI/UX\r\n<!--\r\nPlease provide your ideas for the API, CLI options,\r\nconfiguration key names etc. that will be adjusted for this enhancement.\r\n-->\r\n\r\n## Diagrams\r\n<!--\r\nPlease include any diagrams that might be relevant\r\nto the implementation of this enhancement such as:\r\n* Class Diagrams\r\n* Sequence Diagrams\r\n* Activity Diagrams\r\nYou can drag and drop images into the text box to attach them to this issue.\r\n-->\r\nN/A\r\n\r\n## Alternatives\r\n<!--\r\nIf you have considered any alternative implementations\r\ndescribe them in detail below.\r\n-->\r\nNone\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6043", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6043/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6043/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6043/events", "html_url": "https://github.com/celery/celery/issues/6043", "id": 601216747, "node_id": "MDU6SXNzdWU2MDEyMTY3NDc=", "number": 6043, "title": "revoke task does not work for active tasks when broker == filesystem", "user": {"login": "razgilad", "id": 52667659, "node_id": "MDQ6VXNlcjUyNjY3NjU5", "avatar_url": "https://avatars1.githubusercontent.com/u/52667659?v=4", "gravatar_id": "", "url": "https://api.github.com/users/razgilad", "html_url": "https://github.com/razgilad", "followers_url": "https://api.github.com/users/razgilad/followers", "following_url": "https://api.github.com/users/razgilad/following{/other_user}", "gists_url": "https://api.github.com/users/razgilad/gists{/gist_id}", "starred_url": "https://api.github.com/users/razgilad/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/razgilad/subscriptions", "organizations_url": "https://api.github.com/users/razgilad/orgs", "repos_url": "https://api.github.com/users/razgilad/repos", "events_url": "https://api.github.com/users/razgilad/events{/privacy}", "received_events_url": "https://api.github.com/users/razgilad/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-04-16T16:13:55Z", "updated_at": "2020-05-15T05:41:04Z", "closed_at": "2020-05-15T05:41:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease use one of our issue templates.\r\nWe reserve the right to close bug reports or feature requests who don't use our templates.\r\n-->\r\nI tried :\r\nAsyncResult(id).revoke(terminate=True,signal='SIGKILL', wait=True)\r\nAsyncResult(id).revoke(terminate=True, signal='SIGTERM ', wait=True)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6038", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6038/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6038/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6038/events", "html_url": "https://github.com/celery/celery/issues/6038", "id": 598554147, "node_id": "MDU6SXNzdWU1OTg1NTQxNDc=", "number": 6038, "title": "'settings' object has no attribute 'result_serializer'", "user": {"login": "karambaq", "id": 14233969, "node_id": "MDQ6VXNlcjE0MjMzOTY5", "avatar_url": "https://avatars1.githubusercontent.com/u/14233969?v=4", "gravatar_id": "", "url": "https://api.github.com/users/karambaq", "html_url": "https://github.com/karambaq", "followers_url": "https://api.github.com/users/karambaq/followers", "following_url": "https://api.github.com/users/karambaq/following{/other_user}", "gists_url": "https://api.github.com/users/karambaq/gists{/gist_id}", "starred_url": "https://api.github.com/users/karambaq/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/karambaq/subscriptions", "organizations_url": "https://api.github.com/users/karambaq/orgs", "repos_url": "https://api.github.com/users/karambaq/repos", "events_url": "https://api.github.com/users/karambaq/events{/privacy}", "received_events_url": "https://api.github.com/users/karambaq/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 39038, "node_id": "MDU6TGFiZWwzOTAzOA==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Feedback%20Needed%20%E2%9C%98", "name": "Status: Feedback Needed \u2718", "color": "b59595", "default": false, "description": null}, {"id": 10795, "node_id": "MDU6TGFiZWwxMDc5NQ==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Not%20a%20Bug", "name": "Status: Not a Bug", "color": "4c9439", "default": false, "description": null}, {"id": 1691983296, "node_id": "MDU6TGFiZWwxNjkxOTgzMjk2", "url": "https://api.github.com/repos/celery/celery/labels/Worker", "name": "Worker", "color": "2cb72e", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-04-12T19:24:53Z", "updated_at": "2020-05-16T18:57:20Z", "closed_at": "2020-05-16T18:17:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.2 (cliffs)\r\n\r\nWhile migrating from OS X to Linux I've faced the following issue:\r\n\r\n```\r\n$ celery -A mkstat worker -B -l INFO\r\nError: \r\nUnable to load celery application.\r\n'settings' object has no attribute 'result_serializer'\r\n```\r\n\r\nmy settings.py:\r\n```\r\nCELERY_BROKER_URL = \"redis://localhost:6379\"\r\n\r\nCELERY_TASK_SERIALIZER = \"json\"\r\nCELERY_RESULT_SERIALIZER = \"json\"\r\nCELERY_TIMEZONE = \"Europe/Moscow\"\r\nREDIS_HOST = \"localhost\"\r\nREDIS_PORT = \"6379\"\r\nCELERY_RESULT_BACKEND = \"redis://\" + REDIS_HOST + \":\" + REDIS_PORT\r\nCELERY_BEAT_SCHEDULE = {\r\n    \"update_db\": {\"task\": \"stats.tasks.update_db\", \"schedule\": 15.0,},\r\n}\r\n```\r\n\r\npython version is 3.8", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6037", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6037/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6037/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6037/events", "html_url": "https://github.com/celery/celery/issues/6037", "id": 598245893, "node_id": "MDU6SXNzdWU1OTgyNDU4OTM=", "number": 6037, "title": "Can't run Celery with Gunicorn - No result backend is configured", "user": {"login": "venomone", "id": 43114687, "node_id": "MDQ6VXNlcjQzMTE0Njg3", "avatar_url": "https://avatars2.githubusercontent.com/u/43114687?v=4", "gravatar_id": "", "url": "https://api.github.com/users/venomone", "html_url": "https://github.com/venomone", "followers_url": "https://api.github.com/users/venomone/followers", "following_url": "https://api.github.com/users/venomone/following{/other_user}", "gists_url": "https://api.github.com/users/venomone/gists{/gist_id}", "starred_url": "https://api.github.com/users/venomone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/venomone/subscriptions", "organizations_url": "https://api.github.com/users/venomone/orgs", "repos_url": "https://api.github.com/users/venomone/repos", "events_url": "https://api.github.com/users/venomone/events{/privacy}", "received_events_url": "https://api.github.com/users/venomone/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-04-11T11:20:16Z", "updated_at": "2020-04-11T13:15:14Z", "closed_at": "2020-04-11T13:15:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "Im unsing gunicorn like many others to run my python app. I just wanted to try things out in production mode and discoverd that I'm not able to trigger a celery @shared_task while im running in production mode which basically just means hide all output errors and use gunicorn instead of the development runserver.\r\n\r\nCelery always returns the error \"No result backend is configured\" which makes absolut no sense to me as everything else works as expected when using the development runserver I don't know where I could start to debug this behaviour as CELERY_RESULT_BACKEND = 'django-db' simply seems to get ignored.\r\n\r\n\r\nThis is how I start gunicorn:\r\n\r\n    gunicorn App.wsgi:application \\\r\n    --workers $GUNICORN_WORKERS \\\r\n    --bind=127.0.0.1:8000 \\\r\n    --log-level info\r\n\r\ncelery.py\r\n\r\n    from __future__ import absolute_import, unicode_literals\r\n    import os\r\n    from celery import Celery\r\n    import environ\r\n    from django.conf import settings\r\n    \r\n    env = environ.Env()\r\n    \r\n    os.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"App.settings\")\r\n    \r\n    app = Celery(str(settings.SITE_NAME), broker=str(\"redis://\") + str(':') + env.str('REDIS_PASSWORD') + str('@') + env.str('REDIS_HOST') + str(\":\") + env.str('REDIS_PORT') + str(\"/\"))\r\n    app.config_from_object('django.conf:settings', namespace='CELERY')\r\n    \r\n    # Load task modules from all registered Django app configs.\r\n    app.autodiscover_tasks()\r\n    \r\n    \r\n    @app.task(bind=True)\r\n    def debug_task(self):\r\n        print('Request: {0!r}'.format(self.request))\r\n\r\n\r\n__init__.py\r\n\r\n    from __future__ import absolute_import, unicode_literals\r\n    \r\n    # This will make sure the app is always imported when\r\n    # Django starts so that shared_task will use this app.\r\n    from .celery import app as celery_app\r\n    \r\n    __all__ = ('celery_app',)\r\n    default_app_config = 'App.apps.AccountsConfig'\r\n\r\n\r\nsettings.py\r\n\r\n    CACHES = {\r\n        \"default\": {\r\n            \"BACKEND\": \"django_redis.cache.RedisCache\",\r\n            \"LOCATION\": [\r\n                str(\"redis://\") + str(':') + env.str('REDIS_PASSWORD') + str('@') + env.str('REDIS_HOST') + \":\" + env.str('REDIS_PORT') + str(\"/\") + env.str('REDIS_CACHE_DB')\r\n            ],\r\n            \"OPTIONS\": {\r\n                \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\",\r\n                \"SOCKET_CONNECT_TIMEOUT\": 30,  # in seconds\r\n                \"SOCKET_TIMEOUT\": 30,  # in seconds\r\n                \"COMPRESSOR\": \"django_redis.compressors.zlib.ZlibCompressor\",\r\n                \"CONNECTION_POOL_KWARGS\": {\"max_connections\": env.int('REDIS_MAX_CONN'), \"retry_on_timeout\": True}\r\n            }\r\n        }\r\n    }\r\n\r\n    # Celery Settings:\r\n    BROKER_URL = str(\"redis://\") + str(':') + env.str('REDIS_PASSWORD') + str('@') + env.str('REDIS_HOST') + str(\":\") + env.str('REDIS_PORT')\r\n    CELERY_RESULT_BACKEND = 'django-db'\r\n    BROKER_TRANSPORT = 'redis'\r\n    CELERY_TASK_RESULT_EXPIRES = 3600\r\n    CELERY_REDIS_HOST = env.str('REDIS_HOST')\r\n    CELERY_REDIS_PASSWORD = env.str('REDIS_PASSWORD')\r\n    CELERY_REDIS_PORT = env.str('REDIS_PORT')\r\n    CELERY_REDIS_DB = env.str('REDIS_CACHE_DB')\r\n    CELERY_CACHE_BACKEND = 'default'\r\n    CELERY_ACCEPT_CONTENT = ['application/json']\r\n    CELERY_TASK_SERIALIZER = 'json'\r\n    CELERY_RESULT_SERIALIZER = 'json'\r\n    CELERY_TIMEZONE = 'GMT'\r\n    CELERYD_TASK_SOFT_TIME_LIMIT = 900\r\n\r\nThis is how i call the a task:\r\n\r\n    gen_something = gen.apply_async(kwargs={\"user_pk\": user.pk})\r\n    gen_something.get(timeout=30, interval=1)\r\n\r\nchecking the \"celery -A App report|grep -i result\"\r\nalso shows me the right values:\r\n\r\n    CELERY_RESULT_BACKEND: 'django-db'\r\n    CELERY_RESULT_SERIALIZER: 'json'\r\n    CELERY_TASK_RESULT_EXPIRES: 3600\r\n     'django_celery_results',\r\n\r\n\r\nAny suggestions?\r\n\r\nI'm on Python 3.8.2, Django 3.0.5, Celery 4.4.2\r\n\r\nThanks for reading", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6035", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6035/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6035/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6035/events", "html_url": "https://github.com/celery/celery/issues/6035", "id": 597830797, "node_id": "MDU6SXNzdWU1OTc4MzA3OTc=", "number": 6035, "title": "\"python_requires\" string in setup.py is invalid", "user": {"login": "brot", "id": 36720, "node_id": "MDQ6VXNlcjM2NzIw", "avatar_url": "https://avatars1.githubusercontent.com/u/36720?v=4", "gravatar_id": "", "url": "https://api.github.com/users/brot", "html_url": "https://github.com/brot", "followers_url": "https://api.github.com/users/brot/followers", "following_url": "https://api.github.com/users/brot/following{/other_user}", "gists_url": "https://api.github.com/users/brot/gists{/gist_id}", "starred_url": "https://api.github.com/users/brot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/brot/subscriptions", "organizations_url": "https://api.github.com/users/brot/orgs", "repos_url": "https://api.github.com/users/brot/repos", "events_url": "https://api.github.com/users/brot/events{/privacy}", "received_events_url": "https://api.github.com/users/brot/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 2, "created_at": "2020-04-10T10:57:22Z", "updated_at": "2020-05-01T12:56:42Z", "closed_at": "2020-05-01T12:56:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [x] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Commits\r\n\r\n- 0f37ba0faf0fae69cbcfe17a92e9311cd038cf95\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n```python\r\n>>> import platform\r\n>>> import pkg_resources\r\n>>>\r\n>>> your_python_requires_str = \">=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*,\"\r\n>>> pkg_resources.Requirement.parse(\"python_version%s\" % your_python_requires_str)\r\n.....\r\npkg_resources.RequirementParseError: Invalid requirement, parse error at \"','\"\r\n>>>\r\n>>> valid_python_requires_str = your_python_requires_str.rstrip(',')\r\n>>> pkg_resources.Requirement.parse(\"python_version%s\" % valid_python_requires_str)\r\nRequirement.parse('python_version!=3.0.*,!=3.1.*,!=3.2.*,!=3.3.*,!=3.4.*,>=2.7')\r\n```\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\n\r\n`python_requires` string should be a valid python version specifier.  \r\nThe same applies to the `requires_python` attribute on [pypi.org](https://pypi.org/pypi/celery/json)\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\n\r\n`pkg_resources.Requirement.parse` raises an Exception with the current provided string\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6034", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6034/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6034/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6034/events", "html_url": "https://github.com/celery/celery/issues/6034", "id": 597738961, "node_id": "MDU6SXNzdWU1OTc3Mzg5NjE=", "number": 6034, "title": "maintain a connection to mqtt broker in worker", "user": {"login": "mttbx", "id": 38148377, "node_id": "MDQ6VXNlcjM4MTQ4Mzc3", "avatar_url": "https://avatars3.githubusercontent.com/u/38148377?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mttbx", "html_url": "https://github.com/mttbx", "followers_url": "https://api.github.com/users/mttbx/followers", "following_url": "https://api.github.com/users/mttbx/following{/other_user}", "gists_url": "https://api.github.com/users/mttbx/gists{/gist_id}", "starred_url": "https://api.github.com/users/mttbx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mttbx/subscriptions", "organizations_url": "https://api.github.com/users/mttbx/orgs", "repos_url": "https://api.github.com/users/mttbx/repos", "events_url": "https://api.github.com/users/mttbx/events{/privacy}", "received_events_url": "https://api.github.com/users/mttbx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 445647493, "node_id": "MDU6TGFiZWw0NDU2NDc0OTM=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Question", "name": "Issue Type: Question", "color": "1d76db", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-10T07:18:17Z", "updated_at": "2020-05-16T03:39:04Z", "closed_at": "2020-05-16T03:39:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nfeature requests which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3A%22Issue+Type%3A+Feature+Request%22+)\r\n  for similar or identical feature requests.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?utf8=%E2%9C%93&q=is%3Apr+label%3A%22PR+Type%3A+Feature%22+)\r\n  for existing proposed implementations of this feature.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the if the same feature was already implemented in the\r\n  master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Brief Summary\r\n<!--\r\nPlease include a brief summary of what the feature does\r\nand why it is needed.\r\n-->\r\nHow should I maintain a connection to broker in worker so that when I do the task, I can publish messages to broker?\r\n# Design\r\n\r\n## Architectural Considerations\r\n<!--\r\nIf more components other than Celery are involved,\r\ndescribe them here and the effect it would have on Celery.\r\n-->\r\nNone\r\n\r\n## Proposed Behavior\r\n<!--\r\nPlease describe in detail how this feature is going to behave.\r\nDescribe what happens in case of failures as well if applicable.\r\n-->\r\n\r\n## Proposed UI/UX\r\n<!--\r\nPlease provide your ideas for the API, CLI options,\r\nconfiguration key names etc. that will be introduced for this feature.\r\n-->\r\n\r\n## Diagrams\r\n<!--\r\nPlease include any diagrams that might be relevant\r\nto the implementation of this feature such as:\r\n* Class Diagrams\r\n* Sequence Diagrams\r\n* Activity Diagrams\r\nYou can drag and drop images into the text box to attach them to this issue.\r\n-->\r\nN/A\r\n\r\n## Alternatives\r\n<!--\r\nIf you have considered any alternative implementations\r\ndescribe them in detail below.\r\n-->\r\nNone\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6033", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6033/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6033/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6033/events", "html_url": "https://github.com/celery/celery/issues/6033", "id": 597671514, "node_id": "MDU6SXNzdWU1OTc2NzE1MTQ=", "number": 6033, "title": "User-defined task-id  for celery task", "user": {"login": "bayegy", "id": 40882939, "node_id": "MDQ6VXNlcjQwODgyOTM5", "avatar_url": "https://avatars2.githubusercontent.com/u/40882939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bayegy", "html_url": "https://github.com/bayegy", "followers_url": "https://api.github.com/users/bayegy/followers", "following_url": "https://api.github.com/users/bayegy/following{/other_user}", "gists_url": "https://api.github.com/users/bayegy/gists{/gist_id}", "starred_url": "https://api.github.com/users/bayegy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bayegy/subscriptions", "organizations_url": "https://api.github.com/users/bayegy/orgs", "repos_url": "https://api.github.com/users/bayegy/repos", "events_url": "https://api.github.com/users/bayegy/events{/privacy}", "received_events_url": "https://api.github.com/users/bayegy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 46813, "node_id": "MDU6TGFiZWw0NjgxMw==", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Feature%20Request", "name": "Issue Type: Feature Request", "color": "0d0000", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-10T03:19:38Z", "updated_at": "2020-04-10T06:32:05Z", "closed_at": "2020-04-10T06:32:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "Dear developers,\r\n\r\nThere is a case where I need to know the task id before a celery task is called (document the task in database for example). I wonder if it is possible for me to offer a user-defined task-id to apply_async, so I can get a task id (uuid) before the task is sent instead of returned by apply_async or obtained from request.id when the task is running.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6028", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6028/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6028/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6028/events", "html_url": "https://github.com/celery/celery/issues/6028", "id": 596381297, "node_id": "MDU6SXNzdWU1OTYzODEyOTc=", "number": 6028, "title": "RecursionError: maximum recursion depth exceeded while calling a Python object", "user": {"login": "leetcode-xu", "id": 43690306, "node_id": "MDQ6VXNlcjQzNjkwMzA2", "avatar_url": "https://avatars3.githubusercontent.com/u/43690306?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leetcode-xu", "html_url": "https://github.com/leetcode-xu", "followers_url": "https://api.github.com/users/leetcode-xu/followers", "following_url": "https://api.github.com/users/leetcode-xu/following{/other_user}", "gists_url": "https://api.github.com/users/leetcode-xu/gists{/gist_id}", "starred_url": "https://api.github.com/users/leetcode-xu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leetcode-xu/subscriptions", "organizations_url": "https://api.github.com/users/leetcode-xu/orgs", "repos_url": "https://api.github.com/users/leetcode-xu/repos", "events_url": "https://api.github.com/users/leetcode-xu/events{/privacy}", "received_events_url": "https://api.github.com/users/leetcode-xu/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-08T07:53:20Z", "updated_at": "2020-07-01T15:38:07Z", "closed_at": "2020-04-08T08:37:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\nCELERYBEAT_SCHEDULE = {\r\n        'celery_app':{\r\n            'task':'celery_app.task_add.add',\r\n            'schedule':timedelta(seconds=10),\r\n            'args':(2,8),\r\n            },\r\n        'celery_crontab':{\r\n            'task':'celery_app.task_crontab.crontab_mul',\r\n            'schedule':celery.schedules.crontab(hour=10,minute=30),\r\n            'args':(4,5),\r\n            },\r\n        }\r\n\u5728celeryconfig.py\u4e2d\u6dfb\u52a0\u4e0a\u9762\u7684\u5c31\u51fa\u73b0\u5f02\u5e38\uff0c\u6c42\u5e2e\u5fd9", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6023", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6023/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6023/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6023/events", "html_url": "https://github.com/celery/celery/issues/6023", "id": 594781509, "node_id": "MDU6SXNzdWU1OTQ3ODE1MDk=", "number": 6023, "title": "Memory leak  in Exception Task with Prefork(worker)", "user": {"login": "heedong-jung", "id": 63043496, "node_id": "MDQ6VXNlcjYzMDQzNDk2", "avatar_url": "https://avatars1.githubusercontent.com/u/63043496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/heedong-jung", "html_url": "https://github.com/heedong-jung", "followers_url": "https://api.github.com/users/heedong-jung/followers", "following_url": "https://api.github.com/users/heedong-jung/following{/other_user}", "gists_url": "https://api.github.com/users/heedong-jung/gists{/gist_id}", "starred_url": "https://api.github.com/users/heedong-jung/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/heedong-jung/subscriptions", "organizations_url": "https://api.github.com/users/heedong-jung/orgs", "repos_url": "https://api.github.com/users/heedong-jung/repos", "events_url": "https://api.github.com/users/heedong-jung/events{/privacy}", "received_events_url": "https://api.github.com/users/heedong-jung/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 0, "created_at": "2020-04-06T03:45:17Z", "updated_at": "2020-07-27T14:10:12Z", "closed_at": "2020-04-07T06:33:28Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [x] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n#4371\r\n- \r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.3.0 , 4.4.2\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\nsoftware -> celery:4.3.0 (rhubarb) kombu:4.6.8 py:3.7.0 \r\n            billiard:3.6.3.0 py-amqp:2.5.2\r\nplatform -> system:Linux arch:64bit\r\n            kernel version:4.15.0-91-generic imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:amqp results:disabled\r\n\r\nbroker_url: 'amqp://guest:********@localhost:5672//'\r\n\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n\r\naioprocessing==1.0.1\r\nalabaster==0.7.12\r\nalembic==1.2.1\r\namqp==2.5.2\r\naniso8601==6.0.0\r\nastroid==2.3.3\r\nastropy==3.2.3\r\natomicwrites==1.3.0\r\nattrs==19.3.0\r\nauto-sklearn==0.5.2\r\nBabel==2.7.0\r\nbackcall==0.1.0\r\nbackports.csv==1.0.7\r\nbilliard==3.6.3.0\r\nbleach==3.1.0\r\nboto3==1.9.160\r\nbotocore==1.12.160\r\ncatboost==0.14.2\r\ncelery==4.3.0\r\ncelery-progress==0.0.3\r\ncertifi==2019.11.28\r\ncffi==1.14.0\r\nchardet==3.0.4\r\nClick==7.0\r\ncloudpickle==1.1.1\r\nconfig==0.4.2\r\nconfigparser==3.7.4\r\nConfigSpace==0.4.7\r\nconfuse==1.0.0\r\ncoreapi==2.3.3\r\ncoreschema==0.0.4\r\ncoverage==4.5.4\r\ncycler==0.10.0\r\nCython==0.29.16\r\ndatabricks-cli==0.9.0\r\ndebug==0.3.2\r\ndecorator==4.4.1\r\ndefusedxml==0.6.0\r\ndiff-match-patch==20181111\r\ndill==0.2.9\r\nDjango==2.2.2\r\ndjango-cors-headers==3.0.2\r\ndjango-dbconn-retry==0.1.5\r\ndjango-import-export==1.2.0\r\ndjango-keycloak==0.1.1\r\ndjango-rest-framework==0.1.0\r\ndjango-user==0.2.1\r\ndjangorestframework==3.9.4\r\ndocker==4.0.1\r\ndocutils==0.14\r\ndrf-yasg==1.16.0\r\nds-lime==0.1.1.27\r\necdsa==0.13.2\r\neli5==0.10.1\r\nentrypoints==0.3\r\nenum34==1.1.6\r\net-xmlfile==1.0.1\r\nfastparquet==0.3.2\r\nFlask==1.0.3\r\nfuture==0.17.1\r\ngitdb2==2.0.5\r\nGitPython==2.1.11\r\ngorilla==0.3.0\r\nGPy==1.9.9\r\nGPyOpt==1.2.5\r\ngraphene==2.1.7\r\ngraphene-django==2.5.0\r\ngraphene-file-upload==1.2.2\r\ngraphql-core==2.2.1\r\ngraphql-relay==2.0.0\r\ngraphviz==0.11\r\ngunicorn==19.9.0\r\nh5py==2.10.0\r\nhpbandster==0.7.4\r\nhtmlmin==0.1.12\r\nidna==2.8\r\nimageio==2.5.0\r\nimagesize==1.1.0\r\nimportlib-metadata==0.20\r\ninflection==0.3.1\r\nipdb==0.13.2\r\nipython==7.13.0\r\nipython-genutils==0.2.0\r\nisort==4.3.21\r\nitsdangerous==1.1.0\r\nitypes==1.1.0\r\njdcal==1.4.1\r\njedi==0.16.0\r\nJinja2==2.10.1\r\njmespath==0.9.4\r\njoblib==0.13.2\r\njsonschema==3.0.1\r\njupyter-client==5.3.4\r\njupyter-core==4.6.1\r\nKeras==2.3.1\r\nKeras-Applications==1.0.8\r\nKeras-Preprocessing==1.1.0\r\nkiwisolver==1.1.0\r\nkombu==4.6.8\r\nlazy-import==0.2.2\r\nlazy-object-proxy==1.4.3\r\nliac-arff==2.4.0\r\nlightgbm==2.2.3\r\nlime==0.1.1.34\r\nllvmlite==0.29.0\r\nlockfile==0.12.2\r\nMako==1.1.0\r\nMarkupSafe==1.1.1\r\nmatplotlib==3.1.0\r\nmccabe==0.6.1\r\nmemory-profiler==0.55.0\r\nmissingno==0.4.2\r\nmistune==0.8.4\r\nmleap==0.8.1\r\nmlflow==1.2.0\r\nmock==3.0.5\r\nmore-itertools==8.2.0\r\nmultiprocess==0.70.7\r\nnbconvert==5.6.1\r\nnbformat==4.4.0\r\nnest-asyncio==1.2.3\r\nnetifaces==0.10.9\r\nnetworkx==2.3\r\nnose==1.3.7\r\nnose-exclude==0.5.0\r\nnumba==0.45.1\r\nnumpy==1.16.4\r\nobjgraph==3.4.1\r\nodfpy==1.4.0\r\nopenpyxl==2.6.2\r\npackaging==19.0\r\npandas==0.24.2\r\npandas-profiling==2.3.0\r\npandocfilters==1.4.2\r\nparamz==0.9.5\r\nparso==0.6.0\r\npatsy==0.5.1\r\nPDPbox==0.2.0\r\npexpect==4.8.0\r\nphik==0.9.8\r\npickleshare==0.7.5\r\nPillow==6.0.0\r\nplotly==3.10.0\r\npluggy==0.12.0\r\nprometheus-client==0.7.1\r\npromise==2.2.1\r\nprompt-toolkit==3.0.4\r\nprotobuf==3.8.0\r\npsutil==5.6.2\r\npsycopg2==2.7.5\r\nptyprocess==0.6.0\r\npy==1.8.0\r\npy4j==0.10.7\r\npyarrow==0.14.1\r\npyasn1==0.4.5\r\npycparser==2.20\r\npydot==1.4.1\r\npyfiglet==0.8.post1\r\nPygments==2.4.2\r\nPyHive==0.6.1\r\npylint==2.4.3\r\nPympler==0.7\r\npynisher==0.5.0\r\npyparsing==2.4.0\r\npyrfr==0.8.0\r\nPyro4==4.77\r\npyrsistent==0.15.3\r\npysasl==0.5.0\r\npyspark==2.4.3\r\npytest==5.1.2\r\npytest-cov==2.7.1\r\npytest-django==3.5.1\r\npytest-mock==1.10.4\r\npytest-pylint==0.14.1\r\npython-dateutil==2.8.0\r\npython-editor==1.0.4\r\npython-jose==3.0.1\r\npython-keycloak-client==0.2.2\r\npytz==2019.1\r\nPyWavelets==1.0.3\r\nPyYAML==5.1.1\r\npyzmq==18.1.1\r\nquerystring-parser==1.2.3\r\nrabbitmq==0.2.0\r\nrequests==2.22.0\r\nretrying==1.3.3\r\nrsa==4.0\r\nruamel.yaml==0.15.97\r\nRx==1.6.1\r\ns3transfer==0.2.0\r\nsasl==0.2.1\r\nscikit-image==0.15.0\r\nscikit-learn==0.19.2\r\nscipy==1.3.0\r\nseaborn==0.9.0\r\nsee==1.4.1\r\nSend2Trash==1.5.0\r\nserpent==1.28\r\nsimplejson==3.16.0\r\nsingledispatch==3.4.0.3\r\nsix==1.14.0\r\nskater==1.0.4\r\nsmac==0.8.0\r\nsmmap2==2.0.5\r\nsnowballstemmer==1.2.1\r\nsobol-seq==0.1.2\r\nspark-celery==0.1.1\r\nSphinx==2.1.0\r\nsphinx-rtd-theme==0.4.3\r\nsphinxcontrib-applehelp==1.0.1\r\nsphinxcontrib-devhelp==1.0.1\r\nsphinxcontrib-htmlhelp==1.0.2\r\nsphinxcontrib-jsmath==1.0.1\r\nsphinxcontrib-qthelp==1.0.2\r\nsphinxcontrib-serializinghtml==1.1.3\r\nSQLAlchemy==1.3.8\r\nsqlparse==0.3.0\r\nstatsmodels==0.10.2\r\ntablib==0.13.0\r\ntabulate==0.8.3\r\ntestpath==0.4.4\r\nthrift==0.11.0\r\nthrift-sasl==0.3.0\r\ntornado==6.0.3\r\ntraitlets==4.3.2\r\ntyped-ast==1.4.0\r\ntyping==3.6.6\r\nuritemplate==3.0.0\r\nurllib3==1.25.3\r\nvine==1.3.0\r\nwcwidth==0.1.7\r\nwebencodings==0.5.1\r\nwebsocket-client==0.56.0\r\nWerkzeug==0.15.4\r\nwrapt==1.11.2\r\nxgboost==0.90\r\nxlrd==1.2.0\r\nxlwt==1.3.0\r\nyellowbrick==0.9.1\r\nzipp==0.6.0\r\n\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n1. Write a task that causes an error that does not correspond to BaseExeption.\r\n:\r\n\r\n def foo():\r\n\r\n\r\n     process = psutil.Process(os.getpid())\r\n     print(f'foo process mem info{process.memory_full_info()}')\r\n     dummy = numpy.array(numpy.random.randint(100, 200, 300000000))\r\n     print(dummy.nbytes)\r\n     idx = 0\r\n     while idx < 2:\r\n         time.sleep(1)\r\n         idx = idx + 1\r\n    raise ValueError\r\n\r\n2.  Run celery in prefork mode. Set the work volume of each worker pool to 2 or more.\r\n3.  Keep trying foo.delay()\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nResource release after appropriate handling of exceptions\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nfoo.delay()  \r\n foo process mem infopfullmem(rss=35368960, vms=384946176, shared=4370432, text=2338816, lib=0, data=300494848, dirty=0, uss=9674752, pss=21053440, swap=0)\r\n\r\nfoo process mem infopfullmem(rss=2437492736, vms=2785394688, shared=5931008, text=2338816, lib=0, data=2700943360, dirty=0, uss=2410758144, pss=2422296576, swap=0)\r\n\r\nfoo process mem infopfullmem(rss=4837507072, vms=5185384448, shared=5922816, text=2338816, lib=0, data=5100933120, dirty=0, uss=4810747904, pss=4822307840, swap=0)\r\n\r\nMemory builds up continuously", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6022", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6022/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6022/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6022/events", "html_url": "https://github.com/celery/celery/issues/6022", "id": 593410180, "node_id": "MDU6SXNzdWU1OTM0MTAxODA=", "number": 6022, "title": "task_routes - cannot set time_limit for a specific queue", "user": {"login": "itsdkey", "id": 26058315, "node_id": "MDQ6VXNlcjI2MDU4MzE1", "avatar_url": "https://avatars2.githubusercontent.com/u/26058315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itsdkey", "html_url": "https://github.com/itsdkey", "followers_url": "https://api.github.com/users/itsdkey/followers", "following_url": "https://api.github.com/users/itsdkey/following{/other_user}", "gists_url": "https://api.github.com/users/itsdkey/gists{/gist_id}", "starred_url": "https://api.github.com/users/itsdkey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itsdkey/subscriptions", "organizations_url": "https://api.github.com/users/itsdkey/orgs", "repos_url": "https://api.github.com/users/itsdkey/repos", "events_url": "https://api.github.com/users/itsdkey/events{/privacy}", "received_events_url": "https://api.github.com/users/itsdkey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-03T14:10:13Z", "updated_at": "2020-05-15T05:53:42Z", "closed_at": "2020-05-15T05:53:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [x] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [x] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.2.2 (windowlicker)\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\nBROKER_URL: 'redis://127.0.0.1:6379/2'\r\nCELERYBEAT_SCHEDULE: {\r\n }\r\nCELERY_ACCEPT_CONTENT: ['json']\r\nCELERY_ENABLE_UTC: True\r\nCELERY_QUEUES: \r\n    (<unbound Queue celery -> <unbound Exchange celery(direct)> -> celery>,\r\n <unbound Queue campaigns -> <unbound Exchange campaigns(direct)> -> campaigns>)\r\nCELERY_RESULT_SERIALIZER: 'json'\r\nCELERY_ROUTES: \r\n    ('campaigns.task_routers.CampaignRouter',)\r\nCELERY_TASK_SERIALIZER: 'json'\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.7\r\n* **Minimal Celery Version**: 4.2.2 vs. 3.1.23\r\n* **Minimal Kombu Version**: 4.3.0 vs. 3.0.35\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\namqp==2.5.2\r\nbilliard==3.5.0.5\r\ncelery==4.2.2\r\nDjango==1.8.19\r\nkombu==4.3.0\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n1. Create a minimum Django app that supports celery on python 3.7 (I've used Django==1.8.19)\r\n\r\n2. Create a task_router for example: CampaignRouter that returns a dictionary:\r\n```\r\nclass CampaignRouter(object):\r\n    def route_for_task(self, task, args=None, kwargs=None):\r\n        if task.startswith('campaigns.tasks.'):\r\n            return {\r\n                'queue': 'campaigns',\r\n                'routing_key': 'campaigns',\r\n                'time_limit': 30,  # 30sec  <<--- this is the problem\r\n            }\r\n        return None\r\n```\r\n\r\n3. Create a task that does stuff for more then 5sec (you are going to pass --time-limit=5 in the command line) for example a 600sec sleep and will be routed by your route:\r\n\r\n```\r\n@app.task(bind=True)\r\ndef my_task(self):\r\n    time.sleep(1000 * 10)   # 10sec\r\n    return 1+1\r\n```\r\n4. Run your django app\r\n5. Run celery with the --time-limit=5:\r\n`celery worker -B -A sample_proj --loglevel=DEBUG --time-limit 5`\r\n6. execute the task\r\n7. check if task run into a TimeLimitExceeded error after 5sec and cry:\r\n```\r\n    raise TimeLimitExceeded(job._timeout)\r\nbilliard.exceptions.TimeLimitExceeded: TimeLimitExceeded(5,)\r\n[2020-04-02 09:37:05,183: ERROR/MainProcess] Hard time limit (5.0s) exceeded for \r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nA task ran through the route should have the \"time_limit\" from the route's dictionary (30sec).\r\n# Actual Behavior\r\nI've included it in the TestCase scenario. The actual behevior is that the task ends after 5sec (the time passed in the command line). \r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nSo basically I see that the interface for creating a message in `celery.app.base.send_task` has changed between 3.1.23 and 4.2.2. In Celery 3.1.23 you were able to pass the 'time_limit' through your route so each task that runs through it will have that specific time_limit (hard time limit in this case). That was done thanks to the **options argument.\r\n\r\nCelery 3.1.23 code (`celery.app.base.send_task` from line 345):\r\n```\r\n        options = router.route(options, name, args, kwargs)\r\n        if connection:\r\n            producer = self.amqp.TaskProducer(connection)\r\n        with self.producer_or_acquire(producer) as P:\r\n            self.backend.on_task_call(P, task_id)\r\n            task_id = P.publish_task(\r\n                name, args, kwargs, countdown=countdown, eta=eta,\r\n                task_id=task_id, expires=expires,\r\n                callbacks=maybe_list(link), errbacks=maybe_list(link_error),\r\n                reply_to=reply_to or self.oid, **options\r\n            )\r\n```\r\n\r\nBut in Celery 4 this isn't possible because the time_limit is pass from the send_task arguments to the amqp.create_task_message() and the \"time_limit\" from the route isn't even considered.\r\n\r\nCelery 4.2.2 code (`celery.app.base.send_task` from line 716):\r\n```\r\n        options = router.route(\r\n            options, route_name or name, args, kwargs, task_type)\r\n\r\n        if not root_id or not parent_id:\r\n            parent = self.current_worker_task\r\n            if parent:\r\n                if not root_id:\r\n                    root_id = parent.request.root_id or parent.request.id\r\n                if not parent_id:\r\n                    parent_id = parent.request.id\r\n\r\n        message = amqp.create_task_message(\r\n            task_id, name, args, kwargs, countdown, eta, group_id,\r\n            expires, retries, chord,\r\n            maybe_list(link), maybe_list(link_error),\r\n            reply_to or self.oid, time_limit, soft_time_limit,\r\n            self.conf.task_send_sent_event,\r\n            root_id, parent_id, shadow, chain,\r\n            argsrepr=options.get('argsrepr'),\r\n            kwargsrepr=options.get('kwargsrepr'),\r\n        )\r\n```\r\n\r\nThis is in my opinion a big (not huge) regression because let's see this scenario of a existing project:\r\n\r\n10 django apps\r\neach app has 10tasks\r\nyour 'slow app' has 20tasks \r\n\r\nIf the project used celery 3.1.23 it just needed to create a route and set a key in the returned dictionary to like this: `{(other_keys), 'time_limit': 1000}`. But if the project decides to use the newest celery it need to add time_limit parameter to each task decorator for the slow app which will end up changing 20 places instead of handling this through the route. And what if we consider to add a new queue that will be for 'medium apps' that should have a smaller time_limit the the queue used be our 'slow app' but a bigger one the the default queue? We need to to the same job - upgrade each decorator with a specific time_limit. \r\n\r\nThis sums up to that each task can have it's own time_limit OR the global time_limit. There is no 'golden mean' which was provided in 3.1.23 thanks to routes.\r\n\r\nHow can this be fixed?\r\nMy suggestion is to consider the time_limits params from a route. To get this done the keywords can even have the same names as the celery_configs (for convention) like: [task_time_limit / task_soft_time_limit](https://docs.celeryproject.org/en/stable/userguide/workers.html)", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6021", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6021/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6021/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6021/events", "html_url": "https://github.com/celery/celery/issues/6021", "id": 593070829, "node_id": "MDU6SXNzdWU1OTMwNzA4Mjk=", "number": 6021, "title": "Handle SIGABRT and Getting Info About The Worker", "user": {"login": "aeroheart-c6", "id": 734243, "node_id": "MDQ6VXNlcjczNDI0Mw==", "avatar_url": "https://avatars2.githubusercontent.com/u/734243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aeroheart-c6", "html_url": "https://github.com/aeroheart-c6", "followers_url": "https://api.github.com/users/aeroheart-c6/followers", "following_url": "https://api.github.com/users/aeroheart-c6/following{/other_user}", "gists_url": "https://api.github.com/users/aeroheart-c6/gists{/gist_id}", "starred_url": "https://api.github.com/users/aeroheart-c6/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aeroheart-c6/subscriptions", "organizations_url": "https://api.github.com/users/aeroheart-c6/orgs", "repos_url": "https://api.github.com/users/aeroheart-c6/repos", "events_url": "https://api.github.com/users/aeroheart-c6/events{/privacy}", "received_events_url": "https://api.github.com/users/aeroheart-c6/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-03T04:37:56Z", "updated_at": "2020-05-15T05:55:13Z", "closed_at": "2020-05-15T05:55:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "### Environment\r\nsoftware -> celery:4.3.0 (rhubarb) kombu:4.6.8 py:3.6.10\r\n            billiard:3.6.3.0 redis:3.4.1\r\nplatform -> system:Linux arch:64bit\r\n            kernel version:4.9.125-linuxkit imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:redis results:disabled\r\n\r\nbroker_url: 'redis://redis:6379/0'\r\nbroker_pool_limit: 0\r\nworker_concurrency: 5\r\nworker_prefetch_multiplier: 1\r\ntask_acks_late: True\r\ntask_default_queue: 'default'\r\ntask_default_exchange: 'default'\r\n\r\nI tried to look for my question but didn't seem to come up any. I hope I am not mistaken. (Also, I can't seem to find how to post an Issue Type: Question issue)\r\n\r\n### Background\r\nI am working on a fork of Airflow in our company and my task involves making sure tasks are aborted properly when we restart the celery worker (to update the system). I've done some digging around and realised, I can extend the Worker class and attach the signal handler there. Currently, I'm testing it on SIGABRT but I'm thinking of moving it to SIGTERM when I'm done.\r\n\r\nThere are three API calls I need to do on SIGABRT in order for me to complete my logic:\r\n\r\n- get queues (`Control.broadcast(\"active_queues\")`)\r\n- cancel consumer on those queues (`Control.broadcast(\"cancel_consumer\")`)\r\n- get active tasks (`Control.broadcast(\"active\")`)\r\n\r\nIf I get these, then I can go and properly abort the Airflow tasks currently being executed by a specific worker node.\r\n\r\nWhen I do this on the Python REPL or as a separate script, these API calls work flawlessly. But when I implement them inside the Worker, I get empty results and when my function ends, I get an exception about\r\n\r\n```\r\nkombu.exceptions.OperationalError:\r\nCannot route message for exchange 'reply.celery.pidbox': Table empty or key no longer exists.\r\n```\r\n\r\nI created a sample project that contains only the code I am working on [in this repository](https://github.com/aeroheart-c6/samples-celery)\r\n\r\nThis also contains the extra script I describe about getting the worker statistics and some other convenience command to run a task and send the SIGABRT signal.\r\n\r\nWant to shed some light in this, if my approach is wrong, or if I do not need to call any API then would like to know how.\r\n\r\nThanks in advance.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6019", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6019/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6019/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6019/events", "html_url": "https://github.com/celery/celery/issues/6019", "id": 592242316, "node_id": "MDU6SXNzdWU1OTIyNDIzMTY=", "number": 6019, "title": "Unable to use mysql SSL parameters in create_engine()", "user": {"login": "alexagriffith", "id": 43711982, "node_id": "MDQ6VXNlcjQzNzExOTgy", "avatar_url": "https://avatars0.githubusercontent.com/u/43711982?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexagriffith", "html_url": "https://github.com/alexagriffith", "followers_url": "https://api.github.com/users/alexagriffith/followers", "following_url": "https://api.github.com/users/alexagriffith/following{/other_user}", "gists_url": "https://api.github.com/users/alexagriffith/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexagriffith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexagriffith/subscriptions", "organizations_url": "https://api.github.com/users/alexagriffith/orgs", "repos_url": "https://api.github.com/users/alexagriffith/repos", "events_url": "https://api.github.com/users/alexagriffith/events{/privacy}", "received_events_url": "https://api.github.com/users/alexagriffith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-01T22:31:18Z", "updated_at": "2020-04-02T18:52:50Z", "closed_at": "2020-04-02T18:52:50Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "PR for proposed fix to this issue: https://github.com/celery/celery/pull/6020\r\n\r\n# Checklist\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [x] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [x] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\nhttps://github.com/celery/celery/commit/94dae1b899aae6ae2ca333773fddbc6dd603213c \r\nThis PR was made to address the following issue, which has resulted in the issue I am having now.   https://github.com/celery/celery/issues/1930 \r\n\r\n#### Related Issues\r\n\r\nhttps://github.com/celery/celery/issues/1930\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: celery>=4.0.0 (using it in Airflow) \r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n(see Minimally Reproducible Test Case for step by step commands. This contains information leading to the issue and a proposed fix)\r\n\r\nIn Airflow, you can set celery configs. I was setting up cloudsql to use a private IP instead of a proxy. Currently, we use mysql as the `results_backend`. Changing the host address from local host to the private IP caused some errors, as expected. \r\n\r\n```\r\nOperationalError: (_mysql_exceptions.OperationalError) (1045, \"Access denied for user 'airflow'@'10.x.x.xxx' (using password: YES)\")\r\n```\r\nIn order to use the private IP, I need to use the SSL cert, key, and ca. I confirmed that by logging into the Airflow worker and scheduler pods that my url and engine arg params worked. \r\n\r\n```\r\nfrom airflow.models import DagRun \r\nfrom sqlalchemy import create_engine\r\nfrom sqlalchemy.orm import scoped_session, sessionmaker\r\ne = create_engine({AIRFLOW__CELERY__SQL_ALCHEMY_CONN},connect_args= {'ssl': {'ca': '/path-to-mysql-sslcert/server-ca', 'cert': '/path-to-mysql-sslcert/client-cert',  'key': '/path-to-mysql-sslcert/client-key'}})\r\ns = scoped_session(sessionmaker(autocommit=False, autoflush=False, bind=e))\r\ns.query(DagRun).all()\r\n```\r\n\r\nThis worked fine, so I know that the my ssl certs are accessible, the engine can be created, and a session used. Non-celery mysql connections no longer gave an error. \r\n\r\nThe Celery documentation (https://docs.celeryproject.org/en/stable/userguide/configuration.html#conf-database-result-backend) outlines how to add engine args to via `database_engine_options`. Therefore, I added \r\n```\r\n'database_engine_options': {\r\n        'connect_args': {'ssl': {'ca': '/path-to-mysql-sslcert/server-ca', 'cert': '/path-to-mysql-sslcert/client-cert', 'key': '/path-to-mysql-sslcert/client-key'}}}\r\n```\r\nHowever, I still get the same error. \r\n\r\n```\r\nOperationalError: (_mysql_exceptions.OperationalError) (1045, \"Access denied for user 'airflow'@'10.x.x.xxx' (using password: YES)\")\r\n```\r\n\r\n\r\nAdditionally, I get logs in the scheduler like the following:\r\n```\r\n {{__init__.py:56}} WARNING - Failed operation _get_task_meta_for.  Retrying 1 more times.\r\n68918-Traceback (most recent call last):\r\n68919-  File \"/usr/local/lib/python2.7/dist-packages/celery/backends/database/__init__.py\", line 51, in _inner\r\n68920-    return fun(*args, **kwargs)\r\n68921-  File \"/usr/local/lib/python2.7/dist-packages/celery/backends/database/__init__.py\", line 154, in _get_task_meta_for\r\n68922:    session = self.ResultSession()\r\n68923:  File \"/usr/local/lib/python2.7/dist-packages/celery/backends/database/__init__.py\", line 113, in ResultSession\r\n68924-    **self.engine_options)\r\n68925-  File \"/usr/local/lib/python2.7/dist-packages/celery/backends/database/session.py\", line 59, in session_factory\r\n68926-    self.prepare_models(engine)\r\n68927-  File \"/usr/local/lib/python2.7/dist-packages/celery/backends/database/session.py\", line 54, in prepare_models\r\n68928-    ResultModelBase.metadata.create_all(engine)\r\n```\r\nAfter digging through the code with @dangermike, we noticed that `get_engine` will not use the kwargs passed to it unless it has been forked.(https://github.com/celery/celery/blob/master/celery/backends/database/session.py#L34) Therefore, the SSL params will not be passed in our case. The only place that self.forked = True is after the fork cleanup session. This used to not be the case (https://github.com/celery/celery/commit/94dae1b899aae6ae2ca333773fddbc6dd603213c), but after an issue was made about passing pool_size (https://github.com/celery/celery/issues/1930), `**kwargs` were taken out of create_engine() entirely. \r\nPossibly something like the following would allow for kwargs to be passed in, while still addressing the pool params issue.\r\n\r\n```\r\nclass SessionManager(object):\r\n    # ...\r\n    def get_engine(self, dburi, **kwargs):\r\n        if self.forked:\r\n            try:\r\n                return self._engines[dburi]\r\n            except KeyError:\r\n                engine = self._engines[dburi] = create_engine(dburi, **kwargs)\r\n                return engine\r\n        else:\r\n            kwargs = dict([(k, v) for k, v in kwargs.items() if not k.startswith('pool')])\r\n            return create_engine(dburi, poolclass=NullPool, **kwargs)\r\n```\r\n\r\nwhere `kwargs = dict([(k, v) for k, v in kwargs.items() if not k.startswith('pool')])` omits any pool args while keeping the rest. \r\n\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: >=2.7\r\n* **Minimal Celery Version**: >=4.0.0\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\nUsed Airflow\r\n\r\n### Other Dependencies\r\nN/A\r\n\r\n## Minimally Reproducible Test Case\r\n\r\nIn a python shell, \r\n\r\nget the url with a private mysql IP to make result_backend, giving something like `db+mysql://airflow:***@10.x.xx.xx/airflow`\r\n\r\nand the celery config\r\n```\r\ncelery_configuration = \r\n{'broker_transport_options': {'visibility_timeout': 21600},\r\n 'result_serializer': 'pickle',\r\n 'task_acks_late': True, \r\n'database_engine_options': { 'connect_args': {'ssl': {'ca': '/path-to-mysql-sslcert/server-ca', 'cert': '/path-to-mysql-sslcert/client-cert', 'key': '/path-to-mysql-sslcert/client-key'}}}, \r\n'task_default_queue': 'default',\r\n 'worker_concurrency': 32,\r\n 'worker_prefetch_multiplier': 1, \r\n'event_serializer': 'json', \r\n'accept_content': ['json', 'pickle'], \r\n'broker_url': 'redis://{URL}/1', \r\n'result_backend': 'db+mysql://airflow:***@10.x.xx.xx/airflow', \r\n'task_default_exchange': 'default'}\r\n```\r\nthe line most important here is:\r\n` 'database_engine_options': { 'connect_args': {'ssl': {'ca': '/path-to-mysql-sslcert/server-ca', 'cert': '/path-to-mysql-sslcert/client-cert', 'key': '/path-to-mysql-sslcert/client-key'}}}`\r\n\r\nthen try to connect to result_backend by creating app.\r\n```\r\napp = Celery(celery_app_name=airflow.executors.celery_executor,\r\n    config_source=celery_configuration)\r\n```\r\n\r\ncreate a database backend \r\n```\r\ndbbe = database.DatabaseBackend(url={results_backend url without the 'db+' in the beginning}, engine_options=celery_configuration['database_engine_options'], app=app)\r\n```\r\n\r\n\r\nand you will get the error again \r\n\r\n```\r\nsqlalchemy.exc.OperationalError: (_mysql_exceptions.OperationalError) (1045, \"Access denied for user 'airflow'@'10.xx.xx.xxx' (using password: YES)\")\r\n(Background on this error at: http://sqlalche.me/e/e3q8)\r\n```\r\n\r\n\r\n\r\n# Expected Behavior\r\nIt seems like the expected behavior here would be for the connection to be successful and use the SSL certs in the **kwargs passed into `get_engine`. \r\n\r\n# Actual Behavior\r\nSince self.fork is not True, and will not be True, create_engine is made by:\r\n```\r\n            return create_engine(dburi, poolclass=NullPool)\r\n```\r\nsince the SSL certs are not included, an error is returned and the connection is _not_ successful. \r\n\r\n```\r\nsqlalchemy.exc.OperationalError: (_mysql_exceptions.OperationalError) (1045, \"Access denied for user 'airflow'@'10.xx.xx.xxx' (using password: YES)\")\r\n(Background on this error at: http://sqlalche.me/e/e3q8)\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6017", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6017/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6017/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6017/events", "html_url": "https://github.com/celery/celery/issues/6017", "id": 591135324, "node_id": "MDU6SXNzdWU1OTExMzUzMjQ=", "number": 6017, "title": "Celery Multi creates pid and log files in the wrong directory", "user": {"login": "maxmalysh", "id": 6844656, "node_id": "MDQ6VXNlcjY4NDQ2NTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/6844656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/maxmalysh", "html_url": "https://github.com/maxmalysh", "followers_url": "https://api.github.com/users/maxmalysh/followers", "following_url": "https://api.github.com/users/maxmalysh/following{/other_user}", "gists_url": "https://api.github.com/users/maxmalysh/gists{/gist_id}", "starred_url": "https://api.github.com/users/maxmalysh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/maxmalysh/subscriptions", "organizations_url": "https://api.github.com/users/maxmalysh/orgs", "repos_url": "https://api.github.com/users/maxmalysh/repos", "events_url": "https://api.github.com/users/maxmalysh/events{/privacy}", "received_events_url": "https://api.github.com/users/maxmalysh/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1028707666, "node_id": "MDU6TGFiZWwxMDI4NzA3NjY2", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Documentation", "name": "Category: Documentation", "color": "f9dd5e", "default": false, "description": ""}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 3, "created_at": "2020-03-31T14:01:20Z", "updated_at": "2020-06-01T13:32:43Z", "closed_at": "2020-05-17T05:00:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Here is what [docs](http://docs.celeryproject.org/en/latest/userguide/daemonizing.html) say**:\r\n\r\n- `CELERYD_PID_FILE` \u2014 Full path to the PID file. Default is `/var/run/celery/%n.pid`\r\n- `CELERYD_LOG_FILE` \u2014 Full path to the worker log file. Default is `/var/log/celery/%n%I.log` Note: Using %I is important when using the prefork pool as having multiple processes share the same log file will lead to race conditions.\r\n\r\n**In reality**, `celery multi` creates logs and pid files in the working directory instead of `/var/run` and `/var/log`:\r\n```\r\n--logfile=default%I.log --pidfile=default.pid\r\n```\r\n\r\n**My systemd service**:\r\n```\r\n# /etc/systemd/system/celery.service\r\n\r\n[Unit]\r\nDescription=Celery Service\r\nAfter=network.target\r\n\r\n[Service]\r\nType=forking\r\nUser=myuser\r\nRestart=always\r\nEnvironmentFile=-/etc/conf.d/celery\r\nWorkingDirectory=/home/myuser/myproject\r\n\r\nExecStart=/bin/bash -c 'source /etc/environment; \\\r\n  /home/myuser/venv/bin/celery multi start ${CELERYD_NODES} \\\r\n  -A ${CELERY_APP} ${CELERYD_OPTS}'\r\n\r\nExecStop=/bin/bash -c 'source /etc/environment; \\\r\n  /home/myuser/venv/bin/celery multi stopwait ${CELERYD_NODES}'\r\n\r\nExecReload=/bin/bash -c 'source /etc/environment; \\\r\n  /home/myuser/venv/bin/celery multi restart ${CELERYD_NODES} \\\r\n  -A ${CELERY_APP} --loglevel=\"${CELERYD_LOG_LEVEL}\" ${CELERYD_OPTS}'\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\n```\r\n\r\n**My `/etc/conf.d/celery`:**\r\n```\r\n# /etc/conf.d/celery\r\nCELERYD_NODES=\"default slow\"\r\nCELERY_APP=\"pool.celery:app\"\r\nCELERYD_MULTI=\"multi\"\r\nCELERYD_OPTS=\"-Q:1 celery -Q:2 slow --time-limit=15 --concurrency=1 -O fair -E\"\r\n```\r\n\r\n**Systemd status report:**\r\n```\r\nroot@pool1:~# sudo systemctl status celery\r\n\u25cf celery.service - Celery Service\r\n   Loaded: loaded (/etc/systemd/system/celery.service; enabled; vendor preset: enabled)\r\n   Active: active (running) since Tue 2020-03-31 13:38:02 UTC; 1min 23s ago\r\n  Process: 2648 ExecStop=/bin/bash -c source /etc/environment;    /home/myuser/venv/bin/celery multi stopwait ${CELERYD_NODES} (code=exited, status=0/SUCCESS)\r\n  Process: 2661 ExecStart=/bin/bash -c source /etc/environment;    /home/myuser/venv/bin/celery multi start ${CELERYD_NODES} -A ${CELERY_APP} ${CELERYD_OPTS} (code=exited, status=0/SUCCESS)\r\n Main PID: 27107 (code=exited, status=1/FAILURE)\r\n    Tasks: 4 (limit: 4915)\r\n   CGroup: /system.slice/celery.service\r\n           \u251c\u25002680 /home/myuser/venv/bin/python3.8 -m celery worker -A pool.celery:app --time-limit=15 --concurrency=1 -O fair -E -Q celery --logfile=default%I.log --pidfile=default.pid --hostname=default@pool1.mycorp.\r\n           \u251c\u25002688 /home/myuser/venv/bin/python3.8 -m celery worker -A pool.celery:app --time-limit=15 --concurrency=1 -O fair -E -Q slow --logfile=slow%I.log --pidfile=slow.pid --hostname=slow@pool1.mycorp.org\r\n           \u251c\u25002694 /home/myuser/venv/bin/python3.8 -m celery worker -A pool.celery:app --time-limit=15 --concurrency=1 -O fair -E -Q celery --logfile=default%I.log --pidfile=default.pid --hostname=default@pool1.mycorp.\r\n           \u2514\u25002695 /home/myuser/venv/bin/python3.8 -m celery worker -A pool.celery:app --time-limit=15 --concurrency=1 -O fair -E -Q slow --logfile=slow%I.log --pidfile=slow.pid --hostname=slow@pool1.mycorp.org\r\n```\r\n\r\n\r\n**There are three options:**\r\na. There's a bug in Celery 4.4.2\r\nb. There's a mistake in docs\r\nc. I'm missing something and everything works as expected\r\n\r\nI'm using Celery 4.4.2 on Ubuntu 18.04.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6014", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6014/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6014/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6014/events", "html_url": "https://github.com/celery/celery/issues/6014", "id": 589773460, "node_id": "MDU6SXNzdWU1ODk3NzM0NjA=", "number": 6014, "title": "No result backend is configured", "user": {"login": "venomone", "id": 43114687, "node_id": "MDQ6VXNlcjQzMTE0Njg3", "avatar_url": "https://avatars2.githubusercontent.com/u/43114687?v=4", "gravatar_id": "", "url": "https://api.github.com/users/venomone", "html_url": "https://github.com/venomone", "followers_url": "https://api.github.com/users/venomone/followers", "following_url": "https://api.github.com/users/venomone/following{/other_user}", "gists_url": "https://api.github.com/users/venomone/gists{/gist_id}", "starred_url": "https://api.github.com/users/venomone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/venomone/subscriptions", "organizations_url": "https://api.github.com/users/venomone/orgs", "repos_url": "https://api.github.com/users/venomone/repos", "events_url": "https://api.github.com/users/venomone/events{/privacy}", "received_events_url": "https://api.github.com/users/venomone/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-29T11:44:36Z", "updated_at": "2020-03-29T14:19:34Z", "closed_at": "2020-03-29T14:19:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Im currently unable to make celery using redis as a results backend as i want some of my tasks wait to finish before accepting the next one. The Problem now seems that celery does not recognize the results backend for some reason.\r\n\r\ncelery.py\r\n\r\n    import...\r\n    \r\n    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'App.settings')\r\n    \r\n    app = Celery(str(settings.SITE_NAME), broker=settings.BROKER_URL, backend=settings.CELERY_RESULT_BACKEND)\r\n    \r\n    # Using a string here means the worker doesn't have to serialize\r\n    # the configuration object to child processes.\r\n    # - namespace='CELERY' means all celery-related configuration keys\r\n    #   should have a `CELERY_` prefix.\r\n    app.config_from_object('django.conf:settings', namespace='CELERY')\r\n    \r\n    # Load task modules from all registered Django app configs.\r\n    app.autodiscover_tasks()\r\n    \r\n    \r\n    @app.task(bind=True)\r\n    def debug_task(self):\r\n        print('Request: {0!r}'.format(self.request))\r\n\r\n\r\nsettings.py\r\n\r\n    CACHES = {\r\n        \"default\": {\r\n            \"BACKEND\": \"django_redis.cache.RedisCache\",\r\n            \"LOCATION\": [\r\n                str(\"redis://\") + env.str('REDIS_HOST') + \":\" + env.str('REDIS_PORT') + str(\"/\") + env.str('REDIS_CACHE_DB')\r\n            ],\r\n            \"OPTIONS\": {\r\n                \"CLIENT_CLASS\": \"django_redis.client.DefaultClient\",\r\n                \"SOCKET_CONNECT_TIMEOUT\": 30,  # in seconds\r\n                \"SOCKET_TIMEOUT\": 30,  # in seconds\r\n                \"COMPRESSOR\": \"django_redis.compressors.zlib.ZlibCompressor\",\r\n                \"CONNECTION_POOL_KWARGS\": {\"max_connections\": env.int('REDIS_MAX_CONN'), \"retry_on_timeout\": True}\r\n            }\r\n        }\r\n    }\r\n    \r\n    # Celery Settings:\r\n    BROKER_URL = str(\"redis://\") + env.str('REDIS_HOST') + str(\":\") + env.str('REDIS_PORT')\r\n    CELERY_RESULT_BACKEND = env.str('REDIS_HOST')\r\n    CELERY_REDIS_HOST = env.str('REDIS_HOST')\r\n    CELERY_REDIS_PORT = env.str('REDIS_PORT')\r\n    CELERY_REDIS_DB = env.str('REDIS_CACHE_DB')\r\n    CELERY_CACHE_BACKEND = 'default'\r\n    CELERY_ACCEPT_CONTENT = ['application/json']\r\n    CELERY_TASK_SERIALIZER = 'json'\r\n    CELERY_RESULT_SERIALIZER = 'json'\r\n    CELERY_TIMEZONE = 'GMT'\r\n    CELERYD_TASK_SOFT_TIME_LIMIT = 300\r\n\r\n\r\nwith this settings in place I get the following error:\r\n\r\n> No result backend is configured. Please see the documentation for more\r\n> information.\r\n\r\nAccording to the docs I found here: \r\n\r\n- http://docs.celeryproject.org/en/latest/userguide/configuration.html#conf-redis-result-backend\r\n\r\n- http://docs.celeryproject.org/en/latest/django/first-steps-with-django.html#using-celery-with-django\r\n\r\nthis implementation should work I guess.\r\nTasks I trigger without using the result backend are working fine so far.\r\nFor example:\r\nWorking:\r\n\r\n    if request.method == 'GET':\r\n        example_task.delay(request.user.pk)\r\n\r\nNot Working:\r\n\r\n    if request.method == 'GET':\r\n        result = example_task.apply_async([request.user.pk])\r\n        result_output = result.wait(timeout=None, interval=0.5)\r\n\r\nLast but not least my env vars\r\n\r\n.env:\r\n\r\n    export REDIS_HOST='redis'                   # Redis hostname the application should connect with\r\n    export REDIS_PORT=6379                      # Redis port the application should connect onto\r\n    export REDIS_MAX_CONN=2500                  # Max. amount of connections the application can use\r\n    export REDIS_CACHE_DB=0                     # Table/Database of the general redis cache", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6013", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6013/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6013/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6013/events", "html_url": "https://github.com/celery/celery/issues/6013", "id": 589592001, "node_id": "MDU6SXNzdWU1ODk1OTIwMDE=", "number": 6013, "title": "Failing testsuite with Python 3.8.2", "user": {"login": "havardAasen", "id": 30108525, "node_id": "MDQ6VXNlcjMwMTA4NTI1", "avatar_url": "https://avatars3.githubusercontent.com/u/30108525?v=4", "gravatar_id": "", "url": "https://api.github.com/users/havardAasen", "html_url": "https://github.com/havardAasen", "followers_url": "https://api.github.com/users/havardAasen/followers", "following_url": "https://api.github.com/users/havardAasen/following{/other_user}", "gists_url": "https://api.github.com/users/havardAasen/gists{/gist_id}", "starred_url": "https://api.github.com/users/havardAasen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/havardAasen/subscriptions", "organizations_url": "https://api.github.com/users/havardAasen/orgs", "repos_url": "https://api.github.com/users/havardAasen/repos", "events_url": "https://api.github.com/users/havardAasen/events{/privacy}", "received_events_url": "https://api.github.com/users/havardAasen/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-03-28T14:54:44Z", "updated_at": "2020-05-15T06:20:13Z", "closed_at": "2020-05-15T06:00:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "Current version of celery 4.4.2 fails it's testsuite when run in Debian unstable, testsuite for python 3.7.7 succeeds. \r\n\r\nI also did a fast test on Fedora 32 which gave the same failure.\r\n\r\n\r\n```\r\n=================================== FAILURES ===================================\r\n________________ test_security.test_setup_security__default_app ________________\r\n\r\nargs = (<t.unit.security.test_security.test_security object at 0x7f7ceb3ca4f0>,)\r\nkeywargs = {}\r\n\r\n>   ???\r\n\r\n/usr/lib/python3.8/unittest/mock.py:1345: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n/usr/lib/python3.8/contextlib.py:113: in __enter__\r\n    return next(self.gen)\r\n/usr/lib/python3.8/unittest/mock.py:1313: in decoration_helper\r\n    arg = patching.__enter__()\r\n/usr/lib/python3.8/unittest/mock.py:1439: in __enter__\r\n    if spec is None and _is_async_obj(original):\r\n/usr/lib/python3.8/unittest/mock.py:51: in _is_async_obj\r\n    if hasattr(obj, '__func__'):\r\ncelery/local.py:146: in __getattr__\r\n    return getattr(self._get_current_object(), name)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <celery.contrib.testing.app.Trap object at 0x7f7ceb41ebb0>\r\nname = '__func__'\r\n\r\n    def __getattr__(self, name):\r\n        # Workaround to allow unittest.mock to patch this object\r\n        # in Python 3.8 and above.\r\n        if name == '_is_coroutine':\r\n            return None\r\n>       raise RuntimeError('Test depends on current_app')\r\nE       RuntimeError: Test depends on current_app\r\n\r\ncelery/contrib/testing/app.py:37: RuntimeError\r\n=============================== warnings summary ===============================\r\n\r\n```\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6008", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6008/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6008/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6008/events", "html_url": "https://github.com/celery/celery/issues/6008", "id": 586000669, "node_id": "MDU6SXNzdWU1ODYwMDA2Njk=", "number": 6008, "title": "Questions about the gunicorn and flask and celery and redis ask congestion", "user": {"login": "LinXiaoJian", "id": 11407854, "node_id": "MDQ6VXNlcjExNDA3ODU0", "avatar_url": "https://avatars0.githubusercontent.com/u/11407854?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LinXiaoJian", "html_url": "https://github.com/LinXiaoJian", "followers_url": "https://api.github.com/users/LinXiaoJian/followers", "following_url": "https://api.github.com/users/LinXiaoJian/following{/other_user}", "gists_url": "https://api.github.com/users/LinXiaoJian/gists{/gist_id}", "starred_url": "https://api.github.com/users/LinXiaoJian/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LinXiaoJian/subscriptions", "organizations_url": "https://api.github.com/users/LinXiaoJian/orgs", "repos_url": "https://api.github.com/users/LinXiaoJian/repos", "events_url": "https://api.github.com/users/LinXiaoJian/events{/privacy}", "received_events_url": "https://api.github.com/users/LinXiaoJian/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 7096, "node_id": "MDU6TGFiZWw3MDk2", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Enhancement", "name": "Issue Type: Enhancement", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-23T07:49:15Z", "updated_at": "2020-05-15T06:01:06Z", "closed_at": "2020-05-15T06:01:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "python 3.7  flask 1.1.1 Redis 3.3.11\r\n\r\nWhen I use the flask and celery, I found my task will be jam, I sent the task have not received any response, after I restart the program, all blocked tasks will appear together, I have ruled out the problem on the business code, at the moment, I really think that other possibilities\r\n\r\nThis is my setup\r\n\r\n```python\r\ndef celery_task(app):\r\n    celery = Celery(name, backend=backend, include=['app.service.celery_task_service'])\r\n    celery.conf.update(\r\n        broker_url=broker_url,\r\n        task_default_queue=queue,\r\n        worker_log_format='%(asctime)s - %(name)s - %(filename)s - %(levelname)s - %(lineno)d - %(message)s',\r\n        worker_concurrency=4,\r\n        worker_max_tasks_per_child=200,\r\n        result_expires=1200\r\n    )\r\n\r\n    class ContextTask(celery.Task):\r\n        def __call__(self, *args, **kwargs):\r\n            with app.app_context():\r\n                return self.run(*args, **kwargs)\r\n\r\n    celery.Task = ContextTask\r\n    ext.celery = celery\r\n    ext.celery.start(argv=['celery', 'worker', '-Q', queue, '-l', 'info', '-n', name])\r\n```\r\n\r\ngunicorn\r\n\r\n```gunicorn\r\nimport multiprocessing\r\n\r\nworkers = multiprocessing.cpu_count()\r\nbind = \"0.0.0.0:8080\"\r\nthreads = multiprocessing.cpu_count() * 5\r\nloglevel = 'info'\r\ntimeout = 300\r\n```\r\n\r\nrequirements.txt\r\n```python\r\npika\r\naniso8601==8.0.0\r\narrow==0.15.5\r\nattrs==19.3.0\r\ncertifi==2019.11.28\r\ncffi==1.13.2\r\nchardet==3.0.4\r\nClick==7.0\r\ncryptography==2.8\r\ndocopt==0.6.2\r\nenum34==1.1.6\r\nFlask==1.1.1\r\nFlask-Caching==1.8.0\r\nFlask-Cors==3.0.8\r\nfuture==0.18.2\r\nidna==2.8\r\nimportlib-metadata==1.4.0\r\nitsdangerous==1.1.0\r\nJinja2==2.10.3\r\nMarkupSafe==1.1.1\r\nmore-itertools==8.1.0\r\nmypy==0.761\r\nmypy-extensions==0.4.3\r\npackaging==20.0\r\npeewee==3.13.1\r\nphonenumbers==8.11.1\r\npluggy==0.13.1\r\nprotobuf==3.11.2\r\npy==1.8.1\r\npycparser==2.19\r\nPyMySQL==0.9.3\r\npyparsing==2.4.6\r\npytest==5.3.2\r\npython-dateutil==2.8.1\r\npytz==2019.3\r\nredis==3.3.11\r\nrequests==2.22.0\r\nsix==1.13.0\r\ntablestore==5.1.0\r\ntyped-ast==1.4.0\r\ntyping-extensions==3.7.4.1\r\nurllib3==1.25.7\r\nvalidator.py==1.3.0\r\nwcwidth==0.1.8\r\nWerkzeug==0.16.0\r\nyarg==0.1.9\r\nzipp==0.6.0\r\nsentry-sdk==0.14.0\r\nyunpian_python_sdk==1.0.0\r\nupyun==2.5.4\r\npyencrypt-plus==1.0.0\r\nFlask-APScheduler==1.11.0\r\ndacite==1.2.0\r\nCelery==4.4.1\r\npypinyin==0.37.0\r\nCrypto==1.4.1\r\n```\r\n\r\nThis happens a lot, and I later configured task_time_limit and used the timer to resend the task to resolve the blockage, which worked fine, but I was still confused about the cause of the jam.\r\n\r\nI doubt it has anything to do with gunicorn, as I haven't had this problem with directly booting flask locally\r\n\r\nAny ideas? Thanks", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/6003", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/6003/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/6003/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/6003/events", "html_url": "https://github.com/celery/celery/issues/6003", "id": 582965238, "node_id": "MDU6SXNzdWU1ODI5NjUyMzg=", "number": 6003, "title": "celery log level error print all log", "user": {"login": "chiragkanhasoft", "id": 27885527, "node_id": "MDQ6VXNlcjI3ODg1NTI3", "avatar_url": "https://avatars0.githubusercontent.com/u/27885527?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiragkanhasoft", "html_url": "https://github.com/chiragkanhasoft", "followers_url": "https://api.github.com/users/chiragkanhasoft/followers", "following_url": "https://api.github.com/users/chiragkanhasoft/following{/other_user}", "gists_url": "https://api.github.com/users/chiragkanhasoft/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiragkanhasoft/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiragkanhasoft/subscriptions", "organizations_url": "https://api.github.com/users/chiragkanhasoft/orgs", "repos_url": "https://api.github.com/users/chiragkanhasoft/repos", "events_url": "https://api.github.com/users/chiragkanhasoft/events{/privacy}", "received_events_url": "https://api.github.com/users/chiragkanhasoft/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-17T12:06:52Z", "updated_at": "2020-03-18T04:49:59Z", "closed_at": "2020-03-18T04:31:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have setup celery in my project and i run worker using celery -A scraper_api worker -l error to print any error if there.\r\n\r\nBut it is printing all logs. Please check below image.\r\n\r\n![image](https://user-images.githubusercontent.com/27885527/76854857-e1624e80-6875-11ea-86e6-e32922697252.png)\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5996", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5996/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5996/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5996/events", "html_url": "https://github.com/celery/celery/issues/5996", "id": 578134286, "node_id": "MDU6SXNzdWU1NzgxMzQyODY=", "number": 5996, "title": "Control.revoke can be get list of task ids", "user": {"login": "TalRoni", "id": 47279201, "node_id": "MDQ6VXNlcjQ3Mjc5MjAx", "avatar_url": "https://avatars2.githubusercontent.com/u/47279201?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TalRoni", "html_url": "https://github.com/TalRoni", "followers_url": "https://api.github.com/users/TalRoni/followers", "following_url": "https://api.github.com/users/TalRoni/following{/other_user}", "gists_url": "https://api.github.com/users/TalRoni/gists{/gist_id}", "starred_url": "https://api.github.com/users/TalRoni/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TalRoni/subscriptions", "organizations_url": "https://api.github.com/users/TalRoni/orgs", "repos_url": "https://api.github.com/users/TalRoni/repos", "events_url": "https://api.github.com/users/TalRoni/events{/privacy}", "received_events_url": "https://api.github.com/users/TalRoni/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1028707666, "node_id": "MDU6TGFiZWwxMDI4NzA3NjY2", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Documentation", "name": "Category: Documentation", "color": "f9dd5e", "default": false, "description": ""}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 0, "created_at": "2020-03-09T19:17:50Z", "updated_at": "2020-03-10T18:50:46Z", "closed_at": "2020-03-10T05:01:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3A%22Category%3A+Documentation%22+)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues in this issue\r\n      (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Description\r\n<!--\r\nPlease describe what's missing or incorrect about our documentation.\r\nInclude links and/or screenshots which will aid us to resolve the issue.\r\n-->\r\nThe existing documentation does not show the option to send some tasks ids\r\n\r\n# Suggestions\r\n<!-- Please provide us suggestions for how to fix the documentation -->\r\nUpdate the document", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5995", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5995/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5995/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5995/events", "html_url": "https://github.com/celery/celery/issues/5995", "id": 578051589, "node_id": "MDU6SXNzdWU1NzgwNTE1ODk=", "number": 5995, "title": "keyerror: 'USER' when use supervisord but working in command line", "user": {"login": "pcleon", "id": 2787937, "node_id": "MDQ6VXNlcjI3ODc5Mzc=", "avatar_url": "https://avatars3.githubusercontent.com/u/2787937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pcleon", "html_url": "https://github.com/pcleon", "followers_url": "https://api.github.com/users/pcleon/followers", "following_url": "https://api.github.com/users/pcleon/following{/other_user}", "gists_url": "https://api.github.com/users/pcleon/gists{/gist_id}", "starred_url": "https://api.github.com/users/pcleon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pcleon/subscriptions", "organizations_url": "https://api.github.com/users/pcleon/orgs", "repos_url": "https://api.github.com/users/pcleon/repos", "events_url": "https://api.github.com/users/pcleon/events{/privacy}", "received_events_url": "https://api.github.com/users/pcleon/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235027917, "node_id": "MDU6TGFiZWwyMzUwMjc5MTc=", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Needs%20Verification%20%E2%9C%98", "name": "Status: Needs Verification \u2718", "color": "0052cc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-03-09T16:57:49Z", "updated_at": "2020-03-21T02:31:29Z", "closed_at": "2020-03-21T02:30:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "celery: 4.4.1\r\npython: 2.7.5\r\nos: centos-7.2\r\n\r\ni use celery with django prj.  and it works under shell when i run \r\n`celery worker -A mysite -l info\r\n`\r\nbut not works when use supervisord, the ini like this \r\n```\r\n[program:celery]\r\ncommand=/usr/bin/celery  worker -A nemopy -l info\r\ndirectory=/home/mysite\r\nuser=web \r\nautorestart=true\r\nredirect_stderr=true\r\nstdout_logfile=/tmp/celery.log\r\n\r\n```\r\n\r\nthen i get these error log \r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/usr/bin/celery\", line 8, in <module>\r\n    sys.exit(main())\r\n  File \"/usr/lib/python2.7/site-packages/celery/__main__.py\", line 16, in main\r\n    _main()\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/celery.py\", line 322, in main\r\n    cmd.execute_from_commandline(argv)\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/celery.py\", line 495, in execute_from_commandline\r\n    super(CeleryCommand, self).execute_from_commandline(argv)))\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/base.py\", line 305, in execute_from_commandline\r\n    return self.handle_argv(self.prog_name, argv[1:])\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/celery.py\", line 487, in handle_argv\r\n    return self.execute(command, argv)\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/celery.py\", line 419, in execute\r\n    ).run_from_argv(self.prog_name, argv[1:], command=argv[0])\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/worker.py\", line 223, in run_from_argv\r\n    return self(*args, **options)\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/base.py\", line 253, in __call__\r\n    ret = self.run(*args, **kwargs)\r\n  File \"/usr/lib/python2.7/site-packages/celery/bin/worker.py\", line 258, in run\r\n    **kwargs)\r\n  File \"/usr/lib/python2.7/site-packages/celery/worker/worker.py\", line 96, in __init__\r\n    self.app.loader.init_worker()\r\n  File \"/usr/lib/python2.7/site-packages/celery/loaders/base.py\", line 114, in init_worker\r\n    self.import_default_modules()\r\n  File \"/usr/lib/python2.7/site-packages/celery/loaders/base.py\", line 108, in import_default_modules\r\n    raise response\r\nKeyError: 'USER'\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5994", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5994/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5994/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5994/events", "html_url": "https://github.com/celery/celery/issues/5994", "id": 577729303, "node_id": "MDU6SXNzdWU1Nzc3MjkzMDM=", "number": 5994, "title": "TypeError in make_connection, unexpected keyword argument 'socket_keepalive'", "user": {"login": "jaap3", "id": 48517, "node_id": "MDQ6VXNlcjQ4NTE3", "avatar_url": "https://avatars1.githubusercontent.com/u/48517?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaap3", "html_url": "https://github.com/jaap3", "followers_url": "https://api.github.com/users/jaap3/followers", "following_url": "https://api.github.com/users/jaap3/following{/other_user}", "gists_url": "https://api.github.com/users/jaap3/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaap3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaap3/subscriptions", "organizations_url": "https://api.github.com/users/jaap3/orgs", "repos_url": "https://api.github.com/users/jaap3/repos", "events_url": "https://api.github.com/users/jaap3/events{/privacy}", "received_events_url": "https://api.github.com/users/jaap3/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 6, "created_at": "2020-03-09T08:17:19Z", "updated_at": "2020-03-16T11:51:47Z", "closed_at": "2020-03-16T07:45:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Checklist\r\n\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [ ] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [x] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n\r\n#### Related Issues\r\n\r\n- #5952\r\n- #2903\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n\r\n**Celery version**: 4.4.1\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n\r\n### Python Packages\r\n\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n```\r\nredis==3.4.1\r\nbilliard==3.6.3.0\r\ncelery==4.4.1\r\nkombu==4.6.8\r\n```\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n\r\nCelery just works\r\n\r\n# Actual Behavior\r\n\r\nAfter upgrading Celery from 4.4.0 to 4.4.1 I suddenly see `TypeError: __init__() got an unexpected keyword argument 'socket_keepalive'`.\r\n\r\nThis seems to be caused by PR #5952, which adds this kwarg for Redis connections. However, not all Redis connection constructors take the same arguments (e.g. `UnixDomainSocketConnection` doesn't take `socket_keepalive`). This seems to be happened before as noted in issue #2903.\r\n\r\nEverything works fine if I downgrade to 4.4.0 again.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5991", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5991/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5991/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5991/events", "html_url": "https://github.com/celery/celery/issues/5991", "id": 576387187, "node_id": "MDU6SXNzdWU1NzYzODcxODc=", "number": 5991, "title": "worker shutdown when running long task", "user": {"login": "IterableTrucks", "id": 42210451, "node_id": "MDQ6VXNlcjQyMjEwNDUx", "avatar_url": "https://avatars0.githubusercontent.com/u/42210451?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IterableTrucks", "html_url": "https://github.com/IterableTrucks", "followers_url": "https://api.github.com/users/IterableTrucks/followers", "following_url": "https://api.github.com/users/IterableTrucks/following{/other_user}", "gists_url": "https://api.github.com/users/IterableTrucks/gists{/gist_id}", "starred_url": "https://api.github.com/users/IterableTrucks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IterableTrucks/subscriptions", "organizations_url": "https://api.github.com/users/IterableTrucks/orgs", "repos_url": "https://api.github.com/users/IterableTrucks/repos", "events_url": "https://api.github.com/users/IterableTrucks/events{/privacy}", "received_events_url": "https://api.github.com/users/IterableTrucks/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 226795379, "node_id": "MDU6TGFiZWwyMjY3OTUzNzk=", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Has%20Testcase%20%E2%9C%94", "name": "Status: Has Testcase \u2714", "color": "0052cc", "default": false, "description": null}, {"id": 235027917, "node_id": "MDU6TGFiZWwyMzUwMjc5MTc=", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Needs%20Verification%20%E2%9C%98", "name": "Status: Needs Verification \u2718", "color": "0052cc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-03-05T16:42:00Z", "updated_at": "2020-08-11T03:02:09Z", "closed_at": "2020-08-11T03:01:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [x] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- https://github.com/celery/celery/issues/5868\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\nsoftware -> celery:4.4.1 (cliffs) kombu:4.6.8 py:3.7.4\r\n            billiard:3.6.3.0 py-amqp:2.5.2\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:3.10.0-957.21.3.el7.x86_64 imp:CPython\r\nloader   -> celery.loaders.default.Loader\r\nsettings -> transport:amqp results:disabled\r\n\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: 4.4.1\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: redis/3.2.12\r\n* **Minimal Result Backend Version**: redis/3.2.12\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\namqp==2.5.2\r\nbilliard==3.6.3.0\r\ncelery==4.4.1\r\nimportlib-metadata==1.5.0\r\nkombu==4.6.8\r\npytz==2019.3\r\nredis==3.4.1\r\nvine==1.3.0\r\nzipp==3.1.0\r\n\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\napp file is task_4_4.py\r\n\r\n```python\r\nimport time\r\nfrom celery import Celery\r\nfrom celery.signals import task_received\r\nfrom celery.contrib.abortable import AbortableTask\r\nredis_url=\"redis://localhost/2\"\r\napp=Celery(broker=redis_url,backend=redis_url)\r\n@app.task(bind=True,base=AbortableTask,acks_late=False)\r\ndef add(self,x,y):\r\n    time.sleep(x)\r\n    return x+y\r\n@app.task(bind=True)\r\ndef mul(self,x,y):\r\n    return x*y\r\n```\r\n\r\nstart worker \r\n\r\n```bash\r\ncelery worker -c 1 -l debug -A task_4_4\r\n```\r\nsend tasks to the worker\r\n\r\n```python\r\nfrom task_4_4 import add\r\nimport time\r\nresult1=add.delay(18000,11)\r\ntime.sleep(7200)\r\nresult2=add.delay(10,12)\r\nresult3=add.delay(1,13)\r\n```\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nworker executes tasks normally\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\ncelery debug output file:\r\n<details>\r\n/root/celery/venv_4/lib/python3.7/site-packages/celery/platforms.py:801: RuntimeWarning: You're running the worker with superuser privileges: this is\r\nabsolutely not recommended!\r\n\r\nPlease specify a different user using the --uid option.\r\n\r\nUser information: uid=0 euid=0 gid=0 egid=0\r\n\r\n  uid=uid, euid=euid, gid=gid, egid=egid,\r\n[2020-03-04 23:38:51,487: DEBUG/MainProcess] | Worker: Preparing bootsteps.\r\n[2020-03-04 23:38:51,488: DEBUG/MainProcess] | Worker: Building graph...\r\n[2020-03-04 23:38:51,489: DEBUG/MainProcess] | Worker: New boot order: {Beat, StateDB, Timer, Hub, Pool, Autoscaler, Consumer}\r\n[2020-03-04 23:38:51,498: DEBUG/MainProcess] | Consumer: Preparing bootsteps.\r\n[2020-03-04 23:38:51,498: DEBUG/MainProcess] | Consumer: Building graph...\r\n[2020-03-04 23:38:51,515: DEBUG/MainProcess] | Consumer: New boot order: {Connection, Events, Mingle, Gossip, Tasks, Control, Heart, Agent, event loop}\r\n[2020-03-04 23:38:51,524: DEBUG/MainProcess] | Worker: Starting Hub\r\n[2020-03-04 23:38:51,524: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:51,524: DEBUG/MainProcess] | Worker: Starting Pool\r\n[2020-03-04 23:38:51,537: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:51,537: DEBUG/MainProcess] | Worker: Starting Consumer\r\n[2020-03-04 23:38:51,538: DEBUG/MainProcess] | Consumer: Starting Connection\r\n[2020-03-04 23:38:51,554: INFO/MainProcess] Connected to redis://localhost:6379/2\r\n[2020-03-04 23:38:51,554: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:51,554: DEBUG/MainProcess] | Consumer: Starting Events\r\n[2020-03-04 23:38:51,560: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:51,560: DEBUG/MainProcess] | Consumer: Starting Mingle\r\n[2020-03-04 23:38:51,560: INFO/MainProcess] mingle: searching for neighbors\r\n[2020-03-04 23:38:52,577: INFO/MainProcess] mingle: all alone\r\n[2020-03-04 23:38:52,577: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:52,577: DEBUG/MainProcess] | Consumer: Starting Gossip\r\n[2020-03-04 23:38:52,580: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:52,580: DEBUG/MainProcess] | Consumer: Starting Tasks\r\n[2020-03-04 23:38:52,583: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:52,583: DEBUG/MainProcess] | Consumer: Starting Control\r\n[2020-03-04 23:38:52,585: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:52,586: DEBUG/MainProcess] | Consumer: Starting Heart\r\n[2020-03-04 23:38:52,587: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-04 23:38:52,587: DEBUG/MainProcess] | Consumer: Starting event loop\r\n[2020-03-04 23:38:52,587: DEBUG/MainProcess] | Worker: Hub.register Pool...\r\n[2020-03-04 23:38:52,587: INFO/MainProcess] celery@VM_0_6_centos ready.\r\n[2020-03-04 23:38:52,588: DEBUG/MainProcess] basic.qos: prefetch_count->4\r\n[2020-03-04 23:39:58,427: INFO/MainProcess] Received task: task_4_4.add[e5e6a491-febf-4bf9-8ff1-d31c0f8b45b5]  \r\n[2020-03-04 23:39:58,427: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fcd0214b7a0> (args:('task_4_4.add', 'e5e6a491-febf-4bf9-8ff1-d31c0f8b45b5', {'lang': 'py', 'task': 'task_4_4.add', 'id': 'e5e6a491-febf-4bf9-8ff1-d31c0f8b45b5', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': 'e5e6a491-febf-4bf9-8ff1-d31c0f8b45b5', 'parent_id': None, 'argsrepr': '(18000, 11)', 'kwargsrepr': '{}', 'origin': 'gen7195@VM_0_6_centos', 'reply_to': '7f0f5f08-37d3-33c0-8560-6404392956f3', 'correlation_id': 'e5e6a491-febf-4bf9-8ff1-d31c0f8b45b5', 'hostname': 'celery@VM_0_6_centos', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}, 'args': [18000, 11], 'kwargs': {}}, b'[[18000, 11], {}, {\"callbacks\": null, \"errbacks\": null, \"chain\": null, \"chord\": null}]', 'application/json', 'utf-8') kwargs:{})\r\n[2020-03-04 23:39:58,429: DEBUG/MainProcess] Task accepted: task_4_4.add[e5e6a491-febf-4bf9-8ff1-d31c0f8b45b5] pid:6979\r\n[2020-03-05 01:39:58,530: INFO/MainProcess] Received task: task_4_4.add[692978f1-df60-430e-acaa-87a224624bfc]  \r\n[2020-03-05 01:39:58,532: INFO/MainProcess] Received task: task_4_4.add[9dd6a5d2-1efb-41f2-91f8-7da458b6795e]  \r\n[2020-03-05 02:40:22,966: INFO/MainProcess] Received task: task_4_4.add[692978f1-df60-430e-acaa-87a224624bfc]  \r\n[2020-03-05 02:40:22,967: INFO/MainProcess] Received task: task_4_4.add[9dd6a5d2-1efb-41f2-91f8-7da458b6795e]  \r\n\r\nRestarting celery worker (/root/celery/venv_4/bin/celery worker -c 1 -l debug -A task_4_4)\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Worker: Closing Hub...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Worker: Closing Pool...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Worker: Closing Consumer...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Worker: Stopping Consumer...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing Connection...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing Events...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing Mingle...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing Gossip...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing Tasks...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing Control...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing Heart...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Closing event loop...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Stopping event loop...\r\n[2020-03-05 02:54:26,797: DEBUG/MainProcess] | Consumer: Stopping Heart...\r\n[2020-03-05 02:54:26,802: DEBUG/MainProcess] | Consumer: Stopping Control...\r\n[2020-03-05 02:54:26,803: DEBUG/MainProcess] | Consumer: Stopping Tasks...\r\n[2020-03-05 02:54:26,803: DEBUG/MainProcess] Canceling task consumer...\r\n[2020-03-05 02:54:26,803: DEBUG/MainProcess] | Consumer: Stopping Gossip...\r\n[2020-03-05 02:54:26,805: DEBUG/MainProcess] | Consumer: Stopping Mingle...\r\n[2020-03-05 02:54:26,805: DEBUG/MainProcess] | Consumer: Stopping Events...\r\n[2020-03-05 02:54:26,805: DEBUG/MainProcess] | Consumer: Stopping Connection...\r\n[2020-03-05 02:54:26,805: DEBUG/MainProcess] | Worker: Stopping Pool...\r\n[2020-03-05 02:54:27,306: ERROR/MainProcess] Process 'ForkPoolWorker-1' pid:6979 exited with 'exitcode 70'\r\n[2020-03-05 02:54:27,319: ERROR/MainProcess] Task handler raised error: WorkerLostError('Worker exited prematurely: exitcode 70.')\r\nTraceback (most recent call last):\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/worker/worker.py\", line 205, in start\r\n    self.blueprint.start(self)\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/bootsteps.py\", line 119, in start\r\n    step.start(parent)\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/bootsteps.py\", line 369, in start\r\n    return self.obj.start()\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/worker/consumer/consumer.py\", line 318, in start\r\n    blueprint.start(self)\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/bootsteps.py\", line 119, in start\r\n    step.start(parent)\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/worker/consumer/consumer.py\", line 599, in start\r\n    c.loop(*c.loop_args())\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/worker/loops.py\", line 74, in asynloop\r\n    state.maybe_shutdown()\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/celery/worker/state.py\", line 80, in maybe_shutdown\r\n    raise WorkerShutdown(should_stop)\r\ncelery.exceptions.WorkerShutdown: 0\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/root/celery/venv_4/lib/python3.7/site-packages/billiard/pool.py\", line 1267, in mark_as_worker_lost\r\n    human_status(exitcode)),\r\nbilliard.exceptions.WorkerLostError: Worker exited prematurely: exitcode 70.\r\n[2020-03-05 02:54:27,319: DEBUG/MainProcess] | Worker: Stopping Hub...\r\n[2020-03-05 02:54:27,319: DEBUG/MainProcess] | Consumer: Shutdown Heart...\r\n[2020-03-05 02:54:27,319: DEBUG/MainProcess] | Consumer: Shutdown Control...\r\n[2020-03-05 02:54:27,319: DEBUG/MainProcess] | Consumer: Shutdown Tasks...\r\n[2020-03-05 02:54:27,320: DEBUG/MainProcess] Canceling task consumer...\r\n[2020-03-05 02:54:27,320: DEBUG/MainProcess] Closing consumer channel...\r\n[2020-03-05 02:54:27,320: DEBUG/MainProcess] | Consumer: Shutdown Gossip...\r\n[2020-03-05 02:54:27,320: DEBUG/MainProcess] | Consumer: Shutdown Events...\r\n[2020-03-05 02:54:27,320: DEBUG/MainProcess] | Consumer: Shutdown Connection...\r\n/root/celery/venv_4/lib/python3.7/site-packages/celery/platforms.py:801: RuntimeWarning: You're running the worker with superuser privileges: this is\r\nabsolutely not recommended!\r\n\r\nPlease specify a different user using the --uid option.\r\n\r\nUser information: uid=0 euid=0 gid=0 egid=0\r\n\r\n  uid=uid, euid=euid, gid=gid, egid=egid,\r\n[2020-03-05 02:54:27,713: DEBUG/MainProcess] | Worker: Preparing bootsteps.\r\n[2020-03-05 02:54:27,714: DEBUG/MainProcess] | Worker: Building graph...\r\n[2020-03-05 02:54:27,714: DEBUG/MainProcess] | Worker: New boot order: {Beat, Timer, Hub, Pool, Autoscaler, StateDB, Consumer}\r\n[2020-03-05 02:54:27,723: DEBUG/MainProcess] | Consumer: Preparing bootsteps.\r\n[2020-03-05 02:54:27,723: DEBUG/MainProcess] | Consumer: Building graph...\r\n[2020-03-05 02:54:27,740: DEBUG/MainProcess] | Consumer: New boot order: {Connection, Events, Mingle, Tasks, Control, Heart, Agent, Gossip, event loop}\r\n[2020-03-05 02:54:27,749: DEBUG/MainProcess] | Worker: Starting Hub\r\n[2020-03-05 02:54:27,749: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:27,749: DEBUG/MainProcess] | Worker: Starting Pool\r\n[2020-03-05 02:54:27,761: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:27,762: DEBUG/MainProcess] | Worker: Starting Consumer\r\n[2020-03-05 02:54:27,762: DEBUG/MainProcess] | Consumer: Starting Connection\r\n[2020-03-05 02:54:27,777: INFO/MainProcess] Connected to redis://localhost:6379/2\r\n[2020-03-05 02:54:27,778: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:27,778: DEBUG/MainProcess] | Consumer: Starting Events\r\n[2020-03-05 02:54:27,783: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:27,784: DEBUG/MainProcess] | Consumer: Starting Mingle\r\n[2020-03-05 02:54:27,784: INFO/MainProcess] mingle: searching for neighbors\r\n[2020-03-05 02:54:28,800: INFO/MainProcess] mingle: all alone\r\n[2020-03-05 02:54:28,800: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:28,800: DEBUG/MainProcess] | Consumer: Starting Tasks\r\n[2020-03-05 02:54:28,803: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:28,803: DEBUG/MainProcess] | Consumer: Starting Control\r\n[2020-03-05 02:54:28,806: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:28,806: DEBUG/MainProcess] | Consumer: Starting Heart\r\n[2020-03-05 02:54:28,807: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:28,807: DEBUG/MainProcess] | Consumer: Starting Gossip\r\n[2020-03-05 02:54:28,809: DEBUG/MainProcess] ^-- substep ok\r\n[2020-03-05 02:54:28,810: DEBUG/MainProcess] | Consumer: Starting event loop\r\n[2020-03-05 02:54:28,810: DEBUG/MainProcess] | Worker: Hub.register Pool...\r\n[2020-03-05 02:54:28,810: INFO/MainProcess] celery@VM_0_6_centos ready.\r\n[2020-03-05 02:54:28,810: DEBUG/MainProcess] basic.qos: prefetch_count->4\r\n[2020-03-05 02:54:29,122: INFO/MainProcess] Received task: task_4_4.add[9dd6a5d2-1efb-41f2-91f8-7da458b6795e]  \r\n[2020-03-05 02:54:29,122: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fc064cac7a0> (args:('task_4_4.add', '9dd6a5d2-1efb-41f2-91f8-7da458b6795e', {'lang': 'py', 'task': 'task_4_4.add', 'id': '9dd6a5d2-1efb-41f2-91f8-7da458b6795e', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '9dd6a5d2-1efb-41f2-91f8-7da458b6795e', 'parent_id': None, 'argsrepr': '(1, 13)', 'kwargsrepr': '{}', 'origin': 'gen7195@VM_0_6_centos', 'redelivered': True, 'reply_to': '7f0f5f08-37d3-33c0-8560-6404392956f3', 'correlation_id': '9dd6a5d2-1efb-41f2-91f8-7da458b6795e', 'hostname': 'celery@VM_0_6_centos', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}, 'args': [1, 13], 'kwargs': {}}, b'[[1, 13], {}, {\"callbacks\": null, \"errbacks\": null, \"chain\": null, \"chord\": null}]', 'application/json', 'utf-8') kwargs:{})\r\n[2020-03-05 02:54:29,124: INFO/MainProcess] Received task: task_4_4.add[692978f1-df60-430e-acaa-87a224624bfc]  \r\n[2020-03-05 02:54:29,124: DEBUG/MainProcess] Task accepted: task_4_4.add[9dd6a5d2-1efb-41f2-91f8-7da458b6795e] pid:10494\r\n[2020-03-05 02:54:30,128: INFO/ForkPoolWorker-1] Task task_4_4.add[9dd6a5d2-1efb-41f2-91f8-7da458b6795e] succeeded in 1.0049351528286934s: 14\r\n[2020-03-05 02:54:30,128: DEBUG/MainProcess] TaskPool: Apply <function _fast_trace_task at 0x7fc064cac7a0> (args:('task_4_4.add', '692978f1-df60-430e-acaa-87a224624bfc', {'lang': 'py', 'task': 'task_4_4.add', 'id': '692978f1-df60-430e-acaa-87a224624bfc', 'shadow': None, 'eta': None, 'expires': None, 'group': None, 'retries': 0, 'timelimit': [None, None], 'root_id': '692978f1-df60-430e-acaa-87a224624bfc', 'parent_id': None, 'argsrepr': '(10, 12)', 'kwargsrepr': '{}', 'origin': 'gen7195@VM_0_6_centos', 'redelivered': True, 'reply_to': '7f0f5f08-37d3-33c0-8560-6404392956f3', 'correlation_id': '692978f1-df60-430e-acaa-87a224624bfc', 'hostname': 'celery@VM_0_6_centos', 'delivery_info': {'exchange': '', 'routing_key': 'celery', 'priority': 0, 'redelivered': None}, 'args': [10, 12], 'kwargs': {}}, b'[[10, 12], {}, {\"callbacks\": null, \"errbacks\": null, \"chain\": null, \"chord\": null}]', 'application/json', 'utf-8') kwargs:{})\r\n[2020-03-05 02:54:30,129: DEBUG/MainProcess] Task accepted: task_4_4.add[692978f1-df60-430e-acaa-87a224624bfc] pid:10494\r\n[2020-03-05 02:54:40,139: INFO/ForkPoolWorker-1] Task task_4_4.add[692978f1-df60-430e-acaa-87a224624bfc] succeeded in 10.010058987885714s: 22\r\n</details>\r\nAs the debug output implies, celery worker shutdown 3 hours after it received the first task.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5990", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5990/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5990/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5990/events", "html_url": "https://github.com/celery/celery/issues/5990", "id": 575717156, "node_id": "MDU6SXNzdWU1NzU3MTcxNTY=", "number": 5990, "title": "TypeError: _iter_meta() got an unexpected keyword argument 'timeout'", "user": {"login": "zeonn", "id": 786821, "node_id": "MDQ6VXNlcjc4NjgyMQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/786821?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zeonn", "html_url": "https://github.com/zeonn", "followers_url": "https://api.github.com/users/zeonn/followers", "following_url": "https://api.github.com/users/zeonn/following{/other_user}", "gists_url": "https://api.github.com/users/zeonn/gists{/gist_id}", "starred_url": "https://api.github.com/users/zeonn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zeonn/subscriptions", "organizations_url": "https://api.github.com/users/zeonn/orgs", "repos_url": "https://api.github.com/users/zeonn/repos", "events_url": "https://api.github.com/users/zeonn/events{/privacy}", "received_events_url": "https://api.github.com/users/zeonn/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 2, "created_at": "2020-03-04T19:50:02Z", "updated_at": "2020-03-04T21:37:20Z", "closed_at": "2020-03-04T21:37:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "bug in version celery 4.4.1\r\n\r\nversion celery 4.4.0 works well\r\n\r\nredis version 5.0\r\n\r\npyton packege redis version 3.4.1\r\n\r\nfile: celery/backends/redis.py, line 150\r\n`for meta in result._iter_meta(**kwargs):`", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5988", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5988/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5988/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5988/events", "html_url": "https://github.com/celery/celery/issues/5988", "id": 575623570, "node_id": "MDU6SXNzdWU1NzU2MjM1NzA=", "number": 5988, "title": "TLS-enabled Redis configuration: the ssl_cert_reqs is wrongly documented", "user": {"login": "NBardelot", "id": 11333203, "node_id": "MDQ6VXNlcjExMzMzMjAz", "avatar_url": "https://avatars3.githubusercontent.com/u/11333203?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NBardelot", "html_url": "https://github.com/NBardelot", "followers_url": "https://api.github.com/users/NBardelot/followers", "following_url": "https://api.github.com/users/NBardelot/following{/other_user}", "gists_url": "https://api.github.com/users/NBardelot/gists{/gist_id}", "starred_url": "https://api.github.com/users/NBardelot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NBardelot/subscriptions", "organizations_url": "https://api.github.com/users/NBardelot/orgs", "repos_url": "https://api.github.com/users/NBardelot/repos", "events_url": "https://api.github.com/users/NBardelot/events{/privacy}", "received_events_url": "https://api.github.com/users/NBardelot/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-04T17:54:38Z", "updated_at": "2020-03-18T08:08:51Z", "closed_at": "2020-03-12T16:35:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "See source file: celery/backends/redis.py\r\n\r\nThe documentation says:\r\n\r\n> Note that the ssl_cert_reqs string should be one of required, optional, or none (though, for backwards compatibility, the string may also be one of CERT_REQUIRED, CERT_OPTIONAL, CERT_NONE).\r\n\r\nBut with 'required':\r\n\r\n`AttributeError: module 'ssl' has no attribute 'required'`\r\n\r\nIt seems that CERT_REQUIRED, CERT_OPTIONAL and CERT_NONE *must* be used...", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5987", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5987/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5987/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5987/events", "html_url": "https://github.com/celery/celery/issues/5987", "id": 575262444, "node_id": "MDU6SXNzdWU1NzUyNjI0NDQ=", "number": 5987, "title": "set --concurrency or not make a different result", "user": {"login": "NICK-DUAN", "id": 22417013, "node_id": "MDQ6VXNlcjIyNDE3MDEz", "avatar_url": "https://avatars3.githubusercontent.com/u/22417013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NICK-DUAN", "html_url": "https://github.com/NICK-DUAN", "followers_url": "https://api.github.com/users/NICK-DUAN/followers", "following_url": "https://api.github.com/users/NICK-DUAN/following{/other_user}", "gists_url": "https://api.github.com/users/NICK-DUAN/gists{/gist_id}", "starred_url": "https://api.github.com/users/NICK-DUAN/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NICK-DUAN/subscriptions", "organizations_url": "https://api.github.com/users/NICK-DUAN/orgs", "repos_url": "https://api.github.com/users/NICK-DUAN/repos", "events_url": "https://api.github.com/users/NICK-DUAN/events{/privacy}", "received_events_url": "https://api.github.com/users/NICK-DUAN/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235027917, "node_id": "MDU6TGFiZWwyMzUwMjc5MTc=", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Needs%20Verification%20%E2%9C%98", "name": "Status: Needs Verification \u2718", "color": "0052cc", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-04T09:42:41Z", "updated_at": "2020-05-15T06:07:06Z", "closed_at": "2020-05-15T06:06:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "in my project, we use redis as my broken, and my server has 4 cpu, so i use the default concurrency param(default = (cpu cpunt)), but sometimes my task always send to a same worker, in order to make sure it, i print the pid, all tasks use a same worker. here is part of the settings file:\r\n```\r\ncelery_app = Celery('ktest', broker=ConfigCelery.broker, backend=ConfigCelery.backend)\r\ncelery_app.conf.update(result_expires=3600, timezone=\"Asia/Shanghai\", worker_hijack_root_logger=False)\r\n\r\nif __name__ == '__main__':\r\n    celery_app.start()\r\n```\r\nactivate cmd:\r\n```\r\ncelery worker -A ktest_worker.app --loglevel=INFO\r\n```\r\nI don't know why, but when i use --concurrency=4 or -c 4, it worked, My task will be a cannon by a random worker\u3002\r\n\r\nactivate cmd \uff1a\r\n```\r\ncelery worker -A ktest_worker.app --loglevel=INFO -c 4\r\n```\r\nso i want to know, What's the difference between setting the concurrency or not\u3002It's important for me!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5982", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5982/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5982/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5982/events", "html_url": "https://github.com/celery/celery/issues/5982", "id": 572675068, "node_id": "MDU6SXNzdWU1NzI2NzUwNjg=", "number": 5982, "title": "How to link a task to an other running task", "user": {"login": "NullYing", "id": 10618381, "node_id": "MDQ6VXNlcjEwNjE4Mzgx", "avatar_url": "https://avatars2.githubusercontent.com/u/10618381?v=4", "gravatar_id": "", "url": "https://api.github.com/users/NullYing", "html_url": "https://github.com/NullYing", "followers_url": "https://api.github.com/users/NullYing/followers", "following_url": "https://api.github.com/users/NullYing/following{/other_user}", "gists_url": "https://api.github.com/users/NullYing/gists{/gist_id}", "starred_url": "https://api.github.com/users/NullYing/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/NullYing/subscriptions", "organizations_url": "https://api.github.com/users/NullYing/orgs", "repos_url": "https://api.github.com/users/NullYing/repos", "events_url": "https://api.github.com/users/NullYing/events{/privacy}", "received_events_url": "https://api.github.com/users/NullYing/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-28T10:45:08Z", "updated_at": "2020-03-17T13:25:59Z", "closed_at": "2020-03-13T05:52:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nfeature requests which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3A%22Issue+Type%3A+Feature+Request%22+)\r\n  for similar or identical feature requests.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?utf8=%E2%9C%93&q=is%3Apr+label%3A%22PR+Type%3A+Feature%22+)\r\n  for existing proposed implementations of this feature.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the if the same feature was already implemented in the\r\n  master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Brief Summary\r\n<!--\r\nPlease include a brief summary of what the feature does\r\nand why it is needed.\r\n-->\r\n\r\n# Design\r\n\r\n## Architectural Considerations\r\n<!--\r\nIf more components other than Celery are involved,\r\ndescribe them here and the effect it would have on Celery.\r\n-->\r\nHow to link a task to an other running task\r\n\r\nlike this?\r\n```python\r\nresult = celery.AsyncResult(parents_task.task_id)\r\nresult.add_children(new_task_id)\r\n```\r\n## Proposed Behavior\r\n<!--\r\nPlease describe in detail how this feature is going to behave.\r\nDescribe what happens in case of failures as well if applicable.\r\n-->\r\n\r\n## Proposed UI/UX\r\n<!--\r\nPlease provide your ideas for the API, CLI options,\r\nconfiguration key names etc. that will be introduced for this feature.\r\n-->\r\n\r\n## Diagrams\r\n<!--\r\nPlease include any diagrams that might be relevant\r\nto the implementation of this feature such as:\r\n* Class Diagrams\r\n* Sequence Diagrams\r\n* Activity Diagrams\r\nYou can drag and drop images into the text box to attach them to this issue.\r\n-->\r\nN/A\r\n\r\n## Alternatives\r\n<!--\r\nIf you have considered any alternative implementations\r\ndescribe them in detail below.\r\n-->\r\nNone\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5981", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5981/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5981/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5981/events", "html_url": "https://github.com/celery/celery/issues/5981", "id": 572620297, "node_id": "MDU6SXNzdWU1NzI2MjAyOTc=", "number": 5981, "title": "Getting the SVG logo of Celery", "user": {"login": "ranrib", "id": 24767098, "node_id": "MDQ6VXNlcjI0NzY3MDk4", "avatar_url": "https://avatars2.githubusercontent.com/u/24767098?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ranrib", "html_url": "https://github.com/ranrib", "followers_url": "https://api.github.com/users/ranrib/followers", "following_url": "https://api.github.com/users/ranrib/following{/other_user}", "gists_url": "https://api.github.com/users/ranrib/gists{/gist_id}", "starred_url": "https://api.github.com/users/ranrib/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ranrib/subscriptions", "organizations_url": "https://api.github.com/users/ranrib/orgs", "repos_url": "https://api.github.com/users/ranrib/repos", "events_url": "https://api.github.com/users/ranrib/events{/privacy}", "received_events_url": "https://api.github.com/users/ranrib/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 400596400, "node_id": "MDU6TGFiZWw0MDA1OTY0MDA=", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Project%20Governance", "name": "Category: Project Governance", "color": "f9d0c4", "default": false, "description": null}, {"id": 46813, "node_id": "MDU6TGFiZWw0NjgxMw==", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Feature%20Request", "name": "Issue Type: Feature Request", "color": "0d0000", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-02-28T09:04:25Z", "updated_at": "2020-06-30T06:06:17Z", "closed_at": "2020-06-30T06:06:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "# Checklist\r\n\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3A%22Issue+Type%3A+Feature+Request%22+)\r\n  for similar or identical feature requests.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?utf8=%E2%9C%93&q=is%3Apr+label%3A%22PR+Type%3A+Feature%22+)\r\n  for existing proposed implementations of this feature.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the if the same feature was already implemented in the\r\n  master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n# Request\r\nHi there! I would love to have the celery logo as an SVG please. Can you share it in the repo please?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5973", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5973/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5973/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5973/events", "html_url": "https://github.com/celery/celery/issues/5973", "id": 572212355, "node_id": "MDU6SXNzdWU1NzIyMTIzNTU=", "number": 5973, "title": "maximum recursion depth exceeded for a canvas in Celery 4.4.0 (cliffs)", "user": {"login": "anilaratna2", "id": 23530579, "node_id": "MDQ6VXNlcjIzNTMwNTc5", "avatar_url": "https://avatars1.githubusercontent.com/u/23530579?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anilaratna2", "html_url": "https://github.com/anilaratna2", "followers_url": "https://api.github.com/users/anilaratna2/followers", "following_url": "https://api.github.com/users/anilaratna2/following{/other_user}", "gists_url": "https://api.github.com/users/anilaratna2/gists{/gist_id}", "starred_url": "https://api.github.com/users/anilaratna2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anilaratna2/subscriptions", "organizations_url": "https://api.github.com/users/anilaratna2/orgs", "repos_url": "https://api.github.com/users/anilaratna2/repos", "events_url": "https://api.github.com/users/anilaratna2/events{/privacy}", "received_events_url": "https://api.github.com/users/anilaratna2/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 226428149, "node_id": "MDU6TGFiZWwyMjY0MjgxNDk=", "url": "https://api.github.com/repos/celery/celery/labels/Component:%20Canvas", "name": "Component: Canvas", "color": "f7c6c7", "default": false, "description": null}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 46814, "node_id": "MDU6TGFiZWw0NjgxNA==", "url": "https://api.github.com/repos/celery/celery/labels/Status:%20Confirmed%20%E2%9C%94", "name": "Status: Confirmed \u2714", "color": "ff9900", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": {"login": "thedrow", "id": 48936, "node_id": "MDQ6VXNlcjQ4OTM2", "avatar_url": "https://avatars2.githubusercontent.com/u/48936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedrow", "html_url": "https://github.com/thedrow", "followers_url": "https://api.github.com/users/thedrow/followers", "following_url": "https://api.github.com/users/thedrow/following{/other_user}", "gists_url": "https://api.github.com/users/thedrow/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedrow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedrow/subscriptions", "organizations_url": "https://api.github.com/users/thedrow/orgs", "repos_url": "https://api.github.com/users/thedrow/repos", "events_url": "https://api.github.com/users/thedrow/events{/privacy}", "received_events_url": "https://api.github.com/users/thedrow/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "thedrow", "id": 48936, "node_id": "MDQ6VXNlcjQ4OTM2", "avatar_url": "https://avatars2.githubusercontent.com/u/48936?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thedrow", "html_url": "https://github.com/thedrow", "followers_url": "https://api.github.com/users/thedrow/followers", "following_url": "https://api.github.com/users/thedrow/following{/other_user}", "gists_url": "https://api.github.com/users/thedrow/gists{/gist_id}", "starred_url": "https://api.github.com/users/thedrow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thedrow/subscriptions", "organizations_url": "https://api.github.com/users/thedrow/orgs", "repos_url": "https://api.github.com/users/thedrow/repos", "events_url": "https://api.github.com/users/thedrow/events{/privacy}", "received_events_url": "https://api.github.com/users/thedrow/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 3, "created_at": "2020-02-27T16:48:15Z", "updated_at": "2020-04-26T13:11:00Z", "closed_at": "2020-04-26T13:11:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\n\r\n-->\r\n# Checklist\r\n<!--\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first. (No option to post for me)\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected). - Celery 4.4.0 (cliffs)\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [x] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies. Works in Celery 4.1\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version 4.4.0 (cliffs)**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n```\r\nsig = signature('any_taskname', queue='any_q')\r\nchain( [ chain( sig ) ] ).apply_async()\r\n```\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 2.7\r\n* **Minimal Celery Version**: 4.4\r\n* **Minimal Kombu Version**: 4.6.7\r\n* **Minimal Broker Version**: N/A \r\n* **Minimal Result Backend Version**: N/A \r\n* **Minimal OS and/or Kernel Version**: N/A\r\n* **Minimal Broker Client Version**: N/A\r\n* **Minimal Result Backend Client Version**: N/A\r\n\r\n### Python Packages\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\n\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```\r\nsig = signature('any_taskname', queue='any_q')\r\nchain( [ chain( sig ) ] ).apply_async()\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\nIt should publish task 'any_taskname' to queue 'any_q'\r\n\r\n# Actual Behavior\r\nMax recursion depth exceeded\r\n```\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 30, in <module>\r\n    chain([chain(s2)]).apply_async() # issue\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 642, in apply_async\r\n    dict(self.options, **options) if options else self.options))\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 660, in run\r\n    task_id, group_id, chord,\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 721, in prepare_steps\r\n    task = task.clone(args, kwargs)\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 620, in clone\r\n    for sig in signature.kwargs['tasks']\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 1513, in maybe_signature\r\n    d = d.clone()\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 620, in clone\r\n    for sig in signature.kwargs['tasks']\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 1513, in maybe_signature\r\n    d = d.clone()\r\n...\r\n..\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 620, in clone\r\n    for sig in signature.kwargs['tasks']\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 1513, in maybe_signature\r\n    d = d.clone()\r\nkeeps repeating\r\n..\r\n..\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 617, in clone\r\n    signature = Signature.clone(self, *args, **kwargs)\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 272, in clone\r\n    app=self._app)\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 153, in from_dict\r\n    return target_cls.from_dict(d, app=app)\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 599, in from_dict\r\n    return _upgrade(d, _chain(tasks, app=app, **d['options']))\r\n  File \"/bb/bin/dl/celery/4.4/celery/canvas.py\", line 602, in __init__\r\n    tasks = (regen(tasks[0]) if len(tasks) == 1 and is_list(tasks[0])\r\n  File \"/bb/bin/dl/celery/4.4/kombu/utils/functional.py\", line 256, in is_list\r\n    return isinstance(l, iters) and not isinstance(l, scalars or ())\r\n  File \"/opt/bb/lib/python2.7/abc.py\", line 132, in __instancecheck__\r\n    if subclass is not None and subclass in cls._abc_cache:\r\n  File \"/opt/bb/lib/python2.7/_weakrefset.py\", line 72, in __contains__\r\n    wr = ref(item)\r\nRuntimeError: maximum recursion depth exceeded\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5970", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5970/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5970/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5970/events", "html_url": "https://github.com/celery/celery/issues/5970", "id": 571861239, "node_id": "MDU6SXNzdWU1NzE4NjEyMzk=", "number": 5970, "title": "How to continue the task in the chain interrupted after the cellery is restartedHow to continue the task in the chain interrupted after the cellery is restarted", "user": {"login": "yanwencheng", "id": 11845393, "node_id": "MDQ6VXNlcjExODQ1Mzkz", "avatar_url": "https://avatars2.githubusercontent.com/u/11845393?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yanwencheng", "html_url": "https://github.com/yanwencheng", "followers_url": "https://api.github.com/users/yanwencheng/followers", "following_url": "https://api.github.com/users/yanwencheng/following{/other_user}", "gists_url": "https://api.github.com/users/yanwencheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/yanwencheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yanwencheng/subscriptions", "organizations_url": "https://api.github.com/users/yanwencheng/orgs", "repos_url": "https://api.github.com/users/yanwencheng/repos", "events_url": "https://api.github.com/users/yanwencheng/events{/privacy}", "received_events_url": "https://api.github.com/users/yanwencheng/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-02-27T06:50:47Z", "updated_at": "2020-05-15T06:05:13Z", "closed_at": "2020-05-15T06:05:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "After executing the chain task, I restart the cell ry and find that the sishandler task is always in the started state. What should I do to deal with the interrupted task after the cell ry is restarted\r\n\r\nCall command\r\n\r\n> chain=get_effective_record_info.s(\"6633557293243826176\")|sisHandler.s()\r\n> chain()\r\n\r\nthe code\r\n```\r\n@app.task(name=\"\u83b7\u53d6\u6709\u6548\u91c7\u96c6\u6570\u636etask\")\r\ndef get_effective_record_info(wmId):\r\n    # \u83b7\u53d6\u6a21\u578b\u4e0b\u4f20\u611f\u5668\u4fe1\u606f\r\n    device_info_data = modelUtil.my_custom_sql(\r\n        \"select a.wfn_id,a.wfn_wd_id,b.wd_except_time from wlw_feature_normal a left join wlw_device b on b.wd_id=a.wfn_wd_id where a.wfn_wm_id=%s\" % (wmId))\r\n    # \u5faa\u73af\u83b7\u53d6\u8bbe\u5907\u91c7\u96c6\u6570\u636e\r\n    eritResult={\"wmId\":wmId,\"wfn_ids\":[]}#\u5b9a\u4e49task\u5904\u7406\u7ed3\u679cdict\uff0c\u4fdd\u5b58 wmId\uff0c\u4ee5\u53ca\u7279\u5f81\u4e0b\u5b58\u5728\u6570\u636e\u5f97\u7279\u5f81\u4e3b\u952e\u6570\u7ec4\r\n    for row in pd.DataFrame(device_info_data).itertuples():\r\n        wfn_id = getattr(row, \"wfn_id\")\r\n        wfn_wd_id = getattr(row, \"wfn_wd_id\")\r\n        record_info_sql = 'select * from wlw_record_info where wri_wd_id=%s and wri_human_status=\"%s\"' % (wfn_wd_id,'normal')\r\n        try:\r\n            # \u629b\u5f02\u5e38\u4e0d\u8865\u83b7\uff0c\u4efb\u52a1\u6ca1\u6709\u6392\u9664\u65f6\u95f4\u8303\u56f4\r\n            wd_except_time = json.loads(getattr(row, \"wd_except_time\"))\r\n            record_info_sql = record_info_sql +' and '+ ' and '.join(\r\n                ['%s not between \"%s\" and \"%s\"' % ('wri_create_time', m.get(\"start\"), m.get(\"end\")) for m in\r\n                 wd_except_time])\r\n        except:\r\n            pass\r\n        record_info_data=modelUtil.my_custom_sql(record_info_sql)\r\n        # \u5224\u65ad\u662f\u5426\u5b58\u5728\u91c7\u96c6\u6570\u636e\uff0c\u5b58\u5728\u5219\u5b58\u50a8\u4e3acsv\uff0c\u5e76\u4e14\u4f5c\u4e3a\u53cd\u56de\u503c\u6dfb\u52a0\u5230taskResult\r\n        if len(record_info_data):\r\n            eritResult[\"wfn_ids\"].append(wfn_id)\r\n            pd.DataFrame(record_info_data).to_csv(fileUtil.none_path_make(settings.YKKJ_FILE_PATH_ENUM.get(\"MODEL_DATA_PATH\")%(wmId))+\"/%s.csv\"%(wfn_id),encoding=\"utf-8\",index=False)\r\n        # print(wfn_id, wfn_wd_id, len(aaa))\r\n    return eritResult\r\n\r\n@app.task(name=\"\u5904\u7406\u91c7\u96c6\u6570\u636e\u5bf9\u5e94\u7684\u56e0\u7d20\")\r\ndef sisHandler(eritResult):\r\n    sleep(120)\r\n    print(\"===============\u6267\u884c\u5b8c\u4e86\")\r\n    return eritResult\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5968", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5968/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5968/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5968/events", "html_url": "https://github.com/celery/celery/issues/5968", "id": 570784383, "node_id": "MDU6SXNzdWU1NzA3ODQzODM=", "number": 5968, "title": "Celery does not support TLS with RabbitMQ and RPC backend", "user": {"login": "ginsburgnm", "id": 5425723, "node_id": "MDQ6VXNlcjU0MjU3MjM=", "avatar_url": "https://avatars0.githubusercontent.com/u/5425723?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ginsburgnm", "html_url": "https://github.com/ginsburgnm", "followers_url": "https://api.github.com/users/ginsburgnm/followers", "following_url": "https://api.github.com/users/ginsburgnm/following{/other_user}", "gists_url": "https://api.github.com/users/ginsburgnm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ginsburgnm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ginsburgnm/subscriptions", "organizations_url": "https://api.github.com/users/ginsburgnm/orgs", "repos_url": "https://api.github.com/users/ginsburgnm/repos", "events_url": "https://api.github.com/users/ginsburgnm/events{/privacy}", "received_events_url": "https://api.github.com/users/ginsburgnm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-25T19:33:14Z", "updated_at": "2020-03-05T17:19:03Z", "closed_at": "2020-03-05T17:19:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports. (Yeah, the bug's just closed #5678 )\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- #5678 \r\n\r\n#### Possible Duplicates\r\n\r\n- #5678 \r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.0 (cliffs)\r\n\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.0 (cliffs) kombu:4.6.7 py:3.6.9\r\n            billiard:3.6.1.0 py-amqp:2.5.2\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:4.15.0-88-generic imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:pyamqp results:rpc://guest:**@localhost:5672//\r\n\r\naccept_content: ['json']\r\nbroker_url: 'amqp://guest:********@localhost:5672//'\r\nbroker_use_ssl: {\r\n    'ca_certs': '/home/n0g/certs/privates/home/testca/ca_certificate.pem',\r\n    'cert_reqs': <VerifyMode.CERT_OPTIONAL: 1>,\r\n    'certfile': '/home/n0g/certs/privates/home/server/server_certificate.pem',\r\n    'keyfile': '********',\r\n    'ssl_version': <_SSLMethod.PROTOCOL_TLS: 2>}\r\nenable_utc: True\r\nimports:\r\n    ('*********************',)\r\nos: <module 'os' from '/usr/lib/python3.6/os.py'>\r\nresult_backend: 'rpc://guest:********@localhost:5672//'\r\nresult_persistent: True\r\nresult_serializer: 'json'\r\nssl: <module 'ssl' from '/usr/lib/python3.6/ssl.py'>\r\ntask_annotations: {\r\n    '***********************************': {   'rate_limit': '6/h',\r\n                                              'serializer': 'json'}}\r\ntask_serializer: 'json'\r\ntimezone: 'UTC'\r\n\r\n```\r\n\r\n\r\nBut let's try a run output too\r\n\r\n\r\n\r\n```\r\n -------------- celery@nginsburg-desktop v4.4.0 (cliffs)\r\n--- ***** -----\r\n-- ******* ---- Linux-4.15.0-88-generic-x86_64-with-Ubuntu-18.04-bionic 2020-02-25 12:53:38\r\n- *** --- * ---\r\n- ** ---------- [config]\r\n- ** ---------- .> app:         __main__:0x7fd0390eb160\r\n- ** ---------- .> transport:   amqp://guest:**@localhost:5672//\r\n- ** ---------- .> results:     rpc://\r\n- *** --- * --- .> concurrency: 4 (prefork)\r\n-- ******* ---- .> task events: OFF (enable -E to monitor tasks in this worker)\r\n--- ***** -----\r\n -------------- [queues]\r\n                .> celery           exchange=celery(direct) key=celery\r\n\r\n\r\n[tasks]\r\n  . ***************************\r\n\r\n[2020-02-25 12:53:39,235: ERROR/MainProcess] consumer: Cannot connect to amqp://guest:**@127.0.0.1:5672//: [SSL: SSLV3_ALERT_HANDSHAKE_FAILURE] sslv3 alert handshake failure (_ssl.c:852).\r\nTrying again in 2.00 seconds... (1/100)\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n- setup rabbitmq for tls\r\n- setup a celery app to use rabbitmq and rpc\r\n- try to run the celery app\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.6.9\r\n* **Minimal Celery Version**: 4.4.0\r\n* **Minimal Kombu Version**: 4.6.7\r\n* **Minimal Broker Version**: RabbitMQ 3.8.2\r\n* **Minimal Result Backend Version**: amqp 2.5.2\r\nal OS and/or Kernel Version**: 4.15.0-88-generic #88-Ubuntu SMP Tue Feb 11 20:11:34 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.5.2\r\nAPScheduler==3.6.3\r\nasn1crypto==1.3.0\r\nastroid==2.3.3\r\nattrs==19.3.0\r\nbcrypt==3.1.7\r\nbilliard==3.6.1.0\r\nblinker==1.4\r\ncelery==4.4.0\r\ncertifi==2019.11.28\r\ncffi==1.13.2\r\nchardet==3.0.4\r\ncli-helpers==1.2.1\r\nClick==7.0\r\nconfigobj==5.0.6\r\ncryptography==2.8\r\ndecorator==4.4.1\r\ndocopt==0.6.2\r\nenum34==1.1.6\r\nfilelock==3.0.12\r\nFlask==1.1.1\r\nFlask-SQLAlchemy==2.4.1\r\ngenson==1.1.0\r\ngunicorn==20.0.4\r\nhumanize==0.5.1\r\nidna==2.8\r\nimportlib-metadata==1.4.0\r\nipaddress==1.0.23\r\nisort==4.3.21\r\nitsdangerous==1.1.0\r\nJinja2==2.11.0\r\nkafka==1.3.5\r\nkombu==4.6.7\r\nlazy-object-proxy==1.4.3\r\nldap3==2.6.1\r\nlibmfa==1.0.2\r\nMarkupSafe==1.1.1\r\nmccabe==0.6.1\r\nmirakuru==2.1.2\r\nmore-itertools==8.2.0\r\nnetaddr==0.7.19\r\nntlm-auth==1.4.0\r\npackaging==20.1\r\nparamiko==2.7.1\r\npg8000==1.13.2\r\npgcli==2.2.0\r\npgspecial==1.11.9\r\npkg-resources==0.0.0\r\npluggy==0.13.1\r\nport-for==0.4\r\nprompt-toolkit==2.0.10\r\npsutil==5.6.7\r\npsycopg2==2.8.4\r\npy==1.8.1\r\npyasn1==0.4.8\r\npycparser==2.19\r\nPygments==2.5.2\r\npylint==2.4.4\r\npylint-flask-sqlalchemy==0.2.0\r\nPyNaCl==1.3.0\r\npyOpenSSL==19.1.0\r\npyparsing==2.4.6\r\npyproxy==1.0.0\r\npyrsistent==0.15.7\r\nPySocks==1.7.1\r\npyTenable==1.0.5\r\npytest==5.3.5\r\npytest-postgresql==2.2.1\r\npython-dateutil==2.8.1\r\npytz==2019.3\r\nPyYAML==5.3\r\nrequests==2.22.0\r\nrequests-ntlm==1.1.0\r\nscp==0.13.2\r\nscramp==1.1.0\r\nsemver==2.9.0\r\nsetproctitle==1.1.10\r\nsix==1.13.0\r\nSQLAlchemy==1.3.13\r\nSQLAlchemy-Utils==0.36.1\r\nsqlparse==0.3.0\r\ntabulate==0.8.6\r\nterminaltables==3.1.0\r\ntesting.common.database==2.0.3\r\ntesting.postgresql==1.3.0\r\ntoml==0.10.0\r\ntox==3.14.3\r\ntyped-ast==1.4.1\r\ntzlocal==2.0.0\r\nurllib3==1.25.8\r\nvine==1.3.0\r\nvirtualenv==16.7.9\r\nwcwidth==0.1.8\r\nWerkzeug==0.16.1\r\nwrapt==1.11.2\r\nxmltodict==0.12.0\r\nzipp==2.1.0\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\n\r\nrabbitmq.conf\r\n```\r\nssl_options.cacertfile = /home/testca/ca_certificate.pem\r\nssl_options.certfile   = /home/server/server_certificate.pem\r\nssl_options.keyfile    = /home/server/private_key.pem\r\nssl_options.verify     = verify_peer\r\nssl_options.fail_if_no_peer_cert = false\r\nssl_options.versions.1 = tlsv1.2\r\nssl_options.versions.2 = tlsv1.1\r\nlisteners.ssl.default = 5672\r\nlisteners.tcp  = none\r\nmanagement.ssl.port       = 15672\r\nmanagement.ssl.cacertfile = /home/testca/ca_certificate.pem\r\nmanagement.ssl.certfile   = /home/server/server_certificate.pem\r\nmanagement.ssl.keyfile    = /home/server/private_key.pem\r\nmanagement.ssl.verify     = verify_peer\r\nmanagement.ssl.fail_if_no_peer_cert = false\r\n```\r\n\r\n</p>\r\n<p>\r\n\r\nceleryconfig.py\r\n```\r\nimport os\r\nimport ssl\r\n\r\n  # pylint: disable=invalid-name\r\nbroker_use_ssl = {\r\n    # 'keyfile': '/tmp/certs/private_key.pem',\r\n    'keyfile': os.path.expanduser('~/certs/privates/home/server/private_key.pem'),\r\n    # 'keyfile': '/tmp/certs/privates/home/testca/private/ca_private_key.pem',\r\n    'certfile': os.path.expanduser('~/certs/privates/home/server/server_certificate.pem'),\r\n    'ca_certs': os.path.expanduser('~/certs/privates/home/testca/ca_certificate.pem'),\r\n    'cert_reqs': ssl.CERT_OPTIONAL,\r\n    'ssl_version': ssl.PROTOCOL_TLS\r\n}\r\nbroker_url = os.environ.get('BROKER_URL', default=\"pyamqp://guest:guest@localhost:5672//\")\r\nresult_backend = os.environ.get('RESULT_BACKEND_URL', default=\"rpc://guest:guest@localhost:5672//\")\r\n\r\ntask_serializer = 'json'\r\nresult_serializer = 'json'\r\naccept_content = ['json']\r\ntimezone = 'UTC'\r\nenable_utc = True\r\n\r\nimports = (\r\n    '*****************************',\r\n)\r\n\r\ntask_annotations = {\r\n    '*******************************': {\r\n    'rate_limit': '6/h',\r\n     'serializer': 'json',\r\n     }\r\n}\r\n\r\nresult_persistent = True\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```python\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nI would expect celery to be able to utilize TLSv1.2, so that a connection would be established between celery and rabbitmq over ssl\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nas you can see in the celery output; it is not attempting to communicate over TLS. Which means either the client or the server does not support TLSv1.2. As the default  python protocol documentation states `Selects the highest protocol version that both the client and server support. Despite the name, this option can select both \u201cSSL\u201d and \u201cTLS\u201d protocols.`\r\n\r\nSo let's use openssl to checkout what our server supports\r\n\r\n```\r\n> openssl s_client -connect localhost:5672\r\n...stuff you don't care about ...\r\n---\r\nNew, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384\r\nServer public key is 2048 bit\r\nSecure Renegotiation IS supported\r\nCompression: NONE\r\nExpansion: NONE\r\nNo ALPN negotiated\r\nSSL-Session:\r\n    Protocol  : TLSv1.2\r\n    Cipher    : ECDHE-RSA-AES256-GCM-SHA384\r\n    Session-ID: E44641B94F8A8B6AF58CEC96A2C672C4736B24ACAC7FF690F52FFCC622A8E4B6\r\n    Session-ID-ctx:\r\n    Master-Key: FC57236B845D281943D0079D1EAFE5AA84A746B59D75787935D2E1921440CFB23C38DD3D21924A78551601CC4FB338B3\r\n    PSK identity: None\r\n    PSK identity hint: None\r\n    SRP username: None\r\n    Start Time: 1582652429\r\n    Timeout   : 7200 (sec)\r\n    Verify return code: 19 (self signed certificate in certificate chain)\r\n    Extended master secret: no\r\n---\r\nclosed\r\n```\r\n\r\nRabbitmq is running with a TLS1.2 listener. So the server is not the issue during this communication. It must be the client.\r\n\r\nIn the related issue it was commented that\r\n\r\n>You can set the SSL version using broker_use_ssl using the ssl_version key if you are using SNI.\r\nSSL3 shouldn't be the default.\r\n\r\nsetting `ssl_version` to `ssl.PROTOCOL_TLS` or even `ssl.PROTOCOL_TLSv1_2` still results in SSLv3; so this is not a solution; even though your report says TLS version 2; that's not what is actually used.\r\n\r\nAlso on the linked issue: \r\n> However, the error goes away if I change the RabbitMQ config to: {fail_if_no_peer_cert, false}\r\n\r\nThis is no longer the case. I can hit the RabbitMQ web page with this set from my browser, however celery is still not able to contact the queue. Meaning my browser can communicate with RabbitMQ\r\n\r\nTurning encryption off allows communication.\r\n\r\nPlease let me know if you need more information.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5967", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5967/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5967/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5967/events", "html_url": "https://github.com/celery/celery/issues/5967", "id": 570096929, "node_id": "MDU6SXNzdWU1NzAwOTY5Mjk=", "number": 5967, "title": "Cannot build docs", "user": {"login": "nolash", "id": 9886925, "node_id": "MDQ6VXNlcjk4ODY5MjU=", "avatar_url": "https://avatars1.githubusercontent.com/u/9886925?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nolash", "html_url": "https://github.com/nolash", "followers_url": "https://api.github.com/users/nolash/followers", "following_url": "https://api.github.com/users/nolash/following{/other_user}", "gists_url": "https://api.github.com/users/nolash/gists{/gist_id}", "starred_url": "https://api.github.com/users/nolash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nolash/subscriptions", "organizations_url": "https://api.github.com/users/nolash/orgs", "repos_url": "https://api.github.com/users/nolash/repos", "events_url": "https://api.github.com/users/nolash/events{/privacy}", "received_events_url": "https://api.github.com/users/nolash/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1028707666, "node_id": "MDU6TGFiZWwxMDI4NzA3NjY2", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Documentation", "name": "Category: Documentation", "color": "f9dd5e", "default": false, "description": ""}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-02-24T19:46:51Z", "updated_at": "2020-05-15T06:08:38Z", "closed_at": "2020-05-15T06:08:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n\r\n- [X] I have checked the [issues list](https://github.com/celery/celery/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3A%22Category%3A+Documentation%22+)\r\n  for similar or identical bug reports.\r\n- [X] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [X] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [X] I have included all related issues and possible duplicate issues in this issue\r\n      (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Description\r\n<!--\r\nPlease describe what's missing or incorrect about our documentation.\r\nInclude links and/or screenshots which will aid us to resolve the issue.\r\n-->\r\n\r\nTried to make documentation. `make docs` in `/` and `make html` in `/docs`. Got error:\r\n\r\n```\r\nException occurred:\r\n  File \"/usr/lib/python3.8/site-packages/docutils/nodes.py\", line 567, in __getitem__\r\n    return self.attributes[key]\r\nKeyError: 'refdoc'\r\nThe full traceback has been saved in /tmp/sphinx-err-qa973efh.log, if you want to report the issue to the developers.\r\nPlease also report this if it was a user error, so that a better error message can be provided next time.\r\nA bug report can be filed in the tracker at <https://github.com/sphinx-doc/sphinx/issues>. Thanks!\r\nmake[1]: *** [Makefile:55: html] Error 2\r\nmake[1]: Leaving directory '/home/lash/src/ext/python/celery/docs'\r\nmake: *** [Makefile:76: Documentation] Error 2\r\n```\r\n\r\nTried with `master@f2ddd894c32f642a20f03b805b97e460f4fb3b4f` and `v4.3.0`\r\n\r\nUsing `python@3.8.1`, `sphinx@2.2.1` and `sphinx-celery@2.0.0`\r\n\r\n# Suggestions\r\n<!-- Please provide us suggestions for how to fix the documentation -->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5965", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5965/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5965/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5965/events", "html_url": "https://github.com/celery/celery/issues/5965", "id": 569097128, "node_id": "MDU6SXNzdWU1NjkwOTcxMjg=", "number": 5965, "title": "link=callback is not using configured backend, but rather defaulting to 'amqp'", "user": {"login": "radiantone", "id": 25509097, "node_id": "MDQ6VXNlcjI1NTA5MDk3", "avatar_url": "https://avatars2.githubusercontent.com/u/25509097?v=4", "gravatar_id": "", "url": "https://api.github.com/users/radiantone", "html_url": "https://github.com/radiantone", "followers_url": "https://api.github.com/users/radiantone/followers", "following_url": "https://api.github.com/users/radiantone/following{/other_user}", "gists_url": "https://api.github.com/users/radiantone/gists{/gist_id}", "starred_url": "https://api.github.com/users/radiantone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/radiantone/subscriptions", "organizations_url": "https://api.github.com/users/radiantone/orgs", "repos_url": "https://api.github.com/users/radiantone/repos", "events_url": "https://api.github.com/users/radiantone/events{/privacy}", "received_events_url": "https://api.github.com/users/radiantone/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-21T17:51:04Z", "updated_at": "2020-02-26T08:51:25Z", "closed_at": "2020-02-21T19:01:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [ ] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [ ] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [ ] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [ ] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n4.4.0\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [ ] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] I have included the contents of ``pip freeze`` in the issue.\r\n- [ ] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:\r\nStarted app.\r\n\r\nsoftware -> celery:4.4.0 (cliffs) kombu:4.6.7 py:3.7.6\r\n            billiard:3.6.2.0 py-amqp:2.5.2\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:5.3.0-7625-generic imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:amqp results:redis://localhost:6379/0\r\n\r\nbroker_url: 'amqp://guest:********@localhost:5672//'\r\nresult_backend: 'redis://localhost:6379/0'\r\ntask_routes: {\r\n    'task.add': {'queue': 'add', 'routing_key': '********'},\r\n    'task.log': {'queue': 'log', 'routing_key': '********'},\r\n    'task.receipt': {'queue': 'receipt', 'routing_key': '********'}}\r\ntask_annotations: {\r\n 'task.log': {'rate_limit': '1/s'}}\r\n</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\nThe below example creates a simple task and 3 queues to receive callbacks when task is completed. The app is configured to use redis backend, yet when the callbacks are invoked within celery, it generates new queues in AMQP rather than using the configured results backend.\r\n\r\n```\r\nworkers\r\n\r\n$ celery -A task worker -n log -Q log --loglevel=info -c 1\r\n$ celery -A task worker -n receipt -Q receipt --loglevel=info -c 1\r\n$ celery -A task worker -n \"worker\" -Q add --loglevel=info\r\n\r\ntask.py\r\n===================\r\nfrom celery import Celery\r\n\r\nCELERY_IGNORE_RESULT = True \r\nCELERY_STORE_ERRORS_EVEN_IF_IGNORED = False\r\n\r\napp = Celery('task', backend='redis://localhost:6379/0', broker='amqp://guest@localhost//')\r\n\r\napp.conf.task_routes = {\r\n    'task.add': {\r\n        'queue': 'add',\r\n        'routing_key': 'task.add',\r\n    },\r\n    'task.receipt': {\r\n        'queue': 'receipt',\r\n        'routing_key': 'task.receipt',\r\n    'task.log': {\r\n        'queue': 'log',\r\n        'routing_key': 'task.log'\r\n    }\r\n}\r\n\r\napp.conf.update(\r\n  task_annotations={\r\n    'task.log': {'rate_limit': '1/s'}\r\n }\r\n)\r\n\r\nprint(\"Started app.\")\r\n\r\n@app.task\r\ndef add(x, y):\r\n    return x + y\r\n\r\n@app.task\r\ndef receipt(result,id):\r\n   print(\"Got Result: \",result)\r\n   print(\"Add Receipt: \",id)\r\n\r\n@app.task\r\ndef log(result,id):\r\n   print(\"LOG Got Result: \",result)\r\n   print(\"LOG Add Receipt: \",id)\r\n\r\nrun.py\r\n======================\r\nfrom celery import Celery\r\nfrom task import add\r\nfrom task import receipt\r\nfrom task import log\r\n\r\nfor i in range(0,10):\r\n   if i % 2:\r\n      r = add.apply((i,i+10),queue=\"add\",link=log.s(str(i)+\",\"+str(i+10)).set(queue=\"log\"))\r\n   else:\r\n      r = add.apply((i,i+10),queue=\"add\",link=receipt.s(str(i)+\",\"+str(i+10)).set(queue=\"receipt\"))\r\n   print(i,i+10,r.get()) \r\n   r.forget()\r\nprint(\"Done\")\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nCallbacks provided in link= arguments in task signatures should respect the configured backend in the app.\r\n\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nLink callbacks are storing their results in amqp queues instead of the configured backend.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5964", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5964/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5964/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5964/events", "html_url": "https://github.com/celery/celery/issues/5964", "id": 567856329, "node_id": "MDU6SXNzdWU1Njc4NTYzMjk=", "number": 5964, "title": "\"Next Steps\" error propagation example does not match the current behavior.", "user": {"login": "adyouri", "id": 7527268, "node_id": "MDQ6VXNlcjc1MjcyNjg=", "avatar_url": "https://avatars2.githubusercontent.com/u/7527268?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adyouri", "html_url": "https://github.com/adyouri", "followers_url": "https://api.github.com/users/adyouri/followers", "following_url": "https://api.github.com/users/adyouri/following{/other_user}", "gists_url": "https://api.github.com/users/adyouri/gists{/gist_id}", "starred_url": "https://api.github.com/users/adyouri/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adyouri/subscriptions", "organizations_url": "https://api.github.com/users/adyouri/orgs", "repos_url": "https://api.github.com/users/adyouri/repos", "events_url": "https://api.github.com/users/adyouri/events{/privacy}", "received_events_url": "https://api.github.com/users/adyouri/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1028707666, "node_id": "MDU6TGFiZWwxMDI4NzA3NjY2", "url": "https://api.github.com/repos/celery/celery/labels/Category:%20Documentation", "name": "Category: Documentation", "color": "f9dd5e", "default": false, "description": ""}, {"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-19T21:23:58Z", "updated_at": "2020-02-26T06:02:24Z", "closed_at": "2020-02-26T06:02:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?utf8=%E2%9C%93&q=is%3Aissue+label%3A%22Category%3A+Documentation%22+)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues in this issue\r\n      (If there are none, check this box anyway).\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n- #5940 \r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n# Description\r\n<!--\r\nPlease describe what's missing or incorrect about our documentation.\r\nInclude links and/or screenshots which will aid us to resolve the issue.\r\n-->\r\nIn [Calling Tasks](https://docs.celeryproject.org/en/latest/getting-started/next-steps.html#calling-tasks):\r\n> You can also inspect the exception and traceback if the task raised an exception, in fact result.get() will propagate any errors by default:\r\n```\r\n>>> res = add.delay(2)\r\n>>> res.get(timeout=1)\r\n```\r\nThis example is not working as described because `add.delay(2)` results in the following error before the user is able to call `res.get(timeout=1)`:\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/celery/app/task.py\", line 425, in delay\r\n    return self.apply_async(args, kwargs)\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/celery/app/task.py\", line 530, in apply_async\r\n    check_arguments(*(args or ()), **(kwargs or {}))\r\nTypeError: add() missing 1 required positional argument: 'y'\r\n```\r\n\r\nI suppose `check_arguments()` is a new function?\r\n\r\n# Suggestions\r\nChange the example from:\r\n```\r\n>>> res = add.delay(2)\r\n>>> res.get(timeout=1)\r\n```\r\nTo an integer and string addition:\r\n```\r\n>>> res = add.delay(2, '2')\r\n>>> res.get(timeout=1)\r\n```\r\nThis way `res = add.delay(2, '2')` won't raise `TypeError: add() missing 1 required positional argument: 'y'`. And `res.get(timeout=1)` will propagate the following exception:\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/celery/result.py\", line 221, in get\r\n    return self.backend.wait_for_pending(\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/celery/backends/asynchronous.py\", line 195, in wait_for_pending\r\n    return result.maybe_throw(callback=callback, propagate=propagate)\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/celery/result.py\", line 333, in maybe_throw\r\n    self.throw(value, self._to_remote_traceback(tb))\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/celery/result.py\", line 326, in throw\r\n    self.on_ready.throw(*args, **kwargs)\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/vine/promises.py\", line 244, in throw\r\n    reraise(type(exc), exc, tb)\r\n  File \"/home/abd/python/celery/env/lib/python3.8/site-packages/vine/five.py\", line 195, in reraise\r\n    raise value\r\nTypeError: unsupported operand type(s) for +: 'int' and 'str'\r\n```\r\n\r\n<!-- Please provide us suggestions for how to fix the documentation -->\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5961", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5961/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5961/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5961/events", "html_url": "https://github.com/celery/celery/issues/5961", "id": 566709016, "node_id": "MDU6SXNzdWU1NjY3MDkwMTY=", "number": 5961, "title": "Celery workers getting restarted while publishing messages on pub-sub", "user": {"login": "rohanjaswal2507", "id": 7920333, "node_id": "MDQ6VXNlcjc5MjAzMzM=", "avatar_url": "https://avatars3.githubusercontent.com/u/7920333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rohanjaswal2507", "html_url": "https://github.com/rohanjaswal2507", "followers_url": "https://api.github.com/users/rohanjaswal2507/followers", "following_url": "https://api.github.com/users/rohanjaswal2507/following{/other_user}", "gists_url": "https://api.github.com/users/rohanjaswal2507/gists{/gist_id}", "starred_url": "https://api.github.com/users/rohanjaswal2507/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rohanjaswal2507/subscriptions", "organizations_url": "https://api.github.com/users/rohanjaswal2507/orgs", "repos_url": "https://api.github.com/users/rohanjaswal2507/repos", "events_url": "https://api.github.com/users/rohanjaswal2507/events{/privacy}", "received_events_url": "https://api.github.com/users/rohanjaswal2507/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-02-18T07:50:13Z", "updated_at": "2020-02-27T06:45:02Z", "closed_at": "2020-02-26T15:37:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "Problem I have encountered:\r\nI am running a celery task which pulls messages in batches(20 in one go) from a pubsub topic, does some minor manipulations in the message data and then again publishes those messages to another topic on Pub-Sub.\r\n\r\nWhile this above task runs, celery worker abruptly gets restarted and worker processes sometimes receive \"SIGNAL 11\".\r\nProcess 'ForkPoolWorker-1' pid:28 exited with 'signal 11 (SIGSEGV)'\r\n\r\n\r\n\r\nWhat I expected to happen:\r\nThe task should run smoothly and be able to publish as many messages to the target topic.\r\n\r\n\r\nSteps to reproduce:\r\nWell, the steps to reproduce could be little time taking.\r\n1. Create a celery app\r\n2. Write a task which publishes messages in bulk to a pub-sub topic\r\n3. Start the celery worker\r\n4. Execute the task\r\n\r\nOther information (workarounds I have tried, documentation consulted, etc):\r\n\r\nHere is what my requirements file looks like in my django application running in an Python 3.6.6 environment.\r\n\r\ndjango==2.0.5\r\ndjangorestframework==3.8.2\r\ndjangorestframework-jwt==1.11.0\r\ngunicorn==19.9.0\r\ndjango-cors-headers==2.3.0\r\ngoogle-cloud-logging==1.6.0\r\ngoogle-cloud-storage==1.11.0\r\nraven==6.9.0\r\nuwsgi==2.0.17\r\nrequests==2.22.0\r\nredis==3.3.11\r\ntldextract==2.2.2\r\nslackclient==1.3.0\r\nkombu==4.6.3\r\ncelery==4.2.1\r\ndjango-celery-beat==1.1.1\r\nnewrelic==5.4.1.134\r\ngoogle-cloud-pubsub==0.41.0\r\n\r\nWhile looking for solutions on internet, I stumbled upon some segmentation fault issues with grpc. I have tried the following versions of grpcio, but still not able to get rid of the problem. grpc versions that I tried:\r\n1. 1.9.0\r\n2. 1.26.0\r\n3. 1.27.2\r\n\r\nThe same piece of code that is used to publish messages works fine when runs in the main django application(web server) instead of celery worker. We had the segmentation fault issues in the web server as well, but that was solved after tweaking some wsgi configuration.\r\nNew config values which solved the problem in wsgi web server are:\r\nUWSGI_LAZY_APPS=1\r\nUWSGI_WSGI_ENV_BEHAVIOR=holy\r\nUWSGI_ENABLE_THREADS=true\r\n\r\nPlease let me know if I doing anything wrong here and what I can I do to solve this issue. I have raised the issue on Google issue tracker as well.\r\nhttps://issuetracker.google.com/issues/149715225", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5959", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5959/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5959/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5959/events", "html_url": "https://github.com/celery/celery/issues/5959", "id": 564874190, "node_id": "MDU6SXNzdWU1NjQ4NzQxOTA=", "number": 5959, "title": "AttributeError: 'NoneType' object has no attribute 'close' traceback when shutting down worker", "user": {"login": "lacrosse1991", "id": 2328730, "node_id": "MDQ6VXNlcjIzMjg3MzA=", "avatar_url": "https://avatars2.githubusercontent.com/u/2328730?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lacrosse1991", "html_url": "https://github.com/lacrosse1991", "followers_url": "https://api.github.com/users/lacrosse1991/followers", "following_url": "https://api.github.com/users/lacrosse1991/following{/other_user}", "gists_url": "https://api.github.com/users/lacrosse1991/gists{/gist_id}", "starred_url": "https://api.github.com/users/lacrosse1991/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lacrosse1991/subscriptions", "organizations_url": "https://api.github.com/users/lacrosse1991/orgs", "repos_url": "https://api.github.com/users/lacrosse1991/repos", "events_url": "https://api.github.com/users/lacrosse1991/events{/privacy}", "received_events_url": "https://api.github.com/users/lacrosse1991/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 235024002, "node_id": "MDU6TGFiZWwyMzUwMjQwMDI=", "url": "https://api.github.com/repos/celery/celery/labels/Issue%20Type:%20Bug%20Report", "name": "Issue Type: Bug Report", "color": "e11d21", "default": false, "description": ""}, {"id": 987224361, "node_id": "MDU6TGFiZWw5ODcyMjQzNjE=", "url": "https://api.github.com/repos/celery/celery/labels/billiard", "name": "billiard", "color": "fcc1ba", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-13T18:35:20Z", "updated_at": "2020-02-26T10:41:02Z", "closed_at": "2020-02-13T19:37:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "<!--\r\nPlease fill this template entirely and do not erase parts of it.\r\nWe reserve the right to close without a response\r\nbug reports which are incomplete.\r\n-->\r\n# Checklist\r\n<!--\r\nTo check an item on the list replace [ ] with [x].\r\n-->\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n<!--\r\nTry some of the below if you think they are relevant.\r\nIt will help us figure out the scope of the bug and how many users it affects.\r\n-->\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [x] I have tried reproducing the issue on more than one operating system.\r\n- [x] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [ ] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n## Related Issues and Possible Duplicates\r\n<!--\r\nPlease make sure to search and mention any related issues\r\nor possible duplicates to this issue as requested by the checklist above.\r\n\r\nThis may or may not include issues in other repositories that the Celery project\r\nmaintains or other repositories that are dependencies of Celery.\r\n\r\nIf you don't know how to mention issues, please refer to Github's documentation\r\non the subject: https://help.github.com/en/articles/autolinked-references-and-urls#issues-and-pull-requests\r\n-->\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**:\r\n4.4.0 (cliffs)\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n```\r\nsoftware -> celery:4.4.0 (cliffs) kombu:4.6.7 py:3.7.3\r\n            billiard:3.6.2.0 py-amqp:2.5.2\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:4.4.0-43-Microsoft imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:amqps results:disabled\r\n\r\nbroker_url: 'amqps://xxxxxxxxxxxxxxxxxx:********@xxx.xxx.xxx.xxx:5671/xxxxxxxxxxxxxx'\r\nresult_extended: True\r\nworker_send_task_events: True\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: 3.7.3\r\n* **Minimal Celery Version**: 4.4.0\r\n* **Minimal Kombu Version**: 4.6.7\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: Linux xxxx 4.4.0-43-Microsoft #1-Microsoft Wed Dec 31 14:42:53 PST 2014 x86_64 GNU/Linux\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\namqp==2.5.2\r\naniso8601==8.0.0\r\nastroid==2.3.3\r\nattrs==19.3.0\r\nbilliard==3.6.2.0\r\ncelery==4.4.0\r\nClick==7.0\r\ncx-Oracle==7.3.0\r\nFlask==1.1.1\r\nflask-restplus==0.13.0\r\nflask-restx==0.1.0\r\nFlask-SQLAlchemy==2.4.1\r\nimportlib-metadata==1.5.0\r\nisort==4.3.21\r\nitsdangerous==1.1.0\r\nJinja2==2.11.1\r\njsonschema==3.2.0\r\nkombu==4.6.7\r\nlazy-object-proxy==1.4.3\r\nMarkupSafe==1.1.1\r\nmccabe==0.6.1\r\npkg-resources==0.0.0\r\npylint==2.4.4\r\npyrsistent==0.15.7\r\npytz==2019.3\r\nPyYAML==5.3\r\nsix==1.14.0\r\nSQLAlchemy==1.3.13\r\ntyped-ast==1.4.1\r\nvine==1.3.0\r\nwaitress==1.4.3\r\nWerkzeug==0.16.1\r\nwrapt==1.11.2\r\nzipp==2.1.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<!--\r\nPlease provide system dependencies, configuration files\r\nand other dependency information if applicable\r\n-->\r\n<details>\r\n<p>\r\nDistro is Debian GNU/Linux 10 \\n \\l\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n\r\n<details>\r\n<p>\r\n\r\n```\r\nfrom celery import Celery, group\r\nfrom time import sleep\r\n\r\nmqconfig = ['rabbitmqhost1', 'rabbitmqhost2', 'rabbitmqhost3']\r\n\r\napp = Celery('acdid', broker=mqconfig)\r\n\r\napp.conf.result_extended = True\r\napp.conf.worker_send_task_events = True\r\n\r\n@app.task()\r\ndef addacd(id):\r\n    sleep(2)\r\n    results = 'Sucessfully added: {}'.format(id)\r\n    print(results)\r\n    return results\r\n\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\n<!-- Describe in detail what you expect to happen -->\r\nAfter starting my worker instance using celery worker -A acdworker -l info, I should be able to perform a warm shutdown by doing ctrl-c.\r\n\r\n'''\r\ncelery worker -A acdworker -l info\r\n<startup text>\r\n^C\r\nworker: Hitting Ctrl+C again will terminate all running tasks!\r\nworker: Warm shutdown (MainProcess)\r\n'''\r\n# Actual Behavior\r\n<!--\r\nDescribe in detail what actually happened.\r\nPlease include a backtrace and surround it with triple backticks (```).\r\nIn addition, include the Celery daemon logs, the broker logs,\r\nthe result backend logs and system logs below if they will help us debug\r\nthe issue.\r\n-->\r\nI can start up the celery worker normally, after which it will connect to the broker and begin to process tasks normally. When I go to run ctrl-c and perform a warm shutdown, the worker will start shutting down but then output a backtrace. This backtrace only occurs on this particular machine (Debian WSL environment running on windows 10).\r\n'''\r\ncelery worker -A acdworker -l info\r\n<startup text>\r\nworker: Hitting Ctrl+C again will terminate all running tasks!\r\n\r\nworker: Warm shutdown (MainProcess)\r\n[2020-02-13 13:20:23,632: WARNING/MainProcess] Traceback (most recent call last):\r\n[2020-02-13 13:20:23,633: WARNING/MainProcess] File \"/usr/lib/python3.7/multiprocessing/util.py\", line 265, in _run_finalizers\r\n    finalizer()\r\n[2020-02-13 13:20:23,637: WARNING/MainProcess] File \"/usr/lib/python3.7/multiprocessing/util.py\", line 189, in __call__\r\n    res = self._callback(*self._args, **self._kwargs)\r\n[2020-02-13 13:20:23,639: WARNING/MainProcess] File \"/home/austin/python_projects/acdid-automation/venv/lib/python3.7/site-packages/billiard/pool.py\", line 1697, in _terminate_pool\r\n    inqueue.close()\r\n[2020-02-13 13:20:23,640: WARNING/MainProcess] AttributeError: 'NoneType' object has no attribute 'close'\r\n'''", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5957", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5957/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5957/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5957/events", "html_url": "https://github.com/celery/celery/issues/5957", "id": 560986006, "node_id": "MDU6SXNzdWU1NjA5ODYwMDY=", "number": 5957, "title": "How do I open a normal issue for celery ?", "user": {"login": "BrunoDesthuilliers", "id": 15106675, "node_id": "MDQ6VXNlcjE1MTA2Njc1", "avatar_url": "https://avatars2.githubusercontent.com/u/15106675?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BrunoDesthuilliers", "html_url": "https://github.com/BrunoDesthuilliers", "followers_url": "https://api.github.com/users/BrunoDesthuilliers/followers", "following_url": "https://api.github.com/users/BrunoDesthuilliers/following{/other_user}", "gists_url": "https://api.github.com/users/BrunoDesthuilliers/gists{/gist_id}", "starred_url": "https://api.github.com/users/BrunoDesthuilliers/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BrunoDesthuilliers/subscriptions", "organizations_url": "https://api.github.com/users/BrunoDesthuilliers/orgs", "repos_url": "https://api.github.com/users/BrunoDesthuilliers/repos", "events_url": "https://api.github.com/users/BrunoDesthuilliers/events{/privacy}", "received_events_url": "https://api.github.com/users/BrunoDesthuilliers/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-06T12:38:02Z", "updated_at": "2020-02-08T14:37:23Z", "closed_at": "2020-02-08T14:37:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "ATM I can choose between a \"Minor Version Release Checklist\" template marked \"for maintainers only\", and sub-projects (kombu / billiard / etc) subtrackers...  And the \"If this doesn\u2019t look right, choose a different type\" link brings me back to the same set of choices ;-)", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5956", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5956/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5956/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5956/events", "html_url": "https://github.com/celery/celery/issues/5956", "id": 559902553, "node_id": "MDU6SXNzdWU1NTk5MDI1NTM=", "number": 5956, "title": "semantic version inconsistency", "user": {"login": "martey", "id": 49076, "node_id": "MDQ6VXNlcjQ5MDc2", "avatar_url": "https://avatars1.githubusercontent.com/u/49076?v=4", "gravatar_id": "", "url": "https://api.github.com/users/martey", "html_url": "https://github.com/martey", "followers_url": "https://api.github.com/users/martey/followers", "following_url": "https://api.github.com/users/martey/following{/other_user}", "gists_url": "https://api.github.com/users/martey/gists{/gist_id}", "starred_url": "https://api.github.com/users/martey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/martey/subscriptions", "organizations_url": "https://api.github.com/users/martey/orgs", "repos_url": "https://api.github.com/users/martey/repos", "events_url": "https://api.github.com/users/martey/events{/privacy}", "received_events_url": "https://api.github.com/users/martey/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2020-02-04T18:33:15Z", "updated_at": "2020-05-15T06:09:37Z", "closed_at": "2020-05-15T06:09:37Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The [documentation](https://docs.celeryproject.org/en/4.4.0/contributing.html#versions) claims that Celery follows semantic versioning:\r\n\r\n> Version numbers consists of a major version, minor version and a release number. Since version 2.1.0 we use the versioning semantics described by SemVer: http://semver.org. \r\n\r\nHowever, Celery 4.4 introduced breaking changes that are incompatible with Celery 4.3 (http://docs.celeryproject.org/en/latest/whatsnew-4.4.html#upgrading-from-celery-4-3, #5890).\r\n\r\nI think a project governance decision needs to be made as to whether Celery plans to continue semantic versioning, or whether minor versions are allowed to have breaking changes.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5950", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5950/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5950/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5950/events", "html_url": "https://github.com/celery/celery/issues/5950", "id": 559154541, "node_id": "MDU6SXNzdWU1NTkxNTQ1NDE=", "number": 5950, "title": "Result extended makes state crash", "user": {"login": "Ixiodor", "id": 21291221, "node_id": "MDQ6VXNlcjIxMjkxMjIx", "avatar_url": "https://avatars1.githubusercontent.com/u/21291221?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Ixiodor", "html_url": "https://github.com/Ixiodor", "followers_url": "https://api.github.com/users/Ixiodor/followers", "following_url": "https://api.github.com/users/Ixiodor/following{/other_user}", "gists_url": "https://api.github.com/users/Ixiodor/gists{/gist_id}", "starred_url": "https://api.github.com/users/Ixiodor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Ixiodor/subscriptions", "organizations_url": "https://api.github.com/users/Ixiodor/orgs", "repos_url": "https://api.github.com/users/Ixiodor/repos", "events_url": "https://api.github.com/users/Ixiodor/events{/privacy}", "received_events_url": "https://api.github.com/users/Ixiodor/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 1, "created_at": "2020-02-03T15:25:43Z", "updated_at": "2020-05-16T05:16:10Z", "closed_at": "2020-05-16T05:16:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Setting:\r\n```\r\napp.conf.update(\r\n     result_extended=True,\r\n)\r\n```\r\nMakes:\r\n`return app.AsyncResult(task_id).state`\r\n\r\nraise an exception with an invalid id. With result_extended=False you get the right \"PENDING\" state.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5948", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5948/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5948/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5948/events", "html_url": "https://github.com/celery/celery/issues/5948", "id": 558427678, "node_id": "MDU6SXNzdWU1NTg0Mjc2Nzg=", "number": 5948, "title": "Updating to redis 3.4.0 package causing startup error in Mingle", "user": {"login": "calumrussell", "id": 60528020, "node_id": "MDQ6VXNlcjYwNTI4MDIw", "avatar_url": "https://avatars0.githubusercontent.com/u/60528020?v=4", "gravatar_id": "", "url": "https://api.github.com/users/calumrussell", "html_url": "https://github.com/calumrussell", "followers_url": "https://api.github.com/users/calumrussell/followers", "following_url": "https://api.github.com/users/calumrussell/following{/other_user}", "gists_url": "https://api.github.com/users/calumrussell/gists{/gist_id}", "starred_url": "https://api.github.com/users/calumrussell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/calumrussell/subscriptions", "organizations_url": "https://api.github.com/users/calumrussell/orgs", "repos_url": "https://api.github.com/users/calumrussell/repos", "events_url": "https://api.github.com/users/calumrussell/events{/privacy}", "received_events_url": "https://api.github.com/users/calumrussell/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/celery/celery/milestones/26", "html_url": "https://github.com/celery/celery/milestone/26", "labels_url": "https://api.github.com/repos/celery/celery/milestones/26/labels", "id": 4301491, "node_id": "MDk6TWlsZXN0b25lNDMwMTQ5MQ==", "number": 26, "title": "4.4.x", "description": "Bug fix point releases", "creator": {"login": "auvipy", "id": 6212603, "node_id": "MDQ6VXNlcjYyMTI2MDM=", "avatar_url": "https://avatars1.githubusercontent.com/u/6212603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/auvipy", "html_url": "https://github.com/auvipy", "followers_url": "https://api.github.com/users/auvipy/followers", "following_url": "https://api.github.com/users/auvipy/following{/other_user}", "gists_url": "https://api.github.com/users/auvipy/gists{/gist_id}", "starred_url": "https://api.github.com/users/auvipy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/auvipy/subscriptions", "organizations_url": "https://api.github.com/users/auvipy/orgs", "repos_url": "https://api.github.com/users/auvipy/repos", "events_url": "https://api.github.com/users/auvipy/events{/privacy}", "received_events_url": "https://api.github.com/users/auvipy/received_events", "type": "User", "site_admin": false}, "open_issues": 99, "closed_issues": 216, "state": "open", "created_at": "2019-05-10T06:02:43Z", "updated_at": "2020-08-17T14:32:50Z", "due_on": "2020-07-31T07:00:00Z", "closed_at": null}, "comments": 2, "created_at": "2020-01-31T23:30:04Z", "updated_at": "2020-05-15T06:10:44Z", "closed_at": "2020-05-15T06:10:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "Had redis - https://pypi.org/project/redis/ - as a non-versioned dependency. Package was updated to v3.4 yesterday, rebuilt my application today using the new package and received this error on startup:\r\n```\r\n[2020-01-31 22:52:56,558: DEBUG/MainProcess] | Consumer: Starting Mingle\r\n[2020-01-31 22:52:56,558: INFO/MainProcess] mingle: searching for neighbors\r\n[2020-01-31 22:52:56,576: CRITICAL/MainProcess] Unrecoverable error: TypeError(\"unhashable type: 'Redis'\",)\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/worker/worker.py\", line 205, in start\r\n    self.blueprint.start(self)\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/bootsteps.py\", line 119, in start\r\n    step.start(parent)\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/bootsteps.py\", line 369, in start\r\n    return self.obj.start()\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/worker/consumer/consumer.py\", line 318, in start\r\n    blueprint.start(self)\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/bootsteps.py\", line 119, in start\r\n    step.start(parent)\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/worker/consumer/mingle.py\", line 40, in start\r\n    self.sync(c)\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/worker/consumer/mingle.py\", line 44, in sync\r\n    replies = self.send_hello(c)\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/worker/consumer/mingle.py\", line 57, in send_hello\r\n    replies = inspect.hello(c.hostname, our_revoked._data) or {}\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/app/control.py\", line 154, in hello\r\n    return self._request('hello', from_node=from_node, revoked=revoked)\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/app/control.py\", line 106, in _request\r\n    pattern=self.pattern, matcher=self.matcher,\r\n  File \"/usr/local/lib/python3.6/dist-packages/celery/app/control.py\", line 477, in broadcast\r\n    limit, callback, channel=channel,\r\n  File \"/usr/local/lib/python3.6/dist-packages/kombu/pidbox.py\", line 352, in _broadcast\r\n    channel=chan)\r\n  File \"/usr/local/lib/python3.6/dist-packages/kombu/pidbox.py\", line 391, in _collect\r\n    self.connection.drain_events(timeout=timeout)\r\n  File \"/usr/local/lib/python3.6/dist-packages/kombu/connection.py\", line 323, in drain_events\r\n    return self.transport.drain_events(self.connection, **kwargs)\r\n  File \"/usr/local/lib/python3.6/dist-packages/kombu/transport/virtual/base.py\", line 963, in drain_events\r\n    get(self._deliver, timeout=timeout)\r\n  File \"/usr/local/lib/python3.6/dist-packages/kombu/transport/redis.py\", line 374, in get\r\n    self._register_BRPOP(channel)\r\n  File \"/usr/local/lib/python3.6/dist-packages/kombu/transport/redis.py\", line 311, in _register_BRPOP\r\n    if not self._client_registered(channel, channel.client, 'BRPOP'):\r\n  File \"/usr/local/lib/python3.6/dist-packages/kombu/transport/redis.py\", line 306, in _client_registered\r\n    (channel, client, cmd) in self._chan_to_sock)\r\nTypeError: unhashable type: 'Redis'\r\n```\r\nMy application was not starting up after this error. Reverted redis to 3.3.11 and everything is working normally again.\r\n\r\nEDIT: just adding more info about what I am seeing...\r\n\r\nThe `_client_registered` method (on the `MultiChannelPoller` object) in redis.py takes three params: channel, client, cmd. \r\n\r\nchannel - `kombu.transport.redis.Channel` object \r\nclient - Redis object (which has the Connection Pool object wrapped around a Connection object), my assumption here is that this is an object in the redis package mentioned above\r\ncmd - string representing a Redis command (I am seeing BRPOP, I have no real clue about Redis so may be missing something here).\r\n\r\nThe line that is causing the error (for the avoidance of doubt) does appear to be 306, `self._chan_to_sock` is a hash whose key is the first three parameters of `_client_registered` (and value is the socket). \r\n\r\nUsing redis 3.3.11 the client param/Redis object passed to `_client_registered` has `__hash__` property that returns a Truthy value. Using redis 3.4 calling `__hash__ ` returns None.\r\n\r\nFixed with - https://github.com/andymccurdy/redis-py/issues/1275\r\n\r\nRelated - https://github.com/celery/kombu/issues/1152", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/celery/celery/issues/5947", "repository_url": "https://api.github.com/repos/celery/celery", "labels_url": "https://api.github.com/repos/celery/celery/issues/5947/labels{/name}", "comments_url": "https://api.github.com/repos/celery/celery/issues/5947/comments", "events_url": "https://api.github.com/repos/celery/celery/issues/5947/events", "html_url": "https://github.com/celery/celery/issues/5947", "id": 558194895, "node_id": "MDU6SXNzdWU1NTgxOTQ4OTU=", "number": 5947, "title": "chord of chains with groups: body duplication and invalid task execution order", "user": {"login": "the-owl", "id": 11090288, "node_id": "MDQ6VXNlcjExMDkwMjg4", "avatar_url": "https://avatars1.githubusercontent.com/u/11090288?v=4", "gravatar_id": "", "url": "https://api.github.com/users/the-owl", "html_url": "https://github.com/the-owl", "followers_url": "https://api.github.com/users/the-owl/followers", "following_url": "https://api.github.com/users/the-owl/following{/other_user}", "gists_url": "https://api.github.com/users/the-owl/gists{/gist_id}", "starred_url": "https://api.github.com/users/the-owl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/the-owl/subscriptions", "organizations_url": "https://api.github.com/users/the-owl/orgs", "repos_url": "https://api.github.com/users/the-owl/repos", "events_url": "https://api.github.com/users/the-owl/events{/privacy}", "received_events_url": "https://api.github.com/users/the-owl/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-01-31T15:21:46Z", "updated_at": "2020-03-02T01:16:31Z", "closed_at": "2020-03-02T01:16:31Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "# Checklist\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [ ] This has already been asked to the [discussion group](https://groups.google.com/forum/#!forum/celery-users) first.\r\n- [x] I have read the relevant section in the\r\n  [contribution guide](http://docs.celeryproject.org/en/latest/contributing.html#other-bugs)\r\n  on reporting bugs.\r\n- [x] I have checked the [issues list](https://github.com/celery/celery/issues?q=is%3Aissue+label%3A%22Issue+Type%3A+Bug+Report%22+-label%3A%22Category%3A+Documentation%22)\r\n  for similar or identical bug reports.\r\n- [x] I have checked the [pull requests list](https://github.com/celery/celery/pulls?q=is%3Apr+label%3A%22PR+Type%3A+Bugfix%22+-label%3A%22Category%3A+Documentation%22)\r\n  for existing proposed fixes.\r\n- [x] I have checked the [commit log](https://github.com/celery/celery/commits/master)\r\n  to find out if the bug was already fixed in the master branch.\r\n- [x] I have included all related issues and possible duplicate issues\r\n  in this issue (If there are none, check this box anyway).\r\n\r\n## Mandatory Debugging Information\r\n\r\n- [x] I have included the output of ``celery -A proj report`` in the issue.\r\n    (if you are not able to do this, then at least specify the Celery\r\n     version affected).\r\n- [x] I have verified that the issue exists against the `master` branch of Celery.\r\n- [x] I have included the contents of ``pip freeze`` in the issue.\r\n- [x] I have included all the versions of all the external dependencies required\r\n  to reproduce this bug.\r\n\r\n## Optional Debugging Information\r\n- [ ] I have tried reproducing the issue on more than one Python version\r\n  and/or implementation.\r\n- [ ] I have tried reproducing the issue on more than one message broker and/or\r\n  result backend.\r\n- [ ] I have tried reproducing the issue on more than one version of the message\r\n  broker and/or result backend.\r\n- [ ] I have tried reproducing the issue on more than one operating system.\r\n- [ ] I have tried reproducing the issue on more than one workers pool.\r\n- [ ] I have tried reproducing the issue with autoscaling, retries,\r\n  ETA/Countdown & rate limits disabled.\r\n- [x] I have tried reproducing the issue after downgrading\r\n  and/or upgrading Celery and its dependencies.\r\n\r\n#### Related Issues\r\n\r\n- None\r\n\r\n#### Possible Duplicates\r\n\r\n- None\r\n\r\n## Environment & Settings\r\n<!-- Include the contents of celery --version below -->\r\n**Celery version**: 4.4.0\r\n<!-- Include the output of celery -A proj report below -->\r\n<details>\r\n<summary><b><code>celery report</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\nsoftware -> celery:4.4.0 (cliffs) kombu:4.6.7 py:3.7.3\r\n            billiard:3.6.1.0 py-amqp:2.5.2\r\nplatform -> system:Linux arch:64bit, ELF\r\n            kernel version:5.0.0-37-generic imp:CPython\r\nloader   -> celery.loaders.app.AppLoader\r\nsettings -> transport:amqp results:redis://redis/\r\n\r\nCELERY_BROKER_URL: 'amqp://guest:********@rabbit:5672//'\r\nCELERY_RESULT_BACKEND: 'redis://redis/'\r\nCELERY_TASK_SERIALIZER: 'json'\r\nis_overridden: <bound method Settings.is_overridden of <Settings \"app.settings\">>\r\nbeat_schedule: {}\r\ntask_routes: {\r\n 'app.tasks.*': {'queue': 'main'}}\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Steps to Reproduce\r\n1. Start celery worker with `--concurrency 8` and `-O fair` using code from test case below\r\n2. Call a broken task via `celery -A app.celery_app call app.tasks.bug.task`\r\n3. Call a correct task via `celery -A app.celery_app call app.tasks.bug.task_correct`\r\n\r\n## Required Dependencies\r\n<!-- Please fill the required dependencies to reproduce this issue -->\r\n* **Minimal Python Version**: N/A or Unknown\r\n* **Minimal Celery Version**: N/A or Unknown\r\n* **Minimal Kombu Version**: N/A or Unknown\r\n* **Minimal Broker Version**: N/A or Unknown\r\n* **Minimal Result Backend Version**: N/A or Unknown\r\n* **Minimal OS and/or Kernel Version**: N/A or Unknown\r\n* **Minimal Broker Client Version**: N/A or Unknown\r\n* **Minimal Result Backend Client Version**: N/A or Unknown\r\n\r\n### Python Packages\r\n<!-- Please fill the contents of pip freeze below -->\r\n<details>\r\n<summary><b><code>pip freeze</code> Output:</b></summary>\r\n<p>\r\n\r\n```\r\naiohttp==3.6.2\r\namqp==2.5.2\r\nasgiref==3.2.3\r\nasync-timeout==3.0.1\r\nattrs==19.3.0\r\nbilliard==3.6.1.0\r\ncelery==4.4.0\r\ncertifi==2019.9.11\r\nchardet==3.0.4\r\ncurlify==2.2.1\r\ndecorator==4.4.1\r\ndefusedxml==0.6.0\r\nDjango==3.0.2\r\ndjango-braces==1.13.0\r\ndjango-cors-headers==3.1.1\r\ndjango-filter==2.2.0\r\ndjango-oauth-toolkit==1.2.0\r\ndjango-rest-framework-social-oauth2==1.1.0\r\ndjango-templated-mail==1.1.1\r\ndjangorestframework==3.11.0\r\ndjoser==2.0.3\r\ndrf-nested-routers==0.91\r\nfacebook-business==5.0.0\r\nffmpeg-python==0.2.0\r\nfuture==0.18.1\r\nidna==2.8\r\nImageHash==4.0\r\nimageio==2.6.1\r\nimageio-ffmpeg==0.3.0\r\nimportlib-metadata==1.3.0\r\nkombu==4.6.7\r\nmore-itertools==8.0.2\r\nmoviepy==1.0.1\r\nmultidict==4.5.2\r\nnumpy==1.17.4\r\noauthlib==3.1.0\r\nPillow==6.2.0\r\nproglog==0.1.9\r\npsycopg2-binary==2.8.3\r\nPyJWT==1.7.1\r\npymongo==3.9.0\r\npyslack==0.5.0\r\npython3-openid==3.1.0\r\npytz==2019.2\r\nPyWavelets==1.1.1\r\nredis==3.3.8\r\nrequests==2.22.0\r\nrequests-oauthlib==1.2.0\r\nrest-social-auth==3.0.0\r\nscipy==1.3.2\r\nsentry-sdk==0.13.5\r\nsix==1.12.0\r\nslackclient==2.3.0\r\nsocial-auth-app-django==3.1.0\r\nsocial-auth-core==3.2.0\r\nsqlparse==0.3.0\r\ntqdm==4.39.0\r\nurllib3==1.25.6\r\nvine==1.3.0\r\nyarl==1.3.0\r\nzipp==0.6.0\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n### Other Dependencies\r\n<details>\r\n<p>\r\nN/A\r\n</p>\r\n</details>\r\n\r\n## Minimally Reproducible Test Case\r\n<!--\r\nPlease provide a reproducible test case.\r\nRefer to the Reporting Bugs section in our contribution guide.\r\n\r\nWe prefer submitting test cases in the form of a PR to our integration test suite.\r\nIf you can provide one, please mention the PR number below.\r\nIf not, please attach the most minimal code example required to reproduce the issue below.\r\nIf the test case is too large, please include a link to a gist or a repository below.\r\n-->\r\n<details>\r\n<p>\r\n\r\n```python\r\nfrom time import sleep\r\n\r\nfrom celery import chord, group\r\n\r\nfrom app.celery_app import app\r\n\r\n\r\n@app.task\r\ndef task():\r\n    chord([\r\n        a.s(1) | group([b.si(), b.si()]),\r\n        a.s(3) | group([b.si(), b.si()]),\r\n    ])(c.si())\r\n    \r\n\r\n@app.task\r\ndef task_correct():\r\n    chord([\r\n        a.s(1) | group([b.si(), b.si()]) | dummy.si(),\r\n        a.s(3) | group([b.si(), b.si()]) | dummy.si(),\r\n    ])(c.si())\r\n\r\n\r\n@app.task\r\ndef dummy():\r\n    pass\r\n\r\n\r\n@app.task\r\ndef a(delay):\r\n    sleep(delay)\r\n\r\n\r\n@app.task\r\ndef b():\r\n    pass\r\n\r\n\r\n@app.task\r\ndef c():\r\n    pass\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n# Expected Behavior\r\nI expect the tasks to complete in the following order:\r\n`A B B A B B C`\r\n\r\n# Actual Behavior\r\nTask C gets duplicated:\r\n```\r\n[2020-01-31 13:48:40,765: INFO/MainProcess] Received task: app.tasks.bug.task[9d35ec5f-a268-4db9-9068-1e27fe64cef9]  \r\n[2020-01-31 13:48:40,817: INFO/MainProcess] Received task: app.tasks.bug.a[b2833570-bca5-4875-ab6d-e3ec339f36d1]  \r\n[2020-01-31 13:48:40,824: INFO/MainProcess] Received task: app.tasks.bug.a[3d49f0d7-6b1a-4937-ac1c-29bac230e533]  \r\n[2020-01-31 13:48:40,828: INFO/ForkPoolWorker-8] Task app.tasks.bug.task[9d35ec5f-a268-4db9-9068-1e27fe64cef9] succeeded in 0.06039188499562442s: None\r\n[2020-01-31 13:48:41,864: INFO/MainProcess] Received task: app.tasks.bug.b[796bcd9f-f548-4282-9f6d-16ddb3ddc29b]  \r\n[2020-01-31 13:48:41,867: INFO/ForkPoolWorker-8] Task app.tasks.bug.b[796bcd9f-f548-4282-9f6d-16ddb3ddc29b] succeeded in 0.001961939036846161s: None\r\n[2020-01-31 13:48:41,869: INFO/MainProcess] Received task: app.tasks.bug.b[eacaa3ce-cc71-4daf-8e62-8d24f9322c7b]  \r\n[2020-01-31 13:48:41,871: INFO/ForkPoolWorker-9] Task app.tasks.bug.a[b2833570-bca5-4875-ab6d-e3ec339f36d1] succeeded in 1.0521306470036507s: None\r\n[2020-01-31 13:48:41,884: INFO/ForkPoolWorker-8] Task app.tasks.bug.b[eacaa3ce-cc71-4daf-8e62-8d24f9322c7b] succeeded in 0.013368424959480762s: None\r\n[2020-01-31 13:48:41,884: INFO/MainProcess] Received task: app.tasks.bug.c[8e50636b-a440-454e-a6fe-57bb7595b82f]  \r\n[2020-01-31 13:48:41,886: INFO/ForkPoolWorker-8] Task app.tasks.bug.c[8e50636b-a440-454e-a6fe-57bb7595b82f] succeeded in 0.0010153759503737092s: None\r\n[2020-01-31 13:48:43,880: INFO/MainProcess] Received task: app.tasks.bug.b[07eb9c18-1303-4517-b95b-d555de1d6315]  \r\n[2020-01-31 13:48:43,884: INFO/ForkPoolWorker-8] Task app.tasks.bug.b[07eb9c18-1303-4517-b95b-d555de1d6315] succeeded in 0.0018030810169875622s: None\r\n[2020-01-31 13:48:43,887: INFO/MainProcess] Received task: app.tasks.bug.b[7ebaf58a-28f5-4170-86fb-61c3b5ee1909]  \r\n[2020-01-31 13:48:43,887: INFO/ForkPoolWorker-2] Task app.tasks.bug.a[3d49f0d7-6b1a-4937-ac1c-29bac230e533] succeeded in 3.0580567660508677s: None\r\n[2020-01-31 13:48:43,892: INFO/ForkPoolWorker-8] Task app.tasks.bug.b[7ebaf58a-28f5-4170-86fb-61c3b5ee1909] succeeded in 0.004260396934114397s: None\r\n[2020-01-31 13:48:43,893: INFO/MainProcess] Received task: app.tasks.bug.c[8e50636b-a440-454e-a6fe-57bb7595b82f]  \r\n[2020-01-31 13:48:43,896: INFO/ForkPoolWorker-8] Task app.tasks.bug.c[8e50636b-a440-454e-a6fe-57bb7595b82f] succeeded in 0.000999139971099794s: None\r\n```\r\nActual execution order is weird, and task C is executed twice.\r\n\r\nBut when you add a dummy task to the end of each chain, execution order becomes correct (as seen in `task_correct` task):\r\n```\r\n[2020-01-31 15:13:00,867: INFO/MainProcess] Received task: app.tasks.bug.task_correct[d9dd4fb3-8df9-4c39-8b3d-e8892f9d6fef]  \r\n[2020-01-31 15:13:00,928: INFO/MainProcess] Received task: app.tasks.bug.a[e7eb341f-3c10-4bb0-9dee-2cfa38354005]  \r\n[2020-01-31 15:13:00,939: INFO/MainProcess] Received task: app.tasks.bug.a[c13967b3-b53a-4005-9249-dffa4b6122af]  \r\n[2020-01-31 15:13:00,941: INFO/ForkPoolWorker-8] Task app.tasks.bug.task_correct[d9dd4fb3-8df9-4c39-8b3d-e8892f9d6fef] succeeded in 0.07147384795825928s: None\r\n[2020-01-31 15:13:01,974: INFO/MainProcess] Received task: app.tasks.bug.b[88ceb430-5056-40a1-ae82-cfd95d27845e]  \r\n[2020-01-31 15:13:01,977: INFO/MainProcess] Received task: app.tasks.bug.b[3a354338-edb7-447b-9d40-855e9e386531]  \r\n[2020-01-31 15:13:01,977: INFO/ForkPoolWorker-9] Task app.tasks.bug.a[e7eb341f-3c10-4bb0-9dee-2cfa38354005] succeeded in 1.0470000900095329s: None\r\n[2020-01-31 15:13:01,978: INFO/ForkPoolWorker-8] Task app.tasks.bug.b[88ceb430-5056-40a1-ae82-cfd95d27845e] succeeded in 0.0024882910074666142s: None\r\n[2020-01-31 15:13:02,008: INFO/MainProcess] Received task: app.tasks.bug.dummy[2b9094d8-fe73-43b3-9a2a-c5ad756b3e22]  \r\n[2020-01-31 15:13:02,009: INFO/ForkPoolWorker-3] Task app.tasks.bug.b[3a354338-edb7-447b-9d40-855e9e386531] succeeded in 0.02914690098259598s: None\r\n[2020-01-31 15:13:02,013: INFO/ForkPoolWorker-8] Task app.tasks.bug.dummy[2b9094d8-fe73-43b3-9a2a-c5ad756b3e22] succeeded in 0.002397596021182835s: None\r\n[2020-01-31 15:13:03,989: INFO/MainProcess] Received task: app.tasks.bug.b[fafd28c6-55d0-41c5-a035-1d4da0d6067b]  \r\n[2020-01-31 15:13:03,992: INFO/MainProcess] Received task: app.tasks.bug.b[ea8c9c21-f860-4268-b44c-6faa8ba66dc2]  \r\n[2020-01-31 15:13:03,993: INFO/ForkPoolWorker-8] Task app.tasks.bug.b[fafd28c6-55d0-41c5-a035-1d4da0d6067b] succeeded in 0.0024769710144028068s: None\r\n[2020-01-31 15:13:03,994: INFO/ForkPoolWorker-2] Task app.tasks.bug.a[c13967b3-b53a-4005-9249-dffa4b6122af] succeeded in 3.050520417978987s: None\r\n[2020-01-31 15:13:04,001: INFO/ForkPoolWorker-9] Task app.tasks.bug.b[ea8c9c21-f860-4268-b44c-6faa8ba66dc2] succeeded in 0.006369335926137865s: None\r\n[2020-01-31 15:13:04,001: INFO/MainProcess] Received task: app.tasks.bug.dummy[998aa572-9010-4991-856a-191cf1741680]  \r\n[2020-01-31 15:13:04,021: INFO/MainProcess] Received task: app.tasks.bug.c[976f5323-1505-41c6-ad01-e0e720c4b5c7]  \r\n[2020-01-31 15:13:04,021: INFO/ForkPoolWorker-8] Task app.tasks.bug.dummy[998aa572-9010-4991-856a-191cf1741680] succeeded in 0.018995660939253867s: None\r\n[2020-01-31 15:13:04,023: INFO/ForkPoolWorker-9] Task app.tasks.bug.c[976f5323-1505-41c6-ad01-e0e720c4b5c7] succeeded in 0.0012671550503000617s: None\r\n```", "performed_via_github_app": null, "score": 1.0}]}