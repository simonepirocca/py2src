{"total_count": 242, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/apple/coremltools/issues/848", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/848/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/848/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/848/events", "html_url": "https://github.com/apple/coremltools/issues/848", "id": 675539032, "node_id": "MDU6SXNzdWU2NzU1MzkwMzI=", "number": 848, "title": "TypeError: 'InputLayer' object is not iterable", "user": {"login": "totorocyx", "id": 32193269, "node_id": "MDQ6VXNlcjMyMTkzMjY5", "avatar_url": "https://avatars2.githubusercontent.com/u/32193269?v=4", "gravatar_id": "", "url": "https://api.github.com/users/totorocyx", "html_url": "https://github.com/totorocyx", "followers_url": "https://api.github.com/users/totorocyx/followers", "following_url": "https://api.github.com/users/totorocyx/following{/other_user}", "gists_url": "https://api.github.com/users/totorocyx/gists{/gist_id}", "starred_url": "https://api.github.com/users/totorocyx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/totorocyx/subscriptions", "organizations_url": "https://api.github.com/users/totorocyx/orgs", "repos_url": "https://api.github.com/users/totorocyx/repos", "events_url": "https://api.github.com/users/totorocyx/events{/privacy}", "received_events_url": "https://api.github.com/users/totorocyx/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-08-08T15:04:48Z", "updated_at": "2020-08-08T15:05:40Z", "closed_at": "2020-08-08T15:05:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nWhen I converted my Keras model to coreml model, an error occurred: \"TypeError: 'InputLayer' object is not iterable\"\r\n```\r\n.../coremltools/converters/keras/_keras_converter.py in convert(model, input_names, output_names, image_input_names, input_name_shape_dict, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, model_precision, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, input_shapes, output_shapes, respect_trainable, use_float_arraytype)\r\n    801                          output_shapes=output_shapes,\r\n    802                          respect_trainable=respect_trainable,\r\n--> 803                          use_float_arraytype=use_float_arraytype)\r\n    804 \r\n    805     return _MLModel(spec)\r\n\r\n.../coremltools/converters/keras/_keras_converter.py in convertToSpec(model, input_names, output_names, image_input_names, input_name_shape_dict, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, model_precision, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_objects, input_shapes, output_shapes, respect_trainable, use_float_arraytype)\r\n    582                                           output_shapes=output_shapes,\r\n    583                                           respect_trainable=respect_trainable,\r\n--> 584                                           use_float_arraytype=use_float_arraytype)\r\n    585     else:\r\n    586         raise RuntimeError(\r\n\r\n.../coremltools/converters/keras/_keras2_converter.py in _convert(model, input_names, output_names, image_input_names, input_name_shape_dict, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_objects, input_shapes, output_shapes, respect_trainable, use_float_arraytype)\r\n    326     # Build network graph to represent Keras model\r\n    327     graph = _topology2.NetGraph(model)\r\n--> 328     graph.build()\r\n    329 \r\n    330 \r\n\r\n.../coremltools/converters/keras/_topology2.py in build(self, is_top_level)\r\n    660                     '_inbound_nodes') else layer.inbound_nodes\r\n    661             for node in in_nodes:\r\n--> 662                 for pred in node.inbound_layers:\r\n    663                     if pred.name not in self.layer_list:\r\n    664                         self.layer_list.append(pred.name)\r\n\r\nTypeError: 'InputLayer' object is not iterable\r\n```\r\n## System Information\r\n- coremltools version : 3.4\r\n- OS : Mac OS\r\n- python version : 3.6 (anaconda)\r\n- keras version : 2.4.3\r\n- tensorflow version : 2.3.0\r\n\r\n## My Code\r\n```\r\nimport coremltools\r\nfrom keras.models import load_model\r\nlabels = ['0', '1', '2']\r\n\r\nkeras_model = load_model('./model.h5')\r\ncoreml_model = coremltools.converters.keras.convert(keras_model,\r\n                                                    input_names = 'image',\r\n                                                    image_input_names = 'image',\r\n                                                    output_names = 'output',\r\n                                                    class_labels = labels)\r\ncoreml_model.author = 'me'\r\ncoreml_model.license = 'MIT'\r\ncoreml_model.short_description = 'Classifier'\r\ncoreml_model.save('demo.mlmodel')\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/846", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/846/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/846/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/846/events", "html_url": "https://github.com/apple/coremltools/issues/846", "id": 675058079, "node_id": "MDU6SXNzdWU2NzUwNTgwNzk=", "number": 846, "title": "ValueError: Keras layer '<class 'tensorflow.python.keras.engine.input_layer.InputLayer'>' not supported. ", "user": {"login": "Utku-Savas", "id": 23260717, "node_id": "MDQ6VXNlcjIzMjYwNzE3", "avatar_url": "https://avatars2.githubusercontent.com/u/23260717?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Utku-Savas", "html_url": "https://github.com/Utku-Savas", "followers_url": "https://api.github.com/users/Utku-Savas/followers", "following_url": "https://api.github.com/users/Utku-Savas/following{/other_user}", "gists_url": "https://api.github.com/users/Utku-Savas/gists{/gist_id}", "starred_url": "https://api.github.com/users/Utku-Savas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Utku-Savas/subscriptions", "organizations_url": "https://api.github.com/users/Utku-Savas/orgs", "repos_url": "https://api.github.com/users/Utku-Savas/repos", "events_url": "https://api.github.com/users/Utku-Savas/events{/privacy}", "received_events_url": "https://api.github.com/users/Utku-Savas/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1476891360, "node_id": "MDU6TGFiZWwxNDc2ODkxMzYw", "url": "https://api.github.com/repos/apple/coremltools/labels/multi-backend%20keras", "name": "multi-backend keras", "color": "ff8000", "default": false, "description": "Issue could be related to keras framework (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-07T14:35:30Z", "updated_at": "2020-08-08T03:51:39Z", "closed_at": "2020-08-08T03:51:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n- I have successfully converted a coco pretrained yolov4-tiny model to .h5. Then using the h5 model, I tried to convert it coreml, but it gave error.\r\n\r\n## Trace\r\n\r\n> ValueError                                Traceback (most recent call last)\r\n<ipython-input-3-72661bb67046> in <module>\r\n      3                                                     image_input_names = 'image',\r\n      4                                                     image_scale=1/255.,\r\n----> 5                                                     input_name_shape_dict={'image': [None, 416, 416, 3]}\r\n      6                                                     )\r\n ~/venv/v4/lib/python3.6/site-packages/coremltools/converters/keras/_keras_converter.py in convert(model, input_names, output_names, image_input_names, input_name_shape_dict, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, model_precision, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, input_shapes, output_shapes, respect_trainable, use_float_arraytype)\r\n    828         output_shapes=output_shapes,\r\n    829         respect_trainable=respect_trainable,\r\n--> 830         use_float_arraytype=use_float_arraytype,\r\n    831     )\r\n    832 \r\n~/venv/v4/lib/python3.6/site-packages/coremltools/converters/keras/_keras_converter.py in _convert_to_spec(model, input_names, output_names, image_input_names, input_name_shape_dict, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, model_precision, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_objects, input_shapes, output_shapes, respect_trainable, use_float_arraytype)\r\n    605             output_shapes=output_shapes,\r\n    606             respect_trainable=respect_trainable,\r\n--> 607             use_float_arraytype=use_float_arraytype,\r\n    608         )\r\n    609     else:\r\n~/venv/v4/lib/python3.6/site-packages/coremltools/converters/keras/_keras2_converter.py in _convert(model, input_names, output_names, image_input_names, input_name_shape_dict, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_objects, input_shapes, output_shapes, respect_trainable, use_float_arraytype)\r\n    356 \r\n    357     # Check valid versions\r\n--> 358     _check_unsupported_layers(model, add_custom_layers)\r\n    359 \r\n    360     # Build network graph to represent Keras model\r\n~/venv/v4/lib/python3.6/site-packages/coremltools/converters/keras/_keras2_converter.py in _check_unsupported_layers(model, add_custom_layers)\r\n    123         else:\r\n    124             if type(layer) not in _KERAS_LAYER_REGISTRY:\r\n--> 125                 raise ValueError(\"Keras layer '%s' not supported. \" % str(type(layer)))\r\n    126             if isinstance(layer, _keras.layers.wrappers.TimeDistributed):\r\n    127                 if type(layer.layer) not in _KERAS_LAYER_REGISTRY:\r\nValueError: Keras layer '<class 'tensorflow.python.keras.engine.input_layer.InputLayer'>' not supported. \r\n\r\n## To Reproduce\r\n\r\n```\r\nfrom tensorflow.keras.models import load_model  \r\nimport tensorflow.keras.backend as K\r\nimport coremltools\r\n\r\nmodel = load_model(\"venv/v4/yolov44-tiny.h5\")\r\n\r\ncoreml_model_float32 = coremltools.converters.keras.convert(model,\r\n                                                    input_names = 'image',\r\n                                                    image_input_names = 'image',\r\n                                                    image_scale=1/255.,\r\n                                                    input_name_shape_dict={'image': [None, 416, 416, 3]}\r\n                                                    )\r\n```\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (4.0b2):\r\n - OS (Linux):\r\n - How you install python (virtualenv):\r\n - python version (3.6.10):\r\n - any other relevant information:\r\n    tf.keras.__version__ = 2.3.0\r\n    tf.__version = 2.2.0\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/839", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/839/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/839/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/839/events", "html_url": "https://github.com/apple/coremltools/issues/839", "id": 672982435, "node_id": "MDU6SXNzdWU2NzI5ODI0MzU=", "number": 839, "title": "Tensorflow -> CoreML Conversion issue", "user": {"login": "ayy345", "id": 44304884, "node_id": "MDQ6VXNlcjQ0MzA0ODg0", "avatar_url": "https://avatars2.githubusercontent.com/u/44304884?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ayy345", "html_url": "https://github.com/ayy345", "followers_url": "https://api.github.com/users/ayy345/followers", "following_url": "https://api.github.com/users/ayy345/following{/other_user}", "gists_url": "https://api.github.com/users/ayy345/gists{/gist_id}", "starred_url": "https://api.github.com/users/ayy345/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ayy345/subscriptions", "organizations_url": "https://api.github.com/users/ayy345/orgs", "repos_url": "https://api.github.com/users/ayy345/repos", "events_url": "https://api.github.com/users/ayy345/events{/privacy}", "received_events_url": "https://api.github.com/users/ayy345/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-04T18:14:38Z", "updated_at": "2020-08-04T19:22:19Z", "closed_at": "2020-08-04T19:22:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n- We are trying to convert Tensorflow (1.14+) frozen model to CoreML\r\n- The model has Mul Operation, and conversion is failing \r\n\r\n\r\n## Trace\r\n```\r\nERROR:root:[TypeInference] Failed to infer type of mul:Mul\r\nTraceback (most recent call last):\r\n  File \"lib/python3.6/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 171, in visit ret = visitor(node)\r\n  File \"lib/python3.6/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 1227, in visit_Mul return self._visit_broadcast(node)\r\n  File \"lib/python3.6/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 435, in _visit_broadcast retshape = self._broadcast_shape(node, typea.get_shape(), typeb.get_shape())\r\n  File \"lib/python3.6/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 408, in _broadcast_shape i, node.op, node.name))\r\nValueError: Incompatible dimension 1 in Mul operation localization_model/poolingatend/mul\r\n```\r\n\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 4.0b1, 4.0b2\r\n - OS  MacOS \r\n - macOS version (if applicable): 10.15\r\n - python version (e.g. 3.7): 3.6\r\n - any other relevant information:\r\n     - e.g. Tensorflow Version 10.14.0\r\n\r\n## Additional context\r\nMay be the converter is mapping Tensorflow's **Mul**  to  CoreML's **MultiplyLayer** instead of **MultiplyBroadcastableLayer** which supports general broadcasting.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/838", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/838/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/838/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/838/events", "html_url": "https://github.com/apple/coremltools/issues/838", "id": 672799019, "node_id": "MDU6SXNzdWU2NzI3OTkwMTk=", "number": 838, "title": "Context ValueError when using custom convert function for replication_pad2d layer", "user": {"login": "gilevir", "id": 26228319, "node_id": "MDQ6VXNlcjI2MjI4MzE5", "avatar_url": "https://avatars3.githubusercontent.com/u/26228319?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gilevir", "html_url": "https://github.com/gilevir", "followers_url": "https://api.github.com/users/gilevir/followers", "following_url": "https://api.github.com/users/gilevir/following{/other_user}", "gists_url": "https://api.github.com/users/gilevir/gists{/gist_id}", "starred_url": "https://api.github.com/users/gilevir/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gilevir/subscriptions", "organizations_url": "https://api.github.com/users/gilevir/orgs", "repos_url": "https://api.github.com/users/gilevir/repos", "events_url": "https://api.github.com/users/gilevir/events{/privacy}", "received_events_url": "https://api.github.com/users/gilevir/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-08-04T13:38:29Z", "updated_at": "2020-08-04T15:02:39Z", "closed_at": "2020-08-04T15:00:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nI need to convert a TorchScript that uses a replication_pad2d layer. Since the convert function for this op doesn't exist, I did a custom one, following the [Composite Operators documentation](https://coremltools.readme.io/docs/composite-operators)\r\n```\r\n@register_torch_op\r\ndef replication_pad2d(context, node):\r\n    inp = context[node.inputs[0]]\r\n    pad = context[node.inputs[1]]\r\n\r\n    x = mb.pad(x=inp, pad=pad, mode='replicate', name=node.name)\r\n    \r\n    context.add(node.name, x)\r\n```\r\n\r\nBut got the following error when converting this particular node : `ValueError: Torch var input0.1 not found in context`\r\n\r\n## Trace\r\nEnd of stack trace:\r\n\r\n```\r\n/usr/local/lib/python3.7/site-packages/coremltools/converters/mil/frontend/torch/ops.py in convert_nodes(context, graph)\r\n     52             )\r\n     53         else:\r\n---> 54             _add_op(context, node)\r\n     55 \r\n     56         # We've generated all the outputs the graph needs, terminate conversion.\r\n\r\n/usr/local/lib/python3.7/site-packages/coremltools/converters/mil/frontend/torch/ops.py in _convolution(context, node)\r\n    343 @register_torch_op(torch_alias=[\"conv2d\"])\r\n    344 def _convolution(context, node):\r\n--> 345     inputs = _get_inputs(context, node)\r\n    346 \r\n    347     x = inputs[0]\r\n\r\n/usr/local/lib/python3.7/site-packages/coremltools/converters/mil/frontend/torch/ops.py in _get_inputs(context, node, expected)\r\n    119         value of @expcted.\r\n    120     \"\"\"\r\n--> 121     inputs = [context[name] for name in node.inputs]\r\n    122     if expected is not None and len(inputs) != expected:\r\n    123         raise ValueError(\r\n\r\n/usr/local/lib/python3.7/site-packages/coremltools/converters/mil/frontend/torch/ops.py in <listcomp>(.0)\r\n    119         value of @expcted.\r\n    120     \"\"\"\r\n--> 121     inputs = [context[name] for name in node.inputs]\r\n    122     if expected is not None and len(inputs) != expected:\r\n    123         raise ValueError(\r\n\r\n/usr/local/lib/python3.7/site-packages/coremltools/converters/mil/frontend/torch/converter.py in __getitem__(self, torch_name)\r\n     70                 return self._current_graph[idx][torch_name]\r\n     71         raise ValueError(\r\n---> 72             \"Torch var {} not found in context {}\".format(torch_name, self.name)\r\n     73         )\r\n     74 \r\n\r\nValueError: Torch var input0.1 not found in context \r\n```\r\n\r\nThe PyTorch model definition is as simple as that:\r\n\r\n```\r\nclass Net(nn.Module):\r\n    def __init__(self):\r\n        super(ThinningNet, self).__init__()\r\n        self.layers = nn.Sequential(\r\n            nn.ReplicationPad2d(4),\r\n            Conv(1, 64, 1, 9, 0),\r\n            Conv(64, 64),\r\n            Conv(64, 64),\r\n            Conv(64, 64),\r\n            Conv(64, 64),\r\n            Conv(64, 64),\r\n            Conv(64, 64),\r\n            Conv(64, 64),\r\n            nn.Conv2d(64, 1, kernel_size=3, stride=1, padding=1)\r\n        )\r\n\r\n    def forward(self, x):\r\n        return torch.sigmoid(self.layers(x - 0.7))\r\n```\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  4.0.b2\r\n - macOS version : 10.15.5\r\n - XCode version : 11.6\r\n - python version 3.7\r\n - PyTorch version : 1.5.0", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/833", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/833/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/833/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/833/events", "html_url": "https://github.com/apple/coremltools/issues/833", "id": 669777324, "node_id": "MDU6SXNzdWU2Njk3NzczMjQ=", "number": 833, "title": "How to convert a Mask layer from TensorFlow to MLModel?", "user": {"login": "haifengkao", "id": 4080524, "node_id": "MDQ6VXNlcjQwODA1MjQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/4080524?v=4", "gravatar_id": "", "url": "https://api.github.com/users/haifengkao", "html_url": "https://github.com/haifengkao", "followers_url": "https://api.github.com/users/haifengkao/followers", "following_url": "https://api.github.com/users/haifengkao/following{/other_user}", "gists_url": "https://api.github.com/users/haifengkao/gists{/gist_id}", "starred_url": "https://api.github.com/users/haifengkao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/haifengkao/subscriptions", "organizations_url": "https://api.github.com/users/haifengkao/orgs", "repos_url": "https://api.github.com/users/haifengkao/repos", "events_url": "https://api.github.com/users/haifengkao/events{/privacy}", "received_events_url": "https://api.github.com/users/haifengkao/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-31T12:42:30Z", "updated_at": "2020-07-31T13:44:50Z", "closed_at": "2020-07-31T13:44:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nMLModel supports  `whereNonZero` layer, but only PyTorch has `nonzero` layer, TensorFlow uses `NotEqual` instead. How do I let coremltools know `NotEqual` is corresponding to `whereNonZero`?\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/827", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/827/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/827/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/827/events", "html_url": "https://github.com/apple/coremltools/issues/827", "id": 667975561, "node_id": "MDU6SXNzdWU2Njc5NzU1NjE=", "number": 827, "title": "PyTorch 1.6.0 released today - breaks coremltools converter v4.0b2 in many cases with AttributeError: module 'torch._C' has no attribute '_jit_pass_canonicalize_ops'", "user": {"login": "leovinus2001", "id": 48823294, "node_id": "MDQ6VXNlcjQ4ODIzMjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/48823294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leovinus2001", "html_url": "https://github.com/leovinus2001", "followers_url": "https://api.github.com/users/leovinus2001/followers", "following_url": "https://api.github.com/users/leovinus2001/following{/other_user}", "gists_url": "https://api.github.com/users/leovinus2001/gists{/gist_id}", "starred_url": "https://api.github.com/users/leovinus2001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leovinus2001/subscriptions", "organizations_url": "https://api.github.com/users/leovinus2001/orgs", "repos_url": "https://api.github.com/users/leovinus2001/repos", "events_url": "https://api.github.com/users/leovinus2001/events{/privacy}", "received_events_url": "https://api.github.com/users/leovinus2001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-07-29T16:27:29Z", "updated_at": "2020-08-20T15:25:54Z", "closed_at": "2020-08-20T15:25:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I just noticed that PyTorch 1.6.0 was released. Now, many test cases from the last 2 weeks break with the log below and I believe a similar issue was reported earlier in issue #751 for pytorch nightly \r\n\r\nReproducible::--------------------------\r\n\r\nyes, with torch =1.6.0 and torchvision = 0.7.0\r\n\r\nExample test cases that fail now are #823 #825 or\r\nhttps://github.com/apple/coremltools/issues/736#issuecomment-649702302\r\n\r\nLog:--------------------------\r\n\r\nTraceback (most recent call last):\r\n  File \"testAssert.py\", line 55, in <module>\r\n    inputs= [ ct.TensorType(name=\"input1\", shape=dummy_input.shape) ]\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/_converters_entry.py\", line 299, in convert\r\n    **kwargs\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 120, in _convert\r\n    prog = frontend_converter(model, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 62, in __call__\r\n    return load(*args, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 73, in load\r\n    converter = TorchConverter(torchscript, inputs, outputs, cut_at_symbols)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/converter.py\", line 141, in __init__\r\n    raw_graph, params_dict = self._expand_and_optimize_ir(self.torchscript)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/converter.py\", line 273, in _expand_and_optimize_ir\r\n    _torch._C._jit_pass_canonicalize_ops(graph)\r\nAttributeError: module 'torch._C' has no attribute '_jit_pass_canonicalize_ops'\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/826", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/826/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/826/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/826/events", "html_url": "https://github.com/apple/coremltools/issues/826", "id": 667634585, "node_id": "MDU6SXNzdWU2Njc2MzQ1ODU=", "number": 826, "title": "Error compiling Xcode 12 app with model converted from TensorFlow 2 with coremltools 4.0b2", "user": {"login": "willbattel", "id": 13490339, "node_id": "MDQ6VXNlcjEzNDkwMzM5", "avatar_url": "https://avatars1.githubusercontent.com/u/13490339?v=4", "gravatar_id": "", "url": "https://api.github.com/users/willbattel", "html_url": "https://github.com/willbattel", "followers_url": "https://api.github.com/users/willbattel/followers", "following_url": "https://api.github.com/users/willbattel/following{/other_user}", "gists_url": "https://api.github.com/users/willbattel/gists{/gist_id}", "starred_url": "https://api.github.com/users/willbattel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/willbattel/subscriptions", "organizations_url": "https://api.github.com/users/willbattel/orgs", "repos_url": "https://api.github.com/users/willbattel/repos", "events_url": "https://api.github.com/users/willbattel/events{/privacy}", "received_events_url": "https://api.github.com/users/willbattel/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-29T07:58:41Z", "updated_at": "2020-08-19T22:44:01Z", "closed_at": "2020-08-19T22:44:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n- A clear and brief description of what the bug is.\r\n\r\nWhen trying to use an mlmodel converted from Keras in an app in Xcode, I encounter an error (see Trace). I'm guessing this problem is specific to the architecture of my model.\r\n\r\nNormally I would chalk this type of error to user error- but I have confirmed that my Keras model serves predictions as expected prior to conversion.\r\n\r\n- Is this a converter issue? If yes, please specify which converter (sci-kit, keras, xgboost etc.)\r\n\r\nI believe this is an error with the Keras (TensorFlow 2.3) converter.\r\n\r\n## Trace\r\n```\r\ncoremlc: error: Error reading protobuf spec. validator error: Layer 'functional_1/tf_op_layer_Tile_1/Tile_1' of type 920 has 2 inputs but expects exactly 1.\r\n```\r\n\r\n## To Reproduce\r\nBug Report reference number `FB8200805`\r\n\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 4.0b2\r\n - OS (e.g., MacOS, Linux): macOS\r\n - macOS version (if applicable): 10.15.5\r\n - XCode version (if applicable): 12 Beta 3\r\n - How you install python (anaconda, virtualenv, system): virtualenv\r\n - python version (e.g. 3.7): 3.7.5\r\n - any other relevant information:\r\n     - Keras, TensorFlow 2.3.0\r\n\r\n## Additional context\r\nNone at this time.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/823", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/823/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/823/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/823/events", "html_url": "https://github.com/apple/coremltools/issues/823", "id": 667168419, "node_id": "MDU6SXNzdWU2NjcxNjg0MTk=", "number": 823, "title": "Todays' beta2 checkin breaks  old  issue #759  F.max_pool2d where stride is NOT explicitly specified", "user": {"login": "leovinus2001", "id": 48823294, "node_id": "MDQ6VXNlcjQ4ODIzMjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/48823294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leovinus2001", "html_url": "https://github.com/leovinus2001", "followers_url": "https://api.github.com/users/leovinus2001/followers", "following_url": "https://api.github.com/users/leovinus2001/following{/other_user}", "gists_url": "https://api.github.com/users/leovinus2001/gists{/gist_id}", "starred_url": "https://api.github.com/users/leovinus2001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leovinus2001/subscriptions", "organizations_url": "https://api.github.com/users/leovinus2001/orgs", "repos_url": "https://api.github.com/users/leovinus2001/repos", "events_url": "https://api.github.com/users/leovinus2001/events{/privacy}", "received_events_url": "https://api.github.com/users/leovinus2001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-07-28T15:31:28Z", "updated_at": "2020-08-05T21:39:08Z", "closed_at": "2020-08-05T21:39:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Am comparing the old test case testPool from issue #759 with today's git version\r\ncommit 37e619d99bf603d2cb9ea0839fa3ebe649996b0a (HEAD -> master, tag: 4.0b2, origin/master, origin/HEAD)\r\n\r\nversus from a few days ago July 22\r\ncommit 705244e2be26c3fb7881fd7a731d25a55f5e4765\r\n\r\ntest case from issue #759 \r\n\r\nnow fails again.\r\n(I cannot attach it atm. Seems AWS issue)\r\n\r\nreproducible:---------------\r\n\r\nyes\r\n\r\nlog:---------------\r\n\r\nTorch version : 1.5.1\r\nCoreML tools version : 4.0b2\r\nConverting Frontend ==> MIL Ops:   0%|                                                                                                                                                                                                                                                             | 0/6 [00:00<?, ? ops/s]Converting op 13 : constant : shape = n/a\r\nConverting op 14 : constant : shape = n/a\r\nConverting op 15 : constant : shape = n/a\r\nConverting op 16 : constant : shape = n/a\r\nConverting op 11 : constant : shape = n/a\r\nConverting op 12 : max_pool2d : shape = (1, 1, 28, 28)\r\nConverting Frontend ==> MIL Ops:  83%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258c                                        | 5/6 [00:00<00:00, 4629.47 ops/s]\r\nTraceback (most recent call last):\r\n  File \"testPool.py\", line 94, in <module>\r\n    inputs=[ ct.TensorType(name=\"input1\", shape=dummy_input.shape) ],\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/_converters_entry.py\", line 299, in convert\r\n    **kwargs\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 120, in _convert\r\n    prog = frontend_converter(model, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 62, in __call__\r\n    return load(*args, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 86, in load\r\n    raise e\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 76, in load\r\n    prog = converter.convert()\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/converter.py\", line 221, in convert\r\n    convert_nodes(self.context, self.graph)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 64, in convert_nodes\r\n    _add_op(context, node)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 584, in max_pool2d\r\n    name=node.name,\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/ops/registry.py\", line 62, in add_op\r\n    return cls._add_op(op_cls, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/builder.py\", line 188, in _add_op\r\n    new_op = op_cls(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/ops/defs/pool.py\", line 180, in __init__\r\n    super(max_pool, self).__init__(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/ops/defs/pool.py\", line 25, in __init__\r\n    super(Pooling, self).__init__(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/operation.py\", line 148, in __init__\r\n    self._validate_and_set_inputs(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/operation.py\", line 360, in _validate_and_set_inputs\r\n    parsed_inputs = self.input_spec.parse_inputs(kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/input_type.py\", line 67, in parse_inputs\r\n    raise TypeError(msg)\r\nTypeError: Input strides has type <class 'coremltools.converters.mil.mil.types.type_tensor.tensor.<locals>.tensor'> not compatible with expected type IntTensorInputType", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/815", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/815/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/815/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/815/events", "html_url": "https://github.com/apple/coremltools/issues/815", "id": 665320177, "node_id": "MDU6SXNzdWU2NjUzMjAxNzc=", "number": 815, "title": "Conversion failing for already traced & saved pytorch model", "user": {"login": "ayy345", "id": 44304884, "node_id": "MDQ6VXNlcjQ0MzA0ODg0", "avatar_url": "https://avatars2.githubusercontent.com/u/44304884?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ayy345", "html_url": "https://github.com/ayy345", "followers_url": "https://api.github.com/users/ayy345/followers", "following_url": "https://api.github.com/users/ayy345/following{/other_user}", "gists_url": "https://api.github.com/users/ayy345/gists{/gist_id}", "starred_url": "https://api.github.com/users/ayy345/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ayy345/subscriptions", "organizations_url": "https://api.github.com/users/ayy345/orgs", "repos_url": "https://api.github.com/users/ayy345/repos", "events_url": "https://api.github.com/users/ayy345/events{/privacy}", "received_events_url": "https://api.github.com/users/ayy345/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-24T17:44:50Z", "updated_at": "2020-07-27T18:16:18Z", "closed_at": "2020-07-27T18:14:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "##  Conversion failing for  already traced & saved pytorch model\r\nI have a traced model. \r\n\r\n```\r\n\r\nimport torch\r\nimport torchvision\r\n\r\n# Load a pre-trained version of MobileNetV2\r\ntorch_model = torchvision.models.mobilenet_v2(pretrained=True)\r\n# Set the model in evaluation mode\r\ntorch_model.eval()\r\n# Trace with random data\r\nexample_input = torch.rand(1, 3, 224, 224)  # after test, will get 'size mismatch' error message with size 256x256\r\ntraced_model = torch.jit.trace(torch_model, example_input)\r\ntraced_model.save(\"traced_mobilenet_v2.pt\")\r\n```\r\n\r\nCan I not convert the model to coreml like this?\r\n\r\n```\r\nimport coremltools as ct\r\n\r\nmodel = ct.convert(\"traced_mobilenet_v2.pt\",  source='pytorch')\r\nmodel.save(\"mobilenet_v2.mlmodel\")\r\n\r\n```\r\n\r\n## System Information\r\n\r\ncoremltools==4.0b1\r\ntorch==1.5.1\r\ntorchvision=0.6.1\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/810", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/810/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/810/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/810/events", "html_url": "https://github.com/apple/coremltools/issues/810", "id": 664649145, "node_id": "MDU6SXNzdWU2NjQ2NDkxNDU=", "number": 810, "title": "PyTorch to CoreML LSTM model conversion v4 fails with ValueError: Layer with name \"_lstm_h0_reshaped_expanded\" has already been added. Please use a unique name.", "user": {"login": "leovinus2001", "id": 48823294, "node_id": "MDQ6VXNlcjQ4ODIzMjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/48823294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leovinus2001", "html_url": "https://github.com/leovinus2001", "followers_url": "https://api.github.com/users/leovinus2001/followers", "following_url": "https://api.github.com/users/leovinus2001/following{/other_user}", "gists_url": "https://api.github.com/users/leovinus2001/gists{/gist_id}", "starred_url": "https://api.github.com/users/leovinus2001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leovinus2001/subscriptions", "organizations_url": "https://api.github.com/users/leovinus2001/orgs", "repos_url": "https://api.github.com/users/leovinus2001/repos", "events_url": "https://api.github.com/users/leovinus2001/events{/privacy}", "received_events_url": "https://api.github.com/users/leovinus2001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-23T17:30:38Z", "updated_at": "2020-08-12T17:15:38Z", "closed_at": "2020-08-12T17:15:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\r\nRelevance:-----------------------------------------------------------\r\n\r\nWhile there other open issues in the coremltools v4 TOT repo regarding PyTorch trained LSTMs, such as #755 (multi layer LSTM) and #776 (handling of LSTM initials h0/c0), I was looking for workarounds on how to build multi-layer bidirectional LSTMs. Now I ran into a blocking bug with error:\r\n\r\n> Layer with name \"_lstm_h0_reshaped_expanded\" has already been added. Please use a unique name.\r\n\r\nIn other words, another blocker on the conversion of PyTorch multilayer LSTMs (potential GRU/RNN as well).\r\n\r\nOn the good side, a little digging in the conversion code leads to potential fix as well (see code and potential solution below) but I need your please to help to assess whether this approach is best, whether the unidirectional LSTM and GRU also need fixes, etc.\r\n\r\nReproducible:-----------------------------------------------------------\r\n\r\nYes\r\n\r\nTestcase:-----------------------------------------------------------\r\n\r\nAttached. Run e.g. as \r\npython3 -O ../testLstmTwoLayer.py \r\n[testLstmTwoLayer.txt](https://github.com/apple/coremltools/files/4967763/testLstmTwoLayer.txt)\r\n\r\nSetup:-----------------------------------------------------------\r\n\r\nTorch version : 1.5.1\r\nCoreML tools version : TOT  705244e2be26c3fb7881fd7a731d25a55f5e4765 July 23\r\n\r\nLog:-----------------------------------------------------------\r\n\r\nTorch version : 1.5.1\r\nCoreML tools version : 4.0b1\r\nsmall_model(\r\n  (lstm1): LSTM(28, 16, batch_first=True, bidirectional=True)\r\n  (lstm2): LSTM(32, 8, batch_first=True, bidirectional=True)\r\n  (fc1): Linear(in_features=16, out_features=11, bias=True)\r\n)\r\nConverting Frontend ==> MIL Ops:  98%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d     | 46/47 [00:00<00:00, 218.23 ops/s]\r\nRunning MIL optimization passes: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 13/13 [00:00<00:00, 17.78 passes/s]\r\nTranslating MIL ==> MLModel Ops:  69%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588                                                                                 | 22/32 [00:00<00:00, 14936.01 ops/s]\r\nTraceback (most recent call last):\r\n  File \"../testLstmTwoLayer.py\", line 74, in <module>\r\n    inputs=[ ct.TensorType(name=\"input1\", shape=dummy_input.shape) ],\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/_converters_entry.py\", line 299, in convert\r\n    **kwargs\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 122, in _convert\r\n    out = backend_converter(prog, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 72, in __call__\r\n    return load(*args, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/backend/nn/load.py\", line 239, in load\r\n    prog.functions[\"main\"].outputs,\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/backend/nn/op_mapping.py\", line 50, in convert_ops\r\n    mapper(const_context, builder, op)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/backend/nn/op_mapping.py\", line 1399, in lstm\r\n    _expand_dim(builder, initial_h + postfix, initial_h, [2, 3, 4])\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/backend/nn/op_mapping.py\", line 208, in _expand_dim\r\n    name=node_name, input_name=input_name, output_name=node_name, axes=axes\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/models/neural_network/builder.py\", line 7056, in add_expand_dims\r\n    spec_layer = self._add_generic_layer(name, [input_name], [output_name])\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/models/neural_network/builder.py\", line 1029, in _add_generic_layer\r\n    % name\r\nValueError: Layer with name \"_lstm_h0_reshaped_expanded\" has already been added. Please use a unique name.\r\n\r\nInterpretation and potential fix: -----------------------------------------------------------\r\n\r\nThis is observed with git coremltools, TOT 705244e2be26c3fb7881fd7a731d25a55f5e4765 July 23\r\n\r\nThe error\r\n> Layer with name \"_lstm_h0_reshaped_expanded\" has already been added. Please use a unique name.\r\n\r\nseems to indicate that the naming scheme in the converter is using a global name scheme.\r\n\r\nWhile the testcase runs fine with ONE layer (set flag twoLayerModelFlag to False) when you run with TWO layers (twoLayerModelFlag=True) ) (or more presumably) the error occurs.\r\n\r\nOriginally, you have on TOT the use of fixed postfixes like \"_expanded\" (for h0) and \"_expanded2\" (for c0) which leads to the issue it seems. When you have 2 layers or more, it seems the same variable name is generated multiple times.\r\n\r\nThe line 1399 in coremltools/converters/mil/backend/nn/op_mapping.py\r\npoints to the code below (The line numbers might be a little off due to my logging lines).\r\n\r\nOriginal code:\r\n\r\ndef lstm(const_context, builder, op):\r\n...\r\n\r\n# Roughly Line 1375 et al\r\n#\r\n    elif direction == \"bidirectional\":\r\n        # Expand initial_h and initial_c\r\n        _expand_dim(builder, initial_h + \"_expanded\", initial_h, [2, 3, 4]) # <------------------\r\n         initial_h += \"_expanded\"\r\n        \r\n        # initial_h may have the same name as initial_c (e.g., same Var)\r\n        _expand_dim(builder, initial_c + \"_expanded2\", initial_c, [2, 3, 4])  # <------------------\r\n        initial_c += \"_expanded2\"\r\n\t\t\r\nTherefore, I tried a quick randomization fix along the lines below to generate UNIQUE names every time you handle a new BLSTM layer.\r\n\r\nPotential fix:\r\n\r\ndef lstm(const_context, builder, op):\r\n...\r\n\r\n# Roughly Line 1375 et al\r\n#\r\n    elif direction == \"bidirectional\":\r\n        # Expand initial_h and initial_c\r\n        if 1:\r\n            # New\r\n            import random\r\n            mymax = 10000000 # Better, use sys.maxint\r\n            n = random.randrange(1,mymax)\r\n            postfix = \"_expanded_\" + str(n)\r\n            \r\n            n2 = random.randrange(1,mymax)\r\n            postfix2 = \"_expanded2_\" + str(n2)\r\n\r\n            mynodename = initial_h + \"_expanded\"\r\n            print (\"nodename \" + str(mynodename))\r\n            print (\"postfix\" + str(postfix))\r\n            print (\"postfix2\" + str(postfix2))\r\n        else:\r\n\t\t\t#ORG\r\n            postfix  = \"_expanded\"\r\n            postfix2 = \"_expanded2\"\r\n            \r\n        _expand_dim(builder, initial_h + postfix, initial_h, [2, 3, 4])  # <------------------\r\n        initial_h += postfix\r\n        \r\n        # initial_h may have the same name as initial_c (e.g., same Var)\r\n        _expand_dim(builder, initial_c + postfix2, initial_c, [2, 3, 4])  # <------------------\r\n        initial_c += postfix2\r\n\t\t\r\nWhile the conversion now completes, I have not checked whether \"everything\" is fine. which is why I ask for your help for a proper fix please. Note we might need a fix for other uniLSTM, GRU or RNN in the same file as well.\r\n\r\nAs the other issues  #755 (multi layer LSTM) and #776 (handling of initials h0/c0) are still blocking us, it would be an immense help if we could fix this new issue quickly such that I can properly stack multiple BLSTMs. Thanks.\r\n\r\nHere is the output WITH the fix above:\r\n\r\npython3 -O ../testLstmTwoLayer.py \r\nWARNING:root:Keras version 2.4.3 detected. Last version known to be fully compatible of Keras is 2.2.4 .\r\nTorch version : 1.5.1\r\nCoreML tools version : 4.0b1\r\nsmall_model(\r\n  (lstm1): LSTM(28, 16, batch_first=True, bidirectional=True)\r\n  (lstm2): LSTM(32, 8, batch_first=True, bidirectional=True)\r\n  (fc1): Linear(in_features=16, out_features=11, bias=True)\r\n)\r\nConverting Frontend ==> MIL Ops:  98%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u258d     | 46/47 [00:00<00:00, 213.31 ops/s]\r\nRunning MIL optimization passes: 100%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 13/13 [00:00<00:00, 17.83 passes/s]\r\nTranslating MIL ==> MLModel Ops:   0%|                                                                                                                                                                                                                                                                               | 0/32 [00:00<?, ? ops/s]\r\nnodename _lstm_h0_reshaped_expanded\r\npostfix_expanded_6035530\t\t\t# <------------------ randomized\r\npostfix2_expanded2_4582868\t\t\t# <------------------ randomized\r\nnodename _lstm_h0_reshaped_expanded\r\npostfix_expanded_3955283\r\npostfix2_expanded2_1781011\r\nTranslating MIL ==> MLModel Ops: 100%\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/792", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/792/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/792/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/792/events", "html_url": "https://github.com/apple/coremltools/issues/792", "id": 657410240, "node_id": "MDU6SXNzdWU2NTc0MTAyNDA=", "number": 792, "title": "Keras model convert doesn't work at all", "user": {"login": "haifengkao", "id": 4080524, "node_id": "MDQ6VXNlcjQwODA1MjQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/4080524?v=4", "gravatar_id": "", "url": "https://api.github.com/users/haifengkao", "html_url": "https://github.com/haifengkao", "followers_url": "https://api.github.com/users/haifengkao/followers", "following_url": "https://api.github.com/users/haifengkao/following{/other_user}", "gists_url": "https://api.github.com/users/haifengkao/gists{/gist_id}", "starred_url": "https://api.github.com/users/haifengkao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/haifengkao/subscriptions", "organizations_url": "https://api.github.com/users/haifengkao/orgs", "repos_url": "https://api.github.com/users/haifengkao/repos", "events_url": "https://api.github.com/users/haifengkao/events{/privacy}", "received_events_url": "https://api.github.com/users/haifengkao/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-15T14:45:40Z", "updated_at": "2020-07-16T05:55:24Z", "closed_at": "2020-07-16T05:55:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nUnable to convert Keras model\r\n\r\n## Trace\r\n```\r\nTraceback (most recent call last):\r\n  File \"coreml_test.py\", line 5, in <module>\r\n    inp = keras.layers.Input(shape=input_shape)\r\n  File \"/opt/anaconda3/lib/python3.7/site-packages/keras/engine/input_layer.py\", line 178, in Input\r\n    input_tensor=tensor)\r\n  File \"/opt/anaconda3/lib/python3.7/site-packages/keras/legacy/interfaces.py\", line 91, in wrapper\r\n    return func(*args, **kwargs)\r\n  File \"/opt/anaconda3/lib/python3.7/site-packages/keras/engine/input_layer.py\", line 39, in __init__\r\n    name = prefix + '_' + str(K.get_uid(prefix))\r\n  File \"/opt/anaconda3/lib/python3.7/site-packages/keras/backend/tensorflow_backend.py\", line 74, in get_uid\r\n    graph = tf.get_default_graph()\r\nAttributeError: module 'tensorflow' has no attribute 'get_default_graph'\r\n```\r\n## To Reproduce\r\n- If a python script can reproduce the error, please paste the code snippet\r\n```\r\nimport coremltools\r\nimport keras\r\n\r\ninput_shape = (1, 1280)\r\ninp = keras.layers.Input(shape=input_shape)\r\nout = keras.layers.Dense(512)(inp)\r\nkeras_model = keras.models.Model(inputs=[inp], outputs=[out])\r\n\r\nmodel = coremltools.convert(\r\n    keras_model,\r\n)\r\n```\r\n\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 4.0b1\r\n - OS (e.g., MacOS, Linux): MaxOS\r\n - macOS version (if applicable): 10.15.5\r\n - XCode version (if applicable): 11.6b\r\n - How you install python (anaconda, virtualenv, system): anaconda\r\n - python version (e.g. 3.7): 3.7\r\n - any other relevant information:\r\n     - Keras 2.2.4\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/785", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/785/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/785/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/785/events", "html_url": "https://github.com/apple/coremltools/issues/785", "id": 654869572, "node_id": "MDU6SXNzdWU2NTQ4Njk1NzI=", "number": 785, "title": "PyTorch to CoreML conversion fails with tools 4.0b1 at InstanceNorm2d (op instance_norm not implemented)", "user": {"login": "leovinus2001", "id": 48823294, "node_id": "MDQ6VXNlcjQ4ODIzMjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/48823294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leovinus2001", "html_url": "https://github.com/leovinus2001", "followers_url": "https://api.github.com/users/leovinus2001/followers", "following_url": "https://api.github.com/users/leovinus2001/following{/other_user}", "gists_url": "https://api.github.com/users/leovinus2001/gists{/gist_id}", "starred_url": "https://api.github.com/users/leovinus2001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leovinus2001/subscriptions", "organizations_url": "https://api.github.com/users/leovinus2001/orgs", "repos_url": "https://api.github.com/users/leovinus2001/repos", "events_url": "https://api.github.com/users/leovinus2001/events{/privacy}", "received_events_url": "https://api.github.com/users/leovinus2001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1433382939, "node_id": "MDU6TGFiZWwxNDMzMzgyOTM5", "url": "https://api.github.com/repos/apple/coremltools/labels/feature%20request", "name": "feature request", "color": "e7aaff", "default": false, "description": "Functionality does not currently exist, would need to be created as a new feature (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "1duo", "id": 6426433, "node_id": "MDQ6VXNlcjY0MjY0MzM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6426433?v=4", "gravatar_id": "", "url": "https://api.github.com/users/1duo", "html_url": "https://github.com/1duo", "followers_url": "https://api.github.com/users/1duo/followers", "following_url": "https://api.github.com/users/1duo/following{/other_user}", "gists_url": "https://api.github.com/users/1duo/gists{/gist_id}", "starred_url": "https://api.github.com/users/1duo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/1duo/subscriptions", "organizations_url": "https://api.github.com/users/1duo/orgs", "repos_url": "https://api.github.com/users/1duo/repos", "events_url": "https://api.github.com/users/1duo/events{/privacy}", "received_events_url": "https://api.github.com/users/1duo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "1duo", "id": 6426433, "node_id": "MDQ6VXNlcjY0MjY0MzM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6426433?v=4", "gravatar_id": "", "url": "https://api.github.com/users/1duo", "html_url": "https://github.com/1duo", "followers_url": "https://api.github.com/users/1duo/followers", "following_url": "https://api.github.com/users/1duo/following{/other_user}", "gists_url": "https://api.github.com/users/1duo/gists{/gist_id}", "starred_url": "https://api.github.com/users/1duo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/1duo/subscriptions", "organizations_url": "https://api.github.com/users/1duo/orgs", "repos_url": "https://api.github.com/users/1duo/repos", "events_url": "https://api.github.com/users/1duo/events{/privacy}", "received_events_url": "https://api.github.com/users/1duo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-07-10T15:43:16Z", "updated_at": "2020-07-13T20:29:58Z", "closed_at": "2020-07-13T20:29:58Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Setup and reproduce as in issue #784 but just use nn.InstanceNorm2d() instead\r\n\r\nLog:\r\n\r\n    mlmodel = ct.convert( traced_model, inputs= [ ct.TensorType(name=\"input1\", shape=dummy_input.shape) ] )\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/_converters_entry.py\", line 299, in convert\r\n    **kwargs\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 120, in _convert\r\n    prog = frontend_converter(model, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 62, in __call__\r\n    return load(*args, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 84, in load\r\n    raise e\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 76, in load\r\n    prog = converter.convert()\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/converter.py\", line 302, in convert\r\n    convert_nodes(self.context, self.graph)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 53, in convert_nodes\r\n    \"PyTorch convert function for op {} not implemented\".format(node.kind)\r\nRuntimeError: PyTorch convert function for op instance_norm not implemented\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/768", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/768/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/768/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/768/events", "html_url": "https://github.com/apple/coremltools/issues/768", "id": 653559749, "node_id": "MDU6SXNzdWU2NTM1NTk3NDk=", "number": 768, "title": "PyTorch to CoreML model conversion with coremltools v4.0b1 for a TransformerEncoder model/module does not complete. Missing op: bmm.", "user": {"login": "leovinus2001", "id": 48823294, "node_id": "MDQ6VXNlcjQ4ODIzMjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/48823294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leovinus2001", "html_url": "https://github.com/leovinus2001", "followers_url": "https://api.github.com/users/leovinus2001/followers", "following_url": "https://api.github.com/users/leovinus2001/following{/other_user}", "gists_url": "https://api.github.com/users/leovinus2001/gists{/gist_id}", "starred_url": "https://api.github.com/users/leovinus2001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leovinus2001/subscriptions", "organizations_url": "https://api.github.com/users/leovinus2001/orgs", "repos_url": "https://api.github.com/users/leovinus2001/repos", "events_url": "https://api.github.com/users/leovinus2001/events{/privacy}", "received_events_url": "https://api.github.com/users/leovinus2001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 8, "created_at": "2020-07-08T20:01:53Z", "updated_at": "2020-08-20T15:44:59Z", "closed_at": "2020-08-20T15:44:51Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Relevance:\r\n\r\nTransformers train faster and deliver often better models. \r\nThe coremltools v4.0 converter from PyTorch to coreml format .mlmodel should handle it well for embedded work.\r\n\r\nBackground:\r\n\r\n- the TransformerEncoder was introduced in PyTorch 1.4 I believe\r\n- the log below shows a CoreML tools v4.0b1 conversion crash on \r\nRuntimeError: PyTorch convert function for op bmm not implemented\r\n- same coremltools crash with \"pip installed version 4.0b1\" as well as TOT git pull from July 7th\r\n- I am not entirely sure what bmm is but I expect it is \"batch matrix multiply\"\r\n- MAYBE related to multi head attention, see https://github.com/pytorch/pytorch/pull/34793\r\n- In other words, IFF \"bmm == batch matrix multiply\" THEN maybe you can unfold the batch and do it once by one via normal matmul?\r\n- The LOG was produced with a patch for an extra print() in coremltools to identify the correct graph node\r\n\r\ndiff --git a/coremltools/converters/mil/frontend/torch/ops.py b/coremltools/converters/mil/frontend/torch/ops.py\r\nindex 1e19c7c..be2b13d 100644\r\n--- a/coremltools/converters/mil/frontend/torch/ops.py\r\n+++ b/coremltools/converters/mil/frontend/torch/ops.py\r\n@@ -47,6 +47,7 @@ def convert_nodes(context, graph):\r\n     for node in _tqdm(graph.nodes, desc=\"Converting Frontend ==> MIL Ops\", unit=\" ops\"):\r\n         _add_op = _TORCH_OPS_REGISTRY.get(node.kind, None)\r\n         _logging.info(\"Converting op {} : {}\".format(node.name, node.kind))\r\n+        print (\"Converting op {} : {}\".format(node.name, node.kind))\r\n         if _add_op is None:\r\n             raise RuntimeError(\r\n                 \"PyTorch convert function for op {} not implemented\".format(node.kind)\r\n@@ -955,7 +956,8 @@ def lstm(context, node):\r\n         )\r\n\r\n\r\nReproducible:\r\n\r\nYes\r\n\r\nTestcase:\r\n\r\nAttached\r\n[testTransformerEncoder.txt](https://github.com/apple/coremltools/files/4892950/testTransformerEncoder.txt)\r\n\r\nSetup:\r\n\r\nmacOS Catalina latest\r\nPython 3.7.6\r\n\r\nLog:\r\n\r\nTorch version : 1.5.1\r\nCoreML tools version : 4.0b1\r\nTestModel(\r\n  (transformer_encoder): TransformerEncoder(\r\n    (layers): ModuleList(\r\n      (0): TransformerEncoderLayer(\r\n        (self_attn): MultiheadAttention(\r\n          (out_proj): Linear(in_features=28, out_features=28, bias=True)\r\n        )\r\n        (linear1): Linear(in_features=28, out_features=16, bias=True)\r\n        (dropout): Dropout(p=0.1, inplace=False)\r\n        (linear2): Linear(in_features=16, out_features=28, bias=True)\r\n        (norm1): LayerNorm((28,), eps=1e-05, elementwise_affine=True)\r\n        (norm2): LayerNorm((28,), eps=1e-05, elementwise_affine=True)\r\n        (dropout1): Dropout(p=0.1, inplace=False)\r\n        (dropout2): Dropout(p=0.1, inplace=False)\r\n      )\r\n      (1): TransformerEncoderLayer(\r\n        (self_attn): MultiheadAttention(\r\n          (out_proj): Linear(in_features=28, out_features=28, bias=True)\r\n        )\r\n        (linear1): Linear(in_features=28, out_features=16, bias=True)\r\n        (dropout): Dropout(p=0.1, inplace=False)\r\n        (linear2): Linear(in_features=16, out_features=28, bias=True)\r\n        (norm1): LayerNorm((28,), eps=1e-05, elementwise_affine=True)\r\n        (norm2): LayerNorm((28,), eps=1e-05, elementwise_affine=True)\r\n        (dropout1): Dropout(p=0.1, inplace=False)\r\n        (dropout2): Dropout(p=0.1, inplace=False)\r\n      )\r\n    )\r\n  )\r\n)\r\nLibrary/Python/3.7/lib/python/site-packages/torch/jit/__init__.py:1037: TracerWarning: Output nr 1. of the traced function does not match the corresponding output of the Python function. Detailed error:\r\nNot within tolerance rtol=1e-05 atol=1e-05 at input[29, 0, 14] (1.3225914239883423 vs. -0.8373285531997681) and 838 other locations (99.88%)\r\n  check_tolerance, _force_outplace, True, _module_class)\r\nConverting Frontend ==> MIL Ops:   0%|                                                                                                                                                                                                                                                                | 0/188 [00:00<?, ? ops/s]Converting op 25 : constant\r\nConverting op 26 : size\r\nConverting op 27 : constant\r\nConverting op 28 : size\r\nConverting op 29 : constant\r\nConverting op 30 : size\r\nConverting op embed_dim.1 : numtotensor\r\nConverting op 32 : constant\r\nConverting op head_dim.1 : floor_divide\r\nConverting op 34 : int\r\nConverting op 35 : int\r\nConverting op 36 : int\r\nConverting op 37 : t\r\nConverting op output.1 : matmul\r\nConverting op 39 : constant\r\nConverting op 40 : add\r\nConverting op 41 : constantchunk\r\nConverting op 44 : constant\r\nConverting op q.2 : mul\r\nConverting op 46 : constant\r\nConverting op q.3 : contiguous\r\nConverting op 48 : listconstruct\r\nConverting op 49 : view\r\nConverting op 50 : constant\r\nConverting op 51 : constant\r\nConverting op q.4 : transpose\r\nConverting op 53 : constant\r\nConverting op 54 : contiguous\r\nConverting op 55 : constant\r\nConverting op 56 : listconstruct\r\nConverting op 57 : view\r\nConverting op 58 : constant\r\nConverting op 59 : constant\r\nConverting op k.2 : transpose\r\nConverting op 61 : constant\r\nConverting op 62 : contiguous\r\nConverting op 63 : constant\r\nConverting op 64 : listconstruct\r\nConverting op 65 : view\r\nConverting op 66 : constant\r\nConverting op 67 : constant\r\nConverting op v.2 : transpose\r\nConverting op 69 : constant\r\nConverting op 70 : constant\r\nConverting op 71 : transpose\r\nConverting op attn_output_weights.1 : bmm\r\nConverting Frontend ==> MIL Ops:  24%|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2589                                                                                                                                                                                           | 45/188 [00:00<00:00, 679.96 ops/s]\r\nTraceback (most recent call last):\r\n  File \"testTransformerEncoder.py\", line 40, in <module>\r\n    inputs= [ ct.TensorType(name=\"input1\", shape=dummy_input.shape) ]\r\n  File \"Library/Python/3.7/lib/python/site-packages/coremltools/converters/_converters_entry.py\", line 299, in convert\r\n    **kwargs\r\n  File \"Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 120, in _convert\r\n    prog = frontend_converter(model, **kwargs)\r\n  File \"Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 62, in __call__\r\n    return load(*args, **kwargs)\r\n  File \"Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 84, in load\r\n    raise e\r\n  File \"Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 76, in load\r\n    prog = converter.convert()\r\n  File \"Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/converter.py\", line 302, in convert\r\n    convert_nodes(self.context, self.graph)\r\n  File \"Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 53, in convert_nodes\r\n    \"PyTorch convert function for op {} not implemented\".format(node.kind)\r\nRuntimeError: PyTorch convert function for op bmm not implemented\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/763", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/763/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/763/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/763/events", "html_url": "https://github.com/apple/coremltools/issues/763", "id": 652971518, "node_id": "MDU6SXNzdWU2NTI5NzE1MTg=", "number": 763, "title": "Documentation: MIL builder \"Out\" tab is non-functional", "user": {"login": "pocketpixels", "id": 368964, "node_id": "MDQ6VXNlcjM2ODk2NA==", "avatar_url": "https://avatars1.githubusercontent.com/u/368964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pocketpixels", "html_url": "https://github.com/pocketpixels", "followers_url": "https://api.github.com/users/pocketpixels/followers", "following_url": "https://api.github.com/users/pocketpixels/following{/other_user}", "gists_url": "https://api.github.com/users/pocketpixels/gists{/gist_id}", "starred_url": "https://api.github.com/users/pocketpixels/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pocketpixels/subscriptions", "organizations_url": "https://api.github.com/users/pocketpixels/orgs", "repos_url": "https://api.github.com/users/pocketpixels/repos", "events_url": "https://api.github.com/users/pocketpixels/events{/privacy}", "received_events_url": "https://api.github.com/users/pocketpixels/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2188832616, "node_id": "MDU6TGFiZWwyMTg4ODMyNjE2", "url": "https://api.github.com/repos/apple/coremltools/labels/MIL", "name": "MIL", "color": "ff8000", "default": false, "description": "component: Model Intermediate Language (MIL)"}, {"id": 1433418622, "node_id": "MDU6TGFiZWwxNDMzNDE4NjIy", "url": "https://api.github.com/repos/apple/coremltools/labels/docs", "name": "docs", "color": "c10f47", "default": false, "description": "Contains documentation or clarification regarding docs (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-08T05:13:23Z", "updated_at": "2020-07-08T20:41:31Z", "closed_at": "2020-07-08T18:32:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "On the [Model Intermediate Language](https://coremltools.readme.io/docs/model-intermediate-language) page in the documentation, under the heading \"Building MIL Program with Builder\", the code example box has an \"Out\" tab that is supposed to show the code's output. \r\nHowever selecting this tab currently does not do anything. (Tested in Safari 13.1.1 and Chrome 83.0.4103.116)", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/762", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/762/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/762/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/762/events", "html_url": "https://github.com/apple/coremltools/issues/762", "id": 652961629, "node_id": "MDU6SXNzdWU2NTI5NjE2Mjk=", "number": 762, "title": "Documentation: Pytorch model conversion example is missing output (re)naming step", "user": {"login": "pocketpixels", "id": 368964, "node_id": "MDQ6VXNlcjM2ODk2NA==", "avatar_url": "https://avatars1.githubusercontent.com/u/368964?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pocketpixels", "html_url": "https://github.com/pocketpixels", "followers_url": "https://api.github.com/users/pocketpixels/followers", "following_url": "https://api.github.com/users/pocketpixels/following{/other_user}", "gists_url": "https://api.github.com/users/pocketpixels/gists{/gist_id}", "starred_url": "https://api.github.com/users/pocketpixels/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pocketpixels/subscriptions", "organizations_url": "https://api.github.com/users/pocketpixels/orgs", "repos_url": "https://api.github.com/users/pocketpixels/repos", "events_url": "https://api.github.com/users/pocketpixels/events{/privacy}", "received_events_url": "https://api.github.com/users/pocketpixels/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1433418622, "node_id": "MDU6TGFiZWwxNDMzNDE4NjIy", "url": "https://api.github.com/repos/apple/coremltools/labels/docs", "name": "docs", "color": "c10f47", "default": false, "description": "Contains documentation or clarification regarding docs (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-08T04:56:32Z", "updated_at": "2020-07-08T22:59:45Z", "closed_at": "2020-07-08T22:59:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "In the [Pytorch Examples section](https://coremltools.readme.io/docs/pytorch-conversion-examples) section in the documentation:\r\nIn Step 8 there is a Note stating \"This example also provides a name for the output, which will make it easier to extract from the Core ML model's prediction dictionary.\" \r\n\r\nHowever as far as I can tell no name for the output of the converted model is provided anywhere. \r\n\r\nIn Step 11, an output names \"output\" is accessed. However I don't think this will actually be the name of the model output without explicit renaming? (I have not tested it myself) \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/759", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/759/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/759/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/759/events", "html_url": "https://github.com/apple/coremltools/issues/759", "id": 652551039, "node_id": "MDU6SXNzdWU2NTI1NTEwMzk=", "number": 759, "title": "Conversion of PyTorch to .mlmodel fails on functional F.max_pool2d where stride is NOT explicitly specified.", "user": {"login": "leovinus2001", "id": 48823294, "node_id": "MDQ6VXNlcjQ4ODIzMjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/48823294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leovinus2001", "html_url": "https://github.com/leovinus2001", "followers_url": "https://api.github.com/users/leovinus2001/followers", "following_url": "https://api.github.com/users/leovinus2001/following{/other_user}", "gists_url": "https://api.github.com/users/leovinus2001/gists{/gist_id}", "starred_url": "https://api.github.com/users/leovinus2001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leovinus2001/subscriptions", "organizations_url": "https://api.github.com/users/leovinus2001/orgs", "repos_url": "https://api.github.com/users/leovinus2001/repos", "events_url": "https://api.github.com/users/leovinus2001/events{/privacy}", "received_events_url": "https://api.github.com/users/leovinus2001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2020-07-07T19:04:41Z", "updated_at": "2020-07-09T18:48:17Z", "closed_at": "2020-07-09T18:48:16Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Maybe I missed something but I have an issue with the PyTorch Functional F.max_pool2d() when the stride is NOT explicit specified, and then convert to .mlmodel.\r\n\r\nIn the attached testcase, the model conversion from PyTorch to .mlmodel fails on that operation.\r\n\r\nThere are workarounds (Pooling layer is fine) but the functional pool fails, see test case.\r\n\r\nPython 3.7.6\r\nmacOS Catalina latest\r\nTorch version : 1.5.0\r\n\r\nTestcase\r\n[testPool.txt](https://github.com/apple/coremltools/files/4886685/testPool.txt)\r\n\r\nCoreML tools version : 4.0b1\r\n\r\nLog:\r\n```\r\nConverting Frontend ==> MIL Ops:  83%\r\nTraceback (most recent call last):\r\n  File \"testPool.py\", line 93, in <module>\r\n    inputs=[ ct.TensorType(name=\"input1\", shape=dummy_input.shape) ],\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/_converters_entry.py\", line 299, in convert\r\n    **kwargs\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 120, in _convert\r\n    prog = frontend_converter(model, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 62, in __call__\r\n    return load(*args, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 86, in load\r\n    raise e\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 76, in load\r\n    prog = converter.convert()\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/converter.py\", line 302, in convert\r\n    convert_nodes(self.context, self.graph)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 55, in convert_nodes\r\n    _add_op(context, node)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 520, in max_pool2d\r\n    name=node.name,\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/ops/registry.py\", line 62, in add_op\r\n    return cls._add_op(op_cls, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/builder.py\", line 188, in _add_op\r\n    new_op = op_cls(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/ops/defs/pool.py\", line 180, in __init__\r\n    super(max_pool, self).__init__(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/ops/defs/pool.py\", line 25, in __init__\r\n    super(Pooling, self).__init__(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/operation.py\", line 151, in __init__\r\n    self._validate_and_set_inputs(**kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/operation.py\", line 368, in _validate_and_set_inputs\r\n    parsed_inputs = self.input_spec.parse_inputs(kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/mil/input_type.py\", line 67, in parse_inputs\r\n    raise TypeError(msg)\r\nTypeError: Input strides has type <class 'coremltools.converters.mil.mil.types.type_tensor.tensor.<locals>.tensor'> not compatible with expected type IntTensorInputType \r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/757", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/757/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/757/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/757/events", "html_url": "https://github.com/apple/coremltools/issues/757", "id": 652464677, "node_id": "MDU6SXNzdWU2NTI0NjQ2Nzc=", "number": 757, "title": "A PyTorch LSTM with batch_first==True cannot be converted to .mlmodel ", "user": {"login": "leovinus2001", "id": 48823294, "node_id": "MDQ6VXNlcjQ4ODIzMjk0", "avatar_url": "https://avatars2.githubusercontent.com/u/48823294?v=4", "gravatar_id": "", "url": "https://api.github.com/users/leovinus2001", "html_url": "https://github.com/leovinus2001", "followers_url": "https://api.github.com/users/leovinus2001/followers", "following_url": "https://api.github.com/users/leovinus2001/following{/other_user}", "gists_url": "https://api.github.com/users/leovinus2001/gists{/gist_id}", "starred_url": "https://api.github.com/users/leovinus2001/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/leovinus2001/subscriptions", "organizations_url": "https://api.github.com/users/leovinus2001/orgs", "repos_url": "https://api.github.com/users/leovinus2001/repos", "events_url": "https://api.github.com/users/leovinus2001/events{/privacy}", "received_events_url": "https://api.github.com/users/leovinus2001/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2020-07-07T16:38:01Z", "updated_at": "2020-07-09T18:49:38Z", "closed_at": "2020-07-09T18:49:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "The bug trace says:\r\nBug ValueError: CoreML does not support LSTM layer with batch_first==True.\r\n\r\nPython 3.7.6\r\nPyTorch 1.5.0\r\nCoreML tools version : 4.0b1\r\nmacOS Catalina latest\r\n\r\nRational:\r\nThe model and code are much cleaner if the input shape dimensions are consistently (batch size x seqLen x num features)\r\n\r\nExpected behavior:\r\nCoreML tools v4 should handle conversion of PyTorch LSTM with batchFirst == true\r\n\r\nReproducible:\r\nyes, just change 'lstmBatchFirstFlag' in test case from False to True\r\n\r\n\r\nTraceback (most recent call last):\r\n  File \"testLstmVar.py\", line 112, in <module>\r\n    inputs=[ ct.TensorType(name=\"input1\", shape=dummy_input.shape) ],\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/_converters_entry.py\", line 299, in convert\r\n    **kwargs\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 120, in _convert\r\n    prog = frontend_converter(model, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/converter.py\", line 62, in __call__\r\n    return load(*args, **kwargs)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 86, in load\r\n    raise e\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/load.py\", line 76, in load\r\n    prog = converter.convert()\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/converter.py\", line 302, in convert\r\n    convert_nodes(self.context, self.graph)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 55, in convert_nodes\r\n    _add_op(context, node)\r\n  File \"~/Library/Python/3.7/lib/python/site-packages/coremltools/converters/mil/frontend/torch/ops.py\", line 952, in lstm\r\n    raise ValueError(\"CoreML does not support LSTM layer with batch_first==True.\")\r\nValueError: CoreML does not support LSTM layer with batch_first==True.\r\n\r\n[testLstmVar.txt](https://github.com/apple/coremltools/files/4886035/testLstmVar.txt)\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/753", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/753/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/753/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/753/events", "html_url": "https://github.com/apple/coremltools/issues/753", "id": 651921451, "node_id": "MDU6SXNzdWU2NTE5MjE0NTE=", "number": 753, "title": "TypeError: model_input_signature() got an unexpected keyword argument 'keep_original_batch_size'", "user": {"login": "IAINATTWATER", "id": 5017704, "node_id": "MDQ6VXNlcjUwMTc3MDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5017704?v=4", "gravatar_id": "", "url": "https://api.github.com/users/IAINATTWATER", "html_url": "https://github.com/IAINATTWATER", "followers_url": "https://api.github.com/users/IAINATTWATER/followers", "following_url": "https://api.github.com/users/IAINATTWATER/following{/other_user}", "gists_url": "https://api.github.com/users/IAINATTWATER/gists{/gist_id}", "starred_url": "https://api.github.com/users/IAINATTWATER/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/IAINATTWATER/subscriptions", "organizations_url": "https://api.github.com/users/IAINATTWATER/orgs", "repos_url": "https://api.github.com/users/IAINATTWATER/repos", "events_url": "https://api.github.com/users/IAINATTWATER/events{/privacy}", "received_events_url": "https://api.github.com/users/IAINATTWATER/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-07T01:31:23Z", "updated_at": "2020-07-08T00:54:47Z", "closed_at": "2020-07-08T00:54:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\nConverting Keras CNN to CoreML. Tested model with predict (using an image to fully test). Converter gives subject error. Anyone seen this?\r\n\r\nIain\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/750", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/750/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/750/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/750/events", "html_url": "https://github.com/apple/coremltools/issues/750", "id": 651230857, "node_id": "MDU6SXNzdWU2NTEyMzA4NTc=", "number": 750, "title": "Xcode version error", "user": {"login": "tabsun", "id": 8773577, "node_id": "MDQ6VXNlcjg3NzM1Nzc=", "avatar_url": "https://avatars2.githubusercontent.com/u/8773577?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tabsun", "html_url": "https://github.com/tabsun", "followers_url": "https://api.github.com/users/tabsun/followers", "following_url": "https://api.github.com/users/tabsun/following{/other_user}", "gists_url": "https://api.github.com/users/tabsun/gists{/gist_id}", "starred_url": "https://api.github.com/users/tabsun/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tabsun/subscriptions", "organizations_url": "https://api.github.com/users/tabsun/orgs", "repos_url": "https://api.github.com/users/tabsun/repos", "events_url": "https://api.github.com/users/tabsun/events{/privacy}", "received_events_url": "https://api.github.com/users/tabsun/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 3, "created_at": "2020-07-06T04:05:30Z", "updated_at": "2020-07-13T18:04:54Z", "closed_at": "2020-07-13T18:04:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nAfter converting my pytorch model into mlmodel, I got a warning:\r\nRuntimeWarning: You will not be able to run predict() on this Core ML model. Underlying exception message was: Error compiling model: \"Error reading protobuf spec. validator error: The .mlmodel supplied is of version 5, intended for a newer version of Xcode. This version of Xcode supports model version 4 or earlier.\".\r\n\r\nAnd when I dragged the xxx.mlmodel into xcode, xcode cannot parse its spec and output the same error.\r\nI dont know what's wrong. Could you help me with this?\r\n\r\n## System Information\r\n- MacOS Catallina 10.15.5\r\n- Python3.6\r\n- pip install -U git+https://github.com/apple/coremltools.git\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/749", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/749/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/749/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/749/events", "html_url": "https://github.com/apple/coremltools/issues/749", "id": 651073811, "node_id": "MDU6SXNzdWU2NTEwNzM4MTE=", "number": 749, "title": "Why CoreML does not contain nearest neighbor downsampling?", "user": {"login": "s1ddok", "id": 6384566, "node_id": "MDQ6VXNlcjYzODQ1NjY=", "avatar_url": "https://avatars3.githubusercontent.com/u/6384566?v=4", "gravatar_id": "", "url": "https://api.github.com/users/s1ddok", "html_url": "https://github.com/s1ddok", "followers_url": "https://api.github.com/users/s1ddok/followers", "following_url": "https://api.github.com/users/s1ddok/following{/other_user}", "gists_url": "https://api.github.com/users/s1ddok/gists{/gist_id}", "starred_url": "https://api.github.com/users/s1ddok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/s1ddok/subscriptions", "organizations_url": "https://api.github.com/users/s1ddok/orgs", "repos_url": "https://api.github.com/users/s1ddok/repos", "events_url": "https://api.github.com/users/s1ddok/events{/privacy}", "received_events_url": "https://api.github.com/users/s1ddok/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 4, "created_at": "2020-07-05T13:50:26Z", "updated_at": "2020-07-07T17:09:48Z", "closed_at": "2020-07-05T15:08:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "Nearest neighbor downsampling is such a fundamental thing to have and for some reason CoreML lacks it. It acts as a deal breaker for our model that has integer index maps that has to be downsampled with nearest neighbors sampling. Will it ever be introduced?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/748", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/748/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/748/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/748/events", "html_url": "https://github.com/apple/coremltools/issues/748", "id": 651032780, "node_id": "MDU6SXNzdWU2NTEwMzI3ODA=", "number": 748, "title": "Boolean Mask based on threshold on specific axis", "user": {"login": "dlawrences", "id": 7821959, "node_id": "MDQ6VXNlcjc4MjE5NTk=", "avatar_url": "https://avatars1.githubusercontent.com/u/7821959?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlawrences", "html_url": "https://github.com/dlawrences", "followers_url": "https://api.github.com/users/dlawrences/followers", "following_url": "https://api.github.com/users/dlawrences/following{/other_user}", "gists_url": "https://api.github.com/users/dlawrences/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlawrences/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlawrences/subscriptions", "organizations_url": "https://api.github.com/users/dlawrences/orgs", "repos_url": "https://api.github.com/users/dlawrences/repos", "events_url": "https://api.github.com/users/dlawrences/events{/privacy}", "received_events_url": "https://api.github.com/users/dlawrences/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2020-07-05T09:14:12Z", "updated_at": "2020-07-08T03:06:42Z", "closed_at": "2020-07-06T19:05:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi guys\r\n\r\nWould you please shed some light on how a boolean mask could be applied to a tensor in CoreML by using a greater than some threshold operation **on a specific axis**?\r\n\r\nFor example, I have a tensor named `input` of shape `[1, anchors, 8]`. I would want to create a mask for this tensor like this\r\n`mask = input[..., 4] > conf_thres`\r\n\r\nAnd then subset input using that mask.\r\n\r\nI have tried to do this using **GreaterThanLayer** (` add_greater_than`) and **BranchLayer** (`add_branch`), however none of these operations have a parameter to specify the axis.\r\n\r\nThanks.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/747", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/747/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/747/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/747/events", "html_url": "https://github.com/apple/coremltools/issues/747", "id": 648674803, "node_id": "MDU6SXNzdWU2NDg2NzQ4MDM=", "number": 747, "title": "Error reporting that upsample_nearest2d is not yet implemented for PyTorch conversion", "user": {"login": "dlawrences", "id": 7821959, "node_id": "MDQ6VXNlcjc4MjE5NTk=", "avatar_url": "https://avatars1.githubusercontent.com/u/7821959?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dlawrences", "html_url": "https://github.com/dlawrences", "followers_url": "https://api.github.com/users/dlawrences/followers", "following_url": "https://api.github.com/users/dlawrences/following{/other_user}", "gists_url": "https://api.github.com/users/dlawrences/gists{/gist_id}", "starred_url": "https://api.github.com/users/dlawrences/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dlawrences/subscriptions", "organizations_url": "https://api.github.com/users/dlawrences/orgs", "repos_url": "https://api.github.com/users/dlawrences/repos", "events_url": "https://api.github.com/users/dlawrences/events{/privacy}", "received_events_url": "https://api.github.com/users/dlawrences/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 10, "created_at": "2020-07-01T05:03:45Z", "updated_at": "2020-07-08T19:42:10Z", "closed_at": "2020-07-08T19:42:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi team\r\n\r\nI am converting an YOLO network to CoreML through Torchscript and the Unified Conversion API.\r\n\r\nDuring conversion, the following error is thrown:\r\n\r\n```\r\nRuntimeError: PyTorch convert function for op upsample_nearest2d not implemented\r\n```\r\n\r\nI guess this is similar to: https://github.com/apple/coremltools/issues/736\r\n\r\nIs this going to be added to the next beta release? In the meantime, could I use any custom functions that I can pass to the converted to replace the upsample_nearest2d (some docs would help me a lot, I am having a hard time finding the right things it seems).\r\n\r\nCheers", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/736", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/736/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/736/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/736/events", "html_url": "https://github.com/apple/coremltools/issues/736", "id": 644924924, "node_id": "MDU6SXNzdWU2NDQ5MjQ5MjQ=", "number": 736, "title": "Error reporting that leaky ReLU is not yet implemented for PyTorch conversion", "user": {"login": "jbmaxwell", "id": 15166432, "node_id": "MDQ6VXNlcjE1MTY2NDMy", "avatar_url": "https://avatars3.githubusercontent.com/u/15166432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbmaxwell", "html_url": "https://github.com/jbmaxwell", "followers_url": "https://api.github.com/users/jbmaxwell/followers", "following_url": "https://api.github.com/users/jbmaxwell/following{/other_user}", "gists_url": "https://api.github.com/users/jbmaxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbmaxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbmaxwell/subscriptions", "organizations_url": "https://api.github.com/users/jbmaxwell/orgs", "repos_url": "https://api.github.com/users/jbmaxwell/repos", "events_url": "https://api.github.com/users/jbmaxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/jbmaxwell/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030793194, "node_id": "MDU6TGFiZWwyMDMwNzkzMTk0", "url": "https://api.github.com/repos/apple/coremltools/labels/pytorch", "name": "pytorch", "color": "ff8000", "default": false, "description": ""}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": {"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "DawerG", "id": 20435077, "node_id": "MDQ6VXNlcjIwNDM1MDc3", "avatar_url": "https://avatars0.githubusercontent.com/u/20435077?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DawerG", "html_url": "https://github.com/DawerG", "followers_url": "https://api.github.com/users/DawerG/followers", "following_url": "https://api.github.com/users/DawerG/following{/other_user}", "gists_url": "https://api.github.com/users/DawerG/gists{/gist_id}", "starred_url": "https://api.github.com/users/DawerG/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DawerG/subscriptions", "organizations_url": "https://api.github.com/users/DawerG/orgs", "repos_url": "https://api.github.com/users/DawerG/repos", "events_url": "https://api.github.com/users/DawerG/events{/privacy}", "received_events_url": "https://api.github.com/users/DawerG/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 11, "created_at": "2020-06-24T20:23:49Z", "updated_at": "2020-07-13T17:18:34Z", "closed_at": "2020-07-13T17:18:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "I was trying to convert a ClusterGAN from PyTorch to CoreML yesterday and got an error about leaky_relu not being implemented yet. Is there a projected timeline for this? It seems to me leaky ReLU is a very popular activation function. \r\nAs a workaround, is there a reasonably simple way to write my own for the converter to use?\r\n\r\nAny thoughts appreciated.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/734", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/734/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/734/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/734/events", "html_url": "https://github.com/apple/coremltools/issues/734", "id": 644275689, "node_id": "MDU6SXNzdWU2NDQyNzU2ODk=", "number": 734, "title": "'Object' in VisionFeaturePrint.proto is invalid in JavaScript", "user": {"login": "lutzroeder", "id": 438516, "node_id": "MDQ6VXNlcjQzODUxNg==", "avatar_url": "https://avatars3.githubusercontent.com/u/438516?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lutzroeder", "html_url": "https://github.com/lutzroeder", "followers_url": "https://api.github.com/users/lutzroeder/followers", "following_url": "https://api.github.com/users/lutzroeder/following{/other_user}", "gists_url": "https://api.github.com/users/lutzroeder/gists{/gist_id}", "starred_url": "https://api.github.com/users/lutzroeder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lutzroeder/subscriptions", "organizations_url": "https://api.github.com/users/lutzroeder/orgs", "repos_url": "https://api.github.com/users/lutzroeder/repos", "events_url": "https://api.github.com/users/lutzroeder/events{/privacy}", "received_events_url": "https://api.github.com/users/lutzroeder/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-24T02:48:25Z", "updated_at": "2020-07-28T05:24:27Z", "closed_at": "2020-07-28T05:24:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n\r\n[VisionFeaturePrint.proto](https://github.com/apple/coremltools/blob/master/mlmodel/format/VisionFeaturePrint.proto) in #731 defines a new message called `Object`. Since `Object` is a keyword in JavaScript, code generated in protobuf.js will fail with the following error:\r\n\r\n```\r\nTypeError: Object.create is not a function\r\n    at ~/Projects/netron/src/coreml-proto.js:617:66\r\n    at ~/Projects/netron/src/coreml-proto.js:621:27\r\n    at ~/Projects/netron/src/coreml-proto.js:624:23\r\n```\r\n\r\nThis is blocking adoption of the new Core ML `.proto` in JavaScript.\r\n\r\n## To Reproduce\r\n1. Install Node.js and npm\r\n2. `git clone https://github.com/lutzroeder/netron.git`\r\n3. `cd netron`\r\n4. `npm install`\r\n5. `./tools/coreml sync schema` - this will sync and update `./src/coreml-proto.js` to latest\r\n6. `npx electron .` - launches the app\r\n7. Open Core ML model\r\n\r\n<img width=\"1136\" alt=\"Screen Shot 2020-06-23 at 7 46 33 PM\" src=\"https://user-images.githubusercontent.com/438516/85492592-453d9700-b58a-11ea-9ecc-e3f20a0df9ad.png\">\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/733", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/733/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/733/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/733/events", "html_url": "https://github.com/apple/coremltools/issues/733", "id": 644235543, "node_id": "MDU6SXNzdWU2NDQyMzU1NDM=", "number": 733, "title": "Error in save_model (h5->mlmodel): 'MLModel' object has no attribute 'description'", "user": {"login": "emirkin", "id": 1053956, "node_id": "MDQ6VXNlcjEwNTM5NTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/1053956?v=4", "gravatar_id": "", "url": "https://api.github.com/users/emirkin", "html_url": "https://github.com/emirkin", "followers_url": "https://api.github.com/users/emirkin/followers", "following_url": "https://api.github.com/users/emirkin/following{/other_user}", "gists_url": "https://api.github.com/users/emirkin/gists{/gist_id}", "starred_url": "https://api.github.com/users/emirkin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/emirkin/subscriptions", "organizations_url": "https://api.github.com/users/emirkin/orgs", "repos_url": "https://api.github.com/users/emirkin/repos", "events_url": "https://api.github.com/users/emirkin/events{/privacy}", "received_events_url": "https://api.github.com/users/emirkin/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-24T00:39:36Z", "updated_at": "2020-06-24T16:22:48Z", "closed_at": "2020-06-24T16:20:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Environment:**\r\npython 3.7.6\r\ncoremltools 3.4\r\ntfcoreml 1.1\r\n\r\n**Error:**\r\n```\r\n    coremltools.utils.save_spec(coreml_model, model_path)\r\n  File \"/opt/anaconda3/lib/python3.7/site-packages/coremltools/models/utils.py\", line 65, in save_spec\r\n    spec.description.metadata.userDefined['coremltoolsVersion'] = __version__\r\nAttributeError: 'MLModel' object has no attribute 'description'\r\n```\r\n\r\n**Code:**\r\n```\r\nimport os\r\nimport sys\r\nfrom tensorflow import keras\r\nimport coremltools\r\n\r\ndef relu6(x):\r\n    return keras.backend.relu(x, max_value=6)\r\n\r\nif __name__==\"__main__\":\r\n    m_file = sys.argv[1] # XXXXXXX.h5\r\n    model_path = sys.argv[2] # XXXXXXX.mlmodel\r\n\r\n    with keras.utils.CustomObjectScope({'relu6' : relu6}):\r\n        coreml_model = coremltools.converters.tensorflow.convert(m_file)\r\n        coremltools.utils.save_spec(coreml_model, model_path)\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/725", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/725/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/725/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/725/events", "html_url": "https://github.com/apple/coremltools/issues/725", "id": 636746696, "node_id": "MDU6SXNzdWU2MzY3NDY2OTY=", "number": 725, "title": "xrunc coreml model error for YOLACT onnx with no priors layer and softmax layer", "user": {"login": "dzyjjpy", "id": 18523654, "node_id": "MDQ6VXNlcjE4NTIzNjU0", "avatar_url": "https://avatars2.githubusercontent.com/u/18523654?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dzyjjpy", "html_url": "https://github.com/dzyjjpy", "followers_url": "https://api.github.com/users/dzyjjpy/followers", "following_url": "https://api.github.com/users/dzyjjpy/following{/other_user}", "gists_url": "https://api.github.com/users/dzyjjpy/gists{/gist_id}", "starred_url": "https://api.github.com/users/dzyjjpy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dzyjjpy/subscriptions", "organizations_url": "https://api.github.com/users/dzyjjpy/orgs", "repos_url": "https://api.github.com/users/dzyjjpy/repos", "events_url": "https://api.github.com/users/dzyjjpy/events{/privacy}", "received_events_url": "https://api.github.com/users/dzyjjpy/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-06-11T06:12:55Z", "updated_at": "2020-07-23T19:32:26Z", "closed_at": "2020-07-09T14:07:42Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nhttps://stackoverflow.com/questions/62318038/xrunc-coreml-model-error-for-yolact-onnx-with-no-priors-layer-and-softmax-layer\r\n## System Information\r\n- If applicable\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/703", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/703/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/703/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/703/events", "html_url": "https://github.com/apple/coremltools/issues/703", "id": 615119418, "node_id": "MDU6SXNzdWU2MTUxMTk0MTg=", "number": 703, "title": "Unused variables", "user": {"login": "QiAnXinCodeSafe", "id": 39950310, "node_id": "MDQ6VXNlcjM5OTUwMzEw", "avatar_url": "https://avatars0.githubusercontent.com/u/39950310?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QiAnXinCodeSafe", "html_url": "https://github.com/QiAnXinCodeSafe", "followers_url": "https://api.github.com/users/QiAnXinCodeSafe/followers", "following_url": "https://api.github.com/users/QiAnXinCodeSafe/following{/other_user}", "gists_url": "https://api.github.com/users/QiAnXinCodeSafe/gists{/gist_id}", "starred_url": "https://api.github.com/users/QiAnXinCodeSafe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QiAnXinCodeSafe/subscriptions", "organizations_url": "https://api.github.com/users/QiAnXinCodeSafe/orgs", "repos_url": "https://api.github.com/users/QiAnXinCodeSafe/repos", "events_url": "https://api.github.com/users/QiAnXinCodeSafe/events{/privacy}", "received_events_url": "https://api.github.com/users/QiAnXinCodeSafe/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-09T08:01:48Z", "updated_at": "2020-07-13T17:19:51Z", "closed_at": "2020-07-13T17:19:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "https://github.com/apple/coremltools/blob/53106d81c5ec210a9a983dcd686d7ee66935af2e/coremltools/converters/nnssa/builder.py#L693\r\n\r\nVariables declared but not used, or reassigned before they are used, can be the result of programmer negligence, which often means that there is a bug in the program.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/700", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/700/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/700/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/700/events", "html_url": "https://github.com/apple/coremltools/issues/700", "id": 613066133, "node_id": "MDU6SXNzdWU2MTMwNjYxMzM=", "number": 700, "title": "Reducing size of Core ML protobuf library", "user": {"login": "teijeong", "id": 4837376, "node_id": "MDQ6VXNlcjQ4MzczNzY=", "avatar_url": "https://avatars0.githubusercontent.com/u/4837376?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teijeong", "html_url": "https://github.com/teijeong", "followers_url": "https://api.github.com/users/teijeong/followers", "following_url": "https://api.github.com/users/teijeong/following{/other_user}", "gists_url": "https://api.github.com/users/teijeong/gists{/gist_id}", "starred_url": "https://api.github.com/users/teijeong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teijeong/subscriptions", "organizations_url": "https://api.github.com/users/teijeong/orgs", "repos_url": "https://api.github.com/users/teijeong/repos", "events_url": "https://api.github.com/users/teijeong/events{/privacy}", "received_events_url": "https://api.github.com/users/teijeong/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-06T05:48:13Z", "updated_at": "2020-05-07T01:35:20Z", "closed_at": "2020-05-07T01:35:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\nHi, I'm working on generating Core ML models on device, which requires compiled protobuf library for MLModel messages. However, when compiled the library size (in Core ML 3) is about 6-700KB, and it would be great if I can reduce that. I hoped the compiler would strip out unused symbols, but it seems even unused symbols are not easily stripped from the final binary.\r\n\r\nI think there should be an existing protobuf library inside the Core ML framework - is there way to utilize that one, or alternatively is there good way to reduce size of compiled MLModel proto library?\r\n\r\nThanks", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/697", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/697/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/697/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/697/events", "html_url": "https://github.com/apple/coremltools/issues/697", "id": 603212044, "node_id": "MDU6SXNzdWU2MDMyMTIwNDQ=", "number": 697, "title": "VNCoreMLTransform request failed ...", "user": {"login": "ricox78", "id": 37598565, "node_id": "MDQ6VXNlcjM3NTk4NTY1", "avatar_url": "https://avatars3.githubusercontent.com/u/37598565?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ricox78", "html_url": "https://github.com/ricox78", "followers_url": "https://api.github.com/users/ricox78/followers", "following_url": "https://api.github.com/users/ricox78/following{/other_user}", "gists_url": "https://api.github.com/users/ricox78/gists{/gist_id}", "starred_url": "https://api.github.com/users/ricox78/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ricox78/subscriptions", "organizations_url": "https://api.github.com/users/ricox78/orgs", "repos_url": "https://api.github.com/users/ricox78/repos", "events_url": "https://api.github.com/users/ricox78/events{/privacy}", "received_events_url": "https://api.github.com/users/ricox78/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-20T12:48:18Z", "updated_at": "2020-05-02T06:36:45Z", "closed_at": "2020-05-02T06:36:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\n## System Information\r\n- Iphone 5s\r\n\r\nHello, \r\nI convert a keras h5 model (trained with darknet on the yolov3-tiny base) tocoreml.\r\nall seems to go well, but, when I try to use it in my Xcode Project I have always the error:\r\nVNCoreMLTransform request failed\r\n\r\nanyone could have an idea on why??\r\nThank's a lot\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/696", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/696/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/696/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/696/events", "html_url": "https://github.com/apple/coremltools/issues/696", "id": 602370634, "node_id": "MDU6SXNzdWU2MDIzNzA2MzQ=", "number": 696, "title": "For the MSE loss layer, input is not generated within the graph", "user": {"login": "ByCyril", "id": 15741987, "node_id": "MDQ6VXNlcjE1NzQxOTg3", "avatar_url": "https://avatars0.githubusercontent.com/u/15741987?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ByCyril", "html_url": "https://github.com/ByCyril", "followers_url": "https://api.github.com/users/ByCyril/followers", "following_url": "https://api.github.com/users/ByCyril/following{/other_user}", "gists_url": "https://api.github.com/users/ByCyril/gists{/gist_id}", "starred_url": "https://api.github.com/users/ByCyril/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ByCyril/subscriptions", "organizations_url": "https://api.github.com/users/ByCyril/orgs", "repos_url": "https://api.github.com/users/ByCyril/repos", "events_url": "https://api.github.com/users/ByCyril/events{/privacy}", "received_events_url": "https://api.github.com/users/ByCyril/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-18T03:52:39Z", "updated_at": "2020-04-18T05:06:40Z", "closed_at": "2020-04-18T05:06:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nI created a simple neural network with Keras and successfully converted to a CoreML model.\r\nThe model used the SGD optimizer and the MSE loss function. \r\n\r\nSpecifying the loss layer in the process of converting a CoreML model to an updatable model would return this runtime error when passing the model spec to an MLModel object.\r\n\r\n```\r\nRuntimeWarning: You will not be able to run predict() on this Core ML model. Underlying exception message was: Error compiling model: \"Error reading protobuf spec. validator error: For the MSE loss layer named 'lossLayer', input is not generated within the graph.\".\r\n```\r\n\r\nThis is how I set the loss function. For context, the neural network takes in 3 inputs and returns 1 output between 0 and 1.\r\n\r\n```\r\nfeature = ('dense_1', datatypes.Array(3))\r\nbuilder.set_mean_squared_error_loss(name='lossLayer', input_feature=feature)\r\n```\r\n\r\nI think I'm right in specifying the tensor shape to 3. For more context, this is how I structured my neural network\r\n\r\n```\r\ninput_layer = Dense(3,input_shape=[3],activation='tanh')\r\nmid_layer = Dense(2,activation='tanh')\r\noutput_layer = Dense(1,activation='sigmoid')\r\n\r\nmodel.add(input_layer)\r\nmodel.add(mid_layer)\r\nmodel.add(output_layer)\r\n\r\nmodel.compile(optimizer=keras.optimizers.SGD(lr=0.01), loss=keras.losses.mean_squared_error)\r\n```\r\nDo I not have to set a loss function since it's already specified in the original model?\r\n\r\nThanks,\r\n-Cyril\r\n\r\n## System Information\r\ncoremlmodel version 3.3\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/695", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/695/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/695/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/695/events", "html_url": "https://github.com/apple/coremltools/issues/695", "id": 600896472, "node_id": "MDU6SXNzdWU2MDA4OTY0NzI=", "number": 695, "title": "Can coreMlTool support batchSize info?", "user": {"login": "ppl21847", "id": 34120042, "node_id": "MDQ6VXNlcjM0MTIwMDQy", "avatar_url": "https://avatars0.githubusercontent.com/u/34120042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ppl21847", "html_url": "https://github.com/ppl21847", "followers_url": "https://api.github.com/users/ppl21847/followers", "following_url": "https://api.github.com/users/ppl21847/following{/other_user}", "gists_url": "https://api.github.com/users/ppl21847/gists{/gist_id}", "starred_url": "https://api.github.com/users/ppl21847/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ppl21847/subscriptions", "organizations_url": "https://api.github.com/users/ppl21847/orgs", "repos_url": "https://api.github.com/users/ppl21847/repos", "events_url": "https://api.github.com/users/ppl21847/events{/privacy}", "received_events_url": "https://api.github.com/users/ppl21847/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-16T09:41:00Z", "updated_at": "2020-05-02T06:38:49Z", "closed_at": "2020-05-02T06:38:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "now I use coremltool convert caffe model, than convert to onnx, but when i get lmmodel, this model not contain batchSize info.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/694", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/694/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/694/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/694/events", "html_url": "https://github.com/apple/coremltools/issues/694", "id": 600834896, "node_id": "MDU6SXNzdWU2MDA4MzQ4OTY=", "number": 694, "title": "CoreMLTool\u8f6c\u5b8c\u7684\u6a21\u578b\u80fd\u4e0d\u80fd\u652f\u6301batchsize", "user": {"login": "ppl21847", "id": 34120042, "node_id": "MDQ6VXNlcjM0MTIwMDQy", "avatar_url": "https://avatars0.githubusercontent.com/u/34120042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ppl21847", "html_url": "https://github.com/ppl21847", "followers_url": "https://api.github.com/users/ppl21847/followers", "following_url": "https://api.github.com/users/ppl21847/following{/other_user}", "gists_url": "https://api.github.com/users/ppl21847/gists{/gist_id}", "starred_url": "https://api.github.com/users/ppl21847/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ppl21847/subscriptions", "organizations_url": "https://api.github.com/users/ppl21847/orgs", "repos_url": "https://api.github.com/users/ppl21847/repos", "events_url": "https://api.github.com/users/ppl21847/events{/privacy}", "received_events_url": "https://api.github.com/users/ppl21847/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-16T08:10:03Z", "updated_at": "2020-05-02T06:39:21Z", "closed_at": "2020-05-02T06:39:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "CoreMLTool\u8f6c\u5b8c\u7684\u6a21\u578b\u80fd\u4e0d\u80fd\u652f\u6301batchsize\uff0c\u73b0\u5728\u770b\u6e90\u7801\u662f\u76f4\u63a5\u628abatchSize\u53bb\u6389\u4e86\uff0c\u80fd\u4e0d\u80fd\u628abatchSize\u4fe1\u606f\u4fdd\u5b58\u5230\u6a21\u578b\u4e2d\u3002\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/693", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/693/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/693/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/693/events", "html_url": "https://github.com/apple/coremltools/issues/693", "id": 600735888, "node_id": "MDU6SXNzdWU2MDA3MzU4ODg=", "number": 693, "title": "caffe\u6a21\u578b\u8f6cmlmodel\u540e\uff0cbatchSize\u4fe1\u606f\u4e22\u5931", "user": {"login": "ppl21847", "id": 34120042, "node_id": "MDQ6VXNlcjM0MTIwMDQy", "avatar_url": "https://avatars0.githubusercontent.com/u/34120042?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ppl21847", "html_url": "https://github.com/ppl21847", "followers_url": "https://api.github.com/users/ppl21847/followers", "following_url": "https://api.github.com/users/ppl21847/following{/other_user}", "gists_url": "https://api.github.com/users/ppl21847/gists{/gist_id}", "starred_url": "https://api.github.com/users/ppl21847/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ppl21847/subscriptions", "organizations_url": "https://api.github.com/users/ppl21847/orgs", "repos_url": "https://api.github.com/users/ppl21847/repos", "events_url": "https://api.github.com/users/ppl21847/events{/privacy}", "received_events_url": "https://api.github.com/users/ppl21847/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-16T04:18:28Z", "updated_at": "2020-05-02T06:44:18Z", "closed_at": "2020-05-02T06:44:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "\u5982\u9898\uff0c\u901a\u8fc7CoreMLTool\u8f6c\u6a21\u578b\u540e\uff0cignoring batch size\uff0c\u8fd9\u4e2a\u80fd\u8bbe\u7f6e\u5417\uff0c\u540e\u7eed\u8fd8\u60f3\u8f6connx\uff0c\u4e22\u5931batchSize\u4fe1\u606f\u540e\u51fa\u73b0\u95ee\u9898\u3002\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/687", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/687/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/687/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/687/events", "html_url": "https://github.com/apple/coremltools/issues/687", "id": 598417955, "node_id": "MDU6SXNzdWU1OTg0MTc5NTU=", "number": 687, "title": "Deprecation warning due to invalid escape sequences and literal comparison in Python 3.7", "user": {"login": "tirkarthi", "id": 3972343, "node_id": "MDQ6VXNlcjM5NzIzNDM=", "avatar_url": "https://avatars3.githubusercontent.com/u/3972343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tirkarthi", "html_url": "https://github.com/tirkarthi", "followers_url": "https://api.github.com/users/tirkarthi/followers", "following_url": "https://api.github.com/users/tirkarthi/following{/other_user}", "gists_url": "https://api.github.com/users/tirkarthi/gists{/gist_id}", "starred_url": "https://api.github.com/users/tirkarthi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tirkarthi/subscriptions", "organizations_url": "https://api.github.com/users/tirkarthi/orgs", "repos_url": "https://api.github.com/users/tirkarthi/repos", "events_url": "https://api.github.com/users/tirkarthi/events{/privacy}", "received_events_url": "https://api.github.com/users/tirkarthi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-04-12T05:57:28Z", "updated_at": "2020-05-02T04:46:47Z", "closed_at": "2020-05-02T04:46:47Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n\r\nDeprecation warnings are raised due to invalid escape sequences. This can be fixed by using raw strings or escaping the literals. Syntax warning is caused due to comparison of literals using is.\r\n\r\n## To Reproduce\r\n\r\n```\r\nfind . -iname '*.py' | grep -Ev 'example|utl|samples|deps' | xargs -P 4 -I{} python3.8 -Wall -m py_compile {} \r\n./coremltools/models/neural_network/builder.py:618: DeprecationWarning: invalid escape sequence \\s\r\n  \"\"\"\r\n./coremltools/models/_graph_visualization.py:541: DeprecationWarning: invalid escape sequence \\c\r\n  'f(x) = scaleValue \\cdot (x + shiftValue)'\r\n./coremltools/converters/nnssa/commons/builtins/type_spec.py:53: DeprecationWarning: invalid escape sequence \\_\r\n  \"\"\"\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:161: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  if model.algorithm is 'brute' or model.algorithm is 'kd_tree':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:161: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  if model.algorithm is 'brute' or model.algorithm is 'kd_tree':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:164: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  elif model.algorithm is 'auto' and model._fit_method is 'kd_tree':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:164: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  elif model.algorithm is 'auto' and model._fit_method is 'kd_tree':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:167: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  elif model.algorithm is 'auto' and model._fit_method is 'brute':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:167: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  elif model.algorithm is 'auto' and model._fit_method is 'brute':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:176: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  if model.weights is 'uniform':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:192: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  if model.metric is 'euclidean':\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:194: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  elif model.metric is 'minkowski' and model.p == 2:\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:209: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  return model.algorithm is 'brute' or (model.algorithm is 'auto' and model._fit_method is 'brute')\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:209: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  return model.algorithm is 'brute' or (model.algorithm is 'auto' and model._fit_method is 'brute')\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:209: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  return model.algorithm is 'brute' or (model.algorithm is 'auto' and model._fit_method is 'brute')\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:213: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  return model.algorithm is 'kd_tree' or (model.algorithm is 'auto' and model._fit_method is 'kd_tree')\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:213: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  return model.algorithm is 'kd_tree' or (model.algorithm is 'auto' and model._fit_method is 'kd_tree')\r\n./coremltools/converters/sklearn/_k_neighbors_classifier.py:213: SyntaxWarning: \"is\" with a literal. Did you mean \"==\"?\r\n  return model.algorithm is 'kd_tree' or (model.algorithm is 'auto' and model._fit_method is 'kd_tree')\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/685", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/685/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/685/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/685/events", "html_url": "https://github.com/apple/coremltools/issues/685", "id": 598352408, "node_id": "MDU6SXNzdWU1OTgzNTI0MDg=", "number": 685, "title": "KeyError: 'begin_masks'", "user": {"login": "danvargg", "id": 13923005, "node_id": "MDQ6VXNlcjEzOTIzMDA1", "avatar_url": "https://avatars1.githubusercontent.com/u/13923005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danvargg", "html_url": "https://github.com/danvargg", "followers_url": "https://api.github.com/users/danvargg/followers", "following_url": "https://api.github.com/users/danvargg/following{/other_user}", "gists_url": "https://api.github.com/users/danvargg/gists{/gist_id}", "starred_url": "https://api.github.com/users/danvargg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danvargg/subscriptions", "organizations_url": "https://api.github.com/users/danvargg/orgs", "repos_url": "https://api.github.com/users/danvargg/repos", "events_url": "https://api.github.com/users/danvargg/events{/privacy}", "received_events_url": "https://api.github.com/users/danvargg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 2030770918, "node_id": "MDU6TGFiZWwyMDMwNzcwOTE4", "url": "https://api.github.com/repos/apple/coremltools/labels/p2", "name": "p2", "color": "201489", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": {"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}], "milestone": {"url": "https://api.github.com/repos/apple/coremltools/milestones/1", "html_url": "https://github.com/apple/coremltools/milestone/1", "labels_url": "https://api.github.com/repos/apple/coremltools/milestones/1/labels", "id": 5373951, "node_id": "MDk6TWlsZXN0b25lNTM3Mzk1MQ==", "number": 1, "title": "4.0", "description": null, "creator": {"login": "srikris", "id": 1875987, "node_id": "MDQ6VXNlcjE4NzU5ODc=", "avatar_url": "https://avatars0.githubusercontent.com/u/1875987?v=4", "gravatar_id": "", "url": "https://api.github.com/users/srikris", "html_url": "https://github.com/srikris", "followers_url": "https://api.github.com/users/srikris/followers", "following_url": "https://api.github.com/users/srikris/following{/other_user}", "gists_url": "https://api.github.com/users/srikris/gists{/gist_id}", "starred_url": "https://api.github.com/users/srikris/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/srikris/subscriptions", "organizations_url": "https://api.github.com/users/srikris/orgs", "repos_url": "https://api.github.com/users/srikris/repos", "events_url": "https://api.github.com/users/srikris/events{/privacy}", "received_events_url": "https://api.github.com/users/srikris/received_events", "type": "User", "site_admin": false}, "open_issues": 8, "closed_issues": 2, "state": "open", "created_at": "2020-05-02T06:31:46Z", "updated_at": "2020-08-21T03:26:42Z", "due_on": null, "closed_at": null}, "comments": 3, "created_at": "2020-04-11T21:13:35Z", "updated_at": "2020-05-09T17:58:56Z", "closed_at": "2020-05-09T17:58:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nThis is a continuation of issue #623 . The change was merged into master. I upgraded `coremltools` and ran the conversion, but it threw out the below error. Should I open a separate issue? It does convert a big chunk of the ops.\r\n\r\n## Trace\r\n```python\r\nTraceback (most recent call last):\r\n  File \"tf2coreml.py\", line 103, in <module>\r\n    convertModel(model=_TRAIN_MODEL, ml_model=_ML_MODEL)\r\n  File \"tf2coreml.py\", line 94, in convertModel\r\n    minimum_ios_deployment_target='13')\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/tensorflow/_tf_converter.py\", line 193, in convert\r\n    optional_inputs=optional_inputs)\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/nnssa/coreml/ssa_converter.py\", line 154, in ssa_convert\r\n    converter.convert()\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/nnssa/coreml/ssa_converter.py\", line 581, in convert\r\n    convert_func(node)\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/nnssa/coreml/ssa_converter.py\", line 801, in _convert_slice\r\n    begin_masks = [True if i in node.attr['begin_masks'] else False for i in range(rank)]\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/nnssa/coreml/ssa_converter.py\", line 801, in <listcomp>\r\n    begin_masks = [True if i in node.attr['begin_masks'] else False for i in range(rank)]\r\nKeyError: 'begin_masks'\r\n```\r\n\r\n## To Reproduce\r\nSame as issue #623 .\r\n```python\r\ntf.keras.backend.clear_session()\r\ntf.keras.backend.set_learning_phase(0)\r\n\r\n# model is a .h5 file produced from a model.fit callback (modelcheckpoint)\r\n# I have a custom dense layer that has __init__, build, call and config implemented\r\nmodel = tf.keras.models.load_model(model, custom_objects = {'DenseLayer': DenseLayer})\r\n\r\ntf.saved_model.save(model, export_dir = pb_model) # save the model as pb for conversion\r\n\r\n# my target ios is 12\r\ncoremltools_model = coremltools.converters.tensorflow.convert(\r\n        _PB_MODEL,\r\n        input_name_shape_dict={\r\n            'B': [1, 20, 40, 1],\r\n            'G': [1, 20, 40, 1],\r\n            'R': [1, 20, 40, 1],\r\n            'X': [1, 2],\r\n            'Y': [1, 4]},\r\n        output_feature_names=['dense_layer_18/Identity'],\r\n        minimum_ios_deployment_target='12'\r\n    )\r\n\r\ncoremltools_model.save(ml_model)\r\n```\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 3.2\r\n - OS (e.g., MacOS, Linux): Ubuntu 18.04 (AWS EC2)\r\n - How you install python: pip\r\n - python version (e.g. 3.7): 3.6.5\r\n - tensorflow version: 1.15.0 (tf.keras)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/684", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/684/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/684/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/684/events", "html_url": "https://github.com/apple/coremltools/issues/684", "id": 596847469, "node_id": "MDU6SXNzdWU1OTY4NDc0Njk=", "number": 684, "title": "Python 3.8 Support", "user": {"login": "TobyRoseman", "id": 5420744, "node_id": "MDQ6VXNlcjU0MjA3NDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5420744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobyRoseman", "html_url": "https://github.com/TobyRoseman", "followers_url": "https://api.github.com/users/TobyRoseman/followers", "following_url": "https://api.github.com/users/TobyRoseman/following{/other_user}", "gists_url": "https://api.github.com/users/TobyRoseman/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobyRoseman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobyRoseman/subscriptions", "organizations_url": "https://api.github.com/users/TobyRoseman/orgs", "repos_url": "https://api.github.com/users/TobyRoseman/repos", "events_url": "https://api.github.com/users/TobyRoseman/events{/privacy}", "received_events_url": "https://api.github.com/users/TobyRoseman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1433382939, "node_id": "MDU6TGFiZWwxNDMzMzgyOTM5", "url": "https://api.github.com/repos/apple/coremltools/labels/feature%20request", "name": "feature request", "color": "e7aaff", "default": false, "description": "Functionality does not currently exist, would need to be created as a new feature (type)"}, {"id": 1834488638, "node_id": "MDU6TGFiZWwxODM0NDg4NjM4", "url": "https://api.github.com/repos/apple/coremltools/labels/p1", "name": "p1", "color": "201489", "default": false, "description": ""}, {"id": 1722438267, "node_id": "MDU6TGFiZWwxNzIyNDM4MjY3", "url": "https://api.github.com/repos/apple/coremltools/labels/python", "name": "python", "color": "ededed", "default": false, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": {"url": "https://api.github.com/repos/apple/coremltools/milestones/1", "html_url": "https://github.com/apple/coremltools/milestone/1", "labels_url": "https://api.github.com/repos/apple/coremltools/milestones/1/labels", "id": 5373951, "node_id": "MDk6TWlsZXN0b25lNTM3Mzk1MQ==", "number": 1, "title": "4.0", "description": null, "creator": {"login": "srikris", "id": 1875987, "node_id": "MDQ6VXNlcjE4NzU5ODc=", "avatar_url": "https://avatars0.githubusercontent.com/u/1875987?v=4", "gravatar_id": "", "url": "https://api.github.com/users/srikris", "html_url": "https://github.com/srikris", "followers_url": "https://api.github.com/users/srikris/followers", "following_url": "https://api.github.com/users/srikris/following{/other_user}", "gists_url": "https://api.github.com/users/srikris/gists{/gist_id}", "starred_url": "https://api.github.com/users/srikris/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/srikris/subscriptions", "organizations_url": "https://api.github.com/users/srikris/orgs", "repos_url": "https://api.github.com/users/srikris/repos", "events_url": "https://api.github.com/users/srikris/events{/privacy}", "received_events_url": "https://api.github.com/users/srikris/received_events", "type": "User", "site_admin": false}, "open_issues": 8, "closed_issues": 2, "state": "open", "created_at": "2020-05-02T06:31:46Z", "updated_at": "2020-08-21T03:26:42Z", "due_on": null, "closed_at": null}, "comments": 1, "created_at": "2020-04-08T20:39:55Z", "updated_at": "2020-08-21T03:27:09Z", "closed_at": "2020-08-21T03:26:42Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "As of October 14th, 2019 Python 3.8 has been officially released. coremltools should support it.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/683", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/683/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/683/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/683/events", "html_url": "https://github.com/apple/coremltools/issues/683", "id": 596677678, "node_id": "MDU6SXNzdWU1OTY2Nzc2Nzg=", "number": 683, "title": "coreml convertion of scikit-learn 22 fails with error \"ImportError: cannot import name 'Imputer'\"", "user": {"login": "sahanaha1234", "id": 50445424, "node_id": "MDQ6VXNlcjUwNDQ1NDI0", "avatar_url": "https://avatars2.githubusercontent.com/u/50445424?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sahanaha1234", "html_url": "https://github.com/sahanaha1234", "followers_url": "https://api.github.com/users/sahanaha1234/followers", "following_url": "https://api.github.com/users/sahanaha1234/following{/other_user}", "gists_url": "https://api.github.com/users/sahanaha1234/gists{/gist_id}", "starred_url": "https://api.github.com/users/sahanaha1234/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sahanaha1234/subscriptions", "organizations_url": "https://api.github.com/users/sahanaha1234/orgs", "repos_url": "https://api.github.com/users/sahanaha1234/repos", "events_url": "https://api.github.com/users/sahanaha1234/events{/privacy}", "received_events_url": "https://api.github.com/users/sahanaha1234/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-04-08T15:45:12Z", "updated_at": "2020-05-02T06:54:36Z", "closed_at": "2020-05-02T06:54:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to convert scikit-learn 22 model using coremltool. I have scikit-learn 0.22.1 installed on my system and coremltools version is 3.3.\r\n\r\nIt fails with the following error during conversion\r\n\r\n  File \"/Users/home/anaconda3/lib/python3.6/site-packages/coremltools/converters/sklearn/_imputer.py\", line 17, in <module>\r\n    from sklearn.preprocessing import Imputer\r\nImportError: cannot import name 'Imputer'\r\n\r\nExample I tried:\r\n\r\n>>> from sklearn.linear_model import LinearRegression\r\n>>> import pandas as pd\r\n>>> data = pd.read_csv('houses.csv')\r\n>>> model = LinearRegression()\r\n>>> model.fit(data[[\"bedroom\", \"bath\", \"size\"]], data[\"price\"])\r\nLinearRegression(copy_X=True, fit_intercept=True, n_jobs=None, normalize=False)\r\n>>> import coremltools\r\n>>> coreml_model = coremltools.converters.sklearn.convert(model, [\"bedroom\", \"bath\", \"size\"], \"price\")\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/home/anaconda3/lib/python3.6/site-packages/coremltools/converters/sklearn/_converter.py\", line 145, in convert\r\n    from ._converter_internal import _convert_sklearn_model\r\n  File \"/Users/home/anaconda3/lib/python3.6/site-packages/coremltools/converters/sklearn/_converter_internal.py\", line 42, in <module>\r\n    from . import _imputer\r\n  File \"/Users/home/anaconda3/lib/python3.6/site-packages/coremltools/converters/sklearn/_imputer.py\", line 17, in <module>\r\n    from sklearn.preprocessing import Imputer\r\nImportError: cannot import name 'Imputer'\r\n\r\n\r\nThe line 18 and 21 in file _imputer.py needs to be modified as shown, if sklearn version is 22\r\n>>>>\r\n 15 if _HAS_SKLEARN:\r\n 16     import sklearn\r\n 17 if SKLEARN_22:\r\n 18     from sklearn.impute import SimpleImputer as Imputer\r\n 19 model_type = 'transformer'\r\n 20 if SKLEARN_22:\r\n 21     sklearn_class = sklearn.impute.SimpleImputer\r\n<<<<\r\n\r\nThe above should fix the problem. Looking forward for this fix in next release\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/682", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/682/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/682/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/682/events", "html_url": "https://github.com/apple/coremltools/issues/682", "id": 591559538, "node_id": "MDU6SXNzdWU1OTE1NTk1Mzg=", "number": 682, "title": "Validation Error importing a model", "user": {"login": "JacopoMangiavacchi", "id": 8699190, "node_id": "MDQ6VXNlcjg2OTkxOTA=", "avatar_url": "https://avatars1.githubusercontent.com/u/8699190?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JacopoMangiavacchi", "html_url": "https://github.com/JacopoMangiavacchi", "followers_url": "https://api.github.com/users/JacopoMangiavacchi/followers", "following_url": "https://api.github.com/users/JacopoMangiavacchi/following{/other_user}", "gists_url": "https://api.github.com/users/JacopoMangiavacchi/gists{/gist_id}", "starred_url": "https://api.github.com/users/JacopoMangiavacchi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JacopoMangiavacchi/subscriptions", "organizations_url": "https://api.github.com/users/JacopoMangiavacchi/orgs", "repos_url": "https://api.github.com/users/JacopoMangiavacchi/repos", "events_url": "https://api.github.com/users/JacopoMangiavacchi/events{/privacy}", "received_events_url": "https://api.github.com/users/JacopoMangiavacchi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-01T01:56:52Z", "updated_at": "2020-04-04T18:50:43Z", "closed_at": "2020-04-04T18:50:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "I\u2019m developing a Swift tool to export a model directly using the protobuf files defined in this repo.  It worked pretty with trivial NN.  Now I\u2019m trying to export a retrainable CNN but I\u2019m always getting a validation error importing the model in xcode.\r\n\r\nThe specific validation error I have is that a Layer consumes an input which is not present in this network.  \r\n\r\nI double checked several time the input and output names of all layers and I\u2019ve also tried to rename those names but the result is always the same validation error, eventually on a different layer.\r\n\r\nWhat I do not understand is that the Netron tool instead is able to load the model and display the graph correctly.  This seems to me a confirmation that all input and output names referenced by all the layers are correct.\r\n\r\nFor sure I\u2019m doing something wrong on the protobuf serialization but I'm inclined to think that the error message is probably not correct.\r\n\r\nI put the model in this GitHub repo:\r\nhttps://github.com/JacopoMangiavacchi/CNN-CoreML-Retrainable\r\n\r\nIs there any chance I can ask someone here to debug/review this file and give me any hints.\r\n\r\nThank you very much for any support.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/680", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/680/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/680/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/680/events", "html_url": "https://github.com/apple/coremltools/issues/680", "id": 588766042, "node_id": "MDU6SXNzdWU1ODg3NjYwNDI=", "number": 680, "title": "Converting a keras network with a MaxPoolingWithArgmax2D layer", "user": {"login": "kretash", "id": 9167203, "node_id": "MDQ6VXNlcjkxNjcyMDM=", "avatar_url": "https://avatars2.githubusercontent.com/u/9167203?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kretash", "html_url": "https://github.com/kretash", "followers_url": "https://api.github.com/users/kretash/followers", "following_url": "https://api.github.com/users/kretash/following{/other_user}", "gists_url": "https://api.github.com/users/kretash/gists{/gist_id}", "starred_url": "https://api.github.com/users/kretash/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kretash/subscriptions", "organizations_url": "https://api.github.com/users/kretash/orgs", "repos_url": "https://api.github.com/users/kretash/repos", "events_url": "https://api.github.com/users/kretash/events{/privacy}", "received_events_url": "https://api.github.com/users/kretash/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-26T22:26:25Z", "updated_at": "2020-03-31T18:12:08Z", "closed_at": "2020-03-31T18:12:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to convert a network with a MaxPoolingWithArgmax2D layer over to CoreML. I have simplified it to this script right here. And it's throwing an error.\r\n\r\n```python\r\nimport os\r\nimport numpy as np\r\nimport keras\r\nimport tensorflow as tf\r\n\r\ntf.compat.v1.logging.set_verbosity(tf.compat.v1.logging.ERROR)\r\n\r\nfrom keras.models import Model\r\nfrom keras.layers import Input, Layer\r\nfrom keras.layers.convolutional import Conv2D\r\nfrom keras import backend as K\r\n\r\nimport coremltools\r\nfrom coremltools.proto import NeuralNetwork_pb2\r\n\r\nprint( \"tf.__version__: \", tf.__version__ )\r\nprint( \"keras.__version__: \", keras.__version__ )\r\nprint( \"coremltools.__version__: \", coremltools.__version__ )\r\n\r\nclass MaxPoolingWithArgmax2D(Layer):\r\n    def __init__(\r\n            self,\r\n            pool_size=(2, 2),\r\n            strides=(2, 2),\r\n            padding='same',\r\n            **kwargs):\r\n        super(MaxPoolingWithArgmax2D, self).__init__(**kwargs)\r\n        self.padding = padding\r\n        self.pool_size = pool_size\r\n        self.strides = strides\r\n\r\n    def call(self, inputs, **kwargs):\r\n        padding = self.padding\r\n        pool_size = self.pool_size\r\n        strides = self.strides\r\n        if K.backend() == 'tensorflow':\r\n            ksize = [1, pool_size[0], pool_size[1], 1]\r\n            padding = padding.upper()\r\n            strides = [1, strides[0], strides[1], 1]\r\n            output, argmax = tf.nn.max_pool_with_argmax(\r\n                inputs,\r\n                ksize=ksize,\r\n                strides=strides,\r\n                padding=padding)\r\n        else:\r\n            errmsg = '{} backend is not supported for layer {}'.format(\r\n                K.backend(), type(self).__name__)\r\n            raise NotImplementedError(errmsg)\r\n        argmax = K.cast(argmax, K.floatx())\r\n        return [output, argmax]\r\n\r\n    def compute_output_shape(self, input_shape):\r\n        ratio = (1, 2, 2, 1)\r\n        output_shape = [\r\n            dim // ratio[idx]\r\n            if dim is not None else None\r\n            for idx, dim in enumerate(input_shape)]\r\n        output_shape = tuple(output_shape)\r\n        return [output_shape, output_shape]\r\n\r\n    def compute_mask(self, inputs, mask=None):\r\n        return 2 * [None]\r\n\r\n# Build a test keras network with a MaxPoolingWithArgmax2D layer.\r\ninput = Input( name=\"input\", shape=(512,512,3) )\r\nconv_0 = Conv2D( 16, kernel_size=3, strides=2, padding=\"same\" )( input )\r\nlayer, mask = MaxPoolingWithArgmax2D()( conv_0 )\r\nconv_1 = Conv2D( 4, name=\"output\", kernel_size=3, strides=2, padding=\"same\" )( layer )\r\nmodel = Model(inputs=input, outputs=[conv_1])\r\nmodel.save(\"test.h5\")\r\n\r\n# Conversion function for MaxPoolingWithArgmax2D\r\ndef ConvertMaxPoolingWithArgmax2D(layer):\r\n    print(\"Converting custom layer [ConvertMaxPoolingWithArgmax2D].\")\r\n    params = NeuralNetwork_pb2.CustomLayerParams()\r\n    params.className = \"MaxPoolingWithArgmax2D\"\r\n    params.description = \"MaxPoolingWithArgmax2D\"\r\n    return params\r\n\r\n# Convert to CoreML\r\nprint(\"Loading the model....\")\r\ncoreml_model = coremltools.converters.keras.convert( \"test.h5\", add_custom_layers=True,\r\n    custom_conversion_functions={ \"MaxPoolingWithArgmax2D\": ConvertMaxPoolingWithArgmax2D } )\r\n\r\nprint(\"Done, Saving....\")\r\ncoreml_model.save('test.mlmodel')\r\nprint(\"All Done!\")\r\n```\r\n\r\nThe output looks like this:\r\n\r\n```bash\r\nUsing TensorFlow backend.\r\nWARNING:root:TensorFlow version 1.15.0 detected. Last version known to be fully compatible is 1.14.0 .\r\ntf.__version__:  1.15.0\r\nkeras.__version__:  2.2.4\r\ncoremltools.__version__:  3.3\r\n2020-03-26 15:15:02.239779: I tensorflow/core/platform/cpu_feature_guard.cc:145] This TensorFlow binary is optimized with Intel(R) MKL-DNN to use the following CPU instructions in performance critical operations:  SSE4.1 SSE4.2 AVX AVX2 FMA\r\nTo enable them in non-MKL-DNN operations, rebuild TensorFlow with the appropriate compiler flags.\r\n2020-03-26 15:15:02.240108: I tensorflow/core/common_runtime/process_util.cc:115] Creating new thread pool with default inter op setting: 8. Tune using inter_op_parallelism_threads for best performance.\r\nLoading the model....\r\nTraceback (most recent call last):\r\n  File \"test_coreml.py\", line 83, in <module>\r\n    custom_conversion_functions={ \"MaxPoolingWithArgmax2D\": ConvertMaxPoolingWithArgmax2D } )\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/coremltools/converters/keras/_keras_converter.py\", line 804, in convert\r\n    use_float_arraytype=use_float_arraytype)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/coremltools/converters/keras/_keras_converter.py\", line 585, in convertToSpec\r\n    use_float_arraytype=use_float_arraytype)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/coremltools/converters/keras/_keras2_converter.py\", line 319, in _convert\r\n    model = _keras.models.load_model(model, custom_objects = custom_objects)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/engine/saving.py\", line 419, in load_model\r\n    model = _deserialize_model(f, custom_objects, compile)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/engine/saving.py\", line 225, in _deserialize_model\r\n    model = model_from_config(model_config, custom_objects=custom_objects)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/engine/saving.py\", line 458, in model_from_config\r\n    return deserialize(config, custom_objects=custom_objects)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/layers/__init__.py\", line 55, in deserialize\r\n    printable_module_name='layer')\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/utils/generic_utils.py\", line 145, in deserialize_keras_object\r\n    list(custom_objects.items())))\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/engine/network.py\", line 1022, in from_config\r\n    process_layer(layer_data)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/engine/network.py\", line 1008, in process_layer\r\n    custom_objects=custom_objects)\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/layers/__init__.py\", line 55, in deserialize\r\n    printable_module_name='layer')\r\n  File \"/Users/carlos/anaconda3/envs/ml/lib/python3.7/site-packages/keras/utils/generic_utils.py\", line 138, in deserialize_keras_object\r\n    ': ' + class_name)\r\nValueError: Unknown layer: MaxPoolingWithArgmax2D\r\n```\r\n\r\nIs my approach correct? I'm thinking of doing this inside a lamda layer next to try to get it to work.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/667", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/667/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/667/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/667/events", "html_url": "https://github.com/apple/coremltools/issues/667", "id": 579200311, "node_id": "MDU6SXNzdWU1NzkyMDAzMTE=", "number": 667, "title": "Does iPhone 8 is possible to run models on ANE?", "user": {"login": "mrgloom", "id": 4003908, "node_id": "MDQ6VXNlcjQwMDM5MDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/4003908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrgloom", "html_url": "https://github.com/mrgloom", "followers_url": "https://api.github.com/users/mrgloom/followers", "following_url": "https://api.github.com/users/mrgloom/following{/other_user}", "gists_url": "https://api.github.com/users/mrgloom/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrgloom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrgloom/subscriptions", "organizations_url": "https://api.github.com/users/mrgloom/orgs", "repos_url": "https://api.github.com/users/mrgloom/repos", "events_url": "https://api.github.com/users/mrgloom/events{/privacy}", "received_events_url": "https://api.github.com/users/mrgloom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-11T11:38:02Z", "updated_at": "2020-05-02T07:11:41Z", "closed_at": "2020-05-02T07:11:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "Does iPhone 8 (with iOS 13) is possible to run models on ANE? How to check if model is running on ANE?\r\n\r\nBased on this \r\nhttps://en.wikipedia.org/wiki/Apple_A11#Neural_Engine\r\n\r\n> However, third party apps cannot use the Neural Engine, leading to similar neural network performance to older iPhones.\r\n\r\n\r\nBased on this:\r\nhttps://medium.com/@andlogvinenko/apple-a12-bionic-processor-accelerating-ml-algorithms-9-times-myth-or-reality-bc313bd672de\r\n\r\n> The Neural Engine implementation in the A11 processor has yielded virtually no increase in speed.\u2028 According to my findings, CoreML is still trying to use GPU on the A11 processor.\r\n\r\nBased on this:\r\nhttps://heartbeat.fritz.ai/does-my-core-ml-model-run-on-apples-neural-engine-d0a91d25297b\r\n\r\n> Apple announced that, starting with iOS 12 and the new A12 Bionic processor, Core ML models could now take advantage of the Apple Neural Engine (ANE). The ANE is a special co-processor capable of accelerating machine learning models to run up to 9X faster using just a tenth of the energy. While we\u2019ve been able to verify these speedups in certain cases, we noticed they weren\u2019t universal. Some models didn\u2019t seem to be benefitting from the new hardware. Make sure the project is configured to build and run your app on a physical device with an A12 (or newer) processor. Simulators won\u2019t work, as the hardware isn\u2019t virtualized. That leaves you with the following choices: an iPhone XR, XS, XS Max, or new iPad Pro.\r\n\r\nBased on this(assuming iPhone X and iPhone 8 have the same A11 processor):\r\nhttps://heartbeat.fritz.ai/ios-12-core-ml-benchmarks-b7a79811aac1\r\n\r\n> This Core ML model runs over 10X faster on the A12 processor in the iPhone XS Max compared with the iPhone X. The model above performs object detection, and results vary from model to model. The smallest speed-up I saw was around 5x.\r\n\r\nBased on this:\r\nhttps://machinethink.net/blog/mobile-architectures/\r\n\r\n> Conversely, if you\u2019re primarily targeting iPhone X and earlier, it makes sense to pick a model that works well on the GPU, as these older devices do not have a Neural Engine (the X has an ANE but Core ML can\u2019t use it).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/665", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/665/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/665/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/665/events", "html_url": "https://github.com/apple/coremltools/issues/665", "id": 578700005, "node_id": "MDU6SXNzdWU1Nzg3MDAwMDU=", "number": 665, "title": "Type of pipeline output 'vggishFeature' does not match type produced in pipeline input", "user": {"login": "osianSmith", "id": 20597684, "node_id": "MDQ6VXNlcjIwNTk3Njg0", "avatar_url": "https://avatars2.githubusercontent.com/u/20597684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/osianSmith", "html_url": "https://github.com/osianSmith", "followers_url": "https://api.github.com/users/osianSmith/followers", "following_url": "https://api.github.com/users/osianSmith/following{/other_user}", "gists_url": "https://api.github.com/users/osianSmith/gists{/gist_id}", "starred_url": "https://api.github.com/users/osianSmith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/osianSmith/subscriptions", "organizations_url": "https://api.github.com/users/osianSmith/orgs", "repos_url": "https://api.github.com/users/osianSmith/repos", "events_url": "https://api.github.com/users/osianSmith/events{/privacy}", "received_events_url": "https://api.github.com/users/osianSmith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}, {"id": 718619861, "node_id": "MDU6TGFiZWw3MTg2MTk4NjE=", "url": "https://api.github.com/repos/apple/coremltools/labels/repro%20needed", "name": "repro needed", "color": "27bbce", "default": false, "description": "More information or ability to reproduce the issue is needed (status)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-03-10T16:16:33Z", "updated_at": "2020-05-14T12:20:51Z", "closed_at": "2020-05-14T12:20:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question \r\nHello, I am trying to split a SoundAnlaysis Model however when I place it into Xcode I receive an error stating that    'vggishFeature' does not match type produced in pipeline input \r\n\r\nThis is my last layer:\r\n``name: \"flatten\" input: \"pool4_output\" output: \"vggishFeature\" flatten { mode: CHANNEL_LAST }\r\n``\r\n\r\nHere is the code that sets the output:\r\n\r\n```output.type.multiArrayType.SetInParent()\r\noutput.type.multiArrayType.shape.append(0)\r\noutput.type.multiArrayType.shape.append(12288)\r\n\r\n#sets the data type for our mutiArray feature\r\noutput.type.multiArrayType.dataType = coremltools.proto.FeatureTypes_pb2.ArrayFeatureType.ArrayDataType.FLOAT32\r\n```\r\n\r\nCould it be that I have either need to remove one more layer or is the output of this is not a vggish feature or can't CoreML know how to cope with this or is it something completely different?\r\n\r\nThanks a lot :)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/664", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/664/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/664/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/664/events", "html_url": "https://github.com/apple/coremltools/issues/664", "id": 577797357, "node_id": "MDU6SXNzdWU1Nzc3OTczNTc=", "number": 664, "title": "Need coremltools package for PPC64", "user": {"login": "vegoutha", "id": 30261486, "node_id": "MDQ6VXNlcjMwMjYxNDg2", "avatar_url": "https://avatars3.githubusercontent.com/u/30261486?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vegoutha", "html_url": "https://github.com/vegoutha", "followers_url": "https://api.github.com/users/vegoutha/followers", "following_url": "https://api.github.com/users/vegoutha/following{/other_user}", "gists_url": "https://api.github.com/users/vegoutha/gists{/gist_id}", "starred_url": "https://api.github.com/users/vegoutha/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vegoutha/subscriptions", "organizations_url": "https://api.github.com/users/vegoutha/orgs", "repos_url": "https://api.github.com/users/vegoutha/repos", "events_url": "https://api.github.com/users/vegoutha/events{/privacy}", "received_events_url": "https://api.github.com/users/vegoutha/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-09T10:18:50Z", "updated_at": "2020-05-02T07:16:53Z", "closed_at": "2020-05-02T07:16:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nI am looking for coremltools package for ppcle. pip installation is failing with below error:\r\n\r\n```\r\n$ mkdir mlvirtualenv\r\n$ cd mlvirtualenv\r\nmlvirtualenv]$ virtualenv pythonenv\r\nmlvirtualenv] $ source pythonenv/bin/activate\r\nmlvirtualenv]$ pip install -U coremltools\r\nERROR: Could not find a version that satisfies the requirement coremltools (from versions: none)\r\nERROR: No matching distribution found for coremltools\r\n```\r\nCan you please confirm whether coremltools package is available for ppcle ? If not, how can we build the coremltools package for ppc64 ?\r\n\r\n## System Information\r\n```\r\n# uname -a\r\nLinux jctesti31-lb-1.fyre.ibm.com 3.10.0-1062.1.2.el7.ppc64le #1 SMP Mon Sep 16 18:35:00 UTC 2019 ppc64le ppc64le ppc64le GNU/Linux\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/663", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/663/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/663/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/663/events", "html_url": "https://github.com/apple/coremltools/issues/663", "id": 577464825, "node_id": "MDU6SXNzdWU1Nzc0NjQ4MjU=", "number": 663, "title": "\"fatal error: 'Python.h' file not found\" on \"make -C build -j3\"", "user": {"login": "tucan9389", "id": 37643248, "node_id": "MDQ6VXNlcjM3NjQzMjQ4", "avatar_url": "https://avatars1.githubusercontent.com/u/37643248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tucan9389", "html_url": "https://github.com/tucan9389", "followers_url": "https://api.github.com/users/tucan9389/followers", "following_url": "https://api.github.com/users/tucan9389/following{/other_user}", "gists_url": "https://api.github.com/users/tucan9389/gists{/gist_id}", "starred_url": "https://api.github.com/users/tucan9389/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tucan9389/subscriptions", "organizations_url": "https://api.github.com/users/tucan9389/orgs", "repos_url": "https://api.github.com/users/tucan9389/repos", "events_url": "https://api.github.com/users/tucan9389/events{/privacy}", "received_events_url": "https://api.github.com/users/tucan9389/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-03-08T08:27:28Z", "updated_at": "2020-05-02T07:18:13Z", "closed_at": "2020-05-02T07:18:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\nI set up the test env with [this guide](https://github.com/apple/coremltools/blob/master/BUILD.md#running-unit-tests). But there are some error(`fatal error: 'Python.h' file not found`) during `make -C build -j3`.\r\n\r\n```\r\n(coremltools-dev) \u279c  coremltools git:(doyoung/fix-alpha-check-error) make -C build -j3\r\n[  1%] Built target js_embed\r\n[  7%] Built target libprotobuf-lite\r\n[ 28%] Built target libprotobuf\r\n[ 54%] Built target libprotoc\r\n[ 55%] Built target protoc\r\n[ 84%] Built target mlmodel\r\n[ 84%] Building CXX object CMakeFiles/coremlpython.dir/coremlpython/CoreMLPython.mm.o\r\n[ 88%] Built target mlmodel_test\r\n[ 88%] Building CXX object CMakeFiles/coremlpython.dir/coremlpython/CoreMLPythonArray.mm.o\r\n[ 88%] Building CXX object CMakeFiles/caffeconverter.dir/caffeconverter/CaffeConverterPython.cpp.o\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/coremlpython/CoreMLPythonArray.mm:1:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/coremlpython/CoreMLPythonArray.h:11:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/numpy.h:12:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pybind11.h:36:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/attr.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/cast.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pytypes.h:12:\r\n/Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/common.h:72:10: fatal error: 'Python.h' file not found\r\n#include <Python.h>\r\n         ^~~~~~~~~~\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/caffeconverter/CaffeConverterPython.cpp:7:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pybind11.h:36:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/attr.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/cast.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pytypes.h:12:\r\n/Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/common.h:72:10: fatal error: 'Python.h' file not found\r\n#include <Python.h>\r\n         ^~~~~~~~~~\r\n1 error generated.\r\nmake[2]: *** [CMakeFiles/caffeconverter.dir/caffeconverter/CaffeConverterPython.cpp.o] Error 1\r\nmake[1]: *** [CMakeFiles/caffeconverter.dir/all] Error 2\r\nmake[1]: *** Waiting for unfinished jobs....\r\n[ 88%] Building CXX object CMakeFiles/coremlpython.dir/coremlpython/CoreMLPythonUtils.mm.o\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/coremlpython/CoreMLPythonUtils.mm:1:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/coremlpython/CoreMLPythonArray.h:11:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/numpy.h:12:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pybind11.h:36:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/attr.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/cast.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pytypes.h:12:\r\n/Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/common.h:72:10: fatal error: 'Python.h' file not found\r\n#include <Python.h>\r\n         ^~~~~~~~~~\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/coremlpython/CoreMLPython.mm:2:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/coremlpython/CoreMLPythonArray.h:11:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/numpy.h:12:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pybind11.h:36:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/attr.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/cast.h:13:\r\nIn file included from /Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/pytypes.h:12:\r\n/Users/doyounggwak/Project/ml-project/github/coremltools/deps/pybind11/include/pybind11/common.h:72:10: fatal error: 'Python.h' file not found\r\n#include <Python.h>\r\n         ^~~~~~~~~~\r\n1 error generated.\r\nmake[2]: *** [CMakeFiles/coremlpython.dir/coremlpython/CoreMLPythonArray.mm.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\n1 error generated.\r\nmake[2]: *** [CMakeFiles/coremlpython.dir/coremlpython/CoreMLPython.mm.o] Error 1\r\n1 error generated.\r\nmake[2]: *** [CMakeFiles/coremlpython.dir/coremlpython/CoreMLPythonUtils.mm.o] Error 1\r\nmake[1]: *** [CMakeFiles/coremlpython.dir/all] Error 2\r\nmake: *** [all] Error 2\r\n```\r\n\r\n## System Information\r\n\r\n- macOS: 10.15.3", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/657", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/657/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/657/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/657/events", "html_url": "https://github.com/apple/coremltools/issues/657", "id": 575085320, "node_id": "MDU6SXNzdWU1NzUwODUzMjA=", "number": 657, "title": "MobileNetv3 with NPU not accerlerated!", "user": {"login": "dragen1860", "id": 4252555, "node_id": "MDQ6VXNlcjQyNTI1NTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/4252555?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dragen1860", "html_url": "https://github.com/dragen1860", "followers_url": "https://api.github.com/users/dragen1860/followers", "following_url": "https://api.github.com/users/dragen1860/following{/other_user}", "gists_url": "https://api.github.com/users/dragen1860/gists{/gist_id}", "starred_url": "https://api.github.com/users/dragen1860/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dragen1860/subscriptions", "organizations_url": "https://api.github.com/users/dragen1860/orgs", "repos_url": "https://api.github.com/users/dragen1860/repos", "events_url": "https://api.github.com/users/dragen1860/events{/privacy}", "received_events_url": "https://api.github.com/users/dragen1860/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-03-04T02:09:08Z", "updated_at": "2020-04-23T13:35:29Z", "closed_at": "2020-04-23T13:35:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "Dear all,\r\n  Has anyone succed run mobileetv3 small/large on Iphone with NPU/GPU/CPU accelerated\uff1f in my case, i found the mobilenetv3 small run on CPU with 10ms inference time, compared with 20ms for mobilenetv2 cpu.\r\n  However, mobilenetv3 run on NPU need 11ms , compared with 3ms for mobilenetv2. I do not know why? any tips? Thank you.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/648", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/648/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/648/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/648/events", "html_url": "https://github.com/apple/coremltools/issues/648", "id": 570341003, "node_id": "MDU6SXNzdWU1NzAzNDEwMDM=", "number": 648, "title": "pytorch -> onnx -> coreml", "user": {"login": "feifeiwei", "id": 40533960, "node_id": "MDQ6VXNlcjQwNTMzOTYw", "avatar_url": "https://avatars3.githubusercontent.com/u/40533960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/feifeiwei", "html_url": "https://github.com/feifeiwei", "followers_url": "https://api.github.com/users/feifeiwei/followers", "following_url": "https://api.github.com/users/feifeiwei/following{/other_user}", "gists_url": "https://api.github.com/users/feifeiwei/gists{/gist_id}", "starred_url": "https://api.github.com/users/feifeiwei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/feifeiwei/subscriptions", "organizations_url": "https://api.github.com/users/feifeiwei/orgs", "repos_url": "https://api.github.com/users/feifeiwei/repos", "events_url": "https://api.github.com/users/feifeiwei/events{/privacy}", "received_events_url": "https://api.github.com/users/feifeiwei/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-02-25T06:23:50Z", "updated_at": "2020-02-26T01:27:43Z", "closed_at": "2020-02-26T01:27:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nhow can I convert image to multiarray as input\r\n## System Information\r\n- If applicable\r\n## python pth2onnx.py\r\n```\r\nimport torch\r\nimport torch.onnx\r\nfrom model import LaneNet\r\n \r\ndevice = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\")\r\n\r\n    \r\nif __name__ == \"__main__\":\r\n #test()\r\n  model = LaneNet(embed_dim=4, delta_v=.5, delta_d=3.)\r\n  \r\n  pthfile = r'./net_test.pth'#r'./ckpt/exp3_change_upsample_best.pth'\r\n  loaded_model = torch.load(pthfile, map_location='cpu')\r\n  print(\"loading weights successfully...\")\r\n  model.load_state_dict(loaded_model)#(loaded_model['net'])\r\n  \r\n  dummy_input1 = torch.randn(1,3,288,800)\r\n  \r\n  input_names = [ \"actual_input\"]\r\n  output_names = [ \"output1\",\"output2\" ]\r\n  \r\n  torch.onnx.export(model, dummy_input1, \"lane_weights.onnx\", verbose=True, input_names=input_names, output_names=output_names)\r\n  print(\"pth model convert to onnx successfully\")\r\n```\r\n\r\n## python onnx2coreml.py\r\n```\r\nfrom onnx import onnx_pb\r\nfrom onnx_coreml import convert\r\n \r\nmodel_in = 'lane_weights.onnx'\r\nmodel_out = 'lane_weights.mlmodel'\r\n \r\nmodel_file = open(model_in, 'rb')\r\nmodel_proto = onnx_pb.ModelProto()\r\nmodel_proto.ParseFromString(model_file.read())\r\ncoreml_model = convert(model_proto, image_input_names=['inputImage'], image_output_names=['output'],\r\n                       minimum_ios_deployment_target=\"13\")\r\n\r\ncoreml_model.save(model_out)\r\n```\r\n\r\n<img width=\"428\" alt=\"\u622a\u5c4f2020-02-25\u4e0b\u534812 04 54\" src=\"https://user-images.githubusercontent.com/40533960/75220456-6cea4180-57da-11ea-98c3-ed2972ddfdb0.png\">\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/647", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/647/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/647/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/647/events", "html_url": "https://github.com/apple/coremltools/issues/647", "id": 570294376, "node_id": "MDU6SXNzdWU1NzAyOTQzNzY=", "number": 647, "title": "Convert image  to multiArray as the input type", "user": {"login": "feifeiwei", "id": 40533960, "node_id": "MDQ6VXNlcjQwNTMzOTYw", "avatar_url": "https://avatars3.githubusercontent.com/u/40533960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/feifeiwei", "html_url": "https://github.com/feifeiwei", "followers_url": "https://api.github.com/users/feifeiwei/followers", "following_url": "https://api.github.com/users/feifeiwei/following{/other_user}", "gists_url": "https://api.github.com/users/feifeiwei/gists{/gist_id}", "starred_url": "https://api.github.com/users/feifeiwei/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/feifeiwei/subscriptions", "organizations_url": "https://api.github.com/users/feifeiwei/orgs", "repos_url": "https://api.github.com/users/feifeiwei/repos", "events_url": "https://api.github.com/users/feifeiwei/events{/privacy}", "received_events_url": "https://api.github.com/users/feifeiwei/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-02-25T03:55:04Z", "updated_at": "2020-02-26T01:28:49Z", "closed_at": "2020-02-26T01:28:49Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nhow can i  convert image to multiArray as the input type??\r\n## System Information\r\n- If applicable\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/644", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/644/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/644/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/644/events", "html_url": "https://github.com/apple/coremltools/issues/644", "id": 568839875, "node_id": "MDU6SXNzdWU1Njg4Mzk4NzU=", "number": 644, "title": "Mode of add_resize_bilinear", "user": {"login": "Queequeg92", "id": 8766653, "node_id": "MDQ6VXNlcjg3NjY2NTM=", "avatar_url": "https://avatars3.githubusercontent.com/u/8766653?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Queequeg92", "html_url": "https://github.com/Queequeg92", "followers_url": "https://api.github.com/users/Queequeg92/followers", "following_url": "https://api.github.com/users/Queequeg92/following{/other_user}", "gists_url": "https://api.github.com/users/Queequeg92/gists{/gist_id}", "starred_url": "https://api.github.com/users/Queequeg92/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Queequeg92/subscriptions", "organizations_url": "https://api.github.com/users/Queequeg92/orgs", "repos_url": "https://api.github.com/users/Queequeg92/repos", "events_url": "https://api.github.com/users/Queequeg92/events{/privacy}", "received_events_url": "https://api.github.com/users/Queequeg92/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-21T09:33:06Z", "updated_at": "2020-02-22T14:00:06Z", "closed_at": "2020-02-21T17:45:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nWhat's the difference between the 4 modes of add_resize_bilinear?\r\n\r\nWhen I set the input to:\r\n[[1., 9., 3.],\r\n [3., 0., 2.],\r\n [2., 7., 5.]]\r\n\r\nand output shape to (5, 5)\r\n\r\nthe output of ALIGN_ENDPOINTS_MODE and STRICT_ALIGN_ENDPOINTS_MODE is the same:\r\n[[1, 5, 9, 6, 3] \r\n [2, 3.25, 4.5, 3.5, 2.5], \r\n [3, 1.5, 0, 1, 2], \r\n [2.5, 3, 3.5, 3.5, 3.5], \r\n [2, 4.5, 7, 6, 5]]\r\n\r\nWhat's the difference between these two modes?\r\n\r\n\r\n## System Information\r\n- If applicable\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/636", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/636/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/636/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/636/events", "html_url": "https://github.com/apple/coremltools/issues/636", "id": 565784551, "node_id": "MDU6SXNzdWU1NjU3ODQ1NTE=", "number": 636, "title": "Request for clarification about the WeightParams in the NeuralNetwork protobuf file.", "user": {"login": "JacopoMangiavacchi", "id": 8699190, "node_id": "MDQ6VXNlcjg2OTkxOTA=", "avatar_url": "https://avatars1.githubusercontent.com/u/8699190?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JacopoMangiavacchi", "html_url": "https://github.com/JacopoMangiavacchi", "followers_url": "https://api.github.com/users/JacopoMangiavacchi/followers", "following_url": "https://api.github.com/users/JacopoMangiavacchi/following{/other_user}", "gists_url": "https://api.github.com/users/JacopoMangiavacchi/gists{/gist_id}", "starred_url": "https://api.github.com/users/JacopoMangiavacchi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JacopoMangiavacchi/subscriptions", "organizations_url": "https://api.github.com/users/JacopoMangiavacchi/orgs", "repos_url": "https://api.github.com/users/JacopoMangiavacchi/repos", "events_url": "https://api.github.com/users/JacopoMangiavacchi/events{/privacy}", "received_events_url": "https://api.github.com/users/JacopoMangiavacchi/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-02-15T17:44:50Z", "updated_at": "2020-02-17T20:39:17Z", "closed_at": "2020-02-17T20:39:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Request for clarification about the WeightParams in the NeuralNetwork protobuf file.\r\n\r\nI\u2019m exporting a CoreML model directly using the protobuf files defined in this repo where I\u2019m passing to the layers (InnerProduct) the weights and bias I trained with a Swift for TensorFlow model.\r\n\r\nI\u2019m flattering in particular the weights to a simple vector but when I inference the model with the CoreML runtime I\u2019m receiving very unexpected predictions.\r\n\r\nOn the WeightParams message documentation (comments from the NeuralNetwork.proto file) I can see that \u201cWeights are stored as repeated floating point numbers using row-major ordering and can represent 1-, 2-, 3-, or 4-dimensional data.\u201d but I\u2019m not sure I\u2019m correctly interpreting that.\r\n\r\nCan you please confirm me that flattering a Dense weights matrix is correct ?\r\n\r\n## System Information\r\n\r\nI\u2019m developing a tool in Swift (https://github.com/JacopoMangiavacchi/SwiftCoreMLTools) to generate CoreML model files directly using the protobuf messages defined in this repo.\r\n\r\nTo validate the tool I\u2019ve a quite simple test case for a Neural Network (regression) model with 3 InnerProduct layers and 2 ReLu Activations, a single input tensor of shape [13] and a single output of shape [1].  (https://github.com/JacopoMangiavacchi/TestSwiftCoreMLTools)\r\n\r\nUsing S4TF I flatten the dense weights tensor this way:\r\nweights: model.layer1.weight.flattened().scalars\r\n\r\nI\u2019ve tested of course directly the weights and bias in Swift for TensorFlow.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/627", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/627/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/627/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/627/events", "html_url": "https://github.com/apple/coremltools/issues/627", "id": 561447436, "node_id": "MDU6SXNzdWU1NjE0NDc0MzY=", "number": 627, "title": "How do I specify missing/undefined features in Python?", "user": {"login": "kvaDrug", "id": 10631455, "node_id": "MDQ6VXNlcjEwNjMxNDU1", "avatar_url": "https://avatars3.githubusercontent.com/u/10631455?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kvaDrug", "html_url": "https://github.com/kvaDrug", "followers_url": "https://api.github.com/users/kvaDrug/followers", "following_url": "https://api.github.com/users/kvaDrug/following{/other_user}", "gists_url": "https://api.github.com/users/kvaDrug/gists{/gist_id}", "starred_url": "https://api.github.com/users/kvaDrug/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kvaDrug/subscriptions", "organizations_url": "https://api.github.com/users/kvaDrug/orgs", "repos_url": "https://api.github.com/users/kvaDrug/repos", "events_url": "https://api.github.com/users/kvaDrug/events{/privacy}", "received_events_url": "https://api.github.com/users/kvaDrug/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-07T06:29:36Z", "updated_at": "2020-02-07T06:58:54Z", "closed_at": "2020-02-07T06:58:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "In Objective-C framework `MLFeatureValue` has a factory method for undefined features. How do I create undefined/missing features in Python?\r\n\r\nI tried omitting them, in this case I receive an error: \"Feature 'featurename' not provided.\"\r\nAlso tried `None` \u2013 the `predict()` call hangs.\r\n\r\nMy model is converted from XGBoost. That models support missing features.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/623", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/623/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/623/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/623/events", "html_url": "https://github.com/apple/coremltools/issues/623", "id": 560575926, "node_id": "MDU6SXNzdWU1NjA1NzU5MjY=", "number": 623, "title": "ValueError: list.remove(x): x not in list", "user": {"login": "danvargg", "id": 13923005, "node_id": "MDQ6VXNlcjEzOTIzMDA1", "avatar_url": "https://avatars1.githubusercontent.com/u/13923005?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danvargg", "html_url": "https://github.com/danvargg", "followers_url": "https://api.github.com/users/danvargg/followers", "following_url": "https://api.github.com/users/danvargg/following{/other_user}", "gists_url": "https://api.github.com/users/danvargg/gists{/gist_id}", "starred_url": "https://api.github.com/users/danvargg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danvargg/subscriptions", "organizations_url": "https://api.github.com/users/danvargg/orgs", "repos_url": "https://api.github.com/users/danvargg/repos", "events_url": "https://api.github.com/users/danvargg/events{/privacy}", "received_events_url": "https://api.github.com/users/danvargg/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": {"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 6, "created_at": "2020-02-05T19:19:00Z", "updated_at": "2020-04-07T15:41:46Z", "closed_at": "2020-03-10T03:30:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nI'm training a multi-input CNN (`tf.keras`) with `TF2.0.0`. I keep getting `ValueError: list.remove(x): x not in list`, but I don't understand what's the list, what's x, do I need to rename nodes?\r\n\r\nI can see that the converter starts, but the error comes after some conversion. I tried `tfcoreml` and converting from saved weights with no success. \r\nIs there something I'm missing?\r\n\r\nThis is the process I follow for conversion:\r\n\r\n```python\r\n\r\ntf.keras.backend.clear_session()\r\ntf.keras.backend.set_learning_phase(0)\r\n\r\n# model is a .h5 file produced from a model.fit callback (modelcheckpoint)\r\n# I have a custom dense layer that has __init__, build, call and config implemented\r\nmodel = tf.keras.models.load_model(model, custom_objects = {'DenseLayer': DenseLayer})\r\n\r\ntf.saved_model.save(model, export_dir = pb_model) # save the model as pb for conversion\r\n\r\n# my target ios is 12\r\ncoremltools_model = coremltools.converters.tensorflow.convert(\r\n        _PB_MODEL,\r\n        input_name_shape_dict={\r\n            'B': [1, 20, 40, 1],\r\n            'G': [1, 20, 40, 1],\r\n            'R': [1, 20, 40, 1],\r\n            'X': [1, 2],\r\n            'Y': [1, 4]},\r\n        output_feature_names=['dense_layer_18/Identity'],\r\n        minimum_ios_deployment_target='12'\r\n    )\r\n\r\ncoremltools_model.save(ml_model)\r\n```\r\n\r\n## Trace\r\n```python\r\nConverting pb model to .mlmodel......\r\n0 assert nodes deleted\r\n872 nodes deleted\r\n36 nodes deleted\r\n0 nodes deleted\r\n[Op Fusion] fuse_bias_add() deleted 24 nodes.\r\n77 identity nodes deleted\r\nTraceback (most recent call last):\r\n  File \"tf2coreml.py\", line 198, in <module>\r\nconvertModel(model=_TRAIN_MODEL, ml_model=_ML_MODEL, pb_model=_PB_MODEL)\r\n  File \"tf2coreml.py\", line 174, in convertModel\r\nminimum_ios_deployment_target='12'\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/tensorflow/_tf_converter.py\", line 193, in convert\r\noptional_inputs=optional_inputs)\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/nnssa/coreml/ssa_converter.py\", line 130, in ssa_convert\r\np(ssa)\r\n  File \"/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/coremltools/converters/nnssa/coreml/graph_pass/op_removals.py\", line 20, in\r\nremove_no_ops_and_shift_control_dependencies\r\n    f.graph[each_control_input].control_outputs.remove(node.name)\r\nValueError: list.remove(x): x not in list\r\n```\r\n## System environment (please complete the following information):\r\n - coremltools version: 3.2\r\n - OS: Ubuntu 16.04 LTS (AWS EC2)\r\n - Python version: 3.6.5\r\n - any other relevant information:\r\n     - Tensorflow: 2.0.0", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/591", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/591/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/591/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/591/events", "html_url": "https://github.com/apple/coremltools/issues/591", "id": 554240693, "node_id": "MDU6SXNzdWU1NTQyNDA2OTM=", "number": 591, "title": "Double transpose ops when using image inputs on a TF 2 model", "user": {"login": "ghop02", "id": 1422280, "node_id": "MDQ6VXNlcjE0MjIyODA=", "avatar_url": "https://avatars2.githubusercontent.com/u/1422280?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghop02", "html_url": "https://github.com/ghop02", "followers_url": "https://api.github.com/users/ghop02/followers", "following_url": "https://api.github.com/users/ghop02/following{/other_user}", "gists_url": "https://api.github.com/users/ghop02/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghop02/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghop02/subscriptions", "organizations_url": "https://api.github.com/users/ghop02/orgs", "repos_url": "https://api.github.com/users/ghop02/repos", "events_url": "https://api.github.com/users/ghop02/events{/privacy}", "received_events_url": "https://api.github.com/users/ghop02/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 637373894, "node_id": "MDU6TGFiZWw2MzczNzM4OTQ=", "url": "https://api.github.com/repos/apple/coremltools/labels/enhancement", "name": "enhancement", "color": "c10f47", "default": true, "description": "Improvement to existing functionality (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-01-23T15:46:20Z", "updated_at": "2020-02-03T23:23:48Z", "closed_at": "2020-02-03T23:23:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n - There are duplicate transpose ops that should be removed.\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 3.20\r\n - OS (e.g., MacOS, Linux): MacOS\r\n - any other relevant information:\r\n     - e.g. using TF 2\r\n\r\n## Additional context\r\n\r\n```\r\nimport tensorflow as tf\r\nimport coremltools\r\nimport tempfile\r\ninpt = tf.keras.layers.Input(shape=(357, 257, 3), batch_size=1)\r\nout = tf.keras.layers.Conv2D(\r\n    filters=4,\r\n    kernel_size=3,\r\n)(inpt)\r\nmodel = tf.keras.Model(inpt, out)\r\ninput_name = model.inputs[0].name.split(\":\")[0]\r\ninput_shape = (1, 357, 257, 3)\r\n\r\nprint(input_name)\r\ntemp = tempfile.NamedTemporaryFile(suffix=\".h5\")\r\nmodel.save(temp.name, include_optimizer=False, save_format=\"h5\")\r\nmlmodel = coremltools.converters.tensorflow.convert(\r\n    temp.name,\r\n    inputs={input_name: input_shape},\r\n    image_scale=1.0 / 255.0,\r\n    red_bias=-0.5,\r\n    green_bias=-0.5,\r\n    blue_bias=-0.5,\r\n    image_input_names=input_name\r\n)\r\nmlmodel.save('test.mlmodel')\r\n```\r\n![image](https://user-images.githubusercontent.com/1422280/72943701-c1665100-3d44-11ea-949c-90c1c850a489.png)\r\n\r\nI believe this happens because the transpose op is added in the coremltools builder and there isn't an optimization pass to remove it\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/589", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/589/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/589/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/589/events", "html_url": "https://github.com/apple/coremltools/issues/589", "id": 552889302, "node_id": "MDU6SXNzdWU1NTI4ODkzMDI=", "number": 589, "title": "Access Layers of a model within a pipeline", "user": {"login": "osianSmith", "id": 20597684, "node_id": "MDQ6VXNlcjIwNTk3Njg0", "avatar_url": "https://avatars2.githubusercontent.com/u/20597684?v=4", "gravatar_id": "", "url": "https://api.github.com/users/osianSmith", "html_url": "https://github.com/osianSmith", "followers_url": "https://api.github.com/users/osianSmith/followers", "following_url": "https://api.github.com/users/osianSmith/following{/other_user}", "gists_url": "https://api.github.com/users/osianSmith/gists{/gist_id}", "starred_url": "https://api.github.com/users/osianSmith/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/osianSmith/subscriptions", "organizations_url": "https://api.github.com/users/osianSmith/orgs", "repos_url": "https://api.github.com/users/osianSmith/repos", "events_url": "https://api.github.com/users/osianSmith/events{/privacy}", "received_events_url": "https://api.github.com/users/osianSmith/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-21T13:50:09Z", "updated_at": "2020-01-21T14:39:20Z", "closed_at": "2020-01-21T14:39:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nHey, I have a SoudAnaysisis model (created by CreateML) and I want to access GLM classifier and replace it with my own model. However, when using CoreMlTools there does not seem to be a method for me to access the layers. When I try to loop over layers I get 0 layers. Is there any way for me to access these layers?\r\nHere is my code:\r\n\r\n```\r\nimport sys, coremltools\r\n\r\nmodel = coremltools.models.MLModel(\"model.mlmodel\")\r\nspec = model.get_spec() # gets a deep copy\r\n\r\nspec = coremltools.utils.load_spec(\"model.mlmodel\")\r\nprint(spec.description)\r\nprint(spec.WhichOneof(\"Type\"))\r\n\r\nfor layer in spec.neuralNetworkClassifier.layers: \r\n    print(layer.name)\r\n\r\n```\r\n## System Information\r\n- macOS catalina (10.15.2)\r\n- CoreML 3\r\n- CreateMl 1.0\r\n\r\n\r\nAny help will be appreciated\r\n\r\nOsian ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/581", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/581/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/581/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/581/events", "html_url": "https://github.com/apple/coremltools/issues/581", "id": 549837588, "node_id": "MDU6SXNzdWU1NDk4Mzc1ODg=", "number": 581, "title": "DataTypeBase init error caused by a bug in PR 563", "user": {"login": "jiafatom", "id": 30608893, "node_id": "MDQ6VXNlcjMwNjA4ODkz", "avatar_url": "https://avatars1.githubusercontent.com/u/30608893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jiafatom", "html_url": "https://github.com/jiafatom", "followers_url": "https://api.github.com/users/jiafatom/followers", "following_url": "https://api.github.com/users/jiafatom/following{/other_user}", "gists_url": "https://api.github.com/users/jiafatom/gists{/gist_id}", "starred_url": "https://api.github.com/users/jiafatom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jiafatom/subscriptions", "organizations_url": "https://api.github.com/users/jiafatom/orgs", "repos_url": "https://api.github.com/users/jiafatom/repos", "events_url": "https://api.github.com/users/jiafatom/events{/privacy}", "received_events_url": "https://api.github.com/users/jiafatom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-14T21:47:19Z", "updated_at": "2020-01-14T22:44:40Z", "closed_at": "2020-01-14T22:44:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "I made a comment to PR [563](https://github.com/apple/coremltools/pull/563), it will cause DataTypeBase init error, which breaks our onnxmltools [pipeline](https://dev.azure.com/onnxmltools/onnxmltools/_build/results?buildId=8949&view=logs&j=03329c05-1f9f-5d37-62ae-822c2e7179c1&t=be5df694-97a2-5719-346c-7b12aef699b8)\r\nThe detail is:\r\n` None` should not be in `format`: should change to `_DatatypeBase.__init__(self, \"Dictionary\", \"Dictionary({})\".format(repr(self.key_type)), None)`", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/579", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/579/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/579/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/579/events", "html_url": "https://github.com/apple/coremltools/issues/579", "id": 549779757, "node_id": "MDU6SXNzdWU1NDk3Nzk3NTc=", "number": 579, "title": "Removing `/tmp/` data after test ", "user": {"login": "bhushan23", "id": 1794273, "node_id": "MDQ6VXNlcjE3OTQyNzM=", "avatar_url": "https://avatars2.githubusercontent.com/u/1794273?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bhushan23", "html_url": "https://github.com/bhushan23", "followers_url": "https://api.github.com/users/bhushan23/followers", "following_url": "https://api.github.com/users/bhushan23/following{/other_user}", "gists_url": "https://api.github.com/users/bhushan23/gists{/gist_id}", "starred_url": "https://api.github.com/users/bhushan23/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bhushan23/subscriptions", "organizations_url": "https://api.github.com/users/bhushan23/orgs", "repos_url": "https://api.github.com/users/bhushan23/repos", "events_url": "https://api.github.com/users/bhushan23/events{/privacy}", "received_events_url": "https://api.github.com/users/bhushan23/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": {"login": "1duo", "id": 6426433, "node_id": "MDQ6VXNlcjY0MjY0MzM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6426433?v=4", "gravatar_id": "", "url": "https://api.github.com/users/1duo", "html_url": "https://github.com/1duo", "followers_url": "https://api.github.com/users/1duo/followers", "following_url": "https://api.github.com/users/1duo/following{/other_user}", "gists_url": "https://api.github.com/users/1duo/gists{/gist_id}", "starred_url": "https://api.github.com/users/1duo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/1duo/subscriptions", "organizations_url": "https://api.github.com/users/1duo/orgs", "repos_url": "https://api.github.com/users/1duo/repos", "events_url": "https://api.github.com/users/1duo/events{/privacy}", "received_events_url": "https://api.github.com/users/1duo/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "1duo", "id": 6426433, "node_id": "MDQ6VXNlcjY0MjY0MzM=", "avatar_url": "https://avatars2.githubusercontent.com/u/6426433?v=4", "gravatar_id": "", "url": "https://api.github.com/users/1duo", "html_url": "https://github.com/1duo", "followers_url": "https://api.github.com/users/1duo/followers", "following_url": "https://api.github.com/users/1duo/following{/other_user}", "gists_url": "https://api.github.com/users/1duo/gists{/gist_id}", "starred_url": "https://api.github.com/users/1duo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/1duo/subscriptions", "organizations_url": "https://api.github.com/users/1duo/orgs", "repos_url": "https://api.github.com/users/1duo/repos", "events_url": "https://api.github.com/users/1duo/events{/privacy}", "received_events_url": "https://api.github.com/users/1duo/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 0, "created_at": "2020-01-14T19:47:11Z", "updated_at": "2020-01-14T21:51:42Z", "closed_at": "2020-01-14T21:51:42Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "https://github.com/apple/coremltools/pull/509 added few test cases related to image class labels\r\nin `test_neural_networks` namely `test_cassifier_with_int_label_list`, ...\r\n\r\nTest creates temp files but does not removes them.\r\nWe should be using standard python library to create temporary directory and clean it up after the test.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/578", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/578/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/578/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/578/events", "html_url": "https://github.com/apple/coremltools/issues/578", "id": 549286686, "node_id": "MDU6SXNzdWU1NDkyODY2ODY=", "number": 578, "title": "CoreML LSTM input doesn't match Keras input shape", "user": {"login": "vijaysharm", "id": 1824094, "node_id": "MDQ6VXNlcjE4MjQwOTQ=", "avatar_url": "https://avatars3.githubusercontent.com/u/1824094?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vijaysharm", "html_url": "https://github.com/vijaysharm", "followers_url": "https://api.github.com/users/vijaysharm/followers", "following_url": "https://api.github.com/users/vijaysharm/following{/other_user}", "gists_url": "https://api.github.com/users/vijaysharm/gists{/gist_id}", "starred_url": "https://api.github.com/users/vijaysharm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vijaysharm/subscriptions", "organizations_url": "https://api.github.com/users/vijaysharm/orgs", "repos_url": "https://api.github.com/users/vijaysharm/repos", "events_url": "https://api.github.com/users/vijaysharm/events{/privacy}", "received_events_url": "https://api.github.com/users/vijaysharm/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 762593401, "node_id": "MDU6TGFiZWw3NjI1OTM0MDE=", "url": "https://api.github.com/repos/apple/coremltools/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Issue for a contributor to self-assign and complete"}, {"id": 1476891360, "node_id": "MDU6TGFiZWwxNDc2ODkxMzYw", "url": "https://api.github.com/repos/apple/coremltools/labels/multi-backend%20keras", "name": "multi-backend keras", "color": "ff8000", "default": false, "description": "Issue could be related to keras framework (component)"}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": {"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 1, "created_at": "2020-01-14T02:03:28Z", "updated_at": "2020-02-04T19:30:19Z", "closed_at": "2020-02-04T19:30:18Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nI'm trying to convert a very simple keras model to CoreML, however, the inputs of the CoreML model don't seem to match my expectations. \r\n\r\nThe model I'm creating has an input shape of (5, 10) (five timesteps, 10 features), however, after converting the model, and opening the model in Xcode, it says the input type is `MultiArray (Double 10)`, which, from my understanding is a single dimensional array. My question is, what am i doing wrong? Is there a way to tell CoreML that the input is specifically 5x10?\r\n\r\nHere's the keras model I'm creating\r\n\r\n```\r\nfrom keras.models import Sequential\r\nfrom keras.layers import LSTM\r\nfrom keras.layers import Dense\r\n\r\nlength = 5\r\nn_features = 10\r\nout_index = 2\r\n\r\nmodel = Sequential()\r\nmodel.add(LSTM(25, input_shape=(length, n_features)))\r\nmodel.add(Dense(n_features, activation='softmax'))\r\nmodel.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])\r\nmodel.summary()\r\n```\r\n\r\nI run the following code to convert the model, and print the output\r\n\r\n```\r\nimport coremltools\r\ncoreml_model = coremltools.converters.keras.convert(model)\r\nprint(coreml_model._spec.description.input[0])\r\n```\r\n\r\nAnd i get the following output:\r\n\r\n```\r\n0 : lstm_1_input, <keras.engine.input_layer.InputLayer object at 0x63d1d0dd0>\r\n1 : lstm_1, <keras.layers.recurrent.LSTM object at 0x106e74810>\r\n2 : dense_1, <keras.layers.core.Dense object at 0x63d1bae50>\r\n3 : dense_1__activation__, <keras.layers.core.Activation object at 0x63d595b50>\r\nname: \"input1\"\r\ntype {\r\n  multiArrayType {\r\n    shape: 10\r\n    dataType: DOUBLE\r\n  }\r\n}\r\n```\r\n\r\nI grepped the code, and I can indeed see that from [this line](https://github.com/apple/coremltools/blob/master/coremltools/converters/keras/_layers2.py#L1117) that you're intentionally only taking the last shape value. If this is the case, can you help me understand what would be the right way to create my Keras model? \r\n\r\n## System Information\r\n- If applicable\r\n```\r\nkeras 2.2.5\r\ntensorflow 1.15.0\r\ncoremltools 3.1\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/576", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/576/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/576/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/576/events", "html_url": "https://github.com/apple/coremltools/issues/576", "id": 548459918, "node_id": "MDU6SXNzdWU1NDg0NTk5MTg=", "number": 576, "title": "Bug in  fuse_conv_mul_add_into_batchnorm optimisation?", "user": {"login": "yurijvolkov", "id": 16668275, "node_id": "MDQ6VXNlcjE2NjY4Mjc1", "avatar_url": "https://avatars1.githubusercontent.com/u/16668275?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yurijvolkov", "html_url": "https://github.com/yurijvolkov", "followers_url": "https://api.github.com/users/yurijvolkov/followers", "following_url": "https://api.github.com/users/yurijvolkov/following{/other_user}", "gists_url": "https://api.github.com/users/yurijvolkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/yurijvolkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yurijvolkov/subscriptions", "organizations_url": "https://api.github.com/users/yurijvolkov/orgs", "repos_url": "https://api.github.com/users/yurijvolkov/repos", "events_url": "https://api.github.com/users/yurijvolkov/events{/privacy}", "received_events_url": "https://api.github.com/users/yurijvolkov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-01-11T17:54:14Z", "updated_at": "2020-01-11T18:51:30Z", "closed_at": "2020-01-11T18:51:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n\r\nNote: seems like some functions were renamed in master after 3.1 release that I use. But I still provide links to master code just for clearness of explanation of problem.  \r\n\r\nHere https://github.com/apple/coremltools/blob/9e3a20d7f5fd24a765a5901ef04467f467fc406b/coremltools/converters/nnssa/coreml/graph_pass/op_fusions.py#L723\r\n \r\nI have some node `generator/concat_1` with next property:\r\n\\>\\>\\> graph['generator/concat_1'].inputs\r\n`['generator/add_26', 'generator/gen_4/batch_norm/FusedBatchNorm/Add', 'generator/concat_1/axis']`\r\n\r\nBut at the end of this function I see that order of inputs to this node changed to:\r\n`['generator/add_26', 'generator/concat_1/axis', 'generator/gen_4/batch_norm/FusedBatchNorm/Add_batch_norm']`\r\n\r\nIt happened because this node was the output of some other node that was optimised with batch norm optimisation. Here https://github.com/apple/coremltools/blob/9e3a20d7f5fd24a765a5901ef04467f467fc406b/coremltools/converters/nnssa/commons/basic_graph_ops.py#L7\r\n new connections are APPENDED to the end input/output lists of the instead of placing them in the old place where they were before optimisation.\r\n\r\nIt seems that the order of inputs/outputs really matters because here in ssa converter \r\nhttps://github.com/apple/coremltools/blob/9e3a20d7f5fd24a765a5901ef04467f467fc406b/coremltools/converters/nnssa/coreml/ssa_converter.py#L1260\r\n last item in input nodes is removed.So in my case it incorrectly removes `generator/gen_4/batch_norm/FusedBatchNorm/Add_batch_norm` from the list instead of `generator/concat_1/axis`. I get some shitty error later. \r\n\r\nI am not 100% sure that this is really bug, but really seems like.\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 3.1\r\n - OS (e.g., MacOS, Linux): ubuntu Ubuntu 18.04.3 LTS\r\n - How you install python (anaconda, virtualenv, system): anaconda\r\n - python version (e.g. 3.7): 3.6\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/575", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/575/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/575/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/575/events", "html_url": "https://github.com/apple/coremltools/issues/575", "id": 548370772, "node_id": "MDU6SXNzdWU1NDgzNzA3NzI=", "number": 575, "title": "The error 'module object doesn't have convert when convert to CoreML", "user": {"login": "MarcSteven", "id": 13824297, "node_id": "MDQ6VXNlcjEzODI0Mjk3", "avatar_url": "https://avatars3.githubusercontent.com/u/13824297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarcSteven", "html_url": "https://github.com/MarcSteven", "followers_url": "https://api.github.com/users/MarcSteven/followers", "following_url": "https://api.github.com/users/MarcSteven/following{/other_user}", "gists_url": "https://api.github.com/users/MarcSteven/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarcSteven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarcSteven/subscriptions", "organizations_url": "https://api.github.com/users/MarcSteven/orgs", "repos_url": "https://api.github.com/users/MarcSteven/repos", "events_url": "https://api.github.com/users/MarcSteven/events{/privacy}", "received_events_url": "https://api.github.com/users/MarcSteven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1476891360, "node_id": "MDU6TGFiZWwxNDc2ODkxMzYw", "url": "https://api.github.com/repos/apple/coremltools/labels/multi-backend%20keras", "name": "multi-backend keras", "color": "ff8000", "default": false, "description": "Issue could be related to keras framework (component)"}, {"id": 718619861, "node_id": "MDU6TGFiZWw3MTg2MTk4NjE=", "url": "https://api.github.com/repos/apple/coremltools/labels/repro%20needed", "name": "repro needed", "color": "27bbce", "default": false, "description": "More information or ability to reproduce the issue is needed (status)"}], "state": "closed", "locked": false, "assignee": {"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jakesabathia2", "id": 55294647, "node_id": "MDQ6VXNlcjU1Mjk0NjQ3", "avatar_url": "https://avatars2.githubusercontent.com/u/55294647?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakesabathia2", "html_url": "https://github.com/jakesabathia2", "followers_url": "https://api.github.com/users/jakesabathia2/followers", "following_url": "https://api.github.com/users/jakesabathia2/following{/other_user}", "gists_url": "https://api.github.com/users/jakesabathia2/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakesabathia2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakesabathia2/subscriptions", "organizations_url": "https://api.github.com/users/jakesabathia2/orgs", "repos_url": "https://api.github.com/users/jakesabathia2/repos", "events_url": "https://api.github.com/users/jakesabathia2/events{/privacy}", "received_events_url": "https://api.github.com/users/jakesabathia2/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 13, "created_at": "2020-01-11T02:53:04Z", "updated_at": "2020-01-31T23:23:46Z", "closed_at": "2020-01-31T23:23:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n- I had a model from keras, I want to convert it to the CoreML. But it displayed the error 'Module' object doesn't have convert \r\n\r\n- Is this a converter issue? If yes, please specify which converter ( keras.)\r\n\r\n## Trace\r\nIf applicable, please paste the error trace.\r\n\r\n## To Reproduce\r\n- If a python script can reproduce the error, please paste the code snippet\r\n```\r\n# Paste code snippet here\r\n`coreml_model = coremltools.converters.keras.convert(model_in)\r\n#save the coreml\r\ncoreml_model.save(\"faceEmotion20200110.mlmodel\")`\r\n\r\n- If applicable, please attach the source model\r\n    - If the model cannot be shared publicly, please attach it via filing a bug report at https://developer.apple.com/bug-reporting/  and provide the reference number here\r\n- If it is a model conversion issue and the conversion succeeds, however, if there is a numerical mismatch between the original and the coreml model, please paste script used for comparison.\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5):\r\n - OS (e.g., MacOS, Linux):\r\n - macOS version (if applicable):\r\n - XCode version (if applicable):\r\n - How you install python (anaconda, virtualenv, system):\r\n - python version (e.g. 3.7):\r\n - any other relevant information:\r\n     - e.g. keras version if using keras conversion etc.\r\n\r\n## Additional context\r\nAdd any other context about the problem here.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/565", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/565/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/565/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/565/events", "html_url": "https://github.com/apple/coremltools/issues/565", "id": 542231119, "node_id": "MDU6SXNzdWU1NDIyMzExMTk=", "number": 565, "title": "Convert multiArray to image as the input type ", "user": {"login": "MarcSteven", "id": 13824297, "node_id": "MDQ6VXNlcjEzODI0Mjk3", "avatar_url": "https://avatars3.githubusercontent.com/u/13824297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarcSteven", "html_url": "https://github.com/MarcSteven", "followers_url": "https://api.github.com/users/MarcSteven/followers", "following_url": "https://api.github.com/users/MarcSteven/following{/other_user}", "gists_url": "https://api.github.com/users/MarcSteven/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarcSteven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarcSteven/subscriptions", "organizations_url": "https://api.github.com/users/MarcSteven/orgs", "repos_url": "https://api.github.com/users/MarcSteven/repos", "events_url": "https://api.github.com/users/MarcSteven/events{/privacy}", "received_events_url": "https://api.github.com/users/MarcSteven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-12-25T01:38:06Z", "updated_at": "2019-12-26T01:19:23Z", "closed_at": "2019-12-26T01:19:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nI had tried to use it to convert the input of multiArray as the image and then it always predictions wrongly.\r\nAt the beginning of launching the project it always showed the wrong output(but the first output is same) The previous input type is multiArray(float 32)\r\nAnd then I convert it to image\r\n<img width=\"204\" alt=\"Screen Shot 2019-12-24 at 09 42 57\" src=\"https://user-images.githubusercontent.com/13824297/71428168-096c6680-26fa-11ea-9009-7bcce53329b3.png\">\r\nThe previous mlmodel file \r\n<img width=\"802\" alt=\"Screen Shot 2019-12-25 at 09 37 06\" src=\"https://user-images.githubusercontent.com/13824297/71428208-505a5c00-26fa-11ea-8025-bd1dacecc262.png\">\r\nthe changed mlmodel file \r\n<img width=\"550\" alt=\"Screen Shot 2019-12-25 at 09 38 30\" src=\"https://user-images.githubusercontent.com/13824297/71428223-67994980-26fa-11ea-89d1-0cb158cf2091.png\">\r\n\r\n## System Information\r\n- If applicable\r\nI use the latest version to deal with the things\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/560", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/560/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/560/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/560/events", "html_url": "https://github.com/apple/coremltools/issues/560", "id": 540466592, "node_id": "MDU6SXNzdWU1NDA0NjY1OTI=", "number": 560, "title": "missing libcaffeconverter", "user": {"login": "Yrij-Zhavoronkov", "id": 12384490, "node_id": "MDQ6VXNlcjEyMzg0NDkw", "avatar_url": "https://avatars0.githubusercontent.com/u/12384490?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Yrij-Zhavoronkov", "html_url": "https://github.com/Yrij-Zhavoronkov", "followers_url": "https://api.github.com/users/Yrij-Zhavoronkov/followers", "following_url": "https://api.github.com/users/Yrij-Zhavoronkov/following{/other_user}", "gists_url": "https://api.github.com/users/Yrij-Zhavoronkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/Yrij-Zhavoronkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Yrij-Zhavoronkov/subscriptions", "organizations_url": "https://api.github.com/users/Yrij-Zhavoronkov/orgs", "repos_url": "https://api.github.com/users/Yrij-Zhavoronkov/repos", "events_url": "https://api.github.com/users/Yrij-Zhavoronkov/events{/privacy}", "received_events_url": "https://api.github.com/users/Yrij-Zhavoronkov/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-12-19T17:58:06Z", "updated_at": "2019-12-20T20:34:31Z", "closed_at": "2019-12-20T20:34:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, installed coremltools with `pip3 install git+https://github.com/apple/coremltools.`\r\nTrying to convert network caffe to onnx (code from tutorial), but python gives an error:\r\n```\r\nFile \"C:\\Users\\Fuhrer\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\coremltools\\converters\\caffe\\_caffe_converter.py\", line 192, in convert\r\n    predictedfeature_name)\r\n  File \"C:\\Users\\Fuhrer\\AppData\\Local\\Programs\\Python\\Python36\\lib\\site-packages\\coremltools\\converters\\caffe\\_caffe_converter.py\", line 205, in _export\r\n    from ... import libcaffeconverter\r\nImportError: cannot import name 'libcaffeconverter'\r\n```\r\nWhat to do? \r\nOS: Win 10 x64 Python 3.6\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/559", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/559/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/559/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/559/events", "html_url": "https://github.com/apple/coremltools/issues/559", "id": 540434526, "node_id": "MDU6SXNzdWU1NDA0MzQ1MjY=", "number": 559, "title": "Is there any limit on number inputs / outputs?", "user": {"login": "mrgloom", "id": 4003908, "node_id": "MDQ6VXNlcjQwMDM5MDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/4003908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrgloom", "html_url": "https://github.com/mrgloom", "followers_url": "https://api.github.com/users/mrgloom/followers", "following_url": "https://api.github.com/users/mrgloom/following{/other_user}", "gists_url": "https://api.github.com/users/mrgloom/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrgloom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrgloom/subscriptions", "organizations_url": "https://api.github.com/users/mrgloom/orgs", "repos_url": "https://api.github.com/users/mrgloom/repos", "events_url": "https://api.github.com/users/mrgloom/events{/privacy}", "received_events_url": "https://api.github.com/users/mrgloom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-12-19T16:53:21Z", "updated_at": "2019-12-19T18:48:04Z", "closed_at": "2019-12-19T18:48:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "Is there any limit on number inputs / outputs converting model from TensorFlow to coreml?\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/556", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/556/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/556/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/556/events", "html_url": "https://github.com/apple/coremltools/issues/556", "id": 539625309, "node_id": "MDU6SXNzdWU1Mzk2MjUzMDk=", "number": 556, "title": "List of supported layers?", "user": {"login": "mrgloom", "id": 4003908, "node_id": "MDQ6VXNlcjQwMDM5MDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/4003908?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mrgloom", "html_url": "https://github.com/mrgloom", "followers_url": "https://api.github.com/users/mrgloom/followers", "following_url": "https://api.github.com/users/mrgloom/following{/other_user}", "gists_url": "https://api.github.com/users/mrgloom/gists{/gist_id}", "starred_url": "https://api.github.com/users/mrgloom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mrgloom/subscriptions", "organizations_url": "https://api.github.com/users/mrgloom/orgs", "repos_url": "https://api.github.com/users/mrgloom/repos", "events_url": "https://api.github.com/users/mrgloom/events{/privacy}", "received_events_url": "https://api.github.com/users/mrgloom/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1433418622, "node_id": "MDU6TGFiZWwxNDMzNDE4NjIy", "url": "https://api.github.com/repos/apple/coremltools/labels/docs", "name": "docs", "color": "c10f47", "default": false, "description": "Contains documentation or clarification regarding docs (type)"}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-12-18T11:32:26Z", "updated_at": "2019-12-19T16:52:22Z", "closed_at": "2019-12-19T16:52:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "How can I get list of supported by cormel layers?\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/554", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/554/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/554/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/554/events", "html_url": "https://github.com/apple/coremltools/issues/554", "id": 539232797, "node_id": "MDU6SXNzdWU1MzkyMzI3OTc=", "number": 554, "title": "remove_identity pass breaks graph when using separable conv", "user": {"login": "ghop02", "id": 1422280, "node_id": "MDQ6VXNlcjE0MjIyODA=", "avatar_url": "https://avatars2.githubusercontent.com/u/1422280?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghop02", "html_url": "https://github.com/ghop02", "followers_url": "https://api.github.com/users/ghop02/followers", "following_url": "https://api.github.com/users/ghop02/following{/other_user}", "gists_url": "https://api.github.com/users/ghop02/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghop02/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghop02/subscriptions", "organizations_url": "https://api.github.com/users/ghop02/orgs", "repos_url": "https://api.github.com/users/ghop02/repos", "events_url": "https://api.github.com/users/ghop02/events{/privacy}", "received_events_url": "https://api.github.com/users/ghop02/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-12-17T18:19:17Z", "updated_at": "2020-01-14T19:29:08Z", "closed_at": "2020-01-14T19:29:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nthe `remove_identity` function seems to break the ssa converter when a tf.keras `SeperableConv2D` layer is used.\r\n- Is this a converter issue? Yes, Tensorflow (2.0)\r\n\r\n## Trace\r\n```python\r\n0 assert nodes deleted\r\n5 nodes deleted\r\n0 nodes deleted\r\n0 nodes deleted\r\n[Op Fusion] fuse_bias_add() deleted 4 nodes.\r\n1 identity nodes deleted\r\n2 disconnected nodes deleted\r\n---------------------------------------------------------------------------\r\nAssertionError                            Traceback (most recent call last)\r\n~/.pyenv/versions/3.6.8/envs/fritz-models-private/src/coremltools/coremltools/converters/tensorflow/_tf_converter.py in convert(filename, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, **kwargs)\r\n     94                                  custom_shape_functions=custom_shape_functions,\r\n---> 95                                  optional_inputs=optional_inputs)\r\n     96     except ImportError as e:\r\n\r\n~/.pyenv/versions/3.6.8/envs/fritz-models-private/src/coremltools/coremltools/converters/nnssa/coreml/ssa_converter.py in ssa_convert(ssa, top_func, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, optional_inputs)\r\n    132     for f in list(ssa.functions.values()):\r\n--> 133         check_connections(f.graph)\r\n    134 \r\n\r\n~/.pyenv/versions/3.6.8/envs/fritz-models-private/src/coremltools/coremltools/converters/nnssa/commons/basic_graph_ops.py in check_connections(gd)\r\n    152             try:\r\n--> 153                 assert (k in gd[i].control_inputs)\r\n    154             except Exception:\r\n```\r\n\r\n## To Reproduce\r\n- If a python script can reproduce the error, please paste the code snippet\r\n```python\r\nfrom tensorflow import keras\r\nimport tempfile\r\ninpt = keras.layers.Input(shape=[256, 256, 3], batch_size=1)\r\nout = keras.layers.SeparableConv2D(\r\n    filters=5,\r\n    kernel_size=(3, 3),\r\n)(inpt)\r\nout = keras.layers.Conv2D(\r\n    filters=5,\r\n    kernel_size=1,\r\n)(out)\r\nmodel = keras.Model(inpt, out)\r\ntemp = tempfile.NamedTemporaryFile(suffix=\".h5\")\r\nmodel.save(temp.name, include_optimizer=False, save_format=\"h5\")\r\nmlmodel = coremltools.converters.tensorflow.convert(\r\n    temp.name\r\n)\r\n\r\n```\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): master\r\n - OS (e.g., MacOS, Linux): MacOS\r\n - How you install python (anaconda, virtualenv, system): pyenv\r\n - python version (e.g. 3.7): 3.6.8\r\n - any other relevant information:\r\n     - Using tf-nightly\r\n\r\n## Additional context\r\nIf I comment out the `remove_identity` pass (in ssa_converter.py:115), it successfully converts.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/553", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/553/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/553/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/553/events", "html_url": "https://github.com/apple/coremltools/issues/553", "id": 539217471, "node_id": "MDU6SXNzdWU1MzkyMTc0NzE=", "number": 553, "title": "tf.Keras softmax activation does not convert properly", "user": {"login": "ghop02", "id": 1422280, "node_id": "MDQ6VXNlcjE0MjIyODA=", "avatar_url": "https://avatars2.githubusercontent.com/u/1422280?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ghop02", "html_url": "https://github.com/ghop02", "followers_url": "https://api.github.com/users/ghop02/followers", "following_url": "https://api.github.com/users/ghop02/following{/other_user}", "gists_url": "https://api.github.com/users/ghop02/gists{/gist_id}", "starred_url": "https://api.github.com/users/ghop02/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ghop02/subscriptions", "organizations_url": "https://api.github.com/users/ghop02/orgs", "repos_url": "https://api.github.com/users/ghop02/repos", "events_url": "https://api.github.com/users/ghop02/events{/privacy}", "received_events_url": "https://api.github.com/users/ghop02/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-12-17T17:46:47Z", "updated_at": "2020-01-07T21:35:24Z", "closed_at": "2020-01-07T21:35:24Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n- Coremltools tensorflow converter fails to convert keras softmax activation function.\r\n- Is this a converter issue? If yes, please specify which converter (sci-kit, keras, xgboost etc.): tensorflow 2.0\r\n\r\n## Trace\r\n```python\r\n0 assert nodes deleted\r\n2 nodes deleted\r\n0 nodes deleted\r\n0 nodes deleted\r\n[Op Fusion] fuse_bias_add() deleted 2 nodes.\r\n---------------------------------------------------------------------------\r\nTypeError                                 Traceback (most recent call last)\r\n~/.pyenv/versions/3.6.8/envs/fritz-models-private/src/coremltools/coremltools/converters/tensorflow/_tf_converter.py in convert(filename, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, **kwargs)\r\n     94                                  custom_shape_functions=custom_shape_functions,\r\n---> 95                                  optional_inputs=optional_inputs)\r\n     96     except ImportError as e:\r\n\r\n~/.pyenv/versions/3.6.8/envs/fritz-models-private/src/coremltools/coremltools/converters/nnssa/coreml/ssa_converter.py in ssa_convert(ssa, top_func, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, optional_inputs)\r\n    124     for p in passes:\r\n--> 125         p(ssa)\r\n    126 \r\n\r\n~/.pyenv/versions/3.6.8/envs/fritz-models-private/src/coremltools/coremltools/converters/nnssa/coreml/graph_pass/op_fusions.py in transform_nhwc_to_nchw(nnssa)\r\n    210             node = graph[name]\r\n--> 211             if len(node.outputs) > 0 and len(node.inputs) > 0 and _is_NHWC(graph, node):\r\n    212                 node.attr['data_format'] = 'NHWC_format_inserted'\r\n\r\n~/.pyenv/versions/3.6.8/envs/fritz-models-private/src/coremltools/coremltools/converters/nnssa/coreml/graph_pass/op_fusions.py in _is_NHWC(graph, node)\r\n     95                 m_nhwc_to_nchw = {0: 0, 1: 2, 2: 3, 3: 1}\r\n---> 96                 reduction_indices = np.array([m_nhwc_to_nchw[x] for x in val], dtype=np.int32)\r\n     97                 parent_node.value.val = np.reshape(reduction_indices, parent_node.value.val.shape)\r\n\r\nTypeError: iteration over a 0-d array\r\n```\r\n## To Reproduce\r\n- If a python script can reproduce the error, please paste the code snippet\r\n```python\r\nfrom tensorflow import keras\r\nimport tempfile\r\nimport coremltools\r\ninpt = keras.layers.Input(shape=[256, 256, 3], batch_size=1)\r\nout = keras.layers.Conv2D(\r\n    filters=5,\r\n    kernel_size=1,\r\n    padding=\"same\",\r\n    activation=\"softmax\",\r\n    name=\"decoder_conv2d_1\",\r\n)(inpt)\r\nmodel = keras.Model(inpt, out)\r\ntemp = tempfile.NamedTemporaryFile(suffix=\".h5\")\r\nmodel.save(temp.name)\r\nmlmodel = coremltools.converters.tensorflow.convert(\r\n    temp.name,\r\n)\r\n```\r\n\r\nSetting activation to `None` in the convolution converts properly.\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): master\r\n - OS (e.g., MacOS, Linux): MacOS\r\n - macOS version (if applicable):\r\n - XCode version (if applicable):\r\n - How you install python (anaconda, virtualenv, system): pyenv\r\n - python version (e.g. 3.7): 3.6.8\r\n - any other relevant information:\r\n     - e.g. using tensorflow nightly build\r\n\r\n## Additional info\r\n[Internally, tf.keras](https://github.com/tensorflow/tensorflow/blob/v2.1.0-rc1/tensorflow/python/keras/activations.py#L43-L79) seems to not use the softmax layer:\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/551", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/551/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/551/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/551/events", "html_url": "https://github.com/apple/coremltools/issues/551", "id": 538783304, "node_id": "MDU6SXNzdWU1Mzg3ODMzMDQ=", "number": 551, "title": "install coremltools2.0", "user": {"login": "MarcSteven", "id": 13824297, "node_id": "MDQ6VXNlcjEzODI0Mjk3", "avatar_url": "https://avatars3.githubusercontent.com/u/13824297?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MarcSteven", "html_url": "https://github.com/MarcSteven", "followers_url": "https://api.github.com/users/MarcSteven/followers", "following_url": "https://api.github.com/users/MarcSteven/following{/other_user}", "gists_url": "https://api.github.com/users/MarcSteven/gists{/gist_id}", "starred_url": "https://api.github.com/users/MarcSteven/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MarcSteven/subscriptions", "organizations_url": "https://api.github.com/users/MarcSteven/orgs", "repos_url": "https://api.github.com/users/MarcSteven/repos", "events_url": "https://api.github.com/users/MarcSteven/events{/privacy}", "received_events_url": "https://api.github.com/users/MarcSteven/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-12-17T01:44:43Z", "updated_at": "2019-12-23T05:44:05Z", "closed_at": "2019-12-23T05:44:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nI want to use coremltools 2.0 to support iOS12,I found coremltools3.1 doesn't support iOS 12.\r\nSo how to applied the model support iOS12, I installed the package 2.0 and then it showed the error:\r\n* 1, open my iTerm and input **pip install \"coremltools~=2.0\"**\r\n* 2, and then it displayed the error as below(I had uninstalled the latest version 3.1)\r\n`ERROR: Could not find a version that satisfies the requirement coremltools==2.0b1 (from versions: 3.0b1, 3.0b2, 3.0b3, 3.0b4, 3.0b5, 3.0b6, 3.0, 3.1)\r\nERROR: No matching distribution found for coremltools==2.0b1`\r\n## System Information\r\n- If applicable\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/549", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/549/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/549/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/549/events", "html_url": "https://github.com/apple/coremltools/issues/549", "id": 537005627, "node_id": "MDU6SXNzdWU1MzcwMDU2Mjc=", "number": 549, "title": "RuntimeError: failed to convert from TensorFlow to IR.", "user": {"login": "Praveenk8051", "id": 20404922, "node_id": "MDQ6VXNlcjIwNDA0OTIy", "avatar_url": "https://avatars3.githubusercontent.com/u/20404922?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Praveenk8051", "html_url": "https://github.com/Praveenk8051", "followers_url": "https://api.github.com/users/Praveenk8051/followers", "following_url": "https://api.github.com/users/Praveenk8051/following{/other_user}", "gists_url": "https://api.github.com/users/Praveenk8051/gists{/gist_id}", "starred_url": "https://api.github.com/users/Praveenk8051/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Praveenk8051/subscriptions", "organizations_url": "https://api.github.com/users/Praveenk8051/orgs", "repos_url": "https://api.github.com/users/Praveenk8051/repos", "events_url": "https://api.github.com/users/Praveenk8051/events{/privacy}", "received_events_url": "https://api.github.com/users/Praveenk8051/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 718619861, "node_id": "MDU6TGFiZWw3MTg2MTk4NjE=", "url": "https://api.github.com/repos/apple/coremltools/labels/repro%20needed", "name": "repro needed", "color": "27bbce", "default": false, "description": "More information or ability to reproduce the issue is needed (status)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2019-12-12T14:17:54Z", "updated_at": "2020-01-19T07:56:59Z", "closed_at": "2020-01-17T18:03:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nThe conversion from protobuf graph to coreml is failing.\r\nThe model is trained by transfer learning of mobilenet  architecture\r\nIt is occuring during convertion from .pb graph to coreml issue\r\n\r\n## Trace\r\nWARNING:tensorflow:From /Users/praveen/opt/anaconda3/envs/untitled/lib/python3.7/site-packages/tensorflow_core/python/compat/v2_compat.py:65: disable_resource_variables (from tensorflow.python.ops.variable_scope) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nnon-resource variables are not supported in the long term\r\nWARNING:root:TensorFlow version 2.0.0 detected. Last version known to be fully compatible is 1.14.0 .\r\nTraceback (most recent call last):\r\n  File \"/Users/praveen/opt/anaconda3/envs/untitled/lib/python3.7/site-packages/coremltools/converters/tensorflow/_tf_converter.py\", line 69, in convert\r\n    ssa = frontend_load(filename, resume_on_errors=False, inputs=inputs, outputs=outputs, **kwargs)\r\n  File \"/Users/praveen/opt/anaconda3/envs/untitled/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/tensorflow/load.py\", line 50, in load\r\n    raise ValueError('Shape of required input {} is not provided.'.format(name))\r\nValueError: Shape of required input input_1/BottleneckInputPlaceholder is not provided.\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/tf_to_coreml.py\", line 14, in <module>\r\n    class_labels=r'/test_/test.txt',\r\n  File \"//tfcoreml/_tf_coreml_converter.py\", line 692, in convert\r\n    custom_shape_functions=custom_shape_functions)\r\n  File \"/tensorflow/_tf_converter.py\", line 73, in convert\r\n    raise RuntimeError('failed to convert from TensorFlow to IR. {}'.format(e))\r\nRuntimeError: failed to convert from TensorFlow to IR. Shape of required input input_1/BottleneckInputPlaceholder is not provided.\r\n\r\n## To Reproduce\r\n\r\nI can send the .pb file and label file if you can email to praveenk8051@gmail.com\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  : 1.1.0\r\n - macOS version (if applicable):10.14.6\r\n - How you install python : anaconda interpreter, PyCharm IDE\r\n - python version: 3.7.4\r\n - any other relevant information:\r\n     Tensorflow 2.0.0\r\ntfcoreml : 1.1.0\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/542", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/542/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/542/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/542/events", "html_url": "https://github.com/apple/coremltools/issues/542", "id": 535117693, "node_id": "MDU6SXNzdWU1MzUxMTc2OTM=", "number": 542, "title": "Converting ResNet-50 from Keras to CoreML causes subtle prediction differences", "user": {"login": "steverichey", "id": 3226635, "node_id": "MDQ6VXNlcjMyMjY2MzU=", "avatar_url": "https://avatars2.githubusercontent.com/u/3226635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/steverichey", "html_url": "https://github.com/steverichey", "followers_url": "https://api.github.com/users/steverichey/followers", "following_url": "https://api.github.com/users/steverichey/following{/other_user}", "gists_url": "https://api.github.com/users/steverichey/gists{/gist_id}", "starred_url": "https://api.github.com/users/steverichey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/steverichey/subscriptions", "organizations_url": "https://api.github.com/users/steverichey/orgs", "repos_url": "https://api.github.com/users/steverichey/repos", "events_url": "https://api.github.com/users/steverichey/events{/privacy}", "received_events_url": "https://api.github.com/users/steverichey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1476891360, "node_id": "MDU6TGFiZWwxNDc2ODkxMzYw", "url": "https://api.github.com/repos/apple/coremltools/labels/multi-backend%20keras", "name": "multi-backend keras", "color": "ff8000", "default": false, "description": "Issue could be related to keras framework (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-12-09T18:31:24Z", "updated_at": "2019-12-11T15:04:49Z", "closed_at": "2019-12-10T22:34:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nCreating a network in Keras based on ResNet-50 and converting this network to CoreML format causes the output to be different in subtle ways. Using the script provided below, I receive the following:\r\n```\r\nKeras ResNet-50:\r\n\tElephant Probabilities:\r\n\t\tAfrican elephant: 81.83%\r\n\t\ttusker: 17.50%\r\n\t\tIndian elephant: 0.67%\r\nCoreML Converted ResNet-50:\r\n\tElephant Probabilities:\r\n\t\tAfrican elephant: 81.43%\r\n\t\ttusker: 17.89%\r\n\t\tIndian elephant: 0.68%\r\n```\r\n\r\n## To Reproduce\r\n\r\n```\r\nimport PIL\r\nimport numpy as np\r\nimport coremltools\r\nfrom PIL import Image\r\nfrom keras.applications.resnet50 import ResNet50\r\nfrom keras.applications.resnet50 import decode_predictions\r\n\r\n\r\ndef pillow_load_image(path, shape):\r\n    return PIL.Image.open(path).resize(shape[:2], PIL.Image.BILINEAR)\r\n\r\n\r\ndef numpy_from_pillow(pilimg):\r\n    return np.asarray(pilimg, dtype=np.float32)\r\n\r\n\r\ndef flip_channels(npimg):\r\n    img = np.copy(npimg)\r\n    return img[:, :, ::-1]\r\n\r\n\r\ndef imagenet_weight_shift(npimg, weights):\r\n    img = np.copy(npimg)\r\n    return img - np.expand_dims(np.expand_dims(weights, axis=0), axis=0)\r\n\r\n\r\ndef caffe_from_numpy(npimg, weights):\r\n    img = np.copy(npimg)\r\n    img = flip_channels(img)\r\n    img = imagenet_weight_shift(img, weights)\r\n    return np.expand_dims(img, axis=0)\r\n\r\n\r\ndef caffe_from_pillow(pilimg, weights):\r\n    img = numpy_from_pillow(pilimg)\r\n    return caffe_from_numpy(img, weights)\r\n\r\n\r\ndef caffe_load_image(path, shape, weights):\r\n    img = pillow_load_image(path, shape)\r\n    return caffe_from_pillow(img, weights)\r\n\r\n\r\ndef read_text(path):\r\n    with open(path, \"r\") as text_file:\r\n        return text_file.read()\r\n\r\n\r\ndef read_list(path):\r\n    result = read_text(path).split(\"\\n\")\r\n    result = filter(None, result)\r\n    result = filter(len, result)\r\n    return list(result)\r\n\r\n\r\ndef print_results(all_results, num=3, key='probabilities'):\r\n    probs = all_results[key]\r\n    i = 0\r\n    for key, value in sorted(probs.items(), reverse=True, key=lambda kv: (kv[1], kv[0])):\r\n        if i > num-1:\r\n            return\r\n        print(\"\\t\\t%s: %s\" % (key.split(\",\")[0].replace(\"_\", \" \"), \"{:0.2f}%\".format(value * 100)))\r\n        i += 1\r\n\r\n\r\ndef format_predictions(predlist, top):\r\n    decoded = decode_predictions(predlist, top=top)\r\n    return {\"classLabelProbs\": dict(map(lambda x: (x[1], x[2]), decoded[0]))}\r\n\r\n\r\nimagenet_weights = np.asarray([103.939, 116.779, 123.680], dtype=np.float32)\r\nmodel = ResNet50(weights='imagenet', include_top=True)\r\n\r\npillow_elephant = pillow_load_image('elephant.jpg', (224, 224, 3))\r\ncaffe_elephant = caffe_load_image('elephant.jpg', (224, 224, 3), imagenet_weights)\r\n\r\nelephant_preds = model.predict(caffe_elephant)\r\nformatted_elephants = format_predictions(elephant_preds, top=3)\r\n\r\nprint(\"Keras ResNet-50:\")\r\nprint('\\tElephant Probabilities:')\r\nprint_results(formatted_elephants, key=\"classLabelProbs\")\r\n\r\nclass_labels = read_list(\"classes.txt\")\r\n\r\nconvrt_model = coremltools.converters.keras.convert(model,\r\n                                                    input_names=['image'],\r\n                                                    image_input_names=['image'],\r\n                                                    output_names=['probabilities'],\r\n                                                    class_labels=class_labels,\r\n                                                    predicted_feature_name='class',\r\n                                                    is_bgr=True,\r\n                                                    blue_bias=-imagenet_weights[0],\r\n                                                    green_bias=-imagenet_weights[1],\r\n                                                    red_bias=-imagenet_weights[2])\r\n\r\nprint(\"CoreML Converted ResNet-50:\")\r\nprint(\"\\tElephant Probabilities:\")\r\nprint_results(convrt_model.predict({'image': pillow_elephant}))\r\n```\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 3.1\r\n - OS (e.g., MacOS, Linux): macOS\r\n - macOS version (if applicable): 10.14.6\r\n - How you install python (anaconda, virtualenv, system): virtualenv\r\n - python version (e.g. 3.7): 3.7.4\r\n - any other relevant information:\r\n     - Keras 2.2.4\r\n     - TensorFlow 1.13.1\r\n\r\n## Additional context\r\nThis appears to be a regression; I believe that 2.x versions of coremltools performed this conversion with perfect accuracy, but I haven't been able to revert to a previous Python version and test those.\r\n\r\nThe sample image of an elephant is just an arbitrary image retrieved from the internet. As I do not have the rights to this image, it is not attached.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/538", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/538/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/538/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/538/events", "html_url": "https://github.com/apple/coremltools/issues/538", "id": 534331266, "node_id": "MDU6SXNzdWU1MzQzMzEyNjY=", "number": 538, "title": "API Docs not update to latest version", "user": {"login": "TobyRoseman", "id": 5420744, "node_id": "MDQ6VXNlcjU0MjA3NDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5420744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobyRoseman", "html_url": "https://github.com/TobyRoseman", "followers_url": "https://api.github.com/users/TobyRoseman/followers", "following_url": "https://api.github.com/users/TobyRoseman/following{/other_user}", "gists_url": "https://api.github.com/users/TobyRoseman/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobyRoseman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobyRoseman/subscriptions", "organizations_url": "https://api.github.com/users/TobyRoseman/orgs", "repos_url": "https://api.github.com/users/TobyRoseman/repos", "events_url": "https://api.github.com/users/TobyRoseman/events{/privacy}", "received_events_url": "https://api.github.com/users/TobyRoseman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1433418622, "node_id": "MDU6TGFiZWwxNDMzNDE4NjIy", "url": "https://api.github.com/repos/apple/coremltools/labels/docs", "name": "docs", "color": "c10f47", "default": false, "description": "Contains documentation or clarification regarding docs (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-12-07T01:09:30Z", "updated_at": "2019-12-09T20:45:12Z", "closed_at": "2019-12-09T20:45:12Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nThe latest version of coremltools is 3.1. However the hosted API docs are for 3.0.\r\n\r\n## To Reproduce\r\nGo to [the main README](https://github.com/apple/coremltools#user-guide-and-examples). Click on \"API documentation\" link. Observe that the version number in the top left hand corner is `3.0` not `3.1`.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/535", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/535/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/535/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/535/events", "html_url": "https://github.com/apple/coremltools/issues/535", "id": 532654218, "node_id": "MDU6SXNzdWU1MzI2NTQyMTg=", "number": 535, "title": "Value of `add_custom_layers` ignored for keras 2 converter", "user": {"login": "LeoIV", "id": 13868691, "node_id": "MDQ6VXNlcjEzODY4Njkx", "avatar_url": "https://avatars3.githubusercontent.com/u/13868691?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LeoIV", "html_url": "https://github.com/LeoIV", "followers_url": "https://api.github.com/users/LeoIV/followers", "following_url": "https://api.github.com/users/LeoIV/following{/other_user}", "gists_url": "https://api.github.com/users/LeoIV/gists{/gist_id}", "starred_url": "https://api.github.com/users/LeoIV/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LeoIV/subscriptions", "organizations_url": "https://api.github.com/users/LeoIV/orgs", "repos_url": "https://api.github.com/users/LeoIV/repos", "events_url": "https://api.github.com/users/LeoIV/events{/privacy}", "received_events_url": "https://api.github.com/users/LeoIV/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1476891360, "node_id": "MDU6TGFiZWwxNDc2ODkxMzYw", "url": "https://api.github.com/repos/apple/coremltools/labels/multi-backend%20keras", "name": "multi-backend keras", "color": "ff8000", "default": false, "description": "Issue could be related to keras framework (component)"}, {"id": 1721362947, "node_id": "MDU6TGFiZWwxNzIxMzYyOTQ3", "url": "https://api.github.com/repos/apple/coremltools/labels/neural%20networks", "name": "neural networks", "color": "ededed", "default": false, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-12-04T12:30:26Z", "updated_at": "2019-12-09T12:48:47Z", "closed_at": "2019-12-09T12:48:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n`add_custom_layers` without function for the Keras 2 converter (`_keras2_converter.py`) in function `_convert`. The value for `add_custom_layers` immediately gets overwritten: \r\n```\r\n# Check custom conversion functions / custom objects\r\nadd_custom_layers = custom_conversion_functions is not None\r\n```\r\n\r\nIf I understand `add_custom_layers` correctly, this is not the intended behavior. `add_custom_layers` is supposed to convert the model such that non-convertable layers have to be implemented later in CoreML.\r\n\r\nThis functionality is separate from `custom_conversion_functions`.\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/529", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/529/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/529/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/529/events", "html_url": "https://github.com/apple/coremltools/issues/529", "id": 527609781, "node_id": "MDU6SXNzdWU1Mjc2MDk3ODE=", "number": 529, "title": "Converting models with tf.keras.layers.Upsampling2D layers fails due to shape inference.", "user": {"login": "jamesonthecrow", "id": 337862, "node_id": "MDQ6VXNlcjMzNzg2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/337862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamesonthecrow", "html_url": "https://github.com/jamesonthecrow", "followers_url": "https://api.github.com/users/jamesonthecrow/followers", "following_url": "https://api.github.com/users/jamesonthecrow/following{/other_user}", "gists_url": "https://api.github.com/users/jamesonthecrow/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamesonthecrow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamesonthecrow/subscriptions", "organizations_url": "https://api.github.com/users/jamesonthecrow/orgs", "repos_url": "https://api.github.com/users/jamesonthecrow/repos", "events_url": "https://api.github.com/users/jamesonthecrow/events{/privacy}", "received_events_url": "https://api.github.com/users/jamesonthecrow/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1721362947, "node_id": "MDU6TGFiZWwxNzIxMzYyOTQ3", "url": "https://api.github.com/repos/apple/coremltools/labels/neural%20networks", "name": "neural networks", "color": "ededed", "default": false, "description": ""}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-11-23T21:09:59Z", "updated_at": "2020-01-17T18:03:03Z", "closed_at": "2020-01-17T18:03:02Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nConverting models with an upsampling layer followed by a convolution layer (and perhaps others), fails due to input shape inference. This seems to be because the graph_def created from the keras model does not impute the output shape of the upsampling output.\r\n\r\n## Trace\r\n```\r\nWARNING:tensorflow:No training configuration found in save file: the model was *not* compiled. Compile it manually.\r\nWARNING:tensorflow:No training configuration found in save file: the model was *not* compiled. Compile it manually.\r\n0 assert nodes deleted\r\n['model/up_sampling2d/strided_slice/stack_2:0', 'model/up_sampling2d/Const:0', 'model/up_sampling2d/strided_slice/stack:0', 'model/conv2d/Conv2D/ReadVariableOp/resource:0', 'model/conv2d/Conv2D/ReadVariableOp:0', 'model/conv2d/BiasAdd/ReadVariableOp:0', 'model/conv2d/BiasAdd/ReadVariableOp/resource:0', 'model/up_sampling2d/strided_slice/stack_1:0']\r\n2 nodes deleted\r\n[TypeInference] Failed to infer type of node \"model/conv2d/Conv2D\" (Conv2D)\r\n[TypeInference] Error fetching padding values: can't convert expression to float\r\nTraceback (most recent call last):\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 24, in get_conv_outdim\r\n    return math.floor((in_dim - ks_dilated) / stride) + 1\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/sympy/core/expr.py\", line 280, in __float__\r\n    raise TypeError(\"can't convert expression to float\")\r\nTypeError: can't convert expression to float\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 86, in visit\r\n    ret = visitor(node)\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 504, in visit_Conv2D\r\n    strides[1], dilations[1], padding)\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 30, in get_conv_outdim\r\n    raise ValueError('[TypeInference] Error fetching padding values: {}'.format(e))\r\nValueError: [TypeInference] Error fetching padding values: can't convert expression to float\r\n\r\n[TypeInference] Unable to infer type of node \"model/conv2d/Conv2D\" (Conv2D)\r\n[TypeInference] Failed to infer type of node \"model/conv2d/Conv2D\" (Conv2D)\r\n[TypeInference] Error fetching padding values: can't convert expression to float\r\nTraceback (most recent call last):\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 24, in get_conv_outdim\r\n    return math.floor((in_dim - ks_dilated) / stride) + 1\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/sympy/core/expr.py\", line 280, in __float__\r\n    raise TypeError(\"can't convert expression to float\")\r\nTypeError: can't convert expression to float\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 86, in visit\r\n    ret = visitor(node)\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 504, in visit_Conv2D\r\n    strides[1], dilations[1], padding)\r\n  File \"/Users/jameson/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/graph_pass/type_inference.py\", line 30, in get_conv_outdim\r\n    raise ValueError('[TypeInference] Error fetching padding values: {}'.format(e))\r\nValueError: [TypeInference] Error fetching padding values: can't convert expression to float\r\n\r\n[TypeInference] Unable to infer type of node \"model/conv2d/Conv2D\" (Conv2D)\r\n5 nodes deleted\r\n0 nodes deleted\r\n---------------------------------------------------------------------------\r\nAssertionError                            Traceback (most recent call last)\r\n~/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/tensorflow/_tf_converter.py in convert(filename, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, **kwargs)\r\n     68         from ..nnssa.frontend.tensorflow import load as frontend_load\r\n---> 69         ssa = frontend_load(filename, resume_on_errors=False, inputs=inputs, outputs=outputs, **kwargs)\r\n     70     except ImportError as e:\r\n\r\n~/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/nnssa/frontend/tensorflow/load.py in load(tfgraph, resume_on_errors, **kwargs)\r\n     84             for n in f.graph.values():\r\n---> 85                 assert n.datatype is not None\r\n     86     return ssa\r\n\r\nAssertionError: \r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nRuntimeError                              Traceback (most recent call last)\r\n<ipython-input-2-c9336be91bac> in <module>\r\n     11     input_names=\"image\",\r\n     12     output_names=\"output\",\r\n---> 13     image_input_names=\"image\",\r\n     14 )\r\n\r\n~/.pyenv/versions/3.7.5/envs/fritzml/lib/python3.7/site-packages/coremltools/converters/tensorflow/_tf_converter.py in convert(filename, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, **kwargs)\r\n     71         raise ImportError('frontend converter not found. {}'.format(e))\r\n     72     except Exception as e:\r\n---> 73         raise RuntimeError('failed to convert from TensorFlow to IR. {}'.format(e))\r\n     74 \r\n     75     # convert from SSA IR to Core ML\r\n\r\nRuntimeError: failed to convert from TensorFlow to IR.\r\n```\r\n\r\n## To Reproduce\r\n\r\n```\r\ninpt = tf.keras.Input(shape=(128, 128, 32))\r\nout = tf.keras.layers.UpSampling2D()(inpt)\r\nout = tf.keras.layers.Conv2D(10, 3)(out)\r\nmodel = tf.keras.models.Model(inpt, out)\r\n\r\ntemp = tempfile.NamedTemporaryFile(suffix=\".h5\")\r\nmodel.save(temp.name, save_format=\"h5\")\r\n\r\ncoremltools.converters.tensorflow.convert(\r\n    temp.name,\r\n    input_names=\"image\",\r\n    output_names=\"output\",\r\n    image_input_names=\"image\",\r\n)\r\n```\r\n## System environment (please complete the following information):\r\n - coremltools version: 3.1\r\n - OS (e.g., MacOS, Linux): MacOS\r\n - macOS version (if applicable): 1.15.1\r\n - How you install python (anaconda, virtualenv, system): pyenv virtualenv\r\n - python version (e.g. 3.7): 3.7.5\r\n - tensorflow: 2.0.0\r\n\r\n## Additional context\r\nDigging into this the output shape of the resize layer is [-1, -1, -1, 32]. This causes `_get_type_from_attr(self, node):` to return strings for those first three dimensions which in turn causes the input dimensions in the subsequent convolution layer to include strings which throws an error when used to compute the output dimension.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/527", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/527/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/527/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/527/events", "html_url": "https://github.com/apple/coremltools/issues/527", "id": 527186604, "node_id": "MDU6SXNzdWU1MjcxODY2MDQ=", "number": 527, "title": "TypeError when no custom_func is supplied in Keras 2 converter ", "user": {"login": "y26805", "id": 15137352, "node_id": "MDQ6VXNlcjE1MTM3MzUy", "avatar_url": "https://avatars1.githubusercontent.com/u/15137352?v=4", "gravatar_id": "", "url": "https://api.github.com/users/y26805", "html_url": "https://github.com/y26805", "followers_url": "https://api.github.com/users/y26805/followers", "following_url": "https://api.github.com/users/y26805/following{/other_user}", "gists_url": "https://api.github.com/users/y26805/gists{/gist_id}", "starred_url": "https://api.github.com/users/y26805/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/y26805/subscriptions", "organizations_url": "https://api.github.com/users/y26805/orgs", "repos_url": "https://api.github.com/users/y26805/repos", "events_url": "https://api.github.com/users/y26805/events{/privacy}", "received_events_url": "https://api.github.com/users/y26805/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-11-22T13:09:57Z", "updated_at": "2020-01-10T04:14:05Z", "closed_at": "2019-11-22T13:39:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83c\udf31 Describe your Feature Request\r\n`TypeError: argument of type 'NoneType' is not iterable` is raised when converting a keras model to CoreML model and when`custom_conversion_functions` is `None` (i.e. default value).\r\nThis is a misleading error message, as the actual problem is that no converter functions is available. This happens when `layer_type` is not in `_KERAS_LAYER_REGISTRY` so user should supply his/her own custom converter function. \r\n\r\nUsing coremltools 3.1 and keras 2.2.4.\r\nI can submit a PR for this to provide a better error message.\r\n\r\n## Use cases\r\nReferring to this block of code in the Keras 2 converter:\r\nhttps://github.com/apple/coremltools/blob/67523167121fa28056f168a691c72a1d3d56c310/coremltools/converters/keras/_keras2_converter.py#L491-L503\r\n\r\n`TypeError: argument of type 'NoneType' is not iterable` will be raised at Line 503 if `custom_conversion_functions` is `None` (i.e. default value).\r\n\r\nRaising a `ValueError` (as in the Keras 1 converter) will give users better guidance on how to solve the error.\r\nhttps://github.com/apple/coremltools/blob/67523167121fa28056f168a691c72a1d3d56c310/coremltools/converters/keras/_keras_converter.py#L81-L105\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/525", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/525/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/525/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/525/events", "html_url": "https://github.com/apple/coremltools/issues/525", "id": 526347837, "node_id": "MDU6SXNzdWU1MjYzNDc4Mzc=", "number": 525, "title": "How can fix this error when converting from Keras Model to CoreML?", "user": {"login": "jaimemiranda1", "id": 46731757, "node_id": "MDQ6VXNlcjQ2NzMxNzU3", "avatar_url": "https://avatars3.githubusercontent.com/u/46731757?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaimemiranda1", "html_url": "https://github.com/jaimemiranda1", "followers_url": "https://api.github.com/users/jaimemiranda1/followers", "following_url": "https://api.github.com/users/jaimemiranda1/following{/other_user}", "gists_url": "https://api.github.com/users/jaimemiranda1/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaimemiranda1/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaimemiranda1/subscriptions", "organizations_url": "https://api.github.com/users/jaimemiranda1/orgs", "repos_url": "https://api.github.com/users/jaimemiranda1/repos", "events_url": "https://api.github.com/users/jaimemiranda1/events{/privacy}", "received_events_url": "https://api.github.com/users/jaimemiranda1/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-11-21T03:47:57Z", "updated_at": "2019-11-22T21:39:32Z", "closed_at": "2019-11-22T21:39:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have this Keras Model which is being trained and testes on images from 2 classes (cats and dogs): \r\n\r\n`model = Sequential()`\r\n\r\n`model.add(Conv2D(128, 3, 3, border_mode='same', input_shape=input_shape, activation='relu'))`\r\n`model.add(Conv2D(64, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(MaxPooling2D(pool_size=(2, 2)))`\r\n\r\n`model.add(Conv2D(128, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(Conv2D(256, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(MaxPooling2D(pool_size=(2, 2)))`\r\n\r\n`model.add(Conv2D(64, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(Conv2D(256, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(Conv2D(64, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(MaxPooling2D(pool_size=(2, 2)))`\r\n\r\n`model.add(Conv2D(32, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(Conv2D(256, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(Conv2D(256, 3, 3, border_mode='same', activation='relu'))`\r\n`model.add(MaxPooling2D(pool_size=(2, 2)))`\r\n\r\n`model.add(Flatten())`\r\n`model.add(Dense(512,activation='relu'))`\r\n`model.add(Dropout(0.5))`\r\n\r\n`model.add(Dense(128,activation='relu'))`\r\n`model.add(Dropout(0.5))`\r\n\r\n`model.add(Dense(1))`\r\n`model.add(Activation('sigmoid'))`\r\n\r\n`model.compile(loss='binary_crossentropy',\r\n              optimizer=RMSprop(lr=0.0001),\r\n              metrics=['accuracy'])`\r\n\r\n`model.summary()`\r\nThis is my CoreML conversion code:\r\n\r\n`output_labels = ['0', '1']`\r\n\r\n`coreml_model = coremltools.converters.keras.convert('Cats_and_Dogs.h5', input_names=['image'],\r\n                                                    class_labels=output_labels, image_input_names='image',\r\n                                                    output_names=['output'])`\r\n\r\n`print(coreml_model)`\r\n\r\n`coreml_model.author = 'Jaime Miranda'`\r\n`coreml_model.short_description = 'Recognizes between a cat and a dog'`\r\n`coreml_model.input_description['image'] = 'Takes as input an image'`\r\n`coreml_model.output_description['output'] = 'Prediction of metal'`\r\n\r\ncoreml_model.save('Cats_and_Dogs.mlmodel')`\r\nbut when I use implement the converted code on my app, I'm getting this error:\r\n[https://i.stack.imgur.com/s4rY4.png](url)\r\nand this appears on the debug pane: \r\n_Optional(Error Domain=com.apple.vis Code=3 \"The VNCoreMLTransform request failed\" UserInfo={NSLocalizedDescription=The VNCoreMLTransform request failed, NSUnderlyingError=0x60000074cd20 {Error Domain=com.apple.CoreML Code=0 \"The size of the output layer 'output' in the neural network does not match the number of classes in the classifier.\" UserInfo={NSLocalizedDescription=The size of the output layer 'output' in the neural network does not match the number of classes in the classifier.}}})._\r\nAny idea on how to fix this? Thanks!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/523", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/523/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/523/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/523/events", "html_url": "https://github.com/apple/coremltools/issues/523", "id": 525089801, "node_id": "MDU6SXNzdWU1MjUwODk4MDE=", "number": 523, "title": "Making a converted pytorch model trainable", "user": {"login": "johanlantz", "id": 7461655, "node_id": "MDQ6VXNlcjc0NjE2NTU=", "avatar_url": "https://avatars3.githubusercontent.com/u/7461655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johanlantz", "html_url": "https://github.com/johanlantz", "followers_url": "https://api.github.com/users/johanlantz/followers", "following_url": "https://api.github.com/users/johanlantz/following{/other_user}", "gists_url": "https://api.github.com/users/johanlantz/gists{/gist_id}", "starred_url": "https://api.github.com/users/johanlantz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johanlantz/subscriptions", "organizations_url": "https://api.github.com/users/johanlantz/orgs", "repos_url": "https://api.github.com/users/johanlantz/repos", "events_url": "https://api.github.com/users/johanlantz/events{/privacy}", "received_events_url": "https://api.github.com/users/johanlantz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-11-19T15:40:31Z", "updated_at": "2019-11-24T16:02:35Z", "closed_at": "2019-11-24T16:02:35Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a very simple Pytorch model for classification of the Iris dataset:\r\n\r\n\r\n```\r\nclass Model(nn.Module):\r\n  def __init__(self):\r\n    super().__init__()\r\n    self.linear1 = nn.Linear(4, 3)\r\n    self.act1 = nn.ReLU()\r\n    self.linear2 = nn.Linear(3, 3)\r\n\r\n\r\n  def forward(self, x):\r\n    x_ = self.linear1(x)\r\n    x_ = self.act1(x_)\r\n    x_ = self.linear2(x_)\r\n    return x_\r\n```\r\n\r\nI want to run this model with CoreML so I convert it to onnx first and then to CoreML.\r\n\r\nThe predictions work fine but I have not been able to make the model trainable. The output from inspect model is:\r\n```\r\nModel Compilation done.\r\n[Id: 2], Name: 7 (Type: batchedMatmul)\r\n          Updatable: False\r\n          Input blobs: ['6']\r\n          Output blobs: ['7']\r\n[Id: 1], Name: 6 (Type: activation)\r\n          Updatable: False\r\n          Input blobs: ['5']\r\n          Output blobs: ['6']\r\n[Id: 0], Name: 5 (Type: batchedMatmul)\r\n          Updatable: False\r\n          Input blobs: ['input.1']\r\n          Output blobs: ['5']\r\n```\r\n\r\nand then I try to make layer \"7\" updatable but this produces an error:\r\n```\r\nLayer 7 is not supported to be marked as updatable. Only ['innerProduct', 'convolution'] layers are supported to be marked updatable.\r\n```\r\n\r\nThe conversion script I am using is:\r\n```\r\nfrom onnx import onnx_pb\r\nfrom onnx_coreml import convert\r\nimport coremltools\r\n\r\nmodel_file = open(\"iris_model.onnx\", 'rb')\r\nmodel_proto = onnx_pb.ModelProto()\r\nmodel_proto.ParseFromString(model_file.read())\r\n\r\nmlmodel = convert(model_proto, target_ios='13')\r\nmlmodel.save('iris_model.mlmodel')\r\n\r\nspec = coremltools.utils.load_spec(\"iris_model.mlmodel\")\r\n\r\nfor layer_spec in spec.neuralNetwork.layers:\r\n    layer_spec.isUpdatable = False\r\n    \r\nbuilder = coremltools.models.neural_network.NeuralNetworkBuilder(spec=spec)\r\nbuilder.inspect_layers()\r\n\r\nbuilder.make_updatable([\"7\"])\r\ncoremltools.utils.save_spec(builder.spec, \"iris_model.mlmodel\")\r\n```\r\n\r\nand the onnx model can be found here:\r\nhttps://drive.google.com/file/d/16zizB1IR6CXyNtwCkhwrvlnxe1dTDEPk/view?usp=sharing\r\n\r\nSo, from what I understand, the Linear layer in Pytorch ends up as something called batchedMatmul in CoreML and from the error I see that it would have to be innerProduct or convolution. \r\n\r\nIs this the expected behavior? It seems that using Linear from Pytorch would be quite common or?\r\n\r\nIs there any way I can work around this so I can also train on the model coming from Pytorch?\r\n\r\nThanks in advance for any suggestions", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/517", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/517/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/517/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/517/events", "html_url": "https://github.com/apple/coremltools/issues/517", "id": 518478915, "node_id": "MDU6SXNzdWU1MTg0Nzg5MTU=", "number": 517, "title": "Setting epochs to any value other than what is in the model definition prevents training", "user": {"login": "johanlantz", "id": 7461655, "node_id": "MDQ6VXNlcjc0NjE2NTU=", "avatar_url": "https://avatars3.githubusercontent.com/u/7461655?v=4", "gravatar_id": "", "url": "https://api.github.com/users/johanlantz", "html_url": "https://github.com/johanlantz", "followers_url": "https://api.github.com/users/johanlantz/followers", "following_url": "https://api.github.com/users/johanlantz/following{/other_user}", "gists_url": "https://api.github.com/users/johanlantz/gists{/gist_id}", "starred_url": "https://api.github.com/users/johanlantz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/johanlantz/subscriptions", "organizations_url": "https://api.github.com/users/johanlantz/orgs", "repos_url": "https://api.github.com/users/johanlantz/repos", "events_url": "https://api.github.com/users/johanlantz/events{/privacy}", "received_events_url": "https://api.github.com/users/johanlantz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-11-06T13:40:56Z", "updated_at": "2019-11-16T00:59:46Z", "closed_at": "2019-11-16T00:59:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nI have a trainable model converted from Keras. Starting training works fine but when I try to adjust the epochs value, the training fails to start. It seems I can only use the epochs value in the model default parameters. If I manually change the epochs value when converting the model, I can use the new value from my app but no other values are working.\r\n\r\n## To Reproduce\r\nA bootstrapped example can be found here:\r\nhttps://drive.google.com/file/d/1PuBzRLS5WjsxJii4KACW9AL4HFXjeiNM/view?usp=sharing\r\n\r\nFor me, it is sufficient to change the epochs value from the default value 1 to another value here:\r\nconfiguration.parameters = [MLParameterKey.epochs : 1]\r\nin ViewController.swift and the training will not start.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/516", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/516/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/516/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/516/events", "html_url": "https://github.com/apple/coremltools/issues/516", "id": 517907023, "node_id": "MDU6SXNzdWU1MTc5MDcwMjM=", "number": 516, "title": "\"RuntimeError: failed to convert from IR to Core ML.\" error when converting tf.keras to coreml in tensorflow 2.0", "user": {"login": "michaelarfreed", "id": 9046261, "node_id": "MDQ6VXNlcjkwNDYyNjE=", "avatar_url": "https://avatars1.githubusercontent.com/u/9046261?v=4", "gravatar_id": "", "url": "https://api.github.com/users/michaelarfreed", "html_url": "https://github.com/michaelarfreed", "followers_url": "https://api.github.com/users/michaelarfreed/followers", "following_url": "https://api.github.com/users/michaelarfreed/following{/other_user}", "gists_url": "https://api.github.com/users/michaelarfreed/gists{/gist_id}", "starred_url": "https://api.github.com/users/michaelarfreed/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/michaelarfreed/subscriptions", "organizations_url": "https://api.github.com/users/michaelarfreed/orgs", "repos_url": "https://api.github.com/users/michaelarfreed/repos", "events_url": "https://api.github.com/users/michaelarfreed/events{/privacy}", "received_events_url": "https://api.github.com/users/michaelarfreed/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1721362947, "node_id": "MDU6TGFiZWwxNzIxMzYyOTQ3", "url": "https://api.github.com/repos/apple/coremltools/labels/neural%20networks", "name": "neural networks", "color": "ededed", "default": false, "description": ""}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-11-05T17:13:32Z", "updated_at": "2020-02-05T10:57:11Z", "closed_at": "2020-01-17T18:03:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n- A clear and brief description of what the bug is. **I am unable to convert a tf.keras model to coreml in tensorflow 2.0 because of a RuntimeError**\r\n- Is this a converter issue? **Yes.** If yes, please specify which converter (sci-kit, keras, xgboost etc.).  **tensorflow converter, using tf.keras in tensorflow 2.0**\r\n\r\n## Trace\r\n```\r\nAssertionError                            Traceback (most recent call last)\r\n~/anaconda3/envs/myenv/lib/python3.7/site-packages/coremltools/converters/tensorflow/_tf_converter.py in convert(filename, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, **kwargs)\r\n     95                                  custom_shape_functions=custom_shape_functions,\r\n---> 96                                  optional_inputs=optional_inputs)\r\n     97     except ImportError as e:\r\n\r\n~/anaconda3/envs/myenv/lib/python3.7/site-packages/coremltools/converters/nnssa/coreml/ssa_converter.py in ssa_convert(ssa, top_func, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, optional_inputs)\r\n    132     for f in list(ssa.functions.values()):\r\n--> 133         check_connections(f.graph)\r\n    134 \r\n\r\n~/anaconda3/envs/myenv/lib/python3.7/site-packages/coremltools/converters/nnssa/commons/basic_graph_ops.py in check_connections(gd)\r\n    151         for i in v.control_outputs:\r\n--> 152             assert (k in gd[i].control_inputs)\r\n    153 \r\n\r\nAssertionError: \r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nRuntimeError                              Traceback (most recent call last)\r\n<ipython-input-4-d56b125b2b47> in <module>\r\n      4                  output_feature_names= ['output'],\r\n      5                  input_name_shape_dict= {'input': [1,450]},\r\n----> 6                  class_labels=['A','B','C','D','E','F','G']) )\r\n      7\r\n      8\r\n\r\n~/anaconda3/envs/myenv/lib/python3.7/site-packages/coremltools/converters/tensorflow/_tf_converter.py in convert(filename, inputs, outputs, image_input_names, is_bgr, red_bias, green_bias, blue_bias, gray_bias, image_scale, class_labels, predicted_feature_name, predicted_probabilities_output, add_custom_layers, custom_conversion_functions, custom_shape_functions, **kwargs)\r\n     98         raise ImportError('backend converter not found. {}'.format(e))\r\n     99     except Exception as e:\r\n--> 100         raise RuntimeError('failed to convert from IR to Core ML. {}'.format(e))\r\n    101 \r\n    102     return MLModel(model_spec, useCPUOnly=use_cpu_only)\r\n\r\nRuntimeError: failed to convert from IR to Core ML. \r\n```\r\n\r\n\r\n## To Reproduce\r\n- If a python script can reproduce the error, please paste the code snippet\r\n```\r\nimport tensorflow as tf\r\nmymodel = tf.keras.Sequential([ \r\n    tf.keras.layers.Reshape((75,6),input_shape=(6*75,)), \r\n    tf.keras.layers.Dense(500,activation='relu'), \r\n    tf.keras.layers.Flatten(), \r\n    tf.keras.layers.Dense(7,activation='softmax')])  \r\nmymodel.compile(optimizer='adam',loss='categorical_crossentropy')\r\nmymodel.save('/path/to/mymodel.h5',save_format='h5')\r\ncoremltools.converters.tensorflow.convert('/path/to/mymodel.h5',  \r\n                  mlmodel_path='my_model.mlmodel',  \r\n                  output_feature_names= ['output'],   \r\n                  input_name_shape_dict= {'input': [1,450]}, \r\n                  class_labels=['A','B','C','D','E','F','G']))     \r\n```\r\n- If applicable, please attach the source model\r\n    - If the model cannot be shared publicly, please attach it via filing a bug report at https://developer.apple.com/bug-reporting/  and provide the reference number here\r\n**I am not attaching a source model because I can replicate it with any model I train in Keras.**\r\n- If it is a model conversion issue and the conversion succeeds, however, if there is a numerical mismatch between the original and the coreml model, please paste script used for comparison.\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): **3.1**\r\n - OS (e.g., MacOS, Linux): **MacOS**\r\n - macOS version (if applicable): **10.14.16**\r\n - XCode version (if applicable): **N/A**\r\n - How you install python (anaconda, virtualenv, system): **anaconda**\r\n - python version (e.g. 3.7): **3.7**\r\n - any other relevant information:\r\n     **- tensorflow version: 2.0**\r\n\r\n## Additional context\r\n\r\nI was using coremltools converter before. I was training a model in tf.keras (version tf 1.13.1) and then using the keras converter, and it caused no errors. I am migrating to tf 2.0 and this is the last step where I am encountering errors. I have confirmed that my model trains, saves, loads, and validates well, and that the error is coming from the coreml converter step.\r\n\r\n\r\n\r\n-----\r\n\r\n### Update\r\nI did some more digging... I think the Reshape layer is causing the conversion error. When I tried with the following model, I got a different error\r\n\r\n```\r\nmymodel = tf.keras.Sequential([ \r\n    tf.keras.layers.Dense(500,activation='relu',input_shape=(6*75,)), \r\n    tf.keras.layers.Flatten(), \r\n    tf.keras.layers.Dense(7,activation='softmax')])  ])\r\n```\r\n\r\nThe error I got was:\r\n\r\n```\r\n~/anaconda3/envs/myenv/lib/python3.7/site-packages/coremltools/models/model.py:111: RuntimeWarning: You will not be able to run predict() on this Core ML model. Underlying exception message was: Error compiling model: \"Error reading protobuf spec. validator error: The .mlmodel supplied is of version 4, intended for a newer version of Xcode. This version of Xcode supports model version 3 or earlier.\".\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/513", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/513/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/513/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/513/events", "html_url": "https://github.com/apple/coremltools/issues/513", "id": 516530570, "node_id": "MDU6SXNzdWU1MTY1MzA1NzA=", "number": 513, "title": "Convolution kernel uses BNNS, not H11ANE on A12X. How can I fix it?", "user": {"login": "y-ich", "id": 922001, "node_id": "MDQ6VXNlcjkyMjAwMQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/922001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/y-ich", "html_url": "https://github.com/y-ich", "followers_url": "https://api.github.com/users/y-ich/followers", "following_url": "https://api.github.com/users/y-ich/following{/other_user}", "gists_url": "https://api.github.com/users/y-ich/gists{/gist_id}", "starred_url": "https://api.github.com/users/y-ich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/y-ich/subscriptions", "organizations_url": "https://api.github.com/users/y-ich/orgs", "repos_url": "https://api.github.com/users/y-ich/repos", "events_url": "https://api.github.com/users/y-ich/events{/privacy}", "received_events_url": "https://api.github.com/users/y-ich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1721362947, "node_id": "MDU6TGFiZWwxNzIxMzYyOTQ3", "url": "https://api.github.com/repos/apple/coremltools/labels/neural%20networks", "name": "neural networks", "color": "ededed", "default": false, "description": ""}, {"id": 1433388520, "node_id": "MDU6TGFiZWwxNDMzMzg4NTIw", "url": "https://api.github.com/repos/apple/coremltools/labels/perf", "name": "perf", "color": "ededed", "default": false, "description": "Issue is related to performance (type)"}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}, {"id": 1476889522, "node_id": "MDU6TGFiZWwxNDc2ODg5NTIy", "url": "https://api.github.com/repos/apple/coremltools/labels/tf1.x", "name": "tf1.x", "color": "ff8000", "default": false, "description": "Issue could be related to tf framework (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2019-11-02T08:29:10Z", "updated_at": "2020-02-09T06:01:13Z", "closed_at": "2019-12-15T00:26:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \u2753Question\r\nHi.\r\n\r\nI am still working about #485.\r\nThe converted model works correctly but slowly on A12X.\r\nRegardless of a value of usesCPUOnly for prediction, the speeds are same.\r\nAnd Instruments' Profiler shows BNNS is used for convolution kernel, not H11ANE.\r\nHow can I let Core ML to use H11ANE?\r\n\r\nThanks.\r\n\r\n## System Information\r\n- iPad Pro 11-inch\r\n- iPadOS 13.2\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/505", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/505/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/505/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/505/events", "html_url": "https://github.com/apple/coremltools/issues/505", "id": 511661620, "node_id": "MDU6SXNzdWU1MTE2NjE2MjA=", "number": 505, "title": "Custom Title in Spec Visualization", "user": {"login": "TobyRoseman", "id": 5420744, "node_id": "MDQ6VXNlcjU0MjA3NDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5420744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobyRoseman", "html_url": "https://github.com/TobyRoseman", "followers_url": "https://api.github.com/users/TobyRoseman/followers", "following_url": "https://api.github.com/users/TobyRoseman/following{/other_user}", "gists_url": "https://api.github.com/users/TobyRoseman/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobyRoseman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobyRoseman/subscriptions", "organizations_url": "https://api.github.com/users/TobyRoseman/orgs", "repos_url": "https://api.github.com/users/TobyRoseman/repos", "events_url": "https://api.github.com/users/TobyRoseman/events{/privacy}", "received_events_url": "https://api.github.com/users/TobyRoseman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373894, "node_id": "MDU6TGFiZWw2MzczNzM4OTQ=", "url": "https://api.github.com/repos/apple/coremltools/labels/enhancement", "name": "enhancement", "color": "c10f47", "default": true, "description": "Improvement to existing functionality (type)"}, {"id": 1433382939, "node_id": "MDU6TGFiZWwxNDMzMzgyOTM5", "url": "https://api.github.com/repos/apple/coremltools/labels/feature%20request", "name": "feature request", "color": "e7aaff", "default": false, "description": "Functionality does not currently exist, would need to be created as a new feature (type)"}, {"id": 762593401, "node_id": "MDU6TGFiZWw3NjI1OTM0MDE=", "url": "https://api.github.com/repos/apple/coremltools/labels/good%20first%20issue", "name": "good first issue", "color": "7057ff", "default": true, "description": "Issue for a contributor to self-assign and complete"}, {"id": 637373895, "node_id": "MDU6TGFiZWw2MzczNzM4OTU=", "url": "https://api.github.com/repos/apple/coremltools/labels/help%20wanted", "name": "help wanted", "color": "33aa3f", "default": true, "description": "Available to be contributed to by any contributor"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-10-24T02:12:06Z", "updated_at": "2019-10-29T18:18:51Z", "closed_at": "2019-10-29T18:18:51Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "## \ud83c\udf31 Describe your Feature Request\r\nI'm a big fan of the spec visualization built into coremltools (i.e. calling `my_mlmodel.visualize_spec()`). Using this feature has saved me so much time. However when examining multiple specs in different web browser tabs, things can get confusing.\r\n\r\nThe title is **always**: `CoreML Graph Visualization`. This is the title of the tab/webpage, as well as the title displayed in the body, at the top of, the webpage. If you're looking at more than one spec, it's easy to get confused about which one is which.\r\n\r\nI think it would be great if `visualize_spec` took an optional parameter called `title`. The default value for this value could be `\"CoreML Graph Visualization\"`.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/504", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/504/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/504/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/504/events", "html_url": "https://github.com/apple/coremltools/issues/504", "id": 511467039, "node_id": "MDU6SXNzdWU1MTE0NjcwMzk=", "number": 504, "title": "Setup.py should list Linux as a supported OS and include copyright header", "user": {"login": "syoutsey", "id": 410356, "node_id": "MDQ6VXNlcjQxMDM1Ng==", "avatar_url": "https://avatars0.githubusercontent.com/u/410356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/syoutsey", "html_url": "https://github.com/syoutsey", "followers_url": "https://api.github.com/users/syoutsey/followers", "following_url": "https://api.github.com/users/syoutsey/following{/other_user}", "gists_url": "https://api.github.com/users/syoutsey/gists{/gist_id}", "starred_url": "https://api.github.com/users/syoutsey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/syoutsey/subscriptions", "organizations_url": "https://api.github.com/users/syoutsey/orgs", "repos_url": "https://api.github.com/users/syoutsey/repos", "events_url": "https://api.github.com/users/syoutsey/events{/privacy}", "received_events_url": "https://api.github.com/users/syoutsey/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1433418622, "node_id": "MDU6TGFiZWwxNDMzNDE4NjIy", "url": "https://api.github.com/repos/apple/coremltools/labels/docs", "name": "docs", "color": "c10f47", "default": false, "description": "Contains documentation or clarification regarding docs (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-10-23T17:26:16Z", "updated_at": "2020-01-14T18:00:54Z", "closed_at": "2020-01-14T18:00:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\n- The `setup.py` (https://github.com/apple/coremltools/blob/master/setup.py) doesn't list Linux as a compatible OS - it should. Additionally, this file should also have a copyright header.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/503", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/503/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/503/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/503/events", "html_url": "https://github.com/apple/coremltools/issues/503", "id": 511154272, "node_id": "MDU6SXNzdWU1MTExNTQyNzI=", "number": 503, "title": "Error in model conversion", "user": {"login": "zhangxiandong4910", "id": 18300546, "node_id": "MDQ6VXNlcjE4MzAwNTQ2", "avatar_url": "https://avatars0.githubusercontent.com/u/18300546?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhangxiandong4910", "html_url": "https://github.com/zhangxiandong4910", "followers_url": "https://api.github.com/users/zhangxiandong4910/followers", "following_url": "https://api.github.com/users/zhangxiandong4910/following{/other_user}", "gists_url": "https://api.github.com/users/zhangxiandong4910/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhangxiandong4910/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhangxiandong4910/subscriptions", "organizations_url": "https://api.github.com/users/zhangxiandong4910/orgs", "repos_url": "https://api.github.com/users/zhangxiandong4910/repos", "events_url": "https://api.github.com/users/zhangxiandong4910/events{/privacy}", "received_events_url": "https://api.github.com/users/zhangxiandong4910/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-10-23T08:13:56Z", "updated_at": "2019-10-23T09:20:04Z", "closed_at": "2019-10-23T09:20:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\n## System Information\r\nMy code is \r\n\r\n    modelt = Sequential()\r\n    modelt.add(Dense(3, input_dim=12))\r\n\r\n    model = coremltools.converters.keras.convert(modelt)\r\n    model.save('resnet.mlmodel')\r\n\r\nThe content of the error report is\r\n\r\n\r\n  Traceback (most recent call last):\r\n  File \"/Users/zhangxiandong/Desktop/Learning/test.py\", line 56, in <module>\r\n    covertcoreml()\r\n  File \"/Users/zhangxiandong/Desktop/Learning/test.py\", line 48, in covertcoreml\r\n    model = coremltools.converters.keras.convert(modelt)\r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/coremltools/converters/keras/_keras_converter.py\", line 793, in convert\r\n    respect_trainable=respect_trainable)\r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/coremltools/converters/keras/_keras_converter.py\", line 579, in convertToSpec\r\n    respect_trainable=respect_trainable)\r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/coremltools/converters/keras/_keras2_converter.py\", line 326, in _convert\r\n    graph.build()\r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/coremltools/converters/keras/_topology2.py\", line 740, in build\r\n    self.make_input_layers()\r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/coremltools/converters/keras/_topology2.py\", line 169, in make_input_layers\r\n    if isinstance(kl, InputLayer) and kl.input == ts: \r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 765, in __bool__\r\n    self._disallow_bool_casting()\r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 534, in _disallow_bool_casting\r\n    self._disallow_in_graph_mode(\"using a `tf.Tensor` as a Python `bool`\")\r\n  File \"/Users/zhangxiandong/opt/anaconda3/envs/my_ai/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 523, in _disallow_in_graph_mode\r\n    \" this function with @tf.function.\".format(task))\r\ntensorflow.python.framework.errors_impl.OperatorNotAllowedInGraphError: using a `tf.Tensor` as a Python `bool` is not allowed in Graph execution. Use Eager execution or decorate this function with @tf.function.\r\n\r\nThe operating environment is \r\n    # Keras 2.3.1\r\n    # python 3.7\r\n    # tensorflow2.0.0\r\n    # macos 10.15", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/499", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/499/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/499/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/499/events", "html_url": "https://github.com/apple/coremltools/issues/499", "id": 509553280, "node_id": "MDU6SXNzdWU1MDk1NTMyODA=", "number": 499, "title": "broadcast op after NHWC node fails", "user": {"login": "y-ich", "id": 922001, "node_id": "MDQ6VXNlcjkyMjAwMQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/922001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/y-ich", "html_url": "https://github.com/y-ich", "followers_url": "https://api.github.com/users/y-ich/followers", "following_url": "https://api.github.com/users/y-ich/following{/other_user}", "gists_url": "https://api.github.com/users/y-ich/gists{/gist_id}", "starred_url": "https://api.github.com/users/y-ich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/y-ich/subscriptions", "organizations_url": "https://api.github.com/users/y-ich/orgs", "repos_url": "https://api.github.com/users/y-ich/repos", "events_url": "https://api.github.com/users/y-ich/events{/privacy}", "received_events_url": "https://api.github.com/users/y-ich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1721362947, "node_id": "MDU6TGFiZWwxNzIxMzYyOTQ3", "url": "https://api.github.com/repos/apple/coremltools/labels/neural%20networks", "name": "neural networks", "color": "ededed", "default": false, "description": ""}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}, {"id": 1476889522, "node_id": "MDU6TGFiZWwxNDc2ODg5NTIy", "url": "https://api.github.com/repos/apple/coremltools/labels/tf1.x", "name": "tf1.x", "color": "ff8000", "default": false, "description": "Issue could be related to tf framework (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-10-20T06:30:52Z", "updated_at": "2020-01-19T08:35:30Z", "closed_at": "2020-01-17T18:03:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\nIt may be a kind of bug, but before making a bug report, I want to ask a few things since I am confused.\r\nI am trying to convert TensorFlow NHWC model using tf-coreml.\r\nAnd this issue is related with ssa_converter.\r\n\r\nIn my model, there is a broadcast multiplier(XX/XX/mul) of Conv2D(-1, 19, 19, 256) and Rsqrt(256,).\r\nThe first problem is that _broadcastable in shapes.py fails because NHWC node has been transformed to NCHW by transform_nhwc_to_nchw.\r\n\r\nSo I wrote a workaround extended_input_shapes in _broadcastable.\r\nIt works but I encountered another error,\r\n\r\n    ValueError: [SSAConverter] Shape mismatch between inferred (-1, 19, 19, 256) and propagated [-1, 256, 19, 19] for tensor XX/XX/mul\r\n\r\nI read _is_NHWC and I understood that _is_NHWC for XX/XX/mul was False since Rsqrt was not constant so XX/XX/mul stays as NHWC and mismatch happens.\r\n\r\nSo I worte a workaround in _is_NHWC so as to output True for XX/XX/mul.\r\n\r\nThen I got another error in _insert_transpose_to_or_from_nchw for Rsqrt_to_nchw,\r\n\r\n    IndexError: list index out of ranges\r\n\r\nMy approach seems something wrong.\r\nHow can I solve this problem?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/497", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/497/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/497/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/497/events", "html_url": "https://github.com/apple/coremltools/issues/497", "id": 508979162, "node_id": "MDU6SXNzdWU1MDg5NzkxNjI=", "number": 497, "title": "Inference Problem in the converted model", "user": {"login": "kezakool", "id": 45850072, "node_id": "MDQ6VXNlcjQ1ODUwMDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/45850072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kezakool", "html_url": "https://github.com/kezakool", "followers_url": "https://api.github.com/users/kezakool/followers", "following_url": "https://api.github.com/users/kezakool/following{/other_user}", "gists_url": "https://api.github.com/users/kezakool/gists{/gist_id}", "starred_url": "https://api.github.com/users/kezakool/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kezakool/subscriptions", "organizations_url": "https://api.github.com/users/kezakool/orgs", "repos_url": "https://api.github.com/users/kezakool/repos", "events_url": "https://api.github.com/users/kezakool/events{/privacy}", "received_events_url": "https://api.github.com/users/kezakool/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}, {"id": 1564616954, "node_id": "MDU6TGFiZWwxNTY0NjE2OTU0", "url": "https://api.github.com/repos/apple/coremltools/labels/triaged", "name": "triaged", "color": "27bbce", "default": false, "description": "Reviewed and examined, release as been assigned if applicable (status)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-10-18T09:58:33Z", "updated_at": "2019-11-06T23:35:27Z", "closed_at": "2019-11-06T23:35:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\n## \ud83d\udc1eDescribe the bug\r\nThe model is a Keras CNN LSTM with spectrogram inputs and softmax output, the conversion went well, i checked the graph model with visualize_spec and everything seems good too, but when I make a prediction, there is a huge gap in results. I did another try cutting a subgraph before the LSTM layer, and there is still differents results, how is this possible? \r\n\r\n## To Reproduce\r\nFollow this link (https://feedbackassistant.apple.com/feedback/7390376) to apple debugging report, you'll find : \r\n- a notebook to reproduce the procedure\r\n- the keras model and the input sample for debug test\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  : 3.0\r\n - OS (e.g., MacOS, Linux): Macos\r\n - macOS version (if applicable): 10.15 Catalina\r\n - XCode version (if applicable): 11\r\n - How you install python (anaconda, virtualenv, system): virtualenv\r\n - python version (e.g. 3.7): 3.6\r\n - any other relevant information:\r\n     - Keras version 2.2.4\r\n\r\nTell me if I missed something with the link, i m not sure i made it in the app you suggested.\r\nThanks \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/496", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/496/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/496/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/496/events", "html_url": "https://github.com/apple/coremltools/issues/496", "id": 508953348, "node_id": "MDU6SXNzdWU1MDg5NTMzNDg=", "number": 496, "title": "Invalid dst shape when converting from Keras to Coreml", "user": {"login": "ZhengPhoenix", "id": 13959243, "node_id": "MDQ6VXNlcjEzOTU5MjQz", "avatar_url": "https://avatars3.githubusercontent.com/u/13959243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ZhengPhoenix", "html_url": "https://github.com/ZhengPhoenix", "followers_url": "https://api.github.com/users/ZhengPhoenix/followers", "following_url": "https://api.github.com/users/ZhengPhoenix/following{/other_user}", "gists_url": "https://api.github.com/users/ZhengPhoenix/gists{/gist_id}", "starred_url": "https://api.github.com/users/ZhengPhoenix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ZhengPhoenix/subscriptions", "organizations_url": "https://api.github.com/users/ZhengPhoenix/orgs", "repos_url": "https://api.github.com/users/ZhengPhoenix/repos", "events_url": "https://api.github.com/users/ZhengPhoenix/events{/privacy}", "received_events_url": "https://api.github.com/users/ZhengPhoenix/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1721362947, "node_id": "MDU6TGFiZWwxNzIxMzYyOTQ3", "url": "https://api.github.com/repos/apple/coremltools/labels/neural%20networks", "name": "neural networks", "color": "ededed", "default": false, "description": ""}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-10-18T09:10:52Z", "updated_at": "2019-12-09T10:18:55Z", "closed_at": "2019-12-09T10:18:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "## Keras model convert failure with Embedding layer\r\nHello, I was trying to convert a Keras model to coreml,\r\nbut got an error as\r\n>  RuntimeWarning: You will not be able to run predict() on this Core ML model. Underlying exception message was: Error compiling model: \"compiler error:  Invalid dst shape1 x 1 x 64 x 1->399->64 x 400 x 1 x 0 x 1 x \".\r\n\r\nby the way, the Keras model run normally in h5 or even converted to tensorflow model.\r\n\r\nit turns out the failure has something to do with the input length of Input layer\r\nHere is the code which will run successfully,\r\n```\r\ninput_text = layers.Input(shape=(399, ), name='input_text')  << focus on this\r\nemb = layers.Embedding(1000, 64, name='embedding')(input_text)\r\nemb = layers.Reshape([399, 64, 1], name='reshape')(emb)\r\n\r\nmodel = keras.models.Model(inputs=[input_text], outputs=[emb])\r\n\r\n\r\nmodel.save('test.h5')\r\n\r\nconverted = coremltools.converters.keras.convert(model,\r\n                                                 input_names='input_text',\r\n                                                 output_names='reshape')\r\nconverted.save('coreml.mlmodel')\r\n```\r\n\r\nplease focus on the input layer,\r\nwhen I try to modify param with any number bigger than 399, it will throw the issue.\r\n\r\nbellow is the code which can caused the issue,\r\n```\r\ninput_text = layers.Input(shape=(400, ), name='input_text')  << modify here from 399 to 400\r\nemb = layers.Embedding(1000, 64, name='embedding')(input_text)\r\nemb = layers.Reshape([400, 64, 1], name='reshape')(emb) << modify shape as well\r\n\r\nmodel = keras.models.Model(inputs=[input_text], outputs=[emb])\r\n\r\n\r\nmodel.save('test.h5')\r\n\r\nconverted = coremltools.converters.keras.convert(model,\r\n                                                 input_names='input_text',\r\n                                                 output_names='reshape')\r\nconverted.save('coreml.mlmodel')\r\n```\r\n\r\nplease help check this issue,\r\nthe length of input should has nothing to do with model converting progress...I guess.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/495", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/495/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/495/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/495/events", "html_url": "https://github.com/apple/coremltools/issues/495", "id": 508745658, "node_id": "MDU6SXNzdWU1MDg3NDU2NTg=", "number": 495, "title": "API Documentation Not Rendering Math Equations", "user": {"login": "TobyRoseman", "id": 5420744, "node_id": "MDQ6VXNlcjU0MjA3NDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5420744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobyRoseman", "html_url": "https://github.com/TobyRoseman", "followers_url": "https://api.github.com/users/TobyRoseman/followers", "following_url": "https://api.github.com/users/TobyRoseman/following{/other_user}", "gists_url": "https://api.github.com/users/TobyRoseman/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobyRoseman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobyRoseman/subscriptions", "organizations_url": "https://api.github.com/users/TobyRoseman/orgs", "repos_url": "https://api.github.com/users/TobyRoseman/repos", "events_url": "https://api.github.com/users/TobyRoseman/events{/privacy}", "received_events_url": "https://api.github.com/users/TobyRoseman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 1433418622, "node_id": "MDU6TGFiZWwxNDMzNDE4NjIy", "url": "https://api.github.com/repos/apple/coremltools/labels/docs", "name": "docs", "color": "c10f47", "default": false, "description": "Contains documentation or clarification regarding docs (type)"}, {"id": 637373895, "node_id": "MDU6TGFiZWw2MzczNzM4OTU=", "url": "https://api.github.com/repos/apple/coremltools/labels/help%20wanted", "name": "help wanted", "color": "33aa3f", "default": true, "description": "Available to be contributed to by any contributor"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-10-17T22:09:55Z", "updated_at": "2019-12-09T06:10:57Z", "closed_at": "2019-12-09T06:10:56Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nMath equations are not getting rendered on the hosted API docs for coremltools. For example \r\nthe entry for [BatchnormLayerParams](https://apple.github.io/coremltools/coremlspecification/sections/NeuralNetwork.html#batchnormlayerparams) shows:\r\n```\r\ny_i = \\gamma_i \\dfrac{ (x_i - \\mu_i)}{\\sqrt{\\sigma_i^2 + \\epsilon}} + \\beta_i \\;,\\;i=1,....,C\r\n```\r\nThere are many other examples of this problem on the same webpage.\r\n\r\n## System environment\r\n- Safari - Version 13.0.3 (14608.3.10.1.2)\r\n- macOS 10.14.16\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/487", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/487/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/487/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/487/events", "html_url": "https://github.com/apple/coremltools/issues/487", "id": 506357533, "node_id": "MDU6SXNzdWU1MDYzNTc1MzM=", "number": 487, "title": "Not understandable validator error: KNearestNeighborsClassifier requires k to be a positive integer", "user": {"login": "cfinker", "id": 18487157, "node_id": "MDQ6VXNlcjE4NDg3MTU3", "avatar_url": "https://avatars2.githubusercontent.com/u/18487157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cfinker", "html_url": "https://github.com/cfinker", "followers_url": "https://api.github.com/users/cfinker/followers", "following_url": "https://api.github.com/users/cfinker/following{/other_user}", "gists_url": "https://api.github.com/users/cfinker/gists{/gist_id}", "starred_url": "https://api.github.com/users/cfinker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cfinker/subscriptions", "organizations_url": "https://api.github.com/users/cfinker/orgs", "repos_url": "https://api.github.com/users/cfinker/repos", "events_url": "https://api.github.com/users/cfinker/events{/privacy}", "received_events_url": "https://api.github.com/users/cfinker/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-10-13T17:56:25Z", "updated_at": "2019-12-08T07:46:21Z", "closed_at": "2019-12-08T07:46:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\nHi, I tried to create an updatable KNN-model, like described here: https://github.com/apple/coremltools/blob/master/examples/updatable_models/updatable_nearest_neighbor_classifier.ipynb\r\n\r\nHowever, I am getting the following error:\r\n`/Library/Python/2.7/site-packages/coremltools/models/model.py:111: RuntimeWarning: You will not be able to run predict() on this Core ML model. Underlying exception message was: Error compiling model: \"Error reading protobuf spec. validator error: KNearestNeighborsClassifier requires k to be a positive integer.`\r\n\r\nMy actual script for create the KNN model is:\r\n\r\n`number_of_dimensions = 2\r\n\r\nfrom coremltools.models.nearest_neighbors import KNearestNeighborsClassifierBuilder\r\n\r\nbuilder = KNearestNeighborsClassifierBuilder(input_name='input',\r\n                                             output_name='output',\r\n                                             number_of_dimensions=number_of_dimensions,\r\n\t\t\t\t\t     number_of_neighbors=3,\r\n                                             default_class_label='defaultLabel',\r\n                                             weighting_scheme='inverse_distance',\r\n                                             index_type='linear')\r\n\r\nbuilder.author = 'Christian'\r\nbuilder.license = 'MIT'\r\nbuilder.description = 'Classifies {} dimension vector based on 3 nearest neighbors'.format(number_of_dimensions)\r\n\r\nbuilder.spec.description.input[0].shortDescription = 'Input vector to classify'\r\nbuilder.spec.description.output[0].shortDescription = 'Predicted label. Defaults to \\'defaultLabel\\''\r\nbuilder.spec.description.output[1].shortDescription = 'Probabilities / score for each possible label.'\r\n\r\nbuilder.spec.description.trainingInput[0].shortDescription = 'Example input vector'\r\nbuilder.spec.description.trainingInput[1].shortDescription = 'Associated true label of each example vector'\r\n\r\nbuilder.set_number_of_neighbors_with_bounds(3, allowed_range=(1, 10))\r\n\r\nbuilder.set_index_type('kd_tree', 30)\r\n\r\nprint(builder.number_of_dimensions)\r\nprint(builder.number_of_neighbors)\r\nprint(builder.number_of_neighbors_allowed_range())\r\nprint(builder.index_type)\r\n\r\n\r\nmlmodel_updatable_path = './UpdatableKNN.mlmodel'\r\n\r\nfrom coremltools.models import MLModel\r\nmlmodel_updatable = MLModel(builder.spec)\r\nmlmodel_updatable.save(mlmodel_updatable_path)\r\nprint(\"Save model\")\r\n`\r\n\r\n## System Information\r\nI am using the 3.0 release of CoreMLTools.\r\n- OS: Catalina Version 10.15 Beta (19A512f)\r\n- Python: 2.7\r\n\r\nDo you have any hint for me why I am getting this error?\r\nThanks for any hints in advanced. \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/486", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/486/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/486/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/486/events", "html_url": "https://github.com/apple/coremltools/issues/486", "id": 506301265, "node_id": "MDU6SXNzdWU1MDYzMDEyNjU=", "number": 486, "title": "Cann't reduce lossvalue on device?", "user": {"login": "zhao15", "id": 19267035, "node_id": "MDQ6VXNlcjE5MjY3MDM1", "avatar_url": "https://avatars2.githubusercontent.com/u/19267035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhao15", "html_url": "https://github.com/zhao15", "followers_url": "https://api.github.com/users/zhao15/followers", "following_url": "https://api.github.com/users/zhao15/following{/other_user}", "gists_url": "https://api.github.com/users/zhao15/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhao15/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhao15/subscriptions", "organizations_url": "https://api.github.com/users/zhao15/orgs", "repos_url": "https://api.github.com/users/zhao15/repos", "events_url": "https://api.github.com/users/zhao15/events{/privacy}", "received_events_url": "https://api.github.com/users/zhao15/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-10-13T10:02:23Z", "updated_at": "2019-10-14T16:35:51Z", "closed_at": "2019-10-14T16:35:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nI have a keras model could be trained effectively,\r\n```\r\nEpoch 1/20\r\n110/110 [==============================] - 4s 36ms/step - loss: 1.8101 - acc: 0.2545\r\nEpoch 2/20\r\n110/110 [==============================] - 4s 36ms/step - loss: 1.6812 - acc: 0.2727\r\nEpoch 3/20\r\n110/110 [==============================] - 3s 32ms/step - loss: 1.6119 - acc: 0.2818\r\nEpoch 4/20\r\n110/110 [==============================] - 4s 34ms/step - loss: 1.5384 - acc: 0.2818\r\nEpoch 5/20\r\n110/110 [==============================] - 4s 39ms/step - loss: 1.4879 - acc: 0.3818\r\nEpoch 6/20\r\n110/110 [==============================] - 4s 39ms/step - loss: 1.3566 - acc: 0.4273\r\nEpoch 7/20\r\n110/110 [==============================] - 5s 48ms/step - loss: 1.3106 - acc: 0.4273\r\nEpoch 8/20\r\n110/110 [==============================] - 6s 54ms/step - loss: 1.2213 - acc: 0.5273\r\nEpoch 9/20\r\n110/110 [==============================] - 5s 43ms/step - loss: 1.1378 - acc: 0.5455\r\nEpoch 10/20\r\n110/110 [==============================] - 5s 43ms/step - loss: 1.0454 - acc: 0.5909\r\nEpoch 11/20\r\n110/110 [==============================] - 5s 46ms/step - loss: 0.9734 - acc: 0.5818\r\nEpoch 12/20\r\n110/110 [==============================] - 4s 40ms/step - loss: 0.8802 - acc: 0.6818\r\nEpoch 13/20\r\n110/110 [==============================] - 5s 41ms/step - loss: 0.8473 - acc: 0.6545\r\nEpoch 14/20\r\n110/110 [==============================] - 5s 47ms/step - loss: 0.7243 - acc: 0.7182\r\nEpoch 15/20\r\n110/110 [==============================] - 8s 73ms/step - loss: 0.6468 - acc: 0.7455\r\nEpoch 16/20\r\n110/110 [==============================] - 5s 47ms/step - loss: 0.5647 - acc: 0.7818\r\nEpoch 17/20\r\n110/110 [==============================] - 6s 50ms/step - loss: 0.5071 - acc: 0.8000\r\nEpoch 18/20\r\n110/110 [==============================] - 4s 40ms/step - loss: 0.3501 - acc: 0.8727\r\nEpoch 19/20\r\n110/110 [==============================] - 4s 34ms/step - loss: 0.3685 - acc: 0.9000\r\nEpoch 20/20\r\n110/110 [==============================] - 3s 28ms/step - loss: 0.3950 - acc: 0.8909\r\n```\r\nbut after I convert it to mlmodel, and use MLUpdateTask train it on device, the loss value as following:\r\n```\r\nMLUpdateProgressEvent(rawValue: 1)\r\n[:]\r\n[epochs: 10, learningRate: 0.0008, shuffle: 1, miniBatchSize: 1, momentum: 0]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 0, lossValue: 2.294799]\r\n[learningRate: 0.0008, momentum: 0, epochs: 10, miniBatchSize: 1, shuffle: 1]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 1, lossValue: 2.286216]\r\n[learningRate: 0.0008, epochs: 10, momentum: 0, miniBatchSize: 1, shuffle: 1]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[lossValue: 2.277791, epochIndex: 2]\r\n[miniBatchSize: 1, momentum: 0, epochs: 10, shuffle: 1, learningRate: 0.0008]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 3, lossValue: 2.269507]\r\n[momentum: 0, learningRate: 0.0008, miniBatchSize: 1, shuffle: 1, epochs: 10]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 4, lossValue: 2.262939]\r\n[shuffle: 1, epochs: 10, momentum: 0, miniBatchSize: 1, learningRate: 0.0008]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 5, lossValue: 2.252635]\r\n[epochs: 10, shuffle: 1, miniBatchSize: 1, learningRate: 0.0008, momentum: 0]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 6, lossValue: 2.245551]\r\n[shuffle: 1, learningRate: 0.0008, epochs: 10, momentum: 0, miniBatchSize: 1]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 7, lossValue: 2.237811]\r\n[shuffle: 1, epochs: 10, miniBatchSize: 1, momentum: 0, learningRate: 0.0008]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 8, lossValue: 2.230237]\r\n[learningRate: 0.0008, epochs: 10, momentum: 0, miniBatchSize: 1, shuffle: 1]\r\nMLUpdateProgressEvent(rawValue: 2)\r\n[epochIndex: 9, lossValue: 2.224217]\r\n[momentum: 0, miniBatchSize: 1, learningRate: 0.0008, shuffle: 1, epochs: 10]\r\nMLUpdateProgressEvent(rawValue: 0)\r\n[lossValue: 2.224217]\r\n```\r\nCould somebody help me?\r\n\r\nmy convert code is:\r\n`import tensorflow as tf\r\n    from keras.models import load_model\r\n    from keras import utils as np_utils\r\n    \r\n    keras_model = load_model(keras_url)\r\n    classNumber = 10\r\n\r\n    from coremltools.converters import keras as keras_converter\r\n    if iflabelString == True:\r\n        class_l = [\"0\", \"1\", \"2\", \"3\", \"4\",\"5\",\"6\",\"7\",\"8\",\"9\"]\r\n        mlmodel = keras_converter.convert(keras_model, input_names=['image'],\r\n                                output_names=['personProbabilities'],\r\n                                class_labels=class_l,\r\n                                #image_scale=1/255.0, #very important to set data from 0-255 to 0-1\r\n                                #is_bgr=True, #not BGR but RGB\r\n                                predicted_feature_name='person')\r\n \r\n    mlmodel.save(mlmodel_url)\r\n    `\r\nupdatable set code:\r\n\r\n```\r\ndef make_updatable(builder, mlmodel_url, mlmodel_updatable_path,updateLayers = ['dense_1', 'dense_2'], lr= 0.001,epochs = 20):\r\n    import coremltools\r\n    model_spec = builder.spec\r\n    builder.make_updatable(updateLayers)\r\n    builder.set_categorical_cross_entropy_loss(name='lossLayer', input='personProbabilities')\r\n\r\n    from coremltools.models.neural_network import SgdParams\r\n    builder.set_sgd_optimizer(SgdParams(lr= lr, batch=1))\r\n\r\n    builder.set_epochs(epochs)\r\n        \r\n    model_spec.description.trainingInput[0].shortDescription = 'Testing'\r\n    model_spec.description.trainingInput[1].shortDescription = 'Associated true label of example image'\r\n\r\n    from coremltools.models import MLModel\r\n    mlmodel_updatable = MLModel(model_spec)\r\n    mlmodel_updatable.save(mlmodel_updatable_path)\r\n\r\n```\r\n\r\n\r\n## System Information\r\n- Xcode Version 11.2 beta (11B41)\r\n-Package              Version\r\n-------------------- -------\r\nabsl-py              0.8.0  \r\nastor                0.8.0  \r\ncoremltools          3.0b6  \r\nDjango               2.2.5  \r\ngast                 0.2.2  \r\ngoogle-pasta         0.1.7  \r\ngrpcio               1.23.0 \r\nh5py                 2.9.0  \r\nimage                1.5.27 \r\nKeras                2.2.5  \r\nKeras-Applications   1.0.8  \r\nKeras-Preprocessing  1.1.0  \r\nMarkdown             3.1.1  \r\nnumpy                1.17.1 \r\nPillow               6.1.0  \r\npip                  19.2.3 \r\nprotobuf             3.9.1  \r\npytz                 2019.2 \r\nPyYAML               5.1.2  \r\nscipy                1.3.1  \r\nsetuptools           41.2.0 \r\nsix                  1.12.0 \r\nsqlparse             0.3.0  \r\ntensorboard          1.14.0 \r\ntensorflow           1.14.0 \r\ntensorflow-estimator 1.14.0 \r\ntermcolor            1.1.0  \r\ntfcoreml             0.3.0  \r\ntqdm                 4.36.1 \r\nWerkzeug             0.15.6 \r\nwheel                0.33.6 \r\nwrapt                1.11.2 ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/485", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/485/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/485/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/485/events", "html_url": "https://github.com/apple/coremltools/issues/485", "id": 506155119, "node_id": "MDU6SXNzdWU1MDYxNTUxMTk=", "number": 485, "title": "How can I fix \"[TypeInference] Unable to infer type of node \"node/name\" (XXX)?", "user": {"login": "y-ich", "id": 922001, "node_id": "MDQ6VXNlcjkyMjAwMQ==", "avatar_url": "https://avatars2.githubusercontent.com/u/922001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/y-ich", "html_url": "https://github.com/y-ich", "followers_url": "https://api.github.com/users/y-ich/followers", "following_url": "https://api.github.com/users/y-ich/following{/other_user}", "gists_url": "https://api.github.com/users/y-ich/gists{/gist_id}", "starred_url": "https://api.github.com/users/y-ich/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/y-ich/subscriptions", "organizations_url": "https://api.github.com/users/y-ich/orgs", "repos_url": "https://api.github.com/users/y-ich/repos", "events_url": "https://api.github.com/users/y-ich/events{/privacy}", "received_events_url": "https://api.github.com/users/y-ich/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}, {"id": 718619861, "node_id": "MDU6TGFiZWw3MTg2MTk4NjE=", "url": "https://api.github.com/repos/apple/coremltools/labels/repro%20needed", "name": "repro needed", "color": "27bbce", "default": false, "description": "More information or ability to reproduce the issue is needed (status)"}, {"id": 1564616954, "node_id": "MDU6TGFiZWwxNTY0NjE2OTU0", "url": "https://api.github.com/repos/apple/coremltools/labels/triaged", "name": "triaged", "color": "27bbce", "default": false, "description": "Reviewed and examined, release as been assigned if applicable (status)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-10-12T08:36:04Z", "updated_at": "2019-11-06T12:19:33Z", "closed_at": "2019-10-26T01:01:17Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "## \u2753Question\r\n\r\nHi.\r\nI am trying to convert my TensorFlow model using tf-coreml and got errors below for example.\r\n\r\n    [TypeInference] Failed to infer type of node \"XXX/transpose\" (Transpose)\r\n\r\nI investigated type_inference.py and knew that it is due to the lack of \"symbolic_value\" attribute in Transpose' inputs (perm or concat in this case).\r\n\r\nHow can I fix these errors?\r\n\r\nPrior to the errors, I got \"Constant Propagation pass failed\" message.\r\nIs it related with the errors?\r\n\r\nThanks.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/464", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/464/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/464/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/464/events", "html_url": "https://github.com/apple/coremltools/issues/464", "id": 501370746, "node_id": "MDU6SXNzdWU1MDEzNzA3NDY=", "number": 464, "title": "Bidirectinal LSTM input shape issue", "user": {"login": "benkelaci", "id": 6960422, "node_id": "MDQ6VXNlcjY5NjA0MjI=", "avatar_url": "https://avatars0.githubusercontent.com/u/6960422?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benkelaci", "html_url": "https://github.com/benkelaci", "followers_url": "https://api.github.com/users/benkelaci/followers", "following_url": "https://api.github.com/users/benkelaci/following{/other_user}", "gists_url": "https://api.github.com/users/benkelaci/gists{/gist_id}", "starred_url": "https://api.github.com/users/benkelaci/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benkelaci/subscriptions", "organizations_url": "https://api.github.com/users/benkelaci/orgs", "repos_url": "https://api.github.com/users/benkelaci/repos", "events_url": "https://api.github.com/users/benkelaci/events{/privacy}", "received_events_url": "https://api.github.com/users/benkelaci/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-10-02T09:14:31Z", "updated_at": "2019-10-02T12:21:39Z", "closed_at": "2019-10-02T12:21:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nHere is the Keras model definition:\r\n```\r\nlength=42\r\nmodel = Sequential()\r\nmodel.add(Bidirectional(LSTM(100, return_sequences=True), input_shape=(length, 24))\r\nmodel.add(Bidirectional(LSTM(100, return_sequences=True)))\r\nmodel.add(Dense(class_cnt, activation=\"softmax\"))\r\nmodel.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['acc'])\r\n```\r\nI ran the converter:\r\n`coreml_model = converters.keras.convert('model.h5', input_shapes=(1, 42, 24))`\r\n\r\nThen I got this for the input layer:\r\n```\r\n0 : lstm_1_input, <keras.engine.topology.InputLayer object at 0x7f6b18318198>\r\n1 : lstm_1, <keras.layers.recurrent.LSTM object at 0x7f6b18318160>\r\n2 : lstm_2, <keras.layers.recurrent.LSTM object at 0x7f6b18318550>\r\n3 : dense_1, <keras.layers.core.Dense object at 0x7f6b18318438>\r\n4 : dense_1__activation__, <keras.layers.core.Activation object at 0x7f6a84661e10>\r\ninput {\r\n  name: \"input1\"\r\n  type {\r\n    multiArrayType {\r\n      shape: 24\r\n      dataType: DOUBLE\r\n    }\r\n  }\r\n}\r\ninput {\r\n  name: \"lstm_1_h_in\"\r\n...\r\n```\r\n\r\nBut it should be this:\r\n ```\r\n multiArrayType {\r\n      shape: 1\r\n      shape: 42\r\n      shape: 24\r\n      dataType: DOUBLE\r\n    }\r\n\r\n```\r\n\r\nHow can I force to reshape the input or interpret as different ?\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 3.0b6\r\n - OS (e.g., MacOS, Linux): Ubuntu\r\n - macOS version (if applicable):\r\n - XCode version (if applicable):\r\n - How you install python (anaconda, virtualenv, system): system\r\n - python version (e.g. 3.7): 3.5.2\r\n - any other relevant information:\r\n     - Keras==2.1.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/463", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/463/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/463/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/463/events", "html_url": "https://github.com/apple/coremltools/issues/463", "id": 501347771, "node_id": "MDU6SXNzdWU1MDEzNDc3NzE=", "number": 463, "title": "Coreml Pipeline with preprocessing example", "user": {"login": "kezakool", "id": 45850072, "node_id": "MDQ6VXNlcjQ1ODUwMDcy", "avatar_url": "https://avatars2.githubusercontent.com/u/45850072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kezakool", "html_url": "https://github.com/kezakool", "followers_url": "https://api.github.com/users/kezakool/followers", "following_url": "https://api.github.com/users/kezakool/following{/other_user}", "gists_url": "https://api.github.com/users/kezakool/gists{/gist_id}", "starred_url": "https://api.github.com/users/kezakool/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kezakool/subscriptions", "organizations_url": "https://api.github.com/users/kezakool/orgs", "repos_url": "https://api.github.com/users/kezakool/repos", "events_url": "https://api.github.com/users/kezakool/events{/privacy}", "received_events_url": "https://api.github.com/users/kezakool/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1564616671, "node_id": "MDU6TGFiZWwxNTY0NjE2Njcx", "url": "https://api.github.com/repos/apple/coremltools/labels/investigation", "name": "investigation", "color": "27bbce", "default": false, "description": "Being looked into in order to complete (status)"}, {"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-10-02T08:25:51Z", "updated_at": "2019-10-10T17:11:22Z", "closed_at": "2019-10-10T17:11:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\ni'm using coremltools  beta release 3.0b5, trying to convert from keras to coreml3.\r\nthe conversion of my model went well but I would like to use the SoundAnalysisPreprocessing model. (I already have implemented the same preprocessing step in my python project)\r\n\r\nI can't find an example of building a pipeline with a coreml preprocessing model, could you provide us any exmple?\r\n\r\nfor now, i'm stuck into this : \r\n\r\nsave_model_path = os.path.join(config.freeze_path, \"keras_cnnlstm_greedy_perf_82.mlmodel\")\r\nmlmodel = coremltools.models.MLModel(save_model_path)\r\n#mlmodel = coremltools.models.MLModel('path/to/the/model.mlmodel')\r\n\r\ninput_audio = [('audio', coremltools.models.datatypes.Array(*(1,15600)))]\r\noutput_feature = [('output', coremltools.models.datatypes.Array(*(1,2)))]\r\npipeline = coremltools.models.pipeline.Pipeline(input_audio , output_feature)\r\n\r\nsound_model = soundAnalysisPreprocessing.SoundAnalysisPreprocessing()\r\n\r\npipeline.add_model(sound_model)\r\n\r\ngiving me this error :\r\nTypeError: Parameter to CopyFrom() must be instance of same class: expected CoreML.Specification.Model got CoreML.Specification.CoreMLModels.SoundAnalysisPreprocessing.\r\n\r\nMany thanks\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/462", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/462/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/462/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/462/events", "html_url": "https://github.com/apple/coremltools/issues/462", "id": 499893782, "node_id": "MDU6SXNzdWU0OTk4OTM3ODI=", "number": 462, "title": "using a `tf.Tensor` as a Python `bool` is not allowed in Graph execution. Use Eager execution or decorate this function with @tf.function.", "user": {"login": "zhao15", "id": 19267035, "node_id": "MDQ6VXNlcjE5MjY3MDM1", "avatar_url": "https://avatars2.githubusercontent.com/u/19267035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhao15", "html_url": "https://github.com/zhao15", "followers_url": "https://api.github.com/users/zhao15/followers", "following_url": "https://api.github.com/users/zhao15/following{/other_user}", "gists_url": "https://api.github.com/users/zhao15/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhao15/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhao15/subscriptions", "organizations_url": "https://api.github.com/users/zhao15/orgs", "repos_url": "https://api.github.com/users/zhao15/repos", "events_url": "https://api.github.com/users/zhao15/events{/privacy}", "received_events_url": "https://api.github.com/users/zhao15/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-29T10:01:20Z", "updated_at": "2019-10-14T17:13:40Z", "closed_at": "2019-10-14T17:13:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nwhen I use coremltools convert the keras model(1st Updatable Models Examples) to mlmodel, the error shows up.\r\n\r\n## Trace\r\nFile \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/coremltools/converters/keras/_keras_converter.py\", line 793, in convert\r\n    respect_trainable=respect_trainable)\r\n  File \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/coremltools/converters/keras/_keras_converter.py\", line 579, in convertToSpec\r\n    respect_trainable=respect_trainable)\r\n  File \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/coremltools/converters/keras/_keras2_converter.py\", line 326, in _convert\r\n    graph.build()\r\n  File \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/coremltools/converters/keras/_topology2.py\", line 740, in build\r\n    self.make_input_layers()\r\n  File \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/coremltools/converters/keras/_topology2.py\", line 169, in make_input_layers\r\n    if isinstance(kl, InputLayer) and kl.input == ts: \r\n  File \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 765, in __bool__\r\n    self._disallow_bool_casting()\r\n  File \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 534, in _disallow_bool_casting\r\n    self._disallow_in_graph_mode(\"using a `tf.Tensor` as a Python `bool`\")\r\n  File \"/Users/wills/virtualenv/Python3.7/TensorFlow/lib/python3.7/site-packages/tensorflow_core/python/framework/ops.py\", line 523, in _disallow_in_graph_mode\r\n    \" this function with @tf.function.\".format(task))\r\ntensorflow.python.framework.errors_impl.OperatorNotAllowedInGraphError: using a `tf.Tensor` as a Python `bool` is not allowed in Graph execution. Use Eager execution or decorate this function with @tf.function.\r\n\r\n\r\n# Paste code snippet here\r\n```\r\nmlmodel = keras_converter.convert(keras_model, input_names=['image'],\r\n                                output_names=['personProbabilities'],\r\n                                class_labels=class_labels,\r\n                                predicted_feature_name='person')\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5):\r\n - OS (MacOS):\r\n - macOS version (10.15 19A573a):\r\n - XCode version (11 11A419c):\r\n - How you install python (virtualenv):\r\n    Package              Version             \r\n-------------------- --------------------\r\nabsl-py              0.7.0               \r\nappnope              0.1.0               \r\nastor                0.7.1               \r\nattrs                19.1.0              \r\nbackcall             0.1.0               \r\nbleach               3.1.0               \r\ncoremltools          3.0b6               \r\ndecorator            4.3.2               \r\ndefusedxml           0.5.0               \r\nentrypoints          0.3                 \r\ngast                 0.2.2               \r\ngoogle-pasta         0.1.7               \r\ngrpcio               1.19.0              \r\nh5py                 2.9.0               \r\nipykernel            5.1.0               \r\nipython              7.3.0               \r\nipython-genutils     0.2.0               \r\nipywidgets           7.4.2               \r\njedi                 0.13.3              \r\nJinja2               2.10                \r\njsonschema           3.0.1               \r\njupyter              1.0.0               \r\njupyter-client       5.2.4               \r\njupyter-console      6.0.0               \r\njupyter-core         4.4.0               \r\nKeras                2.3.0               \r\nKeras-Applications   1.0.8               \r\nKeras-Preprocessing  1.1.0               \r\nList                 1.3.0               \r\nMarkdown             3.0.1               \r\nMarkupSafe           1.1.1               \r\nmistune              0.8.4               \r\nmock                 2.0.0               \r\nnbconvert            5.4.1               \r\nnbformat             4.4.0               \r\nnotebook             5.7.4               \r\nnumpy                1.16.2              \r\nopt-einsum           3.0.1               \r\npandocfilters        1.4.2               \r\nparso                0.3.4               \r\npbr                  5.1.3               \r\npexpect              4.6.0               \r\npickleshare          0.7.5               \r\npip                  19.2.3              \r\nprometheus-client    0.6.0               \r\nprompt-toolkit       2.0.9               \r\nprotobuf             3.7.0               \r\nptyprocess           0.6.0               \r\nPygments             2.3.1               \r\npyrsistent           0.14.11             \r\npython-dateutil      2.8.0               \r\nPyYAML               5.1.2               \r\npyzmq                18.0.0              \r\nqtconsole            4.4.3               \r\nscipy                1.3.1               \r\nSend2Trash           1.5.0               \r\nsetuptools           41.2.0              \r\nsix                  1.12.0              \r\nstyle                1.1.0               \r\ntb-nightly           1.14.0a20190603     \r\ntensorboard          2.0.0               \r\ntensorflow           2.0.0rc2            \r\ntensorflow-estimator 1.13.0              \r\ntermcolor            1.1.0               \r\nterminado            0.8.1               \r\ntestpath             0.4.2               \r\ntf-estimator-nightly 1.14.0.dev2019080601\r\ntfcoreml             0.4.0b1             \r\ntornado              6.0                 \r\ntraitlets            4.3.2               \r\nupdate               0.0.1               \r\nwcwidth              0.1.7               \r\nwebencodings         0.5.1               \r\nWerkzeug             0.14.1              \r\nwheel                0.33.1              \r\nwidgetsnbextension   3.4.2               \r\nwrapt                1.11.2   \r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/456", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/456/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/456/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/456/events", "html_url": "https://github.com/apple/coremltools/issues/456", "id": 496090480, "node_id": "MDU6SXNzdWU0OTYwOTA0ODA=", "number": 456, "title": "Wrong numpy range in setup.py", "user": {"login": "TobyRoseman", "id": 5420744, "node_id": "MDQ6VXNlcjU0MjA3NDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5420744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobyRoseman", "html_url": "https://github.com/TobyRoseman", "followers_url": "https://api.github.com/users/TobyRoseman/followers", "following_url": "https://api.github.com/users/TobyRoseman/following{/other_user}", "gists_url": "https://api.github.com/users/TobyRoseman/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobyRoseman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobyRoseman/subscriptions", "organizations_url": "https://api.github.com/users/TobyRoseman/orgs", "repos_url": "https://api.github.com/users/TobyRoseman/repos", "events_url": "https://api.github.com/users/TobyRoseman/events{/privacy}", "received_events_url": "https://api.github.com/users/TobyRoseman/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373892, "node_id": "MDU6TGFiZWw2MzczNzM4OTI=", "url": "https://api.github.com/repos/apple/coremltools/labels/bug", "name": "bug", "color": "c10f47", "default": true, "description": "Unexpected behaviour that should be corrected (type)"}, {"id": 637373895, "node_id": "MDU6TGFiZWw2MzczNzM4OTU=", "url": "https://api.github.com/repos/apple/coremltools/labels/help%20wanted", "name": "help wanted", "color": "33aa3f", "default": true, "description": "Available to be contributed to by any contributor"}], "state": "closed", "locked": false, "assignee": {"login": "TobyRoseman", "id": 5420744, "node_id": "MDQ6VXNlcjU0MjA3NDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5420744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobyRoseman", "html_url": "https://github.com/TobyRoseman", "followers_url": "https://api.github.com/users/TobyRoseman/followers", "following_url": "https://api.github.com/users/TobyRoseman/following{/other_user}", "gists_url": "https://api.github.com/users/TobyRoseman/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobyRoseman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobyRoseman/subscriptions", "organizations_url": "https://api.github.com/users/TobyRoseman/orgs", "repos_url": "https://api.github.com/users/TobyRoseman/repos", "events_url": "https://api.github.com/users/TobyRoseman/events{/privacy}", "received_events_url": "https://api.github.com/users/TobyRoseman/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "TobyRoseman", "id": 5420744, "node_id": "MDQ6VXNlcjU0MjA3NDQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/5420744?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobyRoseman", "html_url": "https://github.com/TobyRoseman", "followers_url": "https://api.github.com/users/TobyRoseman/followers", "following_url": "https://api.github.com/users/TobyRoseman/following{/other_user}", "gists_url": "https://api.github.com/users/TobyRoseman/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobyRoseman/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobyRoseman/subscriptions", "organizations_url": "https://api.github.com/users/TobyRoseman/orgs", "repos_url": "https://api.github.com/users/TobyRoseman/repos", "events_url": "https://api.github.com/users/TobyRoseman/events{/privacy}", "received_events_url": "https://api.github.com/users/TobyRoseman/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 17, "created_at": "2019-09-20T00:58:52Z", "updated_at": "2020-02-01T07:36:15Z", "closed_at": "2020-02-01T07:36:15Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "## \ud83d\udc1eDescribe the bug\r\nThe [setup.py](https://github.com/apple/coremltools/blob/2350efac7a8bc00d923610ac81dbe7ab6ac9778f/setup.py#L55) for coremltools specifies the numpy dependency range as `'numpy >= 1.14.5'`. However using any version before then `1.16.0` causes a segmentation fault. Any version >= to `1.16.0` works. \r\n\r\nIt would be nice to support versions before `1.16.0`. That version is less than a year old. However at the very least the specified dependency ranges should be accurate.\r\n\r\n## Trace\r\nNo trace displayed. Only output is `Segmentation fault: 11`\r\n\r\n## To Reproduce\r\nIn a fresh/new Conda environment, run:\r\n`pip install Pillow coremltools==3.0b6 numpy==1.15.4`\r\n\r\nDownload the [MNIST Model](https://developer.apple.com/machine-learning/models/).\r\n\r\nExecute the following code:\r\n```python\r\nimport coremltools\r\nfrom PIL import Image\r\nimport numpy as np\r\n\r\ndata = np.empty((28,28), dtype=np.uint8)\r\ninput_image = Image.fromarray(data)\r\n\r\nmodel = coremltools.models.MLModel('./Downloads/MNISTClassifier.mlmodel')\r\nprint(model.predict({'image': input_image}))\r\n```\r\nThis give a segmentation fault.\r\n\r\nIf you then run `pip install numpy==1.16.0`, then the above code works.\r\n\r\n## System environment (please complete the following information):\r\n - coremltools version  (e.g., 3.0b5): 3.0b6\r\n - OS (e.g., MacOS, Linux): MacOS\r\n - macOS version (if applicable): 10.14.6\r\n - XCode version (if applicable): Not using\r\n - How you install python (anaconda, virtualenv, system): anaconda \r\n - python version (e.g. 3.7): 3.6\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/446", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/446/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/446/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/446/events", "html_url": "https://github.com/apple/coremltools/issues/446", "id": 490788646, "node_id": "MDU6SXNzdWU0OTA3ODg2NDY=", "number": 446, "title": "Add tf.keras support ", "user": {"login": "aseemw", "id": 7546478, "node_id": "MDQ6VXNlcjc1NDY0Nzg=", "avatar_url": "https://avatars1.githubusercontent.com/u/7546478?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aseemw", "html_url": "https://github.com/aseemw", "followers_url": "https://api.github.com/users/aseemw/followers", "following_url": "https://api.github.com/users/aseemw/following{/other_user}", "gists_url": "https://api.github.com/users/aseemw/gists{/gist_id}", "starred_url": "https://api.github.com/users/aseemw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aseemw/subscriptions", "organizations_url": "https://api.github.com/users/aseemw/orgs", "repos_url": "https://api.github.com/users/aseemw/repos", "events_url": "https://api.github.com/users/aseemw/events{/privacy}", "received_events_url": "https://api.github.com/users/aseemw/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1433382939, "node_id": "MDU6TGFiZWwxNDMzMzgyOTM5", "url": "https://api.github.com/repos/apple/coremltools/labels/feature%20request", "name": "feature request", "color": "e7aaff", "default": false, "description": "Functionality does not currently exist, would need to be created as a new feature (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}, {"id": 1564616954, "node_id": "MDU6TGFiZWwxNTY0NjE2OTU0", "url": "https://api.github.com/repos/apple/coremltools/labels/triaged", "name": "triaged", "color": "27bbce", "default": false, "description": "Reviewed and examined, release as been assigned if applicable (status)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-09-08T18:43:32Z", "updated_at": "2019-11-06T23:14:50Z", "closed_at": "2019-11-06T23:14:50Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "## \ud83c\udf31 Describe your Feature Request\r\nSupport for models created and saved via the `tf.keras` API.\r\n\r\n## Use cases\r\n`tf.keras` is the recommended API to be used with TensorFlow 2.0+\r\n\r\n## Describe alternatives you've considered\r\n- Directly using the `coremltools.converters.keras` converter\r\n- Saving the model as a frozen graph def (`.pb`) file and then using the `tfcoreml` converter\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/445", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/445/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/445/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/445/events", "html_url": "https://github.com/apple/coremltools/issues/445", "id": 490625383, "node_id": "MDU6SXNzdWU0OTA2MjUzODM=", "number": 445, "title": "ValueError: Keras layer '<class 'tensorflow.python.keras.layers.convolutional.Conv2D'>' not supported. ", "user": {"login": "zhao15", "id": 19267035, "node_id": "MDQ6VXNlcjE5MjY3MDM1", "avatar_url": "https://avatars2.githubusercontent.com/u/19267035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhao15", "html_url": "https://github.com/zhao15", "followers_url": "https://api.github.com/users/zhao15/followers", "following_url": "https://api.github.com/users/zhao15/following{/other_user}", "gists_url": "https://api.github.com/users/zhao15/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhao15/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhao15/subscriptions", "organizations_url": "https://api.github.com/users/zhao15/orgs", "repos_url": "https://api.github.com/users/zhao15/repos", "events_url": "https://api.github.com/users/zhao15/events{/privacy}", "received_events_url": "https://api.github.com/users/zhao15/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-07T11:34:36Z", "updated_at": "2019-10-05T00:44:54Z", "closed_at": "2019-10-05T00:44:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "## \u2753Question\r\nwhen I convert keras model to mlmodel, got the error as:\r\nValueError: Keras layer '<class 'tensorflow.python.keras.layers.convolutional.Conv2D'>' not supported. \r\nhow to resolve it?\r\nthanks\r\n## System Information\r\n- tensorflow 2.0 coremltools3.0 python3.7 \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/441", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/441/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/441/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/441/events", "html_url": "https://github.com/apple/coremltools/issues/441", "id": 489876955, "node_id": "MDU6SXNzdWU0ODk4NzY5NTU=", "number": 441, "title": "ValueError: Keras layer '<class 'tensorflow.python.keras.layers.core.Flatten'>' not supported. ", "user": {"login": "zhao15", "id": 19267035, "node_id": "MDQ6VXNlcjE5MjY3MDM1", "avatar_url": "https://avatars2.githubusercontent.com/u/19267035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhao15", "html_url": "https://github.com/zhao15", "followers_url": "https://api.github.com/users/zhao15/followers", "following_url": "https://api.github.com/users/zhao15/following{/other_user}", "gists_url": "https://api.github.com/users/zhao15/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhao15/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhao15/subscriptions", "organizations_url": "https://api.github.com/users/zhao15/orgs", "repos_url": "https://api.github.com/users/zhao15/repos", "events_url": "https://api.github.com/users/zhao15/events{/privacy}", "received_events_url": "https://api.github.com/users/zhao15/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-05T16:40:10Z", "updated_at": "2019-10-05T00:45:31Z", "closed_at": "2019-10-05T00:45:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying convert the TensorFlow Keras model to coreml model, but I got the error:\r\nValueError: Keras layer '<class 'tensorflow.python.keras.layers.core.Flatten'>' not supported. \r\n\r\ncoremltools3.0b5 TensorFlow 2.0.0beta0 with python3.7.4 in virtualenv in macOS.\r\n\r\nhow to resolve it? thanks", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/440", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/440/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/440/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/440/events", "html_url": "https://github.com/apple/coremltools/issues/440", "id": 489465751, "node_id": "MDU6SXNzdWU0ODk0NjU3NTE=", "number": 440, "title": "\u2019module' object has no attribute 'convert'.", "user": {"login": "zhao15", "id": 19267035, "node_id": "MDQ6VXNlcjE5MjY3MDM1", "avatar_url": "https://avatars2.githubusercontent.com/u/19267035?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhao15", "html_url": "https://github.com/zhao15", "followers_url": "https://api.github.com/users/zhao15/followers", "following_url": "https://api.github.com/users/zhao15/following{/other_user}", "gists_url": "https://api.github.com/users/zhao15/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhao15/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhao15/subscriptions", "organizations_url": "https://api.github.com/users/zhao15/orgs", "repos_url": "https://api.github.com/users/zhao15/repos", "events_url": "https://api.github.com/users/zhao15/events{/privacy}", "received_events_url": "https://api.github.com/users/zhao15/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-05T00:17:43Z", "updated_at": "2019-09-05T16:35:51Z", "closed_at": "2019-09-05T16:35:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am facing the following  problem and waiting for a solution when I try to convert my keras model into mlmodel using coremltools. it is saying that coremltools module has no attribute 'convert'.\r\n\r\nAttributeError: 'module' object has no attribute 'convert'.\r\nThe line is:\r\n\r\n\r\n    coreml_model = coremltools.converters.keras.convert(\r\n        model=Mymodel,\r\n        input_names=\"image\",\r\n        output_names=\"image\",\r\n        class_labels=labels)\r\n\r\nMy coremltools is 3.0b5 and tensorflow is 2.0.0beta0 in virtualenv with python3.7 in macOS.\r\nThanks.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/439", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/439/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/439/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/439/events", "html_url": "https://github.com/apple/coremltools/issues/439", "id": 488995257, "node_id": "MDU6SXNzdWU0ODg5OTUyNTc=", "number": 439, "title": "[feature request] Compatibility with tensorflow.keras (.h5 / savedmodel)", "user": {"login": "kevin970401", "id": 21012945, "node_id": "MDQ6VXNlcjIxMDEyOTQ1", "avatar_url": "https://avatars0.githubusercontent.com/u/21012945?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kevin970401", "html_url": "https://github.com/kevin970401", "followers_url": "https://api.github.com/users/kevin970401/followers", "following_url": "https://api.github.com/users/kevin970401/following{/other_user}", "gists_url": "https://api.github.com/users/kevin970401/gists{/gist_id}", "starred_url": "https://api.github.com/users/kevin970401/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kevin970401/subscriptions", "organizations_url": "https://api.github.com/users/kevin970401/orgs", "repos_url": "https://api.github.com/users/kevin970401/repos", "events_url": "https://api.github.com/users/kevin970401/events{/privacy}", "received_events_url": "https://api.github.com/users/kevin970401/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1433382939, "node_id": "MDU6TGFiZWwxNDMzMzgyOTM5", "url": "https://api.github.com/repos/apple/coremltools/labels/feature%20request", "name": "feature request", "color": "e7aaff", "default": false, "description": "Functionality does not currently exist, would need to be created as a new feature (type)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-09-04T07:42:06Z", "updated_at": "2019-11-06T23:18:56Z", "closed_at": "2019-11-06T23:18:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "I trained models composed of tensorflow.keras layers. but It seems to me that there is no simple way to convert the tensorflow.keras model to coreml.\r\nI can convert the tensorflow.keras to keras and then re-convert keras to coreml but it is not efficient way.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/436", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/436/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/436/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/436/events", "html_url": "https://github.com/apple/coremltools/issues/436", "id": 488839866, "node_id": "MDU6SXNzdWU0ODg4Mzk4NjY=", "number": 436, "title": "Keras error with model conversion / NASNet", "user": {"login": "vade", "id": 65011, "node_id": "MDQ6VXNlcjY1MDEx", "avatar_url": "https://avatars1.githubusercontent.com/u/65011?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vade", "html_url": "https://github.com/vade", "followers_url": "https://api.github.com/users/vade/followers", "following_url": "https://api.github.com/users/vade/following{/other_user}", "gists_url": "https://api.github.com/users/vade/gists{/gist_id}", "starred_url": "https://api.github.com/users/vade/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vade/subscriptions", "organizations_url": "https://api.github.com/users/vade/orgs", "repos_url": "https://api.github.com/users/vade/repos", "events_url": "https://api.github.com/users/vade/events{/privacy}", "received_events_url": "https://api.github.com/users/vade/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373893, "node_id": "MDU6TGFiZWw2MzczNzM4OTM=", "url": "https://api.github.com/repos/apple/coremltools/labels/duplicate", "name": "duplicate", "color": "27bbce", "default": true, "description": "Status: Progress will be shown on similar, previously logged issue (status)"}, {"id": 1539237861, "node_id": "MDU6TGFiZWwxNTM5MjM3ODYx", "url": "https://api.github.com/repos/apple/coremltools/labels/tf2.x%20/%20tf.keras", "name": "tf2.x / tf.keras", "color": "ff8000", "default": false, "description": "Issue could be related to tf2.x where coremltools isn't supported (component)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-09-03T21:46:00Z", "updated_at": "2019-11-06T23:18:26Z", "closed_at": "2019-11-06T23:18:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "Using `coremltools==3.0b5` via Google Collab with Tensorflow 1.14, trying to export trained model / h5.\r\n\r\nThe following code nets this error:\r\n\r\n```ValueError: ('Invalid `distribution` argument: expected one of {\"normal\", \"uniform\"} but got', 'truncated_normal')```\r\n\r\nFrom:\r\n\r\n``` model = coremltools.converters.keras.convert(\t\r\n\t\t\t\t\t\t\t\t\t\tmodel=model_path,\r\n\t\t\t\t\t\t\t\t\t\tinput_names=\"NASNet_input\",\r\n\t\t\t\t\t\t\t\t\t\timage_input_names=\"NASNet_input\",\r\n\t\t\t\t\t\t\t\t\t\tinput_name_shape_dict = {'NASNet_input' : [1,224,224,3]},\r\n\t\t\t\t\t\t\t\t\t\tis_bgr=False,\r\n\t\t\t\t\t\t\t\t\t\tred_bias=-1,\r\n\t\t\t\t\t\t\t\t\t\tgreen_bias=-1,\r\n\t\t\t\t\t\t\t\t\t\tblue_bias=-1,\r\n\t\t\t\t\t\t\t\t\t\timage_scale=2.0/255.0, \r\n\t\t\t\t\t\t\t\t\t\toutput_names=\"output/Sigmoid\",\r\n\t\t\t\t\t\t\t\t\t\t)\r\n```\r\n\r\nIve checked my input and output names via: \r\n\r\n```\r\nmodel = tf.keras.models.load_model(model_path, compile=False)\r\n[print(node.op.name) for node in model.inputs]\r\n[print(node.op.name) for node in model.outputs]\r\n```\r\n\r\nIs this a coremltools error? \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/431", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/431/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/431/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/431/events", "html_url": "https://github.com/apple/coremltools/issues/431", "id": 486218625, "node_id": "MDU6SXNzdWU0ODYyMTg2MjU=", "number": 431, "title": "Cant save on device updated trained model", "user": {"login": "BhavinSuthar", "id": 54391383, "node_id": "MDQ6VXNlcjU0MzkxMzgz", "avatar_url": "https://avatars0.githubusercontent.com/u/54391383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BhavinSuthar", "html_url": "https://github.com/BhavinSuthar", "followers_url": "https://api.github.com/users/BhavinSuthar/followers", "following_url": "https://api.github.com/users/BhavinSuthar/following{/other_user}", "gists_url": "https://api.github.com/users/BhavinSuthar/gists{/gist_id}", "starred_url": "https://api.github.com/users/BhavinSuthar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BhavinSuthar/subscriptions", "organizations_url": "https://api.github.com/users/BhavinSuthar/orgs", "repos_url": "https://api.github.com/users/BhavinSuthar/repos", "events_url": "https://api.github.com/users/BhavinSuthar/events{/privacy}", "received_events_url": "https://api.github.com/users/BhavinSuthar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 24, "created_at": "2019-08-28T07:58:52Z", "updated_at": "2019-09-18T17:31:03Z", "closed_at": "2019-09-12T06:07:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "Trying to save model to support directory\r\n`try  model.write(to: permanentUrl)`\r\n\r\n-  Cant save the model\r\n#  `Error Domain=com.apple.CoreML Code=6 \"Failed to save model to <file path>`\r\n**UserInfo={NSLocalizedDescription=Failed to save model to <PATH-TO_MODEL>model.mlmodelc. This issue may occur when saving a dense layer that does not contain a bias, if this is the case please file a bug report.**", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/430", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/430/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/430/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/430/events", "html_url": "https://github.com/apple/coremltools/issues/430", "id": 485535261, "node_id": "MDU6SXNzdWU0ODU1MzUyNjE=", "number": 430, "title": "Specify saving as version 3, not version 4", "user": {"login": "jbmaxwell", "id": 15166432, "node_id": "MDQ6VXNlcjE1MTY2NDMy", "avatar_url": "https://avatars3.githubusercontent.com/u/15166432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jbmaxwell", "html_url": "https://github.com/jbmaxwell", "followers_url": "https://api.github.com/users/jbmaxwell/followers", "following_url": "https://api.github.com/users/jbmaxwell/following{/other_user}", "gists_url": "https://api.github.com/users/jbmaxwell/gists{/gist_id}", "starred_url": "https://api.github.com/users/jbmaxwell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jbmaxwell/subscriptions", "organizations_url": "https://api.github.com/users/jbmaxwell/orgs", "repos_url": "https://api.github.com/users/jbmaxwell/repos", "events_url": "https://api.github.com/users/jbmaxwell/events{/privacy}", "received_events_url": "https://api.github.com/users/jbmaxwell/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-27T01:41:48Z", "updated_at": "2019-08-27T02:02:26Z", "closed_at": "2019-08-27T01:57:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a fairly standard Unet that I'm trying to export from ONNX to mlmodel (onnx-coreml). After updating onnx-coreml and coremltools I managed to export it, but Xcode (10.1) is complaining about the version 4 model. I will actually need to run this on iOS 12 anyway, so I don't want version 4. Is it possible to specify the exported version\u2014i.e., to force it to export v3?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/428", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/428/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/428/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/428/events", "html_url": "https://github.com/apple/coremltools/issues/428", "id": 485146599, "node_id": "MDU6SXNzdWU0ODUxNDY1OTk=", "number": 428, "title": "How to update model on device ?", "user": {"login": "BhavinSuthar", "id": 54391383, "node_id": "MDQ6VXNlcjU0MzkxMzgz", "avatar_url": "https://avatars0.githubusercontent.com/u/54391383?v=4", "gravatar_id": "", "url": "https://api.github.com/users/BhavinSuthar", "html_url": "https://github.com/BhavinSuthar", "followers_url": "https://api.github.com/users/BhavinSuthar/followers", "following_url": "https://api.github.com/users/BhavinSuthar/following{/other_user}", "gists_url": "https://api.github.com/users/BhavinSuthar/gists{/gist_id}", "starred_url": "https://api.github.com/users/BhavinSuthar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/BhavinSuthar/subscriptions", "organizations_url": "https://api.github.com/users/BhavinSuthar/orgs", "repos_url": "https://api.github.com/users/BhavinSuthar/repos", "events_url": "https://api.github.com/users/BhavinSuthar/events{/privacy}", "received_events_url": "https://api.github.com/users/BhavinSuthar/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2019-08-26T09:42:55Z", "updated_at": "2019-09-12T06:06:58Z", "closed_at": "2019-09-12T06:06:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "**iOS app** I am not able to train model with new inputs , I am using MNIST model\r\n`MLUpdateTask.init(forModelAt: <#T##URL#>, trainingData: <#T##MLBatchProvider#>, configuration: <#T##MLModelConfiguration?#>, progressHandlers: <#T##MLUpdateProgressHandlers#>)`\r\n\r\nCan some one guide me with` MLBatchProviders` how to create it with new inputs", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/427", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/427/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/427/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/427/events", "html_url": "https://github.com/apple/coremltools/issues/427", "id": 484040940, "node_id": "MDU6SXNzdWU0ODQwNDA5NDA=", "number": 427, "title": "Split a pre-trained CoreML model into two CoreML Models ?", "user": {"login": "anujdutt9", "id": 11924142, "node_id": "MDQ6VXNlcjExOTI0MTQy", "avatar_url": "https://avatars3.githubusercontent.com/u/11924142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anujdutt9", "html_url": "https://github.com/anujdutt9", "followers_url": "https://api.github.com/users/anujdutt9/followers", "following_url": "https://api.github.com/users/anujdutt9/following{/other_user}", "gists_url": "https://api.github.com/users/anujdutt9/gists{/gist_id}", "starred_url": "https://api.github.com/users/anujdutt9/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anujdutt9/subscriptions", "organizations_url": "https://api.github.com/users/anujdutt9/orgs", "repos_url": "https://api.github.com/users/anujdutt9/repos", "events_url": "https://api.github.com/users/anujdutt9/events{/privacy}", "received_events_url": "https://api.github.com/users/anujdutt9/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-22T14:49:17Z", "updated_at": "2019-09-18T23:04:27Z", "closed_at": "2019-08-22T20:46:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a Sound Classification model from turicreate example here: https://apple.github.io/turicreate/docs/userguide/sound_classifier/\r\n\r\nI am trying to split this model into two and save the two parts as separate CoreML Models using coremltools library. Can anyone please guide me on how to do this?\r\n\r\nI am able to load the model and even print out the spec of the model. But don't know where to go from here.\r\n\r\n```\r\nimport coremltools\r\n\r\n# Load the Saved CoreML Model\r\nmlmodel = coremltools.models.MLModel('./EnvSceneClassification.mlmodel')\r\n\r\n# Get spec from the model\r\nspec = mlmodel.get_spec()\r\n```\r\n\r\nThanks.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/apple/coremltools/issues/422", "repository_url": "https://api.github.com/repos/apple/coremltools", "labels_url": "https://api.github.com/repos/apple/coremltools/issues/422/labels{/name}", "comments_url": "https://api.github.com/repos/apple/coremltools/issues/422/comments", "events_url": "https://api.github.com/repos/apple/coremltools/issues/422/events", "html_url": "https://github.com/apple/coremltools/issues/422", "id": 480158273, "node_id": "MDU6SXNzdWU0ODAxNTgyNzM=", "number": 422, "title": "Unable to perform matrix multiplication", "user": {"login": "jaskirat-hike", "id": 12844174, "node_id": "MDQ6VXNlcjEyODQ0MTc0", "avatar_url": "https://avatars0.githubusercontent.com/u/12844174?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jaskirat-hike", "html_url": "https://github.com/jaskirat-hike", "followers_url": "https://api.github.com/users/jaskirat-hike/followers", "following_url": "https://api.github.com/users/jaskirat-hike/following{/other_user}", "gists_url": "https://api.github.com/users/jaskirat-hike/gists{/gist_id}", "starred_url": "https://api.github.com/users/jaskirat-hike/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jaskirat-hike/subscriptions", "organizations_url": "https://api.github.com/users/jaskirat-hike/orgs", "repos_url": "https://api.github.com/users/jaskirat-hike/repos", "events_url": "https://api.github.com/users/jaskirat-hike/events{/privacy}", "received_events_url": "https://api.github.com/users/jaskirat-hike/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 637373897, "node_id": "MDU6TGFiZWw2MzczNzM4OTc=", "url": "https://api.github.com/repos/apple/coremltools/labels/question", "name": "question", "color": "c10f47", "default": true, "description": "Response providing clarification needed. Will not be assigned to a release. (type)"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-13T13:30:29Z", "updated_at": "2019-09-05T23:11:35Z", "closed_at": "2019-09-05T23:11:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to implement a matrix multiplication operation in my network using NetworkBuilder.\r\nI wish to multiply two tensors of size (20x50) and (50x100) to get a tensor of size (20x100).\r\n\r\nHow can I do that? I've tried to use add_batched_mat_mul but I'm getting the below error on coremltools==3.0b3 and coremltools==3.0b4\r\n\r\nUsing:\r\ntensorflow==1.13.1\r\npython 2.7\r\n\r\nHow can I perform a matmul operation with the above mentioned tensor dimensions?\r\n\r\nError on coremltools==3.0b3\r\n```\r\nRuntimeWarning: You will not be able to run predict() on this Core ML model. Underlying exception message was: Error compiling model: \"Error reading protobuf spec. validator error: Unsupported layer type (CoreML.Specification.NeuralNetworkLayer) for layer 'matmul'.\".\r\n  RuntimeWarning)\r\n```\r\n\r\nError on coremltools==3.0b4 \r\n```Traceback (most recent call last):\r\n  File \"test2.py\", line 28, in <module>\r\n    out = model.predict({\"matrix_left\": np.zeros((20, 50, 1))})\r\n  File \"python2.7/site-packages/coremltools/models/model.py\", line 345, in predict\r\n    raise Exception('Unable to load CoreML.framework. Cannot make predictions.')\r\nException: Unable to load CoreML.framework. Cannot make predictions.\r\nexception loading model proxy: dlopen(python2.7/site-packages/coremltools/libcoremlpython.so, 2): Symbol not found: _objc_opt_class\r\n  Referenced from: python2.7/site-packages/coremltools/libcoremlpython.so (which was built for Mac OS X 10.15)\r\n  Expected in: /usr/lib/libobjc.A.dylib\r\n in python2.7/site-packages/coremltools/libcoremlpython.so\r\n```\r\n\r\nScript used:\r\n\r\n```\r\nimport coremltools.models.datatypes as datatypes\r\nfrom coremltools.models.neural_network import NeuralNetworkBuilder\r\nfrom coremltools.models import MLModel\r\n\r\nimport numpy as np\r\n\r\nmodel_input_features = [\r\n    (\"matrix_left\", datatypes.Array(20, 50, 1)),\r\n]\r\nmodel_output_features = [\r\n    (\"y\", datatypes.Array(20, 100, 1)),\r\n]\r\n\r\nbuilder = NeuralNetworkBuilder(input_features=model_input_features, output_features=model_output_features)\r\n\r\nnp.random.seed(42)\r\n\r\nmatrix_right = np.random.rand(50, 100, 1)\r\nbuilder.add_load_constant(name=\"matrix_right\", output_name=\"matrix_right\",\r\n                          constant_value=matrix_right, shape=(50, 100, 1))\r\n\r\n\r\nbuilder.add_batched_mat_mul(name=\"matmul\", input_names=[\"matrix_left\", \"matrix_right\"],\r\n                            output_name=\"y\")\r\n\r\nmodel = MLModel(builder.spec)\r\nout = model.predict({\"matrix_left\": np.zeros((20, 50, 1))})\r\ny = out[\"y\"]\r\nprint(y)\r\nprint(y.shape)\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}]}