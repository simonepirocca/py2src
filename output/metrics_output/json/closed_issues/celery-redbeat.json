{"total_count": 49, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/sibson/redbeat/issues/173", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/173/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/173/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/173/events", "html_url": "https://github.com/sibson/redbeat/issues/173", "id": 642634781, "node_id": "MDU6SXNzdWU2NDI2MzQ3ODE=", "number": 173, "title": "Will next release support timezones for crontab schedules as well?", "user": {"login": "cooperbaird", "id": 6807747, "node_id": "MDQ6VXNlcjY4MDc3NDc=", "avatar_url": "https://avatars1.githubusercontent.com/u/6807747?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cooperbaird", "html_url": "https://github.com/cooperbaird", "followers_url": "https://api.github.com/users/cooperbaird/followers", "following_url": "https://api.github.com/users/cooperbaird/following{/other_user}", "gists_url": "https://api.github.com/users/cooperbaird/gists{/gist_id}", "starred_url": "https://api.github.com/users/cooperbaird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cooperbaird/subscriptions", "organizations_url": "https://api.github.com/users/cooperbaird/orgs", "repos_url": "https://api.github.com/users/cooperbaird/repos", "events_url": "https://api.github.com/users/cooperbaird/events{/privacy}", "received_events_url": "https://api.github.com/users/cooperbaird/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-06-21T20:25:33Z", "updated_at": "2020-07-05T22:25:47Z", "closed_at": "2020-07-05T22:25:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "Since per-entry timezone awareness is about to be supported, will there be an option to specify a timezone for a crontab schedule as well? Having different entries on different timezones would be a really useful feature for me.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/169", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/169/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/169/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/169/events", "html_url": "https://github.com/sibson/redbeat/issues/169", "id": 631907823, "node_id": "MDU6SXNzdWU2MzE5MDc4MjM=", "number": 169, "title": "AttributeError: 'NoneType' object has no attribute 'startswith'", "user": {"login": "infa-vsinghal", "id": 52804346, "node_id": "MDQ6VXNlcjUyODA0MzQ2", "avatar_url": "https://avatars0.githubusercontent.com/u/52804346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/infa-vsinghal", "html_url": "https://github.com/infa-vsinghal", "followers_url": "https://api.github.com/users/infa-vsinghal/followers", "following_url": "https://api.github.com/users/infa-vsinghal/following{/other_user}", "gists_url": "https://api.github.com/users/infa-vsinghal/gists{/gist_id}", "starred_url": "https://api.github.com/users/infa-vsinghal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/infa-vsinghal/subscriptions", "organizations_url": "https://api.github.com/users/infa-vsinghal/orgs", "repos_url": "https://api.github.com/users/infa-vsinghal/repos", "events_url": "https://api.github.com/users/infa-vsinghal/events{/privacy}", "received_events_url": "https://api.github.com/users/infa-vsinghal/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-05T20:01:11Z", "updated_at": "2020-06-05T21:51:01Z", "closed_at": "2020-06-05T21:50:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI'm using redbeat v1.0.0 with Django==3.0.3, celery==4.4.0 in a multicontainer docker compose env. In my Django settings.py I've the following settings: \r\n\r\n```\r\n# celery and redbeat\r\nREDBEAT_REDIS_URL = \"redis://redis:6379/1\"\r\nREDBEAT_KEY_PREFIX = \"readbeat\"\r\nCELERY_BROKER_URL = 'redis://redis:6379'\r\nCELERY_RESULT_BACKEND = 'redis://redis:6379'\r\nCELERY_ACCEPT_CONTENT = ['application/json']\r\nCELERY_RESULT_SERIALIZER = 'json'\r\nCELERY_TASK_SERIALIZER = 'json'\r\nCELERY_BEAT_SCHEDULE = {\r\n     'say_hello_schedule': {\r\n         'task': 'service_status.tasks.say_hello',\r\n         'schedule': timedelta(hours=1),\r\n     },}\r\n```\r\n\r\nand in celery.py\r\n```\r\nfrom __future__ import absolute_import\r\nfrom django.conf import settings\r\nfrom celery import Celery\r\nimport os\r\n\r\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'mysite.settings')\r\n\r\n# redbeat\r\napp = Celery('mysite')\r\napp.conf.update(\r\n    redbeat_redis_url=\"redis://redis:6379/1\",\r\n)\r\napp.config_from_object('django.conf:settings', namespace='CELERY')\r\napp.autodiscover_tasks(lambda: settings.INSTALLED_APPS)\r\n```\r\n\r\nNo error in starting up the environment. I then open Django shell with everything running fine in the background (other static scheduled tasks)\r\n```\r\npython3 manage.py shell\r\n```\r\n\r\nand run the following\r\n```\r\nfrom redbeat import RedBeatSchedulerEntry as Entry\r\nfrom service_status import tasks\r\nfrom celery import Celery\r\napp = Celery('mysite')\r\ne = Entry('hello_sch','tasks.hello_function',20,args=[],app=app)\r\ne.save()\r\n```\r\n\r\nand get the following error\r\n```\r\nTraceback (most recent call last):\r\n  File \"<console>\", line 1, in <module>\r\n  File \"/usr/local/lib/python3.6/site-packages/redbeat/schedulers.py\", line 292, in save\r\n    with get_redis(self.app).pipeline() as pipe:\r\n  File \"/usr/local/lib/python3.6/site-packages/redbeat/schedulers.py\", line 114, in get_redis\r\n    if conf.redis_url.startswith('redis-sentinel') and  'sentinels' in redis_options:\r\nAttributeError: 'NoneType' object has no attribute 'startswith'\r\n```\r\n\r\nI'm not using `sentinel` anywhere... How to fix this?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/162", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/162/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/162/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/162/events", "html_url": "https://github.com/sibson/redbeat/issues/162", "id": 611576926, "node_id": "MDU6SXNzdWU2MTE1NzY5MjY=", "number": 162, "title": "define crontab task such as '*/2' faild", "user": {"login": "yangyuepeng", "id": 28329651, "node_id": "MDQ6VXNlcjI4MzI5NjUx", "avatar_url": "https://avatars1.githubusercontent.com/u/28329651?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yangyuepeng", "html_url": "https://github.com/yangyuepeng", "followers_url": "https://api.github.com/users/yangyuepeng/followers", "following_url": "https://api.github.com/users/yangyuepeng/following{/other_user}", "gists_url": "https://api.github.com/users/yangyuepeng/gists{/gist_id}", "starred_url": "https://api.github.com/users/yangyuepeng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yangyuepeng/subscriptions", "organizations_url": "https://api.github.com/users/yangyuepeng/orgs", "repos_url": "https://api.github.com/users/yangyuepeng/repos", "events_url": "https://api.github.com/users/yangyuepeng/events{/privacy}", "received_events_url": "https://api.github.com/users/yangyuepeng/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-04T03:08:35Z", "updated_at": "2020-05-06T07:42:34Z", "closed_at": "2020-05-06T07:42:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "I define a crontab task:\r\n{'app': <Celery celery_app at 0x7fabf4920208>,\r\n 'args': ['tasks.task1.echo'],\r\n 'enabled': True,\r\n 'kwargs': {},\r\n 'last_run_at': datetime.datetime(2020, 5, 4, 2, 55, 13, 297894, tzinfo=<UTC>),\r\n 'name': 'test1',\r\n 'options': {},\r\n 'schedule': <crontab: */20 * * * * (m/h/d/dM/MY)>,\r\n 'task': 'task.execute',\r\n 'total_run_count': 0}\r\n\r\nbut it`s faild ,not work, try other att too:\r\n\r\ncelery beat v4.4.2 (cliffs) is starting.\r\n__    -    ... __   -        _\r\nLocalTime -> 2020-05-04 10:56:05\r\nConfiguration ->\r\n    . broker -> redis://root:**@127.0.0.1:6379/1\r\n    . loader -> celery.loaders.app.AppLoader\r\n    . scheduler -> redbeat.schedulers.RedBeatScheduler\r\n       . redis -> redis://root:**@127.0.0.1:6379/3\r\n       . lock -> `redbeat::lock` 25.00 minutes (1500s)\r\n    . logfile -> [stderr]@%INFO\r\n    . maxinterval -> 5.00 minutes (300s)\r\n[2020-05-04 10:56:05,330: INFO/MainProcess] beat: Starting...\r\n[2020-05-04 10:56:05,337: INFO/MainProcess] Loading 1 tasks\r\n[2020-05-04 10:56:05,346: INFO/MainProcess] Scheduler: Sending due task test1 (task.execute)\r\n[2020-05-04 11:00:00,112: INFO/MainProcess] Loading 1 tasks\r\n[2020-05-04 11:00:00,113: INFO/MainProcess] Scheduler: Sending due task test1 (task.execute)\r\n[2020-05-04 11:05:00,205: INFO/MainProcess] Loading 0 tasks\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/160", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/160/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/160/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/160/events", "html_url": "https://github.com/sibson/redbeat/issues/160", "id": 607043389, "node_id": "MDU6SXNzdWU2MDcwNDMzODk=", "number": 160, "title": "Tasks are running twice - potential solution: use pytz.timezone.localize instead of tzinfo in datetime", "user": {"login": "julesbond007", "id": 2090346, "node_id": "MDQ6VXNlcjIwOTAzNDY=", "avatar_url": "https://avatars2.githubusercontent.com/u/2090346?v=4", "gravatar_id": "", "url": "https://api.github.com/users/julesbond007", "html_url": "https://github.com/julesbond007", "followers_url": "https://api.github.com/users/julesbond007/followers", "following_url": "https://api.github.com/users/julesbond007/following{/other_user}", "gists_url": "https://api.github.com/users/julesbond007/gists{/gist_id}", "starred_url": "https://api.github.com/users/julesbond007/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/julesbond007/subscriptions", "organizations_url": "https://api.github.com/users/julesbond007/orgs", "repos_url": "https://api.github.com/users/julesbond007/repos", "events_url": "https://api.github.com/users/julesbond007/events{/privacy}", "received_events_url": "https://api.github.com/users/julesbond007/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-04-26T15:48:27Z", "updated_at": "2020-08-03T16:09:50Z", "closed_at": "2020-07-09T14:38:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey there,\r\n\r\nThanks for the nice library. It's been pretty helpful. I have a question, like a lot of people say, the tasks run twice and I'm not sure if the bug is in the library or celery or redis, but I noticed how the schedule due datetime is calculated and you're passing tzinfo=self.schedule.tz, in my testing, I didn't find this reliable. Instead I think you may want to use:\r\n\r\n`pytz.timezone('whatever_tz').localize(whatever_date_time)` \r\n\r\nHere is what I have in my testing:\r\n\r\nWith tzinfo (wrong):\r\n```\r\n>>> import datetime\r\n>>> import pytz\r\n>>> d = datetime.datetime(year=2020, month=4, day=2, hour=10, minute=0, tzinfo=pytz.timezone('America/New_York'))\r\n>>> print(d)\r\n2020-04-02 10:00:00-04:56\r\n>>> y = d.astimezone(pytz.UTC)\r\n>>> print(y)\r\n2020-04-02 14:56:00+00:00\r\n```\r\n\r\n\r\nUsing pytz.localize (correct):\r\n```\r\n>>> import datetime\r\n>>> import pytz\r\n>>> d = datetime.datetime(year=2020, month=4, day=2, hour=10, minute=0)\r\n>>> d = pytz.timezone('America/New_York').localize(d)\r\n>>> print(d)\r\n2020-04-02 10:00:00-04:00\r\n>>> z = d.astimezone(pytz.UTC)\r\n>>> print(z)\r\n2020-04-02 14:00:00+00:00\r\n```\r\n\r\nCelery uses astimezone to calculate now:\r\n\r\n```\r\nclass Celery(...)\r\n...\r\n    def now(self):\r\n        \"\"\"Return the current time and date as a datetime.\"\"\"\r\n        now_in_utc = to_utc(datetime.utcnow())\r\n        return now_in_utc.astimezone(self.timezone)\r\n```\r\n\r\nWhat I believe is happening is celery will have 1 time, and celery-redbeat will potentially give another time (not always) so, the task will run twice sometimes. If you schedule a task to run say at 12:00 in America/New_York timezone, it will be picked up also right around 11:56 a few minutes before. The time difference changes based on timezone offset.\r\n\r\n\r\n\r\nSee this Stack overflow as well:\r\nhttps://stackoverflow.com/questions/6410971/python-datetime-object-show-wrong-timezone-offset", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/147", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/147/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/147/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/147/events", "html_url": "https://github.com/sibson/redbeat/issues/147", "id": 530950186, "node_id": "MDU6SXNzdWU1MzA5NTAxODY=", "number": 147, "title": "Redbeat with SQS queue instead of Redis", "user": {"login": "mhsiddiqui", "id": 10397643, "node_id": "MDQ6VXNlcjEwMzk3NjQz", "avatar_url": "https://avatars2.githubusercontent.com/u/10397643?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mhsiddiqui", "html_url": "https://github.com/mhsiddiqui", "followers_url": "https://api.github.com/users/mhsiddiqui/followers", "following_url": "https://api.github.com/users/mhsiddiqui/following{/other_user}", "gists_url": "https://api.github.com/users/mhsiddiqui/gists{/gist_id}", "starred_url": "https://api.github.com/users/mhsiddiqui/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mhsiddiqui/subscriptions", "organizations_url": "https://api.github.com/users/mhsiddiqui/orgs", "repos_url": "https://api.github.com/users/mhsiddiqui/repos", "events_url": "https://api.github.com/users/mhsiddiqui/events{/privacy}", "received_events_url": "https://api.github.com/users/mhsiddiqui/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-12-02T07:43:57Z", "updated_at": "2020-01-15T02:16:52Z", "closed_at": "2020-01-15T02:16:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "On my server (AWS ElasticBeanstalk) I am using SQS instead of Redis. I have e docker containers.\r\n\r\n- App\r\n- Celery Worker\r\n- Celery Beat\r\n\r\nHow can I use redbeat with SQS?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/141", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/141/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/141/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/141/events", "html_url": "https://github.com/sibson/redbeat/issues/141", "id": 473911825, "node_id": "MDU6SXNzdWU0NzM5MTE4MjU=", "number": 141, "title": "Fix CI", "user": {"login": "laixintao", "id": 9675939, "node_id": "MDQ6VXNlcjk2NzU5Mzk=", "avatar_url": "https://avatars0.githubusercontent.com/u/9675939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/laixintao", "html_url": "https://github.com/laixintao", "followers_url": "https://api.github.com/users/laixintao/followers", "following_url": "https://api.github.com/users/laixintao/following{/other_user}", "gists_url": "https://api.github.com/users/laixintao/gists{/gist_id}", "starred_url": "https://api.github.com/users/laixintao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/laixintao/subscriptions", "organizations_url": "https://api.github.com/users/laixintao/orgs", "repos_url": "https://api.github.com/users/laixintao/repos", "events_url": "https://api.github.com/users/laixintao/events{/privacy}", "received_events_url": "https://api.github.com/users/laixintao/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-07-29T08:13:07Z", "updated_at": "2019-08-20T01:51:10Z", "closed_at": "2019-08-20T01:51:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, it seems [fakeredis](https://github.com/jamesls/fakeredis) doesn't support the full command list of Redis, nor support redis-py's variables.\r\n\r\n![image](https://user-images.githubusercontent.com/9675939/62032096-67fce980-b21b-11e9-9e6b-918f222f52a7.png)\r\n\r\nCan we switch to CircleCI's Redis service? What do you think? @sibson  I am familiar with CircleCI.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/140", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/140/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/140/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/140/events", "html_url": "https://github.com/sibson/redbeat/issues/140", "id": 470987875, "node_id": "MDU6SXNzdWU0NzA5ODc4NzU=", "number": 140, "title": "Are setting custom config values broken still broken?", "user": {"login": "kencue", "id": 1920371, "node_id": "MDQ6VXNlcjE5MjAzNzE=", "avatar_url": "https://avatars2.githubusercontent.com/u/1920371?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kencue", "html_url": "https://github.com/kencue", "followers_url": "https://api.github.com/users/kencue/followers", "following_url": "https://api.github.com/users/kencue/following{/other_user}", "gists_url": "https://api.github.com/users/kencue/gists{/gist_id}", "starred_url": "https://api.github.com/users/kencue/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kencue/subscriptions", "organizations_url": "https://api.github.com/users/kencue/orgs", "repos_url": "https://api.github.com/users/kencue/repos", "events_url": "https://api.github.com/users/kencue/events{/privacy}", "received_events_url": "https://api.github.com/users/kencue/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-07-22T09:25:34Z", "updated_at": "2019-07-22T09:35:25Z", "closed_at": "2019-07-22T09:35:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "I followed all the steps in the documentation, but it seems that the default values are taken priority over overriding them. \r\n\r\nI tried setting my own lock key, redis url, lock timeout, or any of the config values available, but they aren't being set...instead it's the default values all the time.\r\n\r\nAm I looking into this incorrectly?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/135", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/135/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/135/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/135/events", "html_url": "https://github.com/sibson/redbeat/issues/135", "id": 454620272, "node_id": "MDU6SXNzdWU0NTQ2MjAyNzI=", "number": 135, "title": "celery-redbeat-unstable", "user": {"login": "davidjmemmett", "id": 213197, "node_id": "MDQ6VXNlcjIxMzE5Nw==", "avatar_url": "https://avatars2.githubusercontent.com/u/213197?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidjmemmett", "html_url": "https://github.com/davidjmemmett", "followers_url": "https://api.github.com/users/davidjmemmett/followers", "following_url": "https://api.github.com/users/davidjmemmett/following{/other_user}", "gists_url": "https://api.github.com/users/davidjmemmett/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidjmemmett/subscriptions", "organizations_url": "https://api.github.com/users/davidjmemmett/orgs", "repos_url": "https://api.github.com/users/davidjmemmett/repos", "events_url": "https://api.github.com/users/davidjmemmett/events{/privacy}", "received_events_url": "https://api.github.com/users/davidjmemmett/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-06-11T10:55:44Z", "updated_at": "2020-03-05T23:05:23Z", "closed_at": "2020-03-05T23:05:23Z", "author_association": "NONE", "active_lock_reason": null, "body": "Given that folks might be waiting a while for an official release, would it be worth creating a new package (or using special version numbers -alpha etc) to release potentially unstable versions automatically via CI?\r\n\r\nThere are a few fixes that have gone into master that I would like to test, yet due to the setup of my own projects (all use requirements files & pip-tools) I can't test that some of the changes fix an issue that I'm having.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/127", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/127/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/127/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/127/events", "html_url": "https://github.com/sibson/redbeat/issues/127", "id": 449742121, "node_id": "MDU6SXNzdWU0NDk3NDIxMjE=", "number": 127, "title": "Distributed lock cloud be acquired more then once.", "user": {"login": "laixintao", "id": 9675939, "node_id": "MDQ6VXNlcjk2NzU5Mzk=", "avatar_url": "https://avatars0.githubusercontent.com/u/9675939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/laixintao", "html_url": "https://github.com/laixintao", "followers_url": "https://api.github.com/users/laixintao/followers", "following_url": "https://api.github.com/users/laixintao/following{/other_user}", "gists_url": "https://api.github.com/users/laixintao/gists{/gist_id}", "starred_url": "https://api.github.com/users/laixintao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/laixintao/subscriptions", "organizations_url": "https://api.github.com/users/laixintao/orgs", "repos_url": "https://api.github.com/users/laixintao/repos", "events_url": "https://api.github.com/users/laixintao/events{/privacy}", "received_events_url": "https://api.github.com/users/laixintao/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-05-29T11:04:56Z", "updated_at": "2019-07-29T00:55:10Z", "closed_at": "2019-07-29T00:55:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "The problem is, redbeat uses `pexpires` to extend lock lease without checking if it still owns the lock.\r\n\r\nFor example if we have two instances running, A is current owning the lock. A has a network issue and can't connect redis, then B acquired the lock. When A is reconnected, is use `pexpires` without checking is A still the owner of the lock. Finnally, the lock `deadbeat::lock` has two owners now.\r\n\r\n![image](https://user-images.githubusercontent.com/9675939/58552255-932b8280-8244-11e9-94a1-7c2bcdac47af.png)\r\n\r\n\r\nTo reproduce this scenario, you can start one `redbeat` with the command below:\r\n\r\n```\r\n\u279c [redbeat] redbeat_test celery beat -S redbeat.RedBeatScheduler --config config -l de\u279c [redbeat] redbeat_test celery beat -S redbeat.RedBeatScheduler --config config -l debug --pidfile=\"/tmp/celerybeat5.pid\"\r\ncelery beat v4.3.0 (rhubarb) is starting.\r\n__    -    ... __   -        _\r\nLocalTime -> 2019-05-29 12:26:43\r\nConfiguration ->\r\n    . broker -> redis://localhost:6379//\r\n    . loader -> celery.loaders.default.Loader\r\n    . scheduler -> redbeat.schedulers.RedBeatScheduler\r\n       . redis -> redis:///\r\n       . lock -> `redbeat::lock` 10.00 seconds (10s)\r\n    . logfile -> [stderr]@%DEBUG\r\n    . maxinterval -> 5.00 seconds (5s)\r\n[2019-05-29 12:26:43,612: DEBUG/MainProcess] Setting default socket timeout to 30\r\n[2019-05-29 12:26:43,613: INFO/MainProcess] beat: Starting...\r\n[2019-05-29 12:26:43,617: DEBUG/MainProcess] Stored entry: <RedBeatSchedulerEntry: celery.backend_cleanup celery.backend_cleanup() <crontab: 0 4 * * * (m/h/d/dM/MY)>\r\n[2019-05-29 12:26:43,617: DEBUG/MainProcess] beat: Ticking with max interval->5.00 seconds\r\n[2019-05-29 12:26:43,617: DEBUG/MainProcess] beat: Acquiring lock...\r\n```\r\nThe `config.py` file I use:\r\n\r\n```\r\n# -*- coding: utf-8 -*-\r\nimport os\r\n\r\n\r\nbroker_url = os.environ.get('BROKER_URL', 'redis://')\r\n\r\ncelerybeat_scheduler = 'redbeat.RedBeatScheduler'\r\nbeat_max_loop_interval=5\r\nredbeat_lock_timeout=10\r\ntask_send_sent_event = True\r\n```\r\n\r\nAnd then use `Ctrl+Z` to suspended this process, to mock a network unavailable or python gc stop the world. Output like this:\r\n\r\n```\r\n[1]  + 92360 suspended  celery beat -S redbeat.RedBeatScheduler --config config -l debug\r\n```\r\n\r\nWait until the lock in redis timeout:\r\n\r\n```\r\n127.0.0.1:6379> TTL redbeat::lock\r\n(integer) 8\r\n127.0.0.1:6379> TTL redbeat::lock\r\n(integer) 7\r\n127.0.0.1:6379> TTL redbeat::lock\r\n(integer) -2\r\n```\r\n\r\nThen start another redbeat instance:\r\n\r\n```\r\n\u279c [redbeat] redbeat_test celery beat -S redbeat.RedBeatScheduler --config config -l debug --pidfile=\"/tmp/celerybeat6.pid\"\r\ncelery beat v4.3.0 (rhubarb) is starting.\r\n__    -    ... __   -        _\r\nLocalTime -> 2019-05-29 12:28:59\r\nConfiguration ->\r\n    . broker -> redis://localhost:6379//\r\n    . loader -> celery.loaders.default.Loader\r\n    . scheduler -> redbeat.schedulers.RedBeatScheduler\r\n       . redis -> redis:///\r\n       . lock -> `redbeat::lock` 10.00 seconds (10s)\r\n    . logfile -> [stderr]@%DEBUG\r\n    . maxinterval -> 5.00 seconds (5s)\r\n[2019-05-29 12:28:59,121: DEBUG/MainProcess] Setting default socket timeout to 30\r\n[2019-05-29 12:28:59,121: INFO/MainProcess] beat: Starting...\r\n[2019-05-29 12:28:59,126: DEBUG/MainProcess] Stored entry: <RedBeatSchedulerEntry: celery.backend_cleanup celery.backend_cleanup() <crontab: 0 4 * * * (m/h/d/dM/MY)>\r\n[2019-05-29 12:28:59,126: DEBUG/MainProcess] beat: Ticking with max interval->5.00 seconds\r\n[2019-05-29 12:28:59,126: DEBUG/MainProcess] beat: Acquiring lock...\r\n[2019-05-29 12:28:59,127: DEBUG/MainProcess] beat: Extending lock...\r\n```\r\n\r\nThen use `fg %1` to resume the first suspended redbeat instance:\r\n\r\n```\r\n\u279c [redbeat] redbeat_test fg %1\r\n[1]  - 92360 continued  celery beat -S redbeat.RedBeatScheduler --config config -l debug\r\n[2019-05-29 12:29:53,169: DEBUG/MainProcess] beat: Synchronizing schedule...\r\n[2019-05-29 12:29:53,170: DEBUG/MainProcess] beat: Extending lock...\r\n[2019-05-29 12:29:53,170: DEBUG/MainProcess] Selecting tasks\r\n[2019-05-29 12:29:53,170: INFO/MainProcess] Loading 0 tasks\r\n[2019-05-29 12:29:53,170: DEBUG/MainProcess] beat: Waking up in 5.00 seconds.\r\n[2019-05-29 12:29:58,172: DEBUG/MainProcess] beat: Extending lock...\r\n[2019-05-29 12:29:58,172: DEBUG/MainProcess] Selecting tasks\r\n[2019-05-29 12:29:58,173: INFO/MainProcess] Loading 1 tasks\r\n```\r\n\r\nSo we have two instance running now. Each job will be put in queue twice and will be run twice.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/125", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/125/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/125/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/125/events", "html_url": "https://github.com/sibson/redbeat/issues/125", "id": 439543419, "node_id": "MDU6SXNzdWU0Mzk1NDM0MTk=", "number": 125, "title": "I set max_interval for 10 second, but when execute beat, the timeout 'redlock::lock' timeout always 1500s", "user": {"login": "xiaobaidemu", "id": 19198109, "node_id": "MDQ6VXNlcjE5MTk4MTA5", "avatar_url": "https://avatars3.githubusercontent.com/u/19198109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xiaobaidemu", "html_url": "https://github.com/xiaobaidemu", "followers_url": "https://api.github.com/users/xiaobaidemu/followers", "following_url": "https://api.github.com/users/xiaobaidemu/following{/other_user}", "gists_url": "https://api.github.com/users/xiaobaidemu/gists{/gist_id}", "starred_url": "https://api.github.com/users/xiaobaidemu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xiaobaidemu/subscriptions", "organizations_url": "https://api.github.com/users/xiaobaidemu/orgs", "repos_url": "https://api.github.com/users/xiaobaidemu/repos", "events_url": "https://api.github.com/users/xiaobaidemu/events{/privacy}", "received_events_url": "https://api.github.com/users/xiaobaidemu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-05-02T11:28:51Z", "updated_at": "2019-05-02T12:31:52Z", "closed_at": "2019-05-02T12:31:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "hello\uff0c\r\n     I am really confused, when I use the command:\r\ncelery -A xxxxx beat --scheduler=redbeat.RedBeatScheduler --loglevel=DEBUG --max-interval=10\r\nto start beat. The timeout of lock is 1500s.\r\ncelery beat v4.2.1 (windowlicker) is starting.\r\n__    -    ... __   -        _\r\nLocalTime -> 2019-05-02 19:26:08\r\nConfiguration ->\r\n    . broker -> redis://:**@xxx.xxx.xxx.xx:6379/0\r\n    . loader -> celery.loaders.app.AppLoader\r\n    . scheduler -> redbeat.schedulers.RedBeatScheduler\r\n       . redis -> redis://:**@11.161.88.179:6379/0\r\n       . lock -> `redbeat::lock` 25.00 minutes (1500s)\r\n    . logfile -> [stderr]@%DEBUG\r\n    . maxinterval -> 10.00 seconds (10.0s)\r\nHowever it should be 10*5 = 50s (self.self.max_interval * 5) , not DEFAULT_MAX_INTERVAL * 5 = 1500\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/124", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/124/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/124/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/124/events", "html_url": "https://github.com/sibson/redbeat/issues/124", "id": 435569320, "node_id": "MDU6SXNzdWU0MzU1NjkzMjA=", "number": 124, "title": "Smaller Readme and real docs", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1329085526, "node_id": "MDU6TGFiZWwxMzI5MDg1NTI2", "url": "https://api.github.com/repos/sibson/redbeat/labels/help%20wanted", "name": "help wanted", "color": "b60205", "default": true, "description": ""}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-04-22T01:35:02Z", "updated_at": "2019-06-13T14:28:48Z", "closed_at": "2019-06-13T14:28:48Z", "author_association": "OWNER", "active_lock_reason": null, "body": "The README is starting to get rather long-winded and should be more focused on \"selling\" why to use redbeat and then a quick start.\r\n\r\nThe details of how to use and other details should be in proper docs that can be built and hosted somewhere like readthedocs.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/121", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/121/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/121/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/121/events", "html_url": "https://github.com/sibson/redbeat/issues/121", "id": 433548321, "node_id": "MDU6SXNzdWU0MzM1NDgzMjE=", "number": 121, "title": "Fix the warnings in python37", "user": {"login": "laixintao", "id": 9675939, "node_id": "MDQ6VXNlcjk2NzU5Mzk=", "avatar_url": "https://avatars0.githubusercontent.com/u/9675939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/laixintao", "html_url": "https://github.com/laixintao", "followers_url": "https://api.github.com/users/laixintao/followers", "following_url": "https://api.github.com/users/laixintao/following{/other_user}", "gists_url": "https://api.github.com/users/laixintao/gists{/gist_id}", "starred_url": "https://api.github.com/users/laixintao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/laixintao/subscriptions", "organizations_url": "https://api.github.com/users/laixintao/orgs", "repos_url": "https://api.github.com/users/laixintao/repos", "events_url": "https://api.github.com/users/laixintao/events{/privacy}", "received_events_url": "https://api.github.com/users/laixintao/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-04-16T01:54:45Z", "updated_at": "2019-04-16T02:20:24Z", "closed_at": "2019-04-16T02:20:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi I see many warnings during the tests on python37, I open a PR to fix them later.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/113", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/113/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/113/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/113/events", "html_url": "https://github.com/sibson/redbeat/issues/113", "id": 421636480, "node_id": "MDU6SXNzdWU0MjE2MzY0ODA=", "number": 113, "title": "Publish version v0.13.0", "user": {"login": "RomuloOliveira", "id": 3009157, "node_id": "MDQ6VXNlcjMwMDkxNTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/3009157?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RomuloOliveira", "html_url": "https://github.com/RomuloOliveira", "followers_url": "https://api.github.com/users/RomuloOliveira/followers", "following_url": "https://api.github.com/users/RomuloOliveira/following{/other_user}", "gists_url": "https://api.github.com/users/RomuloOliveira/gists{/gist_id}", "starred_url": "https://api.github.com/users/RomuloOliveira/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RomuloOliveira/subscriptions", "organizations_url": "https://api.github.com/users/RomuloOliveira/orgs", "repos_url": "https://api.github.com/users/RomuloOliveira/repos", "events_url": "https://api.github.com/users/RomuloOliveira/events{/privacy}", "received_events_url": "https://api.github.com/users/RomuloOliveira/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2019-03-15T17:50:21Z", "updated_at": "2019-04-16T00:45:30Z", "closed_at": "2019-04-16T00:45:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've noted that the setup.py had the version bumped to 0.13.0, with the fix supporting redis-py>3 (f59ac3816af2da48528acc1d862bead96a582f27 and c5269838b0daf49e34cff85e6ad0c7b95dceaf12).\r\n\r\nAre there any plans or obstacles to release a tag and publish this version? Any help needed?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/107", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/107/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/107/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/107/events", "html_url": "https://github.com/sibson/redbeat/issues/107", "id": 399193851, "node_id": "MDU6SXNzdWUzOTkxOTM4NTE=", "number": 107, "title": "can't upgrade to redis 3.0", "user": {"login": "yoch", "id": 795960, "node_id": "MDQ6VXNlcjc5NTk2MA==", "avatar_url": "https://avatars3.githubusercontent.com/u/795960?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yoch", "html_url": "https://github.com/yoch", "followers_url": "https://api.github.com/users/yoch/followers", "following_url": "https://api.github.com/users/yoch/following{/other_user}", "gists_url": "https://api.github.com/users/yoch/gists{/gist_id}", "starred_url": "https://api.github.com/users/yoch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yoch/subscriptions", "organizations_url": "https://api.github.com/users/yoch/orgs", "repos_url": "https://api.github.com/users/yoch/repos", "events_url": "https://api.github.com/users/yoch/events{/privacy}", "received_events_url": "https://api.github.com/users/yoch/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-01-15T05:28:52Z", "updated_at": "2019-04-16T01:58:38Z", "closed_at": "2019-04-16T01:58:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nThe new version of python redis (3.0) [is not backward compatible](https://github.com/andymccurdy/redis-py#upgrading-from-redis-py-2x-to-30), and upgrading cause problems.\r\n\r\n```\r\n>>> entry.save()\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/local/lib/python3.5/dist-packages/redbeat/schedulers.py\", line 274, in save\r\n    pipe.zadd(self.app.redbeat_conf.schedule_key, self.score, self.key)\r\n  File \"/usr/local/lib/python3.5/dist-packages/redis/client.py\", line 2263, in zadd\r\n    for pair in iteritems(mapping):\r\n  File \"/usr/local/lib/python3.5/dist-packages/redis/_compat.py\", line 123, in iteritems\r\n    return iter(x.items())\r\nAttributeError: 'int' object has no attribute 'items'\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/105", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/105/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/105/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/105/events", "html_url": "https://github.com/sibson/redbeat/issues/105", "id": 392110132, "node_id": "MDU6SXNzdWUzOTIxMTAxMzI=", "number": 105, "title": "Beat not picking up configuration on startup", "user": {"login": "rajeshyogeshwar", "id": 7311146, "node_id": "MDQ6VXNlcjczMTExNDY=", "avatar_url": "https://avatars0.githubusercontent.com/u/7311146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rajeshyogeshwar", "html_url": "https://github.com/rajeshyogeshwar", "followers_url": "https://api.github.com/users/rajeshyogeshwar/followers", "following_url": "https://api.github.com/users/rajeshyogeshwar/following{/other_user}", "gists_url": "https://api.github.com/users/rajeshyogeshwar/gists{/gist_id}", "starred_url": "https://api.github.com/users/rajeshyogeshwar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rajeshyogeshwar/subscriptions", "organizations_url": "https://api.github.com/users/rajeshyogeshwar/orgs", "repos_url": "https://api.github.com/users/rajeshyogeshwar/repos", "events_url": "https://api.github.com/users/rajeshyogeshwar/events{/privacy}", "received_events_url": "https://api.github.com/users/rajeshyogeshwar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2018-12-18T11:20:00Z", "updated_at": "2019-05-24T05:44:50Z", "closed_at": "2019-05-24T05:44:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am using celery inside a docker container and I am using RedBeatScheduler. The command I use to start celery is\r\n\r\n`celery -E -A myapp.taskapp worker --beat --scheduler redbeat.schedulers:RedBeatScheduler --loglevel INFO --uid taskmaster --concurrency=5`\r\n\r\nBut the problem is that during start beat gets the following error and stops working.\r\n\r\n![celeryissye](https://user-images.githubusercontent.com/7311146/50150677-abd25c80-02e4-11e9-8f25-b5ccdfcd56ff.png)\r\n\r\nBased on stacktrace, it is clear that `conf` object's `redis_url` property is not set at startup but when I log in check it manually it seems to work and has the said property correctly set. I am unsure if the issue is from `redbeat` or `celery` itself. ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/100", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/100/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/100/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/100/events", "html_url": "https://github.com/sibson/redbeat/issues/100", "id": 353513362, "node_id": "MDU6SXNzdWUzNTM1MTMzNjI=", "number": 100, "title": "When starting, takes a long time for initial beat start. Hangs at \"Acquiring lock...\"", "user": {"login": "metachris", "id": 116939, "node_id": "MDQ6VXNlcjExNjkzOQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/116939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/metachris", "html_url": "https://github.com/metachris", "followers_url": "https://api.github.com/users/metachris/followers", "following_url": "https://api.github.com/users/metachris/following{/other_user}", "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}", "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/metachris/subscriptions", "organizations_url": "https://api.github.com/users/metachris/orgs", "repos_url": "https://api.github.com/users/metachris/repos", "events_url": "https://api.github.com/users/metachris/events{/privacy}", "received_events_url": "https://api.github.com/users/metachris/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2018-08-23T19:06:05Z", "updated_at": "2018-09-10T09:43:03Z", "closed_at": "2018-09-10T09:43:03Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm using redbeat with AWS ElastiCache Redis.\r\n\r\nWhen I deploy a new version, the beat service starts, prints the Configuration, shows the stored entries (when running with loglevel DEBUG), and then hangs at `beat: Acquiring lock...` for a loooong time, about 10-30 minutes. Once it proceeds, after that amount of delay  the log says `beat: Extending lock...` and then immediate moves to `Selecting tasks` and proceeding.\r\n\r\nI only need redbeat to have multiple celery-beat instances not trigger periodic jobs multiple times.\r\n\r\nWondering why this takes so long (even when there is only one beat instance starting), and what I could try.\r\n\r\nEdit: I'm only seeing this issue after redeployments to our AWS infrastructure with ElastriCache, but cannot reproduce it in a local dev environment where Redis is cleared.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/99", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/99/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/99/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/99/events", "html_url": "https://github.com/sibson/redbeat/issues/99", "id": 353094758, "node_id": "MDU6SXNzdWUzNTMwOTQ3NTg=", "number": 99, "title": "Support for Redis SSL connections", "user": {"login": "gunthercox", "id": 2030578, "node_id": "MDQ6VXNlcjIwMzA1Nzg=", "avatar_url": "https://avatars1.githubusercontent.com/u/2030578?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gunthercox", "html_url": "https://github.com/gunthercox", "followers_url": "https://api.github.com/users/gunthercox/followers", "following_url": "https://api.github.com/users/gunthercox/following{/other_user}", "gists_url": "https://api.github.com/users/gunthercox/gists{/gist_id}", "starred_url": "https://api.github.com/users/gunthercox/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gunthercox/subscriptions", "organizations_url": "https://api.github.com/users/gunthercox/orgs", "repos_url": "https://api.github.com/users/gunthercox/repos", "events_url": "https://api.github.com/users/gunthercox/events{/privacy}", "received_events_url": "https://api.github.com/users/gunthercox/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-08-22T19:37:10Z", "updated_at": "2018-08-24T12:15:27Z", "closed_at": "2018-08-24T12:15:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "Does redbeat support SSL connections to redis?\r\n\r\nIn many cases such as Microsoft Azure's redis caches, SSL connections are required by default.\r\n~ https://docs.microsoft.com/en-us/azure/redis-cache/cache-configure#access-ports\r\n\r\nI noticed that Celery now has settings that allow SSL to be enabled but I can't seem to find anything in this repository that suggests that redbeat might support this type of connection.\r\n~ http://docs.celeryproject.org/en/latest/userguide/configuration.html#redis-backend-use-ssl\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/91", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/91/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/91/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/91/events", "html_url": "https://github.com/sibson/redbeat/issues/91", "id": 323641795, "node_id": "MDU6SXNzdWUzMjM2NDE3OTU=", "number": 91, "title": "Crontab Jobs being run twice at expected time", "user": {"login": "jgerry2002", "id": 10225304, "node_id": "MDQ6VXNlcjEwMjI1MzA0", "avatar_url": "https://avatars1.githubusercontent.com/u/10225304?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jgerry2002", "html_url": "https://github.com/jgerry2002", "followers_url": "https://api.github.com/users/jgerry2002/followers", "following_url": "https://api.github.com/users/jgerry2002/following{/other_user}", "gists_url": "https://api.github.com/users/jgerry2002/gists{/gist_id}", "starred_url": "https://api.github.com/users/jgerry2002/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jgerry2002/subscriptions", "organizations_url": "https://api.github.com/users/jgerry2002/orgs", "repos_url": "https://api.github.com/users/jgerry2002/repos", "events_url": "https://api.github.com/users/jgerry2002/events{/privacy}", "received_events_url": "https://api.github.com/users/jgerry2002/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-05-16T14:17:26Z", "updated_at": "2018-07-25T14:02:16Z", "closed_at": "2018-07-25T14:02:16Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to use redbeat with a test project as I am trying to integrate crontab jobs at specific times via Celery which is a core requirement of a project I am working on.\r\n\r\nI liked the concept of storing these jobs in real time in Redis, as it offers a resilient way to ensure jobs stay in the scheduler and are picked up as configuration changes in near real time.\r\n\r\nI am using the example configuration file from your project.\r\n\r\nIf I enter a job using the redbeat scheduler jobs are fired off twice at the expected time vs once:\r\n\r\ninterval = celery.schedules.crontab(minute=2, hour=14)\r\nentry = RedBeatSchedulerEntry('test task 4', 'tasksalt.example', interval, args=['testarg1', 'testarg2'],app=app)\r\nentry.save()\r\n\r\nBeat shows:\r\n[2018-05-16 10:01:55,672: INFO/MainProcess] Scheduler: Sending due task test task 4 (tasksalt.example)\r\n[2018-05-16 10:01:55,705: DEBUG/MainProcess] tasksalt.example sent. id->2d404bc8-24d6-49c9-8312-62be48377e08\r\n[2018-05-16 10:01:55,705: DEBUG/MainProcess] beat: Waking up in 4.33 seconds.\r\n[2018-05-16 10:02:00,037: DEBUG/MainProcess] beat: Extending lock...\r\n[2018-05-16 10:02:00,038: DEBUG/MainProcess] Selecting tasks\r\n[2018-05-16 10:02:00,039: INFO/MainProcess] Loading 1 tasks\r\n[2018-05-16 10:02:00,041: INFO/MainProcess] Scheduler: Sending due task test task 4 (tasksalt.example)\r\n[2018-05-16 10:02:00,043: DEBUG/MainProcess] tasksalt.example sent. id->fe15ba6e-c29a-4756-82c6-d0cf96d032d2\r\n[2018-05-16 10:02:00,043: DEBUG/MainProcess] beat: Waking up in 5.00 seconds.\r\n[2018-05-16 10:02:05,049: DEBUG/MainProcess] beat: Extending lock...\r\n[2018-05-16 10:02:05,050: DEBUG/MainProcess] Selecting tasks\r\n\r\nCelery shows the job being executed twice. I've tried to change the pooling interval both longer and shorter and it makes no difference.\r\n\r\nI also tried a once an hour job via crontab at a particular minute, which fired off twice, then ended up on a schedule of 1 time per hour after that. Is there some sort of initial evaluation / state that is being missed? It appears that the job may be ok after its first run.\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/90", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/90/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/90/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/90/events", "html_url": "https://github.com/sibson/redbeat/issues/90", "id": 322628051, "node_id": "MDU6SXNzdWUzMjI2MjgwNTE=", "number": 90, "title": "git", "user": {"login": "JoBaBe", "id": 28590541, "node_id": "MDQ6VXNlcjI4NTkwNTQx", "avatar_url": "https://avatars0.githubusercontent.com/u/28590541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoBaBe", "html_url": "https://github.com/JoBaBe", "followers_url": "https://api.github.com/users/JoBaBe/followers", "following_url": "https://api.github.com/users/JoBaBe/following{/other_user}", "gists_url": "https://api.github.com/users/JoBaBe/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoBaBe/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoBaBe/subscriptions", "organizations_url": "https://api.github.com/users/JoBaBe/orgs", "repos_url": "https://api.github.com/users/JoBaBe/repos", "events_url": "https://api.github.com/users/JoBaBe/events{/privacy}", "received_events_url": "https://api.github.com/users/JoBaBe/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-05-13T21:18:18Z", "updated_at": "2018-11-19T17:25:40Z", "closed_at": "2018-11-19T17:25:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/88", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/88/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/88/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/88/events", "html_url": "https://github.com/sibson/redbeat/issues/88", "id": 310268306, "node_id": "MDU6SXNzdWUzMTAyNjgzMDY=", "number": 88, "title": "Redbeat doesn't work with Celery `4.2.0rc1`", "user": {"login": "fangpenlin", "id": 201615, "node_id": "MDQ6VXNlcjIwMTYxNQ==", "avatar_url": "https://avatars3.githubusercontent.com/u/201615?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fangpenlin", "html_url": "https://github.com/fangpenlin", "followers_url": "https://api.github.com/users/fangpenlin/followers", "following_url": "https://api.github.com/users/fangpenlin/following{/other_user}", "gists_url": "https://api.github.com/users/fangpenlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/fangpenlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fangpenlin/subscriptions", "organizations_url": "https://api.github.com/users/fangpenlin/orgs", "repos_url": "https://api.github.com/users/fangpenlin/repos", "events_url": "https://api.github.com/users/fangpenlin/events{/privacy}", "received_events_url": "https://api.github.com/users/fangpenlin/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2018-03-31T20:08:36Z", "updated_at": "2019-04-04T00:24:11Z", "closed_at": "2019-04-04T00:24:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "Redbeat doesn't work with Celery `4.2.0rc1`\r\n\r\n```\r\nDuring handling of the above exception, another exception occurred:\r\nTraceback (most recent call last):\r\n  File \"/home/circleci/.local/share/virtualenvs/repo-eQF46Ow3/lib/python3.6/site-packages/_pytest/config.py\", line 371, in _importconftest\r\n    mod = conftestpath.pyimport()\r\n  File \"/home/circleci/.local/share/virtualenvs/repo-eQF46Ow3/lib/python3.6/site-packages/py/_path/local.py\", line 668, in pyimport\r\n    __import__(modname)\r\n  File \"<frozen importlib._bootstrap>\", line 971, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 955, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 656, in _load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 626, in _load_backward_compatible\r\n  File \"/home/circleci/.local/share/virtualenvs/repo-eQF46Ow3/lib/python3.6/site-packages/_pytest/assertion/rewrite.py\", line 213, in load_module\r\n    py.builtin.exec_(co, mod.__dict__)\r\n  File \"/home/circleci/repo/tests/conftest.py\", line 7, in <module>\r\n    from myapp.app import create_app\r\n  File \"/home/circleci/repo/myapp/app.py\", line 19, in <module>\r\n    from myapp.settings import ProdConfig\r\n  File \"/home/circleci/repo/myapp/settings.py\", line 7, in <module>\r\n    from redbeat.decoder import RedBeatJSONDecoder\r\n  File \"/home/circleci/.local/share/virtualenvs/repo-eQF46Ow3/lib/python3.6/site-packages/redbeat/__init__.py\", line 3, in <module>\r\n    from .schedulers import RedBeatScheduler, RedBeatSchedulerEntry  # noqa\r\n  File \"/home/circleci/.local/share/virtualenvs/repo-eQF46Ow3/lib/python3.6/site-packages/redbeat/schedulers.py\", line 39, in <module>\r\n    CELERY_4_OR_GREATER = StrictVersion(celery_version) >= StrictVersion('4.0')\r\n  File \"/usr/local/lib/python3.6/distutils/version.py\", line 40, in __init__\r\n    self.parse(vstring)\r\n  File \"/usr/local/lib/python3.6/distutils/version.py\", line 137, in parse\r\n    raise ValueError(\"invalid version number '%s'\" % vstring)\r\nValueError: invalid version number '4.2.0rc1'\r\n```\r\n\r\nsimilar problem from other project\r\n\r\nhttps://github.com/numpy/numpy/issues/7697\r\n\r\nSo I guess `distutils.version.StrictVersion` is not an ideal tool for determining the version of celery", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/87", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/87/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/87/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/87/events", "html_url": "https://github.com/sibson/redbeat/issues/87", "id": 308828524, "node_id": "MDU6SXNzdWUzMDg4Mjg1MjQ=", "number": 87, "title": "AttributeError: 'PersistentScheduler' object has no attribute 'lock_key'", "user": {"login": "kvbulusu", "id": 37825419, "node_id": "MDQ6VXNlcjM3ODI1NDE5", "avatar_url": "https://avatars2.githubusercontent.com/u/37825419?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kvbulusu", "html_url": "https://github.com/kvbulusu", "followers_url": "https://api.github.com/users/kvbulusu/followers", "following_url": "https://api.github.com/users/kvbulusu/following{/other_user}", "gists_url": "https://api.github.com/users/kvbulusu/gists{/gist_id}", "starred_url": "https://api.github.com/users/kvbulusu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kvbulusu/subscriptions", "organizations_url": "https://api.github.com/users/kvbulusu/orgs", "repos_url": "https://api.github.com/users/kvbulusu/repos", "events_url": "https://api.github.com/users/kvbulusu/events{/privacy}", "received_events_url": "https://api.github.com/users/kvbulusu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-03-27T05:39:30Z", "updated_at": "2018-04-12T21:36:24Z", "closed_at": "2018-04-12T21:36:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\nA newbie here...I'm seeing the following error when trying to insert task direction into redis using zadd. Here is what  I have\r\n\r\n\r\napp = Flask(__name__)\r\napp.config['broker_url'] = 'redis://localhost:6379/0'\r\napp.config['result_backend'] = 'redis://localhost:6379/0'\r\napp.config['redbeat_redis_url'] = \"redis://localhost:6379/1\"\r\napp.config['CELERY_BEAT_SCHEDULER '] = 'RedBeatScheduler'\r\napp.config['beat_max_loop_interval'] = 50\r\napp.config['result_expires'] = 60\r\ncelery = Celery(app.name, broker=app.config['broker_url'])\r\ncelery.conf.update(app.config)\r\nredis_url =  'redis://localhost:6379/0'\r\nr = redis.Redis.from_url( redis_url )\r\nscore = utc_time.timestamp + 450\r\nr.zadd('RedBeatScheduler', 'copdAlerts',score)\r\n\r\n%celery worker -A  test_v1.celery --loglevel=debug -E -B -S RedBeatScheduler\r\n\r\n[2018-03-26 22:24:26,039: ERROR/Beat] Signal handler <function acquire_distributed_beat_lock at 0x7f80b0dd3c08> raised: AttributeError(\"'PersistentScheduler' object has no attribute 'lock_key'\",)\r\nTraceback (most recent call last):\r\n  File \"/home/kvb/.virtualenvs/Notifications/local/lib/python2.7/site-packages/celery/utils/dispatch/signal.py\", line 233, in send\r\n    response = receiver(signal=self, sender=sender, **named)\r\n  File \"/home/kvb/.virtualenvs/Notifications/local/lib/python2.7/site-packages/redbeat/schedulers.py\", line 422, in acquire_distributed_beat_lock\r\nAttributeError: 'PersistentScheduler' object has no attribute 'lock_key'\r\n\r\nNot sure what else to debug or where to look...I checked the object doesnt have lock_key ....Any suggestions?\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/86", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/86/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/86/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/86/events", "html_url": "https://github.com/sibson/redbeat/issues/86", "id": 307607198, "node_id": "MDU6SXNzdWUzMDc2MDcxOTg=", "number": 86, "title": "How to ensure only one entry for scheduled job is added on subsequent restarts?", "user": {"login": "rajeshyogeshwar", "id": 7311146, "node_id": "MDQ6VXNlcjczMTExNDY=", "avatar_url": "https://avatars0.githubusercontent.com/u/7311146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rajeshyogeshwar", "html_url": "https://github.com/rajeshyogeshwar", "followers_url": "https://api.github.com/users/rajeshyogeshwar/followers", "following_url": "https://api.github.com/users/rajeshyogeshwar/following{/other_user}", "gists_url": "https://api.github.com/users/rajeshyogeshwar/gists{/gist_id}", "starred_url": "https://api.github.com/users/rajeshyogeshwar/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rajeshyogeshwar/subscriptions", "organizations_url": "https://api.github.com/users/rajeshyogeshwar/orgs", "repos_url": "https://api.github.com/users/rajeshyogeshwar/repos", "events_url": "https://api.github.com/users/rajeshyogeshwar/events{/privacy}", "received_events_url": "https://api.github.com/users/rajeshyogeshwar/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-03-22T11:37:31Z", "updated_at": "2019-08-23T04:06:40Z", "closed_at": "2019-08-23T04:06:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "I want to add an entry for a job into Redis when celery is started. In order to do so I need to ensure that the entry is not duplicated in subsequent restarts. Is there a way provided to do so? If not, is there a possibility for me checking by task name?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/83", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/83/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/83/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/83/events", "html_url": "https://github.com/sibson/redbeat/issues/83", "id": 297143856, "node_id": "MDU6SXNzdWUyOTcxNDM4NTY=", "number": 83, "title": "Lock disappearing?", "user": {"login": "mbarszcz", "id": 9357779, "node_id": "MDQ6VXNlcjkzNTc3Nzk=", "avatar_url": "https://avatars0.githubusercontent.com/u/9357779?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mbarszcz", "html_url": "https://github.com/mbarszcz", "followers_url": "https://api.github.com/users/mbarszcz/followers", "following_url": "https://api.github.com/users/mbarszcz/following{/other_user}", "gists_url": "https://api.github.com/users/mbarszcz/gists{/gist_id}", "starred_url": "https://api.github.com/users/mbarszcz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mbarszcz/subscriptions", "organizations_url": "https://api.github.com/users/mbarszcz/orgs", "repos_url": "https://api.github.com/users/mbarszcz/repos", "events_url": "https://api.github.com/users/mbarszcz/events{/privacy}", "received_events_url": "https://api.github.com/users/mbarszcz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-02-14T15:46:32Z", "updated_at": "2019-07-29T00:55:10Z", "closed_at": "2019-07-29T00:55:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\n\r\nWhen I run two instances of celerybeat with redbeat scheduler, at first things work as expected -- one instance acquires the lock, and the other waits. After some random time though, the other instance starts working, even though the original instance thinks it still have the lock.\r\n\r\nI've made following changes to debug this further:\r\nhttps://github.com/mbarszcz/redbeat/commit/23475450e8f52ac84ab5c10d813c6583e07d09ff\r\n\r\nThis is the output I'm getting on Worker A when things go well:\r\n\r\n[2018-02-14 23:58:19,819: DEBUG/MainProcess] Setting default socket timeout to 30\r\n[2018-02-14 23:58:19,819: INFO/MainProcess] beat: Starting...\r\n[2018-02-14 23:58:19,826: DEBUG/MainProcess] Stored entry: <RedBeatSchedulerEntry: co\r\nntent.zip_test.zip_test() content.zip_test.zip_test() <freq: 1.00 minute>\r\n[2018-02-14 23:58:19,827: DEBUG/MainProcess] beat: Ticking with max interval->5.00 se\r\nconds\r\n[2018-02-14 23:58:19,827: DEBUG/MainProcess] beat: Acquiring lock...\r\n[2018-02-14 23:58:19,828: DEBUG/MainProcess] beat: Extending lock by 60 seconds...\r\n[2018-02-14 23:58:19,828: DEBUG/MainProcess] Selecting tasks\r\n[2018-02-14 23:58:19,829: INFO/MainProcess] Loading 0 tasks\r\n[2018-02-14 23:58:19,829: DEBUG/MainProcess] beat: Waking up in 5.00 seconds.\r\n[2018-02-14 23:58:24,832: DEBUG/MainProcess] beat: Synchronizing schedule...\r\n[2018-02-14 23:58:24,832: DEBUG/MainProcess] beat: Extending lock by 60 seconds...\r\n[2018-02-14 23:58:24,833: DEBUG/MainProcess] Selecting tasks\r\n[...]\r\n\r\n\r\nAnd output on Worker B looks like this:\r\n\r\n[2018-02-15 00:00:20,724: DEBUG/MainProcess] Setting default socket timeout to 30\r\n[2018-02-15 00:00:20,725: INFO/MainProcess] beat: Starting...\r\n[2018-02-15 00:00:20,735: DEBUG/MainProcess] Stored entry: <RedBeatSchedulerEntry: content.zip_test.zip_test() content.zip_test.zip_test() <freq: 1.00 minute>\r\n[2018-02-15 00:00:20,737: DEBUG/MainProcess] beat: Ticking with max interval->5.00 seconds\r\n[2018-02-15 00:00:20,737: DEBUG/MainProcess] beat: Acquiring lock...\r\n\r\n\r\nAfter some time though, Worker A reports:\r\n\r\n[2018-02-15 00:23:20,183: DEBUG/MainProcess] beat: Extending lock by 60 seconds...\r\n[2018-02-15 00:23:20,184: DEBUG/MainProcess] Selecting tasks\r\n[2018-02-15 00:23:20,185: INFO/MainProcess] Loading 0 tasks\r\n[2018-02-15 00:23:20,185: DEBUG/MainProcess] beat: Waking up in 5.00 seconds.\r\n[2018-02-15 00:23:25,191: DEBUG/MainProcess] beat: Extending lock by 60 seconds...\r\n[2018-02-15 00:23:25,192: WARNING/MainProcess] The key does not exist\r\n\r\n\r\nAnd keeps running. Worker B also starts, because the lock is no longer there:\r\n\r\n\r\n[2018-02-15 00:00:20,737: DEBUG/MainProcess] beat: Acquiring lock...\r\n[2018-02-15 00:23:27,358: DEBUG/MainProcess] beat: Extending lock by 60 seconds...\r\n[2018-02-15 00:23:27,359: DEBUG/MainProcess] Selecting tasks\r\n[2018-02-15 00:23:27,361: INFO/MainProcess] Loading 0 tasks\r\n[2018-02-15 00:23:27,361: DEBUG/MainProcess] beat: Waking up in 5.00 seconds.\r\n\r\n\r\nI can see how I could work around it in redbeat (try to acquire lock again after it disappears), but what might be causing the disappearing lock in the first place? Worker A prolonged it on 00:23:20 by 60 seconds, and 5 seconds later it's no longer there.\r\n\r\nThe underlying redis is 3.2.10 on AWS ElasticCache.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/81", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/81/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/81/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/81/events", "html_url": "https://github.com/sibson/redbeat/issues/81", "id": 293440268, "node_id": "MDU6SXNzdWUyOTM0NDAyNjg=", "number": 81, "title": "Duplicate tasks", "user": {"login": "virusdefender", "id": 4939404, "node_id": "MDQ6VXNlcjQ5Mzk0MDQ=", "avatar_url": "https://avatars2.githubusercontent.com/u/4939404?v=4", "gravatar_id": "", "url": "https://api.github.com/users/virusdefender", "html_url": "https://github.com/virusdefender", "followers_url": "https://api.github.com/users/virusdefender/followers", "following_url": "https://api.github.com/users/virusdefender/following{/other_user}", "gists_url": "https://api.github.com/users/virusdefender/gists{/gist_id}", "starred_url": "https://api.github.com/users/virusdefender/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/virusdefender/subscriptions", "organizations_url": "https://api.github.com/users/virusdefender/orgs", "repos_url": "https://api.github.com/users/virusdefender/repos", "events_url": "https://api.github.com/users/virusdefender/events{/privacy}", "received_events_url": "https://api.github.com/users/virusdefender/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-02-01T08:18:23Z", "updated_at": "2019-06-13T19:57:43Z", "closed_at": "2019-05-10T03:24:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "https://github.com/virusdefender/redbeat_test\r\n\r\n```\r\napp.conf.beat_schedule = {\r\n    'task': {\r\n        'task': 'app.tasks.task_run',\r\n        'schedule': crontab(hour=8, minute=0)\r\n    },\r\n}\r\n```\r\n\r\nSet your computer's clock to 07:59:00 (UTC timezone)\r\n\r\nThen start the worker and redbeat process\r\n\r\n```\r\ncelery -A redbeat_test worker -l debug\r\n\r\ncelery beat -S redbeat.RedBeatScheduler -A redbeat_test -l debug\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/4939404/35668039-d0993316-076a-11e8-99c2-7f557c7b81a0.png)\r\n\r\nYou will see a task is submitted when redbeat is started at `2018-02-01 07:59:41,550`\r\n\r\nPS: \r\n\r\n - Maybe you need to flush redis between tests\r\n - It seems that a fresh task with `last_run_at == None` enters `maybe_xxx` logic will cause problem\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/79", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/79/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/79/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/79/events", "html_url": "https://github.com/sibson/redbeat/issues/79", "id": 290026564, "node_id": "MDU6SXNzdWUyOTAwMjY1NjQ=", "number": 79, "title": "crontab type job getting picked up at beat startup", "user": {"login": "dmonojit", "id": 2109822, "node_id": "MDQ6VXNlcjIxMDk4MjI=", "avatar_url": "https://avatars3.githubusercontent.com/u/2109822?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmonojit", "html_url": "https://github.com/dmonojit", "followers_url": "https://api.github.com/users/dmonojit/followers", "following_url": "https://api.github.com/users/dmonojit/following{/other_user}", "gists_url": "https://api.github.com/users/dmonojit/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmonojit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmonojit/subscriptions", "organizations_url": "https://api.github.com/users/dmonojit/orgs", "repos_url": "https://api.github.com/users/dmonojit/repos", "events_url": "https://api.github.com/users/dmonojit/events{/privacy}", "received_events_url": "https://api.github.com/users/dmonojit/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 15, "created_at": "2018-01-19T16:10:49Z", "updated_at": "2019-05-10T03:25:00Z", "closed_at": "2019-05-10T03:25:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI am trying to use `redbeat` for crontab type periodic jobs.\r\n\r\nThe problem I am facing is that, the job runs once when I start celery beat in a separate tab, and then it also runs at the scheduled time.\r\n\r\nThe second run is as expected, but not the first one. Could anyone help me out in this?\r\n\r\nMy `celery.py` is as follows,\r\n```\r\nCELERY_ACCEPT_CONTENT = ['json']\r\nCELERY_TASK_SERIALIZER = 'json'\r\nCELERY_RESULT_SERIALIZER = 'json'\r\nCELERY_BROKER_URL = 'redis://{redis_host}:{redis_port}/{redis_db}'.format(\r\n    redis_host=settings.REDIS_HOST, redis_port=settings.REDIS_PORT, redis_db=settings.REDIS_DB)\r\nCELERY_RESULT_BACKEND = CELERY_BROKER_URL\r\n\r\napp = Celery('tasks', broker=CELERY_BROKER_URL, backend=CELERY_RESULT_BACKEND, redbeat_redis_url=CELERY_BROKER_URL)\r\n\r\napp.conf.update(\r\n    accept_content=CELERY_ACCEPT_CONTENT,\r\n    task_serializer=CELERY_TASK_SERIALIZER,\r\n    result_serializer=CELERY_RESULT_SERIALIZER)\r\n\r\n# Using a string here means the worker don't have to serialize\r\n# the configuration object to child processes.\r\n# - namespace='CELERY' means all celery-related configuration keys\r\n#   should have a `CELERY_` prefix.\r\napp.config_from_object('django.conf:settings')\r\n\r\n# Load task modules from all registered Django app configs.\r\n# This is not required, but as you can have more than one app\r\n# with tasks it\u2019s better to do the autoload than declaring all tasks\r\n# in this same file.\r\napp.autodiscover_tasks(lambda: settings.INSTALLED_APPS)\r\n\r\n@app.on_after_configure.connect\r\ndef setup_periodic_tasks(sender, **kwargs):\r\n    from api.tasks import sample_add_task\r\n    sender.add_periodic_task(\r\n        **crontab(hour=15, minute=50)**,\r\n        sample_add_task.s(15, 30),\r\n        name='add everyday'\r\n    )\r\n```\r\n\r\n`sample_task.py`:\r\n```\r\nfrom __future__ import absolute_import\r\nfrom celery import task\r\n\r\n@task\r\ndef sample_add_task(number1, number2):\r\n    print('This is a sample add task for numbers: {0} and {1}'.format(number1, number2))\r\n    return(number1 + number2)\r\n```\r\n\r\nCelery worker command: `celery --app=app.celery worker --loglevel=INFO`\r\nCelery worker logs:\r\n```\r\n[19/Jan/2018 15:51:25] DEBUG [django.db.backends:89] (0.000) SET SQL_AUTO_IS_NULL = 0; args=None\r\n[19/Jan/2018 15:51:25] DEBUG [django.db.backends:89] (0.000) SHOW FULL TABLES; args=None\r\n[19/Jan/2018 15:51:25] DEBUG [django.db.backends:89] (0.000) SELECT `django_migrations`.`app`, `django_migrations`.`name` FROM `django_migrations`; args=()\r\n[19/Jan/2018 15:51:25] DEBUG [django.db.backends:89] (0.000) SET SQL_AUTO_IS_NULL = 0; args=None\r\n[19/Jan/2018 15:51:25] DEBUG [django.db.backends:89] (0.001) SHOW FULL TABLES; args=None\r\n[19/Jan/2018 15:51:25] DEBUG [django.db.backends:89] (0.000) SELECT `django_migrations`.`app`, `django_migrations`.`name` FROM `django_migrations`; args=()\r\n[2018-01-19 15:51:27,571: INFO/MainProcess] Connected to redis://localhost:6379/4\r\n[2018-01-19 15:51:27,577: INFO/MainProcess] mingle: searching for neighbors\r\n[2018-01-19 15:51:28,589: INFO/MainProcess] mingle: all alone\r\n[2018-01-19 15:51:28,595: INFO/MainProcess] celery@qplum-Precision-T1700 ready.\r\n[2018-01-19 15:51:31,494: INFO/MainProcess] Events of group {task} enabled by remote.\r\n\r\n\r\n[2018-01-19 15:51:46,508: INFO/MainProcess] Received task: api.tasks.sample_task.sample_add_task[15684a45-5f45-4070-a229-4331555e4863]  \r\n[2018-01-19 15:51:46,510: WARNING/ForkPoolWorker-7] This is a sample add task for numbers: 15 and 30\r\n[2018-01-19 15:51:46,512: INFO/ForkPoolWorker-7] Task api.tasks.sample_task.sample_add_task[15684a45-5f45-4070-a229-4331555e4863] succeeded in 0.0018646069802343845s: 45\r\n\r\n\r\n[2018-01-19 15:55:00,117: INFO/MainProcess] Received task: api.tasks.sample_task.sample_add_task[299ce531-a877-4925-886f-bb512c7caa2c]  \r\n[2018-01-19 15:55:00,121: WARNING/ForkPoolWorker-1] This is a sample add task for numbers: 15 and 30\r\n[2018-01-19 15:55:00,123: INFO/ForkPoolWorker-1] Task api.tasks.sample_task.sample_add_task[299ce531-a877-4925-886f-bb512c7caa2c] succeeded in 0.002788302954286337s: 45\r\n```\r\n\r\nCelery beat command: `celery beat -S redbeat.RedBeatScheduler --app=app.celery`\r\nCelery beat logs:\r\n```\r\ncelery beat v4.1.0 (latentcall) is starting.\r\n[19/Jan/2018 15:51:45] DEBUG [django.db.backends:89] (0.000) SET SQL_AUTO_IS_NULL = 0; args=None\r\n[19/Jan/2018 15:51:45] DEBUG [django.db.backends:89] (0.030) SHOW FULL TABLES; args=None\r\n[19/Jan/2018 15:51:45] DEBUG [django.db.backends:89] (0.000) SELECT `django_migrations`.`app`, `django_migrations`.`name` FROM `django_migrations`; args=()\r\n[19/Jan/2018 15:51:45] DEBUG [django.db.backends:89] (0.000) SET SQL_AUTO_IS_NULL = 0; args=None\r\n[19/Jan/2018 15:51:45] DEBUG [django.db.backends:89] (0.000) SHOW FULL TABLES; args=None\r\n[19/Jan/2018 15:51:45] DEBUG [django.db.backends:89] (0.000) SELECT `django_migrations`.`app`, `django_migrations`.`name` FROM `django_migrations`; args=()\r\n__    -    ... __   -        _\r\nLocalTime -> 2018-01-19 15:51:46\r\nConfiguration ->\r\n    . broker -> redis://localhost:6379/4\r\n    . loader -> celery.loaders.app.AppLoader\r\n    . scheduler -> redbeat.schedulers.RedBeatScheduler\r\n       . redis -> redis://localhost:6379/4\r\n       . lock -> `redbeat::lock` 25.00 minutes (1500s)\r\n    . logfile -> [stderr]@%WARNING\r\n    . maxinterval -> 5.00 minutes (300s)\r\n```\r\n\r\nRedis data of the job:\r\n\r\nAfter first run -\r\n```\r\n127.0.0.1:6379[4]> HGETALL \"redbeat:add everyday\"\r\n1) \"meta\"\r\n2) \"{\\\"last_run_at\\\": {\\\"day\\\": 19, \\\"hour\\\": 15, \\\"__type__\\\": \\\"datetime\\\", \\\"year\\\": 2018, \\\"month\\\": 1, \\\"second\\\": 46, \\\"microsecond\\\": 497316, \\\"minute\\\": 51}, \\\"total_run_count\\\": 1}\"\r\n3) \"definition\"\r\n4) \"{\\\"enabled\\\": true, \\\"args\\\": [15, 30], \\\"schedule\\\": {\\\"month_of_year\\\": \\\"*\\\", \\\"hour\\\": 15, \\\"__type__\\\": \\\"crontab\\\", \\\"day_of_week\\\": \\\"*\\\", \\\"day_of_month\\\": \\\"*\\\", \\\"minute\\\": 55}, \\\"name\\\": \\\"add everyday\\\", \\\"kwargs\\\": {}, \\\"task\\\": \\\"api.tasks.sample_task.sample_add_task\\\", \\\"options\\\": {}}\"\r\n```\r\n\r\nAfter second (scheduled) run -\r\n```\r\n127.0.0.1:6379[4]> HGETALL \"redbeat:add everyday\"\r\n1) \"meta\"\r\n2) \"{\\\"last_run_at\\\": {\\\"day\\\": 19, \\\"hour\\\": 15, \\\"__type__\\\": \\\"datetime\\\", \\\"year\\\": 2018, \\\"month\\\": 1, \\\"second\\\": 0, \\\"microsecond\\\": 112246, \\\"minute\\\": 55}, \\\"total_run_count\\\": 2}\"\r\n3) \"definition\"\r\n4) \"{\\\"enabled\\\": true, \\\"args\\\": [15, 30], \\\"schedule\\\": {\\\"month_of_year\\\": \\\"*\\\", \\\"hour\\\": 15, \\\"__type__\\\": \\\"crontab\\\", \\\"day_of_week\\\": \\\"*\\\", \\\"day_of_month\\\": \\\"*\\\", \\\"minute\\\": 55}, \\\"name\\\": \\\"add everyday\\\", \\\"kwargs\\\": {}, \\\"task\\\": \\\"api.tasks.sample_task.sample_add_task\\\", \\\"options\\\": {}}\"\r\n```\r\n\r\nClearly, the first run is not at all at the scheduled time and got triggered just after beat startup!\r\n\r\nPlease note, this issue does not happen when I use standard `PersistentScheduler` with celery beat.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/73", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/73/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/73/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/73/events", "html_url": "https://github.com/sibson/redbeat/issues/73", "id": 271758986, "node_id": "MDU6SXNzdWUyNzE3NTg5ODY=", "number": 73, "title": "example is needed", "user": {"login": "qlygirl", "id": 8034284, "node_id": "MDQ6VXNlcjgwMzQyODQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/8034284?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qlygirl", "html_url": "https://github.com/qlygirl", "followers_url": "https://api.github.com/users/qlygirl/followers", "following_url": "https://api.github.com/users/qlygirl/following{/other_user}", "gists_url": "https://api.github.com/users/qlygirl/gists{/gist_id}", "starred_url": "https://api.github.com/users/qlygirl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qlygirl/subscriptions", "organizations_url": "https://api.github.com/users/qlygirl/orgs", "repos_url": "https://api.github.com/users/qlygirl/repos", "events_url": "https://api.github.com/users/qlygirl/events{/privacy}", "received_events_url": "https://api.github.com/users/qlygirl/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-11-07T09:16:52Z", "updated_at": "2018-07-18T09:01:41Z", "closed_at": "2018-07-18T09:01:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "hi, i think this is a good project and want to use in my schedule job system. \r\nhowever i had met some problems when i'm using it. can you offer an small and complete example project? I know how to set config and set schedule info and so on, but still can't run them successfully. please? thank you", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/63", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/63/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/63/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/63/events", "html_url": "https://github.com/sibson/redbeat/issues/63", "id": 255880166, "node_id": "MDU6SXNzdWUyNTU4ODAxNjY=", "number": 63, "title": "Support for sentinel", "user": {"login": "arthurlogilab", "id": 445200, "node_id": "MDQ6VXNlcjQ0NTIwMA==", "avatar_url": "https://avatars0.githubusercontent.com/u/445200?v=4", "gravatar_id": "", "url": "https://api.github.com/users/arthurlogilab", "html_url": "https://github.com/arthurlogilab", "followers_url": "https://api.github.com/users/arthurlogilab/followers", "following_url": "https://api.github.com/users/arthurlogilab/following{/other_user}", "gists_url": "https://api.github.com/users/arthurlogilab/gists{/gist_id}", "starred_url": "https://api.github.com/users/arthurlogilab/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/arthurlogilab/subscriptions", "organizations_url": "https://api.github.com/users/arthurlogilab/orgs", "repos_url": "https://api.github.com/users/arthurlogilab/repos", "events_url": "https://api.github.com/users/arthurlogilab/events{/privacy}", "received_events_url": "https://api.github.com/users/arthurlogilab/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-09-07T09:52:28Z", "updated_at": "2017-10-18T20:16:44Z", "closed_at": "2017-10-18T20:16:44Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hi, we're using celery-redbeat on a redis server that will soon have a sentinel cluster around it and would love to have redbeat support for sentinel failover mechanisms (switch the redis connection to the new master when existing master falls).\r\n\r\nFor now, other parts our celery workers are just adding https://github.com/dealertrack/celery-redis-sentinel which works well. \r\n\r\nWe also have some redis client that use directly the sentinel support out of redis-py https://github.com/andymccurdy/redis-py#sentinel-support", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/60", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/60/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/60/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/60/events", "html_url": "https://github.com/sibson/redbeat/issues/60", "id": 237747813, "node_id": "MDU6SXNzdWUyMzc3NDc4MTM=", "number": 60, "title": "Support for iCal recurrence rules (RRULE)", "user": {"login": "concreted", "id": 4016897, "node_id": "MDQ6VXNlcjQwMTY4OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/4016897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/concreted", "html_url": "https://github.com/concreted", "followers_url": "https://api.github.com/users/concreted/followers", "following_url": "https://api.github.com/users/concreted/following{/other_user}", "gists_url": "https://api.github.com/users/concreted/gists{/gist_id}", "starred_url": "https://api.github.com/users/concreted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/concreted/subscriptions", "organizations_url": "https://api.github.com/users/concreted/orgs", "repos_url": "https://api.github.com/users/concreted/repos", "events_url": "https://api.github.com/users/concreted/events{/privacy}", "received_events_url": "https://api.github.com/users/concreted/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-06-22T06:51:25Z", "updated_at": "2017-09-23T03:47:13Z", "closed_at": "2017-09-23T03:47:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I would like to add support for schedules defined with [RRules](http://dateutil.readthedocs.io/en/stable/_modules/dateutil/rrule.html#rrule) based on the iCal RFC (https://icalendar.org/iCalendar-RFC-5545/3-8-5-3-recurrence-rule.html). I think the scope of work involved would be:\r\n1. Implement a `RRuleSchedule` class that inherits from `celery.schedules.BaseSchedule` and implements `remaining_estimate` and `is_due` methods (using `dateutil.rrule`)\r\n1. Update `RedBeatJSONDecoder` and `RedBeatJSONEncoder` to handle the new class\r\n1. To handle RRules that end after a certain date/after a certain number of occurrences, add a way to mark schedules as 'inactive' after its last occurrence, so Redbeat will ignore them. Not sure exactly what this looks like yet\r\n\r\n@sibson How does this sound to you? Does the scope of work look accurate or is there anything else that would be needed? Interested in your thoughts on how to best implement point 3.\r\n\r\nI'm actively working on a project using Redbeat, and having RRULE support directly in Redbeat would make things easier for my use case (avoid having to convert RRULEs to cron timings, being able to let Redbeat take care of schedules that end after some time instead of adding logic externally). If you think this is worth doing in mainline Redbeat I can have a WIP PR later this week for you to look at.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/58", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/58/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/58/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/58/events", "html_url": "https://github.com/sibson/redbeat/issues/58", "id": 236569518, "node_id": "MDU6SXNzdWUyMzY1Njk1MTg=", "number": 58, "title": "RedBeatScheduler does not receive lock_timeout from app config", "user": {"login": "concreted", "id": 4016897, "node_id": "MDQ6VXNlcjQwMTY4OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/4016897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/concreted", "html_url": "https://github.com/concreted", "followers_url": "https://api.github.com/users/concreted/followers", "following_url": "https://api.github.com/users/concreted/following{/other_user}", "gists_url": "https://api.github.com/users/concreted/gists{/gist_id}", "starred_url": "https://api.github.com/users/concreted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/concreted/subscriptions", "organizations_url": "https://api.github.com/users/concreted/orgs", "repos_url": "https://api.github.com/users/concreted/repos", "events_url": "https://api.github.com/users/concreted/events{/privacy}", "received_events_url": "https://api.github.com/users/concreted/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-06-16T19:13:00Z", "updated_at": "2017-06-17T03:40:10Z", "closed_at": "2017-06-17T03:40:10Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "After updating `exampleconf.py` to include:\r\n```\r\nREDBEAT_LOCK_TIMEOUT = 15\r\n```\r\n\r\nRunning `PYTHONPATH=. celery beat --config exampleconf` still shows the default `lock_timeout`:\r\n```\r\n(.venv) Arics-MacBook-Pro:redbeat aric$ PYTHONPATH=. celery beat --config exampleconf\r\ncelery beat v4.0.2 (latentcall) is starting.\r\n__    -    ... __   -        _\r\nLocalTime -> 2017-06-16 12:04:19\r\nConfiguration ->\r\n    . broker -> redis://localhost:6379//\r\n    . loader -> celery.loaders.default.Loader\r\n    . scheduler -> redbeat.schedulers.RedBeatScheduler\r\n       . redis -> redis://\r\n       . lock -> `redbeat::lock` 25.00 minutes (1500s)\r\n    . logfile -> [stderr]@%WARNING\r\n    . maxinterval -> 5.00 seconds (5s)\r\n```\r\n\r\nChecking the `redbeat::lock` key in Redis, it shows a TTL of 1500s rather than 15. ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/57", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/57/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/57/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/57/events", "html_url": "https://github.com/sibson/redbeat/issues/57", "id": 236054052, "node_id": "MDU6SXNzdWUyMzYwNTQwNTI=", "number": 57, "title": "Issues with Redis Cluster", "user": {"login": "concreted", "id": 4016897, "node_id": "MDQ6VXNlcjQwMTY4OTc=", "avatar_url": "https://avatars2.githubusercontent.com/u/4016897?v=4", "gravatar_id": "", "url": "https://api.github.com/users/concreted", "html_url": "https://github.com/concreted", "followers_url": "https://api.github.com/users/concreted/followers", "following_url": "https://api.github.com/users/concreted/following{/other_user}", "gists_url": "https://api.github.com/users/concreted/gists{/gist_id}", "starred_url": "https://api.github.com/users/concreted/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/concreted/subscriptions", "organizations_url": "https://api.github.com/users/concreted/orgs", "repos_url": "https://api.github.com/users/concreted/repos", "events_url": "https://api.github.com/users/concreted/events{/privacy}", "received_events_url": "https://api.github.com/users/concreted/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-06-15T01:39:08Z", "updated_at": "2017-10-18T20:17:19Z", "closed_at": "2017-10-18T20:17:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Is saving/fetching jobs meant to work with clustered Redis? I get the following errors when pointing Redbeat to a cluster. The same code works fine with non-clustered Redis.\r\n\r\nSaving a job:\r\n```\r\n  File \"<Test Code>\", line 26, in register_crontab_job\r\n    RedBeatSchedulerEntry(name, task_name, cron, args=args, kwargs=kwargs, app=app).save()\r\n  File \"/usr/local/lib/python2.7/site-packages/redbeat/schedulers.py\", line 211, in save\r\n    pipe.execute()\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/client.py\", line 2626, in execute\r\n    return execute(conn, stack, raise_on_error)\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/client.py\", line 2523, in _execute_transaction\r\n    raise errors[0][1]\r\nResponseError: Command # 1 (HSET redbeat:foobar definition {\"task\": \"echo\", \"name\": \"foobar\", \"schedule\": {\"hour\": \"*\", \"__type__\": \"crontab\", \"day_of_month\": \"*\", \"day_of_week\": \"*\", \"month_of_year\": \"*\", \"minute\": \"*\"}, \"args\": [\"foobar\"], \"enabled\": true, \"kwargs\": null, \"options\": {}}) of pipeline caused error: MOVED 8184 <HOST>:6379\r\n```\r\n\r\nFetching a job:\r\n```\r\n  File \"<Test Code>\", line 31, in get_periodic_job\r\n    job = RedBeatSchedulerEntry.from_key(name, app=self.app)\r\n  File \"/usr/local/lib/python2.7/site-packages/redbeat/schedulers.py\", line 157, in from_key\r\n    definition, meta = pipe.execute()\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/client.py\", line 2626, in execute\r\n    return execute(conn, stack, raise_on_error)\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/client.py\", line 2523, in _execute_transaction\r\n    raise errors[0][1]\r\nResponseError: Command # 1 (HGET redbeat:foobar definition) of pipeline caused error: MOVED 8184 172.30.2.228:6379\r\n```\r\n\r\nAlso, if I select a database in the `redbeat_redis_url`, I get this error:\r\n```\r\n  File \"<Test Code>\", line 26, in register_crontab_job\r\n    RedBeatSchedulerEntry(name, task_name, cron, args=args, kwargs=kwargs, app=app).save()\r\n  File \"/usr/local/lib/python2.7/site-packages/redbeat/schedulers.py\", line 211, in save\r\n    pipe.execute()\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/client.py\", line 2626, in execute\r\n    return execute(conn, stack, raise_on_error)\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/client.py\", line 2495, in _execute_transaction\r\n    connection.send_packed_command(all_cmds)\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/connection.py\", line 538, in send_packed_command\r\n    self.connect()\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/connection.py\", line 446, in connect\r\n    self.on_connect()\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/connection.py\", line 520, in on_connect\r\n    if nativestr(self.read_response()) != 'OK':\r\n  File \"/usr/local/lib/python2.7/site-packages/redis/connection.py\", line 582, in read_response\r\n    raise response\r\nResponseError: SELECT is not allowed in cluster mode\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/54", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/54/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/54/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/54/events", "html_url": "https://github.com/sibson/redbeat/issues/54", "id": 227091537, "node_id": "MDU6SXNzdWUyMjcwOTE1Mzc=", "number": 54, "title": "add travis ci badge to readme", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-05-08T15:52:56Z", "updated_at": "2017-05-11T04:52:18Z", "closed_at": "2017-05-11T04:52:18Z", "author_association": "OWNER", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/52", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/52/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/52/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/52/events", "html_url": "https://github.com/sibson/redbeat/issues/52", "id": 226515249, "node_id": "MDU6SXNzdWUyMjY1MTUyNDk=", "number": 52, "title": "Continuous testing?", "user": {"login": "jezdez", "id": 1610, "node_id": "MDQ6VXNlcjE2MTA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1610?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jezdez", "html_url": "https://github.com/jezdez", "followers_url": "https://api.github.com/users/jezdez/followers", "following_url": "https://api.github.com/users/jezdez/following{/other_user}", "gists_url": "https://api.github.com/users/jezdez/gists{/gist_id}", "starred_url": "https://api.github.com/users/jezdez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jezdez/subscriptions", "organizations_url": "https://api.github.com/users/jezdez/orgs", "repos_url": "https://api.github.com/users/jezdez/repos", "events_url": "https://api.github.com/users/jezdez/events{/privacy}", "received_events_url": "https://api.github.com/users/jezdez/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-05-05T09:12:58Z", "updated_at": "2017-05-08T15:52:42Z", "closed_at": "2017-05-08T15:52:42Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I was wondering if you'd be interested in my contributing a Travis CI setup so the test suite can be run automatically when PRs come in?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/50", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/50/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/50/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/50/events", "html_url": "https://github.com/sibson/redbeat/issues/50", "id": 226321631, "node_id": "MDU6SXNzdWUyMjYzMjE2MzE=", "number": 50, "title": "Lock timeout config value not correctly applied on Celery 4.x", "user": {"login": "jezdez", "id": 1610, "node_id": "MDQ6VXNlcjE2MTA=", "avatar_url": "https://avatars0.githubusercontent.com/u/1610?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jezdez", "html_url": "https://github.com/jezdez", "followers_url": "https://api.github.com/users/jezdez/followers", "following_url": "https://api.github.com/users/jezdez/following{/other_user}", "gists_url": "https://api.github.com/users/jezdez/gists{/gist_id}", "starred_url": "https://api.github.com/users/jezdez/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jezdez/subscriptions", "organizations_url": "https://api.github.com/users/jezdez/orgs", "repos_url": "https://api.github.com/users/jezdez/repos", "events_url": "https://api.github.com/users/jezdez/events{/privacy}", "received_events_url": "https://api.github.com/users/jezdez/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 20, "created_at": "2017-05-04T15:35:16Z", "updated_at": "2017-05-11T04:55:20Z", "closed_at": "2017-05-09T06:56:48Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When using redbeat on Celery 4.x it seems as if using `app.conf.CELERYBEAT_MAX_LOOP_INTERVAL` is wrong.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/49", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/49/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/49/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/49/events", "html_url": "https://github.com/sibson/redbeat/issues/49", "id": 225811807, "node_id": "MDU6SXNzdWUyMjU4MTE4MDc=", "number": 49, "title": "Celery 4.* Compatibility", "user": {"login": "eswald", "id": 67649, "node_id": "MDQ6VXNlcjY3NjQ5", "avatar_url": "https://avatars0.githubusercontent.com/u/67649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/eswald", "html_url": "https://github.com/eswald", "followers_url": "https://api.github.com/users/eswald/followers", "following_url": "https://api.github.com/users/eswald/following{/other_user}", "gists_url": "https://api.github.com/users/eswald/gists{/gist_id}", "starred_url": "https://api.github.com/users/eswald/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/eswald/subscriptions", "organizations_url": "https://api.github.com/users/eswald/orgs", "repos_url": "https://api.github.com/users/eswald/repos", "events_url": "https://api.github.com/users/eswald/events{/privacy}", "received_events_url": "https://api.github.com/users/eswald/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-05-02T20:29:38Z", "updated_at": "2017-05-11T04:43:38Z", "closed_at": "2017-05-11T04:43:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Currently, importing `redbeat.RedBeatScheduler` fails when using Celery 4.0.2, because `celery.utils.timeutils` has been renamed to `celery.utils.time`.  Then, the default schedule is ignored, because the configuration key has been renamed from `CELERYBEAT_SCHEDULE` to `beat_schedule`.  And that looks like just the tip of the iceberg.\r\n\r\nMeanwhile, it may or may not be worth supporting multiple `celery` versions with a single codebase, but it's probably a good idea to document which versions are supported.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/48", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/48/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/48/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/48/events", "html_url": "https://github.com/sibson/redbeat/issues/48", "id": 222038339, "node_id": "MDU6SXNzdWUyMjIwMzgzMzk=", "number": 48, "title": "can I use redbeat with Django (1.8.8)", "user": {"login": "chapkovski", "id": 5639776, "node_id": "MDQ6VXNlcjU2Mzk3NzY=", "avatar_url": "https://avatars2.githubusercontent.com/u/5639776?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chapkovski", "html_url": "https://github.com/chapkovski", "followers_url": "https://api.github.com/users/chapkovski/followers", "following_url": "https://api.github.com/users/chapkovski/following{/other_user}", "gists_url": "https://api.github.com/users/chapkovski/gists{/gist_id}", "starred_url": "https://api.github.com/users/chapkovski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chapkovski/subscriptions", "organizations_url": "https://api.github.com/users/chapkovski/orgs", "repos_url": "https://api.github.com/users/chapkovski/repos", "events_url": "https://api.github.com/users/chapkovski/events{/privacy}", "received_events_url": "https://api.github.com/users/chapkovski/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-04-16T22:50:17Z", "updated_at": "2017-06-12T03:53:52Z", "closed_at": "2017-04-17T01:33:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "an attempt to use it fails - it doesn't catch the settings from settings.py. ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/47", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/47/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/47/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/47/events", "html_url": "https://github.com/sibson/redbeat/issues/47", "id": 222034516, "node_id": "MDU6SXNzdWUyMjIwMzQ1MTY=", "number": 47, "title": "an error when starting beat", "user": {"login": "chapkovski", "id": 5639776, "node_id": "MDQ6VXNlcjU2Mzk3NzY=", "avatar_url": "https://avatars2.githubusercontent.com/u/5639776?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chapkovski", "html_url": "https://github.com/chapkovski", "followers_url": "https://api.github.com/users/chapkovski/followers", "following_url": "https://api.github.com/users/chapkovski/following{/other_user}", "gists_url": "https://api.github.com/users/chapkovski/gists{/gist_id}", "starred_url": "https://api.github.com/users/chapkovski/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chapkovski/subscriptions", "organizations_url": "https://api.github.com/users/chapkovski/orgs", "repos_url": "https://api.github.com/users/chapkovski/repos", "events_url": "https://api.github.com/users/chapkovski/events{/privacy}", "received_events_url": "https://api.github.com/users/chapkovski/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2017-04-16T21:30:34Z", "updated_at": "2017-04-17T02:56:08Z", "closed_at": "2017-04-17T02:56:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "with Celery 4, an attempt to run a process\r\n\r\n``` python\r\n  File \"/Users/chapkovski/mynewotree/lib/python3.5/site-packages/redbeat/__init__.py\", line 3, in <module>\r\n    from .schedulers import RedBeatScheduler, RedBeatSchedulerEntry  # noqa\r\n  File \"/Users/chapkovski/mynewotree/lib/python3.5/site-packages/redbeat/schedulers.py\", line 19, in <module>\r\n    from celery.utils.timeutils import humanize_seconds\r\nImportError: No module named 'celery.utils.timeutils'\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/44", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/44/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/44/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/44/events", "html_url": "https://github.com/sibson/redbeat/issues/44", "id": 198417762, "node_id": "MDU6SXNzdWUxOTg0MTc3NjI=", "number": 44, "title": "CI for celery 3.x and 4.x ", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-01-03T06:36:26Z", "updated_at": "2017-01-07T06:54:51Z", "closed_at": "2017-01-07T06:54:51Z", "author_association": "OWNER", "active_lock_reason": null, "body": "#43 introduces compatibly for 3.x and 4.x but doesn't include CI coverage to ensure both cases continue to work.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/41", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/41/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/41/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/41/events", "html_url": "https://github.com/sibson/redbeat/issues/41", "id": 192011972, "node_id": "MDU6SXNzdWUxOTIwMTE5NzI=", "number": 41, "title": "hi there is some wrong\uff0cit is cant no load the  \u201cREDBEAT_REDIS_URL\u201d correctly", "user": {"login": "sonlia", "id": 1559999, "node_id": "MDQ6VXNlcjE1NTk5OTk=", "avatar_url": "https://avatars1.githubusercontent.com/u/1559999?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sonlia", "html_url": "https://github.com/sonlia", "followers_url": "https://api.github.com/users/sonlia/followers", "following_url": "https://api.github.com/users/sonlia/following{/other_user}", "gists_url": "https://api.github.com/users/sonlia/gists{/gist_id}", "starred_url": "https://api.github.com/users/sonlia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sonlia/subscriptions", "organizations_url": "https://api.github.com/users/sonlia/orgs", "repos_url": "https://api.github.com/users/sonlia/repos", "events_url": "https://api.github.com/users/sonlia/events{/privacy}", "received_events_url": "https://api.github.com/users/sonlia/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2016-11-28T13:56:08Z", "updated_at": "2017-07-28T07:25:20Z", "closed_at": "2016-11-28T16:20:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "celery beat v3.1.21 (Cipater) is starting.\r\n__    -    ... __   -        _\r\nConfiguration ->\r\n    . broker -> amqp://guest:**@localhost:5672//\r\n    . loader -> celery.loaders.default.Loader\r\n    . scheduler -> redbeat.schedulers.RedBeatScheduler\r\n       . redis -> None\r\n       . lock -> `redbeat::lock` now (0s)\r\n    . logfile -> [stderr]@%INFO\r\n    . maxinterval -> now (0s)\r\n[2016-11-28 13:50:38,391: INFO/MainProcess] beat: Starting...\r\n[2016-11-28 13:50:38,392: CRITICAL/MainProcess] beat raised exception <type 'exceptions.AttributeError'>: AttributeError(\"'NoneType' object has no attribute 'find'\",)\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python2.7/dist-packages/celery/apps/beat.py\", line 112, in start_scheduler\r\n    beat.start()\r\n  File \"/usr/local/lib/python2.7/dist-packages/celery/beat.py\", line 470, in start\r\n    humanize_seconds(self.scheduler.max_interval))\r\n  File \"/usr/local/lib/python2.7/dist-packages/kombu/utils/__init__.py\", line 325, in __get__\r\n    value = obj.__dict__[self.__name__] = self.__get(obj)\r\n  File \"/usr/local/lib/python2.7/dist-packages/celery/beat.py\", line 512, in scheduler\r\n    return self.get_scheduler()\r\n  File \"/usr/local/lib/python2.7/dist-packages/celery/beat.py\", line 507, in get_scheduler\r\n    lazy=lazy)\r\n  File \"/usr/local/lib/python2.7/dist-packages/celery/utils/imports.py\", line 53, in instantiate\r\n    return symbol_by_name(name)(*args, **kwargs)\r\n  File \"build/bdist.linux-x86_64/egg/redbeat/schedulers.py\", line 190, in __init__\r\n    super(RedBeatScheduler, self).__init__(app, **kwargs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/celery/beat.py\", line 185, in __init__\r\n    self.setup_schedule()\r\n  File \"build/bdist.linux-x86_64/egg/redbeat/schedulers.py\", line 194, in setup_schedule\r\n    client = redis(self.app)\r\n  File \"build/bdist.linux-x86_64/egg/redbeat/schedulers.py\", line 45, in redis\r\n    decode_responses=True)\r\n  File \"/usr/local/lib/python2.7/dist-packages/redis/client.py\", line 391, in from_url\r\n    connection_pool = ConnectionPool.from_url(url, db=db, **kwargs)\r\n  File \"/usr/local/lib/python2.7/dist-packages/redis/connection.py\", line 774, in from_url\r\n    url = urlparse(url)\r\n  File \"/usr/lib/python2.7/urlparse.py\", line 143, in urlparse\r\n    tuple = urlsplit(url, scheme, allow_fragments)\r\n  File \"/usr/lib/python2.7/urlparse.py\", line 182, in urlsplit\r\n    i = url.find(':')\r\nAttributeError: 'NoneType' object has no attribute 'find'\r\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\r\nand the config \r\n![uc 20161128215301](https://cloud.githubusercontent.com/assets/1559999/20670763/75ab9492-b5b5-11e6-851b-5fa5cf7c2fbf.png)\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/40", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/40/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/40/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/40/events", "html_url": "https://github.com/sibson/redbeat/issues/40", "id": 181883855, "node_id": "MDU6SXNzdWUxODE4ODM4NTU=", "number": 40, "title": "how to add tasks?", "user": {"login": "zinwalin", "id": 5416196, "node_id": "MDQ6VXNlcjU0MTYxOTY=", "avatar_url": "https://avatars3.githubusercontent.com/u/5416196?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zinwalin", "html_url": "https://github.com/zinwalin", "followers_url": "https://api.github.com/users/zinwalin/followers", "following_url": "https://api.github.com/users/zinwalin/following{/other_user}", "gists_url": "https://api.github.com/users/zinwalin/gists{/gist_id}", "starred_url": "https://api.github.com/users/zinwalin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zinwalin/subscriptions", "organizations_url": "https://api.github.com/users/zinwalin/orgs", "repos_url": "https://api.github.com/users/zinwalin/repos", "events_url": "https://api.github.com/users/zinwalin/events{/privacy}", "received_events_url": "https://api.github.com/users/zinwalin/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-10-09T12:16:00Z", "updated_at": "2016-10-26T02:20:08Z", "closed_at": "2016-10-26T02:20:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "py.test: \n\n (app_env) RMBP\u279c  redbeat git:(master) \u2717  >py.test tests\n======================================== test session starts ========================================\nplatform darwin -- Python 2.7.10, pytest-3.0.3, py-1.4.31, pluggy-0.4.0\nrootdir: /Users/michael/Development/redbeat, inifile:\nplugins: catchlog-1.2.2, cov-2.3.1\ncollected 20 items\n\ntests/test_entry.py ..........\ntests/test_json.py ......\ntests/test_scheduler.py ...\ntests/test_utils.py .\n\ncelery beat:\n\n[2016-10-10 01:15:23,716: INFO/MainProcess] Loading 0 tasks\n[2016-10-10 01:15:28,711: INFO/MainProcess] Loading 0 tasks\n[2016-10-10 01:15:33,707: INFO/MainProcess] Loading 0 tasks\n[2016-10-10 01:15:38,698: INFO/MainProcess] Loading 0 tasks\n[2016-10-10 01:15:43,691: INFO/MainProcess] Loading 0 tasks\n[2016-10-10 01:15:48,684: INFO/MainProcess] Loading 0 tasks\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/37", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/37/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/37/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/37/events", "html_url": "https://github.com/sibson/redbeat/issues/37", "id": 171914298, "node_id": "MDU6SXNzdWUxNzE5MTQyOTg=", "number": 37, "title": "OverflowError('date value out of range',) when CELERY_TIMEZONE has negative UTC offset", "user": {"login": "SpotlightKid", "id": 5719151, "node_id": "MDQ6VXNlcjU3MTkxNTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/5719151?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SpotlightKid", "html_url": "https://github.com/SpotlightKid", "followers_url": "https://api.github.com/users/SpotlightKid/followers", "following_url": "https://api.github.com/users/SpotlightKid/following{/other_user}", "gists_url": "https://api.github.com/users/SpotlightKid/gists{/gist_id}", "starred_url": "https://api.github.com/users/SpotlightKid/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SpotlightKid/subscriptions", "organizations_url": "https://api.github.com/users/SpotlightKid/orgs", "repos_url": "https://api.github.com/users/SpotlightKid/repos", "events_url": "https://api.github.com/users/SpotlightKid/events{/privacy}", "received_events_url": "https://api.github.com/users/SpotlightKid/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2016-08-18T14:26:17Z", "updated_at": "2016-08-30T19:53:29Z", "closed_at": "2016-08-30T19:53:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This happens when a task is written into Redis and then on the next tick, when the task is loaded from Redis and `.is_due()` is called on the task:\n\n```\n{ \"pid\": 31792, \"message\": \"Selecting tasks\", \"python_module\": \"redbeat.schedulers\", \"level\": \"DEBUG\", \"timestamp\": \"2016-08-12 09:24:11,855\" }\n{ \"pid\": 31792, \"message\": \"Loading 1 tasks\", \"python_module\": \"redbeat.schedulers\", \"level\": \"INFO\", \"timestamp\": \"2016-08-12 09:24:11,856\" }\n{ \"pid\": 31792, \"message\": \"Processing tasks\", \"python_module\": \"redbeat.schedulers\", \"level\": \"DEBUG\", \"timestamp\": \"2016-08-12 09:24:11,857\" }\n{ \"pid\": 31792, \"message\": \"beat: Releasing Lock\", \"python_module\": \"redbeat.schedulers\", \"level\": \"DEBUG\", \"timestamp\": \"2016-08-12 09:24:11,870\" }\n{ \"pid\": 31792, \"message\": \"beat raised exception <type 'exceptions.OverflowError'>: OverflowError('date value out of range',)\", \"python_module\": \"celery.beat\", \"level\": \"CRITICAL\", \"timesta\nmp\": \"2016-08-12 09:24:11,872\" }\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/apps/beat.py\", line 112, in start_scheduler\n    beat.start()\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/beat.py\", line 463, in start\n    interval = self.scheduler.tick()\n  File \"/usr/local/lib/python2.7/dist-packages/redbeat/schedulers.py\", line 264, in tick\n    return super(RedBeatScheduler, self).tick(**kwargs)\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/beat.py\", line 221, in tick\n    next_time_to_run = self.maybe_due(entry, self.publisher)\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/beat.py\", line 199, in maybe_due\n    is_due, next_time_to_run = entry.is_due()\n  File \"/usr/local/lib/python2.7/dist-packages/redbeat/schedulers.py\", line 175, in is_due\n    return super(RedBeatSchedulerEntry, self).is_due()\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/beat.py\", line 129, in is_due\n    return self.schedule.is_due(self.last_run_at)\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/schedules.py\", line 117, in is_due\n    last_run_at = self.maybe_make_aware(last_run_at)\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/schedules.py\", line 126, in maybe_make_aware\n    return maybe_make_aware(dt, self.tz)\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/utils/timeutils.py\", line 313, in maybe_make_aware\n    dt, timezone.utc if tz is None else timezone.tz_or_local(tz),\n  File \"/usr/local/lib/python2.7/dist-packages/celery-3.1.17-py2.7.egg/celery/utils/timeutils.py\", line 289, in localize\n    dt = dt.astimezone(tz)\n  File \"/usr/local/lib/python2.7/dist-packages/pytz/tzinfo.py\", line 187, in fromutc\n    return (dt + inf[0]).replace(tzinfo=self._tzinfos[inf])\nOverflowError: date value out of range\n```\n\nAnalysis:\n- Happens only when CELERY_TIMEZONE is set to a timezone with a negative UTC offset (e.g. \"America/Chicago\" in our case\n- Task has never run before\n\nWhen Redbeat loads a task from Redis (`redBeatdSchedulerEntry.from_key`) it tries to get the `last_run_at` attribute value from the `meta` dict in the Redis hashset of the task. When the task has never run, this is empty, so it sets `last_run_at` to `datetime.min`. Then in `is_due` (down the call chain), `last_run_at` is passed to `celery.utils.timeutils.maybe_make_aware`, which tries to convert the timestamp into a timezone-aware datetime object, _using the scheduler timezone_. This lead to the `OverflowError`, because you can't apply a negative offset to `datetime.min`.\n\nProposed solution: \n\nIf `last_run_at` is not set in the task meta info, set it to `None` and in `RedBeatSchedulerEntry.is_due`, if  `last_run_at` is None, pass `datetime.dtatime(datetime.MINYEAR, 1, 1, tzinfo=self.schedule.tz)` to `self.schedule.is_due`. In `RedBeatSchedulerEntry.is_at` if  `last_run_at` is None, return `self._default_now()`.\n\nI'll prepare a PR for this.\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/36", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/36/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/36/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/36/events", "html_url": "https://github.com/sibson/redbeat/issues/36", "id": 170723381, "node_id": "MDU6SXNzdWUxNzA3MjMzODE=", "number": 36, "title": "Exception raised when calling task.revoke()", "user": {"login": "fxt", "id": 753110, "node_id": "MDQ6VXNlcjc1MzExMA==", "avatar_url": "https://avatars3.githubusercontent.com/u/753110?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxt", "html_url": "https://github.com/fxt", "followers_url": "https://api.github.com/users/fxt/followers", "following_url": "https://api.github.com/users/fxt/following{/other_user}", "gists_url": "https://api.github.com/users/fxt/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxt/subscriptions", "organizations_url": "https://api.github.com/users/fxt/orgs", "repos_url": "https://api.github.com/users/fxt/repos", "events_url": "https://api.github.com/users/fxt/events{/privacy}", "received_events_url": "https://api.github.com/users/fxt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2016-08-11T19:15:02Z", "updated_at": "2016-08-12T20:58:40Z", "closed_at": "2016-08-12T20:58:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "We are getting exceptions in the celery-redbeat logs when using task.revoke():\n\n[2016-08-11 15:10:55,512: INFO/MainProcess] beat: Starting...\n[2016-08-11 15:10:55,537: CRITICAL/MainProcess] beat raised exception <type 'exceptions.AttributeError'>: AttributeError(\"'NoneType' object has no attribute 'now'\",)\nTraceback (most recent call last):\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/apps/beat.py\", line 112, in start_scheduler\n    beat.start()\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/beat.py\", line 454, in start\n    humanize_seconds(self.scheduler.max_interval))\n  File \".../eggs/kombu-3.0.35-py2.7.egg/kombu/utils/**init**.py\", line 325, in **get**\n    value = obj.**dict**[self.**name**] = self.**get(obj)\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/beat.py\", line 494, in scheduler\n    return self.get_scheduler()\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/beat.py\", line 489, in get_scheduler\n    lazy=lazy)\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/utils/imports.py\", line 53, in instantiate\n    return symbol_by_name(name)(_args, *_kwargs)\n  File \".../eggs/celery_redbeat-0.9.2-py2.7.egg/redbeat/schedulers.py\", line 187, in __init**\n    super(RedBeatScheduler, self).**init**(app, *_kwargs)\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/beat.py\", line 185, in **init**\n    self.setup_schedule()\n  File \".../eggs/celery_redbeat-0.9.2-py2.7.egg/redbeat/schedulers.py\", line 196, in setup_schedule\n    RedBeatSchedulerEntry(name).delete()\n  File \".../eggs/celery_redbeat-0.9.2-py2.7.egg/redbeat/schedulers.py\", line 65, in **init**\n    args=args, kwargs=kwargs, *_clsargs)\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/beat.py\", line 94, in **init**\n    self.last_run_at = last_run_at or self._default_now()\n  File \".../eggs/celery-3.1.18-py2.7.egg/celery/beat.py\", line 98, in _default_now\n    return self.schedule.now() if self.schedule else self.app.now()\nAttributeError: 'NoneType' object has no attribute 'now'\n\nHere is a patch that seemed to solve the problem:\n\n--- redbeat/schedulers.py   2016-08-11 14:48:48.000000000 -0400\n+++ redbeat/schedulers.py   2016-08-11 14:49:35.000000000 -0400\n@@ -193,7 +193,7 @@\n         current = set(self.app.conf.CELERYBEAT_SCHEDULE.keys())\n         removed = previous - current\n         for name in removed:\n-            RedBeatSchedulerEntry(name).delete()\n- ```\n         RedBeatSchedulerEntry(name, app=self.app).delete()\n  \n   # setup statics\n   self.install_default_entries(self.app.conf.CELERYBEAT_SCHEDULE)\n  ```\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/23", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/23/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/23/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/23/events", "html_url": "https://github.com/sibson/redbeat/issues/23", "id": 145544247, "node_id": "MDU6SXNzdWUxNDU1NDQyNDc=", "number": 23, "title": "Startup fails if app.conf.CELERYBEAT_SCHEDULE.keys() is empty.", "user": {"login": "lambacck", "id": 422865, "node_id": "MDQ6VXNlcjQyMjg2NQ==", "avatar_url": "https://avatars0.githubusercontent.com/u/422865?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lambacck", "html_url": "https://github.com/lambacck", "followers_url": "https://api.github.com/users/lambacck/followers", "following_url": "https://api.github.com/users/lambacck/following{/other_user}", "gists_url": "https://api.github.com/users/lambacck/gists{/gist_id}", "starred_url": "https://api.github.com/users/lambacck/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lambacck/subscriptions", "organizations_url": "https://api.github.com/users/lambacck/orgs", "repos_url": "https://api.github.com/users/lambacck/repos", "events_url": "https://api.github.com/users/lambacck/events{/privacy}", "received_events_url": "https://api.github.com/users/lambacck/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 250394827, "node_id": "MDU6TGFiZWwyNTAzOTQ4Mjc=", "url": "https://api.github.com/repos/sibson/redbeat/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-04-03T21:50:01Z", "updated_at": "2016-08-30T19:55:03Z", "closed_at": "2016-08-30T19:54:36Z", "author_association": "COLLABORATOR", "active_lock_reason": null, "body": "https://github.com/sibson/redbeat/blob/master/redbeat/schedulers.py#L209\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/17", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/17/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/17/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/17/events", "html_url": "https://github.com/sibson/redbeat/issues/17", "id": 121648463, "node_id": "MDU6SXNzdWUxMjE2NDg0NjM=", "number": 17, "title": "work with celery master", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2015-12-11T06:36:27Z", "updated_at": "2017-02-10T05:06:29Z", "closed_at": "2017-02-10T05:06:29Z", "author_association": "OWNER", "active_lock_reason": null, "body": "due to a change in celery/master, redbeat is broken.  So far no releases of celery have included this change, https://github.com/celery/celery/commit/dc4634298f557a2f898a9bc4772fffb79c45eede\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/11", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/11/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/11/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/11/events", "html_url": "https://github.com/sibson/redbeat/issues/11", "id": 104557995, "node_id": "MDU6SXNzdWUxMDQ1NTc5OTU=", "number": 11, "title": "deleted CELERYBEAT_SCHEDULE tasks continues to run", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 250394827, "node_id": "MDU6TGFiZWwyNTAzOTQ4Mjc=", "url": "https://api.github.com/repos/sibson/redbeat/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-09-02T19:47:17Z", "updated_at": "2015-11-17T16:02:13Z", "closed_at": "2015-11-17T16:02:13Z", "author_association": "OWNER", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/6", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/6/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/6/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/6/events", "html_url": "https://github.com/sibson/redbeat/issues/6", "id": 103429717, "node_id": "MDU6SXNzdWUxMDM0Mjk3MTc=", "number": 6, "title": "avoid using current_app", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-08-27T05:09:35Z", "updated_at": "2016-04-03T06:34:24Z", "closed_at": "2016-04-03T06:34:24Z", "author_association": "OWNER", "active_lock_reason": null, "body": "replace with self.app\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/4", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/4/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/4/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/4/events", "html_url": "https://github.com/sibson/redbeat/issues/4", "id": 102422202, "node_id": "MDU6SXNzdWUxMDI0MjIyMDI=", "number": 4, "title": "use sync_every and should_sync rather than UPDATE_INTERVAL", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-08-21T17:00:49Z", "updated_at": "2015-09-02T19:45:53Z", "closed_at": "2015-09-02T19:45:53Z", "author_association": "OWNER", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/3", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/3/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/3/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/3/events", "html_url": "https://github.com/sibson/redbeat/issues/3", "id": 102422155, "node_id": "MDU6SXNzdWUxMDI0MjIxNTU=", "number": 3, "title": "default current_app.conf.REDBEAT_REDIS_URL if not set", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-08-21T17:00:42Z", "updated_at": "2016-03-03T16:34:08Z", "closed_at": "2016-03-03T16:34:08Z", "author_association": "OWNER", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/2", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/2/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/2/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/2/events", "html_url": "https://github.com/sibson/redbeat/issues/2", "id": 102422126, "node_id": "MDU6SXNzdWUxMDI0MjIxMjY=", "number": 2, "title": "store schedule in sorted redis set ", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2015-08-21T17:00:31Z", "updated_at": "2015-09-02T19:45:48Z", "closed_at": "2015-09-02T19:45:48Z", "author_association": "OWNER", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/sibson/redbeat/issues/1", "repository_url": "https://api.github.com/repos/sibson/redbeat", "labels_url": "https://api.github.com/repos/sibson/redbeat/issues/1/labels{/name}", "comments_url": "https://api.github.com/repos/sibson/redbeat/issues/1/comments", "events_url": "https://api.github.com/repos/sibson/redbeat/issues/1/events", "html_url": "https://github.com/sibson/redbeat/issues/1", "id": 102422084, "node_id": "MDU6SXNzdWUxMDI0MjIwODQ=", "number": 1, "title": "tests", "user": {"login": "sibson", "id": 125162, "node_id": "MDQ6VXNlcjEyNTE2Mg==", "avatar_url": "https://avatars2.githubusercontent.com/u/125162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sibson", "html_url": "https://github.com/sibson", "followers_url": "https://api.github.com/users/sibson/followers", "following_url": "https://api.github.com/users/sibson/following{/other_user}", "gists_url": "https://api.github.com/users/sibson/gists{/gist_id}", "starred_url": "https://api.github.com/users/sibson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sibson/subscriptions", "organizations_url": "https://api.github.com/users/sibson/orgs", "repos_url": "https://api.github.com/users/sibson/repos", "events_url": "https://api.github.com/users/sibson/events{/privacy}", "received_events_url": "https://api.github.com/users/sibson/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2015-08-21T17:00:21Z", "updated_at": "2016-04-03T06:44:04Z", "closed_at": "2016-04-03T06:44:04Z", "author_association": "OWNER", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}]}