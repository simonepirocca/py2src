{"total_count": 7, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/minrk/pamela/issues/19", "repository_url": "https://api.github.com/repos/minrk/pamela", "labels_url": "https://api.github.com/repos/minrk/pamela/issues/19/labels{/name}", "comments_url": "https://api.github.com/repos/minrk/pamela/issues/19/comments", "events_url": "https://api.github.com/repos/minrk/pamela/issues/19/events", "html_url": "https://github.com/minrk/pamela/issues/19", "id": 588395082, "node_id": "MDU6SXNzdWU1ODgzOTUwODI=", "number": 19, "title": "Which permissions does a non-root user need to make a successfull call to pam_open_session", "user": {"login": "gatoniel", "id": 40384506, "node_id": "MDQ6VXNlcjQwMzg0NTA2", "avatar_url": "https://avatars1.githubusercontent.com/u/40384506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/gatoniel", "html_url": "https://github.com/gatoniel", "followers_url": "https://api.github.com/users/gatoniel/followers", "following_url": "https://api.github.com/users/gatoniel/following{/other_user}", "gists_url": "https://api.github.com/users/gatoniel/gists{/gist_id}", "starred_url": "https://api.github.com/users/gatoniel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/gatoniel/subscriptions", "organizations_url": "https://api.github.com/users/gatoniel/orgs", "repos_url": "https://api.github.com/users/gatoniel/repos", "events_url": "https://api.github.com/users/gatoniel/events{/privacy}", "received_events_url": "https://api.github.com/users/gatoniel/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-26T12:47:01Z", "updated_at": "2020-04-07T13:57:58Z", "closed_at": "2020-04-07T13:57:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\nI am trying to run JupyterHub as non-root user and still use the PAMAuthenticator. I already added the non-root user to shadow group, so that the authentication works. When I run JupyterHub as root and login with a user into JupyterHub this is the output of /var/log/secure:\r\n\r\n> Mar 26 10:57:57 picard python3[5637]: pam_loginuid(login:session): Error writing /proc/self/loginuid: Operation not permitted\r\n> Mar 26 10:57:57 picard python3[5637]: pam_loginuid(login:session): set_loginuid failed\r\n> Mar 26 10:57:57 picard systemd[5654]: pam_unix(systemd-user:session): session opened for user testuser by (uid=0)\r\n> Mar 26 10:57:57 picard python3[5637]: pam_unix(login:session): session opened for user testuser by (uid=0)\r\n\r\nWhen I run JupyterHub as non-root user the output looks like this:\r\n\r\n> Mar 26 11:48:31 picard python3[5834]: pam_loginuid(login:session): Error writing /proc/self/loginuid: Operation not permitted\r\n> Mar 26 11:48:31 picard python3[5834]: pam_loginuid(login:session): set_loginuid failed\r\n> Mar 26 11:48:31 picard python3[5834]: pam_selinux(login:session): Error sending audit message.\r\n> Mar 26 11:48:31 picard python3[5834]: pam_keyinit(login:session): Unable to change GID to 1005 temporarily\r\n> Mar 26 11:48:31 picard python3[5834]: pam_keyinit(login:session): Unable to change GID to 1005 temporarily\r\n> Mar 26 11:48:31 picard python3[5834]: pam_systemd(login:session): Failed to create session: Access denied\r\n> Mar 26 11:48:31 picard python3[5834]: pam_unix(login:session): session opened for user testuser by (uid=991)\r\n> Mar 26 11:48:31 picard python3[5834]: pam_lastlog(login:session): unable to open /var/log/btmp: Permission denied\r\n\r\nI now understand, that this might not be much of a problem, and I could set in the JupyterHub config the following\r\n\r\n> c.PAMAuthenticator.open_sessions = False\r\n\r\nFrom the Linux man pages ([http://man7.org/linux/man-pages/man3/pam_open_session.3.html](http://man7.org/linux/man-pages/man3/pam_open_session.3.html)) I found this \r\n\r\n> It should be noted that the effective uid, geteuid(2). of the application should be of sufficient privilege to perform such tasks as creating or mounting the user's home directory for example.\r\n\r\nSince the sshd daemon is also run as a separate non-root user and somehow manages to run pam_open_session, I wonder which privileges need to be set for the non-root user in order to open a new PAM session for a user.\r\n\r\nI do have a 2nd question: What are the actual effects of pam_open_session for the calling process? As I understand, this changes the whole context the process is run in. This means after authentication JupyterHub should fork itself before calling pam_open_session? Otherwise the main JupyterHub process would run in a new context, that it should not run in?\r\n\r\n**EDIT:** I found out that one can set the [capabilities](https://linux.die.net/man/7/capabilities) CAP_SETGID and CAP_SETUID of a process via [systemd](https://www.freedesktop.org/software/systemd/man/systemd.exec.html#Capabilities) for a non-root user. I think there must be more CAP_s that I need to add in order of a process to run pam_open_session correctly. ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/minrk/pamela/issues/13", "repository_url": "https://api.github.com/repos/minrk/pamela", "labels_url": "https://api.github.com/repos/minrk/pamela/issues/13/labels{/name}", "comments_url": "https://api.github.com/repos/minrk/pamela/issues/13/comments", "events_url": "https://api.github.com/repos/minrk/pamela/issues/13/events", "html_url": "https://github.com/minrk/pamela/issues/13", "id": 369152081, "node_id": "MDU6SXNzdWUzNjkxNTIwODE=", "number": 13, "title": "authentication fails with linuxbrew python3", "user": {"login": "sidebo", "id": 8863780, "node_id": "MDQ6VXNlcjg4NjM3ODA=", "avatar_url": "https://avatars0.githubusercontent.com/u/8863780?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sidebo", "html_url": "https://github.com/sidebo", "followers_url": "https://api.github.com/users/sidebo/followers", "following_url": "https://api.github.com/users/sidebo/following{/other_user}", "gists_url": "https://api.github.com/users/sidebo/gists{/gist_id}", "starred_url": "https://api.github.com/users/sidebo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sidebo/subscriptions", "organizations_url": "https://api.github.com/users/sidebo/orgs", "repos_url": "https://api.github.com/users/sidebo/repos", "events_url": "https://api.github.com/users/sidebo/events{/privacy}", "received_events_url": "https://api.github.com/users/sidebo/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-11T14:35:16Z", "updated_at": "2018-10-16T12:32:58Z", "closed_at": "2018-10-16T12:32:58Z", "author_association": "NONE", "active_lock_reason": null, "body": "I cannot authenticate myself ([PAM Error 7] Authentication failure upon ``python3 -m pamela -a `whoami`)``. Possibly this has to do with the way I installed python3. I'm on an slc6 machine and used linuxbrew for the install, I have /home/linuxbrew/ (python3 is here) and /home/usr1 /home/usr2 etc. Maybe I'm missing something else. Can you help? ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/minrk/pamela/issues/12", "repository_url": "https://api.github.com/repos/minrk/pamela", "labels_url": "https://api.github.com/repos/minrk/pamela/issues/12/labels{/name}", "comments_url": "https://api.github.com/repos/minrk/pamela/issues/12/comments", "events_url": "https://api.github.com/repos/minrk/pamela/issues/12/events", "html_url": "https://github.com/minrk/pamela/issues/12", "id": 342278081, "node_id": "MDU6SXNzdWUzNDIyNzgwODE=", "number": 12, "title": "Pamela doesn't run in conda virtual environment", "user": {"login": "ArneBachmann", "id": 20544098, "node_id": "MDQ6VXNlcjIwNTQ0MDk4", "avatar_url": "https://avatars0.githubusercontent.com/u/20544098?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArneBachmann", "html_url": "https://github.com/ArneBachmann", "followers_url": "https://api.github.com/users/ArneBachmann/followers", "following_url": "https://api.github.com/users/ArneBachmann/following{/other_user}", "gists_url": "https://api.github.com/users/ArneBachmann/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArneBachmann/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArneBachmann/subscriptions", "organizations_url": "https://api.github.com/users/ArneBachmann/orgs", "repos_url": "https://api.github.com/users/ArneBachmann/repos", "events_url": "https://api.github.com/users/ArneBachmann/events{/privacy}", "received_events_url": "https://api.github.com/users/ArneBachmann/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-07-18T10:55:33Z", "updated_at": "2018-07-19T00:00:16Z", "closed_at": "2018-07-18T20:06:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\n(jupyterhub) C:\\Users\\bach_ar>python -m pamela -a bach_ar\r\nTraceback (most recent call last):\r\n  File \"d:\\apps\\Miniconda3\\envs\\jupyterhub\\lib\\runpy.py\", line 193, in _run_module_as_main\r\n    \"__main__\", mod_spec)\r\n  File \"d:\\apps\\Miniconda3\\envs\\jupyterhub\\lib\\runpy.py\", line 85, in _run_code\r\n    exec(code, run_globals)\r\n  File \"d:\\apps\\Miniconda3\\envs\\jupyterhub\\lib\\site-packages\\pamela.py\", line 49, in <module>\r\n    LIBPAM = CDLL(find_library(\"pam\"))\r\n  File \"d:\\apps\\Miniconda3\\envs\\jupyterhub\\lib\\ctypes\\__init__.py\", line 351, in __init__\r\n    self._handle = _dlopen(self._name, mode)\r\nTypeError: LoadLibrary() argument 1 must be str, not None\r\n```\r\nCould it be that the DLL is somehow hardcoded and not found if pamela installed into the environment?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/minrk/pamela/issues/9", "repository_url": "https://api.github.com/repos/minrk/pamela", "labels_url": "https://api.github.com/repos/minrk/pamela/issues/9/labels{/name}", "comments_url": "https://api.github.com/repos/minrk/pamela/issues/9/comments", "events_url": "https://api.github.com/repos/minrk/pamela/issues/9/events", "html_url": "https://github.com/minrk/pamela/issues/9", "id": 271910823, "node_id": "MDU6SXNzdWUyNzE5MTA4MjM=", "number": 9, "title": "Non-root using pamela to auth non-root", "user": {"login": "MincingWords", "id": 16236172, "node_id": "MDQ6VXNlcjE2MjM2MTcy", "avatar_url": "https://avatars3.githubusercontent.com/u/16236172?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MincingWords", "html_url": "https://github.com/MincingWords", "followers_url": "https://api.github.com/users/MincingWords/followers", "following_url": "https://api.github.com/users/MincingWords/following{/other_user}", "gists_url": "https://api.github.com/users/MincingWords/gists{/gist_id}", "starred_url": "https://api.github.com/users/MincingWords/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MincingWords/subscriptions", "organizations_url": "https://api.github.com/users/MincingWords/orgs", "repos_url": "https://api.github.com/users/MincingWords/repos", "events_url": "https://api.github.com/users/MincingWords/events{/privacy}", "received_events_url": "https://api.github.com/users/MincingWords/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-11-07T17:07:35Z", "updated_at": "2019-01-17T10:47:54Z", "closed_at": "2019-01-17T10:47:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "non-root user \"foo\" goes \"python3.4 -m pamela -a foo\", enters password, and it works. but if user foo then goes \"python3.4 -m pamela -a bar\" and enters bar's password (bar's un/pw works in console and ssh) then \"[PAM Error 7] Authentication failure\". Is there a way to configure so that this will work? trying to avoid running jupyterhub as root.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/minrk/pamela/issues/8", "repository_url": "https://api.github.com/repos/minrk/pamela", "labels_url": "https://api.github.com/repos/minrk/pamela/issues/8/labels{/name}", "comments_url": "https://api.github.com/repos/minrk/pamela/issues/8/comments", "events_url": "https://api.github.com/repos/minrk/pamela/issues/8/events", "html_url": "https://github.com/minrk/pamela/issues/8", "id": 257182399, "node_id": "MDU6SXNzdWUyNTcxODIzOTk=", "number": 8, "title": "Pamela.py Authenticate \"help\" comment lies :(", "user": {"login": "marczis", "id": 12890933, "node_id": "MDQ6VXNlcjEyODkwOTMz", "avatar_url": "https://avatars0.githubusercontent.com/u/12890933?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marczis", "html_url": "https://github.com/marczis", "followers_url": "https://api.github.com/users/marczis/followers", "following_url": "https://api.github.com/users/marczis/following{/other_user}", "gists_url": "https://api.github.com/users/marczis/gists{/gist_id}", "starred_url": "https://api.github.com/users/marczis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marczis/subscriptions", "organizations_url": "https://api.github.com/users/marczis/orgs", "repos_url": "https://api.github.com/users/marczis/repos", "events_url": "https://api.github.com/users/marczis/events{/privacy}", "received_events_url": "https://api.github.com/users/marczis/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-09-12T21:05:24Z", "updated_at": "2019-01-17T15:21:32Z", "closed_at": "2019-01-17T15:19:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "Great module, thanks a lot for you work.\r\nOne thing I figured out the hard(er) way, the Authenticate function does not return \"True\" as it is says in the help text, it either raise or keeps silent.\r\n\r\nBr,\r\n Peter.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/minrk/pamela/issues/7", "repository_url": "https://api.github.com/repos/minrk/pamela", "labels_url": "https://api.github.com/repos/minrk/pamela/issues/7/labels{/name}", "comments_url": "https://api.github.com/repos/minrk/pamela/issues/7/comments", "events_url": "https://api.github.com/repos/minrk/pamela/issues/7/events", "html_url": "https://github.com/minrk/pamela/issues/7", "id": 216072986, "node_id": "MDU6SXNzdWUyMTYwNzI5ODY=", "number": 7, "title": "pamela fails for non-current user", "user": {"login": "csbrown", "id": 1459444, "node_id": "MDQ6VXNlcjE0NTk0NDQ=", "avatar_url": "https://avatars0.githubusercontent.com/u/1459444?v=4", "gravatar_id": "", "url": "https://api.github.com/users/csbrown", "html_url": "https://github.com/csbrown", "followers_url": "https://api.github.com/users/csbrown/followers", "following_url": "https://api.github.com/users/csbrown/following{/other_user}", "gists_url": "https://api.github.com/users/csbrown/gists{/gist_id}", "starred_url": "https://api.github.com/users/csbrown/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/csbrown/subscriptions", "organizations_url": "https://api.github.com/users/csbrown/orgs", "repos_url": "https://api.github.com/users/csbrown/repos", "events_url": "https://api.github.com/users/csbrown/events{/privacy}", "received_events_url": "https://api.github.com/users/csbrown/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2017-03-22T14:00:42Z", "updated_at": "2017-03-22T16:06:19Z", "closed_at": "2017-03-22T16:06:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "python3 -m pamela -a '[other_user]' fails with [PAM Error 7] Authentication failure\r\n, but python3 -m pamela -a '[current_user]' succeeds.  Not sure where to start debugging this.\r\n\r\nsudo python3 -m pamela -a '[anyone]' works as expected.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/minrk/pamela/issues/5", "repository_url": "https://api.github.com/repos/minrk/pamela", "labels_url": "https://api.github.com/repos/minrk/pamela/issues/5/labels{/name}", "comments_url": "https://api.github.com/repos/minrk/pamela/issues/5/comments", "events_url": "https://api.github.com/repos/minrk/pamela/issues/5/events", "html_url": "https://github.com/minrk/pamela/issues/5", "id": 163612219, "node_id": "MDU6SXNzdWUxNjM2MTIyMTk=", "number": 5, "title": "Issues with pamela installed via anaconda", "user": {"login": "jan-janssen", "id": 3854739, "node_id": "MDQ6VXNlcjM4NTQ3Mzk=", "avatar_url": "https://avatars2.githubusercontent.com/u/3854739?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jan-janssen", "html_url": "https://github.com/jan-janssen", "followers_url": "https://api.github.com/users/jan-janssen/followers", "following_url": "https://api.github.com/users/jan-janssen/following{/other_user}", "gists_url": "https://api.github.com/users/jan-janssen/gists{/gist_id}", "starred_url": "https://api.github.com/users/jan-janssen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jan-janssen/subscriptions", "organizations_url": "https://api.github.com/users/jan-janssen/orgs", "repos_url": "https://api.github.com/users/jan-janssen/repos", "events_url": "https://api.github.com/users/jan-janssen/events{/privacy}", "received_events_url": "https://api.github.com/users/jan-janssen/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2016-07-04T06:41:18Z", "updated_at": "2016-07-05T06:07:05Z", "closed_at": "2016-07-05T06:07:05Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am able to sudo switch from one user to the next, with the limitation to the sudospawner as required by jupyterhub [1](https://github.com/jupyterhub/jupyterhub/wiki/Using-sudo-to-run-JupyterHub-without-root-privileges). \n    `sudo -u rhea sudo -n -u $USER sudospawner --help`\n\nThe shadow configuration is set: \n    `-rw-r----- 1 root shadow 536 Jun 22 10:59 /etc/shadow`\n    `uid=35052(jan) gid=12500(mpd) groups=15(shadow),12505(pyjam),12500(mpd)`\n\nAnd when I run:  \n    `ldd /{,usr/}{bin,sbin}/* | grep -B 5 libpam | grep '^/'`\nI get: \n\n```\n    /bin/login:\n    /bin/su:\n    /sbin/mkhomedir_helper:\n    /sbin/pam_tally2:\n    /usr/bin/chage:\n    /usr/bin/chfn:\n    /usr/bin/chsh:\n    /usr/bin/passwd:\n    /usr/sbin/atd:\n    /usr/sbin/cron:\n    /usr/sbin/sshd:\n    /sbin/pam_timestamp_check:\n    /sbin/unix2_chkpwd:\n    /usr/bin/c_rehash1:\n    /usr/bin/crontab:\n    /usr/bin/passmass:\n    /usr/bin/sudo:\n    /usr/bin/sudoedit:\n    /usr/bin/vlock:\n    /usr/bin/xdmshell:\n    /usr/sbin/create-cracklib-dict:\n    /usr/sbin/groupadd:\n    /usr/sbin/groupadd.local:\n    /usr/sbin/groupdel:\n    /usr/sbin/groupmod:\n    /usr/sbin/in.rexecd:\n    /usr/sbin/in.rlogind:\n    /usr/sbin/in.rshd:\n    /usr/sbin/routel:\n    /usr/sbin/rpasswdd:\n    /usr/sbin/update-usbids.sh:\n    /usr/sbin/useradd:\n    /usr/sbin/useradd.local:\n    /usr/sbin/userdel:\n    /usr/sbin/userdel-pre.local:\n    /usr/sbin/usermod:\n```\n\nI am wondering whether python should not also appear in this list and if that is the case how to add it. Or maybe that is just an missunderstanding from my side and there is a unix command besides sudo, which I can use to test my PAM configuration. \n\nCorrection: \nWhat fails for me is the simple test command: \n    `python -m pamela -a whoami`\nIt promots me for my password and is never able to correctly login but instead always returns an\n  `[PAM Error 7] Authentication failure`\nerror\n\nWhen I load the module directly in python : \n\n```\n>>> import pamela as pamela\n>>> pamela.authenticate('kwotuveang3k4bk')\nPassword: \nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/u/system/SLES11/soft/pyjam/jupyterhub/0-8-0/lib/python3.5/site-packages/pamela.py\", line 272, in authenticate\n    return pam_end(handle, retval)\n  File \"/u/system/SLES11/soft/pyjam/jupyterhub/0-8-0/lib/python3.5/site-packages/pamela.py\", line 220, in pam_end\n    raise PAMError(errno=retval)\npamela.PAMError: [PAM Error 7] Authentication failure\n```\n\nVersions: \n\n```\nPython 3.5.1 |Anaconda 4.1.0 (64-bit)\npamela: __version__ = '0.2.1'\n```\n", "performed_via_github_app": null, "score": 1.0}]}