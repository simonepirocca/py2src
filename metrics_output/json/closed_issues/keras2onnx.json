{"total_count": 147, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/onnx/keras-onnx/issues/595", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/595/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/595/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/595/events", "html_url": "https://github.com/onnx/keras-onnx/issues/595", "id": 683256830, "node_id": "MDU6SXNzdWU2ODMyNTY4MzA=", "number": 595, "title": "Error during test_yolov3.py: \"Graph opset and model opset mismatch: Graph opset = 12, model opset = 11\"", "user": {"login": "dbolotov", "id": 1837186, "node_id": "MDQ6VXNlcjE4MzcxODY=", "avatar_url": "https://avatars2.githubusercontent.com/u/1837186?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dbolotov", "html_url": "https://github.com/dbolotov", "followers_url": "https://api.github.com/users/dbolotov/followers", "following_url": "https://api.github.com/users/dbolotov/following{/other_user}", "gists_url": "https://api.github.com/users/dbolotov/gists{/gist_id}", "starred_url": "https://api.github.com/users/dbolotov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dbolotov/subscriptions", "organizations_url": "https://api.github.com/users/dbolotov/orgs", "repos_url": "https://api.github.com/users/dbolotov/repos", "events_url": "https://api.github.com/users/dbolotov/events{/privacy}", "received_events_url": "https://api.github.com/users/dbolotov/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-08-21T04:42:46Z", "updated_at": "2020-08-21T22:07:25Z", "closed_at": "2020-08-21T22:07:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "When I run test_yolov3.py, I get the following error:\r\n\r\n\r\n```\r\n(tensorflow_p36) ~/work/workspace/keras-onnx/applications/nightly_build$ pytest test_yolov3.py \r\n======================================================= test session starts ========================================================\r\nplatform linux -- Python 3.6.10, pytest-5.4.1, py-1.8.1, pluggy-0.13.1\r\nrootdir: /home/ubuntu/work/workspace/keras-onnx\r\nplugins: remotedata-0.3.2, openfiles-0.4.0, astropy-header-0.1.2, hypothesis-5.8.3, arraydiff-0.3, doctestplus-0.5.0\r\ncollected 1 item                                                                                                                   \r\n\r\ntest_yolov3.py F                                                                                                             [100%]\r\n\r\n============================================================= FAILURES =============================================================\r\n______________________________________________________ TestYoloV3.test_yolov3 ______________________________________________________\r\n\r\nself = <test_yolov3.TestYoloV3 testMethod=test_yolov3>\r\n\r\n    @unittest.skipIf(StrictVersion(onnx.__version__.split('-')[0]) < StrictVersion(\"1.5.0\"),\r\n                     \"NonMaxSuppression op is not supported for onnx < 1.5.0.\")\r\n    def test_yolov3(self):\r\n        img_path = os.path.join(os.path.dirname(__file__), '../data', 'street.jpg')\r\n        yolo3_yolo3_dir = os.path.join(os.path.dirname(__file__), '../../keras-yolo3/yolo3')\r\n        try:\r\n            import onnxruntime\r\n        except ImportError:\r\n            return True\r\n    \r\n        from PIL import Image\r\n    \r\n        for is_tiny_yolo in [True, False]:\r\n            if is_tiny_yolo:\r\n                if not os.path.exists(tiny_model_file_name):\r\n                    urllib.request.urlretrieve(YOLOV3_TINY_WEIGHTS_PATH, tiny_model_file_name)\r\n                yolo_weights = load_model(tiny_model_file_name)\r\n                model_path = tiny_model_file_name  # model path or trained weights path\r\n                anchors_path = 'model_data/tiny_yolo_anchors.txt'\r\n                case_name = 'yolov3-tiny'\r\n            else:\r\n                if not os.path.exists(model_file_name):\r\n                    urllib.request.urlretrieve(YOLOV3_WEIGHTS_PATH, model_file_name)\r\n                yolo_weights = load_model(model_file_name)\r\n                model_path = model_file_name  # model path or trained weights path\r\n                anchors_path = 'model_data/yolo_anchors.txt'\r\n                case_name = 'yolov3'\r\n    \r\n            my_yolo = YOLO(model_path, anchors_path, yolo3_yolo3_dir)\r\n            my_yolo.load_model(yolo_weights)\r\n>           onnx_model = convert_model(my_yolo, is_tiny_yolo)\r\n\r\ntest_yolov3.py:79: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n../yolov3/yolov3.py:440: in convert_model\r\n    onnxmodel_1.graph.input])  # define the order of arguments\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\npath_or_model = ir_version: 6\r\nproducer_name: \"keras2onnx\"\r\nproducer_version: \"1.7.0\"\r\ndomain: \"onnxmltools\"\r\nmodel_version: 0\r\ndoc_string:...dim {\r\n            dim_value: 255\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\nopset_import {\r\n  domain: \"\"\r\n  version: 11\r\n}\r\n\r\nname = None, inputs = ['input_1'], outputs = None\r\n\r\n    @staticmethod\r\n    def load(path_or_model, name=None, inputs=None, outputs=None):\r\n        \"\"\"\r\n        Construct a Graph object by loading an ONNX model.\r\n        \"\"\"\r\n        oxml = onnx.load_model(path_or_model) if isinstance(path_or_model, str) else path_or_model\r\n        for opset_import in oxml.opset_import:\r\n            if opset_import.domain == '':\r\n                if Graph.opset != opset_import.version:\r\n                    raise RuntimeError(\"Graph opset and model opset mismatch: Graph opset = \" + str(Graph.opset)\r\n>                                      + \", model opset = \" + str(opset_import.version))\r\nE                   RuntimeError: Graph opset and model opset mismatch: Graph opset = 12, model opset = 11\r\n\r\n/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/onnxconverter_common/onnx_fx.py:282: RuntimeError\r\n------------------------------------------------------- Captured stdout call -------------------------------------------------------\r\n/home/ubuntu/work/workspace/keras-onnx/applications/nightly_build/../../keras-yolo3/yolo3/../yolov3-tiny.h5 model, anchors, and classes loaded.\r\n/home/ubuntu/work/workspace/keras-onnx/applications/nightly_build/../../keras-yolo3/yolo3/../yolov3.h5 model, anchors, and classes loaded.\r\n------------------------------------------------------- Captured stderr call -------------------------------------------------------\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:517: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:4138: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:245: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:174: The name tf.get_default_session is deprecated. Please use tf.compat.v1.get_default_session instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:181: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:186: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:190: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:199: The name tf.is_variable_initialized is deprecated. Please use tf.compat.v1.is_variable_initialized instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:206: The name tf.variables_initializer is deprecated. Please use tf.compat.v1.variables_initializer instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:1834: The name tf.nn.fused_batch_norm is deprecated. Please use tf.compat.v1.nn.fused_batch_norm instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:133: The name tf.placeholder_with_default is deprecated. Please use tf.compat.v1.placeholder_with_default instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:3976: The name tf.nn.max_pool is deprecated. Please use tf.nn.max_pool2d instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:2018: The name tf.image.resize_nearest_neighbor is deprecated. Please use tf.compat.v1.image.resize_nearest_neighbor instead.\r\n\r\nWARNING:tensorflow:From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/tensorflow_core/python/ops/array_ops.py:1475: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse tf.where in 2.0, which has the same broadcast rule as np.where\r\nThe ONNX operator number change on the optimization: 130 -> 34\r\nThe ONNX operator number change on the optimization: 226 -> 134\r\nThe ONNX operator number change on the optimization: 19 -> 6\r\n2020-08-21 04:37:14.361061: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:533] remapper failed: Invalid argument: Subshape must have computed start >= end since stride is negative, but is 0 and 2 (computed from start 0 and end 9223372036854775807 over shape with rank 2 and stride-1)\r\n2020-08-21 04:37:14.611298: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:533] layout failed: Invalid argument: Subshape must have computed start >= end since stride is negative, but is 0 and 2 (computed from start 0 and end 9223372036854775807 over shape with rank 2 and stride-1)\r\n2020-08-21 04:37:14.816326: E tensorflow/core/grappler/optimizers/meta_optimizer.cc:533] remapper failed: Invalid argument: Subshape must have computed start >= end since stride is negative, but is 0 and 2 (computed from start 0 and end 9223372036854775807 over shape with rank 2 and stride-1)\r\nThe ONNX operator number change on the optimization: 642 -> 177\r\nThe ONNX operator number change on the optimization: 331 -> 196\r\nThe ONNX operator number change on the optimization: 19 -> 6\r\n-------------------------------------------------------- Captured log call ---------------------------------------------------------\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:517: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:4138: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:245: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:174: The name tf.get_default_session is deprecated. Please use tf.compat.v1.get_default_session instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:181: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:186: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:190: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:199: The name tf.is_variable_initialized is deprecated. Please use tf.compat.v1.is_variable_initialized instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:206: The name tf.variables_initializer is deprecated. Please use tf.compat.v1.variables_initializer instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:1834: The name tf.nn.fused_batch_norm is deprecated. Please use tf.compat.v1.nn.fused_batch_norm instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:133: The name tf.placeholder_with_default is deprecated. Please use tf.compat.v1.placeholder_with_default instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:3976: The name tf.nn.max_pool is deprecated. Please use tf.nn.max_pool2d instead.\r\n\r\nWARNING  tensorflow:module_wrapper.py:139 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:2018: The name tf.image.resize_nearest_neighbor is deprecated. Please use tf.compat.v1.image.resize_nearest_neighbor instead.\r\n\r\nWARNING  tensorflow:deprecation.py:323 From /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/tensorflow_core/python/ops/array_ops.py:1475: where (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse tf.where in 2.0, which has the same broadcast rule as np.where\r\nINFO     keras2onnx:topology.py:338 The ONNX operator number change on the optimization: 130 -> 34\r\nINFO     keras2onnx:topology.py:338 The ONNX operator number change on the optimization: 226 -> 134\r\nINFO     keras2onnx:topology.py:338 The ONNX operator number change on the optimization: 19 -> 6\r\nWARNING  onnxmltools:onnx_ex.py:64 The maximum opset needed by this model is only 1.\r\nWARNING  onnxconverter_common.onnx_fx:onnx_fx.py:175 The maximum opset needed by this model is updated to 12.\r\nINFO     keras2onnx:topology.py:338 The ONNX operator number change on the optimization: 642 -> 177\r\nWARNING  onnxmltools:onnx_ex.py:64 The maximum opset needed by this model is only 11.\r\nINFO     keras2onnx:topology.py:338 The ONNX operator number change on the optimization: 331 -> 196\r\nINFO     keras2onnx:topology.py:338 The ONNX operator number change on the optimization: 19 -> 6\r\n========================================================= warnings summary =========================================================\r\n/home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/tensorflow_core/python/pywrap_tensorflow_internal.py:15\r\n  /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/tensorflow_core/python/pywrap_tensorflow_internal.py:15: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses\r\n    import imp\r\n\r\napplications/nightly_build/test_yolov3.py: 125 tests with warnings\r\n  /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/engine/saving.py:251: DeprecationWarning: The truth value of an empty array is ambiguous. Returning False, but in future this will result in an error. Use `array.size > 0` to check that an array is not empty.\r\n    if weight_names:\r\n\r\napplications/nightly_build/test_yolov3.py::TestYoloV3::test_yolov3\r\n  /home/ubuntu/anaconda3/envs/tensorflow_p36/lib/python3.6/site-packages/keras/engine/saving.py:292: UserWarning: No training configuration found in save file: the model was *not* compiled. Compile it manually.\r\n    warnings.warn('No training configuration found in save file: '\r\n\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n===================================================== short test summary info ======================================================\r\nFAILED test_yolov3.py::TestYoloV3::test_yolov3 - RuntimeError: Graph opset and model opset mismatch: Graph opset = 12, model opse...\r\n=========================================== 1 failed, 127 warnings in 262.30s (0:04:22) ============================================\r\n\r\n```\r\n\r\n\r\nThis happens on Ubuntu 18.04 with Anaconda. onnxconverter-common and keras2onnx are installed from github, and pip freeze returns the following:\r\n\r\n```\r\nabsl-py==0.9.0\r\nalabaster==0.7.12\r\nanaconda-client==1.7.2\r\nanaconda-project==0.8.3\r\nargh==0.26.2\r\nasn1crypto==1.3.0\r\nastor==0.8.1\r\nastroid==2.3.3\r\nastropy==4.0.1.post1\r\natomicwrites==1.3.0\r\nattrs==19.3.0\r\nAutomat==20.2.0\r\nautopep8==1.4.4\r\nautovizwidget==0.15.0\r\nBabel==2.8.0\r\nbackcall==0.1.0\r\nbackports.shutil-get-terminal-size==1.0.0\r\nbeautifulsoup4==4.8.2\r\nbitarray==1.2.1\r\nbkcharts==0.2\r\nbleach==3.1.4\r\nbokeh==2.0.1\r\nboto==2.49.0\r\nboto3==1.14.5\r\nbotocore==1.17.5\r\nBottleneck==1.3.2\r\ncertifi==2020.4.5.2\r\ncffi==1.14.0\r\nchardet==3.0.4\r\nclick==7.1.1\r\ncloudpickle==1.3.0\r\nclyent==1.2.2\r\ncolorama==0.4.3\r\ncontextlib2==0.6.0.post1\r\ncryptography==2.8\r\ncycler==0.10.0\r\nCython==0.29.15\r\ncytoolz==0.10.1\r\ndask==2.14.0\r\ndecorator==4.4.2\r\ndefusedxml==0.6.0\r\ndiff-match-patch==20181111\r\ndistributed==2.14.0\r\ndocutils==0.15.2\r\nentrypoints==0.3\r\nenum34==1.1.10\r\nenvironment-kernels==1.1.1\r\net-xmlfile==1.0.1\r\nfastcache==1.1.0\r\nfilelock==3.0.12\r\nfire==0.3.1\r\nflake8==3.7.9\r\nFlask==1.1.1\r\nfsspec==0.7.1\r\nfuture==0.18.2\r\ngast==0.2.2\r\ngevent==1.4.0\r\nglob2==0.7\r\ngmpy2==2.0.8\r\ngoogle-pasta==0.2.0\r\ngreenlet==0.4.15\r\ngrpcio==1.27.2\r\nh5py==2.10.0\r\nhdijupyterutils==0.15.0\r\nHeapDict==1.0.1\r\nhorovod==0.19.4\r\nhtml5lib==1.0.1\r\nhypothesis==5.8.3\r\nidna==2.9\r\nimageio==2.8.0\r\nimagesize==1.2.0\r\nimportlib-metadata==1.5.0\r\nintervaltree==3.0.2\r\nipykernel==5.1.4\r\nipyparallel==6.2.4\r\nipython==7.13.0\r\nipython-genutils==0.2.0\r\nipywidgets==7.5.1\r\nisort==4.3.21\r\nitsdangerous==1.1.0\r\njdcal==1.4.1\r\njedi==0.15.2\r\njeepney==0.4.3\r\nJinja2==2.11.1\r\njmespath==0.9.4\r\njoblib==0.14.1\r\njson5==0.9.4\r\njsonschema==3.2.0\r\njupyter==1.0.0\r\njupyter-client==6.1.2\r\njupyter-console==6.1.0\r\njupyter-core==4.6.3\r\njupyterlab==1.2.6\r\njupyterlab-server==1.1.0\r\nKeras==2.2.4\r\nKeras-Applications==1.0.8\r\nKeras-Preprocessing==1.1.2\r\nkeras2onnx==1.7.1\r\nkeyring==21.1.1\r\nkiwisolver==1.1.0\r\nlazy-object-proxy==1.4.3\r\nlibarchive-c==2.8\r\nlief==0.9.0\r\nllvmlite==0.31.0\r\nlocket==0.2.0\r\nlxml==4.5.0\r\nMarkdown==3.2.2\r\nMarkupSafe==1.1.1\r\nmatplotlib==3.2.1\r\nmccabe==0.6.1\r\nmistune==0.8.4\r\nmkl-fft==1.0.15\r\nmkl-random==1.1.0\r\nmkl-service==2.3.0\r\nmock==4.0.1\r\nmore-itertools==8.2.0\r\nmpmath==1.1.0\r\nmsgpack==1.0.0\r\nmultipledispatch==0.6.0\r\nnb-conda==2.2.1\r\nnb-conda-kernels==2.2.3\r\nnbconvert==5.6.1\r\nnbformat==5.0.4\r\nnetworkx==2.4\r\nnltk==3.4.5\r\nnose==1.3.7\r\nnotebook==6.0.3\r\nnumba==0.48.0\r\nnumexpr==2.7.1\r\nnumpy==1.18.1\r\nnumpydoc==0.9.2\r\nolefile==0.46\r\nonnx==1.7.0\r\nonnxconverter-common==1.7.0\r\nonnxruntime==1.4.0\r\nopencv-python==4.2.0.32\r\nopenpyxl==3.0.3\r\nopt-einsum==3.2.1\r\npackaging==20.3\r\npandas==1.0.3\r\npandocfilters==1.4.2\r\nparso==0.5.2\r\npartd==1.1.0\r\npath==13.1.0\r\npathlib2==2.3.5\r\npathtools==0.1.2\r\npatsy==0.5.1\r\npep8==1.7.1\r\npexpect==4.8.0\r\npickleshare==0.7.5\r\nPillow==7.0.0\r\npkginfo==1.5.0.1\r\nplotly==4.8.1\r\npluggy==0.13.1\r\nply==3.11\r\nprometheus-client==0.7.1\r\nprompt-toolkit==3.0.4\r\nprotobuf==3.12.2\r\nprotobuf3-to-dict==0.1.5\r\npsutil==5.7.0\r\npsycopg2==2.7.5\r\nptyprocess==0.6.0\r\npy==1.8.1\r\npycodestyle==2.5.0\r\npycosat==0.6.3\r\npycparser==2.20\r\npycrypto==2.6.1\r\npycurl==7.43.0.5\r\npydocstyle==4.0.1\r\npyflakes==2.1.1\r\npygal==2.4.0\r\nPygments==2.6.1\r\npykerberos==1.2.1\r\npylint==2.4.4\r\npyodbc===4.0.0-unsupported\r\npyOpenSSL==19.1.0\r\npyparsing==2.4.6\r\npyrsistent==0.16.0\r\nPySocks==1.7.1\r\npytest==5.4.1\r\npytest-arraydiff==0.3\r\npytest-astropy==0.8.0\r\npytest-astropy-header==0.1.2\r\npytest-doctestplus==0.5.0\r\npytest-openfiles==0.4.0\r\npytest-remotedata==0.3.2\r\npython-dateutil==2.8.1\r\npython-jsonrpc-server==0.3.4\r\npython-language-server==0.31.9\r\npytz==2019.3\r\nPyWavelets==1.1.1\r\npyxdg==0.26\r\nPyYAML==5.3.1\r\npyzmq==18.1.1\r\nQDarkStyle==2.8\r\nQtAwesome==0.7.0\r\nqtconsole==4.7.2\r\nQtPy==1.9.0\r\nrequests==2.23.0\r\nrequests-kerberos==0.12.0\r\nretrying==1.3.3\r\nrope==0.16.0\r\nRtree==0.9.3\r\nruamel-yaml==0.15.87\r\ns3fs==0.4.0\r\ns3transfer==0.3.3\r\nsagemaker==1.65.0\r\nscikit-image==0.16.2\r\nscikit-learn==0.22.1\r\nscipy==1.4.1\r\nseaborn==0.10.0\r\nSecretStorage==3.1.2\r\nSend2Trash==1.5.0\r\nsimplegeneric==0.8.1\r\nsingledispatch==3.4.0.3\r\nsix==1.14.0\r\nsmdebug-rulesconfig==0.1.4\r\nsnowballstemmer==2.0.0\r\nsortedcollections==1.1.2\r\nsortedcontainers==2.1.0\r\nsoupsieve==2.0\r\nsparkmagic==0.15.0\r\nSphinx==3.0.4\r\nsphinxcontrib-applehelp==1.0.2\r\nsphinxcontrib-devhelp==1.0.2\r\nsphinxcontrib-htmlhelp==1.0.3\r\nsphinxcontrib-jsmath==1.0.1\r\nsphinxcontrib-qthelp==1.0.3\r\nsphinxcontrib-serializinghtml==1.1.4\r\nsphinxcontrib-websupport==1.2.1\r\nspyder==4.1.2\r\nspyder-kernels==1.9.0\r\nSQLAlchemy==1.3.15\r\nstatsmodels==0.11.0\r\nsympy==1.5.1\r\ntables==3.6.1\r\ntblib==1.6.0\r\ntensorboard==1.15.0\r\ntensorflow-estimator==1.15.1\r\ntensorflow-gpu==1.15.2\r\ntensorflow-serving-api==1.15.0\r\ntermcolor==1.1.0\r\nterminado==0.8.3\r\ntestpath==0.4.4\r\ntoolz==0.10.0\r\ntornado==6.0.4\r\ntqdm==4.44.1\r\ntraitlets==4.3.3\r\ntyped-ast==1.4.1\r\ntyping==3.7.4.3\r\ntyping-extensions==3.7.4.1\r\nujson==1.35\r\nunicodecsv==0.14.1\r\nurllib3==1.25.8\r\nwatchdog==0.10.2\r\nwcwidth==0.1.9\r\nwebencodings==0.5.1\r\nWerkzeug==1.0.1\r\nwidgetsnbextension==3.5.1\r\nwrapt==1.12.1\r\nwurlitzer==2.0.0\r\nxlrd==1.2.0\r\nXlsxWriter==1.2.8\r\nxlwt==1.3.0\r\nyapf==0.28.0\r\nzict==2.0.0\r\nzipp==2.2.0\r\n```\r\n\r\nWhat to do to fix this issue?\r\n\r\nThank you.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/584", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/584/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/584/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/584/events", "html_url": "https://github.com/onnx/keras-onnx/issues/584", "id": 673651793, "node_id": "MDU6SXNzdWU2NzM2NTE3OTM=", "number": 584, "title": "ReLU negative slope ignored?", "user": {"login": "tdp2110", "id": 993053, "node_id": "MDQ6VXNlcjk5MzA1Mw==", "avatar_url": "https://avatars2.githubusercontent.com/u/993053?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tdp2110", "html_url": "https://github.com/tdp2110", "followers_url": "https://api.github.com/users/tdp2110/followers", "following_url": "https://api.github.com/users/tdp2110/following{/other_user}", "gists_url": "https://api.github.com/users/tdp2110/gists{/gist_id}", "starred_url": "https://api.github.com/users/tdp2110/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tdp2110/subscriptions", "organizations_url": "https://api.github.com/users/tdp2110/orgs", "repos_url": "https://api.github.com/users/tdp2110/repos", "events_url": "https://api.github.com/users/tdp2110/events{/privacy}", "received_events_url": "https://api.github.com/users/tdp2110/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-08-05T15:54:19Z", "updated_at": "2020-08-06T12:54:59Z", "closed_at": "2020-08-06T12:54:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "I've been investigating some divergence between a converted keras model and the original model.\r\nThe first layerwise difference I find is at a ReLU layer. My differences (checked with `numpy.testing.assert_allclose`) look like \r\n\r\n```\r\nchecking output dense  ... OK!\r\nchecking output dense_1  ... OK!\r\nchecking output re_lu  ... \r\nAssertionError: \r\nNot equal to tolerance rtol=0.001, atol=1e-07\r\n\r\nMismatched elements: 583 / 1024 (56.9%)\r\nMax absolute difference: 0.01077522\r\nMax relative difference: 1.7480605e-05\r\n x: array([[ 0.015924, -0.00205 , -0.007421, ..., -0.00298 ,  0.032283,\r\n         0.026983]], dtype=float32)\r\n y: array([[0.015924, 0.      , 0.      , ..., 0.      , 0.032283, 0.026983]],\r\n```\r\n\r\nThe `x` arg to `numpy.testing.assert_allclose` is the keras output, the `y` arg is the onnx output, as computed by `onnxruntime`.\r\n\r\nThe layer has parameters\r\n```\r\n# node properties\r\n  type: ReLU\r\n  name: re_lu\r\n# Attributes\r\n  dtype: float32\r\n  negative_slope: 0.1\r\n  threshold: 0\r\n  trainable: true\r\n# inputs\r\n  input name: dense_1\r\n# outputs\r\n  output: name: re_lu\r\n```\r\n\r\nGiven the zeros in the onnx output, my guess is either the converter is ignoring the negative slope or the `onnxruntime` is. I suspect the issue is with the converter because this layer maps to a `Clip`. Using a different inference framework, TensorRT, I also find the zeros.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/582", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/582/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/582/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/582/events", "html_url": "https://github.com/onnx/keras-onnx/issues/582", "id": 670965299, "node_id": "MDU6SXNzdWU2NzA5NjUyOTk=", "number": 582, "title": "ValueError: Failed to create ONNX node. Undefined attribute pair (perm, None) found", "user": {"login": "Zhen-hao", "id": 10957195, "node_id": "MDQ6VXNlcjEwOTU3MTk1", "avatar_url": "https://avatars3.githubusercontent.com/u/10957195?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zhen-hao", "html_url": "https://github.com/Zhen-hao", "followers_url": "https://api.github.com/users/Zhen-hao/followers", "following_url": "https://api.github.com/users/Zhen-hao/following{/other_user}", "gists_url": "https://api.github.com/users/Zhen-hao/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zhen-hao/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zhen-hao/subscriptions", "organizations_url": "https://api.github.com/users/Zhen-hao/orgs", "repos_url": "https://api.github.com/users/Zhen-hao/repos", "events_url": "https://api.github.com/users/Zhen-hao/events{/privacy}", "received_events_url": "https://api.github.com/users/Zhen-hao/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-08-01T15:33:37Z", "updated_at": "2020-08-18T07:18:59Z", "closed_at": "2020-08-05T18:21:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI tried follow the example and run\r\n\r\n```\r\nonnx_model = keras2onnx.convert_keras(model, name=None, doc_string='', target_opset=None, channel_first_inputs=None)\r\n```\r\nwhere `model` is a fine-tuned BERT model from `transformers`.\r\n\r\nI got the following error:\r\n\r\n```\r\ntf executing eager_mode: True\r\ntf.keras model eager_mode: False\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n<ipython-input-5-34f8de6efb6e> in <module>\r\n      1 # onnx_model = keras2onnx.convert_keras(model, model.name)\r\n----> 2 onnx_model = keras2onnx.convert_keras(model, name=None, doc_string='', target_opset=None, channel_first_inputs=None)\r\n\r\n/nix/store/j9i1z5awms0dny4cps87kf7yig8cyywb-python3.7-keras2onnx-1.7.0/lib/python3.7/site-packages/keras2onnx/main.py in convert_keras(model, name, doc_string, target_opset, channel_first_inputs, debug_mode, custom_op_conversions)\r\n     81     topology.compile()\r\n     82 \r\n---> 83     return convert_topology(topology, name, doc_string, target_opset, channel_first_inputs)\r\n     84 \r\n     85 \r\n\r\n/nix/store/j9i1z5awms0dny4cps87kf7yig8cyywb-python3.7-keras2onnx-1.7.0/lib/python3.7/site-packages/keras2onnx/topology.py in convert_topology(topology, model_name, doc_string, target_opset, channel_first_inputs)\r\n    320         if cvt is None:\r\n    321             raise RuntimeError(\"Unexpected error on find the converter for op {}\".format(operator.type))\r\n--> 322         cvt(scope, operator, container)\r\n    323 \r\n    324     # enable the ONNX optimizations\r\n\r\n/nix/store/j9i1z5awms0dny4cps87kf7yig8cyywb-python3.7-keras2onnx-1.7.0/lib/python3.7/site-packages/keras2onnx/_builtin.py in convert_tf_transpose(scope, operator, container)\r\n   1633                               operator.output_full_names,\r\n   1634                               name=operator.full_name,\r\n-> 1635                               perm=perm)\r\n   1636 \r\n   1637 \r\n\r\n/nix/store/j9i1z5awms0dny4cps87kf7yig8cyywb-python3.7-keras2onnx-1.7.0/lib/python3.7/site-packages/keras2onnx/common/onnx_ops.py in apply_op_with_output(self, apply_func_name, inputs, outputs, name, **attrs)\r\n     90         assert apply_func is not None, \"{} not implemented in onnx_ops.py.\".format(apply_func_name)\r\n     91         ox_inputs = self._process_inputs(inputs, name)\r\n---> 92         apply_func(self._scope, ox_inputs, outputs, self._container, operator_name=name, **attrs)\r\n\r\n/nix/store/88zmsdwxz80a2hjpsvav440ypgv0343c-python3.7-onnxconverter-common-1.7.0/lib/python3.7/site-packages/onnxconverter_common/onnx_ops.py in apply_transpose(scope, input_name, output_name, container, operator_name, perm)\r\n   1104 def apply_transpose(scope, input_name, output_name, container, operator_name=None, perm=None):\r\n   1105     name = _create_name_or_use_existing_one(scope, 'Transpose', operator_name)\r\n-> 1106     container.add_node('Transpose', input_name, output_name, name=name, perm=perm)\r\n   1107 \r\n   1108 \r\n\r\n/nix/store/j9i1z5awms0dny4cps87kf7yig8cyywb-python3.7-keras2onnx-1.7.0/lib/python3.7/site-packages/keras2onnx/common/interim.py in add_node(self, op_type, inputs, outputs, op_domain, op_version, **attrs)\r\n    121         for k, v in attrs.items():\r\n    122             if v is None:\r\n--> 123                 raise ValueError('Failed to create ONNX node. Undefined attribute pair (%s, %s) found' % (k, v))\r\n    124 \r\n    125         if 'name' in attrs.keys():\r\n\r\nValueError: Failed to create ONNX node. Undefined attribute pair (perm, None) found\r\n\r\n``` ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/579", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/579/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/579/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/579/events", "html_url": "https://github.com/onnx/keras-onnx/issues/579", "id": 670325542, "node_id": "MDU6SXNzdWU2NzAzMjU1NDI=", "number": 579, "title": "Can't convert Conv2d layer in efficientnet; \"Unable to find out a correct type for tensor type = 20\"", "user": {"login": "DavidFromMerlin", "id": 67983422, "node_id": "MDQ6VXNlcjY3OTgzNDIy", "avatar_url": "https://avatars2.githubusercontent.com/u/67983422?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DavidFromMerlin", "html_url": "https://github.com/DavidFromMerlin", "followers_url": "https://api.github.com/users/DavidFromMerlin/followers", "following_url": "https://api.github.com/users/DavidFromMerlin/following{/other_user}", "gists_url": "https://api.github.com/users/DavidFromMerlin/gists{/gist_id}", "starred_url": "https://api.github.com/users/DavidFromMerlin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DavidFromMerlin/subscriptions", "organizations_url": "https://api.github.com/users/DavidFromMerlin/orgs", "repos_url": "https://api.github.com/users/DavidFromMerlin/repos", "events_url": "https://api.github.com/users/DavidFromMerlin/events{/privacy}", "received_events_url": "https://api.github.com/users/DavidFromMerlin/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-07-31T23:13:22Z", "updated_at": "2020-08-01T18:16:12Z", "closed_at": "2020-08-01T18:16:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "Keras Efficientnet models are built into TensorFlow 2.3.0. But when I try to convert the model with keras-onnx, I get:\r\n\r\n  File \".\\lanes.py\", line 287, in output_onnx\r\n    onnx_model = keras2onnx.convert_keras(model, model.name)\r\n  File \"[...]\\Python38\\lib\\site-packages\\keras2onnx\\main.py\", line 102, in convert_keras\r\n    parse_graph(topology, tf_graph, target_opset, output_names, output_dict)\r\n  File \"[...]\\Python38\\lib\\site-packages\\keras2onnx\\parser.py\", line 853, in parse_graph\r\n    return _parse_graph_core_v2(\r\n  File \"[...]\\Python38\\lib\\site-packages\\keras2onnx\\parser.py\", line 732, in _parse_graph_core_v2\r\n    on_parsing_keras_layer_v2(graph, layer_info, varset)\r\n  File \"[...]\\Python38\\lib\\site-packages\\keras2onnx\\_parser_tf.py\", line 332, in on_parsing_keras_layer_v2\r\n    var_type = adjust_input_batch_size(infer_variable_type(i_, varset.target_opset))\r\n  File \"[...]\\Python38\\lib\\site-packages\\keras2onnx\\_parser_tf.py\", line 47, in infer_variable_type\r\n    raise ValueError(\r\n**ValueError: Unable to find out a correct type for tensor type = 20 of top_conv/Conv2D/ReadVariableOp/resource:0**\r\n\r\nDoing some debugging, I see that the troublesome tensor looks like this:\r\n>>> pprint(vars(tensor))\r\n{'_consumers': [],\r\n '_dtype': tf.resource,\r\n '_id': 8091,\r\n '_name': 'top_conv/Conv2D/ReadVariableOp/resource:0',\r\n '_op': <tf.Operation 'top_conv/Conv2D/ReadVariableOp/resource' type=Placeholder>,\r\n '_shape_val': TensorShape([]),\r\n '_tf_output': <tensorflow.python._pywrap_tf_session.TF_Output object at 0x000001CB262DF830>,\r\n '_value_index': 0}\r\n\r\n>>> pprint(tensor.op)\r\n<tf.Operation 'top_conv/Conv2D/ReadVariableOp/resource' **type=Placeholder**>\r\n\r\n>>> pprint(vars(tensor.op))\r\n{'_c_op': <tensorflow.python._pywrap_tf_session.TF_Operation object at 0x000001CB262DF930>,\r\n '_colocation_code_locations': {},\r\n '_control_flow_context': None,\r\n '_device_code_locations': [],\r\n '_gradient_function': None,\r\n '_graph': <tensorflow.python.framework.func_graph.FuncGraph object at 0x000001C9493616A0>,\r\n '_id_value': 1741,\r\n '_inputs_val': (),\r\n '_is_stateful': False,\r\n '_original_op': None,\r\n '_outputs': [<tf.Tensor 'top_conv/Conv2D/ReadVariableOp/resource:0' shape=() dtype=resource>],\r\n '_traceback': <tensorflow.python._tf_stack.StackSummary object at 0x000001CB262DF730>}\r\n\r\n>>> pprint(tensor.op.node_def)\r\nname: \"top_conv/Conv2D/ReadVariableOp/resource\"\r\nop: \"Placeholder\"\r\nattr {\r\n  key: \"dtype\"\r\n  value {\r\n    type: DT_RESOURCE\r\n  }\r\n}\r\nattr {\r\n  key: \"shape\"\r\n  value {\r\n    shape {\r\n    }\r\n  }\r\n}\r\n\r\nNote that the tensor.op.node_def.attr['dtype'] is DT_RESOURCE, which is where the \"20\" in the error message comes from. (DT_RESOURCE is type 20 in the Tensorflow protobuf)\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/573", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/573/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/573/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/573/events", "html_url": "https://github.com/onnx/keras-onnx/issues/573", "id": 665680616, "node_id": "MDU6SXNzdWU2NjU2ODA2MTY=", "number": 573, "title": "Converting RCNN gives error", "user": {"login": "MathijsNL", "id": 1612886, "node_id": "MDQ6VXNlcjE2MTI4ODY=", "avatar_url": "https://avatars0.githubusercontent.com/u/1612886?v=4", "gravatar_id": "", "url": "https://api.github.com/users/MathijsNL", "html_url": "https://github.com/MathijsNL", "followers_url": "https://api.github.com/users/MathijsNL/followers", "following_url": "https://api.github.com/users/MathijsNL/following{/other_user}", "gists_url": "https://api.github.com/users/MathijsNL/gists{/gist_id}", "starred_url": "https://api.github.com/users/MathijsNL/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/MathijsNL/subscriptions", "organizations_url": "https://api.github.com/users/MathijsNL/orgs", "repos_url": "https://api.github.com/users/MathijsNL/repos", "events_url": "https://api.github.com/users/MathijsNL/events{/privacy}", "received_events_url": "https://api.github.com/users/MathijsNL/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-07-26T00:03:41Z", "updated_at": "2020-08-14T22:30:16Z", "closed_at": "2020-07-26T03:50:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\n\r\nToday I have been struggling to get this keras model converted to ONNX.\r\nPython version: 3.7\r\nTF-gpu version: 2.2.0\r\nKeras version: 2.4.3\r\nkeras2onnx version: 1.7.0\r\n\r\nThe trained network I am trying to convert:\r\n[https://github.com/akTwelve/Mask_RCNN](https://github.com/akTwelve/Mask_RCNN)\r\nI can run the netwerk fine, and I am getting all outputs without any errors. Not sure if relevent but the type of network is:\r\ntensorflow.python.keras.engine.training.Model\r\n\r\nThe code I am using to convert it:\r\n```\r\nimport keras2onnx\r\nprint(\"keras2onnx version is \"+keras2onnx.__version__)\r\n# convert to onnx model\r\nonnx_model = keras2onnx.convert_keras(model.keras_model, 'test', debug_mode=1)\r\noutput_model_path = \"test-model.onnx\"\r\n# and save the model in ONNX format\r\nkeras2onnx.save_model(onnx_model, output_model_path)\r\n```\r\n\r\nThe error:\r\n```\r\nlib/python3.7/site-packages/keras2onnx/_parser_tf.py in infer_variable_type(tensor, opset, inbound_node_shape)\r\n     46     else:\r\n     47         raise ValueError(\r\n---> 48             \"Unable to find out a correct type for tensor type = {} of {}\".format(tensor_type, tensor.name))\r\n     49 \r\n     50 \r\n\r\nValueError: Unable to find out a correct type for tensor type = <dtype: 'variant'> of mask_rcnn/mrcnn_detection/map/while/exit/_37:0\r\n```\r\n\r\nAnd the last 15 lines of the keras2onnx debug:\r\n```\r\nProcessing a tf node - mask_rcnn/mrcnn_detection/DenseToDenseSetOperation\r\n\toutput: mask_rcnn/mrcnn_detection/DenseToDenseSetOperation:0\r\n\toutput: mask_rcnn/mrcnn_detection/DenseToDenseSetOperation:1\r\n\toutput: mask_rcnn/mrcnn_detection/DenseToDenseSetOperation:2\r\n\tinput : mask_rcnn/mrcnn_detection/ExpandDims:0\r\n\tinput : mask_rcnn/mrcnn_detection/ExpandDims_1:0\r\n('mask_rcnn/mrcnn_detection/zeros', 'Custom_Layer')\r\nProcessing a tf node - mask_rcnn/mrcnn_detection/zeros\r\n\toutput: mask_rcnn/mrcnn_detection/zeros:0\r\n('mask_rcnn/mrcnn_detection/map/TensorArrayV2Stack/TensorListStack', 'Custom_Layer')\r\nWARN: No corresponding ONNX op matches the tf.op node mask_rcnn/mrcnn_detection/map/TensorArrayV2Stack/TensorListStack of type TensorListStack\r\n      The generated ONNX model needs run with the custom op supports.\r\nProcessing a tf node - mask_rcnn/mrcnn_detection/map/TensorArrayV2Stack/TensorListStack\r\n\toutput: mask_rcnn/mrcnn_detection/map/TensorArrayV2Stack/TensorListStack:0\r\n\tinput : mask_rcnn/mrcnn_detection/map/while/exit/_37:0\r\n```\r\n\r\nIt probably has something to do with the custom op support, but I just cannot find how to solve it. I hope someone here can point me in the right direction.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/563", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/563/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/563/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/563/events", "html_url": "https://github.com/onnx/keras-onnx/issues/563", "id": 658195572, "node_id": "MDU6SXNzdWU2NTgxOTU1NzI=", "number": 563, "title": "Unable to Install keras2onnx", "user": {"login": "canozcivelek", "id": 8135008, "node_id": "MDQ6VXNlcjgxMzUwMDg=", "avatar_url": "https://avatars0.githubusercontent.com/u/8135008?v=4", "gravatar_id": "", "url": "https://api.github.com/users/canozcivelek", "html_url": "https://github.com/canozcivelek", "followers_url": "https://api.github.com/users/canozcivelek/followers", "following_url": "https://api.github.com/users/canozcivelek/following{/other_user}", "gists_url": "https://api.github.com/users/canozcivelek/gists{/gist_id}", "starred_url": "https://api.github.com/users/canozcivelek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/canozcivelek/subscriptions", "organizations_url": "https://api.github.com/users/canozcivelek/orgs", "repos_url": "https://api.github.com/users/canozcivelek/repos", "events_url": "https://api.github.com/users/canozcivelek/events{/privacy}", "received_events_url": "https://api.github.com/users/canozcivelek/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-16T13:23:59Z", "updated_at": "2020-07-17T12:59:39Z", "closed_at": "2020-07-17T12:59:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, I've tried installing keras2onnx on my Jetson Nano using both pip install keras2onnx and build from the source commands. However, all of them gave error and exited without success. I need help here, thanks! Here's a sample shell output from the installation:\r\n\r\npip3 install keras2onnx\r\n\r\nDefaulting to user installation because normal site-packages is not writeable\r\nCollecting keras2onnx\r\n  Using cached keras2onnx-1.7.0-py3-none-any.whl (96 kB)\r\nRequirement already satisfied: requests in /usr/local/lib/python3.6/dist-packages (from keras2onnx) (2.22.0)\r\nRequirement already satisfied: protobuf in /usr/local/lib/python3.6/dist-packages (from keras2onnx) (3.11.0)\r\nCollecting onnx\r\n  Using cached onnx-1.7.0.tar.gz (5.5 MB)\r\n  Installing build dependencies ... error\r\n  ERROR: Command errored out with exit status 1:\r\n   command: /usr/bin/python3 /usr/local/lib/python3.6/dist-packages/pip install --ignore-installed --no-user --prefix /tmp/pip-build-env-jtdjnxzz/overlay --no-warn-script-location --no-binary :none: --only-binary :none: -i https://pypi.org/simple -- setuptools wheel protobuf\r\n       cwd: None\r\n  Complete output (39 lines):\r\n  Traceback (most recent call last):\r\n    File \"/usr/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n      \"__main__\", mod_spec)\r\n    File \"/usr/lib/python3.6/runpy.py\", line 85, in _run_code\r\n      exec(code, run_globals)\r\n    File \"/usr/local/lib/python3.6/dist-packages/pip/__main__.py\", line 23, in <module>\r\n      from pip._internal.cli.main import main as _main  # isort:skip # noqa\r\n    File \"/usr/local/lib/python3.6/dist-packages/pip/_internal/cli/main.py\", line 5, in <module>\r\n      import locale\r\n    File \"/usr/lib/python3.6/locale.py\", line 16, in <module>\r\n      import re\r\n    File \"/usr/lib/python3.6/re.py\", line 142, in <module>\r\n      class RegexFlag(enum.IntFlag):\r\n  AttributeError: module 'enum' has no attribute 'IntFlag'\r\n  Error in sys.excepthook:\r\n  Traceback (most recent call last):\r\n    File \"/usr/lib/python3/dist-packages/apport_python_hook.py\", line 53, in apport_excepthook\r\n      if not enabled():\r\n    File \"/usr/lib/python3/dist-packages/apport_python_hook.py\", line 24, in enabled\r\n      import re\r\n    File \"/usr/lib/python3.6/re.py\", line 142, in <module>\r\n      class RegexFlag(enum.IntFlag):\r\n  AttributeError: module 'enum' has no attribute 'IntFlag'\r\n  \r\n  Original exception was:\r\n  Traceback (most recent call last):\r\n    File \"/usr/lib/python3.6/runpy.py\", line 193, in _run_module_as_main\r\n      \"__main__\", mod_spec)\r\n    File \"/usr/lib/python3.6/runpy.py\", line 85, in _run_code\r\n      exec(code, run_globals)\r\n    File \"/usr/local/lib/python3.6/dist-packages/pip/__main__.py\", line 23, in <module>\r\n      from pip._internal.cli.main import main as _main  # isort:skip # noqa\r\n    File \"/usr/local/lib/python3.6/dist-packages/pip/_internal/cli/main.py\", line 5, in <module>\r\n      import locale\r\n    File \"/usr/lib/python3.6/locale.py\", line 16, in <module>\r\n      import re\r\n    File \"/usr/lib/python3.6/re.py\", line 142, in <module>\r\n      class RegexFlag(enum.IntFlag):\r\n  AttributeError: module 'enum' has no attribute 'IntFlag'\r\n  ----------------------------------------\r\nERROR: Command errored out with exit status 1: /usr/bin/python3 /usr/local/lib/python3.6/dist-packages/pip install --ignore-installed --no-user --prefix /tmp/pip-build-env-jtdjnxzz/overlay --no-warn-script-location --no-binary :none: --only-binary :none: -i https://pypi.org/simple -- setuptools wheel protobuf Check the logs for full command output.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/561", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/561/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/561/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/561/events", "html_url": "https://github.com/onnx/keras-onnx/issues/561", "id": 656743682, "node_id": "MDU6SXNzdWU2NTY3NDM2ODI=", "number": 561, "title": "Keras Onnx model conversion not successful. Weight file and Model architecture does not seem to match", "user": {"login": "Abrahamma97", "id": 54631352, "node_id": "MDQ6VXNlcjU0NjMxMzUy", "avatar_url": "https://avatars0.githubusercontent.com/u/54631352?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Abrahamma97", "html_url": "https://github.com/Abrahamma97", "followers_url": "https://api.github.com/users/Abrahamma97/followers", "following_url": "https://api.github.com/users/Abrahamma97/following{/other_user}", "gists_url": "https://api.github.com/users/Abrahamma97/gists{/gist_id}", "starred_url": "https://api.github.com/users/Abrahamma97/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Abrahamma97/subscriptions", "organizations_url": "https://api.github.com/users/Abrahamma97/orgs", "repos_url": "https://api.github.com/users/Abrahamma97/repos", "events_url": "https://api.github.com/users/Abrahamma97/events{/privacy}", "received_events_url": "https://api.github.com/users/Abrahamma97/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-07-14T16:29:17Z", "updated_at": "2020-07-24T02:45:47Z", "closed_at": "2020-07-24T02:45:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi I had tried to convert the weights.h5 to onnx format. The github page containing  https://github.com/AdrianNunez/Fall-Detection-with-CNNs-and-Optical-Flow contains the weights.h5. \r\n[Weightsh5toonnxconv.py.txt](https://github.com/onnx/keras-onnx/files/4919970/Weightsh5toonnxconv.py.txt)\r\nKindly tell me what I am doing wrong and also give me tips on how to make this conversion as perfect as possible.\r\nThis is the error on executing Weightsh5toonnxconv.py(I created this script )\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/ubuntu/.local/lib/python3.6/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\nWARNING:tensorflow:From /home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nCall initializer instance with the dtype argument instead of passing it to the constructor\r\nModel: \"sequential\"\r\n_________________________________________________________________\r\nLayer (type)                 Output Shape              Param #   \r\n=================================================================\r\nzero_padding2d (ZeroPadding2 (None, 226, 226, 20)      0         \r\n_________________________________________________________________\r\nconv1_1 (Conv2D)             (None, 224, 224, 64)      11584     \r\n_________________________________________________________________\r\nzero_padding2d_1 (ZeroPaddin (None, 226, 226, 64)      0         \r\n_________________________________________________________________\r\nconv1_2 (Conv2D)             (None, 224, 224, 64)      36928     \r\n_________________________________________________________________\r\nmax_pooling2d (MaxPooling2D) (None, 112, 112, 64)      0         \r\n_________________________________________________________________\r\nzero_padding2d_2 (ZeroPaddin (None, 114, 114, 64)      0         \r\n_________________________________________________________________\r\nconv2_1 (Conv2D)             (None, 112, 112, 128)     73856     \r\n_________________________________________________________________\r\nzero_padding2d_3 (ZeroPaddin (None, 114, 114, 128)     0         \r\n_________________________________________________________________\r\nconv2_2 (Conv2D)             (None, 112, 112, 128)     147584    \r\n_________________________________________________________________\r\nmax_pooling2d_1 (MaxPooling2 (None, 56, 56, 128)       0         \r\n_________________________________________________________________\r\nzero_padding2d_4 (ZeroPaddin (None, 58, 58, 128)       0         \r\n_________________________________________________________________\r\nconv3_1 (Conv2D)             (None, 56, 56, 256)       295168    \r\n_________________________________________________________________\r\nzero_padding2d_5 (ZeroPaddin (None, 58, 58, 256)       0         \r\n_________________________________________________________________\r\nconv3_2 (Conv2D)             (None, 56, 56, 256)       590080    \r\n_________________________________________________________________\r\nzero_padding2d_6 (ZeroPaddin (None, 58, 58, 256)       0         \r\n_________________________________________________________________\r\nconv3_3 (Conv2D)             (None, 56, 56, 256)       590080    \r\n_________________________________________________________________\r\nmax_pooling2d_2 (MaxPooling2 (None, 28, 28, 256)       0         \r\n_________________________________________________________________\r\nzero_padding2d_7 (ZeroPaddin (None, 30, 30, 256)       0         \r\n_________________________________________________________________\r\nconv4_1 (Conv2D)             (None, 28, 28, 512)       1180160   \r\n_________________________________________________________________\r\nzero_padding2d_8 (ZeroPaddin (None, 30, 30, 512)       0         \r\n_________________________________________________________________\r\nconv4_2 (Conv2D)             (None, 28, 28, 512)       2359808   \r\n_________________________________________________________________\r\nzero_padding2d_9 (ZeroPaddin (None, 30, 30, 512)       0         \r\n_________________________________________________________________\r\nconv4_3 (Conv2D)             (None, 28, 28, 512)       2359808   \r\n_________________________________________________________________\r\nmax_pooling2d_3 (MaxPooling2 (None, 14, 14, 512)       0         \r\n_________________________________________________________________\r\nzero_padding2d_10 (ZeroPaddi (None, 16, 16, 512)       0         \r\n_________________________________________________________________\r\nconv5_1 (Conv2D)             (None, 14, 14, 512)       2359808   \r\n_________________________________________________________________\r\nzero_padding2d_11 (ZeroPaddi (None, 16, 16, 512)       0         \r\n_________________________________________________________________\r\nconv5_2 (Conv2D)             (None, 14, 14, 512)       2359808   \r\n_________________________________________________________________\r\nzero_padding2d_12 (ZeroPaddi (None, 16, 16, 512)       0         \r\n_________________________________________________________________\r\nconv5_3 (Conv2D)             (None, 14, 14, 512)       2359808   \r\n_________________________________________________________________\r\nmax_pooling2d_4 (MaxPooling2 (None, 7, 7, 512)         0         \r\n_________________________________________________________________\r\nflatten (Flatten)            (None, 25088)             0         \r\n_________________________________________________________________\r\nfc6 (Dense)                  (None, 4096)              102764544 \r\n=================================================================\r\nTotal params: 117,489,024\r\nTrainable params: 117,489,024\r\nNon-trainable params: 0\r\n_________________________________________________________________\r\nTraceback (most recent call last):\r\n  File \"archtojson.py\", line 54, in <module>\r\n    model.load_weights('/home/ubuntu/Desktop/onnxkeras/weights.h5')\r\n  File \"/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/keras/engine/training.py\", line 162, in load_weights\r\n    return super(Model, self).load_weights(filepath, by_name)\r\n  File \"/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/keras/engine/network.py\", line 1424, in load_weights\r\n    saving.load_weights_from_hdf5_group(f, self.layers)\r\n  File \"/home/ubuntu/.local/lib/python3.6/site-packages/tensorflow/python/keras/saving/hdf5_format.py\", line 737, in load_weights_from_hdf5_group\r\n    ' layers.')\r\nValueError: You are trying to load a weight file containing 0 layers into a model with 14 layers.\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/555", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/555/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/555/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/555/events", "html_url": "https://github.com/onnx/keras-onnx/issues/555", "id": 652748966, "node_id": "MDU6SXNzdWU2NTI3NDg5NjY=", "number": 555, "title": "Different output shape with padding=\"same\" in Conv2DTranspose", "user": {"login": "hirokic5", "id": 19792127, "node_id": "MDQ6VXNlcjE5NzkyMTI3", "avatar_url": "https://avatars2.githubusercontent.com/u/19792127?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hirokic5", "html_url": "https://github.com/hirokic5", "followers_url": "https://api.github.com/users/hirokic5/followers", "following_url": "https://api.github.com/users/hirokic5/following{/other_user}", "gists_url": "https://api.github.com/users/hirokic5/gists{/gist_id}", "starred_url": "https://api.github.com/users/hirokic5/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hirokic5/subscriptions", "organizations_url": "https://api.github.com/users/hirokic5/orgs", "repos_url": "https://api.github.com/users/hirokic5/repos", "events_url": "https://api.github.com/users/hirokic5/events{/privacy}", "received_events_url": "https://api.github.com/users/hirokic5/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-07-07T23:46:33Z", "updated_at": "2020-07-11T18:10:12Z", "closed_at": "2020-07-11T18:09:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello, \r\n\r\nI use Conv2DTranspose in my model.  \r\nBut when converted it to onnx model,  the output of onnx model seems to differ from that of keras model.  \r\nMaybe there is something wrong with padding... when padding=\"valid\", the problem of output shape does not occur.  \r\n\r\nHere is an example.\r\n```\r\nfrom tensorflow.keras.layers import Input, Conv2DTranspose, BatchNormalization, ReLU, Conv2D, Lambda, MaxPooling2D, Dropout,Lambda\r\nfrom tensorflow.keras.layers import ZeroPadding2D\r\nfrom tensorflow.keras.models import Model\r\nfrom tensorflow.keras.regularizers import l2\r\n\r\ndef test_model(size=None,padding=\"same\"):\r\n    input_img = Input((size,size,3))\r\n    x = Conv2DTranspose(256, (4, 4), strides=2, use_bias=False, padding=padding,\r\n                        kernel_initializer='he_normal',\r\n                        kernel_regularizer=l2(5e-4))(input_img)\r\n    x = BatchNormalization()(x)\r\n    y = ReLU()(x)\r\n    return Model(inputs=input_img,outputs=y)\r\n\r\ntest = test_model(size=512)\r\nprint(test.input,test.output)\r\n\r\nimport keras2onnx\r\nimport numpy as np\r\nimport onnxruntime\r\ntest = test_model()\r\noutput_model_path = \"weights/test.onnx\"\r\nonnx_model = keras2onnx.convert_keras(test, test.name)\r\nkeras2onnx.save_model(onnx_model, output_model_path)\r\n\r\nx = np.zeros((512,512,3))\r\ninputs = np.expand_dims(x,axis=0)\r\nsess = onnxruntime.InferenceSession(output_model_path)\r\ndata = [inputs.astype(np.float32)]\r\ninput_names = sess.get_inputs()\r\nfeed = zip(sorted(i_.name for i_ in input_names), data)\r\n\r\nactual = sess.run(None, dict(feed))\r\n\r\nfor k in actual:\r\n    print(k.shape)\r\n```\r\n> tf executing eager_mode: True\r\ntf.keras model eager_mode: False\r\nThe ONNX operator number change on the optimization: 12 -> 5\r\nTensor(\"input_5:0\", shape=(None, 512, 512, 3), dtype=float32) Tensor(\"re_lu_4/Identity:0\", shape=(None, 1024, 1024, 256), dtype=float32)\r\n(1, 1026, 1026, 256)\r\n\r\n\r\nthank you!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/550", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/550/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/550/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/550/events", "html_url": "https://github.com/onnx/keras-onnx/issues/550", "id": 650562908, "node_id": "MDU6SXNzdWU2NTA1NjI5MDg=", "number": 550, "title": "concatenating tensors give IndexError: list index out of range with opset 8", "user": {"login": "adder", "id": 706666, "node_id": "MDQ6VXNlcjcwNjY2Ng==", "avatar_url": "https://avatars2.githubusercontent.com/u/706666?v=4", "gravatar_id": "", "url": "https://api.github.com/users/adder", "html_url": "https://github.com/adder", "followers_url": "https://api.github.com/users/adder/followers", "following_url": "https://api.github.com/users/adder/following{/other_user}", "gists_url": "https://api.github.com/users/adder/gists{/gist_id}", "starred_url": "https://api.github.com/users/adder/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/adder/subscriptions", "organizations_url": "https://api.github.com/users/adder/orgs", "repos_url": "https://api.github.com/users/adder/repos", "events_url": "https://api.github.com/users/adder/events{/privacy}", "received_events_url": "https://api.github.com/users/adder/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-03T12:22:17Z", "updated_at": "2020-07-04T12:17:07Z", "closed_at": "2020-07-04T12:17:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hey\r\n\r\nI use tensorflow 2.2 and keras2onnx installed from source.\r\nWhen executing the following minimal code:\r\n\r\n```\r\nimport tensorflow as tf\r\nimport keras2onnx\r\ninp = tf.keras.layers.Input(shape=[480, 640, 6])\r\n\r\ndef custom_reduce(o):\r\n    o1 = tf.reduce_max(o * [1,0,0,0,1,1],-1,keepdims = True)\r\n    o2 = tf.reduce_max(o * [0,1,0,0,0,0],-1,keepdims = True)\r\n    o3 = tf.reduce_max(o * [0,0,1,1,0,0],-1,keepdims = True)\r\n    return tf.concat([o1,o2],-1)\r\n\r\n# o = tf.keras.layers.Conv2D(6, (1, 1), activation='relu', padding='same')(inp)\r\no = tf.keras.layers.Softmax()(inp)\r\nout = tf.keras.layers.Lambda(custom_reduce)(o)\r\nm = tf.keras.Model(inp,out)\r\nonnx_model = keras2onnx.convert_keras(m,target_opset = 8)\r\n```\r\n I get the error\r\n\r\n```\r\ntf executing eager_mode: True\r\ntf.keras model eager_mode: False\r\nThere is an error(<class 'IndexError'>) happened during optimizing on the converted model!\r\nlist index out of range\r\nTraceback (most recent call last):\r\n  File \"/Users/adriaan/.pyenv/versions/tf22/lib/python3.7/site-packages/keras2onnx/topology.py\", line 336, in convert_topology\r\n    outputs=container.outputs)\r\n  File \"/Users/adriaan/.pyenv/versions/tf22/lib/python3.7/site-packages/onnxconverter_common/optimizer.py\", line 1714, in optimize_onnx\r\n    node_list = _process_optimization(node_list, target_opset)\r\n  File \"/Users/adriaan/.pyenv/versions/tf22/lib/python3.7/site-packages/onnxconverter_common/optimizer.py\", line 1629, in _process_optimization\r\n    solution = optm.find(node_)\r\n  File \"/Users/adriaan/.pyenv/versions/tf22/lib/python3.7/site-packages/onnxconverter_common/optimizer.py\", line 1535, in find\r\n    if MergeCommonSequenceOptimizer.is_same_node_merge(succ_0, succ_1, node):\r\n  File \"/Users/adriaan/.pyenv/versions/tf22/lib/python3.7/site-packages/onnxconverter_common/optimizer.py\", line 1598, in is_same_node_merge\r\n    val_0 = numpy_helper.to_array(pred_0.tensors[0])\r\nIndexError: list index out of range\r\n```\r\n\r\nAny clues, why I get this error and how to get around it?\r\nIt works with opset version 9 but I'm stuck with 8 because of limitations downstream the pipline.\r\nThanks", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/547", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/547/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/547/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/547/events", "html_url": "https://github.com/onnx/keras-onnx/issues/547", "id": 649692047, "node_id": "MDU6SXNzdWU2NDk2OTIwNDc=", "number": 547, "title": "Prediction on probability output of keras?", "user": {"login": "hanzigs", "id": 30790120, "node_id": "MDQ6VXNlcjMwNzkwMTIw", "avatar_url": "https://avatars1.githubusercontent.com/u/30790120?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hanzigs", "html_url": "https://github.com/hanzigs", "followers_url": "https://api.github.com/users/hanzigs/followers", "following_url": "https://api.github.com/users/hanzigs/following{/other_user}", "gists_url": "https://api.github.com/users/hanzigs/gists{/gist_id}", "starred_url": "https://api.github.com/users/hanzigs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hanzigs/subscriptions", "organizations_url": "https://api.github.com/users/hanzigs/orgs", "repos_url": "https://api.github.com/users/hanzigs/repos", "events_url": "https://api.github.com/users/hanzigs/events{/privacy}", "received_events_url": "https://api.github.com/users/hanzigs/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-07-02T07:08:36Z", "updated_at": "2020-07-02T23:01:07Z", "closed_at": "2020-07-02T22:59:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a keras model \r\n```\r\ncols = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y']\r\npayload = [[0.62382546,-0.37804684,-0.079906,-0.45980235,0.34740723,0.00235355,-0.29869863,-2.25137177,0.09773262,-0.04770562,-1.13753923,-2.31292707,0.27057148,-1.84923494,-0.65983332,0.07649027,-0.07734961,-0.70264886,0.17072499,0.1468576,-2.07244491,0.84444339,-0.05756989,-1.54643614,0.10969839]]\r\nimport pandas \r\ndf = pandas.DataFrame(data=payload,columns=cols)\r\nkerasmodel.predict_proba(df.values)\r\n```\r\nthe model return\r\n```\r\narray([[0.01505428]], dtype=float32)\r\n```\r\nNow I use onnx\r\n```\r\nonnx_model = keras2onnx.convert_keras(kerasmodel, 'keras-onnx', debug_mode=1)\r\nkeras2onnx.save_model(onnx_model, 'keras-onnx.onnx')\r\n\r\nsess_options = onnxruntime.SessionOptions()\r\nsess = onnxruntime.InferenceSession('keras-onnx.onnx', sess_options)\r\nfeed = dict([(input.name, payload[n]) for n, input in enumerate(sess.get_inputs())])\r\nonnx_predicted_label = sess.run(None, feed)[0].argmax()\r\n```\r\nI get error\r\n```\r\nTraceback (most recent call last):\r\n\r\n  File \"<ipython-input-72-60dc3ed517ff>\", line 1, in <module>\r\n    onnx_predicted_label = sess.run(None, feed)[0].argmax()\r\n\r\n  File \"C:\\Users\\PremGeorgeAlphonse\\Anaconda3\\lib\\site-packages\\onnxruntime\\capi\\session.py\", line 111, in run\r\n    return self._sess.run(output_names, input_feed, run_options)\r\n\r\nInvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Invalid rank for input: dense_4_input Got: 1 Expected: 2 Please fix either the inputs or the model.\r\n```\r\nI am sure I am not doing the prediction with onnxruntime correctly? may I have some help, Thanks\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/543", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/543/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/543/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/543/events", "html_url": "https://github.com/onnx/keras-onnx/issues/543", "id": 647258281, "node_id": "MDU6SXNzdWU2NDcyNTgyODE=", "number": 543, "title": "Conversion of InstanceNormalization in combination with LSTM fails", "user": {"login": "breizhn", "id": 11817865, "node_id": "MDQ6VXNlcjExODE3ODY1", "avatar_url": "https://avatars3.githubusercontent.com/u/11817865?v=4", "gravatar_id": "", "url": "https://api.github.com/users/breizhn", "html_url": "https://github.com/breizhn", "followers_url": "https://api.github.com/users/breizhn/followers", "following_url": "https://api.github.com/users/breizhn/following{/other_user}", "gists_url": "https://api.github.com/users/breizhn/gists{/gist_id}", "starred_url": "https://api.github.com/users/breizhn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/breizhn/subscriptions", "organizations_url": "https://api.github.com/users/breizhn/orgs", "repos_url": "https://api.github.com/users/breizhn/repos", "events_url": "https://api.github.com/users/breizhn/events{/privacy}", "received_events_url": "https://api.github.com/users/breizhn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-29T10:13:08Z", "updated_at": "2020-07-03T21:45:22Z", "closed_at": "2020-07-03T21:45:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi together,\r\n\r\nI am trying to convert following model: (minimal example)\r\n```python\r\nimport keras2onnx\r\nfrom tensorflow.keras.models import Model\r\nfrom tensorflow.keras.layers import Dense, LSTM, Input\r\nimport tensorflow_addons as tfa\r\n\r\nin_dat = Input(batch_shape=[1,1,128])\r\nx = tfa.layers.InstanceNormalization(axis=2, \r\n                                    center=True, \r\n                                    scale=True,\r\n                                    beta_initializer=\"random_uniform\",\r\n                                    gamma_initializer=\"random_uniform\")(in_dat)\r\nx = LSTM(128, return_sequences=True, stateful=True)(x)\r\nout_dat = Dense(128)(x)\r\nmodel = Model(inputs=in_dat, outputs=out_dat)\r\n\r\nonnx_model = keras2onnx.convert_keras(model)\r\n```\r\n\r\nthis creates following error:\r\n```bash\r\nTraceback (most recent call last):\r\n  File \"test_model_script.py\", line 16, in <module>\r\n    test_class.convert_to_onnx()\r\n  File \"xx/xx/create_model_class.py\", line 113, in convert_to_onnx\r\n    onnx_model = keras2onnx.convert_keras(self.model)\r\n  File \"/home/xx/anaconda3/envs/tf22env/lib/python3.7/site-packages/keras2onnx/main.py\", line 62, in convert_keras\r\n    tf_graph = build_layer_output_from_model(model, output_dict, input_names, output_names)\r\n  File \"/home/xx/anaconda3/envs/tf22env/lib/python3.7/site-packages/keras2onnx/_parser_tf.py\", line 302, in build_layer_output_from_model\r\n    return extract_outputs_from_subclassing_model(model, output_dict, input_names, output_names)\r\n  File \"/home/xx/anaconda3/envs/tf22env/lib/python3.7/site-packages/keras2onnx/_parser_tf.py\", line 264, in extract_outputs_from_subclassing_model\r\n    concrete_func, lower_control_flow=True)\r\n  File \"/home/xxs/anaconda3/envs/tf22env/lib/python3.7/site-packages/keras2onnx/_graph_cvt.py\", line 506, in convert_variables_to_constants_v2\r\n    raise ValueError(\"Cannot find the Placeholder op that is an input \"\r\nValueError: Cannot find the Placeholder op that is an input to the ReadVariableOp.\r\n```\r\n\r\nConverting without the LSTM layer works fine:\r\n```python\r\nin_dat = Input(batch_shape=[1,1,128])\r\nx = tfa.layers.InstanceNormalization(axis=2, \r\n                                    center=True, \r\n                                    scale=True,\r\n                                    beta_initializer=\"random_uniform\",\r\n                                    gamma_initializer=\"random_uniform\")(in_dat)\r\n\r\nout_dat = Dense(128)(x)\r\nmodel = Model(inputs=in_dat, outputs=out_dat)\r\n\r\nonnx_model = keras2onnx.convert_keras(model)\r\n```\r\n\r\nWhat can I do? Is there a workaround? Or is it a Tensorflow bug?\r\n\r\nThanks for your help in advance!\r\nBest,\r\nNils\r\n(Ubuntu 18.04 / TF 2.1 / conda )", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/537", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/537/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/537/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/537/events", "html_url": "https://github.com/onnx/keras-onnx/issues/537", "id": 645731038, "node_id": "MDU6SXNzdWU2NDU3MzEwMzg=", "number": 537, "title": "Improper Topological sorting of Nodes in the ONNX model", "user": {"login": "buddhapuneeth", "id": 3439010, "node_id": "MDQ6VXNlcjM0MzkwMTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/3439010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/buddhapuneeth", "html_url": "https://github.com/buddhapuneeth", "followers_url": "https://api.github.com/users/buddhapuneeth/followers", "following_url": "https://api.github.com/users/buddhapuneeth/following{/other_user}", "gists_url": "https://api.github.com/users/buddhapuneeth/gists{/gist_id}", "starred_url": "https://api.github.com/users/buddhapuneeth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/buddhapuneeth/subscriptions", "organizations_url": "https://api.github.com/users/buddhapuneeth/orgs", "repos_url": "https://api.github.com/users/buddhapuneeth/repos", "events_url": "https://api.github.com/users/buddhapuneeth/events{/privacy}", "received_events_url": "https://api.github.com/users/buddhapuneeth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-25T17:24:28Z", "updated_at": "2020-06-27T06:18:02Z", "closed_at": "2020-06-27T06:18:02Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I am noticing issues with the topological sorting of nodes in the ONNX model. The nodes list is coming in different order than expected. Of course, inference engines like ONNXRuntime can handle nodes in any order. But we have hard requirement on the node order.\r\n\r\nI tried to debug around [topology.py](https://github.com/onnx/keras-onnx/blob/master/keras2onnx/topology.py#L256). Yet find the root cause. \r\n\r\nTo reproduce\r\nDownload keras model from [here](https://drive.google.com/file/d/1E-9H3NXt2Kuu07RjykCq4oeplxTqLX8u/view?usp=sharing)\r\nDo ONNX conversion\r\nOutput (in txt) is as below\r\n[negative.txt](https://github.com/onnx/keras-onnx/files/4832863/negative.txt)\r\n If you visualize the graph, the nodes are in different order than the nodes in the negative.txt.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/535", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/535/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/535/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/535/events", "html_url": "https://github.com/onnx/keras-onnx/issues/535", "id": 643624159, "node_id": "MDU6SXNzdWU2NDM2MjQxNTk=", "number": 535, "title": "Dev question: Graph transformation at runtime ", "user": {"login": "buddhapuneeth", "id": 3439010, "node_id": "MDQ6VXNlcjM0MzkwMTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/3439010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/buddhapuneeth", "html_url": "https://github.com/buddhapuneeth", "followers_url": "https://api.github.com/users/buddhapuneeth/followers", "following_url": "https://api.github.com/users/buddhapuneeth/following{/other_user}", "gists_url": "https://api.github.com/users/buddhapuneeth/gists{/gist_id}", "starred_url": "https://api.github.com/users/buddhapuneeth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/buddhapuneeth/subscriptions", "organizations_url": "https://api.github.com/users/buddhapuneeth/orgs", "repos_url": "https://api.github.com/users/buddhapuneeth/repos", "events_url": "https://api.github.com/users/buddhapuneeth/events{/privacy}", "received_events_url": "https://api.github.com/users/buddhapuneeth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-23T08:06:02Z", "updated_at": "2020-06-23T18:52:26Z", "closed_at": "2020-06-23T18:52:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "This is not a bug, this is a dev question:\r\nSay, I added a new operator OpA (tf operator) in __builtin.py like\r\n```\r\n#opA is not an ONNX operator, \r\n@converter_func(TYPES.OpA)\r\ndef convert_tf_opA(scope, operator, container):\r\n    # do manipulation on node inputs and finally calling standard ONNX operator like identity \r\n    oopb.apply_op_with_output('apply_identity', [ip], operator.outputs, name=node.name + '_Identity')\r\n```\r\n\r\nNow adding another new operator, opB (tf operator):\r\n```\r\n#opB is not an ONNX operator, \r\n@converter_func(TYPES.OpB)\r\ndef convert_tf_opB(scope, operator, container):\r\n    # do manipulation on node inputs and finally calling opA which is created above\r\n    container.add_node('OpA', opA_input,  operator.outputs, name=_name('opB'))\r\n```\r\n\r\nFor an input graph with OpB, I am expecting it to have an 'Identity' operator in final ONNX graph (after graph transformation like: opB to opA to Identity)\r\n\r\nBut currently instead I'm getting opA in the final ONNX graph, as opA is also an TF operator, I am not able to run on ONNXRuntime. Instead I want to have 'identity' here.\r\nIs there a way to achieve this?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/531", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/531/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/531/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/531/events", "html_url": "https://github.com/onnx/keras-onnx/issues/531", "id": 642817207, "node_id": "MDU6SXNzdWU2NDI4MTcyMDc=", "number": 531, "title": "When converted on macOS, it exits with `libprotobuf ERROR`.", "user": {"login": "yuto51942", "id": 24271196, "node_id": "MDQ6VXNlcjI0MjcxMTk2", "avatar_url": "https://avatars3.githubusercontent.com/u/24271196?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yuto51942", "html_url": "https://github.com/yuto51942", "followers_url": "https://api.github.com/users/yuto51942/followers", "following_url": "https://api.github.com/users/yuto51942/following{/other_user}", "gists_url": "https://api.github.com/users/yuto51942/gists{/gist_id}", "starred_url": "https://api.github.com/users/yuto51942/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yuto51942/subscriptions", "organizations_url": "https://api.github.com/users/yuto51942/orgs", "repos_url": "https://api.github.com/users/yuto51942/repos", "events_url": "https://api.github.com/users/yuto51942/events{/privacy}", "received_events_url": "https://api.github.com/users/yuto51942/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-06-22T07:09:48Z", "updated_at": "2020-08-21T06:06:34Z", "closed_at": "2020-08-21T06:06:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello.\r\n\r\nI am trying to convert an h5 file to onnx on MacOS. But every time I get a libprotobuf ERROR and I can't convert it.\r\nIs there a solution to this error?\r\n\r\nWhen I ran it on Ubuntu 18.04, it worked fine and I was able to convert it.\r\n\r\n## environment\r\n\r\n- OS: MacOS Catalina version:10.15.5\r\n- Python==3.6.10\r\n- Tensorflow==2.1.0\r\n- keras2onnx == 1.7.0 (from github)\r\n- onnxconverter-common==1.7.0 (from github)\r\n\r\n## scripts and log\r\n\r\nmodel:\r\n\r\n```python\r\nimport tensorflow as tf\r\n\r\n\r\ndef main():\r\n    model = tf.keras.applications.MobileNetV2()\r\n    model.save('model.h5')\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n```\r\n\r\nconvert:\r\n\r\n```python\r\nimport os\r\n\r\nimport keras2onnx\r\nimport tensorflow as tf\r\n\r\n\r\ndef convert():\r\n    keras_model_path = os.path.join('original_model', 'model.h5')\r\n    onnx_model_path = os.path.join('onnx_model', 'model.onnx')\r\n\r\n    model = tf.keras.models.load_model(keras_model_path)\r\n    onnx_model = keras2onnx.convert_keras(model)\r\n    keras2onnx.save_model(onnx_model, onnx_model_path)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    convert()\r\n```\r\n\r\nexecution Log:\r\n\r\n```bash\r\n$ python convert.py\r\n\r\n[libprotobuf ERROR google/protobuf/descriptor_database.cc:394] Invalid file descriptor data passed to EncodedDescriptorDatabase::Add().\r\n[libprotobuf FATAL google/protobuf/descriptor.cc:1356] CHECK failed: GeneratedDatabase()->Add(encoded_file_descriptor, size):\r\nlibc++abi.dylib: terminating with uncaught exception of type google::protobuf::FatalException: CHECK failed: GeneratedDatabase()->Add(encoded_file_descriptor, size):\r\n[1]    95132 abort      python convert.py\r\n```\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/529", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/529/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/529/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/529/events", "html_url": "https://github.com/onnx/keras-onnx/issues/529", "id": 642128413, "node_id": "MDU6SXNzdWU2NDIxMjg0MTM=", "number": 529, "title": "tf.keras.layers.Softmax does not work with axis other than -1", "user": {"login": "dd1923", "id": 22530039, "node_id": "MDQ6VXNlcjIyNTMwMDM5", "avatar_url": "https://avatars0.githubusercontent.com/u/22530039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dd1923", "html_url": "https://github.com/dd1923", "followers_url": "https://api.github.com/users/dd1923/followers", "following_url": "https://api.github.com/users/dd1923/following{/other_user}", "gists_url": "https://api.github.com/users/dd1923/gists{/gist_id}", "starred_url": "https://api.github.com/users/dd1923/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dd1923/subscriptions", "organizations_url": "https://api.github.com/users/dd1923/orgs", "repos_url": "https://api.github.com/users/dd1923/repos", "events_url": "https://api.github.com/users/dd1923/events{/privacy}", "received_events_url": "https://api.github.com/users/dd1923/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-06-19T17:35:29Z", "updated_at": "2020-06-22T19:22:51Z", "closed_at": "2020-06-22T19:22:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "TF 2.2 Keras models having a softmax layer of type tf.keras.layers.Softmax with axis set to anything but -1 fails to produce the correct and comparable results when keras2onnx is used to convert the model to onnx.\r\n\r\nResulting onnx model reports softmax on basically a flatten version of the array instead of doing it specifically along an axis. Note that the axis does get set correctly in the onnx model, however, TF calculates softmax a bit differently than onnx does at the core and hence it results in difference in the output.\r\n\r\nTF has two softmax :\r\ntf.keras.layers.Softmax and tf.nn.softmax.\r\n\r\nThis issue only happens when models use the keras version (which is expected in a majority of keras models) with an axis other than -1. \r\n\r\nBoth of the above softmax implementations in TF calls _softmax helper function defined here:\r\n[https://github.com/tensorflow/tensorflow/blob/2b96f3662bd776e277f86997659e61046b56c315/tensorflow/python/ops/nn_ops.py#L2968](https://github.com/tensorflow/tensorflow/blob/2b96f3662bd776e277f86997659e61046b56c315/tensorflow/python/ops/nn_ops.py#L2968)\r\n\r\nNotice that is it swapping the axis internally before and after  the softmax. \r\n\r\nProblem does not happen with tf.nn.softmax may be because it is a softmax op in tf namespace and it correctly inserts the transpose ops before and after the softmax (even when keras2onnx is used). I think the reason problem happens in tf.keras.layers.Softmax is because keras2onnx is simply parsing the keras graph, not checking under the hood that the softmax requires additional transpose ops inserted to work correctly.\r\n\r\nThe above hypothesis also means that it would have worked had it have parsed the full TF graph. I checked it using tf2onnx instead of keras2onnx and it does indeed work. So the bug is in the keras2onnx parser.\r\n\r\nFull repro colab link:\r\n\r\n[https://colab.research.google.com/drive/11MNXGqnWEaEDWjkhFh9udUDFOqv4pdI4?usp=sharing](https://colab.research.google.com/drive/11MNXGqnWEaEDWjkhFh9udUDFOqv4pdI4?usp=sharing)\r\n\r\nThe tests are also not covering the tf.keras.layers.Softmax case [https://github.com/onnx/keras-onnx/blob/810cc948fb9c3b0a04345bc556678c03a9b19559/tests/test_layers.py#L621](https://github.com/onnx/keras-onnx/blob/810cc948fb9c3b0a04345bc556678c03a9b19559/tests/test_layers.py#L621)\r\n\r\nUntil this is fixed, a workaround is to manually insert transpose ops in the onnx graph before and after softmax. Otherwise the output won't make sense.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/526", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/526/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/526/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/526/events", "html_url": "https://github.com/onnx/keras-onnx/issues/526", "id": 640165624, "node_id": "MDU6SXNzdWU2NDAxNjU2MjQ=", "number": 526, "title": "TF 2.2 sequential GRU layer conversion doesn't work", "user": {"login": "vishakg", "id": 30301957, "node_id": "MDQ6VXNlcjMwMzAxOTU3", "avatar_url": "https://avatars1.githubusercontent.com/u/30301957?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vishakg", "html_url": "https://github.com/vishakg", "followers_url": "https://api.github.com/users/vishakg/followers", "following_url": "https://api.github.com/users/vishakg/following{/other_user}", "gists_url": "https://api.github.com/users/vishakg/gists{/gist_id}", "starred_url": "https://api.github.com/users/vishakg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vishakg/subscriptions", "organizations_url": "https://api.github.com/users/vishakg/orgs", "repos_url": "https://api.github.com/users/vishakg/repos", "events_url": "https://api.github.com/users/vishakg/events{/privacy}", "received_events_url": "https://api.github.com/users/vishakg/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-17T06:01:19Z", "updated_at": "2020-06-19T20:53:41Z", "closed_at": "2020-06-19T20:53:25Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a simple example that fails to convert:\r\n\r\n```\r\nmodel = tf.keras.Sequential(name='TestGRU')\r\nmodel.add(tf.keras.layers.GRU(400, reset_after=True))\r\nmodel.add(tf.keras.layers.Dense(257, activation='sigmoid'))\r\n\r\nmodel.build(input_shape=(1, 1, 257))\r\nmodel.compile(optimizer='adam', loss='mse')\r\n\r\nx = np.zeros((32,1,257))\r\ny = np.zeros((32, 1, 257))\r\n\r\nmodel.fit(x,y)\r\n\r\nonnx_model = keras2onnx.convert_keras(model, name=model.name)\r\n\r\n```\r\n\r\nI get this error:\r\n\r\n> Traceback (most recent call last):\r\n>   File \".\\test.py\", line 53, in <module>\r\n>     onnx_model = keras2onnx.convert_keras(model, name=model.name)\r\n>   File \"C:\\Users\\user\\Source\\Repos\\speech\\tensorflow2\\lib\\site-packages\\keras2onnx\\main.py\", line 62, in convert_keras\r\n>     tf_graph = build_layer_output_from_model(model, output_dict, input_names, output_names)\r\n>   File \"C:\\Users\\user\\Source\\Repos\\speech\\tensorflow2\\lib\\site-packages\\keras2onnx\\_parser_tf.py\", line 304, in build_layer_output_from_model\r\n>     graph = model.outputs[0].graph\r\n> TypeError: 'NoneType' object is not subscriptable\r\n\r\n\r\nI even tried with a subclass approach:\r\n```\r\nclass TstGru(tf.keras.models.Model):\r\n    def __init__(self):\r\n        super(TstGru, self).__init__()\r\n        self.gru_2 = tf.keras.layers.GRU(400)\r\n        self.fc_out = tf.keras.layers.Dense(257, activation='sigmoid')\r\n\r\n    def call(self, input):\r\n        out = self.gru_2(input)\r\n        out = self.fc_out(out)\r\n\r\n        return out\r\n\r\nmodel = TstGru()\r\n```\r\n\r\nThis gives a placholder error as follows:\r\n\r\n> ValueError: Cannot find the Placeholder op that is an input to the ReadVariableOp.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/524", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/524/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/524/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/524/events", "html_url": "https://github.com/onnx/keras-onnx/issues/524", "id": 636936247, "node_id": "MDU6SXNzdWU2MzY5MzYyNDc=", "number": 524, "title": "AttributeError: module 'keras2onnx' has no attribute 'convert_keras'", "user": {"login": "wuxiaolianggit", "id": 34123600, "node_id": "MDQ6VXNlcjM0MTIzNjAw", "avatar_url": "https://avatars3.githubusercontent.com/u/34123600?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wuxiaolianggit", "html_url": "https://github.com/wuxiaolianggit", "followers_url": "https://api.github.com/users/wuxiaolianggit/followers", "following_url": "https://api.github.com/users/wuxiaolianggit/following{/other_user}", "gists_url": "https://api.github.com/users/wuxiaolianggit/gists{/gist_id}", "starred_url": "https://api.github.com/users/wuxiaolianggit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wuxiaolianggit/subscriptions", "organizations_url": "https://api.github.com/users/wuxiaolianggit/orgs", "repos_url": "https://api.github.com/users/wuxiaolianggit/repos", "events_url": "https://api.github.com/users/wuxiaolianggit/events{/privacy}", "received_events_url": "https://api.github.com/users/wuxiaolianggit/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-06-11T11:25:22Z", "updated_at": "2020-06-19T17:52:00Z", "closed_at": "2020-06-19T17:52:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "AttributeError: module 'keras2onnx' has no attribute 'convert_keras'\r\nExcuse me, how to solve this problem\uff1f @shinh ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/522", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/522/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/522/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/522/events", "html_url": "https://github.com/onnx/keras-onnx/issues/522", "id": 635851296, "node_id": "MDU6SXNzdWU2MzU4NTEyOTY=", "number": 522, "title": "add_node vs apply_op_with_output", "user": {"login": "buddhapuneeth", "id": 3439010, "node_id": "MDQ6VXNlcjM0MzkwMTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/3439010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/buddhapuneeth", "html_url": "https://github.com/buddhapuneeth", "followers_url": "https://api.github.com/users/buddhapuneeth/followers", "following_url": "https://api.github.com/users/buddhapuneeth/following{/other_user}", "gists_url": "https://api.github.com/users/buddhapuneeth/gists{/gist_id}", "starred_url": "https://api.github.com/users/buddhapuneeth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/buddhapuneeth/subscriptions", "organizations_url": "https://api.github.com/users/buddhapuneeth/orgs", "repos_url": "https://api.github.com/users/buddhapuneeth/repos", "events_url": "https://api.github.com/users/buddhapuneeth/events{/privacy}", "received_events_url": "https://api.github.com/users/buddhapuneeth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-10T01:02:05Z", "updated_at": "2020-06-10T06:21:08Z", "closed_at": "2020-06-10T06:21:08Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "1. I am trying to add a new operator, why shouldn't I just add add_node(..) at the end of the converter_funcs.\r\nFor example in the below code why can't I just use add_node?\r\nhttps://github.com/onnx/keras-onnx/blob/master/keras2onnx/_builtin.py#L314\r\n2. Also, I noticed that when we use apply_op_with_output with operators like 'ReverseSequence' like:\r\noopb.apply_op_with_output('ReverseSequence' ...), it will throw error. So in that case, I need to add additional identity operator at the end. Is there any way I can avoid additional identity operator?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/521", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/521/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/521/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/521/events", "html_url": "https://github.com/onnx/keras-onnx/issues/521", "id": 635693805, "node_id": "MDU6SXNzdWU2MzU2OTM4MDU=", "number": 521, "title": "Tensorflow Keras Conv3D op support", "user": {"login": "capaths", "id": 15043050, "node_id": "MDQ6VXNlcjE1MDQzMDUw", "avatar_url": "https://avatars1.githubusercontent.com/u/15043050?v=4", "gravatar_id": "", "url": "https://api.github.com/users/capaths", "html_url": "https://github.com/capaths", "followers_url": "https://api.github.com/users/capaths/followers", "following_url": "https://api.github.com/users/capaths/following{/other_user}", "gists_url": "https://api.github.com/users/capaths/gists{/gist_id}", "starred_url": "https://api.github.com/users/capaths/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/capaths/subscriptions", "organizations_url": "https://api.github.com/users/capaths/orgs", "repos_url": "https://api.github.com/users/capaths/repos", "events_url": "https://api.github.com/users/capaths/events{/privacy}", "received_events_url": "https://api.github.com/users/capaths/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-06-09T19:14:41Z", "updated_at": "2020-06-26T22:49:53Z", "closed_at": "2020-06-26T22:49:53Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\n\r\nWe've been testing the conversion of a Tensorflow Keras model with a custom layer and some 3D convolution and 3D Average Pooling layers to ONNX using the master branch version of keras2onnx, but the following warnings are shown:\r\n\r\n```\r\nWARN: No corresponding ONNX op matches the tf.op node Umonna_Unit_LST_LSTCam/conv3d_8/Conv3D of type Conv3D\r\n      The generated ONNX model needs run with the custom op supports.\r\nWARN: No corresponding ONNX op matches the tf.op node Umonna_Unit_LST_LSTCam/average_pooling3d_3/AvgPool3D of type AvgPool3D\r\n      The generated ONNX model needs run with the custom op supports.\r\n```\r\n\r\nWill Tensorflow Conv3D and AvgPool3D ops be supported anytime soon? Or maybe, is there any workaround to this problem?\r\n\r\nThanks!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/520", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/520/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/520/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/520/events", "html_url": "https://github.com/onnx/keras-onnx/issues/520", "id": 635521256, "node_id": "MDU6SXNzdWU2MzU1MjEyNTY=", "number": 520, "title": "opset o not supported", "user": {"login": "alvinsat", "id": 15825357, "node_id": "MDQ6VXNlcjE1ODI1MzU3", "avatar_url": "https://avatars1.githubusercontent.com/u/15825357?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alvinsat", "html_url": "https://github.com/alvinsat", "followers_url": "https://api.github.com/users/alvinsat/followers", "following_url": "https://api.github.com/users/alvinsat/following{/other_user}", "gists_url": "https://api.github.com/users/alvinsat/gists{/gist_id}", "starred_url": "https://api.github.com/users/alvinsat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alvinsat/subscriptions", "organizations_url": "https://api.github.com/users/alvinsat/orgs", "repos_url": "https://api.github.com/users/alvinsat/repos", "events_url": "https://api.github.com/users/alvinsat/events{/privacy}", "received_events_url": "https://api.github.com/users/alvinsat/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-09T15:09:23Z", "updated_at": "2020-07-07T00:02:28Z", "closed_at": "2020-07-07T00:02:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello I installed from source tried to convert from keras to onnx. but got error opset 9 is not supported and maximum opset is 7", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/519", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/519/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/519/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/519/events", "html_url": "https://github.com/onnx/keras-onnx/issues/519", "id": 635458303, "node_id": "MDU6SXNzdWU2MzU0NTgzMDM=", "number": 519, "title": "Cannot export keras Sequential model to ONNX format", "user": {"login": "ladodc", "id": 10833738, "node_id": "MDQ6VXNlcjEwODMzNzM4", "avatar_url": "https://avatars0.githubusercontent.com/u/10833738?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ladodc", "html_url": "https://github.com/ladodc", "followers_url": "https://api.github.com/users/ladodc/followers", "following_url": "https://api.github.com/users/ladodc/following{/other_user}", "gists_url": "https://api.github.com/users/ladodc/gists{/gist_id}", "starred_url": "https://api.github.com/users/ladodc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ladodc/subscriptions", "organizations_url": "https://api.github.com/users/ladodc/orgs", "repos_url": "https://api.github.com/users/ladodc/repos", "events_url": "https://api.github.com/users/ladodc/events{/privacy}", "received_events_url": "https://api.github.com/users/ladodc/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-06-09T14:01:49Z", "updated_at": "2020-06-19T17:52:29Z", "closed_at": "2020-06-19T17:52:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hallo, I have a problem with exporting keras model to ONNX format. \r\nI always get following error on this line onnx_model = keras2onnx.convert_keras(nn):\r\n_AttributeError: 'tuple' object has no attribute 'layer'_\r\nMy versions are \r\n_Python: 3.7\r\nkeras: 2.3.1\r\ntensorflow: 2.1.0\r\nonnx: 1.7.0_\r\n\r\n\r\n**Here is my code:**\r\n`\u200bfrom keras import models\r\nfrom keras import layers\r\nimport keras\r\nfrom keras.datasets import mnist\r\n\r\n(train_images, train_labels), (test_images, test_labels) = mnist.load_data()\r\n\r\ntrain_images = train_images.reshape((60000, 28 * 28))\r\n\r\ntrain_images = train_images.astype('float32') / 255\r\n\r\ntest_images = test_images.reshape((10000, 28 * 28))\r\ntest_images = test_images.astype('float32') / 255\r\n\r\nfrom keras.utils import to_categorical\r\n\r\ntrain_labels = to_categorical(train_labels)\r\ntest_labels = to_categorical(test_labels)\r\n\r\nnn = models.Sequential()\r\nnn.add(layers.Dense(512, activation='relu', input_shape=(28 * 28,)))\r\nnn.add(layers.Dense(10, activation='softmax'))\r\n\r\nnn.compile(optimizer='rmsprop',\r\n                loss='categorical_crossentropy',\r\n                metrics=['accuracy'])\r\n\r\nnn.fit(train_images, train_labels, epochs=5, batch_size=128)\r\n\r\nimport keras2onnx\r\n\r\nonnx_model = keras2onnx.convert_keras(nn) ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/518", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/518/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/518/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/518/events", "html_url": "https://github.com/onnx/keras-onnx/issues/518", "id": 635060353, "node_id": "MDU6SXNzdWU2MzUwNjAzNTM=", "number": 518, "title": "ImportError: cannot import name 'apply_relu_6'", "user": {"login": "alexcruz0202", "id": 36650401, "node_id": "MDQ6VXNlcjM2NjUwNDAx", "avatar_url": "https://avatars0.githubusercontent.com/u/36650401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcruz0202", "html_url": "https://github.com/alexcruz0202", "followers_url": "https://api.github.com/users/alexcruz0202/followers", "following_url": "https://api.github.com/users/alexcruz0202/following{/other_user}", "gists_url": "https://api.github.com/users/alexcruz0202/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcruz0202/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcruz0202/subscriptions", "organizations_url": "https://api.github.com/users/alexcruz0202/orgs", "repos_url": "https://api.github.com/users/alexcruz0202/repos", "events_url": "https://api.github.com/users/alexcruz0202/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcruz0202/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-09T02:29:55Z", "updated_at": "2020-06-09T03:31:13Z", "closed_at": "2020-06-09T03:29:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello, developers.\r\nI have installed latest version of keras2onnx and onnxconvert-common.\r\nBoth of them are `1.7.0`.\r\nWhen I import the `keras2onnx` module, the following error occurs.\r\n\r\n`ImportError: cannot import name 'apply_relu_6'`\r\n\r\nThanks for your latest version.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/517", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/517/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/517/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/517/events", "html_url": "https://github.com/onnx/keras-onnx/issues/517", "id": 634077630, "node_id": "MDU6SXNzdWU2MzQwNzc2MzA=", "number": 517, "title": "How to convert keras model with custom layer to onnx model?", "user": {"login": "alexcruz0202", "id": 36650401, "node_id": "MDQ6VXNlcjM2NjUwNDAx", "avatar_url": "https://avatars0.githubusercontent.com/u/36650401?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexcruz0202", "html_url": "https://github.com/alexcruz0202", "followers_url": "https://api.github.com/users/alexcruz0202/followers", "following_url": "https://api.github.com/users/alexcruz0202/following{/other_user}", "gists_url": "https://api.github.com/users/alexcruz0202/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexcruz0202/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexcruz0202/subscriptions", "organizations_url": "https://api.github.com/users/alexcruz0202/orgs", "repos_url": "https://api.github.com/users/alexcruz0202/repos", "events_url": "https://api.github.com/users/alexcruz0202/events{/privacy}", "received_events_url": "https://api.github.com/users/alexcruz0202/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-06-08T03:45:33Z", "updated_at": "2020-06-26T00:35:39Z", "closed_at": "2020-06-08T15:02:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello, \r\nIs is possible to convert follow keras model to onnx model with this tool?\r\nThe model has customized layer with \"disparity\" layer named.\r\nhttps://github.com/yasar-rehman/SLNET/blob/master/SLNET_A_GAP_app_disp.py\r\n\r\nWhile I have model conversion, met the errors.\r\nAny clue may be help.\r\n\r\nThanks for developer teams.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/516", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/516/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/516/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/516/events", "html_url": "https://github.com/onnx/keras-onnx/issues/516", "id": 633076102, "node_id": "MDU6SXNzdWU2MzMwNzYxMDI=", "number": 516, "title": "No corresponding ONNX op matches type FloorMod,MaxPool,FloorMod", "user": {"login": "livecle", "id": 34791099, "node_id": "MDQ6VXNlcjM0NzkxMDk5", "avatar_url": "https://avatars3.githubusercontent.com/u/34791099?v=4", "gravatar_id": "", "url": "https://api.github.com/users/livecle", "html_url": "https://github.com/livecle", "followers_url": "https://api.github.com/users/livecle/followers", "following_url": "https://api.github.com/users/livecle/following{/other_user}", "gists_url": "https://api.github.com/users/livecle/gists{/gist_id}", "starred_url": "https://api.github.com/users/livecle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/livecle/subscriptions", "organizations_url": "https://api.github.com/users/livecle/orgs", "repos_url": "https://api.github.com/users/livecle/repos", "events_url": "https://api.github.com/users/livecle/events{/privacy}", "received_events_url": "https://api.github.com/users/livecle/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-07T05:47:23Z", "updated_at": "2020-06-28T08:37:30Z", "closed_at": "2020-06-28T08:37:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "When I use keras-onnx to convert centernet(Keras Implementation <a href=\"https://github.com/xuannianz/keras-CenterNet\">keras-CenterNet</a>)\r\n\r\nthe console outputs some warnings:\r\n\r\n```\r\ntf executing eager_mode: True\r\ntf.keras model eager_mode: False\r\nWARN: No corresponding ONNX op matches the tf.op node lambda/mod_1 of type FloorMod\r\n      The generated ONNX model needs run with the custom op supports.\r\nWARN: No corresponding ONNX op matches the tf.op node lambda/MaxPool2d of type MaxPool\r\n      The generated ONNX model needs run with the custom op supports.\r\nWARN: No corresponding ONNX op matches the tf.op node lambda/mod of type FloorMod\r\n      The generated ONNX model needs run with the custom op supports.\r\nThe ONNX operator number change on the optimization: 584 -> 189\r\n```\r\n\r\nCould someone give me some hints? How to fix these warnings\uff1f\r\n\r\nThanks\uff01", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/515", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/515/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/515/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/515/events", "html_url": "https://github.com/onnx/keras-onnx/issues/515", "id": 631218633, "node_id": "MDU6SXNzdWU2MzEyMTg2MzM=", "number": 515, "title": "Missing 'Constant' value of TF opLayer while conversion", "user": {"login": "buddhapuneeth", "id": 3439010, "node_id": "MDQ6VXNlcjM0MzkwMTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/3439010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/buddhapuneeth", "html_url": "https://github.com/buddhapuneeth", "followers_url": "https://api.github.com/users/buddhapuneeth/followers", "following_url": "https://api.github.com/users/buddhapuneeth/following{/other_user}", "gists_url": "https://api.github.com/users/buddhapuneeth/gists{/gist_id}", "starred_url": "https://api.github.com/users/buddhapuneeth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/buddhapuneeth/subscriptions", "organizations_url": "https://api.github.com/users/buddhapuneeth/orgs", "repos_url": "https://api.github.com/users/buddhapuneeth/repos", "events_url": "https://api.github.com/users/buddhapuneeth/events{/privacy}", "received_events_url": "https://api.github.com/users/buddhapuneeth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-06-04T23:59:31Z", "updated_at": "2020-06-05T00:10:23Z", "closed_at": "2020-06-05T00:10:23Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I am trying to add 'ReverseV2' operator support in keras-onnx.\r\nTF ReverseV2 operator takes axes list as one of the input.\r\nThis list is missing from the 'operator.raw_operator' in __buildin.py where I am adding the new operator. \r\nIn the below example I am passing [2] as axes list and in keras-onnx I am able to find a way to read that value.\r\n\r\nMy model:\r\n```\r\nimport tensorflow as tf\r\nfrom tensorflow.keras.models import save_model\r\ninput = tf.keras.Input(shape=(3, 4), name='input')\r\ns = tf.reverse(input,[2]) #here [1] is the access\r\nmodel = tf.keras.models.Model(inputs=input, outputs=s)\r\nsave_model(model, \"reverse.h5\")\r\n```\r\nTo debug:\r\nJust add new Type ReverseV2 and add below dummy method in __buildin.py\r\n```\r\n@converter_func(TYPES.ReverseV2)\r\ndef convert_tf_reverse(scope, operator, container):\r\n     print(\"test\") #add debug breakpoint here\r\n\r\n```\r\nVisualization:\r\n<img width=\"825\" alt=\"Screen Shot 2020-06-04 at 4 47 22 PM\" src=\"https://user-images.githubusercontent.com/3439010/83821813-3dbe5880-a684-11ea-839b-2c89ec2ab23f.png\">\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/511", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/511/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/511/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/511/events", "html_url": "https://github.com/onnx/keras-onnx/issues/511", "id": 629227636, "node_id": "MDU6SXNzdWU2MjkyMjc2MzY=", "number": 511, "title": "convert softmax", "user": {"login": "ShiraLightricks", "id": 61493608, "node_id": "MDQ6VXNlcjYxNDkzNjA4", "avatar_url": "https://avatars1.githubusercontent.com/u/61493608?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShiraLightricks", "html_url": "https://github.com/ShiraLightricks", "followers_url": "https://api.github.com/users/ShiraLightricks/followers", "following_url": "https://api.github.com/users/ShiraLightricks/following{/other_user}", "gists_url": "https://api.github.com/users/ShiraLightricks/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShiraLightricks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShiraLightricks/subscriptions", "organizations_url": "https://api.github.com/users/ShiraLightricks/orgs", "repos_url": "https://api.github.com/users/ShiraLightricks/repos", "events_url": "https://api.github.com/users/ShiraLightricks/events{/privacy}", "received_events_url": "https://api.github.com/users/ShiraLightricks/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-06-02T13:57:45Z", "updated_at": "2020-06-04T02:26:31Z", "closed_at": "2020-06-04T02:26:31Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\nI have a problem with the softmax activation layer, it seems the code is supposed to handle this case but it gives me the following error:\r\n\r\nUnsupported activation in the layer(<function softmax at 0x1365b6320>)\r\n\r\ndetails:\r\npython=3.7, keras2onnx=1.7, tensorflow=2.2.0, onnx=1.5\r\n\r\nThanks!\r\nShira\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/509", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/509/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/509/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/509/events", "html_url": "https://github.com/onnx/keras-onnx/issues/509", "id": 628548376, "node_id": "MDU6SXNzdWU2Mjg1NDgzNzY=", "number": 509, "title": "channel_first_inputs does not work with LSTM", "user": {"login": "AlexRibard", "id": 12990800, "node_id": "MDQ6VXNlcjEyOTkwODAw", "avatar_url": "https://avatars0.githubusercontent.com/u/12990800?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AlexRibard", "html_url": "https://github.com/AlexRibard", "followers_url": "https://api.github.com/users/AlexRibard/followers", "following_url": "https://api.github.com/users/AlexRibard/following{/other_user}", "gists_url": "https://api.github.com/users/AlexRibard/gists{/gist_id}", "starred_url": "https://api.github.com/users/AlexRibard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AlexRibard/subscriptions", "organizations_url": "https://api.github.com/users/AlexRibard/orgs", "repos_url": "https://api.github.com/users/AlexRibard/repos", "events_url": "https://api.github.com/users/AlexRibard/events{/privacy}", "received_events_url": "https://api.github.com/users/AlexRibard/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-06-01T15:56:21Z", "updated_at": "2020-06-30T21:20:07Z", "closed_at": "2020-06-19T17:52:11Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\nI am trying to convert the following .h5 model to .onnx.\r\nHowever when trying to convert to onnx, even when using channel_first_inputs, keras2onnx adds a `Transpose` in front of the `LSTM` layer.\r\nIt would seem that channel_first_inputs doesn't work with the LSTM layer...\r\n\r\nThanks!\r\n\r\nModel:\r\n[lstm_model.zip](https://github.com/onnx/keras-onnx/files/4712183/lstm_model.zip)\r\nRepro code:\r\n```\r\nimport keras2onnx\r\nonnx_model = keras2onnx.convert_keras(model2, name=\"lstm\", target_opset=9, channel_first_inputs='lstm')\r\nkeras2onnx.save_model(onnx_model, 'lstm.onnx')\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/505", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/505/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/505/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/505/events", "html_url": "https://github.com/onnx/keras-onnx/issues/505", "id": 627969792, "node_id": "MDU6SXNzdWU2Mjc5Njk3OTI=", "number": 505, "title": "converting Relu6 ", "user": {"login": "ShiraLightricks", "id": 61493608, "node_id": "MDQ6VXNlcjYxNDkzNjA4", "avatar_url": "https://avatars1.githubusercontent.com/u/61493608?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ShiraLightricks", "html_url": "https://github.com/ShiraLightricks", "followers_url": "https://api.github.com/users/ShiraLightricks/followers", "following_url": "https://api.github.com/users/ShiraLightricks/following{/other_user}", "gists_url": "https://api.github.com/users/ShiraLightricks/gists{/gist_id}", "starred_url": "https://api.github.com/users/ShiraLightricks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ShiraLightricks/subscriptions", "organizations_url": "https://api.github.com/users/ShiraLightricks/orgs", "repos_url": "https://api.github.com/users/ShiraLightricks/repos", "events_url": "https://api.github.com/users/ShiraLightricks/events{/privacy}", "received_events_url": "https://api.github.com/users/ShiraLightricks/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-05-31T14:02:26Z", "updated_at": "2020-06-05T00:12:52Z", "closed_at": "2020-06-05T00:12:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello,\r\nI'm trying to convert my keras model to onnx, using keras2oonx.\r\npython=3.7, keras2onnx=1.7, tensorflow=2.2.0, onnx=1.5\r\n\r\nI get this warning:\r\nWARN: No corresponding ONNX op matches the tf.op node model/up_5_block_3X3.2/Relu6 of type Relu6\r\nThe generated ONNX model needs run with the custom op supports.\r\n\r\nI saw that this issue with the relu6 was resolved in the keras2onnx version 1.6.5 in the file: keras2onnx.ke2onnx.activations,\r\nbut when I run the code I see it doesn't use this function, and I didn't find an explanation on how to use it, or how to implement my own custom convert.\r\nThanks!\r\nShira\r\n ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/502", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/502/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/502/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/502/events", "html_url": "https://github.com/onnx/keras-onnx/issues/502", "id": 626648631, "node_id": "MDU6SXNzdWU2MjY2NDg2MzE=", "number": 502, "title": "optimizing an ONNX model - from tensorflow.keras - error: kernel is undefined", "user": {"login": "tompfeil", "id": 8897935, "node_id": "MDQ6VXNlcjg4OTc5MzU=", "avatar_url": "https://avatars1.githubusercontent.com/u/8897935?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tompfeil", "html_url": "https://github.com/tompfeil", "followers_url": "https://api.github.com/users/tompfeil/followers", "following_url": "https://api.github.com/users/tompfeil/following{/other_user}", "gists_url": "https://api.github.com/users/tompfeil/gists{/gist_id}", "starred_url": "https://api.github.com/users/tompfeil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tompfeil/subscriptions", "organizations_url": "https://api.github.com/users/tompfeil/orgs", "repos_url": "https://api.github.com/users/tompfeil/repos", "events_url": "https://api.github.com/users/tompfeil/events{/privacy}", "received_events_url": "https://api.github.com/users/tompfeil/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-05-28T16:32:20Z", "updated_at": "2020-07-22T15:29:46Z", "closed_at": "2020-06-20T18:34:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "Trying to optimize this simple model:\r\n\r\n```\r\nfrom tensorflow import keras\r\nimport keras2onnx\r\nfrom onnx.shape_inference import infer_shapes\r\nfrom onnx.optimizer import optimize\r\n\r\nmodel = keras.Sequential([\r\n    keras.layers.Conv2D(32, (3, 3), activation='relu', input_shape=(28, 28, 1)),\r\n    keras.layers.GlobalAveragePooling2D(),\r\n    keras.layers.Dense(10)])\r\n\r\nmodel = keras2onnx.convert_keras(model)\r\nmodel = infer_shapes(model)\r\nmodel = optimize(model)\r\n```\r\n\r\nresults in the following error:\r\n\r\n```\r\nFile \".../lib/python3.7/site-packages/onnx/optimizer.py\", line 55, in optimize\r\n    optimized_model_str = C.optimize(model_str, passes)\r\nIndexError: Input conv2d/kernel:0 is undefined!\r\n```\r\n\r\nI am using tensorflow=2.1.0, onnx=1.7.0, and keras2onnx=1.6.1.\r\n\r\nAny ideas how to fix this issue?\r\n\r\nI also posted this on stackoverflow: https://stackoverflow.com/questions/62069791/optimizing-an-onnx-model-from-tensorflow-keras-error-kernel-is-undefined\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/494", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/494/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/494/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/494/events", "html_url": "https://github.com/onnx/keras-onnx/issues/494", "id": 620353149, "node_id": "MDU6SXNzdWU2MjAzNTMxNDk=", "number": 494, "title": "error with the example model EfficientNet", "user": {"login": "amamory", "id": 8387109, "node_id": "MDQ6VXNlcjgzODcxMDk=", "avatar_url": "https://avatars1.githubusercontent.com/u/8387109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amamory", "html_url": "https://github.com/amamory", "followers_url": "https://api.github.com/users/amamory/followers", "following_url": "https://api.github.com/users/amamory/following{/other_user}", "gists_url": "https://api.github.com/users/amamory/gists{/gist_id}", "starred_url": "https://api.github.com/users/amamory/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amamory/subscriptions", "organizations_url": "https://api.github.com/users/amamory/orgs", "repos_url": "https://api.github.com/users/amamory/repos", "events_url": "https://api.github.com/users/amamory/events{/privacy}", "received_events_url": "https://api.github.com/users/amamory/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 11, "created_at": "2020-05-18T16:41:05Z", "updated_at": "2020-07-02T02:38:15Z", "closed_at": "2020-05-29T14:51:57Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I was trying the [tutorial notebook](https://github.com/onnx/keras-onnx/blob/master/tutorial/TensorFlow_Keras_EfficientNet.ipynb) and I did small modifications. See my [notebook here](https://colab.research.google.com/drive/16C8l1Y_S5dE4BHmlmg_cFmZFoQMAu6n5?usp=sharing). \r\n\r\n1) after the existing model hdf5 file is loaded, and saved the model again with a different name\r\n\r\n```\r\nmodel.save('./efficient-net.h5')\r\n```\r\n\r\nand run it until the end. No errors as expected. \r\n\r\n2) then in the second run I replaced the original load model command by keras' load model\r\n\r\n```\r\n#model = efn.EfficientNetB0(weights='imagenet')\r\nmodel = load_model(\"/content/drive/My Drive/Colab Notebooks/models/efficient-net.h5\")\r\n```\r\n\r\nThen, while converting to onnx, it issued this error:\r\n\r\n```\r\nAssertionError                            Traceback (most recent call last)\r\n\r\n<ipython-input-17-f65dad0d3c63> in <module>()\r\n      1 import keras2onnx\r\n      2 output_model_path = \"keras_efficientNet.onnx\"\r\n----> 3 onnx_model = keras2onnx.convert_keras(model, model.name)\r\n      4 keras2onnx.save_model(onnx_model, output_model_path)\r\n\r\n2 frames\r\n\r\n/usr/local/lib/python3.6/dist-packages/keras2onnx/topology.py in _remove_unused_nodes(nodes, inputs, outputs)\r\n    229             else:\r\n    230                 assert in_ == '' or in_ in input_dict, \\\r\n--> 231                     \"{} is disconnected, check the parsing log for more details.\".format(in_)\r\n    232 \r\n    233     return [nd_ for nd_ in nodes if id(nd_) in nodes_to_keep]\r\n\r\nAssertionError: input_1:01 is disconnected, check the parsing log for more details.\r\n```\r\n\r\nversion info:\r\n- python 3.6.9\r\n- TensorFlow version is 2.2.0\r\n- keras2onnx version is 1.7.0\r\n\r\nIt seems that keras2onnx has issues to load hdf5 saved by tf.keras, or at least for this specific. version\r\n\r\nany thought ?\r\n\r\nAlexandre\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/493", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/493/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/493/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/493/events", "html_url": "https://github.com/onnx/keras-onnx/issues/493", "id": 619814718, "node_id": "MDU6SXNzdWU2MTk4MTQ3MTg=", "number": 493, "title": "error converting a small 'hand-made' MLP for MNIST ", "user": {"login": "amamory", "id": 8387109, "node_id": "MDQ6VXNlcjgzODcxMDk=", "avatar_url": "https://avatars1.githubusercontent.com/u/8387109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amamory", "html_url": "https://github.com/amamory", "followers_url": "https://api.github.com/users/amamory/followers", "following_url": "https://api.github.com/users/amamory/following{/other_user}", "gists_url": "https://api.github.com/users/amamory/gists{/gist_id}", "starred_url": "https://api.github.com/users/amamory/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amamory/subscriptions", "organizations_url": "https://api.github.com/users/amamory/orgs", "repos_url": "https://api.github.com/users/amamory/repos", "events_url": "https://api.github.com/users/amamory/events{/privacy}", "received_events_url": "https://api.github.com/users/amamory/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-05-17T22:50:43Z", "updated_at": "2020-07-12T12:18:08Z", "closed_at": "2020-06-08T18:48:25Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "\r\nHi, \r\n\r\nI am using:\r\n- Google Colab\r\n- Python 3.6.9\r\n- TensorFlow version is 2.2.0\r\n- keras2onnx version is 1.7.0\r\n\r\nI am trying to convert a very small 'hand-made' network, as described in this code:\r\n\r\n\r\n```python\r\nimport sys\r\nprint (sys.version)\r\n\r\n\r\n#3.6.9 (default, Apr 18 2020, 01:56:04) \r\n\r\nimport os\r\n# keras2onnx required this enrivonment variable to be set when using tf.keras instead of keras\r\n# this must be set before importing onnx\r\nos.environ['TF_KERAS'] = '1'\r\n\r\n!pip install -U git+https://github.com/microsoft/onnxconverter-common\r\n!pip install -U git+https://github.com/onnx/keras-onnx\r\n\r\nimport tensorflow as tf\r\nprint(\"TensorFlow version is \"+tf.__version__)\r\n\r\nimport matplotlib.pyplot as plt\r\nimport numpy as np\r\n\r\nimport onnx\r\nimport keras2onnx\r\n\r\nprint(\"keras2onnx version is \"+keras2onnx.__version__)\r\n\r\n#TensorFlow version is 2.2.0\r\n#keras2onnx version is 1.7.0\r\n\r\n# Get MNIST dataset\r\nmnist = tf.keras.datasets.mnist\r\n# Load its data into training and test vectors\r\n(x_train, y_train),(x_test, y_test) = mnist.load_data()\r\n# Normalize the data\r\nx_train, x_test = x_train / 255.0, x_test / 255.0\r\n# Collect feature size info\r\nimgSize0=len(x_train[0])\r\nimgSize1=len(x_train[0][0])\r\nnumPixels=imgSize0*imgSize1\r\nnumTrainImages=len(x_train)\r\nfeatureShape=(1,imgSize0,imgSize1)\r\n\r\nprint(\"Training dataset has \"+str(numTrainImages))\r\nprint(\"Testing dataset has \"+str(len(x_test)))\r\nprint(\"Feature shape is \"+str(featureShape))\r\n\r\n# select True if it must create a new model, False if it must load it from the h5 file\r\ncreate_model = True\r\n# Clearup everything before running\r\ntf.keras.backend.clear_session()\r\nif create_model:\r\n  print ('creating a new model')\r\n  # Clearup everything before running\r\n  tf.keras.backend.clear_session()\r\n  # Create model\r\n  model = tf.keras.models.Sequential()\r\n  # Add layers\r\n  model.add(tf.keras.layers.Flatten())\r\n  model.add(tf.keras.layers.Dense(8, activation='relu'))\r\n  model.add(tf.keras.layers.Dense(10, activation='softmax'))\r\nelse:\r\n  # load a complete model\r\n  print ('loading an existing model')\r\n  model = tf.keras.models.load_model(\"./mnist-model.h5\")\r\n\r\n# Build model and print summary\r\nmodel.build(input_shape=featureShape)\r\nmodel.summary()\r\n\r\n#creating a new model\r\n#Model: \"sequential\"\r\n#_________________________________________________________________\r\n#Layer (type)                 Output Shape              Param #   \r\n#=================================================================\r\n#flatten (Flatten)            multiple                  0         \r\n#_________________________________________________________________\r\n#dense (Dense)                multiple                  6280      \r\n#_________________________________________________________________\r\n#dense_1 (Dense)              multiple                  90        \r\n#=================================================================\r\n#Total params: 6,370\r\n#Trainable params: 6,370\r\n#Non-trainable params: 0\r\n\r\n# convert to onnx model\r\nonnx_model = keras2onnx.convert_keras(model, 'mnist-onnx', debug_mode=1)\r\n```\r\n\r\nThe error is :\r\n\r\n```\r\n/usr/local/lib/python3.6/dist-packages/keras2onnx/_parser_tf.py in build_layer_output_from_model(model, output_dict, input_names, output_names)\r\n    302         return extract_outputs_from_subclassing_model(model, output_dict, input_names, output_names)\r\n    303     else:\r\n--> 304         graph = model.outputs[0].graph\r\n    305         output_names.extend([n.name for n in model.outputs])\r\n    306         output_dict.update(extract_outputs_from_inbound_nodes(model))\r\n\r\nTypeError: 'NoneType' object is not subscriptable\r\n```\r\n\r\nMy example was supposed to be similar to this test https://github.com/onnx/keras-onnx/blob/master/tests/test_tf2_keras.py\r\n\r\n\r\nCould someone provide me a clue ? is it a know limitation ? a bug ? a bug from my part ?\r\n\r\n\r\nThanks in advance!\r\nAlexandre \r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/489", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/489/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/489/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/489/events", "html_url": "https://github.com/onnx/keras-onnx/issues/489", "id": 618409478, "node_id": "MDU6SXNzdWU2MTg0MDk0Nzg=", "number": 489, "title": "LSTM seq length cast node is causing error while removing unused nodes", "user": {"login": "buddhapuneeth", "id": 3439010, "node_id": "MDQ6VXNlcjM0MzkwMTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/3439010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/buddhapuneeth", "html_url": "https://github.com/buddhapuneeth", "followers_url": "https://api.github.com/users/buddhapuneeth/followers", "following_url": "https://api.github.com/users/buddhapuneeth/following{/other_user}", "gists_url": "https://api.github.com/users/buddhapuneeth/gists{/gist_id}", "starred_url": "https://api.github.com/users/buddhapuneeth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/buddhapuneeth/subscriptions", "organizations_url": "https://api.github.com/users/buddhapuneeth/orgs", "repos_url": "https://api.github.com/users/buddhapuneeth/repos", "events_url": "https://api.github.com/users/buddhapuneeth/events{/privacy}", "received_events_url": "https://api.github.com/users/buddhapuneeth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-05-14T17:25:18Z", "updated_at": "2020-05-15T00:51:45Z", "closed_at": "2020-05-15T00:51:45Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "_remove_unused_nodes() is failing for my model. Unfortunately, I can't share you the model. \r\n\r\n```\r\nassert in_ == '' or in_ in input_dict\r\n```\r\n(https://github.com/onnx/keras-onnx/blob/master/keras2onnx/topology.py#L230)\r\n\r\nAbove check is failing me. My values are:\r\n\r\n```\r\n>in_\r\n'masking_1/Any_1:0'\r\n>in_ in input_dict\r\nFalse\r\n```\r\nThis check was part of the recent change #466 \r\n\r\n![Screen Shot 2020-05-14 at 10 16 59 AM](https://user-images.githubusercontent.com/3439010/81965015-4ca57400-95cc-11ea-94bb-879dcefa1006.png)\r\n\r\nyou can see the 'masking_1/Any_1:0' was input of 'cast' node which was build at:\r\nhttps://github.com/onnx/keras-onnx/blob/master/keras2onnx/ke2onnx/lstm.py#L291\r\nhttps://github.com/onnx/keras-onnx/blob/a75bfa5023bf43d1259aafff7562e431e5c88614/keras2onnx/ke2onnx/simplernn.py#L150\r\n\r\nI am assuming 'masking_1/Any_1:0' to be part of 'input_dict' in _remove_unused_nodes() but is not the case. \r\n\r\nShouldn't we add cast input here into container.add_initializer()?\r\nEnv: Keras 2.3.1, keras-onnx master (as of May12th 2020), Py 36 ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/487", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/487/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/487/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/487/events", "html_url": "https://github.com/onnx/keras-onnx/issues/487", "id": 617095844, "node_id": "MDU6SXNzdWU2MTcwOTU4NDQ=", "number": 487, "title": "type ArgMax cannot be converted", "user": {"login": "zhucheng725", "id": 38425699, "node_id": "MDQ6VXNlcjM4NDI1Njk5", "avatar_url": "https://avatars2.githubusercontent.com/u/38425699?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zhucheng725", "html_url": "https://github.com/zhucheng725", "followers_url": "https://api.github.com/users/zhucheng725/followers", "following_url": "https://api.github.com/users/zhucheng725/following{/other_user}", "gists_url": "https://api.github.com/users/zhucheng725/gists{/gist_id}", "starred_url": "https://api.github.com/users/zhucheng725/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zhucheng725/subscriptions", "organizations_url": "https://api.github.com/users/zhucheng725/orgs", "repos_url": "https://api.github.com/users/zhucheng725/repos", "events_url": "https://api.github.com/users/zhucheng725/events{/privacy}", "received_events_url": "https://api.github.com/users/zhucheng725/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "jiafatom", "id": 30608893, "node_id": "MDQ6VXNlcjMwNjA4ODkz", "avatar_url": "https://avatars1.githubusercontent.com/u/30608893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jiafatom", "html_url": "https://github.com/jiafatom", "followers_url": "https://api.github.com/users/jiafatom/followers", "following_url": "https://api.github.com/users/jiafatom/following{/other_user}", "gists_url": "https://api.github.com/users/jiafatom/gists{/gist_id}", "starred_url": "https://api.github.com/users/jiafatom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jiafatom/subscriptions", "organizations_url": "https://api.github.com/users/jiafatom/orgs", "repos_url": "https://api.github.com/users/jiafatom/repos", "events_url": "https://api.github.com/users/jiafatom/events{/privacy}", "received_events_url": "https://api.github.com/users/jiafatom/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "jiafatom", "id": 30608893, "node_id": "MDQ6VXNlcjMwNjA4ODkz", "avatar_url": "https://avatars1.githubusercontent.com/u/30608893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jiafatom", "html_url": "https://github.com/jiafatom", "followers_url": "https://api.github.com/users/jiafatom/followers", "following_url": "https://api.github.com/users/jiafatom/following{/other_user}", "gists_url": "https://api.github.com/users/jiafatom/gists{/gist_id}", "starred_url": "https://api.github.com/users/jiafatom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jiafatom/subscriptions", "organizations_url": "https://api.github.com/users/jiafatom/orgs", "repos_url": "https://api.github.com/users/jiafatom/repos", "events_url": "https://api.github.com/users/jiafatom/events{/privacy}", "received_events_url": "https://api.github.com/users/jiafatom/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 2, "created_at": "2020-05-13T02:41:29Z", "updated_at": "2020-05-14T07:32:52Z", "closed_at": "2020-05-14T07:32:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi , I meet a problem that my network has  an ArgMax operation what code is \r\n```\r\nx = keras.layers.Lambda(lambda x : tf.argmax(x, axis = 3,output_type=tf.float32))(x)\r\n```\r\nand \r\nmeet this problem:\r\n```\r\nnode lambda_1/ArgMax of type ArgMax cannot be converted, fall back to tf2onnx\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/zhu/keras-onnx-1.6.5/keras2onnx/main.py\", line 60, in convert_keras\r\n    parse_graph(topology, tf_graph, target_opset, output_names, output_dict)\r\n  File \"/home/zhu/keras-onnx-1.6.5/keras2onnx/parser.py\", line 794, in parse_graph\r\n    graph, keras_node_dict, topo, top_level, output_names)\r\n  File \"/home/zhu/keras-onnx-1.6.5/keras2onnx/parser.py\", line 595, in _parse_graph_core\r\n    _on_parsing_tf_subgraph(graph, nodes, varset)\r\n  File \"/home/zhu/keras-onnx-1.6.5/keras2onnx/parser.py\", line 335, in _on_parsing_tf_subgraph\r\n    raise RuntimeError(\"Some tensorflow operation doesn't support, stop converting.\")\r\nRuntimeError: Some tensorflow operation doesn't support, stop converting.\r\n```\r\nHow to solve this problem.\r\nMy keras is 2.1.5 keras-onnx-1.6.5 onnxruntime-1.7.0 tensorflow-1.14.0", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/485", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/485/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/485/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/485/events", "html_url": "https://github.com/onnx/keras-onnx/issues/485", "id": 616864834, "node_id": "MDU6SXNzdWU2MTY4NjQ4MzQ=", "number": 485, "title": "Any plans to release 1.7.0 soon?", "user": {"login": "anmour90", "id": 39926350, "node_id": "MDQ6VXNlcjM5OTI2MzUw", "avatar_url": "https://avatars0.githubusercontent.com/u/39926350?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anmour90", "html_url": "https://github.com/anmour90", "followers_url": "https://api.github.com/users/anmour90/followers", "following_url": "https://api.github.com/users/anmour90/following{/other_user}", "gists_url": "https://api.github.com/users/anmour90/gists{/gist_id}", "starred_url": "https://api.github.com/users/anmour90/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anmour90/subscriptions", "organizations_url": "https://api.github.com/users/anmour90/orgs", "repos_url": "https://api.github.com/users/anmour90/repos", "events_url": "https://api.github.com/users/anmour90/events{/privacy}", "received_events_url": "https://api.github.com/users/anmour90/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-05-12T18:24:36Z", "updated_at": "2020-06-08T17:37:28Z", "closed_at": "2020-06-08T17:37:28Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi guys, I need `keras2onnx` desperately to convert `tf2.keras` for my project. The latest tag `1.6.5` won't work for the model I am using and I have to install from the latest master, which is `1.7.0`, but it is not available in the tags. Just wondering when do you guys plan to release `1.7.0`? Thank you!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/483", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/483/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/483/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/483/events", "html_url": "https://github.com/onnx/keras-onnx/issues/483", "id": 615038396, "node_id": "MDU6SXNzdWU2MTUwMzgzOTY=", "number": 483, "title": "Actual: (N11onnxruntime17PrimitiveDataTypeIdEE) , expected: (N11onnxruntime17PrimitiveDataTypeIfEE)", "user": {"login": "Debottam", "id": 34949953, "node_id": "MDQ6VXNlcjM0OTQ5OTUz", "avatar_url": "https://avatars3.githubusercontent.com/u/34949953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Debottam", "html_url": "https://github.com/Debottam", "followers_url": "https://api.github.com/users/Debottam/followers", "following_url": "https://api.github.com/users/Debottam/following{/other_user}", "gists_url": "https://api.github.com/users/Debottam/gists{/gist_id}", "starred_url": "https://api.github.com/users/Debottam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Debottam/subscriptions", "organizations_url": "https://api.github.com/users/Debottam/orgs", "repos_url": "https://api.github.com/users/Debottam/repos", "events_url": "https://api.github.com/users/Debottam/events{/privacy}", "received_events_url": "https://api.github.com/users/Debottam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-08T23:35:48Z", "updated_at": "2020-05-10T19:53:57Z", "closed_at": "2020-05-10T19:53:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "Dear Helper,\r\n\r\nI have a tensorflow model \r\n\r\n```\r\nModel: \"model\"\r\n__________________________________________________________________________________________________\r\nLayer (type)                    Output Shape         Param #     Connected to                     \r\n==================================================================================================\r\nem_barrel_Lr1 (InputLayer)      [(None, 56, 11)]     0                                            \r\n__________________________________________________________________________________________________\r\nem_barrel_Lr0 (InputLayer)      [(None, 7, 11)]      0                                            \r\n__________________________________________________________________________________________________\r\nem_barrel_Lr2 (InputLayer)      [(None, 7, 11)]      0                                            \r\n__________________________________________________________________________________________________\r\nem_barrel_Lr3 (InputLayer)      [(None, 7, 11)]      0                                            \r\n__________________________________________________________________________________________________\r\ntile_barrel_Lr1 (InputLayer)    [(None, 7, 11)]      0                                            \r\n__________________________________________________________________________________________________\r\ntile_barrel_Lr2 (InputLayer)    [(None, 7, 11)]      0                                            \r\n__________________________________________________________________________________________________\r\ntile_barrel_Lr3 (InputLayer)    [(None, 7, 11)]      0                                            \r\n__________________________________________________________________________________________________\r\nreshape_7 (Reshape)             (None, 56, 11, 1)    0           em_barrel_Lr1[0][0]              \r\n__________________________________________________________________________________________________\r\ntracks_image (InputLayer)       [(None, 4, 13)]      0                                            \r\n__________________________________________________________________________________________________\r\nreshape_1 (Reshape)             (None, 7, 11, 1)     0           em_barrel_Lr0[0][0]              \r\n__________________________________________________________________________________________________\r\nreshape_2 (Reshape)             (None, 7, 11, 1)     0           em_barrel_Lr2[0][0]              \r\n__________________________________________________________________________________________________\r\nreshape_3 (Reshape)             (None, 7, 11, 1)     0           em_barrel_Lr3[0][0]              \r\n__________________________________________________________________________________________________\r\nreshape_4 (Reshape)             (None, 7, 11, 1)     0           tile_barrel_Lr1[0][0]            \r\n__________________________________________________________________________________________________\r\nreshape_5 (Reshape)             (None, 7, 11, 1)     0           tile_barrel_Lr2[0][0]            \r\n__________________________________________________________________________________________________\r\nreshape_6 (Reshape)             (None, 7, 11, 1)     0           tile_barrel_Lr3[0][0]            \r\n__________________________________________________________________________________________________\r\nconv2d_4 (Conv2D)               (None, 54, 9, 200)   2000        reshape_7[0][0]                  \r\n__________________________________________________________________________________________________\r\nreshape (Reshape)               (None, 4, 13, 1)     0           tracks_image[0][0]               \r\n__________________________________________________________________________________________________\r\nconcatenate (Concatenate)       (None, 7, 11, 6)     0           reshape_1[0][0]                  \r\n                                                                 reshape_2[0][0]                  \r\n                                                                 reshape_3[0][0]                  \r\n                                                                 reshape_4[0][0]                  \r\n                                                                 reshape_5[0][0]                  \r\n                                                                 reshape_6[0][0]                  \r\n__________________________________________________________________________________________________\r\nleaky_re_lu_4 (LeakyReLU)       (None, 54, 9, 200)   0           conv2d_4[0][0]                   \r\n__________________________________________________________________________________________________\r\nconv2d (Conv2D)                 (None, 4, 13, 200)   400         reshape[0][0]                    \r\n__________________________________________________________________________________________________\r\nconv2d_2 (Conv2D)               (None, 6, 9, 200)    7400        concatenate[0][0]                \r\n__________________________________________________________________________________________________\r\nmax_pooling2d (MaxPooling2D)    (None, 27, 4, 200)   0           leaky_re_lu_4[0][0]              \r\n__________________________________________________________________________________________________\r\nleaky_re_lu (LeakyReLU)         (None, 4, 13, 200)   0           conv2d[0][0]                     \r\n__________________________________________________________________________________________________\r\nleaky_re_lu_2 (LeakyReLU)       (None, 6, 9, 200)    0           conv2d_2[0][0]                   \r\n__________________________________________________________________________________________________\r\ndropout_4 (Dropout)             (None, 27, 4, 200)   0           max_pooling2d[0][0]              \r\n__________________________________________________________________________________________________\r\ndropout (Dropout)               (None, 4, 13, 200)   0           leaky_re_lu[0][0]                \r\n__________________________________________________________________________________________________\r\ndropout_2 (Dropout)             (None, 6, 9, 200)    0           leaky_re_lu_2[0][0]              \r\n__________________________________________________________________________________________________\r\nconv2d_5 (Conv2D)               (None, 25, 2, 200)   360200      dropout_4[0][0]                  \r\n__________________________________________________________________________________________________\r\nconv2d_1 (Conv2D)               (None, 4, 13, 200)   40200       dropout[0][0]                    \r\n__________________________________________________________________________________________________\r\nconv2d_3 (Conv2D)               (None, 5, 7, 200)    240200      dropout_2[0][0]                  \r\n__________________________________________________________________________________________________\r\nleaky_re_lu_5 (LeakyReLU)       (None, 25, 2, 200)   0           conv2d_5[0][0]                   \r\n__________________________________________________________________________________________________\r\nleaky_re_lu_1 (LeakyReLU)       (None, 4, 13, 200)   0           conv2d_1[0][0]                   \r\n__________________________________________________________________________________________________\r\nleaky_re_lu_3 (LeakyReLU)       (None, 5, 7, 200)    0           conv2d_3[0][0]                   \r\n__________________________________________________________________________________________________\r\nmax_pooling2d_1 (MaxPooling2D)  (None, 12, 1, 200)   0           leaky_re_lu_5[0][0]              \r\n__________________________________________________________________________________________________\r\ndropout_1 (Dropout)             (None, 4, 13, 200)   0           leaky_re_lu_1[0][0]              \r\n__________________________________________________________________________________________________\r\ndropout_3 (Dropout)             (None, 5, 7, 200)    0           leaky_re_lu_3[0][0]              \r\n__________________________________________________________________________________________________\r\ndropout_5 (Dropout)             (None, 12, 1, 200)   0           max_pooling2d_1[0][0]            \r\n__________________________________________________________________________________________________\r\np_Eratio (InputLayer)           [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_Reta (InputLayer)             [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_Rhad (InputLayer)             [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_Rphi (InputLayer)             [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_TRTPID (InputLayer)           [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_numberOfSCTHits (InputLayer)  [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_ndof (InputLayer)             [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_dPOverP (InputLayer)          [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_deltaEta1 (InputLayer)        [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_f1 (InputLayer)               [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_f3 (InputLayer)               [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_deltaPhiRescaled2 (InputLayer [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_weta2 (InputLayer)            [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_d0 (InputLayer)               [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_d0Sig (InputLayer)            [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_qd0Sig (InputLayer)           [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_nTracks (InputLayer)          [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\np_sct_weight_charge (InputLayer [(None,)]            0                                            \r\n__________________________________________________________________________________________________\r\nflatten (Flatten)               (None, 10400)        0           dropout_1[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_1 (Flatten)             (None, 7000)         0           dropout_3[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_2 (Flatten)             (None, 2400)         0           dropout_5[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_3 (Flatten)             (None, 1)            0           p_Eratio[0][0]                   \r\n__________________________________________________________________________________________________\r\nflatten_4 (Flatten)             (None, 1)            0           p_Reta[0][0]                     \r\n__________________________________________________________________________________________________\r\nflatten_5 (Flatten)             (None, 1)            0           p_Rhad[0][0]                     \r\n__________________________________________________________________________________________________\r\nflatten_6 (Flatten)             (None, 1)            0           p_Rphi[0][0]                     \r\n__________________________________________________________________________________________________\r\nflatten_7 (Flatten)             (None, 1)            0           p_TRTPID[0][0]                   \r\n__________________________________________________________________________________________________\r\nflatten_8 (Flatten)             (None, 1)            0           p_numberOfSCTHits[0][0]          \r\n__________________________________________________________________________________________________\r\nflatten_9 (Flatten)             (None, 1)            0           p_ndof[0][0]                     \r\n__________________________________________________________________________________________________\r\nflatten_10 (Flatten)            (None, 1)            0           p_dPOverP[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_11 (Flatten)            (None, 1)            0           p_deltaEta1[0][0]                \r\n__________________________________________________________________________________________________\r\nflatten_12 (Flatten)            (None, 1)            0           p_f1[0][0]                       \r\n__________________________________________________________________________________________________\r\nflatten_13 (Flatten)            (None, 1)            0           p_f3[0][0]                       \r\n__________________________________________________________________________________________________\r\nflatten_14 (Flatten)            (None, 1)            0           p_deltaPhiRescaled2[0][0]        \r\n__________________________________________________________________________________________________\r\nflatten_15 (Flatten)            (None, 1)            0           p_weta2[0][0]                    \r\n__________________________________________________________________________________________________\r\nflatten_16 (Flatten)            (None, 1)            0           p_d0[0][0]                       \r\n__________________________________________________________________________________________________\r\nflatten_17 (Flatten)            (None, 1)            0           p_d0Sig[0][0]                    \r\n__________________________________________________________________________________________________\r\nflatten_18 (Flatten)            (None, 1)            0           p_qd0Sig[0][0]                   \r\n__________________________________________________________________________________________________\r\nflatten_19 (Flatten)            (None, 1)            0           p_nTracks[0][0]                  \r\n__________________________________________________________________________________________________\r\nflatten_20 (Flatten)            (None, 1)            0           p_sct_weight_charge[0][0]        \r\n__________________________________________________________________________________________________\r\nconcatenate_1 (Concatenate)     (None, 19818)        0           flatten[0][0]                    \r\n                                                                 flatten_1[0][0]                  \r\n                                                                 flatten_2[0][0]                  \r\n                                                                 flatten_3[0][0]                  \r\n                                                                 flatten_4[0][0]                  \r\n                                                                 flatten_5[0][0]                  \r\n                                                                 flatten_6[0][0]                  \r\n                                                                 flatten_7[0][0]                  \r\n                                                                 flatten_8[0][0]                  \r\n                                                                 flatten_9[0][0]                  \r\n                                                                 flatten_10[0][0]                 \r\n                                                                 flatten_11[0][0]                 \r\n                                                                 flatten_12[0][0]                 \r\n                                                                 flatten_13[0][0]                 \r\n                                                                 flatten_14[0][0]                 \r\n                                                                 flatten_15[0][0]                 \r\n                                                                 flatten_16[0][0]                 \r\n                                                                 flatten_17[0][0]                 \r\n                                                                 flatten_18[0][0]                 \r\n                                                                 flatten_19[0][0]                 \r\n                                                                 flatten_20[0][0]                 \r\n__________________________________________________________________________________________________\r\ndense (Dense)                   (None, 200)          3963800     concatenate_1[0][0]              \r\n__________________________________________________________________________________________________\r\nleaky_re_lu_6 (LeakyReLU)       (None, 200)          0           dense[0][0]                      \r\n__________________________________________________________________________________________________\r\ndropout_6 (Dropout)             (None, 200)          0           leaky_re_lu_6[0][0]              \r\n__________________________________________________________________________________________________\r\ndense_1 (Dense)                 (None, 200)          40200       dropout_6[0][0]                  \r\n__________________________________________________________________________________________________\r\nleaky_re_lu_7 (LeakyReLU)       (None, 200)          0           dense_1[0][0]                    \r\n__________________________________________________________________________________________________\r\ndropout_7 (Dropout)             (None, 200)          0           leaky_re_lu_7[0][0]              \r\n__________________________________________________________________________________________________\r\ndense_2 (Dense)                 (None, 2)            402         dropout_7[0][0]                  \r\n==================================================================================================\r\nTotal params: 4,654,802\r\nTrainable params: 4,654,802\r\nNon-trainable params: 0\r\n__________________________________________________________________________________________________\r\n```\r\nwhich converts to .onnx model, and I have a sample to input in the model as dictionary with following keys.\r\n```\r\n'em_barrel_Lr0', 'em_barrel_Lr1','em_barrel_Lr2', 'em_barrel_Lr3', 'tile_barrel_Lr1', \r\n'tile_barrel_Lr2', 'tile_barrel_Lr3', 'p_Eratio', 'p_Reta', 'p_Rhad', 'p_Rphi', \r\n'p_TRTPID', 'p_numberOfSCTHits', 'p_ndof', 'p_dPOverP', 'p_deltaEta1', 'p_f1', 'p_f3',\r\n'p_deltaPhiRescaled2', 'p_weta2', 'p_d0', 'p_d0Sig', 'p_qd0Sig', 'p_nTracks', \r\n'p_sct_weight_charge', 'eventNumber', 'p_TruthType', 'p_iffTruth', 'p_LHTight', \r\n'p_LHMedium', 'p_LHLoose', 'p_eta', 'p_et_calo', 'p_LHValue', 'tracks_image'\r\n```\r\nI tried to feed the sample to the .onnx model by \r\n\r\n```\r\ninput_feeds = {}\r\nkey = ['em_barrel_Lr0', 'em_barrel_Lr1', 'em_barrel_Lr2', 'em_barrel_Lr3', 'tile_barrel_Lr1', \r\n'tile_barrel_Lr2', 'tile_barrel_Lr3', 'p_Eratio', 'p_Reta', 'p_Rhad', \r\n'p_Rphi', 'p_TRTPID', 'p_numberOfSCTHits', 'p_ndof', 'p_dPOverP', \r\n'p_deltaEta1', 'p_f1', 'p_f3', 'p_deltaPhiRescaled2', 'p_weta2', \r\n'p_d0', 'p_d0Sig', 'p_qd0Sig', 'p_nTracks', 'p_sct_weight_charge', \r\n'eventNumber', 'p_TruthType', 'p_iffTruth', 'p_LHTight', \r\n'p_LHMedium', 'p_LHLoose', 'p_eta', 'p_et_calo', 'p_LHValue', \r\n'tracks_image']\r\nfor i in range(26):\r\n    input_feeds[sess_ort.get_inputs()[i].name] = final_sample[key[i]]\r\n```\r\nand then\r\n\r\n```\r\noutput_name = sess_ort.get_outputs()[0].name\r\nres = sess_ort.run([output_name], input_feeds)\r\n```\r\nand I get following error\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nInvalidArgument                           Traceback (most recent call last)\r\n<ipython-input-15-830965c44719> in <module>\r\n----> 1 res = sess_ort.run([output_name], input_feeds)\r\n\r\n/export/home/zp/gupta/envTf2/lib/python3.7/site-packages/onnxruntime/capi/session.py in run(self, output_names, input_feed, run_options)\r\n    140             output_names = [output.name for output in self._outputs_meta]\r\n    141         try:\r\n--> 142             return self._sess.run(output_names, input_feed, run_options)\r\n    143         except C.EPFail as err:\r\n    144             if self._enable_fallback:\r\n\r\nInvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Unexpected input data type. Actual: (N11onnxruntime17PrimitiveDataTypeIdEE) , expected: (N11onnxruntime17PrimitiveDataTypeIfEE)\r\n```\r\nneed help,\r\n\r\nThanks,\r\nDebo.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/481", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/481/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/481/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/481/events", "html_url": "https://github.com/onnx/keras-onnx/issues/481", "id": 614712414, "node_id": "MDU6SXNzdWU2MTQ3MTI0MTQ=", "number": 481, "title": "ValueError: Value \"<dtype: 'float32'>\" is not valid attribute data type.", "user": {"login": "dimabendera", "id": 26656535, "node_id": "MDQ6VXNlcjI2NjU2NTM1", "avatar_url": "https://avatars2.githubusercontent.com/u/26656535?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dimabendera", "html_url": "https://github.com/dimabendera", "followers_url": "https://api.github.com/users/dimabendera/followers", "following_url": "https://api.github.com/users/dimabendera/following{/other_user}", "gists_url": "https://api.github.com/users/dimabendera/gists{/gist_id}", "starred_url": "https://api.github.com/users/dimabendera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dimabendera/subscriptions", "organizations_url": "https://api.github.com/users/dimabendera/orgs", "repos_url": "https://api.github.com/users/dimabendera/repos", "events_url": "https://api.github.com/users/dimabendera/events{/privacy}", "received_events_url": "https://api.github.com/users/dimabendera/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-05-08T12:28:22Z", "updated_at": "2020-05-08T13:15:59Z", "closed_at": "2020-05-08T13:15:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "when I run \r\n```bash\r\npython mask_rcnn.py 1045023827_4ec3e8ba5c_z.jpg\r\n```\r\nI got Error:\r\n```\r\nTraceback (most recent call last):\r\n  File \"mask_rcnn.py\", line 723, in <module>\r\n    oml = keras2onnx.convert_keras(model.keras_model, target_opset=11)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/main.py\", line 92, in convert_keras\r\n    parse_graph(topology, tf_graph, target_opset, output_names)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/parser.py\", line 828, in parse_graph\r\n    return _parse_graph_core(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/parser.py\", line 756, in _parse_graph_core\r\n    _infer_graph_shape(topology, top_scope, varset)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/parser.py\", line 479, in _infer_graph_shape\r\n    _finalize_tf2onnx_op(topology, oop, varset)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/parser.py\", line 449, in _finalize_tf2onnx_op\r\n    g = tf2onnx_wrap(topo, subgraph, outputs, varset.target_opset)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/wrapper.py\", line 357, in tf2onnx_wrap\r\n    raise e\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/wrapper.py\", line 351, in tf2onnx_wrap\r\n    output_names=outputs)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/ktf2onnx/tf2onnx/tfonnx.py\", line 493, in process_tf_graph\r\n    onnx_nodes, op_cnt, attr_cnt, output_shapes, dtypes = tensorflow_to_onnx(tf_graph, shape_override)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/ktf2onnx/tf2onnx/tfonnx.py\", line 122, in tensorflow_to_onnx\r\n    return tflist_to_onnx(graph.get_operations(), shape_override)\r\n  File \"/usr/local/lib/python3.7/site-packages/keras2onnx/ktf2onnx/tf2onnx/tfonnx.py\", line 109, in tflist_to_onnx\r\n    onnx_node = helper.make_node(node.type, input_names, output_names, name=node.name, **attr)\r\n  File \"/usr/local/lib64/python3.7/site-packages/onnx/helper.py\", line 56, in make_node\r\n    for key, value in sorted(kwargs.items()))\r\n  File \"/usr/local/lib64/python3.7/site-packages/onnx/helper.py\", line 56, in <genexpr>\r\n    for key, value in sorted(kwargs.items()))\r\n  File \"/usr/local/lib64/python3.7/site-packages/onnx/helper.py\", line 273, in make_attribute\r\n    'Value \"{}\" is not valid attribute data type.'.format(value))\r\nValueError: Value \"<dtype: 'float32'>\" is not valid attribute data type.\r\n```\r\n\r\n\r\nPython 3.7.7\r\ntensorflow 1.15.2\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/479", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/479/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/479/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/479/events", "html_url": "https://github.com/onnx/keras-onnx/issues/479", "id": 614266030, "node_id": "MDU6SXNzdWU2MTQyNjYwMzA=", "number": 479, "title": "Tensor {} already processed", "user": {"login": "buddhapuneeth", "id": 3439010, "node_id": "MDQ6VXNlcjM0MzkwMTA=", "avatar_url": "https://avatars3.githubusercontent.com/u/3439010?v=4", "gravatar_id": "", "url": "https://api.github.com/users/buddhapuneeth", "html_url": "https://github.com/buddhapuneeth", "followers_url": "https://api.github.com/users/buddhapuneeth/followers", "following_url": "https://api.github.com/users/buddhapuneeth/following{/other_user}", "gists_url": "https://api.github.com/users/buddhapuneeth/gists{/gist_id}", "starred_url": "https://api.github.com/users/buddhapuneeth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/buddhapuneeth/subscriptions", "organizations_url": "https://api.github.com/users/buddhapuneeth/orgs", "repos_url": "https://api.github.com/users/buddhapuneeth/repos", "events_url": "https://api.github.com/users/buddhapuneeth/events{/privacy}", "received_events_url": "https://api.github.com/users/buddhapuneeth/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-05-07T18:43:38Z", "updated_at": "2020-08-21T06:19:16Z", "closed_at": "2020-05-13T23:35:53Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I am getting below error while converting some of our model.\r\n....keras2onnx/common/intop.py\", line 71, in add_output\r\n    assert False, \"Tensor {} already processed\".format(var.full_name)\r\nAssertionError: Tensor .....0 already processed\r\n\r\nSeems the issue is here:\r\nhttps://github.com/onnx/keras-onnx/blob/master/keras2onnx/common/intop.py#L72\r\nAnyway we are not reading 'op_from' else where. \r\n\r\n\r\nAs we are reading it anywhere can we handle it in the same way as we are handling output_mask like:\r\na. https://github.com/onnx/keras-onnx/blob/master/keras2onnx/common/intop.py#L82\r\nor \r\nb. can we make 'op_from' list like 'op_to'?\r\n\r\nAlso, why are we setting op_from again in shape_inference\r\nhttps://github.com/onnx/keras-onnx/blob/master/keras2onnx/parser.py#L357\r\nI am not able to understand the need for that here?\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/477", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/477/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/477/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/477/events", "html_url": "https://github.com/onnx/keras-onnx/issues/477", "id": 613844458, "node_id": "MDU6SXNzdWU2MTM4NDQ0NTg=", "number": 477, "title": " ImportError: cannot import name 'onnx_pb'", "user": {"login": "madenmud", "id": 2967159, "node_id": "MDQ6VXNlcjI5NjcxNTk=", "avatar_url": "https://avatars1.githubusercontent.com/u/2967159?v=4", "gravatar_id": "", "url": "https://api.github.com/users/madenmud", "html_url": "https://github.com/madenmud", "followers_url": "https://api.github.com/users/madenmud/followers", "following_url": "https://api.github.com/users/madenmud/following{/other_user}", "gists_url": "https://api.github.com/users/madenmud/gists{/gist_id}", "starred_url": "https://api.github.com/users/madenmud/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/madenmud/subscriptions", "organizations_url": "https://api.github.com/users/madenmud/orgs", "repos_url": "https://api.github.com/users/madenmud/repos", "events_url": "https://api.github.com/users/madenmud/events{/privacy}", "received_events_url": "https://api.github.com/users/madenmud/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-07T07:42:25Z", "updated_at": "2020-05-07T08:09:37Z", "closed_at": "2020-05-07T08:08:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, I got this error when I try \"python -c \"import keras2onnx\" \"  just after install onnx and keras2onnx.\r\n\r\nIt comes on tf2.1-gpu docker image and it has followings.\r\n\r\n\r\n> Keras                2.3.1\r\n> Keras-Applications   1.0.8\r\n> Keras-Preprocessing  1.1.0\r\n> keras2onnx           1.6.5\r\n\r\n> onnx                 1.6.0\r\n> onnxconverter-common 1.6.5\r\n> onnxruntime          1.2.0\r\n> opencv-python        4.2.0.32\r\n\r\n> tensorboard          2.1.0\r\n> tensorflow-estimator 2.1.0\r\n> tensorflow-gpu       2.1.0\r\n\r\nis there anyone who has same issue?\r\n\r\n\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/474", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/474/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/474/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/474/events", "html_url": "https://github.com/onnx/keras-onnx/issues/474", "id": 611398021, "node_id": "MDU6SXNzdWU2MTEzOTgwMjE=", "number": 474, "title": "Changing channel ordering to NCHW", "user": {"login": "anilsathyan7", "id": 1130185, "node_id": "MDQ6VXNlcjExMzAxODU=", "avatar_url": "https://avatars1.githubusercontent.com/u/1130185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anilsathyan7", "html_url": "https://github.com/anilsathyan7", "followers_url": "https://api.github.com/users/anilsathyan7/followers", "following_url": "https://api.github.com/users/anilsathyan7/following{/other_user}", "gists_url": "https://api.github.com/users/anilsathyan7/gists{/gist_id}", "starred_url": "https://api.github.com/users/anilsathyan7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anilsathyan7/subscriptions", "organizations_url": "https://api.github.com/users/anilsathyan7/orgs", "repos_url": "https://api.github.com/users/anilsathyan7/repos", "events_url": "https://api.github.com/users/anilsathyan7/events{/privacy}", "received_events_url": "https://api.github.com/users/anilsathyan7/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2020-05-03T12:08:42Z", "updated_at": "2020-05-21T10:27:38Z", "closed_at": "2020-05-05T05:27:36Z", "author_association": "NONE", "active_lock_reason": null, "body": "How should we specify **'param channel_first_inputs: A list of channel first input**' parameters to change the channel ordering of all the layers so that there is no 'transpose layers' in the onnx model??\r\n\r\nI tried to convert a tf.keras mode as follows\r\n`onnx_model7 = keras2onnx.convert_keras(slim_model,'testt', channel_first_inputs=['ip','conv2d_transpose_4'])`\r\n\r\nBut the output still seems to have channel last format? I have previously tried[ tf2onnx](https://github.com/onnx/tensorflow-onnx) and in a similar manner  i managed to remove all except one transpose layer at output node.\r\n[slim-net-157-0.02.zip](https://github.com/onnx/keras-onnx/files/4570210/slim-net-157-0.02.zip)\r\n\r\nI'am using tf.15 with tf.keras and i need all layers with NCHW format with no transpose nodes? \r\nHow can we achieve this?\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/471", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/471/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/471/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/471/events", "html_url": "https://github.com/onnx/keras-onnx/issues/471", "id": 609720893, "node_id": "MDU6SXNzdWU2MDk3MjA4OTM=", "number": 471, "title": "The issue on EfficientDet conversion", "user": {"login": "florisdesmedt", "id": 5492856, "node_id": "MDQ6VXNlcjU0OTI4NTY=", "avatar_url": "https://avatars1.githubusercontent.com/u/5492856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/florisdesmedt", "html_url": "https://github.com/florisdesmedt", "followers_url": "https://api.github.com/users/florisdesmedt/followers", "following_url": "https://api.github.com/users/florisdesmedt/following{/other_user}", "gists_url": "https://api.github.com/users/florisdesmedt/gists{/gist_id}", "starred_url": "https://api.github.com/users/florisdesmedt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/florisdesmedt/subscriptions", "organizations_url": "https://api.github.com/users/florisdesmedt/orgs", "repos_url": "https://api.github.com/users/florisdesmedt/repos", "events_url": "https://api.github.com/users/florisdesmedt/events{/privacy}", "received_events_url": "https://api.github.com/users/florisdesmedt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-04-30T08:43:49Z", "updated_at": "2020-07-07T22:36:09Z", "closed_at": "2020-07-06T17:15:22Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI'm working on creating an onnx-model for efficientdet (https://github.com/xuannianz/EfficientDet). To make the `keras2onnx.convert_keras` call succeed I had to change lambda functions for the `swish` activations to regular tensorflow swish activations.\r\nAt last I obtained an onnx modelfile, but when loading this model file I get the error `[ONNXRuntimeError] : 10 : INVALID_GRAPH : This is an invalid model. Error in Node:block2b_drop/cond/Shape/Switch : No Op registered for Switch with domain_version of 11`\r\n\r\nAnybody knows how to solve this?\r\n\r\nBest regards,\r\nF.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/467", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/467/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/467/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/467/events", "html_url": "https://github.com/onnx/keras-onnx/issues/467", "id": 608878772, "node_id": "MDU6SXNzdWU2MDg4Nzg3NzI=", "number": 467, "title": "Customized activation function support", "user": {"login": "Debottam", "id": 34949953, "node_id": "MDQ6VXNlcjM0OTQ5OTUz", "avatar_url": "https://avatars3.githubusercontent.com/u/34949953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Debottam", "html_url": "https://github.com/Debottam", "followers_url": "https://api.github.com/users/Debottam/followers", "following_url": "https://api.github.com/users/Debottam/following{/other_user}", "gists_url": "https://api.github.com/users/Debottam/gists{/gist_id}", "starred_url": "https://api.github.com/users/Debottam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Debottam/subscriptions", "organizations_url": "https://api.github.com/users/Debottam/orgs", "repos_url": "https://api.github.com/users/Debottam/repos", "events_url": "https://api.github.com/users/Debottam/events{/privacy}", "received_events_url": "https://api.github.com/users/Debottam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2020-04-29T08:38:55Z", "updated_at": "2020-05-24T19:58:56Z", "closed_at": "2020-05-24T19:58:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "Dear developers,\r\n\r\nI have a question regarding customized activation layer e.g.\r\n\r\n```\r\nfrom ImportKeras import *\r\nimport numpy as np\r\n\r\ndef mish(x):\r\n    return x*K.tanh(K.softplus(x))\r\n```\r\nDoes this type of activation built in keras can be converted to onnx by applying keras2onnx?\r\n\r\nThanks,\r\nDebo.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/463", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/463/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/463/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/463/events", "html_url": "https://github.com/onnx/keras-onnx/issues/463", "id": 607926543, "node_id": "MDU6SXNzdWU2MDc5MjY1NDM=", "number": 463, "title": "TF2.2", "user": {"login": "christopher5106", "id": 6875375, "node_id": "MDQ6VXNlcjY4NzUzNzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/6875375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/christopher5106", "html_url": "https://github.com/christopher5106", "followers_url": "https://api.github.com/users/christopher5106/followers", "following_url": "https://api.github.com/users/christopher5106/following{/other_user}", "gists_url": "https://api.github.com/users/christopher5106/gists{/gist_id}", "starred_url": "https://api.github.com/users/christopher5106/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/christopher5106/subscriptions", "organizations_url": "https://api.github.com/users/christopher5106/orgs", "repos_url": "https://api.github.com/users/christopher5106/repos", "events_url": "https://api.github.com/users/christopher5106/events{/privacy}", "received_events_url": "https://api.github.com/users/christopher5106/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-04-27T23:51:37Z", "updated_at": "2020-04-28T17:35:33Z", "closed_at": "2020-04-28T17:35:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI'm getting this error:\r\n\r\n```\r\n  File \"/home/cbo/miniconda3/envs/tf-2/lib/python3.8/site-packages/keras2onnx/main.py\", line 57, in convert_keras\r\n    tf_graph = build_layer_output_from_model(model, output_dict, input_names, output_names)\r\n  File \"/home/cbo/miniconda3/envs/tf-2/lib/python3.8/site-packages/keras2onnx/_parser_tf.py\", line 292, in build_layer_output_from_model\r\n    return extract_outputs_from_subclassing_model(model, output_dict, input_names, output_names)\r\n  File \"/home/cbo/miniconda3/envs/tf-2/lib/python3.8/site-packages/keras2onnx/_parser_tf.py\", line 253, in extract_outputs_from_subclassing_model\r\n    graph_def, converted_input_indices = _convert_to_constants(\r\n  File \"/home/cbo/miniconda3/envs/tf-2/lib/python3.8/site-packages/keras2onnx/_graph_cvt.py\", line 437, in convert_variables_to_constants_v2\r\n    tensor_data = _get_tensor_data(func)\r\n  File \"/home/cbo/miniconda3/envs/tf-2/lib/python3.8/site-packages/keras2onnx/_graph_cvt.py\", line 207, in _get_tensor_data\r\n    data = map_index_to_variable[idx].numpy()\r\n  File \"/home/cbo/miniconda3/envs/tf-2/lib/python3.8/site-packages/tensorflow/python/ops/resource_variable_ops.py\", line 604, in numpy\r\n    raise NotImplementedError(\r\nNotImplementedError: numpy() is only available when eager execution is enabled.\r\n```\r\n\r\nwhen using `tf.compat.v1.disable_eager_execution()`.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/461", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/461/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/461/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/461/events", "html_url": "https://github.com/onnx/keras-onnx/issues/461", "id": 607032729, "node_id": "MDU6SXNzdWU2MDcwMzI3Mjk=", "number": 461, "title": "not being able to convert a .h5 model (generated by tf.keras) using keras2onnx", "user": {"login": "Debottam", "id": 34949953, "node_id": "MDQ6VXNlcjM0OTQ5OTUz", "avatar_url": "https://avatars3.githubusercontent.com/u/34949953?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Debottam", "html_url": "https://github.com/Debottam", "followers_url": "https://api.github.com/users/Debottam/followers", "following_url": "https://api.github.com/users/Debottam/following{/other_user}", "gists_url": "https://api.github.com/users/Debottam/gists{/gist_id}", "starred_url": "https://api.github.com/users/Debottam/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Debottam/subscriptions", "organizations_url": "https://api.github.com/users/Debottam/orgs", "repos_url": "https://api.github.com/users/Debottam/repos", "events_url": "https://api.github.com/users/Debottam/events{/privacy}", "received_events_url": "https://api.github.com/users/Debottam/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-26T15:00:12Z", "updated_at": "2020-04-26T18:51:21Z", "closed_at": "2020-04-26T18:51:21Z", "author_association": "NONE", "active_lock_reason": null, "body": "Dear developers,\r\n\r\nI have an .h5 model generated by tensorflow.keras (TF2.1). I have tried the following\r\n\r\n```\r\nkeras2onnx.convert_keras(model,model.name)\r\n\r\nException: This is a tensorflow keras model, but keras standalone converter is used. Please set environment variable TF_KERAS = 1.\r\n```\r\nThen I tried the following suggested in som stackoverflow answers\r\n\r\n```\r\nos.environ['TF_KERAS'] = '1'\r\nkeras2onnx.convert_keras(model,model.name)\r\n```\r\nBut the exception still persists. Let me know if you need more details.\r\n\r\nThanks,\r\nDebo.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/458", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/458/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/458/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/458/events", "html_url": "https://github.com/onnx/keras-onnx/issues/458", "id": 605999439, "node_id": "MDU6SXNzdWU2MDU5OTk0Mzk=", "number": 458, "title": "How to remove Transpose Layer after transfer to onnx", "user": {"login": "DanielXu123", "id": 30657808, "node_id": "MDQ6VXNlcjMwNjU3ODA4", "avatar_url": "https://avatars3.githubusercontent.com/u/30657808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DanielXu123", "html_url": "https://github.com/DanielXu123", "followers_url": "https://api.github.com/users/DanielXu123/followers", "following_url": "https://api.github.com/users/DanielXu123/following{/other_user}", "gists_url": "https://api.github.com/users/DanielXu123/gists{/gist_id}", "starred_url": "https://api.github.com/users/DanielXu123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DanielXu123/subscriptions", "organizations_url": "https://api.github.com/users/DanielXu123/orgs", "repos_url": "https://api.github.com/users/DanielXu123/repos", "events_url": "https://api.github.com/users/DanielXu123/events{/privacy}", "received_events_url": "https://api.github.com/users/DanielXu123/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2020-04-24T02:50:52Z", "updated_at": "2020-05-21T08:03:15Z", "closed_at": "2020-04-27T02:27:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have succesfully transfered my tf.keras built .h5 model to .onnx file. Furthermore, **I need to transfer this .onnx file to .caffemodel and .prototxt.** It turns out that the onnx2caffe project shows \r\n\r\n`TypeError: ONNX node of type Transpose is not supported.`\r\n\r\nI went back to check where the transpose comes from, bu**t there is no Transpose layer in my tf.keras net structure**.\r\n\r\nMay I ask how can I remove the Transpose Layer?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/451", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/451/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/451/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/451/events", "html_url": "https://github.com/onnx/keras-onnx/issues/451", "id": 604706188, "node_id": "MDU6SXNzdWU2MDQ3MDYxODg=", "number": 451, "title": "Transfer tf.keras build model to onnx FAILED", "user": {"login": "DanielXu123", "id": 30657808, "node_id": "MDQ6VXNlcjMwNjU3ODA4", "avatar_url": "https://avatars3.githubusercontent.com/u/30657808?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DanielXu123", "html_url": "https://github.com/DanielXu123", "followers_url": "https://api.github.com/users/DanielXu123/followers", "following_url": "https://api.github.com/users/DanielXu123/following{/other_user}", "gists_url": "https://api.github.com/users/DanielXu123/gists{/gist_id}", "starred_url": "https://api.github.com/users/DanielXu123/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DanielXu123/subscriptions", "organizations_url": "https://api.github.com/users/DanielXu123/orgs", "repos_url": "https://api.github.com/users/DanielXu123/repos", "events_url": "https://api.github.com/users/DanielXu123/events{/privacy}", "received_events_url": "https://api.github.com/users/DanielXu123/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-04-22T12:09:22Z", "updated_at": "2020-04-23T02:31:04Z", "closed_at": "2020-04-23T02:31:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\nimport tensorflow as tf\r\nfrom tensorflow import keras as keras\r\nimport keras2onnx\r\nimport onnx\r\nfrom tensorflow.keras.models import load_model\r\n\r\nimport os\r\nos.environ['TF_KERAS'] = '1'\r\nos.environ['CUDA_VISIBLE_DEVICES'] = '0'\r\n\r\nmodel = load_model('./model/test.h5')\r\nonnx_model = keras2onnx.convert_keras(model,model.name)\r\ntemp_model_file = './model/test.onnx'\r\nonnx.save_model(onnx_model, temp_model_file)\r\n\r\n```\r\n\r\nAs the transfer code shows above, I have already set the TF_KERAS =  1, but it still shows the following error.\r\n\r\n`Exception: This is a tensorflow keras model, but keras standalone converter is used. Please set environment variable TF_KERAS = 1.`\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/450", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/450/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/450/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/450/events", "html_url": "https://github.com/onnx/keras-onnx/issues/450", "id": 604406932, "node_id": "MDU6SXNzdWU2MDQ0MDY5MzI=", "number": 450, "title": "Keras Mask RCNN: Fatal error: CropAndResize is not a registered function/op", "user": {"login": "qizhen816", "id": 18132150, "node_id": "MDQ6VXNlcjE4MTMyMTUw", "avatar_url": "https://avatars3.githubusercontent.com/u/18132150?v=4", "gravatar_id": "", "url": "https://api.github.com/users/qizhen816", "html_url": "https://github.com/qizhen816", "followers_url": "https://api.github.com/users/qizhen816/followers", "following_url": "https://api.github.com/users/qizhen816/following{/other_user}", "gists_url": "https://api.github.com/users/qizhen816/gists{/gist_id}", "starred_url": "https://api.github.com/users/qizhen816/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/qizhen816/subscriptions", "organizations_url": "https://api.github.com/users/qizhen816/orgs", "repos_url": "https://api.github.com/users/qizhen816/repos", "events_url": "https://api.github.com/users/qizhen816/events{/privacy}", "received_events_url": "https://api.github.com/users/qizhen816/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-04-22T02:34:32Z", "updated_at": "2020-04-24T17:27:58Z", "closed_at": "2020-04-23T02:23:03Z", "author_association": "NONE", "active_lock_reason": null, "body": " I followed the Mask RCNN convert instruction from [https://github.com/onnx/keras-onnx/tree/master/applications/mask_rcnn](https://github.com/onnx/keras-onnx/tree/master/applications/mask_rcnn), and copied `convert_tf_crop_and_resize` function from test_utils, converting seems fine with warnings:\r\n ```\r\nThe layer <keras.layers.core.Lambda object at 0x000002DAD8574278> doesn't have a specific converter, fall back.\r\nThe layer <keras.layers.core.Lambda object at 0x000002DAD8574278> doesn't have a specific converter, fall back.\r\nThe layer <keras.layers.core.Lambda object at 0x000002DAD8574278> doesn't have a specific converter, fall back.\r\nThe layer <keras.layers.core.Lambda object at 0x000002DAD8574278> doesn't have a specific converter, fall back.\r\nThe layer <keras.layers.core.Lambda object at 0x000002DAD8574278> doesn't have a specific converter, fall back.\r\nThe node number after optimization: 1739 -> 879\r\n``` \r\nBut error occurs when onnxruntime inference:\r\n`onnxruntime.capi.onnxruntime_pybind11_state.Fail: [ONNXRuntimeError] : 1 : FAIL : Fatal error: CropAndResize is not a registered function/op` \r\n\r\nFYI my onnxruntime version is 1.2.0 and keras2onnx is 1.7.0", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/440", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/440/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/440/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/440/events", "html_url": "https://github.com/onnx/keras-onnx/issues/440", "id": 600688161, "node_id": "MDU6SXNzdWU2MDA2ODgxNjE=", "number": 440, "title": "InvalidArgumentError:  Default MaxPoolingOp only supports NHWC on device type CPU", "user": {"login": "M-Tonin", "id": 21134353, "node_id": "MDQ6VXNlcjIxMTM0MzUz", "avatar_url": "https://avatars0.githubusercontent.com/u/21134353?v=4", "gravatar_id": "", "url": "https://api.github.com/users/M-Tonin", "html_url": "https://github.com/M-Tonin", "followers_url": "https://api.github.com/users/M-Tonin/followers", "following_url": "https://api.github.com/users/M-Tonin/following{/other_user}", "gists_url": "https://api.github.com/users/M-Tonin/gists{/gist_id}", "starred_url": "https://api.github.com/users/M-Tonin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/M-Tonin/subscriptions", "organizations_url": "https://api.github.com/users/M-Tonin/orgs", "repos_url": "https://api.github.com/users/M-Tonin/repos", "events_url": "https://api.github.com/users/M-Tonin/events{/privacy}", "received_events_url": "https://api.github.com/users/M-Tonin/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-16T01:45:27Z", "updated_at": "2020-04-16T03:16:19Z", "closed_at": "2020-04-16T03:16:19Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi all, \r\n\r\nI have done this steps:\r\n\r\n1. \r\n```python\r\nonnx_model = onnx.load(FILE_PATH+\"mnist_test.onnx\")\r\nk_model_onnx = onnx_to_keras(onnx_model, ['input_1'], name_policy=\"short\")\r\n```\r\n2. \r\n```python\r\nk_model_onnx.summary()\r\n```\r\n\r\n\r\n```\r\nModel: \"model\"\r\n__________________________________________________________________________________________________\r\nLayer (type)                    Output Shape         Param #     Connected to                     \r\n==================================================================================================\r\ninput_1 (InputLayer)            [(None, 28, 28, 1)]  0                                            \r\n__________________________________________________________________________________________________\r\nadjusted (Permute)              (None, 1, 28, 28)    0           input_1[0][0]                    \r\n__________________________________________________________________________________________________\r\nconvolut (Conv2D)               (None, 32, 26, 26)   320         adjusted[0][0]                   \r\n__________________________________________________________________________________________________\r\nconv2d/I (Activation)           (None, 32, 26, 26)   0           convolut[0][0]                   \r\n__________________________________________________________________________________________________\r\nconvolut_1 (Conv2D)             (None, 64, 24, 24)   18496       conv2d/I[0][0]                   \r\n__________________________________________________________________________________________________\r\nconv2d_1 (Activation)           (None, 64, 24, 24)   0           convolut_1[0][0]                 \r\n__________________________________________________________________________________________________\r\nconv2d_1_1_pad (ZeroPadding2D)  (None, 64, 24, 24)   0           conv2d_1[0][0]                   \r\n__________________________________________________________________________________________________\r\nconv2d_1_1 (MaxPooling2D)       (None, 64, 12, 12)   0           conv2d_1_1_pad[0][0]             \r\n__________________________________________________________________________________________________\r\nconv2d_1_2 (Permute)            (None, 12, 12, 64)   0           conv2d_1_1[0][0]                 \r\n__________________________________________________________________________________________________\r\nflatten/ (Reshape)              (None, None)         0           conv2d_1_2[0][0]                 \r\n__________________________________________________________________________________________________\r\ntransfor_reshape (Reshape)      (None, 9216)         0           flatten/[0][0]                   \r\n__________________________________________________________________________________________________\r\ntransfor (Dense)                (None, 128)          1179648     transfor_reshape[0][0]           \r\n__________________________________________________________________________________________________\r\nbiased_t_const2 (Lambda)        (128,)               0           input_1[0][0]                    \r\n__________________________________________________________________________________________________\r\nbiased_t (Lambda)               (None, 128)          0           transfor[0][0]                   \r\n                                                                 biased_t_const2[0][0]            \r\n__________________________________________________________________________________________________\r\ndense/Id (Activation)           (None, 128)          0           biased_t[0][0]                   \r\n__________________________________________________________________________________________________\r\ntransfor_1 (Dense)              (None, 10)           1280        dense/Id[0][0]                   \r\n__________________________________________________________________________________________________\r\nbiased_t_1_const2 (Lambda)      (10,)                0           input_1[0][0]                    \r\n__________________________________________________________________________________________________\r\nbiased_t_1 (Lambda)             (None, 10)           0           transfor_1[0][0]                 \r\n                                                                 biased_t_1_const2[0][0]          \r\n__________________________________________________________________________________________________\r\ndense_1/ (Activation)           (None, 10)           0           biased_t_1[0][0]                 \r\n==================================================================================================\r\nTotal params: 1,199,744\r\nTrainable params: 1,199,744\r\nNon-trainable params: 0\r\n__________________________________________________________________________________________________\r\n\r\n```\r\n\r\n3. \r\n```python\r\ny_pred_onnx = k_model_onnx.predict(x_test)\r\n```\r\nResult :\r\n\r\n```\r\nTensor(\"model/transfor/MatMul:0\", shape=(None, 128), dtype=float32) Tensor(\"model/biased_t_const2/Const:0\", shape=(128,), dtype=float32)\r\nTensor(\"model/transfor_1/MatMul:0\", shape=(None, 10), dtype=float32) Tensor(\"model/biased_t_1_const2/Const:0\", shape=(10,), dtype=float32)\r\n---------------------------------------------------------------------------\r\nInvalidArgumentError                      Traceback (most recent call last)\r\n<ipython-input-16-c199c87d14d2> in <module>()\r\n----> 1 y_pred_onnx = k_model_onnx.predict(x_test)\r\n\r\n7 frames\r\n/usr/local/lib/python3.6/dist-packages/tensorflow/python/eager/execute.py in quick_execute(op_name, num_outputs, inputs, attrs, ctx, name)\r\n     58     ctx.ensure_initialized()\r\n     59     tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,\r\n---> 60                                         inputs, attrs, num_outputs)\r\n     61   except core._NotOkStatusException as e:\r\n     62     if name is not None:\r\n\r\nInvalidArgumentError:  Default MaxPoolingOp only supports NHWC on device type CPU\r\n\t [[node model/conv2d_1_1/MaxPool (defined at <ipython-input-16-c199c87d14d2>:1) ]] [Op:__inference_predict_function_2104]\r\n\r\nFunction call stack:\r\npredict_function\r\n```\r\n\r\nI have no idea what this mean and why it has happen.\r\nThanks!\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/436", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/436/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/436/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/436/events", "html_url": "https://github.com/onnx/keras-onnx/issues/436", "id": 598524507, "node_id": "MDU6SXNzdWU1OTg1MjQ1MDc=", "number": 436, "title": "I try to remove the identity block,but faild", "user": {"login": "KingerFzb", "id": 47851652, "node_id": "MDQ6VXNlcjQ3ODUxNjUy", "avatar_url": "https://avatars0.githubusercontent.com/u/47851652?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KingerFzb", "html_url": "https://github.com/KingerFzb", "followers_url": "https://api.github.com/users/KingerFzb/followers", "following_url": "https://api.github.com/users/KingerFzb/following{/other_user}", "gists_url": "https://api.github.com/users/KingerFzb/gists{/gist_id}", "starred_url": "https://api.github.com/users/KingerFzb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KingerFzb/subscriptions", "organizations_url": "https://api.github.com/users/KingerFzb/orgs", "repos_url": "https://api.github.com/users/KingerFzb/repos", "events_url": "https://api.github.com/users/KingerFzb/events{/privacy}", "received_events_url": "https://api.github.com/users/KingerFzb/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-12T16:44:45Z", "updated_at": "2020-04-12T18:34:26Z", "closed_at": "2020-04-12T18:34:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "`import onnx\r\nfrom onnx import optimizer\r\nimport keras2onnx\r\nfrom keras.models import load_model\r\nimport onnxmltools\r\n\r\nmodel = load_model('mobile_allgraph_v1.h5',compile=False)\r\n\r\nonnx_model = onnxmltools.convert_keras(model,model.name)\r\n#\u53bb\u6389identity\u5c42\r\nall_passes = optimizer.get_available_passes()\r\nprint(\"Available optimization passes:\")\r\nfor p in all_passes:\r\nprint('\\t{}'.format(p))\r\n\r\nonnx_optimized = 'mobilenet_optimized.onnx'\r\npasses = ['eliminate_identity']\r\noptimized_model = optimizer.optimize(onnx_model, passes)\r\nonnx.save(optimized_model, onnx_optimized)\r\n`\r\nI try to remove the identity,but faild\r\nUploading image.png\u2026\r\n\r\nTraceback (most recent call last): File \"modify_onnx.py\", line 18, in <module> optimized_model = optimizer.optimize(onnx_model, passes) File \"D:\\Anaconda3\\envs\\tensorflow36\\lib\\site-packages\\onnx\\optimizer.py\", line 55, in optimize optimized_model_str = C.optimize(model_str, passes) IndexError: invalid unordered_map<K, T> key", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/432", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/432/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/432/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/432/events", "html_url": "https://github.com/onnx/keras-onnx/issues/432", "id": 597756303, "node_id": "MDU6SXNzdWU1OTc3NTYzMDM=", "number": 432, "title": "TF ops ZerosLike, ReverseV2, FloorDiv cannot be converted", "user": {"login": "sonu1-p", "id": 1289895, "node_id": "MDQ6VXNlcjEyODk4OTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/1289895?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sonu1-p", "html_url": "https://github.com/sonu1-p", "followers_url": "https://api.github.com/users/sonu1-p/followers", "following_url": "https://api.github.com/users/sonu1-p/following{/other_user}", "gists_url": "https://api.github.com/users/sonu1-p/gists{/gist_id}", "starred_url": "https://api.github.com/users/sonu1-p/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sonu1-p/subscriptions", "organizations_url": "https://api.github.com/users/sonu1-p/orgs", "repos_url": "https://api.github.com/users/sonu1-p/repos", "events_url": "https://api.github.com/users/sonu1-p/events{/privacy}", "received_events_url": "https://api.github.com/users/sonu1-p/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-04-10T08:02:09Z", "updated_at": "2020-04-21T22:15:59Z", "closed_at": "2020-04-21T22:15:59Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Facing the following errors in keras2onnx conversion when using latest keras2onnx from source:\r\n```\r\nThe tf.op node tf_op_layer_frame/zeros_like/frame/zeros_like of type ZerosLike cannot be converted\r\nW0410 00:56:43.538172 140734887024064 parser.py:298] The tf.op node tf_op_layer_frame/zeros_like/frame/zeros_like of type ZerosLike cannot be converted\r\nThe tf.op node tf_op_layer_ReverseV2/ReverseV2 of type ReverseV2 cannot be converted\r\nW0410 00:56:43.539941 140734887024064 parser.py:298] The tf.op node tf_op_layer_ReverseV2/ReverseV2 of type ReverseV2 cannot be converted\r\nThe tf.op node tf_op_layer_frame/floordiv_1/frame/floordiv_1 of type FloorDiv cannot be converted\r\nW0410 00:56:43.541015 140734887024064 parser.py:298] The tf.op node tf_op_layer_frame/floordiv_1/frame/floordiv_1 of type FloorDiv cannot be converted\r\nThe tf.op node tf_op_layer_frame/floordiv/frame/floordiv of type FloorDiv cannot be converted\r\nW0410 00:56:43.541541 140734887024064 parser.py:298] The tf.op node tf_op_layer_frame/floordiv/frame/floordiv of type FloorDiv cannot be converted\r\nThere is an error(<class 'AssertionError'>) happened during optimizing on the converted model!\r\nW0410 00:56:43.854479 140734887024064 topology.py:328] There is an error(<class 'AssertionError'>) happened during optimizing on the converted model!\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/431", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/431/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/431/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/431/events", "html_url": "https://github.com/onnx/keras-onnx/issues/431", "id": 597708356, "node_id": "MDU6SXNzdWU1OTc3MDgzNTY=", "number": 431, "title": "Keras2onnx converter fails to convert tf.split node", "user": {"login": "sonu1-p", "id": 1289895, "node_id": "MDQ6VXNlcjEyODk4OTU=", "avatar_url": "https://avatars2.githubusercontent.com/u/1289895?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sonu1-p", "html_url": "https://github.com/sonu1-p", "followers_url": "https://api.github.com/users/sonu1-p/followers", "following_url": "https://api.github.com/users/sonu1-p/following{/other_user}", "gists_url": "https://api.github.com/users/sonu1-p/gists{/gist_id}", "starred_url": "https://api.github.com/users/sonu1-p/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sonu1-p/subscriptions", "organizations_url": "https://api.github.com/users/sonu1-p/orgs", "repos_url": "https://api.github.com/users/sonu1-p/repos", "events_url": "https://api.github.com/users/sonu1-p/events{/privacy}", "received_events_url": "https://api.github.com/users/sonu1-p/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-04-10T05:44:24Z", "updated_at": "2020-04-10T08:00:07Z", "closed_at": "2020-04-10T08:00:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I wanted to convert a keras model that was using tf.split node to ONNX. I get this error on doing so:\r\n```\r\nTraceback (most recent call last):\r\n  File \"test2.py\", line 9, in <module>\r\n    onnx_model = keras2onnx.convert_keras(model, target_opset=11)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/keras2onnx/main.py\", line 94, in convert_keras\r\n    parse_graph(topology, tf_graph, target_opset, output_names)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/keras2onnx/parser.py\", line 835, in parse_graph\r\n    return _parse_graph_core(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/keras2onnx/parser.py\", line 752, in _parse_graph_core\r\n    _on_parsing_tf_subgraph(graph, nodes, varset)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/keras2onnx/parser.py\", line 404, in _on_parsing_tf_subgraph\r\n    subgraph, replacement = create_subgraph(graph, node_list, sess, operator.full_name)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/keras2onnx/subgraph.py\", line 173, in create_subgraph\r\n    tf.import_graph_def(output_graph_def, name=im_scope)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/tensorflow_core/python/util/deprecation.py\", line 507, in new_func\r\n    return func(*args, **kwargs)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/tensorflow_core/python/framework/importer.py\", line 405, in import_graph_def\r\n    producer_op_list=producer_op_list)\r\n  File \"/Users/spareek/venv/lib/python3.6/site-packages/tensorflow_core/python/framework/importer.py\", line 505, in _import_graph_def_internal\r\n    raise ValueError(str(e))\r\nValueError: Node 'Squeeze': Connecting to invalid output 1 of source node split which has 1 outputs.\r\n```\r\n\r\nI was able to reproduce the same issue with this simple model:\r\n```\r\nimport tensorflow as tf\r\nimport keras2onnx\r\n\r\nx = tf.keras.Input(shape=(1, 12), dtype=\"int32\", name=\"input\")\r\nx1,x2,x3 = tf.split(x,[3,1,8], axis=2)\r\np = tf.squeeze(x2)\r\nmodel = tf.keras.Model(inputs=x, outputs=[p], name=\"test2\")\r\nmodel.save(\"split.h5\")\r\nonnx_model = keras2onnx.convert_keras(model, target_opset=11)\r\n```\r\nCan you please help look into this. Please let me know if you need any more information from me.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/426", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/426/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/426/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/426/events", "html_url": "https://github.com/onnx/keras-onnx/issues/426", "id": 595192570, "node_id": "MDU6SXNzdWU1OTUxOTI1NzA=", "number": 426, "title": "the onnx_model can not use in openvino", "user": {"login": "Martin0Li", "id": 49541680, "node_id": "MDQ6VXNlcjQ5NTQxNjgw", "avatar_url": "https://avatars3.githubusercontent.com/u/49541680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Martin0Li", "html_url": "https://github.com/Martin0Li", "followers_url": "https://api.github.com/users/Martin0Li/followers", "following_url": "https://api.github.com/users/Martin0Li/following{/other_user}", "gists_url": "https://api.github.com/users/Martin0Li/gists{/gist_id}", "starred_url": "https://api.github.com/users/Martin0Li/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Martin0Li/subscriptions", "organizations_url": "https://api.github.com/users/Martin0Li/orgs", "repos_url": "https://api.github.com/users/Martin0Li/repos", "events_url": "https://api.github.com/users/Martin0Li/events{/privacy}", "received_events_url": "https://api.github.com/users/Martin0Li/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-04-06T15:04:08Z", "updated_at": "2020-05-06T17:21:57Z", "closed_at": "2020-05-06T17:21:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "I got a squeezenet.onnx from openvino model zoo. And I convert the model to keras from onnx2keras[https://github.com/nerox8664/onnx2keras](url). So I want to convert this keras model to onnx. But it is different between  convert before and after.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/419", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/419/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/419/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/419/events", "html_url": "https://github.com/onnx/keras-onnx/issues/419", "id": 590115615, "node_id": "MDU6SXNzdWU1OTAxMTU2MTU=", "number": 419, "title": "Operation not in the graph", "user": {"login": "KodeWorker", "id": 24215149, "node_id": "MDQ6VXNlcjI0MjE1MTQ5", "avatar_url": "https://avatars0.githubusercontent.com/u/24215149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/KodeWorker", "html_url": "https://github.com/KodeWorker", "followers_url": "https://api.github.com/users/KodeWorker/followers", "following_url": "https://api.github.com/users/KodeWorker/following{/other_user}", "gists_url": "https://api.github.com/users/KodeWorker/gists{/gist_id}", "starred_url": "https://api.github.com/users/KodeWorker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/KodeWorker/subscriptions", "organizations_url": "https://api.github.com/users/KodeWorker/orgs", "repos_url": "https://api.github.com/users/KodeWorker/repos", "events_url": "https://api.github.com/users/KodeWorker/events{/privacy}", "received_events_url": "https://api.github.com/users/KodeWorker/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-03-30T09:00:37Z", "updated_at": "2020-04-17T01:14:41Z", "closed_at": "2020-04-17T01:14:41Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi everyone,\r\n\r\nI tried to convert the keras implementation of [EfficientNet](https://github.com/qubvel/efficientnet) to *.onnx format. The code is shown below:\r\n\r\n```python\r\nimport efficientnet.tfkeras as efn\r\nimport keras2onnx\r\n\r\nif __name__ == \"__main__\":\r\n    temp_model_file = 'efficientnet-b1.onnx'\r\n\r\n    model = efn.EfficientNetB0(weights='imagenet')\r\n    onnx_model = keras2onnx.convert_keras(model, model.name)\r\n    keras2onnx.save_model(onnx_model, temp_model_file)\r\n```\r\n\r\nAnd then, I encountered an error message.\r\n\r\n```\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Anaconda3_64\\envs\\TensorFlow2\\lib\\site-packages\\keras2onnx-1.6.5-py3.6.egg\\keras2onnx\\main.py\", line 54, in convert_keras\r\n    tf_graph = build_layer_output_from_model(model, output_dict, input_names, output_names)\r\n\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Anaconda3_64\\envs\\TensorFlow2\\lib\\site-packages\\keras2onnx-1.6.5-py3.6.egg\\keras2onnx\\_parse_tf.py\", line 264, in build_layer_output_from_model\r\n    return extract_outputs_from_subclassing_model(model, output_dict, input_names, output_names)\r\n\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Anaconda3_64\\envs\\TensorFlow2\\lib\\site-packages\\keras2onnx-1.6.5-py3.6.egg\\keras2onnx\\_parse_tf.py\", line 228, in extract_outputs_from_subclassing_model\r\n    output_dict.update(build_layer_outputs(model, concrete_func.graph, concrete_func.outputs))\r\n\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Anaconda3_64\\envs\\TensorFlow2\\lib\\site-packages\\keras2onnx-1.6.5-py3.6.egg\\keras2onnx\\_parse_tf.py\", line 213, in build_layer_outputs\r\n    assert graph.get_operation_by_name(output_node) is not None, \"Parsing layer({}) failed.\".format(\r\n\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Anaconda3_64\\envs\\TensorFlow2\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py\", line 3633, in get_operation_by_name\r\n    return self.as_graph_element(name, allow_tensor=False, allow_operation=True)\r\n\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Anaconda3_64\\envs\\TensorFlow2\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py\", line 3505, in as_graph_element\r\n    return self._as_graph_element_locked(obj, allow_tensor, allow_operation)\r\n\r\n  File \"C:\\Program Files (x86)\\Microsoft Visual Studio\\Shared\\Anaconda3_64\\envs\\TensorFlow2\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py\", line 3565, in _as_graph_element_locked\r\n    \"graph.\" % repr(name))\r\n\r\nKeyError: \"The name 'efficientnet-b0/block1a_dwconv/BiasAdd' refers to an Operation not in the graph.\"\r\n```\r\nI have no clue how to fix this. Any suggestion?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/418", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/418/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/418/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/418/events", "html_url": "https://github.com/onnx/keras-onnx/issues/418", "id": 589864651, "node_id": "MDU6SXNzdWU1ODk4NjQ2NTE=", "number": 418, "title": "Optimizing of BERT-base Keras subclassed model (Transformers 2.x) fails", "user": {"login": "pasikon", "id": 17677470, "node_id": "MDQ6VXNlcjE3Njc3NDcw", "avatar_url": "https://avatars0.githubusercontent.com/u/17677470?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pasikon", "html_url": "https://github.com/pasikon", "followers_url": "https://api.github.com/users/pasikon/followers", "following_url": "https://api.github.com/users/pasikon/following{/other_user}", "gists_url": "https://api.github.com/users/pasikon/gists{/gist_id}", "starred_url": "https://api.github.com/users/pasikon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pasikon/subscriptions", "organizations_url": "https://api.github.com/users/pasikon/orgs", "repos_url": "https://api.github.com/users/pasikon/repos", "events_url": "https://api.github.com/users/pasikon/events{/privacy}", "received_events_url": "https://api.github.com/users/pasikon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-29T19:27:26Z", "updated_at": "2020-03-29T23:40:49Z", "closed_at": "2020-03-29T23:39:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "Converting & trying to optimize the standard Transformers 2.x BERT-base model:\r\n\r\n```\r\nonnx_model = keras2onnx.convert_keras(model, model.name)\r\npasses = ['fuse_consecutive_concats']\r\n\r\n# Apply the optimization on the original model\r\noptimized_model = optimizer.optimize(onnx_model, passes)\r\n```\r\n\r\nResults in error:\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nIndexError                                Traceback (most recent call last)\r\n<ipython-input-15-2ba5d9c7686a> in <module>\r\n      9 \r\n     10 # Apply the optimization on the original model\r\n---> 11 optimized_model = optimizer.optimize(onnx_model, passes)\r\n     12 \r\n     13 # optimized_model = optimizer.optimize(onnx_model)\r\n\r\n~/anaconda3/envs/tf21/lib/python3.7/site-packages/onnx/optimizer.py in optimize(model, passes, fixed_point)\r\n     53         optimized_model_str = C.optimize_fixedpoint(model_str, passes)\r\n     54     else:\r\n---> 55         optimized_model_str = C.optimize(model_str, passes)\r\n     56 \r\n     57     return onnx.load_from_string(optimized_model_str)\r\n\r\nIndexError: _Map_base::at\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/403", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/403/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/403/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/403/events", "html_url": "https://github.com/onnx/keras-onnx/issues/403", "id": 575929829, "node_id": "MDU6SXNzdWU1NzU5Mjk4Mjk=", "number": 403, "title": "Import keras2onnx problem", "user": {"login": "chiehpower", "id": 32332200, "node_id": "MDQ6VXNlcjMyMzMyMjAw", "avatar_url": "https://avatars3.githubusercontent.com/u/32332200?v=4", "gravatar_id": "", "url": "https://api.github.com/users/chiehpower", "html_url": "https://github.com/chiehpower", "followers_url": "https://api.github.com/users/chiehpower/followers", "following_url": "https://api.github.com/users/chiehpower/following{/other_user}", "gists_url": "https://api.github.com/users/chiehpower/gists{/gist_id}", "starred_url": "https://api.github.com/users/chiehpower/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/chiehpower/subscriptions", "organizations_url": "https://api.github.com/users/chiehpower/orgs", "repos_url": "https://api.github.com/users/chiehpower/repos", "events_url": "https://api.github.com/users/chiehpower/events{/privacy}", "received_events_url": "https://api.github.com/users/chiehpower/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-03-05T01:25:09Z", "updated_at": "2020-03-06T02:33:10Z", "closed_at": "2020-03-06T02:33:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "I followed both instructions to install keras2onnx.  (I already tried these methods of pip install and install from source.)\r\n```\r\nBuilding wheels for collected packages: keras2onnx\r\n  Building wheel for keras2onnx (setup.py) ... done\r\n  Created wheel for keras2onnx: filename=keras2onnx-1.6.5-py3-none-any.whl size=91201 sha256=4f513cbe863b2a3b18f15ebc55a2692467c969e95eb12bccf17e3881f5f61c25\r\n  Stored in directory: /tmp/pip-ephem-wheel-cache-3enk0kv_/wheels/51/4f/28/887336f4f552370a09f70a60419f5af6f6202b71fe5999f612\r\nSuccessfully built keras2onnx\r\nInstalling collected packages: keras2onnx\r\n  Attempting uninstall: keras2onnx\r\n    Found existing installation: keras2onnx 1.6.0\r\n    Uninstalling keras2onnx-1.6.0:\r\n      Successfully uninstalled keras2onnx-1.6.0\r\nSuccessfully installed keras2onnx-1.6.5\r\n```\r\n\r\nWhen I test on python3, it cannot correctly import keras2onnx.\r\n```\r\n$ python3                                                              \r\nPython 3.6.9 (default, Nov  7 2019, 10:44:02) \r\n[GCC 8.3.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import keras2onnx\r\nUsing TensorFlow backend.\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/__init__.py\", line 34, in <module>\r\n    from .main import convert_keras\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/main.py\", line 12, in <module>\r\n    from .ke2onnx import static_set_ke2onnx_converters\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/ke2onnx/__init__.py\", line 6, in <module>\r\n    from .main import keras_layer_to_operator\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/ke2onnx/main.py\", line 151, in <module>\r\n    _layer.DepthwiseConv2D: convert_keras_depthwise_conv_2d,\r\nAttributeError: module 'keras.layers' has no attribute 'DepthwiseConv2D'\r\n```\r\nIs there any idea about this wrong?\r\nThanks in advanced.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/401", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/401/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/401/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/401/events", "html_url": "https://github.com/onnx/keras-onnx/issues/401", "id": 574125535, "node_id": "MDU6SXNzdWU1NzQxMjU1MzU=", "number": 401, "title": "support for tf.math.add_n", "user": {"login": "jusonn", "id": 20140126, "node_id": "MDQ6VXNlcjIwMTQwMTI2", "avatar_url": "https://avatars2.githubusercontent.com/u/20140126?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jusonn", "html_url": "https://github.com/jusonn", "followers_url": "https://api.github.com/users/jusonn/followers", "following_url": "https://api.github.com/users/jusonn/following{/other_user}", "gists_url": "https://api.github.com/users/jusonn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jusonn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jusonn/subscriptions", "organizations_url": "https://api.github.com/users/jusonn/orgs", "repos_url": "https://api.github.com/users/jusonn/repos", "events_url": "https://api.github.com/users/jusonn/events{/privacy}", "received_events_url": "https://api.github.com/users/jusonn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-03-02T17:21:31Z", "updated_at": "2020-03-09T21:50:27Z", "closed_at": "2020-03-09T21:50:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "tensorflow-onnx supports tf.math.add and tf.math.add_n in https://github.com/onnx/tensorflow-onnx/blob/master/support_status.md but keras-onnx doesn't\r\n\r\n when I convert AddN, an error occurs\r\n```\r\nnode lambda/AddN of type AddN cannot be converted, fall back to tf2onnx\r\nTraceback (most recent call last):\r\n  File \"build_model.py\", line 66, in <module>\r\n    onnx_model = keras2onnx.convert_keras(model, model.name)\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/main.py\", line 60, in convert_keras\r\n    parse_graph(topology, tf_graph, target_opset, output_names, output_dict)\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/parser.py\", line 794, in parse_graph\r\n    graph, keras_node_dict, topo, top_level, output_names)\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/parser.py\", line 595, in _parse_graph_core\r\n    _on_parsing_tf_subgraph(graph, nodes, varset)\r\n  File \"/usr/local/lib/python3.6/dist-packages/keras2onnx/parser.py\", line 335, in _on_parsing_tf_subgraph\r\n    raise RuntimeError(\"Some tensorflow operation doesn't support, stop converting.\")\r\nRuntimeError: Some tensorflow operation doesn't support, stop converting.\r\n```\r\nsince tf-onnx supports AddN, it can be easily supported in keras-onnx https://github.com/onnx/tensorflow-onnx/blob/ed3a41d91146116ab789b285be4fe86d56cc5004/tf2onnx/onnx_opset/reduction.py", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/392", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/392/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/392/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/392/events", "html_url": "https://github.com/onnx/keras-onnx/issues/392", "id": 570013756, "node_id": "MDU6SXNzdWU1NzAwMTM3NTY=", "number": 392, "title": "tensorflow 2.x.x support", "user": {"login": "mxdilln", "id": 42930462, "node_id": "MDQ6VXNlcjQyOTMwNDYy", "avatar_url": "https://avatars3.githubusercontent.com/u/42930462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mxdilln", "html_url": "https://github.com/mxdilln", "followers_url": "https://api.github.com/users/mxdilln/followers", "following_url": "https://api.github.com/users/mxdilln/following{/other_user}", "gists_url": "https://api.github.com/users/mxdilln/gists{/gist_id}", "starred_url": "https://api.github.com/users/mxdilln/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mxdilln/subscriptions", "organizations_url": "https://api.github.com/users/mxdilln/orgs", "repos_url": "https://api.github.com/users/mxdilln/repos", "events_url": "https://api.github.com/users/mxdilln/events{/privacy}", "received_events_url": "https://api.github.com/users/mxdilln/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-02-24T17:41:35Z", "updated_at": "2020-04-06T17:49:51Z", "closed_at": "2020-04-06T17:49:51Z", "author_association": "NONE", "active_lock_reason": null, "body": "Is there an estimate of when tensorflow 2 will be supported by the package? \r\n\r\nWhen trying to run \r\n```\r\nkeras2onnx.convert_keras()\r\n```\r\nwith `keras2onnx==1.6.0` and `tensorflow==2.1.0` on a tf.keras model, I get the following error:\r\n\r\n```\r\nRuntimeError: tf2onnx loading failed with the tensorflow package!\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/387", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/387/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/387/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/387/events", "html_url": "https://github.com/onnx/keras-onnx/issues/387", "id": 566586908, "node_id": "MDU6SXNzdWU1NjY1ODY5MDg=", "number": 387, "title": "The homepage's README has some errors", "user": {"login": "Zanderzt", "id": 39023807, "node_id": "MDQ6VXNlcjM5MDIzODA3", "avatar_url": "https://avatars3.githubusercontent.com/u/39023807?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Zanderzt", "html_url": "https://github.com/Zanderzt", "followers_url": "https://api.github.com/users/Zanderzt/followers", "following_url": "https://api.github.com/users/Zanderzt/following{/other_user}", "gists_url": "https://api.github.com/users/Zanderzt/gists{/gist_id}", "starred_url": "https://api.github.com/users/Zanderzt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Zanderzt/subscriptions", "organizations_url": "https://api.github.com/users/Zanderzt/orgs", "repos_url": "https://api.github.com/users/Zanderzt/repos", "events_url": "https://api.github.com/users/Zanderzt/events{/privacy}", "received_events_url": "https://api.github.com/users/Zanderzt/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-02-18T01:12:05Z", "updated_at": "2020-02-18T06:30:34Z", "closed_at": "2020-02-18T06:30:34Z", "author_association": "NONE", "active_lock_reason": null, "body": "Installing keras2onnx should be _pip install keras2onnx_ not _keras-onnx_.\r\nHope you can correct it because I tried keras-onnx at the beginning and couldn't find this package.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/385", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/385/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/385/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/385/events", "html_url": "https://github.com/onnx/keras-onnx/issues/385", "id": 566258238, "node_id": "MDU6SXNzdWU1NjYyNTgyMzg=", "number": 385, "title": "Keras TensorRT Incorrect Results", "user": {"login": "AsharFatmi", "id": 36506102, "node_id": "MDQ6VXNlcjM2NTA2MTAy", "avatar_url": "https://avatars0.githubusercontent.com/u/36506102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AsharFatmi", "html_url": "https://github.com/AsharFatmi", "followers_url": "https://api.github.com/users/AsharFatmi/followers", "following_url": "https://api.github.com/users/AsharFatmi/following{/other_user}", "gists_url": "https://api.github.com/users/AsharFatmi/gists{/gist_id}", "starred_url": "https://api.github.com/users/AsharFatmi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AsharFatmi/subscriptions", "organizations_url": "https://api.github.com/users/AsharFatmi/orgs", "repos_url": "https://api.github.com/users/AsharFatmi/repos", "events_url": "https://api.github.com/users/AsharFatmi/events{/privacy}", "received_events_url": "https://api.github.com/users/AsharFatmi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-02-17T12:11:56Z", "updated_at": "2020-08-03T07:03:36Z", "closed_at": "2020-02-18T11:50:48Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have a custom Keras Detection model [ From ALPR-unconstrained GitHub repo ], I am attaching a link to the model JSON file here:-\r\n\r\n[modelconfig.json](https://drive.google.com/open?id=1imGI8Kevnt2FQJR-UK63SCch6TluLWrc)\r\n\r\nI converted the Keras model to onnx using keras2onnx, Then used onnx_to_tensorrt.py to convert the model to the TRT engine.\r\n\r\n[onnx_to_tensorrt.py](https://gist.github.com/AsharFatmi/fea96d663c95ad08c4d8d873b18a0fed)\r\n\r\nThe output of the two models are not the same, so I cannot get the detection region.\r\n\r\n**Keras model output:-** \r\n\r\n```\r\n[[[ 5.35682165e-16  1.00000000e+00  1.02072847e+00 ... -2.07958460e-01\r\n    5.04563272e-01 -1.20855430e-02]\r\n  [ 8.77869645e-17  1.00000000e+00  7.72716165e-01 ... -1.96673796e-01\r\n    6.91386938e-01 -5.71288705e-01]\r\n  [ 1.62569552e-29  1.00000000e+00  1.13321781e+00 ... -1.17423847e-01\r\n    7.27890730e-01 -2.67761678e-01]\r\n  ...\r\n  [ 9.93481616e-11  1.00000000e+00  8.08987558e-01 ... -1.09358504e-01\r\n    3.96312863e-01 -3.76817733e-02]\r\n  [ 5.05836795e-08  1.00000000e+00  6.38040662e-01 ...  2.58072745e-03\r\n    4.28376526e-01 -3.47221732e-01]\r\n  [ 2.63872035e-09  1.00000000e+00  8.12149942e-01 ... -1.26684764e-02\r\n    1.86289668e-01 -6.14305809e-02]]\r\n\r\n [[ 1.15013890e-12  1.00000000e+00  1.06367087e+00 ... -5.53396583e-01\r\n    3.23190212e-01 -1.00925833e-01]\r\n  [ 7.17620210e-18  1.00000000e+00  8.54213297e-01 ...  4.44860458e-01\r\n   -6.65633440e-01 -1.41143531e-01]\r\n  [ 4.54133458e-24  1.00000000e+00  1.19984531e+00 ...  1.20644540e-01\r\n   -3.73397738e-01 -6.67934895e-01]\r\n  ...\r\n  [ 1.03462021e-08  1.00000000e+00  1.14307857e+00 ... -1.53487191e-01\r\n    2.21320093e-01 -2.01362371e-01]\r\n  [ 1.97145482e-08  1.00000000e+00  9.24914479e-01 ...  3.22847784e-01\r\n   -6.38035834e-02 -2.14298382e-01]\r\n  [ 1.70783192e-08  1.00000000e+00  9.65804636e-01 ...  4.09364104e-02\r\n    2.28743017e-01 -3.36741388e-01]]\r\n\r\n [[ 8.94335161e-11  1.00000000e+00  7.75921345e-01 ...  1.04476353e-02\r\n    1.51742458e-01  5.28428927e-02]\r\n  [ 9.04731773e-16  1.00000000e+00  4.41512674e-01 ...  1.06468916e-01\r\n   -8.99115801e-02  2.96098143e-01]\r\n  [ 2.10258343e-17  1.00000000e+00  2.47518599e-01 ...  7.37828463e-02\r\n   -1.92303687e-01  4.42358196e-01]\r\n  ...\r\n  [ 2.41078150e-16  1.00000000e+00  8.20632398e-01 ... -1.57306686e-01\r\n    1.35591239e-01 -4.33367584e-03]\r\n  [ 1.30340170e-13  1.00000000e+00  6.97541475e-01 ... -1.88214704e-01\r\n    8.80702883e-02 -1.52649814e-02]\r\n  [ 5.57648372e-09  1.00000000e+00  9.97833073e-01 ... -1.55004978e-01\r\n    2.76494384e-01 -6.27942905e-02]]\r\n\r\n ...\r\n\r\n [[ 0.00000000e+00  1.00000000e+00  8.85395885e-01 ...  3.80443633e-02\r\n    4.81112301e-01 -1.28768587e+00]\r\n  [ 0.00000000e+00  1.00000000e+00  1.00841582e+00 ... -2.23223472e+00\r\n   -3.39565903e-01 -5.87081552e-01]\r\n  [ 0.00000000e+00  1.00000000e+00  1.37934232e+00 ... -1.70936894e+00\r\n    2.07115859e-01 -2.22187567e+00]\r\n  ...\r\n  [ 2.83864250e-25  1.00000000e+00  1.45969176e+00 ... -7.09485292e-01\r\n    2.28834689e-01 -3.29626322e-01]\r\n  [ 1.24496172e-15  1.00000000e+00  1.31729507e+00 ... -6.66390240e-01\r\n    1.25542924e-01 -1.47483870e-01]\r\n  [ 2.48216048e-09  1.00000000e+00  1.15188110e+00 ... -1.47737026e-01\r\n    3.60481203e-01 -2.20017970e-01]]\r\n\r\n [[ 0.00000000e+00  1.00000000e+00  1.48687065e-01 ... -8.53215158e-01\r\n   -1.15160823e+00  8.59936476e-01]\r\n  [ 0.00000000e+00  1.00000000e+00  6.86580241e-01 ...  2.05904245e-02\r\n    3.43396455e-01 -6.00309968e-01]\r\n  [ 0.00000000e+00  1.00000000e+00 -1.29906058e-01 ...  8.33660722e-01\r\n    6.93807364e-01  5.96281648e-01]\r\n  ...\r\n  [ 2.00734995e-30  1.00000000e+00  8.45168352e-01 ...  4.50236648e-02\r\n    3.50932181e-01 -7.83286393e-02]\r\n  [ 2.55876199e-19  1.00000000e+00  9.60333586e-01 ...  2.57166326e-02\r\n    5.82121909e-02 -9.72378105e-02]\r\n  [ 4.64498925e-12  1.00000000e+00  9.78434443e-01 ...  6.36013597e-02\r\n    3.79364163e-01 -3.65832038e-02]]\r\n\r\n [[ 0.00000000e+00  1.00000000e+00 -1.19233370e-01 ... -3.39587510e-01\r\n    8.02178085e-02  1.38728428e+00]\r\n  [ 0.00000000e+00  1.00000000e+00 -2.54251719e-01 ...  9.89254951e-01\r\n   -1.02365923e+00  1.74043214e+00]\r\n  [ 0.00000000e+00  1.00000000e+00  6.75196886e-01 ...  1.14767244e-02\r\n    8.67833734e-01  5.49621701e-01]\r\n  ...\r\n  [ 1.01715141e-30  1.00000000e+00  1.23101699e+00 ... -3.87017936e-01\r\n    1.34929419e-01  1.46293178e-01]\r\n  [ 5.34217413e-22  1.00000000e+00  1.08855963e+00 ... -6.93247654e-04\r\n    1.25452936e-01  7.26785064e-02]\r\n  [ 2.12459472e-13  1.00000000e+00  9.25891340e-01 ... -5.17582297e-02\r\n    1.55512884e-01 -1.80828243e-01]]]\r\n```\r\n\r\n\r\n**TensorRT model OUTPUT:-**\r\n\r\n`[  0.0000000e+00 1.0000000e+00 6.4158699e+01 ... -3.4338876e+02 -1.2911737e+03 4.0990738e+02]`\r\n\r\nAny idea how to solve this?\r\n\r\nThanks in advance\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/384", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/384/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/384/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/384/events", "html_url": "https://github.com/onnx/keras-onnx/issues/384", "id": 565992765, "node_id": "MDU6SXNzdWU1NjU5OTI3NjU=", "number": 384, "title": "There is an error(<class 'AssertionError'>) happened during optimizing on the converted model!", "user": {"login": "tpengti", "id": 15311496, "node_id": "MDQ6VXNlcjE1MzExNDk2", "avatar_url": "https://avatars0.githubusercontent.com/u/15311496?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tpengti", "html_url": "https://github.com/tpengti", "followers_url": "https://api.github.com/users/tpengti/followers", "following_url": "https://api.github.com/users/tpengti/following{/other_user}", "gists_url": "https://api.github.com/users/tpengti/gists{/gist_id}", "starred_url": "https://api.github.com/users/tpengti/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tpengti/subscriptions", "organizations_url": "https://api.github.com/users/tpengti/orgs", "repos_url": "https://api.github.com/users/tpengti/repos", "events_url": "https://api.github.com/users/tpengti/events{/privacy}", "received_events_url": "https://api.github.com/users/tpengti/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-02-16T23:51:25Z", "updated_at": "2020-03-13T16:21:17Z", "closed_at": "2020-03-13T16:21:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "my code:\r\ndef center_weighted_mse_loss(y_true, y_pred):\r\n    mask = K.random_normal(K.shape(y_true))\r\n    mask = K.cast(K.greater(mask, 0.8), 'float32')\r\n    # weigh the center more\r\n    radius=8\r\n    center = np.zeros((K.int_shape(y_pred)[1],K.int_shape(y_pred)[2],1))\r\n    center[K.int_shape(y_pred)[1] // 2 - radius : K.int_shape(y_pred)[1] // 2 + radius,\r\n          K.int_shape(y_pred)[2] // 2 - radius : K.int_shape(y_pred)[2]// 2 + radius,:] = 1\r\n    center =  mask + 10*K.variable(center)\r\n    return K.mean(center * K.square(y_pred - y_true), axis=-1)\r\nclass L2_Normalization_Layer(keras.engine.Layer):\r\n    '''\r\n        This layer does L2 Normalization.\r\n    '''\r\n    def __init__(self, **kwargs):\r\n        self.scale = True\r\n        super(L2_Normalization_Layer, self).__init__(**kwargs)\r\n\r\n    def compute_output_shape(self, input_shape):\r\n        return input_shape\r\n\r\n    def build(self, input_shape):\r\n        if self.scale:\r\n            self.alpha = self.add_weight(shape=[1, ],\r\n                                         name='alpha',\r\n                                         initializer=keras.initializers.RandomUniform(minval=10.0, maxval=20.0, seed=None))\r\n        else:\r\n            self.alpha = 1.0\r\n\r\n    def call(self, x):\r\n        return self.alpha * keras.backend.l2_normalize(x, -1)\r\n\r\n\r\nmodel = load_model('/home/aistudio/work/cnn/pretrained_gmn.h5', custom_objects={'L2_Normalization_Layer': L2_Normalization_Layer, 'center_weighted_mse_loss': center_weighted_mse_loss})\r\n#model = load_model('/home/aistudio/work/cnn/pretrained_gmn.h5')  \r\nonnx_model = keras2onnx.convert_keras(model, model.name)\r\ntemp_model_file = '/home/aistudio/work/cnn/pretrained_gmn.onnx'\r\nonnx.save_model(onnx_model, temp_model_file)\r\n\r\n\r\nPerform conversion output information\uff1a\r\n\r\nThe tf.op node image_f_l2/l2_normalize/Square of type Square cannot be converted\r\nThe tf.op node exemplar_l2/l2_normalize/Square of type Square cannot be converted\r\nThere is an error(<class 'AssertionError'>) happened during optimizing on the converted model!\r\n\r\nTraceback (most recent call last):\r\n  File \"/opt/conda/envs/py6/lib/python3.6/site-packages/keras2onnx/topology.py\", line 305, in convert_topology\r\n    outputs=container.outputs)\r\n  File \"/opt/conda/envs/py6/lib/python3.6/site-packages/onnxconverter_common/optimizer.py\", line 915, in optimize_onnx\r\n    [] if outputs is None else [o_.name for o_ in outputs])\r\n  File \"/opt/conda/envs/py6/lib/python3.6/site-packages/onnxconverter_common/optimizer.py\", line 269, in build_from_onnx\r\n    assert var_ == '' or var_ in inputs\r\nAssertionError\r\n\r\nLooking forward for your response, thank you\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/382", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/382/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/382/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/382/events", "html_url": "https://github.com/onnx/keras-onnx/issues/382", "id": 565027712, "node_id": "MDU6SXNzdWU1NjUwMjc3MTI=", "number": 382, "title": "Output is different before and after model converted", "user": {"login": "WenyuZhu", "id": 21376521, "node_id": "MDQ6VXNlcjIxMzc2NTIx", "avatar_url": "https://avatars2.githubusercontent.com/u/21376521?v=4", "gravatar_id": "", "url": "https://api.github.com/users/WenyuZhu", "html_url": "https://github.com/WenyuZhu", "followers_url": "https://api.github.com/users/WenyuZhu/followers", "following_url": "https://api.github.com/users/WenyuZhu/following{/other_user}", "gists_url": "https://api.github.com/users/WenyuZhu/gists{/gist_id}", "starred_url": "https://api.github.com/users/WenyuZhu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/WenyuZhu/subscriptions", "organizations_url": "https://api.github.com/users/WenyuZhu/orgs", "repos_url": "https://api.github.com/users/WenyuZhu/repos", "events_url": "https://api.github.com/users/WenyuZhu/events{/privacy}", "received_events_url": "https://api.github.com/users/WenyuZhu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2020-02-14T00:20:32Z", "updated_at": "2020-02-21T17:21:27Z", "closed_at": "2020-02-21T17:21:27Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to convert a pretrained ResNet50 model to onnx model for my UWP application. As WinML required, the input image format has to be 'channels_first', so I set set_image_data_format in Keras beackend as 'channels_first'. \r\n`K.set_image_data_format('channels_first')`\r\nThen, pretrained ResNet50 model is loaded:\r\n`from keras.applications.resnet50 import ResNet50\r\nmodel = ResNet50(include_top=True, weights='imagenet')`\r\nLoad the test image:\r\n`image_path = \"predictTest.jpg\"`\r\n`img = image.load_img(image_path, target_size=(img_width, img_height))`\r\n`data = image.img_to_array(img)`\r\n`plt.imshow(img)`\r\n`data = np.expand_dims(data, axis=0)`\r\n`data = preprocess_input(data, data_format= 'channels_first')`\r\n`result = model.predict(data)`\r\n`print(result)`\r\n`plt.title(result)`\r\n`plt.show()`\r\n\r\nConvert the model to onnx and predict:\r\n`onnx_model = keras2onnx.convert_keras(model, model.name)`\r\n`runtime prediction`\r\n`content = onnx_model.SerializeToString()`\r\n`sess = onnxruntime.InferenceSession(content)`\r\n`data = data if isinstance(data, list) else [data]`\r\n`feed = dict([(input.name, data[n]) for n, input in enumerate(sess.get_inputs())])`\r\n`pred_onnx = sess.run(None, feed)`\r\n`print(pred_onnx)`\r\nI compared the result from Keras and onnx, They are not exactly the same.\r\n\r\nKeras:\r\n\r\n> [5.4314226e-04 5.9276802e-04 5.7217164e-04 4.9989636e-04 6.7251432e-04 ......]\r\n\r\nOnnx:\r\n\r\n> [4.46889459e-08, 3.85216566e-07, 3.61494085e-06, 5.48398518e-08, ......]\r\n\r\nAlso, I tried to replace the output layer with a 5-output 'softmax' layer, because I only need 5 classes, the output value became digital, and it's different from the result from Keras model before it's converted.\r\nKeras:\r\n\r\n> [[0.19099472 0.27407214 0.13260843 0.13774054 0.26458415]]\r\n\r\nOnnx:\r\n\r\n> [[0.0000000e+00 9.9999762e-01 0.0000000e+00 0.0000000e+00 2.4337219e-06]]\r\n\r\nDid I do anything wrong here?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/379", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/379/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/379/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/379/events", "html_url": "https://github.com/onnx/keras-onnx/issues/379", "id": 564097403, "node_id": "MDU6SXNzdWU1NjQwOTc0MDM=", "number": 379, "title": "Version 1.6.5 is not available at https://pypi.org/project/keras2onnx/#history", "user": {"login": "dmo2000", "id": 39318604, "node_id": "MDQ6VXNlcjM5MzE4NjA0", "avatar_url": "https://avatars2.githubusercontent.com/u/39318604?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dmo2000", "html_url": "https://github.com/dmo2000", "followers_url": "https://api.github.com/users/dmo2000/followers", "following_url": "https://api.github.com/users/dmo2000/following{/other_user}", "gists_url": "https://api.github.com/users/dmo2000/gists{/gist_id}", "starred_url": "https://api.github.com/users/dmo2000/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dmo2000/subscriptions", "organizations_url": "https://api.github.com/users/dmo2000/orgs", "repos_url": "https://api.github.com/users/dmo2000/repos", "events_url": "https://api.github.com/users/dmo2000/events{/privacy}", "received_events_url": "https://api.github.com/users/dmo2000/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-02-12T15:59:45Z", "updated_at": "2020-06-20T18:35:47Z", "closed_at": "2020-06-20T18:35:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to install version 1.6.5 of this library but it is not available at https://pypi.org/project/keras2onnx/#history.\r\n\r\nShould I add another package manager in my system?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/378", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/378/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/378/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/378/events", "html_url": "https://github.com/onnx/keras-onnx/issues/378", "id": 564062318, "node_id": "MDU6SXNzdWU1NjQwNjIzMTg=", "number": 378, "title": "tf.keras trained on a GPU", "user": {"login": "mxdilln", "id": 42930462, "node_id": "MDQ6VXNlcjQyOTMwNDYy", "avatar_url": "https://avatars3.githubusercontent.com/u/42930462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mxdilln", "html_url": "https://github.com/mxdilln", "followers_url": "https://api.github.com/users/mxdilln/followers", "following_url": "https://api.github.com/users/mxdilln/following{/other_user}", "gists_url": "https://api.github.com/users/mxdilln/gists{/gist_id}", "starred_url": "https://api.github.com/users/mxdilln/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mxdilln/subscriptions", "organizations_url": "https://api.github.com/users/mxdilln/orgs", "repos_url": "https://api.github.com/users/mxdilln/repos", "events_url": "https://api.github.com/users/mxdilln/events{/privacy}", "received_events_url": "https://api.github.com/users/mxdilln/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-02-12T15:06:31Z", "updated_at": "2020-02-19T08:56:33Z", "closed_at": "2020-02-19T08:56:32Z", "author_association": "NONE", "active_lock_reason": null, "body": "Are tf.keras models trained on a GPU supported?\r\n\r\nI am training the below model on a Tesla V100-SXM2-16GB GPU:\r\n\r\n```\r\n        self.model = tf.keras.models.Sequential([\r\n            tf.keras.layers.Flatten(input_shape=(28, 28, 1)),\r\n            tf.keras.layers.Dense(128, activation=\"relu\"),\r\n            tf.keras.layers.Dropout(0.2),\r\n            tf.keras.layers.Dense(10, activation=\"softmax\"),\r\n        ])\r\n\r\n        self.model.compile(optimizer=\"adam\",\r\n                           loss=\"sparse_categorical_crossentropy\",\r\n                           metrics=[\"accuracy\"])\r\n``` \r\n\r\nand it is successfully converting to onnx using: \r\n\r\n```\r\nonnx_model = keras2onnx.convert_keras(self.model)\r\nonnx.save_model(onnx_model, \"model.onnx\")\r\n```\r\n\r\nhowever when trying to load the model for inference, using:\r\n\r\n```model = onnx.load(\"model.onnx\")```\r\n\r\nI get the following error:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File xxx, line 19, in __init__\r\n    model = onnx.load(\"model.onnx\")\r\n  File \"xxx/venv/lib/python3.7/site-packages/onnx/__init__.py\", line 115, in load_model\r\n    model = load_model_from_string(s, format=format)\r\n  File \"xxx/venv/lib/python3.7/site-packages/onnx/__init__.py\", line 152, in load_model_from_string\r\n    return _deserialize(s, ModelProto())\r\n  File \"xxx/venv/lib/python3.7/site-packages/onnx/__init__.py\", line 95, in _deserialize\r\n    decoded = cast(Optional[int], proto.ParseFromString(s))\r\ngoogle.protobuf.message.DecodeError: Error parsing message\r\n```\r\n\r\nA very similar process has worked successfully when training on a CPU, so I am wondering if this has something to do with the model being trained on a GPU? \r\n\r\nI note that I previously had an issue (https://github.com/onnx/keras-onnx/issues/181) where (unsupported) CUDA layers were successfully converting to onnx using this package but then failing to load when I wanted to run inference.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/373", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/373/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/373/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/373/events", "html_url": "https://github.com/onnx/keras-onnx/issues/373", "id": 562165172, "node_id": "MDU6SXNzdWU1NjIxNjUxNzI=", "number": 373, "title": "module 'keras2onnx' has no attribute 'save_model'", "user": {"login": "AsharFatmi", "id": 36506102, "node_id": "MDQ6VXNlcjM2NTA2MTAy", "avatar_url": "https://avatars0.githubusercontent.com/u/36506102?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AsharFatmi", "html_url": "https://github.com/AsharFatmi", "followers_url": "https://api.github.com/users/AsharFatmi/followers", "following_url": "https://api.github.com/users/AsharFatmi/following{/other_user}", "gists_url": "https://api.github.com/users/AsharFatmi/gists{/gist_id}", "starred_url": "https://api.github.com/users/AsharFatmi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AsharFatmi/subscriptions", "organizations_url": "https://api.github.com/users/AsharFatmi/orgs", "repos_url": "https://api.github.com/users/AsharFatmi/repos", "events_url": "https://api.github.com/users/AsharFatmi/events{/privacy}", "received_events_url": "https://api.github.com/users/AsharFatmi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-02-09T11:56:31Z", "updated_at": "2020-06-08T07:53:46Z", "closed_at": "2020-02-10T05:51:33Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to convert my keras model to Onnx to eventually make a TensorRT engine for inference.\r\n\r\nI followed the documentation in this repo README.md.\r\n\r\nCODE:-\r\n\r\n```\r\nimport keras2onnx\r\nimport onnxruntime\r\nfrom src.keras_utils import load_model\r\n\r\nmodel = load_model('/home/kingashar/Downloads/models_and_configs/lp_detector/uae-1392_final.h5')\r\n\r\nonnx_model = keras2onnx.convert_keras(model, name=None, doc_string='', target_opset=None, channel_first_inputs=None)\r\n\r\n\r\ntemp_model_file = 'keras_model.onnx'\r\nkeras2onnx.save_model(onnx_model, temp_model_file)\r\nsess = onnxruntime.InferenceSession(temp_model_file)\r\nprint('DONE')\r\n```\r\n\r\nI am getting the following error:- \r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"keras_to_onnx.py\", line 11, in <module>\r\n    keras2onnx.save_model(onnx_model, temp_model_file)\r\nAttributeError: module 'keras2onnx' has no attribute 'save_model'\r\n\r\n```\r\n\r\n\r\n```\r\nVERSION:-\r\nkeras2onnx              1.6.0\r\ntensorflow-gpu          1.14.0\r\nKeras                   2.2.4\r\nonnxruntime             1.1.1 \r\nonnx                    1.6.0\r\n```\r\nIt seems save_model is not a function here....\r\n\r\nAny clue??", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/359", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/359/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/359/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/359/events", "html_url": "https://github.com/onnx/keras-onnx/issues/359", "id": 553474494, "node_id": "MDU6SXNzdWU1NTM0NzQ0OTQ=", "number": 359, "title": "TensorFlow 2.1.0 not supported", "user": {"login": "xadupre", "id": 22452781, "node_id": "MDQ6VXNlcjIyNDUyNzgx", "avatar_url": "https://avatars1.githubusercontent.com/u/22452781?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xadupre", "html_url": "https://github.com/xadupre", "followers_url": "https://api.github.com/users/xadupre/followers", "following_url": "https://api.github.com/users/xadupre/following{/other_user}", "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}", "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions", "organizations_url": "https://api.github.com/users/xadupre/orgs", "repos_url": "https://api.github.com/users/xadupre/repos", "events_url": "https://api.github.com/users/xadupre/events{/privacy}", "received_events_url": "https://api.github.com/users/xadupre/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-01-22T11:18:31Z", "updated_at": "2020-01-31T02:01:34Z", "closed_at": "2020-01-31T02:01:34Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Tensorflow 2.1.0 was added to CI in PR #358 and it fails.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/356", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/356/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/356/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/356/events", "html_url": "https://github.com/onnx/keras-onnx/issues/356", "id": 552214278, "node_id": "MDU6SXNzdWU1NTIyMTQyNzg=", "number": 356, "title": "Do we know layer/weight/input/output correspondance between keras model and the onnx model", "user": {"login": "atemysemicolon", "id": 3224332, "node_id": "MDQ6VXNlcjMyMjQzMzI=", "avatar_url": "https://avatars0.githubusercontent.com/u/3224332?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atemysemicolon", "html_url": "https://github.com/atemysemicolon", "followers_url": "https://api.github.com/users/atemysemicolon/followers", "following_url": "https://api.github.com/users/atemysemicolon/following{/other_user}", "gists_url": "https://api.github.com/users/atemysemicolon/gists{/gist_id}", "starred_url": "https://api.github.com/users/atemysemicolon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atemysemicolon/subscriptions", "organizations_url": "https://api.github.com/users/atemysemicolon/orgs", "repos_url": "https://api.github.com/users/atemysemicolon/repos", "events_url": "https://api.github.com/users/atemysemicolon/events{/privacy}", "received_events_url": "https://api.github.com/users/atemysemicolon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2020-01-20T10:38:11Z", "updated_at": "2020-06-29T00:57:40Z", "closed_at": "2020-06-29T00:57:40Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am currently trying to convert a keras model to an onnx model. Inferring on the onnx model seems to be quite different (visually) than the keras model.\r\n\r\nIs there some kind of layer correspondence, so I can compare keras outputs after that layer with onnx outputs after that layer?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/344", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/344/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/344/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/344/events", "html_url": "https://github.com/onnx/keras-onnx/issues/344", "id": 549702744, "node_id": "MDU6SXNzdWU1NDk3MDI3NDQ=", "number": 344, "title": "Yolov3: INVALID_GRAPH : This is an invalid model", "user": {"login": "AndresOsp", "id": 31508327, "node_id": "MDQ6VXNlcjMxNTA4MzI3", "avatar_url": "https://avatars3.githubusercontent.com/u/31508327?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AndresOsp", "html_url": "https://github.com/AndresOsp", "followers_url": "https://api.github.com/users/AndresOsp/followers", "following_url": "https://api.github.com/users/AndresOsp/following{/other_user}", "gists_url": "https://api.github.com/users/AndresOsp/gists{/gist_id}", "starred_url": "https://api.github.com/users/AndresOsp/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AndresOsp/subscriptions", "organizations_url": "https://api.github.com/users/AndresOsp/orgs", "repos_url": "https://api.github.com/users/AndresOsp/repos", "events_url": "https://api.github.com/users/AndresOsp/events{/privacy}", "received_events_url": "https://api.github.com/users/AndresOsp/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-01-14T17:08:41Z", "updated_at": "2020-01-16T18:28:45Z", "closed_at": "2020-01-16T18:28:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "If I use the Yolov3 script from: [keras-yolo3](https://github.com/qqwweee/keras-yolo3) Then, I transform the model to onnx IT WORKS. However, the output of that model does not have the evaluation layer nor the non max suppression layer. Then post-processing should be applied.\r\n\r\nIn this repository the [test](https://github.com/onnx/keras-onnx/blob/master/applications/nightly_build/test_yolov3.py) and the [script for yolov3](https://github.com/onnx/keras-onnx/tree/master/applications/yolov3). That in my understanding are complementary. When I run the test it gives me the following error:\r\n\r\n```\r\nERROR: test_yolov3 (__main__.TestYoloV3)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"yolo2onnx2.py\", line 90, in test_yolov3\r\n    sess = onnxruntime.InferenceSession(temp_model_file)\r\n  File \"/usr/local/lib/python3.6/dist-packages/onnxruntime/capi/session.py\", line 25, in __init__\r\n    self._load_model(providers)\r\n  File \"/usr/local/lib/python3.6/dist-packages/onnxruntime/capi/session.py\", line 43, in _load_model\r\n    self._sess.load_model(providers)\r\nonnxruntime.capi.onnxruntime_pybind11_state.InvalidGraph: [ONNXRuntimeError] : 10 : INVALID_GRAPH : This is an invalid model. Error in Node:TFNodes/yolo_evaluation_layer_1/add_2 : No Op registered for AddV2 with domain_version of 11\r\n```\r\nApparently the operations in the evaluation layer are not implemented?, if that is the case how the test could be working?\r\n\r\nHope that I made some mistake (it would run much faster with the integrated evaluation)\r\n\r\nThanks for the help", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/339", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/339/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/339/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/339/events", "html_url": "https://github.com/onnx/keras-onnx/issues/339", "id": 547640485, "node_id": "MDU6SXNzdWU1NDc2NDA0ODU=", "number": 339, "title": "Assertion Error when converting simple tf.keras model to onnx", "user": {"login": "mxdillon", "id": 21124420, "node_id": "MDQ6VXNlcjIxMTI0NDIw", "avatar_url": "https://avatars1.githubusercontent.com/u/21124420?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mxdillon", "html_url": "https://github.com/mxdillon", "followers_url": "https://api.github.com/users/mxdillon/followers", "following_url": "https://api.github.com/users/mxdillon/following{/other_user}", "gists_url": "https://api.github.com/users/mxdillon/gists{/gist_id}", "starred_url": "https://api.github.com/users/mxdillon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mxdillon/subscriptions", "organizations_url": "https://api.github.com/users/mxdillon/orgs", "repos_url": "https://api.github.com/users/mxdillon/repos", "events_url": "https://api.github.com/users/mxdillon/events{/privacy}", "received_events_url": "https://api.github.com/users/mxdillon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2020-01-09T18:16:28Z", "updated_at": "2020-01-11T22:52:44Z", "closed_at": "2020-01-11T22:52:44Z", "author_association": "NONE", "active_lock_reason": null, "body": "**Describe the bug**\r\nWhen converting a simple tf.keras model to onnx, the following error appears:\r\n\r\n```There is an error(<class 'AssertionError'>) happened during optimizing on the converted model!```\r\n\r\nDespite the error, the model does convert and save, but when checking the saved model with `onnx.checker.check_model(model)`, the following error is given:\r\n\r\n`onnx.onnx_cpp2py_export.checker.ValidationError: Nodes in a graph must be topologically sorted, however input 'sequential/dense_1/Softmax:0' of node: \r\ninput: \"sequential/dense_1/Softmax:0\" output: \"output_1\" name: \"Identity7\" op_type: \"Identity\" domain: \"\"\r\n is not output of any previous nodes.`\r\n\r\nThis might be relevant to the issue?\r\n\r\n**Urgency**\r\n\r\n\r\n**System information**\r\n- OS Platform and Distribution (e.g., Linux Ubuntu 16.04): macOS 10.15.2\r\n- onnx version: 1.6.0\r\n- keras2onnx version: 1.6.0\r\n- Python version: 3.7.2 64-bit\r\n- Visual Studio version (if applicable): Version: 1.41.1\r\nCommit: 26076a4de974ead31f97692a0d32f90d735645c0\r\nDate: 2019-12-18T14:57:51.166Z\r\nElectron: 6.1.5\r\nChrome: 76.0.3809.146\r\nNode.js: 12.4.0\r\nV8: 7.6.303.31-electron.0\r\nOS: Darwin x64 19.2.0\r\n\r\n- CUDA/cuDNN version: na\r\n- GPU model and memory: na\r\n\r\n**To Reproduce**\r\nError reproduced with the following code and packages:\r\n\r\n```\r\nonnx==1.6.0\r\nkeras2onnx==1.6.0\r\ntensorflow==1.15.0\r\nonnxruntime==1.1.0\r\n```\r\n\r\n```\r\nimport os\r\nimport tensorflow as tf\r\nimport keras2onnx\r\nimport onnx\r\nimport onnxruntime\r\n\r\nmnist = tf.keras.datasets.mnist\r\n(x_train, y_train), (x_test, y_test) = mnist.load_data()\r\nx_train, x_test = x_train / 255.0, x_test / 255.0\r\nx_train = x_train[..., tf.newaxis]\r\nx_test = x_test[..., tf.newaxis]\r\n\r\n\r\ntrain_ds = (\r\n    tf.data.Dataset.from_tensor_slices((x_train, y_train)).shuffle(10000).batch(32)\r\n)\r\ntest_ds = tf.data.Dataset.from_tensor_slices((x_test, y_test)).batch(32)\r\n\r\nmodel = tf.keras.models.Sequential(\r\n    [\r\n        tf.keras.layers.Flatten(),\r\n        tf.keras.layers.Dense(128, activation=\"relu\"),\r\n        tf.keras.layers.Dropout(0.2),\r\n        tf.keras.layers.Dense(10, activation=\"softmax\"),\r\n    ]\r\n)\r\n\r\nmodel.compile(\r\n    optimizer=\"adam\", loss=\"sparse_categorical_crossentropy\", metrics=[\"accuracy\"]\r\n)\r\n\r\nhistory = model.fit(train_ds, epochs=1)\r\n\r\nonnx_model = keras2onnx.convert_keras(model)\r\nonnx.save_model(onnx_model, 'model_keras.onnx')\r\n\r\nmodel = onnx.load(\"model_keras.onnx\")\r\nonnx.checker.check_model(model)\r\n\r\n```\r\n\r\n**Expected behavior**\r\nExpected the model to convert without errors and then run in an onnxruntime session\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/337", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/337/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/337/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/337/events", "html_url": "https://github.com/onnx/keras-onnx/issues/337", "id": 547002918, "node_id": "MDU6SXNzdWU1NDcwMDI5MTg=", "number": 337, "title": "onnx.optimizer.optimize fails on converted ResNet50", "user": {"login": "uncommoncode", "id": 2756812, "node_id": "MDQ6VXNlcjI3NTY4MTI=", "avatar_url": "https://avatars1.githubusercontent.com/u/2756812?v=4", "gravatar_id": "", "url": "https://api.github.com/users/uncommoncode", "html_url": "https://github.com/uncommoncode", "followers_url": "https://api.github.com/users/uncommoncode/followers", "following_url": "https://api.github.com/users/uncommoncode/following{/other_user}", "gists_url": "https://api.github.com/users/uncommoncode/gists{/gist_id}", "starred_url": "https://api.github.com/users/uncommoncode/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/uncommoncode/subscriptions", "organizations_url": "https://api.github.com/users/uncommoncode/orgs", "repos_url": "https://api.github.com/users/uncommoncode/repos", "events_url": "https://api.github.com/users/uncommoncode/events{/privacy}", "received_events_url": "https://api.github.com/users/uncommoncode/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-01-08T17:31:00Z", "updated_at": "2020-03-13T16:21:45Z", "closed_at": "2020-03-13T16:21:45Z", "author_association": "NONE", "active_lock_reason": null, "body": "\r\n\r\n# Error\r\n\r\nI'm attempting to use the onnx optimizer on the example ResNet50 network in Keras.\r\n\r\nHowever despite the onnx checker succeeding on a model loaded by keras2onnx, the optimizer fails.\r\n\r\nThe error message I get fails somewhere in the C++ code running the onnx optimizer:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"test_onnx_optimize.py\", line 9, in <module>\r\n    optimized_model = onnx.optimizer.optimize(onnx_model)\r\n  File \"venv/lib/python3.7/site-packages/onnx/optimizer.py\", line 55, in optimize\r\n    optimized_model_str = C.optimize(model_str, passes)\r\nIndexError: unordered_map::at: key not found\r\n```\r\n# Steps to Reproduce\r\n\r\nThis code reproduces the issue:\r\n\r\n```\r\nimport keras2onnx\r\nimport onnx\r\nimport onnx.optimizer\r\nfrom keras.applications.resnet50 import ResNet50\r\n\r\nmodel = ResNet50(include_top=True, weights='imagenet')\r\nonnx_model = keras2onnx.convert_keras(model, model.name)\r\nonnx.checker.check_model(onnx_model)\r\noptimized_model = onnx.optimizer.optimize(onnx_model)\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/332", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/332/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/332/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/332/events", "html_url": "https://github.com/onnx/keras-onnx/issues/332", "id": 544500973, "node_id": "MDU6SXNzdWU1NDQ1MDA5NzM=", "number": 332, "title": " yolov3  Inputs error", "user": {"login": "devinhee", "id": 33142826, "node_id": "MDQ6VXNlcjMzMTQyODI2", "avatar_url": "https://avatars2.githubusercontent.com/u/33142826?v=4", "gravatar_id": "", "url": "https://api.github.com/users/devinhee", "html_url": "https://github.com/devinhee", "followers_url": "https://api.github.com/users/devinhee/followers", "following_url": "https://api.github.com/users/devinhee/following{/other_user}", "gists_url": "https://api.github.com/users/devinhee/gists{/gist_id}", "starred_url": "https://api.github.com/users/devinhee/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/devinhee/subscriptions", "organizations_url": "https://api.github.com/users/devinhee/orgs", "repos_url": "https://api.github.com/users/devinhee/repos", "events_url": "https://api.github.com/users/devinhee/events{/privacy}", "received_events_url": "https://api.github.com/users/devinhee/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-01-02T09:20:21Z", "updated_at": "2020-01-04T06:31:12Z", "closed_at": "2020-01-04T06:31:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "when I tried to test yolov3. an error occurred.\r\n\"../keras_onnx/keras2onnx/common/interim.py\", line 134, in add_node\r\nraise ValueError('Inputs must be a list of string but get [%s]' % type_list)\r\nValueError: Inputs must be a list of string but get [<class 'list'>,<class 'str'>]\r\n\"\r\nthen I print \"Inputs\", they are not always one-dimensionnal, sometime Inputs like this:\r\n\" [['yolo_evaluation_layer_1/mul_5:0'], 'shape_tensor'] \"\r\nso I tried to flatten them into one-dimensional, but it didn't work, there were some new errors occurred. \r\nthe \"desired_shape\" got a string after \"inputs: ['yolo_evaluation_layer_1/Reshape_3/shape:0']\"\r\n\r\nNow I'm a little confused, there isn't any chance to make a change yet. \r\nIs this caused by my input image? (I just input the \"data/street.jpg\" )\r\nAny suggestion?\r\nThank your!\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/325", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/325/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/325/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/325/events", "html_url": "https://github.com/onnx/keras-onnx/issues/325", "id": 542402688, "node_id": "MDU6SXNzdWU1NDI0MDI2ODg=", "number": 325, "title": "RuntimeError: Unsupported activation method within Activation layer '<function relu6 at 0x7f0c5dfe03b0>'", "user": {"login": "Royzon", "id": 36632724, "node_id": "MDQ6VXNlcjM2NjMyNzI0", "avatar_url": "https://avatars1.githubusercontent.com/u/36632724?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Royzon", "html_url": "https://github.com/Royzon", "followers_url": "https://api.github.com/users/Royzon/followers", "following_url": "https://api.github.com/users/Royzon/following{/other_user}", "gists_url": "https://api.github.com/users/Royzon/gists{/gist_id}", "starred_url": "https://api.github.com/users/Royzon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Royzon/subscriptions", "organizations_url": "https://api.github.com/users/Royzon/orgs", "repos_url": "https://api.github.com/users/Royzon/repos", "events_url": "https://api.github.com/users/Royzon/events{/privacy}", "received_events_url": "https://api.github.com/users/Royzon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-12-26T01:24:53Z", "updated_at": "2020-01-31T02:02:27Z", "closed_at": "2020-01-31T02:02:26Z", "author_association": "NONE", "active_lock_reason": null, "body": "I meet this problem when I run the [test_segnet.py](https://github.com/onnx/keras-onnx/blob/master/applications/nightly_build/test_segnet.py). what makes me Incomprehensible is that you said the latest version of keras supports relu6 [here](https://github.com/onnx/keras-onnx/issues/316#issuecomment-567621840)\uff0cso why does this problem still occur? here is my config information:\r\nkeras=2.3.1\r\nkears2onnx=1.6.0\r\nonnxruntime=1.1.0\r\nonnx=1.6.0\r\nonnxconverter-common=1.6.1", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/324", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/324/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/324/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/324/events", "html_url": "https://github.com/onnx/keras-onnx/issues/324", "id": 542240857, "node_id": "MDU6SXNzdWU1NDIyNDA4NTc=", "number": 324, "title": "RuntimeError: [ONNXRuntimeError] : 10 : INVALID_GRAPH : This is an invalid model. Error in Node:Pad : Node (Pad) has input size 3 not in range [min=1, max=1].", "user": {"login": "Royzon", "id": 36632724, "node_id": "MDQ6VXNlcjM2NjMyNzI0", "avatar_url": "https://avatars1.githubusercontent.com/u/36632724?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Royzon", "html_url": "https://github.com/Royzon", "followers_url": "https://api.github.com/users/Royzon/followers", "following_url": "https://api.github.com/users/Royzon/following{/other_user}", "gists_url": "https://api.github.com/users/Royzon/gists{/gist_id}", "starred_url": "https://api.github.com/users/Royzon/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Royzon/subscriptions", "organizations_url": "https://api.github.com/users/Royzon/orgs", "repos_url": "https://api.github.com/users/Royzon/repos", "events_url": "https://api.github.com/users/Royzon/events{/privacy}", "received_events_url": "https://api.github.com/users/Royzon/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-12-25T02:59:20Z", "updated_at": "2019-12-26T02:52:18Z", "closed_at": "2019-12-26T01:13:47Z", "author_association": "NONE", "active_lock_reason": null, "body": "when I run the code below in your README, I got this problem, I want to know how to solve it?\r\n\r\nimport numpy as np\r\nfrom keras.preprocessing import image\r\nfrom keras.applications.resnet50 import preprocess_input\r\nimport keras2onnx\r\nimport onnxruntime\r\n\r\n# image preprocessing\r\nimg_path = 'street.jpg'   # make sure the image is in img_path\r\nimg_size = 224\r\nimg = image.load_img(img_path, target_size=(img_size, img_size))\r\nx = image.img_to_array(img)\r\nx = np.expand_dims(x, axis=0)\r\nx = preprocess_input(x)\r\n\r\n# load keras model\r\nfrom keras.applications.resnet50 import ResNet50\r\nmodel = ResNet50(include_top=True, weights='imagenet')\r\n\r\n# convert to onnx model\r\nonnx_model = keras2onnx.convert_keras(model, model.name)\r\n\r\n# runtime prediction\r\ncontent = onnx_model.SerializeToString()\r\nsess = onnxruntime.InferenceSession(content)\r\nx = x if isinstance(x, list) else [x]\r\nfeed = dict([(input.name, x[n]) for n, input in enumerate(sess.get_inputs())])\r\npred_onnx = sess.run(None, feed)", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/323", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/323/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/323/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/323/events", "html_url": "https://github.com/onnx/keras-onnx/issues/323", "id": 542069757, "node_id": "MDU6SXNzdWU1NDIwNjk3NTc=", "number": 323, "title": "INVALID_ARGUMENT : Unexpected input data type.Actual: (class onnxruntime::PrimitiveDataType<double>) , expected: (class onnxruntime::PrimitiveDataType<float>)", "user": {"login": "Nathanielll", "id": 18515062, "node_id": "MDQ6VXNlcjE4NTE1MDYy", "avatar_url": "https://avatars0.githubusercontent.com/u/18515062?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Nathanielll", "html_url": "https://github.com/Nathanielll", "followers_url": "https://api.github.com/users/Nathanielll/followers", "following_url": "https://api.github.com/users/Nathanielll/following{/other_user}", "gists_url": "https://api.github.com/users/Nathanielll/gists{/gist_id}", "starred_url": "https://api.github.com/users/Nathanielll/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Nathanielll/subscriptions", "organizations_url": "https://api.github.com/users/Nathanielll/orgs", "repos_url": "https://api.github.com/users/Nathanielll/repos", "events_url": "https://api.github.com/users/Nathanielll/events{/privacy}", "received_events_url": "https://api.github.com/users/Nathanielll/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-12-24T09:52:39Z", "updated_at": "2019-12-25T02:20:57Z", "closed_at": "2019-12-25T02:20:57Z", "author_association": "NONE", "active_lock_reason": null, "body": "my code\uff1a\r\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\r\nimport numpy\r\nfrom sklearn.datasets import load_boston\r\nfrom keras import models\r\nimport keras\r\nimport onnx\r\n\r\nimport onnxmltools\r\nimport onnxruntime\r\n\r\nx = load_boston().data.astype(numpy.float32)\r\ny = load_boston().target.astype(numpy.float32)\r\n\r\nmodel = keras.Sequential()\r\nmodel.add(keras.layers.Dense(8))\r\nmodel.add(keras.layers.Dense(1))\r\n\r\nmodel.compile(keras.optimizers.Adam(0.001, ), loss='mse')\r\n\r\nmodel.fit(x, y, epochs=10)\r\nmodel.save('model.h5')\r\n\r\nmodel = models.load_model('model.h5')\r\n\r\nonnx_net = keras2onnx.convert_keras(model)\r\n\r\nonnxmltools.utils.save_model(onnx_net, 'model.onnx')\r\n\r\ntemp_model_file = 'model.onnx'\r\nonnx_net = onnx.load_model(temp_model_file)\r\ncontent = onnx_net.SerializeToString()\r\n\r\nsess = onnxruntime.InferenceSession(temp_model_file)\r\n\r\nfor i in sess.get_inputs():\r\n    print(i.name)\r\n    print(i.shape)\r\nsess.get_outputs()\r\nfor i in sess.get_outputs():\r\n    print(i.name)\r\n    print(i.shape)\r\n\r\nx = numpy.random.random((1, 13)).astype(numpy.float64)\r\nx = x if isinstance(x, list) else [x]\r\nfeed = dict([(input.name, x[n]) for n, input in enumerate(sess.get_inputs())])\r\nprint(sess.run(None,\r\n               feed))\r\n\r\n\r\n\r\n\r\n\r\n\r\nconsole:\r\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\r\n    return self._sess.run(output_names, input_feed, run_options)\r\nonnxruntime.capi.onnxruntime_pybind11_state.InvalidArgument: [ONNXRuntimeError] : 2 : INVALID_ARGUMENT : Unexpected input data type. Actual: (class onnxruntime::PrimitiveDataType<double>) , expected: (class onnxruntime::PrimitiveDataType<float>)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/316", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/316/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/316/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/316/events", "html_url": "https://github.com/onnx/keras-onnx/issues/316", "id": 540165372, "node_id": "MDU6SXNzdWU1NDAxNjUzNzI=", "number": 316, "title": "module 'keras.applications.mobilenet' has no attribute 'relu6'", "user": {"login": "corleonechensiyu", "id": 39826330, "node_id": "MDQ6VXNlcjM5ODI2MzMw", "avatar_url": "https://avatars3.githubusercontent.com/u/39826330?v=4", "gravatar_id": "", "url": "https://api.github.com/users/corleonechensiyu", "html_url": "https://github.com/corleonechensiyu", "followers_url": "https://api.github.com/users/corleonechensiyu/followers", "following_url": "https://api.github.com/users/corleonechensiyu/following{/other_user}", "gists_url": "https://api.github.com/users/corleonechensiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/corleonechensiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/corleonechensiyu/subscriptions", "organizations_url": "https://api.github.com/users/corleonechensiyu/orgs", "repos_url": "https://api.github.com/users/corleonechensiyu/repos", "events_url": "https://api.github.com/users/corleonechensiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/corleonechensiyu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-12-19T08:47:23Z", "updated_at": "2020-01-31T02:03:10Z", "closed_at": "2020-01-31T02:03:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/303", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/303/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/303/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/303/events", "html_url": "https://github.com/onnx/keras-onnx/issues/303", "id": 535664412, "node_id": "MDU6SXNzdWU1MzU2NjQ0MTI=", "number": 303, "title": "SpatialDropout2D not supported", "user": {"login": "lpj0822", "id": 8148136, "node_id": "MDQ6VXNlcjgxNDgxMzY=", "avatar_url": "https://avatars3.githubusercontent.com/u/8148136?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lpj0822", "html_url": "https://github.com/lpj0822", "followers_url": "https://api.github.com/users/lpj0822/followers", "following_url": "https://api.github.com/users/lpj0822/following{/other_user}", "gists_url": "https://api.github.com/users/lpj0822/gists{/gist_id}", "starred_url": "https://api.github.com/users/lpj0822/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lpj0822/subscriptions", "organizations_url": "https://api.github.com/users/lpj0822/orgs", "repos_url": "https://api.github.com/users/lpj0822/repos", "events_url": "https://api.github.com/users/lpj0822/events{/privacy}", "received_events_url": "https://api.github.com/users/lpj0822/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-12-10T11:21:30Z", "updated_at": "2020-01-31T02:03:52Z", "closed_at": "2020-01-31T02:03:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "SpatialDropout2D not support?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/287", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/287/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/287/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/287/events", "html_url": "https://github.com/onnx/keras-onnx/issues/287", "id": 518416889, "node_id": "MDU6SXNzdWU1MTg0MTY4ODk=", "number": 287, "title": "YoloV3 conversion", "user": {"login": "yonglizhong", "id": 55392228, "node_id": "MDQ6VXNlcjU1MzkyMjI4", "avatar_url": "https://avatars0.githubusercontent.com/u/55392228?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yonglizhong", "html_url": "https://github.com/yonglizhong", "followers_url": "https://api.github.com/users/yonglizhong/followers", "following_url": "https://api.github.com/users/yonglizhong/following{/other_user}", "gists_url": "https://api.github.com/users/yonglizhong/gists{/gist_id}", "starred_url": "https://api.github.com/users/yonglizhong/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yonglizhong/subscriptions", "organizations_url": "https://api.github.com/users/yonglizhong/orgs", "repos_url": "https://api.github.com/users/yonglizhong/repos", "events_url": "https://api.github.com/users/yonglizhong/events{/privacy}", "received_events_url": "https://api.github.com/users/yonglizhong/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-11-06T11:38:29Z", "updated_at": "2020-01-31T02:01:14Z", "closed_at": "2020-01-31T02:01:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi all. I am interested in using the YOLOv3 Keras model to ONNX format. It is the one that is from https://github.com/qqwweee/keras-yolo3, which the attempt to convert has been successful. For personal interest, I would like to convert it once more with my own pretrained model. I've attempted to use the yolov3.py API but to no success. My first question is if you have the list of packages and their versions, I believe there might be a few dependencies problems for me. I am also wondering what is the difference between the yolov3.py & test_yolov3.py since yolov3.py suffices my needs. Thanks", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/281", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/281/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/281/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/281/events", "html_url": "https://github.com/onnx/keras-onnx/issues/281", "id": 512095632, "node_id": "MDU6SXNzdWU1MTIwOTU2MzI=", "number": 281, "title": "Converted model produces different output", "user": {"login": "kurzacz", "id": 46242461, "node_id": "MDQ6VXNlcjQ2MjQyNDYx", "avatar_url": "https://avatars2.githubusercontent.com/u/46242461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kurzacz", "html_url": "https://github.com/kurzacz", "followers_url": "https://api.github.com/users/kurzacz/followers", "following_url": "https://api.github.com/users/kurzacz/following{/other_user}", "gists_url": "https://api.github.com/users/kurzacz/gists{/gist_id}", "starred_url": "https://api.github.com/users/kurzacz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kurzacz/subscriptions", "organizations_url": "https://api.github.com/users/kurzacz/orgs", "repos_url": "https://api.github.com/users/kurzacz/repos", "events_url": "https://api.github.com/users/kurzacz/events{/privacy}", "received_events_url": "https://api.github.com/users/kurzacz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-10-24T18:02:27Z", "updated_at": "2019-10-24T19:37:29Z", "closed_at": "2019-10-24T19:37:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "I tried to convert Cat & Dog classifier from keras to onnx. Repository is pasted below:\r\nhttps://github.com/girishkuniyal/Cat-Dog-CNN-Classifier\r\n\r\nNet is built from Conv2D, MaxPooling2D, Flatten and Dense layers. Visualization from Tensorboard is below:\r\n![cat-and-dogs](https://user-images.githubusercontent.com/46242461/67511808-f1477f00-f697-11e9-906b-879af81f23ca.png)\r\n\r\nThe problem is, model provided in repository correctly distinguishes a cat from a dog. It uses binary classification (1 = dog, 0 = cat). After conversion, onnx model every time outputs 1.\r\n\r\nYou can download project either from repository linked above or download whole project packed in zip file:\r\nhttps://drive.google.com/open?id=1fNrhBm23I91BgUBRjw3PeXb0N3wL35Ru\r\nMy zip file is extended with sample images of a cat and a dog, and 2 scripts:\r\n\r\n- onnx-conv.py is a script based on your tutorial how to convert model from Keras to ONNX. When you run it, it will try to classify images of a cat and a dog. You can expect for both images the output is 1. This is basically my problem, because for a cat it should output 0.\r\n- model-test.py - quick script to test model I'm trying to convert. I used this script to ensure that Keras model works properly, that is, gives output 0 for a cat and output 1 for a dog.\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/278", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/278/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/278/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/278/events", "html_url": "https://github.com/onnx/keras-onnx/issues/278", "id": 511108268, "node_id": "MDU6SXNzdWU1MTExMDgyNjg=", "number": 278, "title": "pip install keras2onnx error", "user": {"login": "corleonechensiyu", "id": 39826330, "node_id": "MDQ6VXNlcjM5ODI2MzMw", "avatar_url": "https://avatars3.githubusercontent.com/u/39826330?v=4", "gravatar_id": "", "url": "https://api.github.com/users/corleonechensiyu", "html_url": "https://github.com/corleonechensiyu", "followers_url": "https://api.github.com/users/corleonechensiyu/followers", "following_url": "https://api.github.com/users/corleonechensiyu/following{/other_user}", "gists_url": "https://api.github.com/users/corleonechensiyu/gists{/gist_id}", "starred_url": "https://api.github.com/users/corleonechensiyu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/corleonechensiyu/subscriptions", "organizations_url": "https://api.github.com/users/corleonechensiyu/orgs", "repos_url": "https://api.github.com/users/corleonechensiyu/repos", "events_url": "https://api.github.com/users/corleonechensiyu/events{/privacy}", "received_events_url": "https://api.github.com/users/corleonechensiyu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-10-23T06:37:52Z", "updated_at": "2020-02-06T13:00:13Z", "closed_at": "2019-12-27T17:30:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "when i run `import keras2onnx',\r\n'import onnx' ,\r\n'from keras.models import load_model' ,\r\n'model = load_model('model.h5')' ,\r\n'onnx_model = keras2onnx.convert_keras(model)' ,\r\n'temp_model_file ='model.onnx' ' ,\r\n'onnx.save_model(onnx_model,temp_model_file)`,\r\nit have this error .\r\n`Traceback (most recent call last):\r\n  File \"E:/pytorchprojects/demo/keras2onnx.py\", line 1, in <module>\r\n    import keras2onnx\r\n  File \"E:\\pytorchprojects\\demo\\keras2onnx.py\", line 76, in <module>\r\n    onnx_model = keras2onnx.convert_keras(model)\r\nAttributeError: module 'keras2onnx' has no attribute 'convert_keras'`\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/270", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/270/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/270/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/270/events", "html_url": "https://github.com/onnx/keras-onnx/issues/270", "id": 505094056, "node_id": "MDU6SXNzdWU1MDUwOTQwNTY=", "number": 270, "title": "onnxruntime error for mask_RCNN", "user": {"login": "Benzidrine", "id": 14697373, "node_id": "MDQ6VXNlcjE0Njk3Mzcz", "avatar_url": "https://avatars1.githubusercontent.com/u/14697373?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Benzidrine", "html_url": "https://github.com/Benzidrine", "followers_url": "https://api.github.com/users/Benzidrine/followers", "following_url": "https://api.github.com/users/Benzidrine/following{/other_user}", "gists_url": "https://api.github.com/users/Benzidrine/gists{/gist_id}", "starred_url": "https://api.github.com/users/Benzidrine/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Benzidrine/subscriptions", "organizations_url": "https://api.github.com/users/Benzidrine/orgs", "repos_url": "https://api.github.com/users/Benzidrine/repos", "events_url": "https://api.github.com/users/Benzidrine/events{/privacy}", "received_events_url": "https://api.github.com/users/Benzidrine/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-10-10T07:40:24Z", "updated_at": "2019-10-10T08:13:51Z", "closed_at": "2019-10-10T08:13:50Z", "author_association": "NONE", "active_lock_reason": null, "body": "Attempting to use a fresh pull of keras-onnx master doesn't appear to be able to create a valid onnx model for mask_rcnn. \r\n\r\nI tried using the standard matterport/Mask_RCNN/mask_rcnn_coco.h5 and my own retrained models.\r\n\r\nI received the following error in all cases. \r\n\r\n**Error:**\r\n\r\nThere is an error(<class 'AssertionError'>) happened during optimizing on the converted model!\r\nTraceback (most recent call last):\r\n  File \"mask_rcnn.py\", line 732, in <module>\r\n    sess = onnxruntime.InferenceSession(model_file_name)\r\n  File \"C:\\ProgramData\\Anaconda3\\envs\\KerasToOnnx\\lib\\site-packages\\onnxruntime\\capi\\session.py\", line 29, in __init__\r\n    self._sess.load_model(path_or_bytes)\r\nRuntimeError: [ONNXRuntimeError] : 1 : GENERAL ERROR : Load model from ./mrcnn.onnx failed:This is an invalid model. Node (Identity99) input arg (rpn_model/lambda_1/Reshape:0) does not have type information set by parent node.\r\n\r\n**version list**\r\n\r\nkeras                     2.2.4                         0\r\nkeras-applications        1.0.8                      py_0\r\nkeras-base                2.2.4                    py37_0\r\nkeras-preprocessing       1.1.0                      py_1\r\nkeras2onnx                1.6.0                    pypi_0    pypi\r\nnumpy                     1.16.5           py37h19fb1c0_0\r\nnumpy-base                1.16.5           py37hc3f5095_0\r\nonnx                      1.6.0                    pypi_0    pypi\r\nonnxconverter-common      1.5.5                    pypi_0    pypi\r\nonnxruntime               0.5.0                    pypi_0    pypi\r\npip                       19.2.3                   py37_0\r\npython                    3.7.4                h5263a28_0\r\nscikit-image              0.15.0           py37ha925a31_0\r\ntensorboard               1.14.0           py37he3c9ec2_0\r\ntensorflow                1.14.0          mkl_py37h7908ca0_0\r\ntensorflow-base           1.14.0          mkl_py37ha978198_0\r\ntensorflow-estimator      1.14.0                     py_0", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/264", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/264/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/264/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/264/events", "html_url": "https://github.com/onnx/keras-onnx/issues/264", "id": 501989924, "node_id": "MDU6SXNzdWU1MDE5ODk5MjQ=", "number": 264, "title": "Network with GaussianNoise layer cannot be converted", "user": {"login": "dkloving", "id": 2437907, "node_id": "MDQ6VXNlcjI0Mzc5MDc=", "avatar_url": "https://avatars3.githubusercontent.com/u/2437907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkloving", "html_url": "https://github.com/dkloving", "followers_url": "https://api.github.com/users/dkloving/followers", "following_url": "https://api.github.com/users/dkloving/following{/other_user}", "gists_url": "https://api.github.com/users/dkloving/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkloving/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkloving/subscriptions", "organizations_url": "https://api.github.com/users/dkloving/orgs", "repos_url": "https://api.github.com/users/dkloving/repos", "events_url": "https://api.github.com/users/dkloving/events{/privacy}", "received_events_url": "https://api.github.com/users/dkloving/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-10-03T10:47:05Z", "updated_at": "2019-10-06T10:47:15Z", "closed_at": "2019-10-06T10:47:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "It seems that the gaussian noise node is unable to be converted. Also see #111 \r\n\r\n>I1003 13:44:06.208431  9168 tfonnx.py:475] Using tensorflow=1.14.0, onnx=1.5.0, tf2onnx=1.5.3/7b598d\r\nI1003 13:44:06.208431  9168 tfonnx.py:478] Using opset <onnx, 10>\r\nException on this tf.graph\r\nTFNodes/gaussian_noise_1/cond/random_normal/mean\r\nTFNodes/gaussian_noise_1/cond/random_normal/stddev\r\nTFNodes/gaussian_noise_1_input\r\nTFNodes/keras_learning_phase\r\nTFNodes/gaussian_noise_1/cond/pred_id\r\nTFNodes/gaussian_noise_1/cond/Switch_1\r\nTFNodes/gaussian_noise_1/cond/Shape/Switch\r\nTFNodes/gaussian_noise_1/cond/Shape\r\nTFNodes/gaussian_noise_1/cond/random_normal/RandomStandardNormal\r\nTFNodes/gaussian_noise_1/cond/random_normal/mul\r\nTFNodes/gaussian_noise_1/cond/random_normal\r\nTFNodes/gaussian_noise_1/cond/add\r\nTFNodes/gaussian_noise_1/cond/Merge\r\nTFNodes_identity\r\nTFNodes_identity_1\r\nW1003 13:44:06.222444  9168 wrapper.py:31] Exception on this tf.graph\r\nTFNodes/gaussian_noise_1/cond/random_normal/mean\r\nTFNodes/gaussian_noise_1/cond/random_normal/stddev\r\nTFNodes/gaussian_noise_1_input\r\nTFNodes/keras_learning_phase\r\nTFNodes/gaussian_noise_1/cond/pred_id\r\nTFNodes/gaussian_noise_1/cond/Switch_1\r\nTFNodes/gaussian_noise_1/cond/Shape/Switch\r\nTFNodes/gaussian_noise_1/cond/Shape\r\nTFNodes/gaussian_noise_1/cond/random_normal/RandomStandardNormal\r\nTFNodes/gaussian_noise_1/cond/random_normal/mul\r\nTFNodes/gaussian_noise_1/cond/random_normal\r\nTFNodes/gaussian_noise_1/cond/add\r\nTFNodes/gaussian_noise_1/cond/Merge\r\nTFNodes_identity\r\nTFNodes_identity_1\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\main.py\", line 98, in convert_keras\r\n    parse_graph(topology, sess.graph, target_opset, output_names)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\parser.py\", line 736, in parse_graph\r\n    return _parse_graph_scope(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\parser.py\", line 695, in _parse_graph_scope\r\n    _infer_graph_shape(topology, top_scope, varset)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\parser.py\", line 458, in _infer_graph_shape\r\n    _finalize_tf2onnx_op(topology, oop, varset)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\parser.py\", line 428, in _finalize_tf2onnx_op\r\n    g = tf2onnx_wrap(topo, subgraph, outputs, varset.target_opset)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\wrapper.py\", line 32, in tf2onnx_wrap\r\n    raise e\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\wrapper.py\", line 26, in tf2onnx_wrap\r\n    output_names=outputs)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\ktf2onnx\\tf2onnx\\tfonnx.py\", line 569, in process_tf_graph\r\n    topological_sort(g, continue_on_error)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\ktf2onnx\\tf2onnx\\tfonnx.py\", line 407, in topological_sort\r\n    g.topological_sort(ops)\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\ktf2onnx\\tf2onnx\\graph.py\", line 835, in topological_sort\r\n    utils.make_sure(j is not None, \"Cannot find node with output {}\".format(inp))\r\n  File \"c:\\anaconda36\\lib\\site-packages\\keras2onnx\\ktf2onnx\\tf2onnx\\utils.py\", line 290, in make_sure\r\n    raise ValueError(\"make_sure failure: \" + error_msg % args)\r\nValueError: make_sure failure: Cannot find node with output TFNodes/gaussian_noise_1/cond/Merge:1", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/252", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/252/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/252/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/252/events", "html_url": "https://github.com/onnx/keras-onnx/issues/252", "id": 499509689, "node_id": "MDU6SXNzdWU0OTk1MDk2ODk=", "number": 252, "title": "The output shape is different between onnx and keras", "user": {"login": "reymondzzzz", "id": 15812493, "node_id": "MDQ6VXNlcjE1ODEyNDkz", "avatar_url": "https://avatars0.githubusercontent.com/u/15812493?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reymondzzzz", "html_url": "https://github.com/reymondzzzz", "followers_url": "https://api.github.com/users/reymondzzzz/followers", "following_url": "https://api.github.com/users/reymondzzzz/following{/other_user}", "gists_url": "https://api.github.com/users/reymondzzzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/reymondzzzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reymondzzzz/subscriptions", "organizations_url": "https://api.github.com/users/reymondzzzz/orgs", "repos_url": "https://api.github.com/users/reymondzzzz/repos", "events_url": "https://api.github.com/users/reymondzzzz/events{/privacy}", "received_events_url": "https://api.github.com/users/reymondzzzz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 9, "created_at": "2019-09-27T15:27:01Z", "updated_at": "2019-10-04T18:32:12Z", "closed_at": "2019-10-04T18:32:12Z", "author_association": "NONE", "active_lock_reason": null, "body": "I have small nested backbone in keras convnet. I want to convert to onnx.\r\nbackbone:\r\n\r\n```\r\ndef _bottleneck(x, filters, activation, strides, block_id):\r\n    padding = 'same' if strides == 1 else 'valid'\r\n    ch_axis = 1 if K.image_data_format() == 'channels_first' else -1\r\n    if strides > 1:\r\n        x = KL.ZeroPadding2D(((0, 1), (0, 1)), data_format=K.image_data_format())(x)\r\n\r\n    x = KL.Conv2D(filters // 2, (1, 1), padding='same', name=f'bottleneck_{block_id}_conv_0',\r\n                  use_bias=False, data_format=K.image_data_format())(x)\r\n    x = KL.BatchNormalization(axis=ch_axis, name=f'bottleneck_{block_id}_bnorm_0')(x)\r\n\r\n    if activation == 'relu':\r\n        x = KL.ReLU(name=f'bottleneck_{block_id}_relu_0')(x)\r\n    elif activation == 'leaky':\r\n        x = KL.LeakyReLU(name=f'bottleneck_{block_id}_leaky_0')(x)\r\n    else:\r\n        assert False\r\n\r\n    x = KL.Conv2D(filters // 2, (3, 3), padding=padding, name=f'bottleneck_{block_id}_conv_1',\r\n                  strides=strides, use_bias=False, data_format=K.image_data_format())(x)\r\n    x = KL.BatchNormalization(axis=ch_axis, name=f'bottleneck_{block_id}_bnorm_1')(x)\r\n    if activation == 'relu':\r\n        x = KL.ReLU(name=f'bottleneck_{block_id}_relu_1')(x)\r\n    elif activation == 'leaky':\r\n        x = KL.LeakyReLU(name=f'bottleneck_{block_id}_leaky_1')(x)\r\n    else:\r\n        assert False\r\n\r\n    x = KL.Conv2D(filters, (1, 1), padding='same', name=f'bottleneck_{block_id}_conv_2',\r\n                  use_bias=False, data_format=K.image_data_format())(x)\r\n    x = KL.BatchNormalization(axis=ch_axis, name=f'bottleneck_{block_id}_bnorm_2')(x)\r\n    if activation == 'relu':\r\n        x = KL.ReLU(name=f'bottleneck_{block_id}_relu_2')(x)\r\n    elif activation == 'leaky':\r\n        x = KL.LeakyReLU(name=f'bottleneck_{block_id}_leaky_2')(x)\r\n    else:\r\n        assert False\r\n\r\n    return x\r\n\r\ndef convnet_7(input_shape: Tuple[Union[int, None], Union[int, None], int],\r\n              activation: str) -> KM.Model:\r\n    input = KL.Input(shape=input_shape, name='input_1')\r\n    x = _bottleneck(input, filters=16, strides=1, activation=activation, block_id=1)\r\n    x = _bottleneck(x, filters=32, strides=2, activation=activation, block_id=2)\r\n    x = _bottleneck(x, filters=64, strides=1, activation=activation, block_id=3)\r\n    x = _bottleneck(x, filters=64, strides=1, activation=activation, block_id=4)\r\n    x = _bottleneck(x, filters=128, strides=2, activation=activation, block_id=5)\r\n    x = _bottleneck(x, filters=128, strides=1, activation=activation, block_id=6)\r\n    x = _bottleneck(x, filters=128, strides=1, activation=activation, block_id=7)\r\n\r\n    return KM.Model(inputs=input, outputs=x, name='convnet_7')\r\n```\r\nUnfortunately, i can not get head and it doesn\u2019t mattter\r\n\r\nIf I just save model in onnx and run in onnxruntime i get\r\n\r\n```\r\nmodel = create_keras_model()\r\nmodel.load_weights(\"blah_blah\")\r\nmodel = keras2onnx.convert_keras(model, name=model.name, doc_string='', target_opset=7)\r\nonnx.save(model, \"blah_1\")\r\n\r\ninput = np.ones((1, 3, 96, 128)).astype(np.float32)\r\n\r\nsess = rt.InferenceSession(\"blah_1.onnx\")\r\ninput_name = sess.get_inputs()[0].name\r\n\r\npred_onx = sess.run(None, {input_name: input})\r\n\r\nGENERAL ERROR : Load model from blah_1.onnx failed:Node:Identity1 Output:xy_conv_1/BiasAdd:0 [ShapeInferenceError] Can't merge shape info. Both source and target dimension have values but they differ. Source=23 Target=24 Dimension=2\r\n```\r\nAnd if I change in function _bottleneck all same paddings to valid, create new model and load old weigths, saving and run onnx model. it's worked correctly. \r\n\r\nEmpty reproducing [model](https://github.com/onnx/keras-onnx/files/3663425/blah_1.onnx.zip)\r\n\r\nThank you!!!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/251", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/251/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/251/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/251/events", "html_url": "https://github.com/onnx/keras-onnx/issues/251", "id": 499066747, "node_id": "MDU6SXNzdWU0OTkwNjY3NDc=", "number": 251, "title": "Tensor is unhashable if Tensor equality is enabled with the tf2 branch on tf2-gpu-rc1", "user": {"login": "philvanzu", "id": 31523789, "node_id": "MDQ6VXNlcjMxNTIzNzg5", "avatar_url": "https://avatars3.githubusercontent.com/u/31523789?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philvanzu", "html_url": "https://github.com/philvanzu", "followers_url": "https://api.github.com/users/philvanzu/followers", "following_url": "https://api.github.com/users/philvanzu/following{/other_user}", "gists_url": "https://api.github.com/users/philvanzu/gists{/gist_id}", "starred_url": "https://api.github.com/users/philvanzu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philvanzu/subscriptions", "organizations_url": "https://api.github.com/users/philvanzu/orgs", "repos_url": "https://api.github.com/users/philvanzu/repos", "events_url": "https://api.github.com/users/philvanzu/events{/privacy}", "received_events_url": "https://api.github.com/users/philvanzu/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-09-26T19:14:15Z", "updated_at": "2019-09-26T19:32:17Z", "closed_at": "2019-09-26T19:32:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\nTraceback (most recent call last):\r\n  File \"D:/dev/DeepVPy/deepV_main.py\", line 39, in <module>\r\n    onnx_model = onnxmltools.convert_keras(model, target_opset=7)\r\n  File \"C:\\Users\\philippe\\Miniconda3\\envs\\tensorflow\\lib\\site-packages\\onnxmltools\\convert\\main.py\", line 32, in convert_keras\r\n    return convert(model, name, doc_string, target_opset, channel_first_inputs)\r\n  File \"C:\\Users\\philippe\\Miniconda3\\envs\\tensorflow\\lib\\keras2onnx\\main.py\", line 101, in convert_keras\r\n    parse_graph(topology, tf_graph, target_opset, output_names)\r\n  File \"C:\\Users\\philippe\\Miniconda3\\envs\\tensorflow\\lib\\keras2onnx\\parser.py\", line 669, in parse_graph\r\n    return _parse_graph_scope(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"C:\\Users\\philippe\\Miniconda3\\envs\\tensorflow\\lib\\keras2onnx\\parser.py\", line 568, in _parse_graph_scope\r\n    keras_nodeset = _build_keras_nodeset(inference_nodeset, keras_node_dict)\r\n  File \"C:\\Users\\philippe\\Miniconda3\\envs\\tensorflow\\lib\\keras2onnx\\parser.py\", line 506, in _build_keras_nodeset\r\n    nodes.update(_create_keras_nodelist(layer_, inference_nodeset))\r\n  File \"C:\\Users\\philippe\\Miniconda3\\envs\\tensorflow\\lib\\keras2onnx\\parser.py\", line 451, in _create_keras_nodelist\r\n    ts_end |= set(list_input_tensors(node_))\r\n  File \"C:\\Users\\philippe\\Miniconda3\\envs\\tensorflow\\lib\\site-packages\\tensorflow_core\\python\\framework\\ops.py\", line 713, in __hash__\r\n    raise TypeError(\"Tensor is unhashable if Tensor equality is enabled. \"\r\nTypeError: Tensor is unhashable if Tensor equality is enabled. Instead, use tensor.experimental_ref() as the key.\r\n```\r\n\r\nhere's the model detail\r\n```\r\n\r\n_________________________________________________________________\r\nLayer (type)                 Output Shape              Param #   \r\n=================================================================\r\ninput_1 (InputLayer)         [(None, 224, 224, 3)]     0         \r\n_________________________________________________________________\r\nconv2d (Conv2D)              (None, 224, 224, 16)      448       \r\n_________________________________________________________________\r\nactivation (Activation)      (None, 224, 224, 16)      0         \r\n_________________________________________________________________\r\nbatch_normalization (BatchNo (None, 224, 224, 16)      64        \r\n_________________________________________________________________\r\nmax_pooling2d (MaxPooling2D) (None, 112, 112, 16)      0         \r\n_________________________________________________________________\r\nconv2d_1 (Conv2D)            (None, 112, 112, 32)      4640      \r\n_________________________________________________________________\r\nactivation_1 (Activation)    (None, 112, 112, 32)      0         \r\n_________________________________________________________________\r\nbatch_normalization_1 (Batch (None, 112, 112, 32)      128       \r\n_________________________________________________________________\r\nmax_pooling2d_1 (MaxPooling2 (None, 56, 56, 32)        0         \r\n_________________________________________________________________\r\nconv2d_2 (Conv2D)            (None, 56, 56, 64)        18496     \r\n_________________________________________________________________\r\nactivation_2 (Activation)    (None, 56, 56, 64)        0         \r\n_________________________________________________________________\r\nbatch_normalization_2 (Batch (None, 56, 56, 64)        256       \r\n_________________________________________________________________\r\nmax_pooling2d_2 (MaxPooling2 (None, 28, 28, 64)        0         \r\n_________________________________________________________________\r\nflatten (Flatten)            (None, 50176)             0         \r\n_________________________________________________________________\r\ndense (Dense)                (None, 16)                802832    \r\n_________________________________________________________________\r\nactivation_3 (Activation)    (None, 16)                0         \r\n_________________________________________________________________\r\nbatch_normalization_3 (Batch (None, 16)                64        \r\n_________________________________________________________________\r\ndropout (Dropout)            (None, 16)                0         \r\n_________________________________________________________________\r\ndense_1 (Dense)              (None, 3)                 51        \r\n=================================================================\r\n```\r\n or is this a tf2 bug that has nothing to do with keras2onnx?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/248", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/248/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/248/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/248/events", "html_url": "https://github.com/onnx/keras-onnx/issues/248", "id": 496982287, "node_id": "MDU6SXNzdWU0OTY5ODIyODc=", "number": 248, "title": "Operator Clip has changed in opset=11, min, max are input and not attributes anymore", "user": {"login": "xadupre", "id": 22452781, "node_id": "MDQ6VXNlcjIyNDUyNzgx", "avatar_url": "https://avatars1.githubusercontent.com/u/22452781?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xadupre", "html_url": "https://github.com/xadupre", "followers_url": "https://api.github.com/users/xadupre/followers", "following_url": "https://api.github.com/users/xadupre/following{/other_user}", "gists_url": "https://api.github.com/users/xadupre/gists{/gist_id}", "starred_url": "https://api.github.com/users/xadupre/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xadupre/subscriptions", "organizations_url": "https://api.github.com/users/xadupre/orgs", "repos_url": "https://api.github.com/users/xadupre/repos", "events_url": "https://api.github.com/users/xadupre/events{/privacy}", "received_events_url": "https://api.github.com/users/xadupre/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-09-23T09:19:01Z", "updated_at": "2019-10-11T23:19:59Z", "closed_at": "2019-10-11T23:19:59Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/246", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/246/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/246/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/246/events", "html_url": "https://github.com/onnx/keras-onnx/issues/246", "id": 496226202, "node_id": "MDU6SXNzdWU0OTYyMjYyMDI=", "number": 246, "title": "Causal Conv1D is not supported", "user": {"login": "AStupidBear", "id": 16422976, "node_id": "MDQ6VXNlcjE2NDIyOTc2", "avatar_url": "https://avatars2.githubusercontent.com/u/16422976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AStupidBear", "html_url": "https://github.com/AStupidBear", "followers_url": "https://api.github.com/users/AStupidBear/followers", "following_url": "https://api.github.com/users/AStupidBear/following{/other_user}", "gists_url": "https://api.github.com/users/AStupidBear/gists{/gist_id}", "starred_url": "https://api.github.com/users/AStupidBear/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AStupidBear/subscriptions", "organizations_url": "https://api.github.com/users/AStupidBear/orgs", "repos_url": "https://api.github.com/users/AStupidBear/repos", "events_url": "https://api.github.com/users/AStupidBear/events{/privacy}", "received_events_url": "https://api.github.com/users/AStupidBear/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1165977501, "node_id": "MDU6TGFiZWwxMTY1OTc3NTAx", "url": "https://api.github.com/repos/onnx/keras-onnx/labels/enhancement", "name": "enhancement", "color": "a2eeef", "default": true, "description": "New feature or request"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-09-20T08:45:16Z", "updated_at": "2019-10-22T18:51:55Z", "closed_at": "2019-10-22T18:51:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/238", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/238/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/238/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/238/events", "html_url": "https://github.com/onnx/keras-onnx/issues/238", "id": 493415262, "node_id": "MDU6SXNzdWU0OTM0MTUyNjI=", "number": 238, "title": "ValueError: Unknown layer: Affine", "user": {"login": "caesar84", "id": 16879951, "node_id": "MDQ6VXNlcjE2ODc5OTUx", "avatar_url": "https://avatars2.githubusercontent.com/u/16879951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/caesar84", "html_url": "https://github.com/caesar84", "followers_url": "https://api.github.com/users/caesar84/followers", "following_url": "https://api.github.com/users/caesar84/following{/other_user}", "gists_url": "https://api.github.com/users/caesar84/gists{/gist_id}", "starred_url": "https://api.github.com/users/caesar84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/caesar84/subscriptions", "organizations_url": "https://api.github.com/users/caesar84/orgs", "repos_url": "https://api.github.com/users/caesar84/repos", "events_url": "https://api.github.com/users/caesar84/events{/privacy}", "received_events_url": "https://api.github.com/users/caesar84/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2019-09-13T16:29:46Z", "updated_at": "2019-10-16T21:57:14Z", "closed_at": "2019-10-16T21:57:14Z", "author_association": "NONE", "active_lock_reason": null, "body": "hi there,\r\nI am trying to convert a Keras model to ONXX on Ubuntu 16.04 and i had this error. any ideas what have i done wrong?\r\n\r\nhere is the output :\r\n\r\npython3 test_1.py\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/home/mastlab/.local/lib/python3.5/site-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\nUsing TensorFlow backend.\r\nWARNING:tensorflow:From /home/mastlab/.local/lib/python3.5/site-packages/keras/backend/tensorflow_backend.py:541: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.\r\n\r\nTraceback (most recent call last):\r\n  File \"test_1.py\", line 5, in <module>\r\n    model= load_model('/home/mastlab/Downloads/model.h5', compile=False)\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/engine/saving.py\", line 458, in load_wrapper\r\n    return load_function(*args, **kwargs)\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/engine/saving.py\", line 550, in load_model\r\n    model = _deserialize_model(h5dict, custom_objects, compile)\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/engine/saving.py\", line 243, in _deserialize_model\r\n    model = model_from_config(model_config, custom_objects=custom_objects)\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/engine/saving.py\", line 593, in model_from_config\r\n    return deserialize(config, custom_objects=custom_objects)\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/layers/__init__.py\", line 168, in deserialize\r\n    printable_module_name='layer')\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/utils/generic_utils.py\", line 147, in deserialize_keras_object\r\n    list(custom_objects.items())))\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/engine/network.py\", line 1043, in from_config\r\n    process_layer(layer_data)\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/engine/network.py\", line 1029, in process_layer\r\n    custom_objects=custom_objects)\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/layers/__init__.py\", line 168, in deserialize\r\n    printable_module_name='layer')\r\n  File \"/home/mastlab/.local/lib/python3.5/site-packages/keras/utils/generic_utils.py\", line 140, in deserialize_keras_object\r\n    ': ' + class_name)\r\nValueError: Unknown layer: Affine\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/236", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/236/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/236/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/236/events", "html_url": "https://github.com/onnx/keras-onnx/issues/236", "id": 492833708, "node_id": "MDU6SXNzdWU0OTI4MzM3MDg=", "number": 236, "title": "TensorFlow 2.0 not supported", "user": {"login": "letmaik", "id": 530988, "node_id": "MDQ6VXNlcjUzMDk4OA==", "avatar_url": "https://avatars1.githubusercontent.com/u/530988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/letmaik", "html_url": "https://github.com/letmaik", "followers_url": "https://api.github.com/users/letmaik/followers", "following_url": "https://api.github.com/users/letmaik/following{/other_user}", "gists_url": "https://api.github.com/users/letmaik/gists{/gist_id}", "starred_url": "https://api.github.com/users/letmaik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/letmaik/subscriptions", "organizations_url": "https://api.github.com/users/letmaik/orgs", "repos_url": "https://api.github.com/users/letmaik/repos", "events_url": "https://api.github.com/users/letmaik/events{/privacy}", "received_events_url": "https://api.github.com/users/letmaik/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 10, "created_at": "2019-09-12T14:14:26Z", "updated_at": "2020-04-21T19:43:15Z", "closed_at": "2020-01-31T02:00:30Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\n...\r\n File \"/home/.../miniconda3/envs/tf2/lib/python3.7/site-packages/keras2onnx/ktf2onnx/tf2onnx/tfonnx.py\", line 20, in <module>\r\n    from tensorflow.tools.graph_transforms import TransformGraph\r\nModuleNotFoundError: No module named 'tensorflow.tools.graph_transforms'\r\n```\r\nVersions:\r\nkeras2onnx-1.5.1 onnx-1.5.0 onnxconverter-common-1.5.3 tensorflow==2.0.0-beta1", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/233", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/233/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/233/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/233/events", "html_url": "https://github.com/onnx/keras-onnx/issues/233", "id": 491142999, "node_id": "MDU6SXNzdWU0OTExNDI5OTk=", "number": 233, "title": "\"IndexError: list index out of range\" - while converting trained retinanet .h5 to onnx", "user": {"login": "PushkarChatterji", "id": 51086460, "node_id": "MDQ6VXNlcjUxMDg2NDYw", "avatar_url": "https://avatars1.githubusercontent.com/u/51086460?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PushkarChatterji", "html_url": "https://github.com/PushkarChatterji", "followers_url": "https://api.github.com/users/PushkarChatterji/followers", "following_url": "https://api.github.com/users/PushkarChatterji/following{/other_user}", "gists_url": "https://api.github.com/users/PushkarChatterji/gists{/gist_id}", "starred_url": "https://api.github.com/users/PushkarChatterji/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PushkarChatterji/subscriptions", "organizations_url": "https://api.github.com/users/PushkarChatterji/orgs", "repos_url": "https://api.github.com/users/PushkarChatterji/repos", "events_url": "https://api.github.com/users/PushkarChatterji/events{/privacy}", "received_events_url": "https://api.github.com/users/PushkarChatterji/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2019-09-09T14:46:52Z", "updated_at": "2019-09-24T14:27:20Z", "closed_at": "2019-09-24T14:27:20Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\nI have implemented transfer-learning on my own dataset on a retinanet model in keras.\r\n\r\nWhen I try to convert this to an onnx file I get this error:\r\n\"IndexError: list index out of range\"\r\n\r\nmy code is:\r\n\r\n```\r\nimport keras\r\nfrom keras_retinanet import models\r\nimport keras2onnx\r\nimport onnxruntime\r\nimport onnx\r\n\r\nmodel_path = \"/home/Projects/Documents/AI_models/resnet50_csv_20.h5\"\r\nResNetModel = models.load_model(model_path, backbone_name = \"resnet50\")\r\nonnx_model = keras2onnx.convert_keras(ResNetModel, ResNetModel.name)\r\nonnx.save_model(onnx_model, \"/home/Projects/Documents/AI_models/resnet50_csv_24_infer.onnx\")\r\n```\r\n\r\n\r\n\r\n\r\nThe full error message is:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"keras_resnet_model_to_onnx.py\", line 24, in <module>\r\n    onnx_model = keras2onnx.convert_keras(ResNetModel, ResNetModel.name)\r\n  File \"/home/Projects/.local/lib/python3.6/site-packages/keras2onnx/main.py\", line 102, in convert_keras\r\n    parse_graph(topology, sess.graph, target_opset, output_names)\r\n  File \"/home/Projects/.local/lib/python3.6/site-packages/keras2onnx/parser.py\", line 668, in parse_graph\r\n    return _parse_graph_scope(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"/home/Projects/.local/lib/python3.6/site-packages/keras2onnx/parser.py\", line 627, in _parse_graph_scope\r\n    _infer_graph_shape(topology, top_scope, varset)\r\n  File \"/home/Projects/.local/lib/python3.6/site-packages/keras2onnx/parser.py\", line 390, in _infer_graph_shape\r\n    _finalize_tf2onnx_op(topology, oop, varset)\r\n  File \"/home/Projects/.local/lib/python3.6/site-packages/keras2onnx/parser.py\", line 354, in _finalize_tf2onnx_op\r\n    ov = varset.get_local_variable_or_declare_one(nodes[n0_][i_], _infer_variable_type(n_, varset.target_opset))\r\nIndexError: list index out of range\r\n```\r\n\r\nAny pointers on how I can fix this?\r\n\r\nThanks!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/227", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/227/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/227/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/227/events", "html_url": "https://github.com/onnx/keras-onnx/issues/227", "id": 489081569, "node_id": "MDU6SXNzdWU0ODkwODE1Njk=", "number": 227, "title": "Error while converting other yolov3 model", "user": {"login": "amanarora28", "id": 16681674, "node_id": "MDQ6VXNlcjE2NjgxNjc0", "avatar_url": "https://avatars3.githubusercontent.com/u/16681674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amanarora28", "html_url": "https://github.com/amanarora28", "followers_url": "https://api.github.com/users/amanarora28/followers", "following_url": "https://api.github.com/users/amanarora28/following{/other_user}", "gists_url": "https://api.github.com/users/amanarora28/gists{/gist_id}", "starred_url": "https://api.github.com/users/amanarora28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amanarora28/subscriptions", "organizations_url": "https://api.github.com/users/amanarora28/orgs", "repos_url": "https://api.github.com/users/amanarora28/repos", "events_url": "https://api.github.com/users/amanarora28/events{/privacy}", "received_events_url": "https://api.github.com/users/amanarora28/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2019-09-04T10:41:10Z", "updated_at": "2019-12-02T09:56:55Z", "closed_at": "2019-09-26T22:28:55Z", "author_association": "NONE", "active_lock_reason": null, "body": "I followed the script shared to convert a newly trained yolov3 model. The conversion was successful but a problem arises when loading the model in onnxruntime.\r\nError:\r\n\r\nRuntimeError: [ONNXRuntimeError] : 1 : GENERAL ERROR : Node:Identity2 Output:yolonms_layer_1/ExpandDims_1:0 [ShapeInferenceError] Mismatch between number of source and target dimensions. Source=3 Target=4\r\n\r\nI have read a lot about this error, maybe onnx is not  able to figure out dimension change with expand dims operator. \r\nAll I wanted to know is how can I skip this shape inference while loading model? ", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/214", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/214/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/214/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/214/events", "html_url": "https://github.com/onnx/keras-onnx/issues/214", "id": 486770990, "node_id": "MDU6SXNzdWU0ODY3NzA5OTA=", "number": 214, "title": "Onnx model converted from hdf5 model has lstm nodes with different dimensions for bias and kernel", "user": {"login": "tijithomas", "id": 42336597, "node_id": "MDQ6VXNlcjQyMzM2NTk3", "avatar_url": "https://avatars0.githubusercontent.com/u/42336597?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tijithomas", "html_url": "https://github.com/tijithomas", "followers_url": "https://api.github.com/users/tijithomas/followers", "following_url": "https://api.github.com/users/tijithomas/following{/other_user}", "gists_url": "https://api.github.com/users/tijithomas/gists{/gist_id}", "starred_url": "https://api.github.com/users/tijithomas/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tijithomas/subscriptions", "organizations_url": "https://api.github.com/users/tijithomas/orgs", "repos_url": "https://api.github.com/users/tijithomas/repos", "events_url": "https://api.github.com/users/tijithomas/events{/privacy}", "received_events_url": "https://api.github.com/users/tijithomas/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2019-08-29T06:49:40Z", "updated_at": "2019-09-05T11:09:13Z", "closed_at": "2019-08-29T18:17:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "The keras model:\r\n![Screenshot from 2019-08-29 11-43-42](https://user-images.githubusercontent.com/42336597/63916826-d5887980-ca56-11e9-99cf-247daee0af10.png)\r\n\r\nAfter conversion, the onnx model has transpose after every node and the dimension for bias on lstm nodes have changed from [2000] to [1,4000]. Although after 2000, all the values are 0. Is the conversion correct in this case?\r\n![Screenshot from 2019-08-29 11-52-39](https://user-images.githubusercontent.com/42336597/63917021-42037880-ca57-11e9-8367-17116c14c86b.png)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/212", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/212/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/212/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/212/events", "html_url": "https://github.com/onnx/keras-onnx/issues/212", "id": 486447758, "node_id": "MDU6SXNzdWU0ODY0NDc3NTg=", "number": 212, "title": "Error in converting Keras model with custom layer to ONNX", "user": {"login": "shabnamrashtchi", "id": 49405066, "node_id": "MDQ6VXNlcjQ5NDA1MDY2", "avatar_url": "https://avatars1.githubusercontent.com/u/49405066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shabnamrashtchi", "html_url": "https://github.com/shabnamrashtchi", "followers_url": "https://api.github.com/users/shabnamrashtchi/followers", "following_url": "https://api.github.com/users/shabnamrashtchi/following{/other_user}", "gists_url": "https://api.github.com/users/shabnamrashtchi/gists{/gist_id}", "starred_url": "https://api.github.com/users/shabnamrashtchi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shabnamrashtchi/subscriptions", "organizations_url": "https://api.github.com/users/shabnamrashtchi/orgs", "repos_url": "https://api.github.com/users/shabnamrashtchi/repos", "events_url": "https://api.github.com/users/shabnamrashtchi/events{/privacy}", "received_events_url": "https://api.github.com/users/shabnamrashtchi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-08-28T15:17:44Z", "updated_at": "2019-10-21T08:48:24Z", "closed_at": "2019-10-21T08:48:24Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi \r\nI am trying to **convert my Keras model to ONNX.**\r\nMy model is Bidirectional LSTM with Self Attention layer. Attention class is a custom layer I developed for my Keas model. \r\nWhen I try to covert the model to ONNX I face the following error: \r\nI tried a few options: \r\n ---loading keras model first: \r\n---AttentionLayer is the name of my class ( developed layer)\r\nbest_model = load_model( 'model.h5', custom_objects={'AttentionLayer': AttentionLayer})\r\n\r\nonnx_model = onnxmltools.convert_keras(best_model, best_model.name)\r\n----or \r\nimport keras2onnx\r\nonnx_model = keras2onnx.convert_keras(model, model.name\r\n                                      , target_opset=7,\r\n                                      debug_mode=False)\r\n\r\n---or \r\nonnx.save(onnx_model, 'model.onnx')\r\n\r\n``````````````````````````````````````````\r\nError: \r\nI0827 13:04:23.197570 140736254743424 tfonnx.py:475] Using tensorflow=1.14.0, onnx=1.5.0, tf2onnx=1.5.2/0c735a\r\nI0827 13:04:23.197653 140736254743424 tfonnx.py:478] Using opset <onnx, 10>\r\nTraceback (most recent call last):\r\n  File \"<input>\", line 1, in <module>\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/onnxmltools/convert/main.py\", line 32, in convert_keras\r\n    return convert(model, name, doc_string, target_opset, channel_first_inputs)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/main.py\", line 103, in convert_keras\r\n    return convert_topology(topology, name, doc_string, target_opset, channel_first_inputs)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/topology.py\", line 225, in convert_topology\r\n    get_converter(operator.type)(scope, operator, container)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/_builtin.py\", line 23, in convert_reshape_timedistributed\r\n    operator_name=operator.raw_operator.name, desired_shape=target_shape)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/onnxconverter_common/onnx_ops.py\", line 480, in apply_reshape\r\n    container.add_initializer(desired_shape_name, onnx_proto.TensorProto.INT64, [len(desired_shape)], desired_shape)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/common/interim.py\", line 205, in add_initializer\r\n    tensor = helper.make_tensor(name, onnx_type, shape, content)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/onnxmltools/proto/__init__.py\", line 44, in _make_tensor_fixed\r\n    getattr(tensor, field).extend(vals)\r\nTypeError: None has type NoneType, but expected one of: int, long", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/225", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/225/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/225/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/225/events", "html_url": "https://github.com/onnx/keras-onnx/issues/225", "id": 488319181, "node_id": "MDU6SXNzdWU0ODgzMTkxODE=", "number": 225, "title": "Problem with onnxmltools.convert_keras using Models with Custom layer", "user": {"login": "shabnamrashtchi", "id": 49405066, "node_id": "MDQ6VXNlcjQ5NDA1MDY2", "avatar_url": "https://avatars1.githubusercontent.com/u/49405066?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shabnamrashtchi", "html_url": "https://github.com/shabnamrashtchi", "followers_url": "https://api.github.com/users/shabnamrashtchi/followers", "following_url": "https://api.github.com/users/shabnamrashtchi/following{/other_user}", "gists_url": "https://api.github.com/users/shabnamrashtchi/gists{/gist_id}", "starred_url": "https://api.github.com/users/shabnamrashtchi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shabnamrashtchi/subscriptions", "organizations_url": "https://api.github.com/users/shabnamrashtchi/orgs", "repos_url": "https://api.github.com/users/shabnamrashtchi/repos", "events_url": "https://api.github.com/users/shabnamrashtchi/events{/privacy}", "received_events_url": "https://api.github.com/users/shabnamrashtchi/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-27T12:32:00Z", "updated_at": "2019-10-16T21:50:09Z", "closed_at": "2019-10-16T21:50:08Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi \r\nI am trying to **convert my Keras model to ONNX.**\r\nMy model is Bidirectional LSTM with Self Attention layer. Attention class is a custom layer I developed for my Keas model. \r\nWhen I try to covert the model to ONNX I face the following error: \r\nI tried a few options: \r\n ---loading keras model first: \r\n---AttentionLayer is the name of my class ( developed layer)\r\nbest_model = load_model( 'model.h5', custom_objects={'AttentionLayer': AttentionLayer})\r\n\r\nonnx_model = onnxmltools.convert_keras(best_model, best_model.name)\r\n----or \r\nimport keras2onnx\r\nonnx_model = keras2onnx.convert_keras(model, model.name\r\n                                      , target_opset=7,\r\n                                      debug_mode=False)\r\n\r\n---or \r\nonnx.save(onnx_model, 'model.onnx')\r\n\r\n``````````````````````````````````````````\r\nError: \r\nI0827 13:04:23.197570 140736254743424 tfonnx.py:475] Using tensorflow=1.14.0, onnx=1.5.0, tf2onnx=1.5.2/0c735a\r\nI0827 13:04:23.197653 140736254743424 tfonnx.py:478] Using opset <onnx, 10>\r\nTraceback (most recent call last):\r\n  File \"<input>\", line 1, in <module>\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/onnxmltools/convert/main.py\", line 32, in convert_keras\r\n    return convert(model, name, doc_string, target_opset, channel_first_inputs)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/main.py\", line 103, in convert_keras\r\n    return convert_topology(topology, name, doc_string, target_opset, channel_first_inputs)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/topology.py\", line 225, in convert_topology\r\n    get_converter(operator.type)(scope, operator, container)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/_builtin.py\", line 23, in convert_reshape_timedistributed\r\n    operator_name=operator.raw_operator.name, desired_shape=target_shape)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/onnxconverter_common/onnx_ops.py\", line 480, in apply_reshape\r\n    container.add_initializer(desired_shape_name, onnx_proto.TensorProto.INT64, [len(desired_shape)], desired_shape)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/keras2onnx/common/interim.py\", line 205, in add_initializer\r\n    tensor = helper.make_tensor(name, onnx_type, shape, content)\r\n  File \"/Users/srashtchi001/Documents/code/project-coda/coda-tensorflow-test-0001-training/venv/lib/python3.7/site-packages/onnxmltools/proto/__init__.py\", line 44, in _make_tensor_fixed\r\n    getattr(tensor, field).extend(vals)\r\nTypeError: None has type NoneType, but expected one of: int, long", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/201", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/201/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/201/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/201/events", "html_url": "https://github.com/onnx/keras-onnx/issues/201", "id": 481151233, "node_id": "MDU6SXNzdWU0ODExNTEyMzM=", "number": 201, "title": "Output name not preserved", "user": {"login": "letmaik", "id": 530988, "node_id": "MDQ6VXNlcjUzMDk4OA==", "avatar_url": "https://avatars1.githubusercontent.com/u/530988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/letmaik", "html_url": "https://github.com/letmaik", "followers_url": "https://api.github.com/users/letmaik/followers", "following_url": "https://api.github.com/users/letmaik/following{/other_user}", "gists_url": "https://api.github.com/users/letmaik/gists{/gist_id}", "starred_url": "https://api.github.com/users/letmaik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/letmaik/subscriptions", "organizations_url": "https://api.github.com/users/letmaik/orgs", "repos_url": "https://api.github.com/users/letmaik/repos", "events_url": "https://api.github.com/users/letmaik/events{/privacy}", "received_events_url": "https://api.github.com/users/letmaik/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-08-15T13:29:31Z", "updated_at": "2019-10-25T11:16:08Z", "closed_at": "2019-10-25T11:16:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "Keras model:\r\n![image](https://user-images.githubusercontent.com/530988/63097607-d4d8e900-bf68-11e9-9b40-9be6ebecd804.png)\r\n\r\nConverted ONNX model:\r\n![image](https://user-images.githubusercontent.com/530988/63097639-e5895f00-bf68-11e9-94b5-607d35dbcd26.png)\r\n\r\nI don't want `y_1/Sigmoid:0` but `y`.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/200", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/200/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/200/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/200/events", "html_url": "https://github.com/onnx/keras-onnx/issues/200", "id": 481104695, "node_id": "MDU6SXNzdWU0ODExMDQ2OTU=", "number": 200, "title": "Conversion with tf.keras not working", "user": {"login": "letmaik", "id": 530988, "node_id": "MDQ6VXNlcjUzMDk4OA==", "avatar_url": "https://avatars1.githubusercontent.com/u/530988?v=4", "gravatar_id": "", "url": "https://api.github.com/users/letmaik", "html_url": "https://github.com/letmaik", "followers_url": "https://api.github.com/users/letmaik/followers", "following_url": "https://api.github.com/users/letmaik/following{/other_user}", "gists_url": "https://api.github.com/users/letmaik/gists{/gist_id}", "starred_url": "https://api.github.com/users/letmaik/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/letmaik/subscriptions", "organizations_url": "https://api.github.com/users/letmaik/orgs", "repos_url": "https://api.github.com/users/letmaik/repos", "events_url": "https://api.github.com/users/letmaik/events{/privacy}", "received_events_url": "https://api.github.com/users/letmaik/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-15T11:12:22Z", "updated_at": "2019-08-16T16:19:46Z", "closed_at": "2019-08-16T16:19:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "```\r\nTraceback (most recent call last):\r\n  File \"test.py\", line 82, in <module>\r\n    linear_regression()\r\n  File \"test.py\", line 79, in linear_regression\r\n    onnx_model = keras2onnx.convert_keras(model)\r\n  File \"/home/.../miniconda3/lib/python3.7/site-packages/keras2onnx/main.py\", line 103, in convert_keras\r\n    return convert_topology(topology, name, doc_string, target_opset, channel_first_inputs)\r\n  File \"/home/.../miniconda3/lib/python3.7/site-packages/keras2onnx/topology.py\", line 225, in convert_topology\r\n    get_converter(operator.type)(scope, operator, container)\r\n  File \"/home/.../miniconda3/lib/python3.7/site-packages/keras2onnx/ke2onnx/dense.py\", line 39, in convert_keras_dense\r\n    apply_activation_function = activation_map[operator.raw_operator.activation]\r\nKeyError: <function relu at 0x7f3f000da6a8>\r\n```\r\n\r\nThe script is the tutorial from https://www.tensorflow.org/tutorials/keras/basic_regression.\r\n\r\nTested with:\r\ntensorflow 1.13.1 and 1.14.0\r\nkeras2onnx 1.5.1\r\nonnx==1.5.0\r\nonnxconverter-common==1.5.3\r\n\r\nI also tried with `TF_KERAS=1` but that didn't make a difference.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/190", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/190/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/190/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/190/events", "html_url": "https://github.com/onnx/keras-onnx/issues/190", "id": 478450637, "node_id": "MDU6SXNzdWU0Nzg0NTA2Mzc=", "number": 190, "title": "Model incorrect after optimization with eliminate_identity", "user": {"login": "reymondzzzz", "id": 15812493, "node_id": "MDQ6VXNlcjE1ODEyNDkz", "avatar_url": "https://avatars0.githubusercontent.com/u/15812493?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reymondzzzz", "html_url": "https://github.com/reymondzzzz", "followers_url": "https://api.github.com/users/reymondzzzz/followers", "following_url": "https://api.github.com/users/reymondzzzz/following{/other_user}", "gists_url": "https://api.github.com/users/reymondzzzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/reymondzzzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reymondzzzz/subscriptions", "organizations_url": "https://api.github.com/users/reymondzzzz/orgs", "repos_url": "https://api.github.com/users/reymondzzzz/repos", "events_url": "https://api.github.com/users/reymondzzzz/events{/privacy}", "received_events_url": "https://api.github.com/users/reymondzzzz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2019-08-08T12:48:41Z", "updated_at": "2019-08-08T18:14:07Z", "closed_at": "2019-08-08T18:14:07Z", "author_association": "NONE", "active_lock_reason": null, "body": "I take onnxconverter-common from master. Convert my nested model from keras to onnx and call checker. All is well. But this model doesn't be optimized.\r\n```\r\nonnx_model = keras2onnx.convert_keras(model, model.name, target_opset=7)\r\npasses = ['eliminate_identity']\r\nonnx_model = onnx.optimizer.optimize(onnx_model, passes)\r\nonnx.checker.check_model(onnx_model)\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/kstarkov/ml/detector/bin/deploy/freeze_model_to_onnx.py\", line 73, in <module>\r\n    onnx.checker.check_model(onnx_model)\r\n  File \"/home/kstarkov/py_envs/p3_keras_tensorflow/lib/python3.6/site-packages/onnx/checker.py\", line 86, in check_model\r\n    C.check_model(model.SerializeToString())\r\nonnx.onnx_cpp2py_export.checker.ValidationError: Field 'shape' of type is required but missing.\r\n```\r\nThis problem only with eliminate_identity. Another passes working is good.\r\nInferenceSession with optimized model falls.\r\n```\r\nonnx_model = onnx.optimizer.optimize(onnx_model, passes)\r\nonnx.save(onnx_model, onnx_output_filename)\r\nsess = rt.InferenceSession(onnx_output_filename)\r\ninput_name = sess.get_inputs()[0].name\r\nonnx_out = sess.run([o.name for o in sess.get_outputs()], {input_name: input_data})\r\n\r\nProcess finished with exit code 139 (interrupted by signal 11: SIGSEGV)\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/188", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/188/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/188/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/188/events", "html_url": "https://github.com/onnx/keras-onnx/issues/188", "id": 477693650, "node_id": "MDU6SXNzdWU0Nzc2OTM2NTA=", "number": 188, "title": "onnx checker error.", "user": {"login": "zerofo", "id": 46804648, "node_id": "MDQ6VXNlcjQ2ODA0NjQ4", "avatar_url": "https://avatars3.githubusercontent.com/u/46804648?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zerofo", "html_url": "https://github.com/zerofo", "followers_url": "https://api.github.com/users/zerofo/followers", "following_url": "https://api.github.com/users/zerofo/following{/other_user}", "gists_url": "https://api.github.com/users/zerofo/gists{/gist_id}", "starred_url": "https://api.github.com/users/zerofo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zerofo/subscriptions", "organizations_url": "https://api.github.com/users/zerofo/orgs", "repos_url": "https://api.github.com/users/zerofo/repos", "events_url": "https://api.github.com/users/zerofo/events{/privacy}", "received_events_url": "https://api.github.com/users/zerofo/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-08-07T03:55:31Z", "updated_at": "2019-08-08T18:16:48Z", "closed_at": "2019-08-08T08:26:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "keras=2.2.4\r\ntensorflow=1.14.0\r\nonnx=1.5.0\r\ntf2onnx=1.5.2/0c735a\r\n\r\n\r\nkeras-onnx=1.5.1\r\nerror\r\n```\r\nTraceback (most recent call last):\r\n  File \"onnxck.py\", line 8, in <module>\r\n    checker.check_graph(model_proto.graph)\r\n  File \"/usr/local/lib/python3.5/dist-packages/onnx/checker.py\", line 52, in checker\r\n    proto.SerializeToString(), ctx)\r\nonnx.onnx_cpp2py_export.checker.ValidationError: Nodes in a graph must be topologically sorted, however input 'block8_sepconv2_act/Relu:0' of node: \r\ninput: \"block8_sepconv2_act/Relu:0\" input: \"W\" output: \"convolution_output\" name: \"block8_sepconv20\" op_type: \"Conv\" attribute { name: \"auto_pad\" s: \"NOTSET\" type: STRING } attribute { name: \"dilations\" ints: 1 ints: 1 type: INTS } attribute { name: \"group\" i: 728 type: INT } attribute { name: \"kernel_shape\" ints: 3 ints: 3 type: INTS } attribute { name: \"pads\" ints: 1 ints: 1 ints: 1 ints: 1 type: INTS } attribute { name: \"strides\" ints: 1 ints: 1 type: INTS } doc_string: \"\" domain: \"\"\r\n is not output of any previous nodes.\r\n```\r\n\r\nkeras-onnx=master(3131d601849ab9332f4551a4b1e7b68b77eec70e) \r\nerror\r\n```\r\nTraceback (most recent call last):\r\n  File \"onnxck.py\", line 8, in <module>\r\n    checker.check_graph(model_proto.graph)\r\n  File \"/usr/local/lib/python3.6/dist-packages/onnx/checker.py\", line 52, in checker\r\n    proto.SerializeToString(), ctx)\r\nonnx.onnx_cpp2py_export.checker.ValidationError: Nodes in a graph must be topologically sorted, however input 'predictions/Softmax:01' of node:\r\ninput: \"predictions/Softmax:01\" output: \"predictions/Softmax:0\" name: \"Identity1\" op_type: \"Identity\" domain: \"\"\r\n is not output of any previous nodes.\r\n```\r\n\r\n\r\nkeras-onnx=1.5.1\r\nlog:\r\n```\r\nnohup: ignoring input\r\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/dtypes.py:516: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/dtypes.py:517: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/dtypes.py:518: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/dtypes.py:519: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/dtypes.py:520: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorflow/python/framework/dtypes.py:525: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorboard/compat/tensorflow_stub/dtypes.py:541: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint8 = np.dtype([(\"qint8\", np.int8, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorboard/compat/tensorflow_stub/dtypes.py:542: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint8 = np.dtype([(\"quint8\", np.uint8, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorboard/compat/tensorflow_stub/dtypes.py:543: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint16 = np.dtype([(\"qint16\", np.int16, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorboard/compat/tensorflow_stub/dtypes.py:544: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_quint16 = np.dtype([(\"quint16\", np.uint16, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorboard/compat/tensorflow_stub/dtypes.py:545: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  _np_qint32 = np.dtype([(\"qint32\", np.int32, 1)])\r\n/usr/local/lib/python3.5/dist-packages/tensorboard/compat/tensorflow_stub/dtypes.py:550: FutureWarning: Passing (type, 1) or '1type' as a synonym of type is deprecated; in a future version of numpy, it will be understood as (type, (1,)) / '(1,)type'.\r\n  np_resource = np.dtype([(\"resource\", np.ubyte, 1)])\r\nUsing TensorFlow backend.\r\nWARNING: Logging before flag parsing goes to stderr.\r\nW0807 03:53:09.633448 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/backend/tensorflow_backend.py:517: The name tf.placeholder is deprecated. Please use tf.compat.v1.placeholder instead.\r\n\r\nW0807 03:53:09.660378 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/backend/tensorflow_backend.py:4138: The name tf.random_uniform is deprecated. Please use tf.random.uniform instead.\r\n\r\nW0807 03:53:09.676919 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/backend/tensorflow_backend.py:245: The name tf.get_default_graph is deprecated. Please use tf.compat.v1.get_default_graph instead.\r\n\r\nW0807 03:53:09.677050 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/backend/tensorflow_backend.py:174: The name tf.get_default_session is deprecated. Please use tf.compat.v1.get_default_session instead.\r\n\r\nW0807 03:53:09.677149 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/backend/tensorflow_backend.py:181: The name tf.ConfigProto is deprecated. Please use tf.compat.v1.ConfigProto instead.\r\n\r\n2019-08-07 03:53:09.677302: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n2019-08-07 03:53:09.682577: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1\r\n2019-08-07 03:53:09.873818: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2019-08-07 03:53:09.884092: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2019-08-07 03:53:09.884616: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x4e4ec90 executing computations on platform CUDA. Devices:\r\n2019-08-07 03:53:09.884639: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): GeForce RTX 2080 Ti, Compute Capability 7.5\r\n2019-08-07 03:53:09.884648: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (1): GeForce RTX 2080 Ti, Compute Capability 7.5\r\n2019-08-07 03:53:09.907276: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3600000000 Hz\r\n2019-08-07 03:53:09.908132: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x4ec1770 executing computations on platform Host. Devices:\r\n2019-08-07 03:53:09.908152: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>\r\n2019-08-07 03:53:09.908385: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2019-08-07 03:53:09.908736: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties: \r\nname: GeForce RTX 2080 Ti major: 7 minor: 5 memoryClockRate(GHz): 1.545\r\npciBusID: 0000:02:00.0\r\n2019-08-07 03:53:09.908799: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero\r\n2019-08-07 03:53:09.909094: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 1 with properties: \r\nname: GeForce RTX 2080 Ti major: 7 minor: 5 memoryClockRate(GHz): 1.545\r\npciBusID: 0000:04:00.0\r\n2019-08-07 03:53:09.909169: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcudart.so.10.0'; dlerror: libcudart.so.10.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 03:53:09.909211: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcublas.so.10.0'; dlerror: libcublas.so.10.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 03:53:09.909249: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcufft.so.10.0'; dlerror: libcufft.so.10.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 03:53:09.909292: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcurand.so.10.0'; dlerror: libcurand.so.10.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 03:53:09.909344: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcusolver.so.10.0'; dlerror: libcusolver.so.10.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 03:53:09.909395: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcusparse.so.10.0'; dlerror: libcusparse.so.10.0: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 03:53:09.912357: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7\r\n2019-08-07 03:53:09.912375: W tensorflow/core/common_runtime/gpu/gpu_device.cc:1663] Cannot dlopen some GPU libraries. Skipping registering GPU devices...\r\n2019-08-07 03:53:09.912467: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2019-08-07 03:53:09.912477: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 1 \r\n2019-08-07 03:53:09.912484: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N N \r\n2019-08-07 03:53:09.912489: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 1:   N N \r\n2019-08-07 03:53:09.931435: W tensorflow/compiler/jit/mark_for_compilation_pass.cc:1412] (One-time warning): Not using XLA:CPU for cluster because envvar TF_XLA_FLAGS=--tf_xla_cpu_global_jit was not set.  If you want XLA:CPU, either set that envvar, or use experimental_jit_scope to enable XLA:CPU.  To confirm that XLA is active, pass --vmodule=xla_compilation_cache=1 (as a proper command-line flag, not via TF_XLA_FLAGS) or set the envvar XLA_FLAGS=--xla_hlo_profile.\r\nW0807 03:53:09.932697 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/backend/tensorflow_backend.py:1834: The name tf.nn.fused_batch_norm is deprecated. Please use tf.compat.v1.nn.fused_batch_norm instead.\r\n\r\nW0807 03:53:10.204029 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/backend/tensorflow_backend.py:3976: The name tf.nn.max_pool is deprecated. Please use tf.nn.max_pool2d instead.\r\n\r\nW0807 03:53:14.803169 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras/optimizers.py:790: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.\r\n\r\nW0807 03:53:14.909497 140050296952576 deprecation.py:323] From /usr/local/lib/python3.5/dist-packages/tensorflow/python/ops/math_grad.py:1250: add_dispatch_support.<locals>.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse tf.where in 2.0, which has the same broadcast rule as np.where\r\nW0807 03:53:19.203876 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras2onnx/common/utils.py:42: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.\r\n\r\nW0807 03:53:19.204049 140050296952576 deprecation_wrapper.py:119] From /usr/local/lib/python3.5/dist-packages/keras2onnx/common/utils.py:42: The name tf.logging.WARN is deprecated. Please use tf.compat.v1.logging.WARN instead.\r\n\r\nI0807 03:53:19.374145 140050296952576 tfonnx.py:475] Using tensorflow=1.14.0, onnx=1.5.0, tf2onnx=1.5.2/0c735a\r\nI0807 03:53:19.374265 140050296952576 tfonnx.py:478] Using opset <onnx, 10>\r\n```\r\n\r\n\r\nkeras-onnx=master(3131d601849ab9332f4551a4b1e7b68b77eec70e) \r\nlog:\r\n```\r\nUsing TensorFlow backend.                                                                                                                    \r\nWARNING: Logging before flag parsing goes to stderr.                                                                                                      \r\nW0807 08:43:46.689901 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/backend/tensorflow_backend.py:517: The name tf.placeholder is deprecated. Please use tf.co\r\nmpat.v1.placeholder instead.                                                                 \r\n                                                                                             \r\nW0807 08:43:46.835546 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/backend/tensorflow_backend.py:4138: The name tf.random_uniform is deprecated. Please use t\r\nf.random.uniform instead.                                                                                                                                                                                     \r\n                                                                                                                                                                                                              \r\nW0807 08:43:46.984462 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/backend/tensorflow_backend.py:245: The name tf.get_default_graph is deprecated. Please use\r\n tf.compat.v1.get_default_graph instead.                                                                                                                                                                     \r\n                                             \r\nW0807 08:43:46.984593 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/backend/tensorflow_backend.py:174: The name tf.get_default_session is deprecated. Please u\r\nse tf.compat.v1.get_default_session instead.                                                                                                                                                                  \r\n                                                                \r\nW0807 08:43:46.984687 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/backend/tensorflow_backend.py:181: The name tf.ConfigProto is deprecated. Please use tf.co\r\nmpat.v1.ConfigProto instead.                                                                                                                                                                                  \r\n                                              \r\n2019-08-07 08:43:46.984846: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA\r\n2019-08-07 08:43:47.055153: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcuda.so.1                                                                  \r\n2019-08-07 08:43:47.241562: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning\r\nNUMA node zero                                                           \r\n2019-08-07 08:43:47.248943: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning\r\nNUMA node zero                                                                                                                                                                                                \r\n2019-08-07 08:43:47.254091: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x2852bd0 executing computations on platform CUDA. Devices:\r\n2019-08-07 08:43:47.254106: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): GeForce RTX 2080 Ti, Compute Capability 7.5\r\n2019-08-07 08:43:47.254111: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (1): GeForce RTX 2080 Ti, Compute Capability 7.5                                                        \r\n2019-08-07 08:43:47.399308: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3600000000 Hz\r\n2019-08-07 08:43:47.400142: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x49c1630 executing computations on platform Host. Devices:                                                         \r\n2019-08-07 08:43:47.400157: I tensorflow/compiler/xla/service/service.cc:175]   StreamExecutor device (0): <undefined>, <undefined>\r\n2019-08-07 08:43:47.400450: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning\r\nNUMA node zero                                                \r\n2019-08-07 08:43:47.400895: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 0 with properties:                                       \r\nname: GeForce RTX 2080 Ti major: 7 minor: 5 memoryClockRate(GHz): 1.545                                                                             \r\npciBusID: 0000:02:00.0                                                                 \r\n2019-08-07 08:43:47.400934: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:1005] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning\r\nNUMA node zero                              \r\n2019-08-07 08:43:47.401334: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1640] Found device 1 with properties:                      \r\nname: GeForce RTX 2080 Ti major: 7 minor: 5 memoryClockRate(GHz): 1.545                                               \r\npciBusID: 0000:04:00.0                             \r\n2019-08-07 08:43:47.401502: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcudart.so.10.0'; dlerror: libcudart.so.10.0: cannot open shared object file: No such\r\nfile or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 08:43:47.401600: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcublas.so.10.0'; dlerror: libcublas.so.10.0: cannot open shared object file: No such\r\nfile or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 08:43:47.401693: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcufft.so.10.0'; dlerror: libcufft.so.10.0: cannot open shared object file: No such fi\r\nle or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 08:43:47.401783: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcurand.so.10.0'; dlerror: libcurand.so.10.0: cannot open shared object file: No such\r\nfile or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 08:43:47.401877: I tensorflow/stream_executor/platform/default/dso_loader.cc:53] Could not dlopen library 'libcusolver.so.10.0'; dlerror: libcusolver.so.10.0: cannot open shared object file: No s\r\nuch file or directory; LD_LIBRARY_PATH: /usr/local/cuda/compat/lib:/usr/local/nvidia/lib:/usr/local/nvidia/lib64:/usr/local/lib\r\n2019-08-07 08:43:47.992670: I tensorflow/stream_executor/platform/default/dso_loader.cc:42] Successfully opened dynamic library libcudnn.so.7\r\n2019-08-07 08:43:47.992697: W tensorflow/core/common_runtime/gpu/gpu_device.cc:1663] Cannot dlopen some GPU libraries. Skipping registering GPU devices...\r\n2019-08-07 08:43:47.992790: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1181] Device interconnect StreamExecutor with strength 1 edge matrix:\r\n2019-08-07 08:43:47.992800: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1187]      0 1\r\n2019-08-07 08:43:47.992804: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 0:   N N\r\n2019-08-07 08:43:47.992808: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1200] 1:   N N\r\n2019-08-07 08:43:48.249990: W tensorflow/compiler/jit/mark_for_compilation_pass.cc:1412] (One-time warning): Not using XLA:CPU for cluster because envvar TF_XLA_FLAGS=--tf_xla_cpu_global_jit was not set.  I\r\nf you want XLA:CPU, either set that envvar, or use experimental_jit_scope to enable XLA:CPU.  To confirm that XLA is active, pass --vmodule=xla_compilation_cache=1 (as a proper command-line flag, not via TF\r\n_XLA_FLAGS) or set the envvar XLA_FLAGS=--xla_hlo_profile.\r\nW0807 08:43:48.309771 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/backend/tensorflow_backend.py:1834: The name tf.nn.fused_batch_norm is deprecated. Please\r\nuse tf.compat.v1.nn.fused_batch_norm instead.\r\n\r\nW0807 08:43:48.606945 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/backend/tensorflow_backend.py:3976: The name tf.nn.max_pool is deprecated. Please use tf.n\r\nn.max_pool2d instead.\r\n\r\nW0807 08:43:53.876969 139915722393408 deprecation_wrapper.py:119] From /usr/local/lib/python3.6/dist-packages/keras/optimizers.py:790: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.trai\r\nn.Optimizer instead.\r\n\r\nW0807 08:43:54.001173 139915722393408 deprecation.py:323] From /usr/local/lib/python3.6/dist-packages/tensorflow/python/ops/math_grad.py:1250: add_dispatch_support.<locals>.wrapper (from tensorflow.python.o\r\nps.array_ops) is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nUse tf.where in 2.0, which has the same broadcast rule as np.where\r\nW0807 08:43:58.845238 139915722393408 deprecation_wrapper.py:119] From /workspace/keras-onnx/keras2onnx/common/utils.py:42: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.s\r\net_verbosity instead.\r\n\r\nW0807 08:43:58.845381 139915722393408 deprecation_wrapper.py:119] From /workspace/keras-onnx/keras2onnx/common/utils.py:42: The name tf.logging.WARN is deprecated. Please use tf.compat.v1.logging.WARN inste\r\nad.\r\n\r\nI0807 08:43:58.995717 139915722393408 tfonnx.py:475] Using tensorflow=1.14.0, onnx=1.5.0, tf2onnx=1.5.2/0c735a\r\nI0807 08:43:58.995810 139915722393408 tfonnx.py:478] Using opset <onnx, 10>\r\n```\r\n\r\n\r\n\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/186", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/186/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/186/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/186/events", "html_url": "https://github.com/onnx/keras-onnx/issues/186", "id": 477484005, "node_id": "MDU6SXNzdWU0Nzc0ODQwMDU=", "number": 186, "title": "Error converting nested models", "user": {"login": "reymondzzzz", "id": 15812493, "node_id": "MDQ6VXNlcjE1ODEyNDkz", "avatar_url": "https://avatars0.githubusercontent.com/u/15812493?v=4", "gravatar_id": "", "url": "https://api.github.com/users/reymondzzzz", "html_url": "https://github.com/reymondzzzz", "followers_url": "https://api.github.com/users/reymondzzzz/followers", "following_url": "https://api.github.com/users/reymondzzzz/following{/other_user}", "gists_url": "https://api.github.com/users/reymondzzzz/gists{/gist_id}", "starred_url": "https://api.github.com/users/reymondzzzz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/reymondzzzz/subscriptions", "organizations_url": "https://api.github.com/users/reymondzzzz/orgs", "repos_url": "https://api.github.com/users/reymondzzzz/repos", "events_url": "https://api.github.com/users/reymondzzzz/events{/privacy}", "received_events_url": "https://api.github.com/users/reymondzzzz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-08-06T16:40:12Z", "updated_at": "2019-09-27T14:55:08Z", "closed_at": "2019-09-27T13:25:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "tf version: 1.14.0\r\nkeras2onnx version: 1.5.1\r\nonnx version: 1.5.0\r\n\r\nHi,\r\n\r\nI want to convert nested keras model\r\n```\r\nfrom __future__ import absolute_import\r\nfrom __future__ import division\r\nfrom __future__ import print_function\r\n\r\nimport os\r\nos.environ['CUDA_VISIBLE_DEVICES'] = '0'\r\nos.environ['TF_KERAS'] = '1'\r\n\r\nimport tensorflow as tf\r\nimport tensorflow.keras.models as KM\r\nimport tensorflow.keras.layers as KL\r\nimport tensorflow.keras.backend as K\r\n\r\nimport keras2onnx\r\nimport onnxruntime\r\nimport numpy as np\r\n\r\nif __name__ == '__main__':\r\n    def _conv_layer(input, filters, kernel_size, strides=1, dilation_rate=1):\r\n        padding = 'same' if strides == 1 else 'valid'\r\n        if strides > 1:\r\n            input = KL.ZeroPadding2D(((0, 1), (0, 1)), data_format=K.image_data_format())(input)\r\n        x = KL.Conv2D(filters=filters, kernel_size=kernel_size, strides=strides,\r\n                      padding=padding, use_bias=False, dilation_rate=dilation_rate)(input)\r\n        ch_axis = 1 if K.image_data_format() == 'channels_first' else -1\r\n        x = KL.BatchNormalization(axis=ch_axis)(x)\r\n        return KL.ReLU()(x)\r\n\r\n    def _model():\r\n        input = KL.Input(shape=(3, 320, 320), name='input_1')\r\n        x = _conv_layer(input, 16, 3)\r\n        return KM.Model(inputs=input, outputs=x, name='backbone')\r\n\r\n    # it not working \r\n    # first option\r\n    input = KL.Input(shape=(3, 320, 320), name='input')\r\n    backbone = _model()\r\n    x = backbone(input)\r\n    x = _conv_layer(x, 16, 3)\r\n    model = KM.Model(inputs=[input], outputs=[x])\r\n    model.summary()\r\n\r\n    # it working\r\n    # second option\r\n    # backbone = _model()\r\n    # x = _conv_layer(backbone.outputs[0], 16, 3)\r\n    # model = KM.Model(inputs=backbone.inputs, outputs=[x])\r\n    # model.summary()\r\n\r\n    onnx_model = keras2onnx.convert_keras(model, model.name, target_opset=7)\r\n```\r\n\r\nI want to save backbone weights separate. Second option doesn't allow this.\r\n```\r\nWARNING: Logging before flag parsing goes to stderr.\r\nW0806 19:33:01.146663 4634232256 deprecation.py:506] From /Users/kirillstarkov/py_envs/ml/lib/python3.7/site-packages/tensorflow/python/ops/init_ops.py:1251: calling VarianceScaling.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.\r\nInstructions for updating:\r\nCall initializer instance with the dtype argument instead of passing it to the constructor\r\nModel: \"model\"\r\n_________________________________________________________________\r\nLayer (type)                 Output Shape              Param #   \r\n=================================================================\r\ninput (InputLayer)           [(None, 3, 320, 320)]     0         \r\n_________________________________________________________________\r\nbackbone (Model)             (None, 3, 320, 16)        46144     \r\n_________________________________________________________________\r\nconv2d_1 (Conv2D)            (None, 3, 320, 16)        2304      \r\n_________________________________________________________________\r\nbatch_normalization_1 (Batch (None, 3, 320, 16)        64        \r\n_________________________________________________________________\r\nre_lu_1 (ReLU)               (None, 3, 320, 16)        0         \r\n=================================================================\r\nTotal params: 48,512\r\nTrainable params: 48,448\r\nNon-trainable params: 64\r\n_________________________________________________________________\r\nW0806 19:33:01.367336 4634232256 deprecation_wrapper.py:119] From /Users/kirillstarkov/py_envs/ml/lib/python3.7/site-packages/keras2onnx/common/utils.py:42: The name tf.logging.set_verbosity is deprecated. Please use tf.compat.v1.logging.set_verbosity instead.\r\n\r\nW0806 19:33:01.367556 4634232256 deprecation_wrapper.py:119] From /Users/kirillstarkov/py_envs/ml/lib/python3.7/site-packages/keras2onnx/common/utils.py:42: The name tf.logging.WARN is deprecated. Please use tf.compat.v1.logging.WARN instead.\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/kirillstarkov/Downloads/freeze_model_to_onnx.py\", line 48, in <module>\r\n    onnx_model = keras2onnx.convert_keras(model, model.name, target_opset=7)\r\n  File \"/Users/kirillstarkov/py_envs/ml/lib/python3.7/site-packages/keras2onnx/main.py\", line 100, in convert_keras\r\n    parse_graph(topology, sess.graph, target_opset, output_names)\r\n  File \"/Users/kirillstarkov/py_envs/ml/lib/python3.7/site-packages/keras2onnx/parser.py\", line 649, in parse_graph\r\n    return _parse_graph_scope(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"/Users/kirillstarkov/py_envs/ml/lib/python3.7/site-packages/keras2onnx/parser.py\", line 601, in _parse_graph_scope\r\n    _convert_keras_scope(graph, nodes, layer_key_, model_, varset)\r\n  File \"/Users/kirillstarkov/py_envs/ml/lib/python3.7/site-packages/keras2onnx/parser.py\", line 179, in _convert_keras_scope\r\n    assert len(node_list) == 0 or node_list[0] in [ts_.op for ts_ in outputs]\r\nAssertionError\r\n\r\nProcess finished with exit code 1\r\n```\r\n\r\nLook's like method build_opdict_from_keras (keras2onnx/ke2onnx/main.py) matches \u00a0layer to model not corrects. keras_layer_ts_map(keras2onnx/parser.py) has 2 same records(backbone/conv2_1/const and conv2_1/const). I think problem in this place \u00a0:) \r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/184", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/184/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/184/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/184/events", "html_url": "https://github.com/onnx/keras-onnx/issues/184", "id": 477008635, "node_id": "MDU6SXNzdWU0NzcwMDg2MzU=", "number": 184, "title": "Converted ONNX model is not topologically sorted", "user": {"login": "benschreiber", "id": 14302940, "node_id": "MDQ6VXNlcjE0MzAyOTQw", "avatar_url": "https://avatars2.githubusercontent.com/u/14302940?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benschreiber", "html_url": "https://github.com/benschreiber", "followers_url": "https://api.github.com/users/benschreiber/followers", "following_url": "https://api.github.com/users/benschreiber/following{/other_user}", "gists_url": "https://api.github.com/users/benschreiber/gists{/gist_id}", "starred_url": "https://api.github.com/users/benschreiber/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benschreiber/subscriptions", "organizations_url": "https://api.github.com/users/benschreiber/orgs", "repos_url": "https://api.github.com/users/benschreiber/repos", "events_url": "https://api.github.com/users/benschreiber/events{/privacy}", "received_events_url": "https://api.github.com/users/benschreiber/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2019-08-05T18:57:24Z", "updated_at": "2019-08-08T18:44:46Z", "closed_at": "2019-08-08T18:44:46Z", "author_association": "NONE", "active_lock_reason": null, "body": "Similar issue to #170. I am trying to convert a Keras model that contains some LSTM layers followed by a TimeDistributed. I am using the latest version of keras2onnx on master, 1.5.2. The model converts without any errors, but when I later use the ONNX model checker on it, there is the output \r\n```\r\nonnx.onnx_cpp2py_export.checker.ValidationError: Nodes in a graph must be topologically sorted, however input 'time_distributed_1/Reshape_1:01' of node: \r\ninput: \"time_distributed_1/Reshape_1:01\" output: \"time_distributed_1/Reshape_1:0\" name: \"Identity1\" op_type: \"Identity\" domain: \"\"\r\n is not output of any previous nodes. \r\n```\r\nWhen I converted the ONNX file to a pbtxt, the Identity node was the first one listed, when it should be at the end.\r\n\r\nHere is my saved model:\r\n[saved_model.zip](https://github.com/onnx/keras-onnx/files/3468957/saved_model.zip)\r\n\r\nUnzip it and run this script to reproduce the behavior:\r\n```\r\nimport keras\r\nimport onnx\r\nimport keras2onnx\r\n\r\nsaved_model = keras.models.load_model('saved_model.h5')\r\nonnx_model = keras2onnx.convert_keras(saved_model, saved_model.name)\r\nonnx.checker.check_model(onnx_model)\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/179", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/179/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/179/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/179/events", "html_url": "https://github.com/onnx/keras-onnx/issues/179", "id": 475714497, "node_id": "MDU6SXNzdWU0NzU3MTQ0OTc=", "number": 179, "title": "assert len(node_list) == 0 or node_list[0] in [ts_.op for ts_ in outputs]", "user": {"login": "christopher5106", "id": 6875375, "node_id": "MDQ6VXNlcjY4NzUzNzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/6875375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/christopher5106", "html_url": "https://github.com/christopher5106", "followers_url": "https://api.github.com/users/christopher5106/followers", "following_url": "https://api.github.com/users/christopher5106/following{/other_user}", "gists_url": "https://api.github.com/users/christopher5106/gists{/gist_id}", "starred_url": "https://api.github.com/users/christopher5106/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/christopher5106/subscriptions", "organizations_url": "https://api.github.com/users/christopher5106/orgs", "repos_url": "https://api.github.com/users/christopher5106/repos", "events_url": "https://api.github.com/users/christopher5106/events{/privacy}", "received_events_url": "https://api.github.com/users/christopher5106/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 12, "created_at": "2019-08-01T14:25:40Z", "updated_at": "2019-08-09T11:51:15Z", "closed_at": "2019-08-09T11:51:15Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nHow can I solve this error:\r\n\r\n```\r\n    onnx_model = keras2onnx.convert_keras(model, model.name, target_opset=7)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/main.py\", line 100, in convert_keras\r\n    parse_graph(topology, sess.graph, target_opset, output_names)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/parser.py\", line 649, in parse_graph\r\n    return _parse_graph_scope(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/parser.py\", line 601, in _parse_graph_scope\r\n    _convert_keras_scope(graph, nodes, layer_key_, model_, varset)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/parser.py\", line 179, in _convert_keras_scope\r\n    assert len(node_list) == 0 or node_list[0] in [ts_.op for ts_ in outputs]\r\nAssertionError\r\n```\r\n\r\nThank you,", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/178", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/178/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/178/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/178/events", "html_url": "https://github.com/onnx/keras-onnx/issues/178", "id": 475619722, "node_id": "MDU6SXNzdWU0NzU2MTk3MjI=", "number": 178, "title": "Can't get the node data type for mask_1/Cast", "user": {"login": "christopher5106", "id": 6875375, "node_id": "MDQ6VXNlcjY4NzUzNzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/6875375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/christopher5106", "html_url": "https://github.com/christopher5106", "followers_url": "https://api.github.com/users/christopher5106/followers", "following_url": "https://api.github.com/users/christopher5106/following{/other_user}", "gists_url": "https://api.github.com/users/christopher5106/gists{/gist_id}", "starred_url": "https://api.github.com/users/christopher5106/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/christopher5106/subscriptions", "organizations_url": "https://api.github.com/users/christopher5106/orgs", "repos_url": "https://api.github.com/users/christopher5106/repos", "events_url": "https://api.github.com/users/christopher5106/events{/privacy}", "received_events_url": "https://api.github.com/users/christopher5106/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-01T11:06:02Z", "updated_at": "2019-08-01T14:27:52Z", "closed_at": "2019-08-01T13:18:56Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi,\r\n\r\nI get the following error during conversion:\r\n\r\n```\r\n    onnx_model = keras2onnx.convert_keras(model, model.name, target_opset=7)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/main.py\", line 100, in convert_keras\r\n    parse_graph(topology, sess.graph, target_opset, output_names)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/parser.py\", line 649, in parse_graph\r\n    return _parse_graph_scope(graph, keras_layer_ts_map, topo, top_level, output_names)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/parser.py\", line 599, in _parse_graph_scope\r\n    _convert_general_scope(nodes, varset)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/parser.py\", line 301, in _convert_general_scope\r\n    subgraph, replacement = create_subgraph(sess.graph, node_list, sess, operator.full_name)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/subgraph.py\", line 128, in create_subgraph\r\n    raise RuntimeError(\"Can't get the node data type for %s\" % input_node.name)\r\nRuntimeError: Can't get the node data type for mask_1/Cast\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/177", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/177/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/177/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/177/events", "html_url": "https://github.com/onnx/keras-onnx/issues/177", "id": 475618704, "node_id": "MDU6SXNzdWU0NzU2MTg3MDQ=", "number": 177, "title": "'NoneType' object has no attribute 'delete_unused_nodes'", "user": {"login": "christopher5106", "id": 6875375, "node_id": "MDQ6VXNlcjY4NzUzNzU=", "avatar_url": "https://avatars0.githubusercontent.com/u/6875375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/christopher5106", "html_url": "https://github.com/christopher5106", "followers_url": "https://api.github.com/users/christopher5106/followers", "following_url": "https://api.github.com/users/christopher5106/following{/other_user}", "gists_url": "https://api.github.com/users/christopher5106/gists{/gist_id}", "starred_url": "https://api.github.com/users/christopher5106/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/christopher5106/subscriptions", "organizations_url": "https://api.github.com/users/christopher5106/orgs", "repos_url": "https://api.github.com/users/christopher5106/repos", "events_url": "https://api.github.com/users/christopher5106/events{/privacy}", "received_events_url": "https://api.github.com/users/christopher5106/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 14, "created_at": "2019-08-01T11:03:48Z", "updated_at": "2019-08-09T11:51:01Z", "closed_at": "2019-08-09T11:51:01Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi, \r\n\r\nWhile I'm able to convert more complex models, on a very simple model I get an error:\r\n\r\n```\r\n    onnx_model = keras2onnx.convert_keras(model, model.name, target_opset=7)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/main.py\", line 103, in convert_keras\r\n    return convert_topology(topology, name, doc_string, target_opset, channel_first_inputs)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/topology.py\", line 225, in convert_topology\r\n    get_converter(operator.type)(scope, operator, container)\r\n  File \"/home/cbo/anaconda3/envs/keras-tf-py36/lib/python3.6/site-packages/keras2onnx/wrapper.py\", line 50, in tfnode_convert\r\n    g.delete_unused_nodes(g.outputs)\r\nAttributeError: 'NoneType' object has no attribute 'delete_unused_nodes'\r\n```\r\n\r\nThank you for your help,\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/onnx/keras-onnx/issues/175", "repository_url": "https://api.github.com/repos/onnx/keras-onnx", "labels_url": "https://api.github.com/repos/onnx/keras-onnx/issues/175/labels{/name}", "comments_url": "https://api.github.com/repos/onnx/keras-onnx/issues/175/comments", "events_url": "https://api.github.com/repos/onnx/keras-onnx/issues/175/events", "html_url": "https://github.com/onnx/keras-onnx/issues/175", "id": 474517258, "node_id": "MDU6SXNzdWU0NzQ1MTcyNTg=", "number": 175, "title": "Bidirectional-GRU", "user": {"login": "mxdilln", "id": 42930462, "node_id": "MDQ6VXNlcjQyOTMwNDYy", "avatar_url": "https://avatars3.githubusercontent.com/u/42930462?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mxdilln", "html_url": "https://github.com/mxdilln", "followers_url": "https://api.github.com/users/mxdilln/followers", "following_url": "https://api.github.com/users/mxdilln/following{/other_user}", "gists_url": "https://api.github.com/users/mxdilln/gists{/gist_id}", "starred_url": "https://api.github.com/users/mxdilln/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mxdilln/subscriptions", "organizations_url": "https://api.github.com/users/mxdilln/orgs", "repos_url": "https://api.github.com/users/mxdilln/repos", "events_url": "https://api.github.com/users/mxdilln/events{/privacy}", "received_events_url": "https://api.github.com/users/mxdilln/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 1165977501, "node_id": "MDU6TGFiZWwxMTY1OTc3NTAx", "url": "https://api.github.com/repos/onnx/keras-onnx/labels/enhancement", "name": "enhancement", "color": "a2eeef", "default": true, "description": "New feature or request"}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2019-07-30T10:58:49Z", "updated_at": "2020-03-25T23:08:38Z", "closed_at": "2020-03-25T23:08:38Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hello, when trying to convert a keras model to onnx I get the following error:\r\n\r\nTypeError: The bidirectional module only works with LSTM in Keras but we got <class 'keras.layers.recurrent.GRU'\r\n\r\nThe GRU unit does work with the bidirectional module in Keras, could this be a bug in the code?\r\n\r\nI note that the issue was reported last month here: https://github.com/onnx/keras-onnx/issues/98#issuecomment-498227397\r\n\r\nThanks!", "performed_via_github_app": null, "score": 1.0}]}