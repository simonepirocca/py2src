{"total_count": 21, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/gristlabs/asttokens/issues/57", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/57/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/57/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/57/events", "html_url": "https://github.com/gristlabs/asttokens/issues/57", "id": 600553821, "node_id": "MDU6SXNzdWU2MDA1NTM4MjE=", "number": 57, "title": "ValueError on list comprehension with Python 3.8", "user": {"login": "mristin", "id": 5072771, "node_id": "MDQ6VXNlcjUwNzI3NzE=", "avatar_url": "https://avatars3.githubusercontent.com/u/5072771?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mristin", "html_url": "https://github.com/mristin", "followers_url": "https://api.github.com/users/mristin/followers", "following_url": "https://api.github.com/users/mristin/following{/other_user}", "gists_url": "https://api.github.com/users/mristin/gists{/gist_id}", "starred_url": "https://api.github.com/users/mristin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mristin/subscriptions", "organizations_url": "https://api.github.com/users/mristin/orgs", "repos_url": "https://api.github.com/users/mristin/repos", "events_url": "https://api.github.com/users/mristin/events{/privacy}", "received_events_url": "https://api.github.com/users/mristin/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-04-15T20:01:36Z", "updated_at": "2020-04-17T05:08:07Z", "closed_at": "2020-04-17T05:08:06Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi!\r\nThe following program causes a ValueError when run with Python 3.8 and asttokens 1.1.15. The problem did not arise with Python 3.6.\r\n\r\n```python\r\nimport asttokens\r\n\r\ntext = '''@invariant(lambda self: all([\" \" not in n for n in self.parts]))\r\ndef dummy(): pass\r\n'''\r\nasttokens.ASTTokens(text, parse=True)\r\n```\r\n\r\nThe error is:\r\n```\r\nTraceback (most recent call last):\r\n  File \"/home/marko/workspace/parquery/icontract/deleteme.py\", line 6, in <module>\r\n    asttokens.ASTTokens(text, parse=True)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/util.py\", line 192, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/mark_tokens.py\", line 90, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/mark_tokens.py\", line 175, in visit_listcomp\r\n    return self.handle_comp('[', node, first_token, last_token)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/mark_tokens.py\", line 171, in handle_comp\r\n    util.expect_token(before, token.OP, open_brace)\r\n  File \"/home/marko/workspace/parquery/icontract/venv/lib/python3.8/site-packages/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token OP:'[', got OP:'(' on line 1 col 28\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/55", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/55/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/55/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/55/events", "html_url": "https://github.com/gristlabs/asttokens/issues/55", "id": 596888029, "node_id": "MDU6SXNzdWU1OTY4ODgwMjk=", "number": 55, "title": "failures with cpython master", "user": {"login": "tacaswell", "id": 199813, "node_id": "MDQ6VXNlcjE5OTgxMw==", "avatar_url": "https://avatars3.githubusercontent.com/u/199813?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tacaswell", "html_url": "https://github.com/tacaswell", "followers_url": "https://api.github.com/users/tacaswell/followers", "following_url": "https://api.github.com/users/tacaswell/following{/other_user}", "gists_url": "https://api.github.com/users/tacaswell/gists{/gist_id}", "starred_url": "https://api.github.com/users/tacaswell/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tacaswell/subscriptions", "organizations_url": "https://api.github.com/users/tacaswell/orgs", "repos_url": "https://api.github.com/users/tacaswell/repos", "events_url": "https://api.github.com/users/tacaswell/events{/privacy}", "received_events_url": "https://api.github.com/users/tacaswell/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2020-04-08T21:56:16Z", "updated_at": "2020-04-22T03:26:41Z", "closed_at": "2020-04-11T14:33:04Z", "author_association": "NONE", "active_lock_reason": null, "body": "There have been changes to the AST upstream in cpython are breaking `asttokens`\r\n\r\n```\r\n====================================================================== short test summary info ======================================================================\r\nFAILED tests/test_astroid.py::TestAstroid::test_complex_slice_and_parens - astroid.exceptions.AstroidSyntaxError: Parsing Python code failed:\r\nFAILED tests/test_astroid.py::TestAstroid::test_fixture9 - AssertionError: 'Slice(\\n   lower=None,\\n   upper=None,\\n   step=None)' != \"Name(name='d')\"\r\nFAILED tests/test_astroid.py::TestAstroid::test_nonascii - astroid.exceptions.AstroidSyntaxError: Parsing Python code failed:\r\nFAILED tests/test_astroid.py::TestAstroid::test_slices - AssertionError: 'Slice(\\n   lower=None,\\n   upper=Const(value=3),\\n   step=None)' != 'Const(value=3)'\r\nFAILED tests/test_astroid.py::TestAstroid::test_sys_modules - AssertionError: \"Slice(\\n   lower=None,\\n   upper=BinOp(\\n[245 chars]one)\" != \"BinOp(\\n   op='-',\\n ...\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_assignment_expressions - ValueError: Expected token NAME:'x', got NAME:'y0' on line 17 col 1\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_complex_slice_and_parens -   File \"<unknown>\", line 2\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_decorators - ValueError: Expected token NAME:'a', got DEDENT:'' on line 12 col 1\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_fixture8 - ValueError: Expected token NAME:'val', got NAME:'autre' on line 53 col 13\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_fixture9 - ValueError: Expected token NAME:'file', got NAME:'e' on line 98 col 1\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_keyword_arg_only - ValueError: Expected token NAME:'x', got NEWLINE:'' on line 2 col 15\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_mark_tokens_simple - ValueError: Expected token NAME:'val', got NAME:'autre' on line 53 col 13\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_nonascii -   File \"<unknown>\", line 2\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_slices -   File \"<unknown>\", line 2\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_sys_modules - ValueError: Expected token NAME:'file', got NAME:'message' on line 235 col 13\r\n```\r\n\r\nIn addition there seems to have been changes that break `asttokens` in a way that breaks `stack-data` which breaks IPython that don't look like they are capture in the tests:\r\n\r\n```pytb\r\nbleeding) \u2718  ~/source/other_source/asttokens [master {origin/master}|\u2714 ]\r\njupiter@17:52  \u27a4  ipython\r\nPython 3.9.0a5+ (heads/master:799d7d61a9, Apr  6 2020, 17:38:49) \r\nType 'copyright', 'credits' or 'license' for more information\r\nIPython 8.0.0.dev -- An enhanced Interactive Python. Type '?' for help.\r\n\r\nIn [1]: 1/0                                                                                                                                                          \r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3331, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-1-9e1622b385b6>\", line 1, in <module>\r\n    1/0\r\nZeroDivisionError: division by zero\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n<snipped>\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 81, in __init__\r\n    self.asttokens()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 336, in asttokens\r\n    return ASTTokens(\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 49, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 186, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 92, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 334, in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token NAME:'co_flags', got NAME:'new_code' on line 144 col 9\r\n\r\n```\r\n\r\n-----\r\n\r\nFull pytest output:\r\n\r\n<details>\r\n\r\n```\r\n(bleeding) \u2718  ~/source/other_source/asttokens [master {origin/master}|\u2714 ]\r\njupiter@17:43  \u27a4  pytest\r\n======================================================================== test session starts ========================================================================\r\nplatform linux -- Python 3.9.0a5+, pytest-5.4.1, py-1.8.1, pluggy-0.13.1\r\nbenchmark: 3.2.3 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)\r\nrootdir: /home/tcaswell/source/other_source/asttokens, inifile: setup.cfg\r\nplugins: cov-2.8.1, rerunfailures-9.0, timeout-1.3.4, forked-1.1.3, xdist-1.31.0, benchmark-3.2.3\r\ncollected 107 items                                                                                                                                                 \r\n\r\ntests/test_astroid.py .........F...s...............F....F.....F..F...                                                                                         [ 43%]\r\ntests/test_asttokens.py ......                                                                                                                                [ 49%]\r\ntests/test_line_numbers.py ...                                                                                                                                [ 52%]\r\ntests/test_mark_tokens.py ...F.....F..F...............FF.F.FF.....F..F...                                                                                     [ 96%]\r\ntests/test_util.py ....                                                                                                                                       [100%]\r\n\r\n============================================================================= FAILURES ==============================================================================\r\n_____________________________________________________________ TestAstroid.test_complex_slice_and_parens _____________________________________________________________\r\n\r\nself = <tests.test_astroid.TestAstroid testMethod=test_complex_slice_and_parens>\r\n\r\n    def test_complex_slice_and_parens(self):\r\n      source = 'f((x)[:, 0])'\r\n>     self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:597: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:43: in create_mark_checker\r\n    checker.verify_all_nodes(self)\r\ntests/tools.py:90: in verify_all_nodes    rebuilt_node = test_case.parse_snippet(text, node)\r\ntests/test_mark_tokens.py:735: in parse_snippet\r\n    return self.module.parse('_\\n(' + text + ')').body[1].value\r\n../../../.virtualenvs/bleeding/lib/python3.9/site-packages/astroid/builder.py:275: in parse\r\n    return builder.string_build(code, modname=module_name, path=path)\r\n../../../.virtualenvs/bleeding/lib/python3.9/site-packages/astroid/builder.py:140: in string_build\r\n    module = self._data_build(data, modname, path)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <astroid.builder.AstroidBuilder object at 0x7fc24d0dc7c0>, data = '_\\n(:, 0)', modname = '', path = None\r\n\r\n    def _data_build(self, data, modname, path):\r\n        \"\"\"Build tree node from data and add some informations\"\"\"\r\n        try:\r\n            node = _parse(data + \"\\n\")\r\n        except (TypeError, ValueError, SyntaxError) as exc:\r\n>           raise exceptions.AstroidSyntaxError(\r\n                \"Parsing Python code failed:\\n{error}\",\r\n                source=data,\r\n                modname=modname,\r\n                path=path,\r\n                error=exc,\r\n            ) from exc\r\nE           astroid.exceptions.AstroidSyntaxError: Parsing Python code failed:\r\nE           invalid syntax (<unknown>, line 2)\r\n\r\n../../../.virtualenvs/bleeding/lib/python3.9/site-packages/astroid/builder.py:168: AstroidSyntaxError\r\n_____________________________________________________________________ TestAstroid.test_fixture9 _____________________________________________________________________\r\n\r\nself = <tests.test_astroid.TestAstroid testMethod=test_fixture9>\r\n\r\n>   def test_fixture9(self): self.verify_fixture_file('astroid/module2.py')\r\n\r\ntests/test_mark_tokens.py:172: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:134: in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\ntests/tools.py:97: in verify_all_nodes\r\n    test_case.assertEqual(\r\nE   AssertionError: 'Slice(\\n   lower=None,\\n   upper=None,\\n   step=None)' != \"Name(name='d')\"\r\nE   + Name(name='d')- Slice(\r\nE   -    lower=None,\r\nE   -    upper=None,\r\nE   -    step=None)\r\n_____________________________________________________________________ TestAstroid.test_nonascii _____________________________________________________________________\r\n\r\nself = <tests.test_astroid.TestAstroid testMethod=test_nonascii>\r\n\r\n    def test_nonascii(self):\r\n      # Test of https://bitbucket.org/plas/thonny/issues/162/weird-range-marker-crash-with-non-ascii\r\n      # Only on PY3 because Py2 doesn't support unicode identifiers.\r\n      for source in (\r\n        \"s\u00fcnnikuup\u00e4ev=str((18+int(isikukood[0:1])-1)//2)+isikukood[1:3]\",\r\n        \"s\u00fcnnikuupaev=str((18+int(isikukood[0:1])-1)//2)+isikukood[1:3]\"):\r\n>       m = self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:286: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:43: in create_mark_checker\r\n    checker.verify_all_nodes(self)\r\ntests/tools.py:90: in verify_all_nodes\r\n    rebuilt_node = test_case.parse_snippet(text, node)\r\ntests/test_mark_tokens.py:735: in parse_snippet\r\n    return self.module.parse('_\\n(' + text + ')').body[1].value\r\n../../../.virtualenvs/bleeding/lib/python3.9/site-packages/astroid/builder.py:275: in parse\r\n    return builder.string_build(code, modname=module_name, path=path)\r\n../../../.virtualenvs/bleeding/lib/python3.9/site-packages/astroid/builder.py:140: in string_build\r\n    module = self._data_build(data, modname, path)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nself = <astroid.builder.AstroidBuilder object at 0x7fc24c4d2670>, data = '_\\n(0:1)', modname = '', path = None\r\n\r\n    def _data_build(self, data, modname, path):\r\n        \"\"\"Build tree node from data and add some informations\"\"\"\r\n        try:\r\n            node = _parse(data + \"\\n\")\r\n        except (TypeError, ValueError, SyntaxError) as exc:\r\n>           raise exceptions.AstroidSyntaxError(\r\n                \"Parsing Python code failed:\\n{error}\",\r\n                source=data,\r\n                modname=modname,\r\n                path=path,\r\n                error=exc,\r\n            ) from exc\r\nE           astroid.exceptions.AstroidSyntaxError: Parsing Python code failed:\r\nE           invalid syntax (<unknown>, line 2)\r\n\r\n../../../.virtualenvs/bleeding/lib/python3.9/site-packages/astroid/builder.py:168: AstroidSyntaxError\r\n______________________________________________________________________ TestAstroid.test_slices ______________________________________________________________________\r\n\r\nself = <tests.test_astroid.TestAstroid testMethod=test_slices>\r\n\r\n    def test_slices(self):\r\n      # Make sure we don't fail on parsing slices of the form `foo[4:]`.\r\n      source = \"(foo.Area_Code, str(foo.Phone)[:3], str(foo.Phone)[3:], foo[:], bar[::2, :], [a[:]][::-1])\"\r\n>     m = self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:230: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:43: in create_mark_checker\r\n    checker.verify_all_nodes(self)\r\ntests/tools.py:97: in verify_all_nodes\r\n    test_case.assertEqual(\r\nE   AssertionError: 'Slice(\\n   lower=None,\\n   upper=Const(value=3),\\n   step=None)' != 'Const(value=3)'\r\nE   + Const(value=3)- Slice(\r\nE   -    lower=None,\r\nE   -    upper=Const(value=3),\r\nE   -    step=None)\r\n___________________________________________________________________ TestAstroid.test_sys_modules ____________________________________________________________________\r\n\r\nself = <tests.test_astroid.TestAstroid testMethod=test_sys_modules>\r\n\r\n    def test_sys_modules(self):\r\n      \"\"\"\r\n      Verify all nodes on source files obtained from sys.modules.\r\n      This can take a long time as there are many modules,\r\n      so it only tests all modules if the environment variable\r\n      ASTTOKENS_SLOW_TESTS has been set.\r\n      \"\"\"\r\n      modules = list(sys.modules.values())\r\n      if not os.environ.get('ASTTOKENS_SLOW_TESTS'):\r\n        modules = modules[:20]\r\n    \r\n      start = time()\r\n      for module in modules:\r\n        # Don't let this test (which runs twice) take longer than 13 minutes\r\n        # to avoid the travis build time limit of 30 minutes\r\n        if time() - start > 13 * 60:\r\n          break\r\n    \r\n        try:\r\n          filename = inspect.getsourcefile(module)\r\n        except TypeError:\r\n          continue\r\n    \r\n        if not filename:\r\n          continue\r\n    \r\n        filename = os.path.abspath(filename)\r\n        print(filename)\r\n        try:\r\n          with io.open(filename) as f:\r\n            source = f.read()\r\n        except OSError:\r\n          continue\r\n    \r\n        # Astroid fails with a syntax error if a type comment is on its own line\r\n        if self.is_astroid_test and re.search(r'^\\s*# type: ', source, re.MULTILINE):\r\n          print('Skipping', filename)\r\n          continue\r\n    \r\n>       self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:639: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:43: in create_mark_checker\r\n    checker.verify_all_nodes(self)\r\ntests/tools.py:97: in verify_all_nodes\r\n    test_case.assertEqual(\r\nE   AssertionError: \"Slice(\\n   lower=None,\\n   upper=BinOp(\\n[245 chars]one)\" != \"BinOp(\\n   op='-',\\n   left=Call(\\n      [172 chars]f'))\"\r\nE   + BinOp(\r\nE   - Slice(\r\nE   -    lower=None,\r\nE   -    upper=BinOp(\r\nE   -       op='-',\r\nE   ? ---\r\nE   +    op='-',\r\nE   -       left=Call(\r\nE   ? ---\r\nE   +    left=Call(\r\nE   -          func=Name(name='len'),\r\nE   ? ---\r\nE   +       func=Name(name='len'),\r\nE   -          args=[Attribute(\r\nE   ? ---\r\nE   +       args=[Attribute(\r\nE   -                attrname='__name__',\r\nE   ? ---\r\nE   +             attrname='__name__',\r\nE   -                expr=Name(name='module'))],\r\nE   ? ---\r\nE   +             expr=Name(name='module'))],\r\nE   -          keywords=None),\r\nE   ? ---\r\nE   +       keywords=None),\r\nE   -       right=Name(name='cut_off')),\r\nE   ? ---                              --\r\nE   +    right=Name(name='cut_off'))-    step=None)\r\n----------------------------------------------------------------------- Captured stdout call ------------------------------------------------------------------------\r\n/home/tcaswell/.pybuild/bleeding/lib/python3.9/importlib/_bootstrap.py\r\n____________________________________________________________ TestMarkTokens.test_assignment_expressions _____________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_assignment_expressions>\r\n\r\n        def test_assignment_expressions(self):\r\n          # From https://www.python.org/dev/peps/pep-0572/\r\n>         self.create_mark_checker(\"\"\"\r\n    # Handle a matched regex\r\n    if (match := pattern.search(data)) is not None:\r\n        # Do something with match\r\n        pass\r\n    \r\n    # A loop that can't be trivially rewritten using 2-arg iter()\r\n    while chunk := file.read(8192):\r\n       process(chunk)\r\n    \r\n    # Reuse a value that's expensive to compute\r\n    [y := f(x), y**2, y**3]\r\n    \r\n    # Share a subexpression between a comprehension filter clause and its output\r\n    filtered_data = [y for x in data if (y := f(x)) is not None]\r\n    \r\n    y0 = (y1 := f(x))  # Valid, though discouraged\r\n    \r\n    foo(x=(y := f(x)))  # Valid, though probably confusing\r\n    \r\n    def foo(answer=(p := 42)):  # Valid, though not great style\r\n        ...\r\n    \r\n    def foo(answer: (p := 42) = 5):  # Valid, but probably never useful\r\n        ...\r\n    \r\n    lambda: (x := 1) # Valid, but unlikely to be useful\r\n    \r\n    (x := lambda: 1) # Valid\r\n    \r\n    lambda line: (m := re.match(pattern, line)) and m.group(1) # Valid\r\n    \r\n    if any((comment := line).startswith('#') for line in lines):\r\n        print(\"First comment:\", comment)\r\n    \r\n    if all((nonblank := line).strip() == '' for line in lines):\r\n        print(\"All lines are blank\")\r\n    \r\n    partial_sums = [total := total + v for v in values]\r\n    \"\"\")\r\n\r\ntests/test_mark_tokens.py:678: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:32: in create_mark_checker\r\n    atok = self.create_asttokens(source)\r\ntests/test_mark_tokens.py:48: in create_asttokens\r\n    return ASTTokens(source, parse=True)\r\nasttokens/asttokens.py:65: in __init__\r\n    self.mark_tokens(self._tree)\r\nasttokens/asttokens.py:76: in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\nasttokens/mark_tokens.py:49: in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\nasttokens/util.py:186: in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\nasttokens/mark_tokens.py:92: in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\nasttokens/mark_tokens.py:334: in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ntoken = Token(type=1, string='y0', start=(17, 0), end=(17, 2), line='y0 = (y1 := f(x))  # Valid, though discouraged\\n', index=92, startpos=435, endpos=437)\r\ntok_type = 1, tok_str = 'x'\r\n\r\n    def expect_token(token, tok_type, tok_str=None):\r\n      \"\"\"\r\n      Verifies that the given token is of the expected type. If tok_str is given, the token string\r\n      is verified too. If the token doesn't match, raises an informative ValueError.\r\n      \"\"\"\r\n      if not match_token(token, tok_type, tok_str):\r\n>       raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\n          token_repr(tok_type, tok_str), str(token),\r\n          token.start[0], token.start[1] + 1))\r\nE       ValueError: Expected token NAME:'x', got NAME:'y0' on line 17 col 1\r\n\r\nasttokens/util.py:56: ValueError\r\n___________________________________________________________ TestMarkTokens.test_complex_slice_and_parens ____________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_complex_slice_and_parens>\r\n\r\n    def test_complex_slice_and_parens(self):\r\n      source = 'f((x)[:, 0])'\r\n>     self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:597: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:43: in create_mark_checker\r\n    checker.verify_all_nodes(self)\r\ntests/tools.py:90: in verify_all_nodes\r\n    rebuilt_node = test_case.parse_snippet(text, node)\r\ntests/test_mark_tokens.py:735: in parse_snippet\r\n    return self.module.parse('_\\n(' + text + ')').body[1].value\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nsource = '_\\n(:, 0)', filename = '<unknown>', mode = 'exec'\r\n\r\n    def parse(source, filename='<unknown>', mode='exec', *,\r\n              type_comments=False, feature_version=None):\r\n        \"\"\"\r\n        Parse the source into an AST node.\r\n        Equivalent to compile(source, filename, mode, PyCF_ONLY_AST).\r\n        Pass type_comments=True to get back type comments where the syntax allows.\r\n        \"\"\"\r\n        flags = PyCF_ONLY_AST\r\n        if type_comments:\r\n            flags |= PyCF_TYPE_COMMENTS\r\n        if isinstance(feature_version, tuple):\r\n            major, minor = feature_version  # Should be a 2-tuple.\r\n            assert major == 3\r\n            feature_version = minor\r\n        elif feature_version is None:\r\n            feature_version = -1\r\n        # Else it should be an int giving the minor version for 3.x.\r\n>       return compile(source, filename, mode, flags,\r\n                       _feature_version=feature_version)\r\nE         File \"<unknown>\", line 2\r\nE           (:, 0)\r\nE            ^\r\nE       SyntaxError: invalid syntax\r\n\r\n../../../.pybuild/bleeding/lib/python3.9/ast.py:50: SyntaxError\r\n__________________________________________________________________ TestMarkTokens.test_decorators ___________________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_decorators>\r\n\r\n    def test_decorators(self):\r\n      # See https://bitbucket.org/plas/thonny/issues/49/range-marker-fails-with-decorators\r\n      source = textwrap.dedent(\"\"\"\r\n        @deco1\r\n        def f():\r\n          pass\r\n        @deco2(a=1)\r\n        def g(x):\r\n          pass\r\n    \r\n        @deco3()\r\n        def g(x):\r\n          pass\r\n      \"\"\")\r\n>     m = self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:491: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:32: in create_mark_checker\r\n    atok = self.create_asttokens(source)\r\ntests/test_mark_tokens.py:48: in create_asttokens\r\n    return ASTTokens(source, parse=True)\r\nasttokens/asttokens.py:65: in __init__\r\n    self.mark_tokens(self._tree)\r\nasttokens/asttokens.py:76: in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\nasttokens/mark_tokens.py:49: in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\nasttokens/util.py:186: in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\nasttokens/mark_tokens.py:92: in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\nasttokens/mark_tokens.py:334: in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ntoken = Token(type=6, string='', start=(12, 0), end=(12, 0), line='', index=49, startpos=80, endpos=80), tok_type = 1, tok_str = 'a'\r\n\r\n    def expect_token(token, tok_type, tok_str=None):\r\n      \"\"\"\r\n      Verifies that the given token is of the expected type. If tok_str is given, the token string\r\n      is verified too. If the token doesn't match, raises an informative ValueError.\r\n      \"\"\"\r\n      if not match_token(token, tok_type, tok_str):\r\n>       raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\n          token_repr(tok_type, tok_str), str(token),\r\n          token.start[0], token.start[1] + 1))\r\nE       ValueError: Expected token NAME:'a', got DEDENT:'' on line 12 col 1\r\n\r\nasttokens/util.py:56: ValueError\r\n___________________________________________________________________ TestMarkTokens.test_fixture8 ____________________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_fixture8>\r\n\r\n>   def test_fixture8(self): self.verify_fixture_file('astroid/module.py')\r\n\r\ntests/test_mark_tokens.py:171: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:133: in verify_fixture_file\r\n    m = self.create_mark_checker(source, verify=False)\r\ntests/test_mark_tokens.py:32: in create_mark_checker\r\n    atok = self.create_asttokens(source)\r\ntests/test_mark_tokens.py:48: in create_asttokens\r\n    return ASTTokens(source, parse=True)\r\nasttokens/asttokens.py:65: in __init__\r\n    self.mark_tokens(self._tree)\r\nasttokens/asttokens.py:76: in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\nasttokens/mark_tokens.py:49: in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\nasttokens/util.py:186: in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\nasttokens/mark_tokens.py:92: in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\nasttokens/mark_tokens.py:334: in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ntoken = Token(type=1, string='autre', start=(53, 12), end=(53, 17), line='            autre = [a for (a, b) in MY_DICT if b]\\n', index=224, startpos=967, endpos=972)\r\ntok_type = 1, tok_str = 'val'\r\n\r\n    def expect_token(token, tok_type, tok_str=None):\r\n      \"\"\"\r\n      Verifies that the given token is of the expected type. If tok_str is given, the token string\r\n      is verified too. If the token doesn't match, raises an informative ValueError.\r\n      \"\"\"\r\n      if not match_token(token, tok_type, tok_str):\r\n>       raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\n          token_repr(tok_type, tok_str), str(token),\r\n          token.start[0], token.start[1] + 1))\r\nE       ValueError: Expected token NAME:'val', got NAME:'autre' on line 53 col 13\r\n\r\nasttokens/util.py:56: ValueError\r\n___________________________________________________________________ TestMarkTokens.test_fixture9 ____________________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_fixture9>\r\n\r\n>   def test_fixture9(self): self.verify_fixture_file('astroid/module2.py')\r\n\r\ntests/test_mark_tokens.py:172: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:133: in verify_fixture_file\r\n    m = self.create_mark_checker(source, verify=False)\r\ntests/test_mark_tokens.py:32: in create_mark_checker\r\n    atok = self.create_asttokens(source)\r\ntests/test_mark_tokens.py:48: in create_asttokens\r\n    return ASTTokens(source, parse=True)\r\nasttokens/asttokens.py:65: in __init__\r\n    self.mark_tokens(self._tree)\r\nasttokens/asttokens.py:76: in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\nasttokens/mark_tokens.py:49: in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\nasttokens/util.py:186: in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\nasttokens/mark_tokens.py:92: in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\nasttokens/mark_tokens.py:334: in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ntoken = Token(type=1, string='e', start=(98, 0), end=(98, 1), line='e = d[a:b:c]\\n', index=476, startpos=1233, endpos=1234), tok_type = 1, tok_str = 'file'\r\n\r\n    def expect_token(token, tok_type, tok_str=None):\r\n      \"\"\"\r\n      Verifies that the given token is of the expected type. If tok_str is given, the token string\r\n      is verified too. If the token doesn't match, raises an informative ValueError.\r\n      \"\"\"\r\n      if not match_token(token, tok_type, tok_str):\r\n>       raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\n          token_repr(tok_type, tok_str), str(token),\r\n          token.start[0], token.start[1] + 1))\r\nE       ValueError: Expected token NAME:'file', got NAME:'e' on line 98 col 1\r\n\r\nasttokens/util.py:56: ValueError\r\n_______________________________________________________________ TestMarkTokens.test_keyword_arg_only ________________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_keyword_arg_only>\r\n\r\n    def test_keyword_arg_only(self):\r\n      # See https://bitbucket.org/plas/thonny/issues/52/range-marker-fails-with-ridastrip-split\r\n      source = \"f(x=1)\\ng(a=(x),b=[y])\"\r\n>     m = self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:460: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:32: in create_mark_checker\r\n    atok = self.create_asttokens(source)\r\ntests/test_mark_tokens.py:48: in create_asttokens\r\n    return ASTTokens(source, parse=True)\r\nasttokens/asttokens.py:65: in __init__\r\n    self.mark_tokens(self._tree)\r\nasttokens/asttokens.py:76: in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\nasttokens/mark_tokens.py:49: in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\nasttokens/util.py:186: in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\nasttokens/mark_tokens.py:92: in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\nasttokens/mark_tokens.py:334: in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ntoken = Token(type=4, string='', start=(2, 14), end=(2, 15), line='', index=21, startpos=21, endpos=21), tok_type = 1, tok_str = 'x'\r\n\r\n    def expect_token(token, tok_type, tok_str=None):\r\n      \"\"\"\r\n      Verifies that the given token is of the expected type. If tok_str is given, the token string\r\n      is verified too. If the token doesn't match, raises an informative ValueError.\r\n      \"\"\"\r\n      if not match_token(token, tok_type, tok_str):\r\n>       raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\n          token_repr(tok_type, tok_str), str(token),\r\n          token.start[0], token.start[1] + 1))\r\nE       ValueError: Expected token NAME:'x', got NEWLINE:'' on line 2 col 15\r\n\r\nasttokens/util.py:56: ValueError\r\n______________________________________________________________ TestMarkTokens.test_mark_tokens_simple _______________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_mark_tokens_simple>\r\n\r\n    def test_mark_tokens_simple(self):\r\n      source = tools.read_fixture('astroid', 'module.py')\r\n>     m = self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:73: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:32: in create_mark_checker\r\n    atok = self.create_asttokens(source)\r\ntests/test_mark_tokens.py:48: in create_asttokens\r\n    return ASTTokens(source, parse=True)\r\nasttokens/asttokens.py:65: in __init__\r\n    self.mark_tokens(self._tree)\r\nasttokens/asttokens.py:76: in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\nasttokens/mark_tokens.py:49: in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\nasttokens/util.py:186: in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\nasttokens/mark_tokens.py:92: in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\nasttokens/mark_tokens.py:334: in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ntoken = Token(type=1, string='autre', start=(53, 12), end=(53, 17), line='            autre = [a for (a, b) in MY_DICT if b]\\n', index=224, startpos=967, endpos=972)\r\ntok_type = 1, tok_str = 'val'\r\n\r\n    def expect_token(token, tok_type, tok_str=None):\r\n      \"\"\"\r\n      Verifies that the given token is of the expected type. If tok_str is given, the token string\r\n      is verified too. If the token doesn't match, raises an informative ValueError.\r\n      \"\"\"\r\n      if not match_token(token, tok_type, tok_str):\r\n>       raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\n          token_repr(tok_type, tok_str), str(token),\r\n          token.start[0], token.start[1] + 1))\r\nE       ValueError: Expected token NAME:'val', got NAME:'autre' on line 53 col 13\r\n\r\nasttokens/util.py:56: ValueError\r\n___________________________________________________________________ TestMarkTokens.test_nonascii ____________________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_nonascii>\r\n\r\n    def test_nonascii(self):\r\n      # Test of https://bitbucket.org/plas/thonny/issues/162/weird-range-marker-crash-with-non-ascii\r\n      # Only on PY3 because Py2 doesn't support unicode identifiers.\r\n      for source in (\r\n        \"s\u00fcnnikuup\u00e4ev=str((18+int(isikukood[0:1])-1)//2)+isikukood[1:3]\",\r\n        \"s\u00fcnnikuupaev=str((18+int(isikukood[0:1])-1)//2)+isikukood[1:3]\"):\r\n>       m = self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:286: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:43: in create_mark_checker\r\n    checker.verify_all_nodes(self)\r\ntests/tools.py:90: in verify_all_nodes\r\n    rebuilt_node = test_case.parse_snippet(text, node)\r\ntests/test_mark_tokens.py:735: in parse_snippet\r\n    return self.module.parse('_\\n(' + text + ')').body[1].value\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nsource = '_\\n(0:1)', filename = '<unknown>', mode = 'exec'\r\n\r\n    def parse(source, filename='<unknown>', mode='exec', *,\r\n              type_comments=False, feature_version=None):\r\n        \"\"\"\r\n        Parse the source into an AST node.\r\n        Equivalent to compile(source, filename, mode, PyCF_ONLY_AST).\r\n        Pass type_comments=True to get back type comments where the syntax allows.\r\n        \"\"\"\r\n        flags = PyCF_ONLY_AST\r\n        if type_comments:\r\n            flags |= PyCF_TYPE_COMMENTS\r\n        if isinstance(feature_version, tuple):\r\n            major, minor = feature_version  # Should be a 2-tuple.\r\n            assert major == 3\r\n            feature_version = minor\r\n        elif feature_version is None:\r\n            feature_version = -1\r\n        # Else it should be an int giving the minor version for 3.x.\r\n>       return compile(source, filename, mode, flags,\r\n                       _feature_version=feature_version)\r\nE         File \"<unknown>\", line 2\r\nE           (0:1)\r\nE             ^\r\nE       SyntaxError: invalid syntax\r\n\r\n../../../.pybuild/bleeding/lib/python3.9/ast.py:50: SyntaxError\r\n____________________________________________________________________ TestMarkTokens.test_slices _____________________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_slices>\r\n\r\n    def test_slices(self):\r\n      # Make sure we don't fail on parsing slices of the form `foo[4:]`.\r\n      source = \"(foo.Area_Code, str(foo.Phone)[:3], str(foo.Phone)[3:], foo[:], bar[::2, :], [a[:]][::-1])\"\r\n>     m = self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:230: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:43: in create_mark_checker\r\n    checker.verify_all_nodes(self)\r\ntests/tools.py:90: in verify_all_nodes\r\n    rebuilt_node = test_case.parse_snippet(text, node)\r\ntests/test_mark_tokens.py:735: in parse_snippet\r\n    return self.module.parse('_\\n(' + text + ')').body[1].value\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\nsource = '_\\n(:3)', filename = '<unknown>', mode = 'exec'\r\n\r\n    def parse(source, filename='<unknown>', mode='exec', *,\r\n              type_comments=False, feature_version=None):\r\n        \"\"\"\r\n        Parse the source into an AST node.\r\n        Equivalent to compile(source, filename, mode, PyCF_ONLY_AST).\r\n        Pass type_comments=True to get back type comments where the syntax allows.\r\n        \"\"\"\r\n        flags = PyCF_ONLY_AST\r\n        if type_comments:\r\n            flags |= PyCF_TYPE_COMMENTS\r\n        if isinstance(feature_version, tuple):\r\n            major, minor = feature_version  # Should be a 2-tuple.\r\n            assert major == 3\r\n            feature_version = minor\r\n        elif feature_version is None:\r\n            feature_version = -1\r\n        # Else it should be an int giving the minor version for 3.x.\r\n>       return compile(source, filename, mode, flags,\r\n                       _feature_version=feature_version)\r\nE         File \"<unknown>\", line 2\r\nE           (:3)\r\nE            ^\r\nE       SyntaxError: invalid syntax\r\n\r\n../../../.pybuild/bleeding/lib/python3.9/ast.py:50: SyntaxError\r\n__________________________________________________________________ TestMarkTokens.test_sys_modules __________________________________________________________________\r\n\r\nself = <tests.test_mark_tokens.TestMarkTokens testMethod=test_sys_modules>\r\n\r\n    def test_sys_modules(self):\r\n      \"\"\"\r\n      Verify all nodes on source files obtained from sys.modules.\r\n      This can take a long time as there are many modules,\r\n      so it only tests all modules if the environment variable\r\n      ASTTOKENS_SLOW_TESTS has been set.\r\n      \"\"\"\r\n      modules = list(sys.modules.values())\r\n      if not os.environ.get('ASTTOKENS_SLOW_TESTS'):\r\n        modules = modules[:20]\r\n    \r\n      start = time()\r\n      for module in modules:\r\n        # Don't let this test (which runs twice) take longer than 13 minutes\r\n        # to avoid the travis build time limit of 30 minutes\r\n        if time() - start > 13 * 60:\r\n          break\r\n    \r\n        try:\r\n          filename = inspect.getsourcefile(module)\r\n        except TypeError:\r\n          continue\r\n    \r\n        if not filename:\r\n          continue\r\n    \r\n        filename = os.path.abspath(filename)\r\n        print(filename)\r\n        try:\r\n          with io.open(filename) as f:\r\n            source = f.read()\r\n        except OSError:\r\n          continue\r\n    \r\n        # Astroid fails with a syntax error if a type comment is on its own line\r\n        if self.is_astroid_test and re.search(r'^\\s*# type: ', source, re.MULTILINE):\r\n          print('Skipping', filename)\r\n          continue\r\n    \r\n>       self.create_mark_checker(source)\r\n\r\ntests/test_mark_tokens.py:639: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\ntests/test_mark_tokens.py:32: in create_mark_checker\r\n    atok = self.create_asttokens(source)\r\ntests/test_mark_tokens.py:48: in create_asttokens\r\n    return ASTTokens(source, parse=True)\r\nasttokens/asttokens.py:65: in __init__\r\n    self.mark_tokens(self._tree)\r\nasttokens/asttokens.py:76: in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\nasttokens/mark_tokens.py:49: in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\nasttokens/util.py:186: in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\nasttokens/mark_tokens.py:92: in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\nasttokens/mark_tokens.py:334: in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\r\n\r\ntoken = Token(type=1, string='message', start=(235, 12), end=(235, 19), line=\"            message = '# ' + message\\n\", index=1087, startpos=7481, endpos=7488)\r\ntok_type = 1, tok_str = 'file'\r\n\r\n    def expect_token(token, tok_type, tok_str=None):\r\n      \"\"\"\r\n      Verifies that the given token is of the expected type. If tok_str is given, the token string\r\n      is verified too. If the token doesn't match, raises an informative ValueError.\r\n      \"\"\"\r\n      if not match_token(token, tok_type, tok_str):\r\n>       raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\n          token_repr(tok_type, tok_str), str(token),\r\n          token.start[0], token.start[1] + 1))\r\nE       ValueError: Expected token NAME:'file', got NAME:'message' on line 235 col 13\r\n\r\nasttokens/util.py:56: ValueError\r\n----------------------------------------------------------------------- Captured stdout call ------------------------------------------------------------------------\r\n/home/tcaswell/.pybuild/bleeding/lib/python3.9/importlib/_bootstrap.py\r\n====================================================================== short test summary info ======================================================================\r\nFAILED tests/test_astroid.py::TestAstroid::test_complex_slice_and_parens - astroid.exceptions.AstroidSyntaxError: Parsing Python code failed:\r\nFAILED tests/test_astroid.py::TestAstroid::test_fixture9 - AssertionError: 'Slice(\\n   lower=None,\\n   upper=None,\\n   step=None)' != \"Name(name='d')\"\r\nFAILED tests/test_astroid.py::TestAstroid::test_nonascii - astroid.exceptions.AstroidSyntaxError: Parsing Python code failed:\r\nFAILED tests/test_astroid.py::TestAstroid::test_slices - AssertionError: 'Slice(\\n   lower=None,\\n   upper=Const(value=3),\\n   step=None)' != 'Const(value=3)'\r\nFAILED tests/test_astroid.py::TestAstroid::test_sys_modules - AssertionError: \"Slice(\\n   lower=None,\\n   upper=BinOp(\\n[245 chars]one)\" != \"BinOp(\\n   op='-',\\n ...\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_assignment_expressions - ValueError: Expected token NAME:'x', got NAME:'y0' on line 17 col 1\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_complex_slice_and_parens -   File \"<unknown>\", line 2\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_decorators - ValueError: Expected token NAME:'a', got DEDENT:'' on line 12 col 1\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_fixture8 - ValueError: Expected token NAME:'val', got NAME:'autre' on line 53 col 13\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_fixture9 - ValueError: Expected token NAME:'file', got NAME:'e' on line 98 col 1\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_keyword_arg_only - ValueError: Expected token NAME:'x', got NEWLINE:'' on line 2 col 15\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_mark_tokens_simple - ValueError: Expected token NAME:'val', got NAME:'autre' on line 53 col 13\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_nonascii -   File \"<unknown>\", line 2\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_slices -   File \"<unknown>\", line 2\r\nFAILED tests/test_mark_tokens.py::TestMarkTokens::test_sys_modules - ValueError: Expected token NAME:'file', got NAME:'message' on line 235 col 13\r\n======================================================== 15 failed, 91 passed, 1 skipped, 1 warning in 6.23s ========================================================\r\n\r\n```\r\n\r\n</details>\r\n\r\n----\r\n\r\nfull IPython traceback\r\n\r\n<details>\r\n\r\n```\r\n(bleeding) \u2718  ~/source/other_source/asttokens [master {origin/master}|\u2714 ]\r\njupiter@17:52  \u27a4  ipython\r\nPython 3.9.0a5+ (heads/master:799d7d61a9, Apr  6 2020, 17:38:49) \r\nType 'copyright', 'credits' or 'license' for more information\r\nIPython 8.0.0.dev -- An enhanced Interactive Python. Type '?' for help.\r\n\r\nIn [1]: 1/0                                                                                                                                                          \r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3331, in run_code\r\n    exec(code_obj, self.user_global_ns, self.user_ns)\r\n  File \"<ipython-input-1-9e1622b385b6>\", line 1, in <module>\r\n    1/0\r\nZeroDivisionError: division by zero\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2044, in showtraceback\r\n    stb = value._render_traceback_()\r\nAttributeError: 'ZeroDivisionError' object has no attribute '_render_traceback_'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 261, in executing\r\n    args = executing_cache[key]\r\nKeyError: (<code object run_code at 0x7faaade683a0, file \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3293>, 140371038733216, 142)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3254, in run_ast_nodes\r\n    if (await self.run_code(code, result,  async_=asy)):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3348, in run_code\r\n    self.showtraceback(running_compiled_code=True)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2046, in showtraceback\r\n    stb = self.InteractiveTB.structured_traceback(etype,\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 977, in structured_traceback\r\n    return FormattedTB.structured_traceback(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 877, in structured_traceback\r\n    return VerboseTB.structured_traceback(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 734, in structured_traceback\r\n    formatted_exception = self.format_exception_as_a_whole(etype, evalue, etb, number_of_lines_of_context,\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 700, in format_exception_as_a_whole\r\n    records = self.get_records(etb, number_of_lines_of_context, tb_offset)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 728, in get_records\r\n    return list(stack_data.FrameInfo.stack_data(etb, options=options))[tb_offset:]\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 543, in stack_data\r\n    yield from collapse_repeated(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/utils.py\", line 80, in collapse_repeated\r\n    yield from map(mapper, original_group)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 533, in mapper\r\n    return cls(f, options)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 498, in __init__\r\n    self.executing = Source.executing(frame_or_tb)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 263, in executing\r\n    source = cls.for_frame(frame)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 212, in for_frame\r\n    return cls.for_filename(frame.f_code.co_filename, frame.f_globals or {})\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 225, in for_filename\r\n    result = source_cache[filename] = cls(filename, lines)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 81, in __init__\r\n    self.asttokens()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 336, in asttokens\r\n    return ASTTokens(\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 49, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 186, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 92, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 334, in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token NAME:'co_flags', got NAME:'new_code' on line 144 col 9\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2044, in showtraceback\r\n    stb = value._render_traceback_()\r\nAttributeError: 'ValueError' object has no attribute '_render_traceback_'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 261, in executing\r\n    args = executing_cache[key]\r\nKeyError: (<code object run_ast_nodes at 0x7faaade68240, file \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3142>, 140371038732864, 690)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2886, in _run_cell\r\n    return runner(coro)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/async_helpers.py\", line 68, in _pseudo_sync_runner\r\n    coro.send(None)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3062, in run_cell_async\r\n    has_raised = await self.run_ast_nodes(code_ast.body, cell_name,\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 3273, in run_ast_nodes\r\n    self.showtraceback()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2046, in showtraceback\r\n    stb = self.InteractiveTB.structured_traceback(etype,\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 977, in structured_traceback\r\n    return FormattedTB.structured_traceback(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 877, in structured_traceback\r\n    return VerboseTB.structured_traceback(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 734, in structured_traceback\r\n    formatted_exception = self.format_exception_as_a_whole(etype, evalue, etb, number_of_lines_of_context,\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 700, in format_exception_as_a_whole\r\n    records = self.get_records(etb, number_of_lines_of_context, tb_offset)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 728, in get_records\r\n    return list(stack_data.FrameInfo.stack_data(etb, options=options))[tb_offset:]\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 543, in stack_data\r\n    yield from collapse_repeated(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/utils.py\", line 80, in collapse_repeated\r\n    yield from map(mapper, original_group)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 533, in mapper\r\n    return cls(f, options)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 498, in __init__\r\n    self.executing = Source.executing(frame_or_tb)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 263, in executing\r\n    source = cls.for_frame(frame)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 212, in for_frame\r\n    return cls.for_filename(frame.f_code.co_filename, frame.f_globals or {})\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 225, in for_filename\r\n    result = source_cache[filename] = cls(filename, lines)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 81, in __init__\r\n    self.asttokens()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 336, in asttokens\r\n    return ASTTokens(\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 49, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 186, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 92, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 334, in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token NAME:'co_flags', got NAME:'new_code' on line 144 col 9\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2044, in showtraceback\r\n    stb = value._render_traceback_()\r\nAttributeError: 'ValueError' object has no attribute '_render_traceback_'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 261, in executing\r\n    args = executing_cache[key]\r\nKeyError: (<code object _run_cell at 0x7faaade60a80, file \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2865>, 140371038702208, 60)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/bin/ipython\", line 8, in <module>\r\n    sys.exit(start_ipython())\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/__init__.py\", line 126, in start_ipython\r\n    return launch_new_instance(argv=argv, **kwargs)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/traitlets/config/application.py\", line 664, in launch_instance\r\n    app.start()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/terminal/ipapp.py\", line 356, in start\r\n    self.shell.mainloop()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/terminal/interactiveshell.py\", line 559, in mainloop\r\n    self.interact()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/terminal/interactiveshell.py\", line 550, in interact\r\n    self.run_cell(code, store_history=True)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2857, in run_cell\r\n    result = self._run_cell(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2891, in _run_cell\r\n    self.showtraceback(running_compiled_code=True)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/interactiveshell.py\", line 2046, in showtraceback\r\n    stb = self.InteractiveTB.structured_traceback(etype,\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 977, in structured_traceback\r\n    return FormattedTB.structured_traceback(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 877, in structured_traceback\r\n    return VerboseTB.structured_traceback(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 734, in structured_traceback\r\n    formatted_exception = self.format_exception_as_a_whole(etype, evalue, etb, number_of_lines_of_context,\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 700, in format_exception_as_a_whole\r\n    records = self.get_records(etb, number_of_lines_of_context, tb_offset)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/IPython/core/ultratb.py\", line 728, in get_records\r\n    return list(stack_data.FrameInfo.stack_data(etb, options=options))[tb_offset:]\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 543, in stack_data\r\n    yield from collapse_repeated(\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/utils.py\", line 80, in collapse_repeated\r\n    yield from map(mapper, original_group)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 533, in mapper\r\n    return cls(f, options)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 498, in __init__\r\n    self.executing = Source.executing(frame_or_tb)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 263, in executing\r\n    source = cls.for_frame(frame)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 212, in for_frame\r\n    return cls.for_filename(frame.f_code.co_filename, frame.f_globals or {})\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 225, in for_filename\r\n    result = source_cache[filename] = cls(filename, lines)\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/stack_data/core.py\", line 81, in __init__\r\n    self.asttokens()\r\n  File \"/home/tcaswell/.virtualenvs/bleeding/lib/python3.9/site-packages/executing.py\", line 336, in asttokens\r\n    return ASTTokens(\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 49, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 186, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 92, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/mark_tokens.py\", line 334, in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n  File \"/home/tcaswell/source/other_source/asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token NAME:'co_flags', got NAME:'new_code' on line 144 col 9\r\n\r\nIf you suspect this is an IPython 8.0.0.dev bug, please report it at:\r\n    https://github.com/ipython/ipython/issues\r\nor send an email to the mailing list at ipython-dev@python.org\r\n\r\nYou can print a more detailed traceback right now with \"%tb\", or use \"%debug\"\r\nto interactively debug it.\r\n\r\nExtra-detailed tracebacks for bug-reporting purposes can be enabled via:\r\n    %config Application.verbose_crash=True\r\n```\r\n\r\n</details>\r\n\r\n\r\n----\r\n\r\nattn @alexmojaki @Carreau", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/53", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/53/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/53/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/53/events", "html_url": "https://github.com/gristlabs/asttokens/issues/53", "id": 573535889, "node_id": "MDU6SXNzdWU1NzM1MzU4ODk=", "number": 53, "title": "Statements with semicolons", "user": {"login": "alexmojaki", "id": 3627481, "node_id": "MDQ6VXNlcjM2Mjc0ODE=", "avatar_url": "https://avatars0.githubusercontent.com/u/3627481?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexmojaki", "html_url": "https://github.com/alexmojaki", "followers_url": "https://api.github.com/users/alexmojaki/followers", "following_url": "https://api.github.com/users/alexmojaki/following{/other_user}", "gists_url": "https://api.github.com/users/alexmojaki/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexmojaki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexmojaki/subscriptions", "organizations_url": "https://api.github.com/users/alexmojaki/orgs", "repos_url": "https://api.github.com/users/alexmojaki/repos", "events_url": "https://api.github.com/users/alexmojaki/events{/privacy}", "received_events_url": "https://api.github.com/users/alexmojaki/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-03-01T12:12:27Z", "updated_at": "2020-03-01T22:17:15Z", "closed_at": "2020-03-01T22:17:14Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Putting multiple statements on a line with semicolons causes `get_text` to return the full line when given a statement, e.g:\r\n\r\n```python\r\nimport ast\r\n\r\nimport asttokens\r\n\r\nsource = \"\"\"\r\na; b\r\n\"\"\"\r\natok = asttokens.ASTTokens(source, parse=True)\r\nstmt = atok.tree.body[0]\r\nprint(ast.dump(stmt))         # Expr(value=Name(id='a', ctx=Load()))\r\nprint(atok.get_text(stmt))    # a; b\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/48", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/48/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/48/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/48/events", "html_url": "https://github.com/gristlabs/asttokens/issues/48", "id": 545001027, "node_id": "MDU6SXNzdWU1NDUwMDEwMjc=", "number": 48, "title": "Misannotation of comma token type as 54 not 53 when running Python 3.8", "user": {"login": "lmmx", "id": 2979452, "node_id": "MDQ6VXNlcjI5Nzk0NTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/2979452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/lmmx", "html_url": "https://github.com/lmmx", "followers_url": "https://api.github.com/users/lmmx/followers", "following_url": "https://api.github.com/users/lmmx/following{/other_user}", "gists_url": "https://api.github.com/users/lmmx/gists{/gist_id}", "starred_url": "https://api.github.com/users/lmmx/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/lmmx/subscriptions", "organizations_url": "https://api.github.com/users/lmmx/orgs", "repos_url": "https://api.github.com/users/lmmx/repos", "events_url": "https://api.github.com/users/lmmx/events{/privacy}", "received_events_url": "https://api.github.com/users/lmmx/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2020-01-03T13:50:45Z", "updated_at": "2020-03-01T18:46:52Z", "closed_at": "2020-03-01T18:46:52Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi there, thanks so much for writing this library :smile: I've used it within my library [mvdef](https://github.com/lmmx/mvdef) to get per-token column/line locations for tasks like identifying exactly where names and commas are in import statements while walking the AST of a program, to then be able to rearrange, rewrite, and move those import statements and function definitions between files in a well-organised way.\r\n\r\nWhile working with your library though (in fact, just at the point of testing it on the original application that made me set out to write the library in the first place \u2013 I didn't have any trouble whatsoever with asttokens before now), I encountered a bug, which I've managed to reproduce in Python 3.8 (not sure what might be causing that I'm afraid, the code in question being tokenised is fully 3.7 compliant).\r\n\r\nIt's not catastrophic, but when I processed the AST of a generated line of code, its tokenised representation had commas as type 54 not 53. I simply added a check in case the type was not 53 to look for type 54 and just continued with the code, like I say it's not a catastrophic error.\r\n\r\n`asttokens.asttokens.token.tok_name` identifies these two different numbers as indicating:\r\n- `53: 'OP'`\r\n- `54: 'ERRORTOKEN'`\r\n\r\nFrom my attempts to reproduce a minimal example, I think this only occurs with Python 3.8\r\n\r\nHere is a sample run in a Python 3.7 conda env (i.e. note that `tko.tokens[4].type` is `53`)\r\n\r\n```\r\n>>> import asttokens\r\n>>> mystr = \"from A import B, C\"\r\n>>> tko = asttokens.ASTTokens(mystr)\r\n>>> for t in tko.tokens: t\r\n...\r\nToken(type=1, string='from', start=(1, 0), end=(1, 4), line='from A import B, C', index=0, startpos=0, endpos=4)\r\nToken(type=1, string='A', start=(1, 5), end=(1, 6), line='from A import B, C', index=1, startpos=5, endpos=6)\r\nToken(type=1, string='import', start=(1, 7), end=(1, 13), line='from A import B, C', index=2, startpos=7, endpos=13)\r\nToken(type=1, string='B', start=(1, 14), end=(1, 15), line='from A import B, C', index=3, startpos=14, endpos=15)\r\nToken(type=53, string=',', start=(1, 15), end=(1, 16), line='from A import B, C', index=4, startpos=15, endpos=16)\r\nToken(type=1, string='C', start=(1, 17), end=(1, 18), line='from A import B, C', index=5, startpos=17, endpos=18)\r\nToken(type=4, string='', start=(1, 18), end=(1, 19), line='', index=6, startpos=18, endpos=18)\r\nToken(type=0, string='', start=(2, 0), end=(2, 0), line='', index=7, startpos=18, endpos=18)\r\n```\r\n\r\nAnd here is the same code run in a Python 3.8 conda env (i.e. note that `tko.tokens[4].type` is `54`)\r\n\r\n```\r\n>>> import asttokens\r\n>>> mystr = \"from A import B, C\"\r\n>>> tko = asttokens.ASTTokens(mystr)\r\n>>> for t in tko.tokens: t\r\n... \r\nToken(type=1, string='from', start=(1, 0), end=(1, 4), line='from A import B, C', index=0, startpos=0, endpos=4)\r\nToken(type=1, string='A', start=(1, 5), end=(1, 6), line='from A import B, C', index=1, startpos=5, endpos=6)\r\nToken(type=1, string='import', start=(1, 7), end=(1, 13), line='from A import B, C', index=2, startpos=7, endpos=13)\r\nToken(type=1, string='B', start=(1, 14), end=(1, 15), line='from A import B, C', index=3, startpos=14, endpos=15)\r\nToken(type=54, string=',', start=(1, 15), end=(1, 16), line='from A import B, C', index=4, startpos=15, endpos=16)\r\nToken(type=1, string='C', start=(1, 17), end=(1, 18), line='from A import B, C', index=5, startpos=17, endpos=18)\r\nToken(type=4, string='', start=(1, 18), end=(1, 19), line='', index=6, startpos=18, endpos=18)\r\nToken(type=0, string='', start=(2, 0), end=(2, 0), line='', index=7, startpos=18, endpos=18)\r\n```\r\n\r\nI hope this is enough info for you to investigate, and do let me know if I can supply any more info.\r\n\r\nThanks again for developing this library, I've been recommending it to other devs :+1:", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/47", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/47/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/47/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/47/events", "html_url": "https://github.com/gristlabs/asttokens/issues/47", "id": 540814337, "node_id": "MDU6SXNzdWU1NDA4MTQzMzc=", "number": 47, "title": "elif node will start in elif keyword in next Python versions", "user": {"login": "aivarannamaa", "id": 1802, "node_id": "MDQ6VXNlcjE4MDI=", "avatar_url": "https://avatars0.githubusercontent.com/u/1802?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aivarannamaa", "html_url": "https://github.com/aivarannamaa", "followers_url": "https://api.github.com/users/aivarannamaa/followers", "following_url": "https://api.github.com/users/aivarannamaa/following{/other_user}", "gists_url": "https://api.github.com/users/aivarannamaa/gists{/gist_id}", "starred_url": "https://api.github.com/users/aivarannamaa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aivarannamaa/subscriptions", "organizations_url": "https://api.github.com/users/aivarannamaa/orgs", "repos_url": "https://api.github.com/users/aivarannamaa/repos", "events_url": "https://api.github.com/users/aivarannamaa/events{/privacy}", "received_events_url": "https://api.github.com/users/aivarannamaa/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-12-20T07:09:10Z", "updated_at": "2019-12-20T10:04:43Z", "closed_at": "2019-12-20T10:04:43Z", "author_association": "NONE", "active_lock_reason": null, "body": "I noticed this change https://bugs.python.org/issue39031. Not sure how it affects asttokens, but I thought I'll notify you just in case.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/35", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/35/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/35/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/35/events", "html_url": "https://github.com/gristlabs/asttokens/issues/35", "id": 498318727, "node_id": "MDU6SXNzdWU0OTgzMTg3Mjc=", "number": 35, "title": "IndexError on f((x)[:, 0])", "user": {"login": "ssbr", "id": 356788, "node_id": "MDQ6VXNlcjM1Njc4OA==", "avatar_url": "https://avatars2.githubusercontent.com/u/356788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssbr", "html_url": "https://github.com/ssbr", "followers_url": "https://api.github.com/users/ssbr/followers", "following_url": "https://api.github.com/users/ssbr/following{/other_user}", "gists_url": "https://api.github.com/users/ssbr/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssbr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssbr/subscriptions", "organizations_url": "https://api.github.com/users/ssbr/orgs", "repos_url": "https://api.github.com/users/ssbr/repos", "events_url": "https://api.github.com/users/ssbr/events{/privacy}", "received_events_url": "https://api.github.com/users/ssbr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-09-25T14:19:47Z", "updated_at": "2019-10-07T03:12:18Z", "closed_at": "2019-10-07T03:12:18Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I've had this for a while but only now found the time to boil down to a minimal reproducing case. :X\r\n\r\nReproducer:\r\n\r\n```py\r\nimport asttokens\r\nasttokens.ASTTokens('f((x)[:, 0])', parse=True)\r\n```\r\n\r\nRunning this file gives:\r\n\r\n```pytb\r\nTraceback (most recent call last):\r\n  File \"/tmp/reproducer.py\", line 2, in <module>\r\n    asttokens.ASTTokens('f((x)[:, 0])', parse=True)\r\n  File \"asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \"asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \"asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \"asttokens/util.py\", line 192, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \"asttokens/mark_tokens.py\", line 87, in _visit_after_children\r\n    first, last = self._expand_to_matching_pairs(first, last, node)\r\n  File \"asttokens/mark_tokens.py\", line 142, in _expand_to_matching_pairs\r\n    last = self._code.next_token(last_token)\r\n  File \"asttokens/asttokens.py\", line 141, in next_token\r\n    while is_non_coding_token(self._tokens[i].type):\r\nIndexError: list index out of range\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/32", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/32/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/32/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/32/events", "html_url": "https://github.com/gristlabs/asttokens/issues/32", "id": 492997938, "node_id": "MDU6SXNzdWU0OTI5OTc5Mzg=", "number": 32, "title": "List comprehensions with numpy-like indexing raises ValueError", "user": {"login": "Varal7", "id": 8019486, "node_id": "MDQ6VXNlcjgwMTk0ODY=", "avatar_url": "https://avatars0.githubusercontent.com/u/8019486?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Varal7", "html_url": "https://github.com/Varal7", "followers_url": "https://api.github.com/users/Varal7/followers", "following_url": "https://api.github.com/users/Varal7/following{/other_user}", "gists_url": "https://api.github.com/users/Varal7/gists{/gist_id}", "starred_url": "https://api.github.com/users/Varal7/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Varal7/subscriptions", "organizations_url": "https://api.github.com/users/Varal7/orgs", "repos_url": "https://api.github.com/users/Varal7/repos", "events_url": "https://api.github.com/users/Varal7/events{/privacy}", "received_events_url": "https://api.github.com/users/Varal7/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2019-09-12T19:53:07Z", "updated_at": "2019-09-13T15:24:10Z", "closed_at": "2019-09-13T15:24:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "I am trying to parse the following minimal example:\r\n\r\n```python\r\nimport numpy as np\r\n\r\nxs = np.arange(8).reshape(2, 2, 2)\r\nsteps = 2\r\n\r\ndef get_steps(xs, steps):\r\n    return [xs[:, step, :] for step in range(steps)]\r\n\r\nprint(get_steps(xs, steps))\r\n```\r\n\r\nI am using the following code\r\n\r\n```python\r\nimport ast\r\nimport asttokens\r\n\r\ncode=\"\"\"\r\nimport numpy as np\r\n\r\nxs = np.arange(8).reshape(2, 2, 2)\r\nsteps = 2\r\n\r\ndef get_steps(xs, steps):\r\n    return [xs[:, step, :] for step in range(steps)]\r\n\r\nprint(get_steps(xs, steps))\r\n\"\"\"\r\n\r\ndef parse_ast(code):\r\n    tree = ast.parse(code)\r\n    return tree\r\n\r\ndef parse_asttokens(code):\r\n    tree = asttokens.ASTTokens(code, parse=True).tree\r\n    return tree\r\n\r\n\r\nparse_ast(code)\r\nparse_asttokens(code)\r\n```\r\n\r\nThis fails with a `ValueError`: `Expected token OP:'[', got NAME:'return' on line 8 col 5`\r\n\r\nI have tried looking at the internals of the the library but did not manage to understand why the `before` tokens falls out of the list comprehension", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/31", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/31/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/31/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/31/events", "html_url": "https://github.com/gristlabs/asttokens/issues/31", "id": 483036791, "node_id": "MDU6SXNzdWU0ODMwMzY3OTE=", "number": 31, "title": "asttokens doesn't include the trailing paren in a call like `f({1: (2), 3: 4}, object())`", "user": {"login": "ssbr", "id": 356788, "node_id": "MDQ6VXNlcjM1Njc4OA==", "avatar_url": "https://avatars2.githubusercontent.com/u/356788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssbr", "html_url": "https://github.com/ssbr", "followers_url": "https://api.github.com/users/ssbr/followers", "following_url": "https://api.github.com/users/ssbr/following{/other_user}", "gists_url": "https://api.github.com/users/ssbr/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssbr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssbr/subscriptions", "organizations_url": "https://api.github.com/users/ssbr/orgs", "repos_url": "https://api.github.com/users/ssbr/repos", "events_url": "https://api.github.com/users/ssbr/events{/privacy}", "received_events_url": "https://api.github.com/users/ssbr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2019-08-20T19:19:15Z", "updated_at": "2019-09-25T00:59:07Z", "closed_at": "2019-09-25T00:59:07Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```python\r\n>>> def printbad(text):\r\n  astt = asttokens.ASTTokens(text, parse=True)\r\n  n = astt.tree.body[0].value  # the Call node\r\n  print(astt.text[n.first_token.startpos: n.last_token.endpos])\r\n... \r\n\r\n>>> printbad('f({1: (2), 3: 4}, object())')  # bad\r\nf({1: (2), 3: 4}, object()\r\n\r\n>>> printbad('f({1: (2), 3: 4}, object)')    # good\r\nf({1: (2), 3: 4}, object)\r\n```\r\n\r\nSomething about having a dict literal and parentheses inside the dict literal confuses asttokens, so that it is wrong about the end of the call expression and grabs the wrong parenthesis token.\r\n\r\n(I attempted to minimize further, but without much luck.)", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/28", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/28/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/28/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/28/events", "html_url": "https://github.com/gristlabs/asttokens/issues/28", "id": 430484313, "node_id": "MDU6SXNzdWU0MzA0ODQzMTM=", "number": 28, "title": "Astroid 2.2 and Python 3.8 test failures", "user": {"login": "hroncok", "id": 2401856, "node_id": "MDQ6VXNlcjI0MDE4NTY=", "avatar_url": "https://avatars2.githubusercontent.com/u/2401856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hroncok", "html_url": "https://github.com/hroncok", "followers_url": "https://api.github.com/users/hroncok/followers", "following_url": "https://api.github.com/users/hroncok/following{/other_user}", "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}", "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions", "organizations_url": "https://api.github.com/users/hroncok/orgs", "repos_url": "https://api.github.com/users/hroncok/repos", "events_url": "https://api.github.com/users/hroncok/events{/privacy}", "received_events_url": "https://api.github.com/users/hroncok/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 13, "created_at": "2019-04-08T14:29:40Z", "updated_at": "2019-10-24T08:00:59Z", "closed_at": "2019-10-24T08:00:59Z", "author_association": "NONE", "active_lock_reason": null, "body": "The test suite fails with Python 3.8.0a3:\r\n\r\nOn c8697dcf799a63d432727abb1d972adb3e85970a with:\r\n\r\n```patch\r\ndiff --git a/tox.ini b/tox.ini\r\nindex b320505..30652a5 100644\r\n--- a/tox.ini\r\n+++ b/tox.ini\r\n@@ -4,7 +4,7 @@\r\n # and then run \"tox\" from this directory.\r\n \r\n [tox]\r\n-envlist = py{27,35,36,37}\r\n+envlist = py{27,35,36,37,38}\r\n \r\n [testenv]\r\n commands = nosetests\r\n@@ -13,4 +13,4 @@ deps =\r\n     coverage\r\n     py{27}: astroid\r\n     py{35,36}: astroid<2\r\n-    py{37}: astroid>=2.dev\r\n+    py{37,38}: astroid>=2.dev\r\n```\r\n\r\n```\r\n$ tox -e py38\r\nGLOB sdist-make: .../asttokens/setup.py\r\npy38 inst-nodeps: .../asttokens/.tox/.tmp/package/1/asttokens-1.1.13.zip\r\npy38 installed: astroid==2.2.5,asttokens==1.1.13,coverage==4.5.3,lazy-object-proxy==1.3.1,nose==1.3.7,six==1.12.0,typed-ast==1.3.1,wrapt==1.11.1\r\npy38 run-test-pre: PYTHONHASHSEED='707348335'\r\npy38 runtests: commands[0] | nosetests\r\n..E...S..E.FF..F.FEEE....E.EEE.....F.......FEEFFFF.E........EEE.FFEE.EEEF....F.\r\n======================================================================\r\nERROR: test_calling_lambdas (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 353, in test_calling_lambdas\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 385, in visit_call\r\n    newnode.postinit(self.visit(node.func, newnode), args, keywords)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 699, in visit_lambda\r\n    newnode.postinit(self.visit(node.args, newnode), self.visit(node.body, newnode))\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_fixture10 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 147, in test_fixture10\r\n    def test_fixture10(self): self.verify_fixture_file('astroid/noendingnewline.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 652, in visit_if\r\n    self.visit(node.test, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 438, in visit_compare\r\n    [\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 439, in <listcomp>\r\n    (self._cmp_op_classes[op.__class__], self.visit(expr, newnode))\r\nKeyError: <class '_ast.Eq'>\r\n\r\n======================================================================\r\nERROR: test_fixture7 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 144, in test_fixture7\r\n    def test_fixture7(self): self.verify_fixture_file('astroid/format.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 716, in visit_listcomp\r\n    [self.visit(child, newnode) for child in node.generators],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 716, in <listcomp>\r\n    [self.visit(child, newnode) for child in node.generators],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 451, in visit_comprehension\r\n    [self.visit(child, newnode) for child in node.ifs],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 451, in <listcomp>\r\n    [self.visit(child, newnode) for child in node.ifs],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Mod'>\r\n\r\n======================================================================\r\nERROR: test_fixture8 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 145, in test_fixture8\r\n    def test_fixture8(self): self.verify_fixture_file('astroid/module.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 1031, in visit_classdef\r\n    return super(TreeRebuilder3, self).visit_classdef(\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 404, in visit_classdef\r\n    [self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 404, in <listcomp>\r\n    [self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 607, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in _visit_functiondef\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 982, in visit_try\r\n    body = [self.visit(child, newnode) for child in node.body]\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 982, in <listcomp>\r\n    body = [self.visit(child, newnode) for child in node.body]\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 652, in visit_if\r\n    self.visit(node.test, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 438, in visit_compare\r\n    [\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 439, in <listcomp>\r\n    (self._cmp_op_classes[op.__class__], self.visit(expr, newnode))\r\nKeyError: <class '_ast.In'>\r\n\r\n======================================================================\r\nERROR: test_fixture9 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 146, in test_fixture9\r\n    def test_fixture9(self): self.verify_fixture_file('astroid/module2.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.BitOr'>\r\n\r\n======================================================================\r\nERROR: test_nonascii (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 264, in test_nonascii\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_parens_around_func (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 515, in test_parens_around_func\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 385, in visit_call\r\n    newnode.postinit(self.visit(node.func, newnode), args, keywords)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 342, in visit_boolop\r\n    self._bool_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Or'>\r\n\r\n======================================================================\r\nERROR: test_print_function (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 250, in test_print_function\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 986, in visit_try\r\n    return self.visit_tryexcept(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 847, in visit_tryexcept\r\n    [self.visit(child, newnode) for child in node.handlers],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 847, in <listcomp>\r\n    [self.visit(child, newnode) for child in node.handlers],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 942, in visit_excepthandler\r\n    [self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 942, in <listcomp>\r\n    [self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 607, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in _visit_functiondef\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 560, in visit_for\r\n    return self._visit_for(nodes.For, node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 553, in _visit_for\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 553, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 313, in visit_augassign\r\n    self._bin_op_classes[type(node.op)] + \"=\",\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_return_annotation (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 403, in test_return_annotation\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 607, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in _visit_functiondef\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 803, in visit_return\r\n    newnode.postinit(self.visit(node.value, newnode))\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_calling_lambdas (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 353, in test_calling_lambdas\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 385, in visit_call\r\n    newnode.postinit(self.visit(node.func, newnode), args, keywords)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 699, in visit_lambda\r\n    newnode.postinit(self.visit(node.args, newnode), self.visit(node.body, newnode))\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_comprehensions (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 369, in test_comprehensions\r\n    m = self.create_mark_checker(source)\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 21, in create_mark_checker\r\n    return tools.MarkChecker(source, parse=True)\r\n  File \".../asttokens/tests/tools.py\", line 82, in __init__\r\n    self.atok = asttokens.ASTTokens(source, parse=parse, tree=tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \".../asttokens/asttokens/util.py\", line 184, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 90, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 175, in visit_listcomp\r\n    return self.handle_comp('[', node, first_token, last_token)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 171, in handle_comp\r\n    util.expect_token(before, token.OP, open_brace)\r\n  File \".../asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token OP:'[', got ENDMARKER:'' on line 2 col 1\r\n\r\n======================================================================\r\nERROR: test_fixture10 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 147, in test_fixture10\r\n    def test_fixture10(self): self.verify_fixture_file('astroid/noendingnewline.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 652, in visit_if\r\n    self.visit(node.test, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 438, in visit_compare\r\n    [\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 439, in <listcomp>\r\n    (self._cmp_op_classes[op.__class__], self.visit(expr, newnode))\r\nKeyError: <class '_ast.Eq'>\r\n\r\n======================================================================\r\nERROR: test_fixture7 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 144, in test_fixture7\r\n    def test_fixture7(self): self.verify_fixture_file('astroid/format.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    m = self.create_mark_checker(source)\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 21, in create_mark_checker\r\n    return tools.MarkChecker(source, parse=True)\r\n  File \".../asttokens/tests/tools.py\", line 82, in __init__\r\n    self.atok = asttokens.ASTTokens(source, parse=parse, tree=tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \".../asttokens/asttokens/util.py\", line 184, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 90, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 175, in visit_listcomp\r\n    return self.handle_comp('[', node, first_token, last_token)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 171, in handle_comp\r\n    util.expect_token(before, token.OP, open_brace)\r\n  File \".../asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token OP:'[', got OP:'=' on line 7 col 3\r\n\r\n======================================================================\r\nERROR: test_fixture8 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 145, in test_fixture8\r\n    def test_fixture8(self): self.verify_fixture_file('astroid/module.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    m = self.create_mark_checker(source)\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 21, in create_mark_checker\r\n    return tools.MarkChecker(source, parse=True)\r\n  File \".../asttokens/tests/tools.py\", line 82, in __init__\r\n    self.atok = asttokens.ASTTokens(source, parse=parse, tree=tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \".../asttokens/asttokens/util.py\", line 184, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 90, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 175, in visit_listcomp\r\n    return self.handle_comp('[', node, first_token, last_token)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 171, in handle_comp\r\n    util.expect_token(before, token.OP, open_brace)\r\n  File \".../asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token OP:'[', got OP:'=' on line 53 col 19\r\n\r\n======================================================================\r\nERROR: test_fixture9 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 146, in test_fixture9\r\n    def test_fixture9(self): self.verify_fixture_file('astroid/module2.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.BitOr'>\r\n\r\n======================================================================\r\nERROR: test_mark_tokens_simple (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 47, in test_mark_tokens_simple\r\n    m = self.create_mark_checker(source)\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 21, in create_mark_checker\r\n    return tools.MarkChecker(source, parse=True)\r\n  File \".../asttokens/tests/tools.py\", line 82, in __init__\r\n    self.atok = asttokens.ASTTokens(source, parse=parse, tree=tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 65, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 76, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \".../asttokens/asttokens/util.py\", line 184, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 90, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 175, in visit_listcomp\r\n    return self.handle_comp('[', node, first_token, last_token)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 171, in handle_comp\r\n    util.expect_token(before, token.OP, open_brace)\r\n  File \".../asttokens/asttokens/util.py\", line 56, in expect_token\r\n    raise ValueError(\"Expected token %s, got %s on line %s col %s\" % (\r\nValueError: Expected token OP:'[', got OP:'=' on line 53 col 19\r\n\r\n======================================================================\r\nERROR: test_nonascii (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 264, in test_nonascii\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_parens_around_func (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 515, in test_parens_around_func\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 294, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 385, in visit_call\r\n    newnode.postinit(self.visit(node.func, newnode), args, keywords)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 342, in visit_boolop\r\n    self._bool_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Or'>\r\n\r\n======================================================================\r\nERROR: test_print_function (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 250, in test_print_function\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 986, in visit_try\r\n    return self.visit_tryexcept(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 847, in visit_tryexcept\r\n    [self.visit(child, newnode) for child in node.handlers],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 847, in <listcomp>\r\n    [self.visit(child, newnode) for child in node.handlers],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 942, in visit_excepthandler\r\n    [self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 942, in <listcomp>\r\n    [self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 607, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in _visit_functiondef\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 560, in visit_for\r\n    return self._visit_for(nodes.For, node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 553, in _visit_for\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 553, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 313, in visit_augassign\r\n    self._bin_op_classes[type(node.op)] + \"=\",\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_return_annotation (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 403, in test_return_annotation\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    left = to_source(rebuilt_node)\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 158, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 607, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in _visit_functiondef\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 597, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 803, in visit_return\r\n    newnode.postinit(self.visit(node.value, newnode))\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 170, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py38/lib/python3.8/site-packages/astroid/rebuilder.py\", line 332, in visit_binop\r\n    self._bin_op_classes[type(node.op)], node.lineno, node.col_offset, parent\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nFAIL: test_fixture12 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 149, in test_fixture12\r\n    def test_fixture12(self): self.verify_fixture_file('astroid/recursion.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 131, in verify_all_nodes\r\n    test_case.assertEqual(left, right)\r\nAssertionError: \"' For issue #25 '\\n\\n\\nclass Base(object):\\n    pass\\n\\n\\n\" != '\"\"\" For issue #25 \"\"\"\\n\\n\\n\\nclass Base(object):\\n    pass\\n\\n\\n'\r\n- ' For issue #25 '\r\n? ^               ^\r\n+ \"\"\" For issue #25 \"\"\"\r\n? ^^^               ^^^\r\n+ \r\n  \r\n  \r\n  class Base(object):\r\n      pass\r\n  \r\n  \r\n\r\n\r\n======================================================================\r\nFAIL: test_fixture13 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 150, in test_fixture13\r\n    def test_fixture13(self): self.verify_fixture_file('astroid/suppliermodule_test.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 131, in verify_all_nodes\r\n    test_case.assertEqual(left, right)\r\nAssertionError: \"' file suppliermodule.py '\\n\\n\\nclass No[229 chars]\\n\\n\" != '\"\"\" file suppliermodule.py \"\"\"\\n\\n\\n\\ncl[235 chars]\\n\\n'\r\n- ' file suppliermodule.py '\r\n? ^                        ^\r\n+ \"\"\" file suppliermodule.py \"\"\"\r\n? ^^^                        ^^^\r\n+ \r\n  \r\n  \r\n  class NotImplemented(Exception):\r\n      pass\r\n  \r\n  \r\n  \r\n  class Interface:\r\n      \r\n      def get_value(self):\r\n          raise NotImplemented()\r\n      \r\n      def set_value(self, value):\r\n          raise NotImplemented()\r\n  \r\n  \r\n  \r\n  class DoNothing:\r\n      pass\r\n  \r\n  \r\n\r\n\r\n======================================================================\r\nFAIL: test_fixture4 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 141, in test_fixture4\r\n    def test_fixture4(self): self.verify_fixture_file('astroid/clientmodule_test.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 131, in verify_all_nodes\r\n    test_case.assertEqual(left, right)\r\nAssertionError: '\\' docstring for file clientmodule.py \\'\\[819 chars]\\n\\n' != '\"\"\" docstring for file clientmodule.py \"\"[827 chars]\\n\\n'\r\nDiff is 1219 characters long. Set self.maxDiff to None to see it.\r\n\r\n======================================================================\r\nFAIL: test_fixture6 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 143, in test_fixture6\r\n    def test_fixture6(self): self.verify_fixture_file('astroid/email.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 108, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 131, in verify_all_nodes\r\n    test_case.assertEqual(left, right)\r\nAssertionError: '\"fake email module to test absolute import doesn\\'t grab this one\"\\n\\n' != '\"\"\"fake email module to test absolute import doesn\\'t grab this one\"\"\"\\n\\n\\n\\n'\r\n- \"fake email module to test absolute import doesn't grab this one\"\r\n+ \"\"\"fake email module to test absolute import doesn't grab this one\"\"\"\r\n? ++                                                                 ++\r\n  \r\n+ \r\n+ \r\n\r\n\r\n======================================================================\r\nFAIL: test_to_source (tests.test_asttokens.TestASTTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_asttokens.py\", line 91, in test_to_source\r\n    self.assertEqual(tools.to_source(root).strip(), source)\r\nAssertionError: \"def foo():\\n    'xxx'\\n    None\" != 'def foo():\\n    \"\"\"xxx\"\"\"\\n    None'\r\n  def foo():\r\n-     'xxx'\r\n+     \"\"\"xxx\"\"\"\r\n      None\r\n\r\n======================================================================\r\nFAIL: test_adjacent_strings (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 229, in test_adjacent_strings\r\n    self.assertEqual(m.view_nodes_at(2, 6), {\r\nAssertionError: Items in the first set but not the second:\r\n\"Constant:'x y z'\"\r\nItems in the second set but not the first:\r\n'Str:\\'x y z\\' \\\\\\n\\'\\'\\'a b c\\'\\'\\' \"u v w\"'\r\n\r\n======================================================================\r\nFAIL: test_conditional_expr (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 342, in test_conditional_expr\r\n    self.assertEqual(m.view_nodes_at(1, 4),\r\nAssertionError: Items in the first set but not the second:\r\n'Constant:True'\r\nItems in the second set but not the first:\r\n'NameConstant:True'\r\n\r\n======================================================================\r\nFAIL: test_decorators (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 449, in test_decorators\r\n    self.assertIn('FunctionDef:@deco1\\ndef f():\\n  pass', m.view_nodes_at(2, 0))\r\nAssertionError: 'FunctionDef:@deco1\\ndef f():\\n  pass' not found in set()\r\n\r\n======================================================================\r\nFAIL: test_deep_recursion (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 183, in test_deep_recursion\r\n    self.assertEqual(m.view_node(m.all_nodes[-1]),\r\nAssertionError: \"Constant:'F1akOFFiRIgPHTZksKBAgMCLGTdGNIAAQgKfDAcgZbj0odOnUA8GBAA7'\" != \"Str:'F1akOFFiRIgPHTZksKBAgMCLGTdGNIAAQgKfDAcgZbj0odOnUA8GBAA7'\"\r\n- Constant:'F1akOFFiRIgPHTZksKBAgMCLGTdGNIAAQgKfDAcgZbj0odOnUA8GBAA7'\r\n? ^^^^ ^^^\r\n+ Str:'F1akOFFiRIgPHTZksKBAgMCLGTdGNIAAQgKfDAcgZbj0odOnUA8GBAA7'\r\n? ^ ^\r\n\r\n\r\n======================================================================\r\nFAIL: test_del_dict (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 391, in test_del_dict\r\n    self.assertEqual(m.view_nodes_at(1, 5), {'Num:4'})\r\nAssertionError: Items in the first set but not the second:\r\n'Constant:4'\r\nItems in the second set but not the first:\r\n'Num:4'\r\n\r\n======================================================================\r\nFAIL: test_keyword_arg_only (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 431, in test_keyword_arg_only\r\n    self.assertEqual(m.view_nodes_at(1, 4), {'Num:1'})\r\nAssertionError: Items in the first set but not the second:\r\n'Constant:1'\r\nItems in the second set but not the first:\r\n'Num:1'\r\n\r\n======================================================================\r\nFAIL: test_mark_tokens_multiline (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 95, in test_mark_tokens_multiline\r\n    self.assertEqual(all_text, {\r\nAssertionError: Items in the second set but not the first:\r\n'a,      # line2\\nb +     # line3\\n  c +   # line4\\n  d'\r\n\r\n======================================================================\r\nFAIL: test_slices (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 205, in test_slices\r\n    self.assertEqual(m.view_nodes_at(1, 1),\r\nAssertionError: Items in the second set but not the first:\r\n'Tuple:foo.Area_Code, str(foo.Phone)[:3], str(foo.Phone)[3:], foo[:], bar[::, :]'\r\n\r\n======================================================================\r\nFAIL: test_walk_ast (tests.test_util.TestUtil)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_util.py\", line 43, in test_walk_ast\r\n    self.assertEqual(scan, [\r\nAssertionError: Lists differ: [\"Mod[202 chars]2', 'Constant:1', 'Constant:2', \"BinOp:'hello'[95 chars]ld'\"] != [\"Mod[202 chars]2', 'Num:1', 'Num:2', \"BinOp:'hello' + ', ' + [70 chars]ld'\"]\r\n\r\nFirst differing element 7:\r\n'Constant:1'\r\n'Num:1'\r\n\r\n  [\"Module:foo(bar(1 + 2), 'hello' + ', ' + 'world')\",\r\n   \"Expr:foo(bar(1 + 2), 'hello' + ', ' + 'world')\",\r\n   \"Call:foo(bar(1 + 2), 'hello' + ', ' + 'world')\",\r\n   'Name:foo',\r\n   'Call:bar(1 + 2)',\r\n   'Name:bar',\r\n   'BinOp:1 + 2',\r\n-  'Constant:1',\r\n-  'Constant:2',\r\n+  'Num:1',\r\n+  'Num:2',\r\n   \"BinOp:'hello' + ', ' + 'world'\",\r\n   \"BinOp:'hello' + ', '\",\r\n-  \"Constant:'hello'\",\r\n-  \"Constant:', '\",\r\n-  \"Constant:'world'\"]\r\n+  \"Str:'hello'\",\r\n+  \"Str:', '\",\r\n+  \"Str:'world'\"]\r\n\r\n----------------------------------------------------------------------\r\nRan 79 tests in 0.833s\r\n\r\nFAILED (SKIP=1, errors=20, failures=14)\r\nERROR: InvocationError for command '.../asttokens/.tox/py38/bin/nosetests' (exited with code 1)\r\n___________________________________ summary ____________________________________\r\nERROR:   py38: commands failed\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/26", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/26/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/26/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/26/events", "html_url": "https://github.com/gristlabs/asttokens/issues/26", "id": 392027519, "node_id": "MDU6SXNzdWUzOTIwMjc1MTk=", "number": 26, "title": "Debian package", "user": {"login": "aivarannamaa", "id": 1802, "node_id": "MDQ6VXNlcjE4MDI=", "avatar_url": "https://avatars0.githubusercontent.com/u/1802?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aivarannamaa", "html_url": "https://github.com/aivarannamaa", "followers_url": "https://api.github.com/users/aivarannamaa/followers", "following_url": "https://api.github.com/users/aivarannamaa/following{/other_user}", "gists_url": "https://api.github.com/users/aivarannamaa/gists{/gist_id}", "starred_url": "https://api.github.com/users/aivarannamaa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aivarannamaa/subscriptions", "organizations_url": "https://api.github.com/users/aivarannamaa/orgs", "repos_url": "https://api.github.com/users/aivarannamaa/repos", "events_url": "https://api.github.com/users/aivarannamaa/events{/privacy}", "received_events_url": "https://api.github.com/users/aivarannamaa/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-12-18T07:24:53Z", "updated_at": "2019-02-02T11:18:29Z", "closed_at": "2019-02-02T11:18:29Z", "author_association": "NONE", "active_lock_reason": null, "body": "Hi!\r\n\r\nFirst, thank you for this nice library! I wrote similar (but much more buggy) solution for my project (https://thonny.org), but now I'd like to replace my implementation with asttokens. At the same time I'd like to continue providing Debian package for my project and for this, all my dependencies should be also available in Debian repo.\r\n\r\nHave you considered publishing asttokens on Debian? If you don't have time for this, then I could prepare the package myself and try to get it accepted. With luck it may be even possible to get it into upcoming Debian 10.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/24", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/24/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/24/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/24/events", "html_url": "https://github.com/gristlabs/asttokens/issues/24", "id": 377187635, "node_id": "MDU6SXNzdWUzNzcxODc2MzU=", "number": 24, "title": "get_text returns wrong result for `(lambda: 0)()`", "user": {"login": "alexmojaki", "id": 3627481, "node_id": "MDQ6VXNlcjM2Mjc0ODE=", "avatar_url": "https://avatars0.githubusercontent.com/u/3627481?v=4", "gravatar_id": "", "url": "https://api.github.com/users/alexmojaki", "html_url": "https://github.com/alexmojaki", "followers_url": "https://api.github.com/users/alexmojaki/followers", "following_url": "https://api.github.com/users/alexmojaki/following{/other_user}", "gists_url": "https://api.github.com/users/alexmojaki/gists{/gist_id}", "starred_url": "https://api.github.com/users/alexmojaki/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/alexmojaki/subscriptions", "organizations_url": "https://api.github.com/users/alexmojaki/orgs", "repos_url": "https://api.github.com/users/alexmojaki/repos", "events_url": "https://api.github.com/users/alexmojaki/events{/privacy}", "received_events_url": "https://api.github.com/users/alexmojaki/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 5, "created_at": "2018-11-04T19:50:15Z", "updated_at": "2018-11-05T18:36:12Z", "closed_at": "2018-11-05T18:36:12Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "First of all, great library! I'm using it for [this](https://github.com/alexmojaki/birdseye) and it's worked wonders for me.\r\n\r\nConsider this script:\r\n\r\n```python\r\nimport asttokens\r\n\r\ntokens = asttokens.ASTTokens('(lambda: 0)()', parse=True)\r\ncall = tokens.tree.body[0].value\r\nprint(tokens.get_text(call))\r\n```\r\n\r\nThe expected output is `(lambda: 0)()`, but the actual output is `(lambda: 0)`.\r\n\r\nStrangely, there isn't a problem if you add an argument, e.g. `(lambda: 0)(1)`.\r\n\r\nOf course this is a ridiculous way to use lambdas and if this is the only place this problem occurs I don't think it's worth fixing. I only came across this while playing with some nonsensical code. But I thought I should point it out in case there's an underlying problem that manifests in more serious ways.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/23", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/23/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/23/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/23/events", "html_url": "https://github.com/gristlabs/asttokens/issues/23", "id": 374264614, "node_id": "MDU6SXNzdWUzNzQyNjQ2MTQ=", "number": 23, "title": "tests fail again on Fedora 30 with python 3.7.1", "user": {"login": "keszybz", "id": 349618, "node_id": "MDQ6VXNlcjM0OTYxOA==", "avatar_url": "https://avatars1.githubusercontent.com/u/349618?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keszybz", "html_url": "https://github.com/keszybz", "followers_url": "https://api.github.com/users/keszybz/followers", "following_url": "https://api.github.com/users/keszybz/following{/other_user}", "gists_url": "https://api.github.com/users/keszybz/gists{/gist_id}", "starred_url": "https://api.github.com/users/keszybz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keszybz/subscriptions", "organizations_url": "https://api.github.com/users/keszybz/orgs", "repos_url": "https://api.github.com/users/keszybz/repos", "events_url": "https://api.github.com/users/keszybz/events{/privacy}", "received_events_url": "https://api.github.com/users/keszybz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-10-26T07:43:41Z", "updated_at": "2019-05-04T16:06:21Z", "closed_at": "2019-05-04T16:06:21Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "```\r\n======================================================================\r\nFAIL: test_unicode_offsets (tests.test_asttokens.TestASTTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/builddir/build/BUILD/asttokens-1.1.10/tests/test_asttokens.py\", line 108, in test_unicode_offsets\r\n    \"ENDMARKER:''\"\r\nAssertionError: Lists differ: [\"NAM[61 chars], \"OP:','\", \"NAME:'b'\", \"OP:')'\", \"NEWLINE:''\", \"ENDMARKER:''\"] != [\"NAM[61 chars], \"OP:','\", \"NAME:'b'\", \"OP:')'\", \"ENDMARKER:''\"]\r\n\r\nFirst differing element 8:\r\n\"NEWLINE:''\"\r\n\"ENDMARKER:''\"\r\n\r\nFirst list contains 1 additional elements.\r\nFirst extra element 9:\r\n\"ENDMARKER:''\"\r\n\r\n  [\"NAME:'foo'\",\r\n   \"OP:'('\",\r\n   'STRING:\"\\'\u0444\u044b\u0432\u0430\\'\"',\r\n   \"OP:','\",\r\n   \"NAME:'a'\",\r\n   \"OP:','\",\r\n   \"NAME:'b'\",\r\n   \"OP:')'\",\r\n-  \"NEWLINE:''\",\r\n   \"ENDMARKER:''\"]\r\n\r\n----------------------------------------------------------------------\r\nRan 76 tests in 2.071s\r\n\r\nFAILED (SKIP=1, failures=1)\r\n```\r\n\r\nFrankly, I don't understand where the NEWLINE token comes from. The tests pass with python3-3.7.0-10.fc30.x86_64 and fail with python3-3.7.1-1.fc30.\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/21", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/21/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/21/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/21/events", "html_url": "https://github.com/gristlabs/asttokens/issues/21", "id": 367494193, "node_id": "MDU6SXNzdWUzNjc0OTQxOTM=", "number": 21, "title": "ASTTokens won't parse strings with coding declarations in Python 2", "user": {"login": "ssbr", "id": 356788, "node_id": "MDQ6VXNlcjM1Njc4OA==", "avatar_url": "https://avatars2.githubusercontent.com/u/356788?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ssbr", "html_url": "https://github.com/ssbr", "followers_url": "https://api.github.com/users/ssbr/followers", "following_url": "https://api.github.com/users/ssbr/following{/other_user}", "gists_url": "https://api.github.com/users/ssbr/gists{/gist_id}", "starred_url": "https://api.github.com/users/ssbr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ssbr/subscriptions", "organizations_url": "https://api.github.com/users/ssbr/orgs", "repos_url": "https://api.github.com/users/ssbr/repos", "events_url": "https://api.github.com/users/ssbr/events{/privacy}", "received_events_url": "https://api.github.com/users/ssbr/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 3, "created_at": "2018-10-06T20:43:29Z", "updated_at": "2019-10-04T18:01:12Z", "closed_at": "2019-10-04T18:01:01Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Python 2:\r\n\r\n```python\r\n>>> asttokens.ASTTokens(\"# coding: ascii\\n1\", parse=True)\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/usr/local/google/home/devinj/.local/lib/python2.7/site-packages/asttokens/asttokens.py\", line 50, in __init__\r\n    self._tree = ast.parse(source_text, filename) if parse else tree\r\n  File \"/usr/lib/python2.7/ast.py\", line 37, in parse\r\n    return compile(source, filename, mode, PyCF_ONLY_AST)\r\n  File \"<unknown>\", line 0\r\nSyntaxError: encoding declaration in Unicode string\r\n```\r\n\r\nIn Python 3 it works just fine.\r\n\r\nI expect failures if the string is not UTF-8 (e.g. if it had coding:latin1 and some invalid utf-8 in there), but I had somewhat hoped that it would also just work to pass in the raw bytes.\r\n\r\n\r\nI think the easiest workaround for end users is to parse it manually by hand:\r\n\r\n```python\r\n>>> s = \"# coding: ascii\\n1\"\r\n>>> asttokens.ASTTokens(s, tree=ast.parse(s))\r\n<asttokens.asttokens.ASTTokens object at 0x7f35d3b76550>\r\n```\r\n\r\nasttokens could also do that internally itself -- parse the tree before decoding, instead of after.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/18", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/18/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/18/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/18/events", "html_url": "https://github.com/gristlabs/asttokens/issues/18", "id": 338548844, "node_id": "MDU6SXNzdWUzMzg1NDg4NDQ=", "number": 18, "title": "Additional test failures with python 3.7", "user": {"login": "keszybz", "id": 349618, "node_id": "MDQ6VXNlcjM0OTYxOA==", "avatar_url": "https://avatars1.githubusercontent.com/u/349618?v=4", "gravatar_id": "", "url": "https://api.github.com/users/keszybz", "html_url": "https://github.com/keszybz", "followers_url": "https://api.github.com/users/keszybz/followers", "following_url": "https://api.github.com/users/keszybz/following{/other_user}", "gists_url": "https://api.github.com/users/keszybz/gists{/gist_id}", "starred_url": "https://api.github.com/users/keszybz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/keszybz/subscriptions", "organizations_url": "https://api.github.com/users/keszybz/orgs", "repos_url": "https://api.github.com/users/keszybz/repos", "events_url": "https://api.github.com/users/keszybz/events{/privacy}", "received_events_url": "https://api.github.com/users/keszybz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-07-05T12:13:18Z", "updated_at": "2018-07-08T04:02:00Z", "closed_at": "2018-07-08T04:02:00Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "New stuff that wasn't listed in #16:\r\n```\r\n======================================================================\r\nFAIL: test_adjacent_strings (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/builddir/build/BUILD/asttokens-1.1.10/tests/test_mark_tokens.py\", line 183, in test_adjacent_strings\r\n    node_name + \":'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\nAssertionError: Items in the first set but not the second:\r\n\"Const:'x y z'\"\r\nItems in the second set but not the first:\r\n\"Const:'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\n\r\n======================================================================\r\nFAIL: test_token_methods (tests.test_asttokens.TestASTTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/builddir/build/BUILD/asttokens-1.1.10/tests/test_asttokens.py\", line 46, in test_token_methods\r\n    self.assertEqual(atok.prev_token(atok.tokens[5]), atok.tokens[3])\r\nAssertionError: Token(type=56, string='\\n', start=(2, 0), end=(2, 1)[40 chars]s=22) != Token(type=4, string='\\n', start=(1, 20), end=(1, 21[61 chars]s=21)\r\n\r\n======================================================================\r\nFAIL: test_adjacent_strings (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"/builddir/build/BUILD/asttokens-1.1.10/tests/test_mark_tokens.py\", line 183, in test_adjacent_strings\r\n    node_name + \":'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\nAssertionError: Items in the first set but not the second:\r\n\"Str:'x y z'\"\r\nItems in the second set but not the first:\r\n\"Str:'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\n```\r\n\r\nThis is with\r\npython3-3.7.0-1.fc29.x86_64\r\npython3-astroid-2.0.0-0.4dev3.fc29.noarch\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/16", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/16/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/16/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/16/events", "html_url": "https://github.com/gristlabs/asttokens/issues/16", "id": 329390838, "node_id": "MDU6SXNzdWUzMjkzOTA4Mzg=", "number": 16, "title": "Tests fail with astroid 2.0.0 (needed for Python 3.7)", "user": {"login": "hroncok", "id": 2401856, "node_id": "MDQ6VXNlcjI0MDE4NTY=", "avatar_url": "https://avatars2.githubusercontent.com/u/2401856?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hroncok", "html_url": "https://github.com/hroncok", "followers_url": "https://api.github.com/users/hroncok/followers", "following_url": "https://api.github.com/users/hroncok/following{/other_user}", "gists_url": "https://api.github.com/users/hroncok/gists{/gist_id}", "starred_url": "https://api.github.com/users/hroncok/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hroncok/subscriptions", "organizations_url": "https://api.github.com/users/hroncok/orgs", "repos_url": "https://api.github.com/users/hroncok/repos", "events_url": "https://api.github.com/users/hroncok/events{/privacy}", "received_events_url": "https://api.github.com/users/hroncok/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-06-05T10:15:17Z", "updated_at": "2018-07-08T03:51:13Z", "closed_at": "2018-07-08T03:51:13Z", "author_association": "NONE", "active_lock_reason": null, "body": "Astroid 2.0.0devX is the first astroid to support Python 3.7 at all, so the only way to use asttokens on Python 3.7 is with astroid 2.0.0, but that doesn't work:\r\n\r\n```console\r\n$ tox --pre -r -e py36\r\n```\r\n\r\n```\r\nGLOB sdist-make: .../asttokens/setup.py\r\npy36 recreate: .../asttokens/.tox/py36\r\npy36 installdeps: nose, astroid, coverage\r\npy36 inst: .../asttokens/.tox/dist/asttokens-1.1.10.zip\r\npy36 installed: astroid==2.0.0.dev1,asttokens==1.1.10,coverage==4.5.1,lazy-object-proxy==1.3.1,nose==1.3.7,six==1.11.0,typed-ast==1.1.0,wrapt==1.10.11\r\npy36 runtests: PYTHONHASHSEED='3250051827'\r\npy36 runtests: commands[0] | nosetests\r\nF.E...E..E.FF..F.FEEEE...E.EE....F........E......E........EEE....E.EE.......\r\n======================================================================\r\nERROR: test_calling_lambdas (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 345, in test_calling_lambdas\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 345, in visit_call\r\n    newnode.postinit(self.visit(node.func, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 623, in visit_lambda\r\n    self.visit(node.body, newnode))\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_deep_recursion (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 160, in test_deep_recursion\r\n    m = self.create_mark_checker(source)\r\n  File \".../asttokens/tests/test_astroid.py\", line 14, in create_mark_checker\r\n    tree = builder.string_build(source)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/builder.py\", line 154, in string_build\r\n    module = self._data_build(data, modname, path)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/builder.py\", line 195, in _data_build\r\n    module = builder.visit_module(node, modname, node_file, package)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n    ...snip...\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 297, in visit_binop\r\n    node.lineno, node.col_offset, parent)\r\nRecursionError: maximum recursion depth exceeded\r\n\r\n======================================================================\r\nERROR: test_fixture10 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 146, in test_fixture10\r\n    def test_fixture10(self): self.verify_fixture_file('astroid/noendingnewline.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 581, in visit_if\r\n    newnode.postinit(self.visit(node.test, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in visit_compare\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in <listcomp>\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\nKeyError: <class '_ast.Eq'>\r\n\r\n======================================================================\r\nERROR: test_fixture7 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 143, in test_fixture7\r\n    def test_fixture7(self): self.verify_fixture_file('astroid/format.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 642, in visit_listcomp\r\n    for child in node.generators])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 642, in <listcomp>\r\n    for child in node.generators])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 400, in visit_comprehension\r\n    for child in node.ifs],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 400, in <listcomp>\r\n    for child in node.ifs],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Mod'>\r\n\r\n======================================================================\r\nERROR: test_fixture8 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 144, in test_fixture8\r\n    def test_fixture8(self): self.verify_fixture_file('astroid/module.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 919, in visit_classdef\r\n    newstyle=newstyle)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 367, in visit_classdef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 367, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 539, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in _visit_functiondef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 870, in visit_try\r\n    for child in node.body]\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 870, in <listcomp>\r\n    for child in node.body]\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 581, in visit_if\r\n    newnode.postinit(self.visit(node.test, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in visit_compare\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in <listcomp>\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\nKeyError: <class '_ast.In'>\r\n\r\n======================================================================\r\nERROR: test_fixture9 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 145, in test_fixture9\r\n    def test_fixture9(self): self.verify_fixture_file('astroid/module2.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.BitOr'>\r\n\r\n======================================================================\r\nERROR: test_fstrings (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 276, in test_fstrings\r\n    m = self.create_mark_checker(source)\r\n  File \".../asttokens/tests/test_astroid.py\", line 15, in create_mark_checker\r\n    return tools.MarkChecker(source, tree=tree)\r\n  File \".../asttokens/tests/tools.py\", line 82, in __init__\r\n    self.atok = asttokens.ASTTokens(source, parse=parse, tree=tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 62, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \".../asttokens/asttokens/asttokens.py\", line 73, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \".../asttokens/asttokens/util.py\", line 170, in visit_tree\r\n    ret = postvisit(current, par_value, value)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 90, in _visit_after_children\r\n    nfirst, nlast = self._methods.get(self, node.__class__)(node, first, last)\r\n  File \".../asttokens/asttokens/mark_tokens.py\", line 264, in visit_keyword\r\n    util.expect_token(name, token.NAME, node.arg)\r\n  File \".../asttokens/asttokens/util.py\", line 58, in expect_token\r\n    token.start[0], token.start[1] + 1))\r\nValueError: Expected token NAME:'kwarg', got STRING:\"f'{function(kwarg=24)}'\" on line 1 col 1\r\n\r\n======================================================================\r\nERROR: test_nonascii (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 256, in test_nonascii\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_print_function (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 242, in test_print_function\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 876, in visit_try\r\n    return self.visit_tryexcept(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 747, in visit_tryexcept\r\n    for child in node.handlers],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 747, in <listcomp>\r\n    for child in node.handlers],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 836, in visit_excepthandler\r\n    for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 836, in <listcomp>\r\n    for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 539, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in _visit_functiondef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 505, in visit_for\r\n    return self._visit_for(nodes.For, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 498, in _visit_for\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 498, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 282, in visit_augassign\r\n    newnode = nodes.AugAssign(self._bin_op_classes[type(node.op)] + \"=\",\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_return_annotation (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 395, in test_return_annotation\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 539, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in _visit_functiondef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 704, in visit_return\r\n    newnode.postinit(self.visit(node.value, newnode))\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_calling_lambdas (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 345, in test_calling_lambdas\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 345, in visit_call\r\n    newnode.postinit(self.visit(node.func, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 623, in visit_lambda\r\n    self.visit(node.body, newnode))\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_fixture10 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 146, in test_fixture10\r\n    def test_fixture10(self): self.verify_fixture_file('astroid/noendingnewline.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 581, in visit_if\r\n    newnode.postinit(self.visit(node.test, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in visit_compare\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in <listcomp>\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\nKeyError: <class '_ast.Eq'>\r\n\r\n======================================================================\r\nERROR: test_fixture7 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 143, in test_fixture7\r\n    def test_fixture7(self): self.verify_fixture_file('astroid/format.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 642, in visit_listcomp\r\n    for child in node.generators])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 642, in <listcomp>\r\n    for child in node.generators])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 400, in visit_comprehension\r\n    for child in node.ifs],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 400, in <listcomp>\r\n    for child in node.ifs],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Mod'>\r\n\r\n======================================================================\r\nERROR: test_fixture8 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 144, in test_fixture8\r\n    def test_fixture8(self): self.verify_fixture_file('astroid/module.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 919, in visit_classdef\r\n    newstyle=newstyle)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 367, in visit_classdef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 367, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 539, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in _visit_functiondef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 870, in visit_try\r\n    for child in node.body]\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 870, in <listcomp>\r\n    for child in node.body]\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 581, in visit_if\r\n    newnode.postinit(self.visit(node.test, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in visit_compare\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 391, in <listcomp>\r\n    for (op, expr) in zip(node.ops, node.comparators)])\r\nKeyError: <class '_ast.In'>\r\n\r\n======================================================================\r\nERROR: test_fixture9 (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 145, in test_fixture9\r\n    def test_fixture9(self): self.verify_fixture_file('astroid/module2.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.BitOr'>\r\n\r\n======================================================================\r\nERROR: test_nonascii (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 256, in test_nonascii\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 268, in visit_assign\r\n    value=self.visit(node.value, newnode),\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_print_function (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 242, in test_print_function\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 876, in visit_try\r\n    return self.visit_tryexcept(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 747, in visit_tryexcept\r\n    for child in node.handlers],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 747, in <listcomp>\r\n    for child in node.handlers],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 836, in visit_excepthandler\r\n    for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 836, in <listcomp>\r\n    for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 539, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in _visit_functiondef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 505, in visit_for\r\n    return self._visit_for(nodes.For, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 498, in _visit_for\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 498, in <listcomp>\r\n    body=[self.visit(child, newnode) for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 282, in visit_augassign\r\n    newnode = nodes.AugAssign(self._bin_op_classes[type(node.op)] + \"=\",\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nERROR: test_return_annotation (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 395, in test_return_annotation\r\n    m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\n  File \".../asttokens/tests/tools.py\", line 59, in to_source\r\n    anode = builder.visit_module(node_copy, '', '', '')\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 539, in visit_functiondef\r\n    return self._visit_functiondef(nodes.FunctionDef, node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in _visit_functiondef\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 533, in <listcomp>\r\n    for child in node.body],\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 704, in visit_return\r\n    newnode.postinit(self.visit(node.value, newnode))\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n  File \".../asttokens/.tox/py36/lib/python3.6/site-packages/astroid/rebuilder.py\", line 296, in visit_binop\r\n    newnode = nodes.BinOp(self._bin_op_classes[type(node.op)],\r\nKeyError: <class '_ast.Add'>\r\n\r\n======================================================================\r\nFAIL: test_adjacent_joined_strings (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 290, in test_adjacent_joined_strings\r\n    \"JoinedStr:f'x y z' \\\\\\nf'''a b c''' f\\\"u v w\\\"\"\r\nAssertionError: Items in the first set but not the second:\r\n'Const:f\\'x y z\\' \\\\\\nf\\'\\'\\'a b c\\'\\'\\' f\"u v w\"'\r\nItems in the second set but not the first:\r\n'JoinedStr:f\\'x y z\\' \\\\\\nf\\'\\'\\'a b c\\'\\'\\' f\"u v w\"'\r\n\r\n======================================================================\r\nFAIL: test_fixture12 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 148, in test_fixture12\r\n    def test_fixture12(self): self.verify_fixture_file('astroid/recursion.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\nAssertionError: \"' For issue #25 '\\n\\n\\nclass Base(object):\\n    pass\\n\\n\\n\" != '\"\"\" For issue #25 \"\"\"\\n\\n\\n\\nclass Base(object):\\n    pass\\n\\n\\n'\r\n- ' For issue #25 '\r\n? ^               ^\r\n+ \"\"\" For issue #25 \"\"\"\r\n? ^^^               ^^^\r\n+ \r\n  \r\n  \r\n  class Base(object):\r\n      pass\r\n  \r\n  \r\n\r\n\r\n======================================================================\r\nFAIL: test_fixture13 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 149, in test_fixture13\r\n    def test_fixture13(self): self.verify_fixture_file('astroid/suppliermodule_test.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\nAssertionError: \"' file suppliermodule.py '\\n\\n\\nclass No[229 chars]\\n\\n\" != '\"\"\" file suppliermodule.py \"\"\"\\n\\n\\n\\ncl[235 chars]\\n\\n'\r\n- ' file suppliermodule.py '\r\n? ^                        ^\r\n+ \"\"\" file suppliermodule.py \"\"\"\r\n? ^^^                        ^^^\r\n+ \r\n  \r\n  \r\n  class NotImplemented(Exception):\r\n      pass\r\n  \r\n  \r\n  \r\n  class Interface:\r\n      \r\n      def get_value(self):\r\n          raise NotImplemented()\r\n      \r\n      def set_value(self, value):\r\n          raise NotImplemented()\r\n  \r\n  \r\n  \r\n  class DoNothing:\r\n      pass\r\n  \r\n  \r\n\r\n\r\n======================================================================\r\nFAIL: test_fixture4 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 140, in test_fixture4\r\n    def test_fixture4(self): self.verify_fixture_file('astroid/clientmodule_test.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\nAssertionError: '\\' docstring for file clientmodule.py \\'\\[819 chars]\\n\\n' != '\"\"\" docstring for file clientmodule.py \"\"[827 chars]\\n\\n'\r\nDiff is 1219 characters long. Set self.maxDiff to None to see it.\r\n\r\n======================================================================\r\nFAIL: test_fixture6 (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 142, in test_fixture6\r\n    def test_fixture6(self): self.verify_fixture_file('astroid/email.py')\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 107, in verify_fixture_file\r\n    tested_nodes = m.verify_all_nodes(self)\r\n  File \".../asttokens/tests/tools.py\", line 129, in verify_all_nodes\r\n    test_case.assertEqual(to_source(rebuilt_node), to_source(node))\r\nAssertionError: '\"fake email module to test absolute import doesn\\'t grab this one\"\\n\\n' != '\"\"\"fake email module to test absolute import doesn\\'t grab this one\"\"\"\\n\\n\\n\\n'\r\n- \"fake email module to test absolute import doesn't grab this one\"\r\n+ \"\"\"fake email module to test absolute import doesn't grab this one\"\"\"\r\n? ++                                                                 ++\r\n  \r\n+ \r\n+ \r\n\r\n\r\n======================================================================\r\nFAIL: test_to_source (tests.test_asttokens.TestASTTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_asttokens.py\", line 91, in test_to_source\r\n    self.assertEqual(tools.to_source(root).strip(), source)\r\nAssertionError: \"def foo():\\n    'xxx'\\n    None\" != 'def foo():\\n    \"\"\"xxx\"\"\"\\n    None'\r\n  def foo():\r\n-     'xxx'\r\n+     \"\"\"xxx\"\"\"\r\n      None\r\n\r\n----------------------------------------------------------------------\r\nRan 76 tests in 0.917s\r\n\r\nFAILED (errors=18, failures=6)\r\nERROR: InvocationError: '.../asttokens/.tox/py36/bin/nosetests'\r\n___________________________________ summary ____________________________________\r\nERROR:   py36: commands failed\r\n```\r\n\r\n```console\r\n$ tox --pre -r -e py37\r\n```\r\n\r\n```\r\nGLOB sdist-make: .../asttokens/setup.py\r\npy37 recreate: .../asttokens/.tox/py37\r\npy37 installdeps: nose, astroid, coverage\r\npy37 inst: .../asttokens/.tox/dist/asttokens-1.1.10.zip\r\npy37 installed: astroid==2.0.0.dev1,asttokens==1.1.10,coverage==4.5.1,lazy-object-proxy==1.3.1,nose==1.3.7,six==1.11.0,wrapt==1.10.11\r\npy37 runtests: PYTHONHASHSEED='1682714241'\r\npy37 runtests: commands[0] | nosetests\r\nFF....E...........................F.....FF..................................\r\n======================================================================\r\nERROR: test_deep_recursion (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 160, in test_deep_recursion\r\n    m = self.create_mark_checker(source)\r\n  File \".../asttokens/tests/test_astroid.py\", line 14, in create_mark_checker\r\n    tree = builder.string_build(source)\r\n  File \".../asttokens/.tox/py37/lib/python3.7/site-packages/astroid/builder.py\", line 154, in string_build\r\n    module = self._data_build(data, modname, path)\r\n  File \".../asttokens/.tox/py37/lib/python3.7/site-packages/astroid/builder.py\", line 195, in _data_build\r\n    module = builder.visit_module(node, modname, node_file, package)\r\n  File \".../asttokens/.tox/py37/lib/python3.7/site-packages/astroid/rebuilder.py\", line 152, in visit_module\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py37/lib/python3.7/site-packages/astroid/rebuilder.py\", line 152, in <listcomp>\r\n    newnode.postinit([self.visit(child, newnode) for child in node.body])\r\n  File \".../asttokens/.tox/py37/lib/python3.7/site-packages/astroid/rebuilder.py\", line 164, in visit\r\n    return visit_method(node, parent)\r\n    ...snip...\r\n  File \".../asttokens/.tox/py37/lib/python3.7/site-packages/astroid/rebuilder.py\", line 297, in visit_binop\r\n    node.lineno, node.col_offset, parent)\r\nRecursionError: maximum recursion depth exceeded\r\n\r\n======================================================================\r\nFAIL: test_adjacent_joined_strings (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 293, in test_adjacent_joined_strings\r\n    \"JoinedStr:'x y z'   # comment2\\n       'a b c'   # comment3\\n       f'u v w'\"\r\nAssertionError: Items in the first set but not the second:\r\n\"JoinedStr:'x y z'\"\r\nItems in the second set but not the first:\r\n\"JoinedStr:'x y z'   # comment2\\n       'a b c'   # comment3\\n       f'u v w'\"\r\n\r\n======================================================================\r\nFAIL: test_adjacent_strings (tests.test_astroid.TestAstroid)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 225, in test_adjacent_strings\r\n    node_name + \":'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\nAssertionError: Items in the first set but not the second:\r\n\"Const:'x y z'\"\r\nItems in the second set but not the first:\r\n\"Const:'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\n\r\n======================================================================\r\nFAIL: test_token_methods (tests.test_asttokens.TestASTTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_asttokens.py\", line 46, in test_token_methods\r\n    self.assertEqual(atok.prev_token(atok.tokens[5]), atok.tokens[3])\r\nAssertionError: Token(type=56, string='\\n', start=(2, 0), end=(2, 1)[40 chars]s=22) != Token(type=4, string='\\n', start=(1, 20), end=(1, 21[61 chars]s=21)\r\n\r\n======================================================================\r\nFAIL: test_adjacent_joined_strings (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 293, in test_adjacent_joined_strings\r\n    \"JoinedStr:'x y z'   # comment2\\n       'a b c'   # comment3\\n       f'u v w'\"\r\nAssertionError: Items in the first set but not the second:\r\n\"JoinedStr:'x y z'\"\r\nItems in the second set but not the first:\r\n\"JoinedStr:'x y z'   # comment2\\n       'a b c'   # comment3\\n       f'u v w'\"\r\n\r\n======================================================================\r\nFAIL: test_adjacent_strings (tests.test_mark_tokens.TestMarkTokens)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \".../asttokens/tests/test_mark_tokens.py\", line 225, in test_adjacent_strings\r\n    node_name + \":'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\nAssertionError: Items in the first set but not the second:\r\n\"Str:'x y z'\"\r\nItems in the second set but not the first:\r\n\"Str:'x y z'   # comment2\\n       'a b c'   # comment3\\n       'u v w'\"\r\n\r\n----------------------------------------------------------------------\r\nRan 76 tests in 1.659s\r\n\r\nFAILED (errors=1, failures=5)\r\nERROR: InvocationError: '.../asttokens/.tox/py37/bin/nosetests'\r\n___________________________________ summary ____________________________________\r\nERROR:   py37: commands failed\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/10", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/10/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/10/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/10/events", "html_url": "https://github.com/gristlabs/asttokens/issues/10", "id": 285288532, "node_id": "MDU6SXNzdWUyODUyODg1MzI=", "number": 10, "title": "find_token() skips comments", "user": {"login": "abulka", "id": 11467530, "node_id": "MDQ6VXNlcjExNDY3NTMw", "avatar_url": "https://avatars3.githubusercontent.com/u/11467530?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abulka", "html_url": "https://github.com/abulka", "followers_url": "https://api.github.com/users/abulka/followers", "following_url": "https://api.github.com/users/abulka/following{/other_user}", "gists_url": "https://api.github.com/users/abulka/gists{/gist_id}", "starred_url": "https://api.github.com/users/abulka/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abulka/subscriptions", "organizations_url": "https://api.github.com/users/abulka/orgs", "repos_url": "https://api.github.com/users/abulka/repos", "events_url": "https://api.github.com/users/abulka/events{/privacy}", "received_events_url": "https://api.github.com/users/abulka/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 8, "created_at": "2018-01-01T04:45:52Z", "updated_at": "2018-01-18T21:15:55Z", "closed_at": "2018-01-16T15:38:39Z", "author_association": "NONE", "active_lock_reason": null, "body": "I'm trying to find the comment related to an AST node of the python source code I am analysing:  \r\n\r\n    x = 1  # my comment\r\n\r\nI tried\r\n\r\n    import tokenize\r\n    atok.find_token(node.last_token, tokenize.COMMENT)\r\n\r\nwhere `node` is an AST node e.g. an AST Name node for 'x'\r\n\r\nThe find never works.  Looking at the source code of asttokens, I think it is because when `find_token()` calls `next_token()` to iterate through the tokens, it never passes through True to the `include_extra` parameter of `next_token()`.\r\n\r\nAny chance of adding an `include_extra` parameter to `find_token()` and passing that through to `next_token()` ?  You seem to have that parameter everywhere else!", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/8", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/8/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/8/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/8/events", "html_url": "https://github.com/gristlabs/asttokens/issues/8", "id": 272816662, "node_id": "MDU6SXNzdWUyNzI4MTY2NjI=", "number": 8, "title": "Inability to set source filename", "user": {"login": "LiraNuna", "id": 205628, "node_id": "MDQ6VXNlcjIwNTYyOA==", "avatar_url": "https://avatars2.githubusercontent.com/u/205628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LiraNuna", "html_url": "https://github.com/LiraNuna", "followers_url": "https://api.github.com/users/LiraNuna/followers", "following_url": "https://api.github.com/users/LiraNuna/following{/other_user}", "gists_url": "https://api.github.com/users/LiraNuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/LiraNuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LiraNuna/subscriptions", "organizations_url": "https://api.github.com/users/LiraNuna/orgs", "repos_url": "https://api.github.com/users/LiraNuna/repos", "events_url": "https://api.github.com/users/LiraNuna/events{/privacy}", "received_events_url": "https://api.github.com/users/LiraNuna/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-11-10T04:29:40Z", "updated_at": "2017-11-11T02:19:13Z", "closed_at": "2017-11-11T02:19:13Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "For tooling, it is important to have the file names in order to print warnings/errors.\r\n\r\nCurrently, `asttokens.ASTTokens` does not allow to pass in the file name it's parsing.\r\n\r\nIt should be possible to do that here: https://github.com/gristlabs/asttokens/blob/master/asttokens/asttokens.py#L49", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/7", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/7/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/7/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/7/events", "html_url": "https://github.com/gristlabs/asttokens/issues/7", "id": 272806953, "node_id": "MDU6SXNzdWUyNzI4MDY5NTM=", "number": 7, "title": "Not work properly on non-ascii source code", "user": {"login": "fyrestone", "id": 6308809, "node_id": "MDQ6VXNlcjYzMDg4MDk=", "avatar_url": "https://avatars0.githubusercontent.com/u/6308809?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fyrestone", "html_url": "https://github.com/fyrestone", "followers_url": "https://api.github.com/users/fyrestone/followers", "following_url": "https://api.github.com/users/fyrestone/following{/other_user}", "gists_url": "https://api.github.com/users/fyrestone/gists{/gist_id}", "starred_url": "https://api.github.com/users/fyrestone/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fyrestone/subscriptions", "organizations_url": "https://api.github.com/users/fyrestone/orgs", "repos_url": "https://api.github.com/users/fyrestone/repos", "events_url": "https://api.github.com/users/fyrestone/events{/privacy}", "received_events_url": "https://api.github.com/users/fyrestone/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-11-10T03:14:32Z", "updated_at": "2018-01-16T06:20:10Z", "closed_at": "2018-01-16T06:20:10Z", "author_association": "NONE", "active_lock_reason": null, "body": "![image](https://user-images.githubusercontent.com/6308809/32641326-2e739f34-c608-11e7-9fb4-d90c9f98852e.png)\r\n", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/4", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/4/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/4/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/4/events", "html_url": "https://github.com/gristlabs/asttokens/issues/4", "id": 233516607, "node_id": "MDU6SXNzdWUyMzM1MTY2MDc=", "number": 4, "title": "Parser does not handle Python3.6 f-strings", "user": {"login": "LiraNuna", "id": 205628, "node_id": "MDQ6VXNlcjIwNTYyOA==", "avatar_url": "https://avatars2.githubusercontent.com/u/205628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LiraNuna", "html_url": "https://github.com/LiraNuna", "followers_url": "https://api.github.com/users/LiraNuna/followers", "following_url": "https://api.github.com/users/LiraNuna/following{/other_user}", "gists_url": "https://api.github.com/users/LiraNuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/LiraNuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LiraNuna/subscriptions", "organizations_url": "https://api.github.com/users/LiraNuna/orgs", "repos_url": "https://api.github.com/users/LiraNuna/repos", "events_url": "https://api.github.com/users/LiraNuna/events{/privacy}", "received_events_url": "https://api.github.com/users/LiraNuna/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 7, "created_at": "2017-06-05T07:39:56Z", "updated_at": "2017-06-06T08:14:19Z", "closed_at": "2017-06-06T07:10:29Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "An exception is raised when trying to parse python3.6's [new f-strings](https://docs.python.org/3/reference/lexical_analysis.html#f-strings).\r\n\r\n```\r\n  File \"ensure_trailing_commas/trailing_comma_finder.py\", line 118, in find_missing_trailing_commas\r\n    atok = asttokens.ASTTokens(source_code, parse=True)\r\n  File \"asttokens/asttokens/asttokens.py\", line 61, in __init__\r\n    self.mark_tokens(self._tree)\r\n  File \"asttokens/asttokens/asttokens.py\", line 72, in mark_tokens\r\n    MarkTokens(self).visit_tree(root_node)\r\n  File \"asttokens/asttokens/mark_tokens.py\", line 47, in visit_tree\r\n    util.visit_tree(node, self._visit_before_children, self._visit_after_children)\r\n  File \"asttokens/asttokens/util.py\", line 148, in visit_tree\r\n    pvalue, post_value = previsit(current, par_value)\r\n  File \"asttokens/asttokens/mark_tokens.py\", line 51, in _visit_before_children\r\n    token = self._code.get_token_from_utf8(node.lineno, col) if col is not None else None\r\n  File \"asttokens/asttokens/asttokens.py\", line 123, in get_token_from_utf8\r\n    return self.get_token(lineno, self._line_numbers.from_utf8_col(lineno, col_offset))\r\n  File \"asttokens/asttokens/line_numbers.py\", line 48, in from_utf8_col\r\n    return offsets[max(0, min(len(offsets), utf8_column))]\r\nIndexError: list index out of range\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/2", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/2/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/2/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/2/events", "html_url": "https://github.com/gristlabs/asttokens/issues/2", "id": 233406890, "node_id": "MDU6SXNzdWUyMzM0MDY4OTA=", "number": 2, "title": "ValueError when parsing ", "user": {"login": "LiraNuna", "id": 205628, "node_id": "MDQ6VXNlcjIwNTYyOA==", "avatar_url": "https://avatars2.githubusercontent.com/u/205628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LiraNuna", "html_url": "https://github.com/LiraNuna", "followers_url": "https://api.github.com/users/LiraNuna/followers", "following_url": "https://api.github.com/users/LiraNuna/following{/other_user}", "gists_url": "https://api.github.com/users/LiraNuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/LiraNuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LiraNuna/subscriptions", "organizations_url": "https://api.github.com/users/LiraNuna/orgs", "repos_url": "https://api.github.com/users/LiraNuna/repos", "events_url": "https://api.github.com/users/LiraNuna/events{/privacy}", "received_events_url": "https://api.github.com/users/LiraNuna/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2017-06-04T02:14:17Z", "updated_at": "2017-06-05T15:20:19Z", "closed_at": "2017-06-05T15:20:19Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "When parsing this valid code:\r\n\r\n```python\r\n[\r\n    [\r\n        1,\r\n    ] for n in ()\r\n]\r\n```\r\n\r\nA `ValueError` exception is raised:\r\n\r\n```\r\nValueError: Expected token OP:'[', got ENDMARKER:'' on line 6 col 1\r\n```\r\n\r\nI believe it's related to #1 since removing the trailing comma does not throw, however I decided to file a separate issue just in case it's not.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/gristlabs/asttokens/issues/1", "repository_url": "https://api.github.com/repos/gristlabs/asttokens", "labels_url": "https://api.github.com/repos/gristlabs/asttokens/issues/1/labels{/name}", "comments_url": "https://api.github.com/repos/gristlabs/asttokens/issues/1/comments", "events_url": "https://api.github.com/repos/gristlabs/asttokens/issues/1/events", "html_url": "https://github.com/gristlabs/asttokens/issues/1", "id": 233348541, "node_id": "MDU6SXNzdWUyMzMzNDg1NDE=", "number": 1, "title": "Wrong token range given for list with trailing comma", "user": {"login": "LiraNuna", "id": 205628, "node_id": "MDQ6VXNlcjIwNTYyOA==", "avatar_url": "https://avatars2.githubusercontent.com/u/205628?v=4", "gravatar_id": "", "url": "https://api.github.com/users/LiraNuna", "html_url": "https://github.com/LiraNuna", "followers_url": "https://api.github.com/users/LiraNuna/followers", "following_url": "https://api.github.com/users/LiraNuna/following{/other_user}", "gists_url": "https://api.github.com/users/LiraNuna/gists{/gist_id}", "starred_url": "https://api.github.com/users/LiraNuna/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/LiraNuna/subscriptions", "organizations_url": "https://api.github.com/users/LiraNuna/orgs", "repos_url": "https://api.github.com/users/LiraNuna/repos", "events_url": "https://api.github.com/users/LiraNuna/events{/privacy}", "received_events_url": "https://api.github.com/users/LiraNuna/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": {"login": "dsagal", "id": 1091143, "node_id": "MDQ6VXNlcjEwOTExNDM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1091143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dsagal", "html_url": "https://github.com/dsagal", "followers_url": "https://api.github.com/users/dsagal/followers", "following_url": "https://api.github.com/users/dsagal/following{/other_user}", "gists_url": "https://api.github.com/users/dsagal/gists{/gist_id}", "starred_url": "https://api.github.com/users/dsagal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dsagal/subscriptions", "organizations_url": "https://api.github.com/users/dsagal/orgs", "repos_url": "https://api.github.com/users/dsagal/repos", "events_url": "https://api.github.com/users/dsagal/events{/privacy}", "received_events_url": "https://api.github.com/users/dsagal/received_events", "type": "User", "site_admin": false}, "assignees": [{"login": "dsagal", "id": 1091143, "node_id": "MDQ6VXNlcjEwOTExNDM=", "avatar_url": "https://avatars0.githubusercontent.com/u/1091143?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dsagal", "html_url": "https://github.com/dsagal", "followers_url": "https://api.github.com/users/dsagal/followers", "following_url": "https://api.github.com/users/dsagal/following{/other_user}", "gists_url": "https://api.github.com/users/dsagal/gists{/gist_id}", "starred_url": "https://api.github.com/users/dsagal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dsagal/subscriptions", "organizations_url": "https://api.github.com/users/dsagal/orgs", "repos_url": "https://api.github.com/users/dsagal/repos", "events_url": "https://api.github.com/users/dsagal/events{/privacy}", "received_events_url": "https://api.github.com/users/dsagal/received_events", "type": "User", "site_admin": false}], "milestone": null, "comments": 5, "created_at": "2017-06-03T05:49:22Z", "updated_at": "2017-06-05T15:14:46Z", "closed_at": "2017-06-05T15:14:46Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "Hello,\r\n\r\nGreat library! I've been using it to implement [this pre-commit hook](https://github.com/LiraNuna/py-ensure-trailing-commas) that ensures trailing commas exist.\r\n\r\nHere is a simple repro case to illustrate an issue I'm facing:\r\n\r\n```python\r\nimport ast, asttokens\r\n\r\n\r\nclass TestcaseVisitor(ast.NodeVisitor):\r\n    def __init__(self, atok):\r\n        self.atok = atok\r\n\r\n    def visit_List(self, node):\r\n        super().generic_visit(node)\r\n\r\n        tokens = self.atok.token_range(node.first_token, node.last_token, include_extra=True)\r\n        for token in tokens:\r\n            print(token)\r\n\r\n\r\natok = asttokens.ASTTokens(\"\"\"\r\n[\r\n    1,\r\n]\r\n\"\"\", parse=True)\r\nvisitor = TestcaseVisitor(atok)\r\nvisitor.visit(atok.tree)\r\n```\r\n\r\nThis will output \r\n\r\n```\r\nOP:'['\r\nNL:'\\n'\r\nNUMBER:'1'\r\n```\r\n\r\nWhere the expected result should be\r\n\r\n```\r\nOP:'['\r\nNL:'\\n'\r\nNUMBER:'1'\r\nOP:','\r\nNL:'\\n'\r\nOP:']'\r\n```\r\n\r\nPlease note that removing the trailing comma will not reproduce the bug. \r\nThis issue is not limited to a single param - as long as there's a trailing comma. The following will produce similar a issue:\r\n\r\n```python\r\n[\r\n    1,\r\n    2,\r\n]\r\n```\r\n\r\n```python\r\n[\r\n    1,\r\n    2,\r\n    3,\r\n]\r\n```\r\nand so on", "performed_via_github_app": null, "score": 1.0}]}