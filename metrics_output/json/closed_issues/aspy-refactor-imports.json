{"total_count": 5, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/52", "repository_url": "https://api.github.com/repos/asottile/aspy.refactor_imports", "labels_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/52/labels{/name}", "comments_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/52/comments", "events_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/52/events", "html_url": "https://github.com/asottile/aspy.refactor_imports/issues/52", "id": 611432575, "node_id": "MDU6SXNzdWU2MTE0MzI1NzU=", "number": 52, "title": "Application classified as builtin on Windows, due to case-sensitive path comparison", "user": {"login": "cjolowicz", "id": 653941, "node_id": "MDQ6VXNlcjY1Mzk0MQ==", "avatar_url": "https://avatars1.githubusercontent.com/u/653941?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cjolowicz", "html_url": "https://github.com/cjolowicz", "followers_url": "https://api.github.com/users/cjolowicz/followers", "following_url": "https://api.github.com/users/cjolowicz/following{/other_user}", "gists_url": "https://api.github.com/users/cjolowicz/gists{/gist_id}", "starred_url": "https://api.github.com/users/cjolowicz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cjolowicz/subscriptions", "organizations_url": "https://api.github.com/users/cjolowicz/orgs", "repos_url": "https://api.github.com/users/cjolowicz/repos", "events_url": "https://api.github.com/users/cjolowicz/events{/privacy}", "received_events_url": "https://api.github.com/users/cjolowicz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2020-05-03T15:00:21Z", "updated_at": "2020-05-04T18:19:05Z", "closed_at": "2020-05-04T18:19:05Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "On Windows, under certain circumstances, an application can be misclassified as a builtin, due to case-sensitive path comparison on a case-insensitive filesystem.\r\n\r\nThe function `_module_path_is_local_and_is_not_symlinked` in the module `aspy.refactor_imports.classify` uses `str.startswith` to check if the module path is located within an application directory. On a case-insensitive filesystem, this may produce a false negative if the representation of the paths differs in case.\r\n\r\nhttps://github.com/asottile/aspy.refactor_imports/blob/03c1f5a635592c877e557472e8f75a4dc243ae25/aspy/refactor_imports/classify.py#L42\r\n\r\nThe same function compares the absolute path of the module to its real path to check for the absence of symlinks, using string equality. This check will also produce a false negative if the paths differ in case.\r\n\r\nhttps://github.com/asottile/aspy.refactor_imports/blob/03c1f5a635592c877e557472e8f75a4dc243ae25/aspy/refactor_imports/classify.py#L47\r\n\r\nAs a consequence of this bug, `reorder-python-imports` can sort imports differently on Windows than on other platforms, moving an application import to the top of the imports.\r\n\r\n**Reproduction**\r\n\r\nI create a repository to reproduce the issue [here](https://github.com/cjolowicz/reorder-python-imports-issue). You can see the outcomes for different operating systems in the GitHub Actions run [here](https://github.com/cjolowicz/reorder-python-imports-issue/actions/runs/94519329). The job marked `windows-latest - requirements.txt` uses the latest release of aspy.refactor_imports, the job marked `windows-latest - requirements-fix.txt` uses a patched version, see the associated PR #53 for this issue.\r\n\r\nI was able to reproduce the behavior on the following platforms:\r\n\r\n- Windows Server 2019 / Python 3.8.2 (GitHub Actions runner)\r\n- Windows Server 2016 / Python 3.7.3 (local VM)\r\n\r\nHere's how to reproduce the issue from scratch:\r\n\r\n- Create a Python package using `src` layout.\r\n- Create a test module with imports for pytest and the package.\r\n- Create virtualenv using `python -m venv venv` inside the package\r\n- Install the package into the venv using `pip install -e .`\r\n- Invoke `reorder-python-imports` on the test module.\r\n- The imports are reordered, placing the package _before_ pytest.\r\n\r\nSome further details:\r\n\r\nThe `_get_module_info` helper uses `importlib.util.find_spec` to determine the module path. The representation of this path is determined by the matching entry in `sys.path`, which is lower-case in the repro example.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/46", "repository_url": "https://api.github.com/repos/asottile/aspy.refactor_imports", "labels_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/46/labels{/name}", "comments_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/46/comments", "events_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/46/events", "html_url": "https://github.com/asottile/aspy.refactor_imports/issues/46", "id": 570651637, "node_id": "MDU6SXNzdWU1NzA2NTE2Mzc=", "number": 46, "title": "aspy.refactor_imports.classify - _get_module_info fails for zipped third party libraries", "user": {"login": "shea-parkes", "id": 5782892, "node_id": "MDQ6VXNlcjU3ODI4OTI=", "avatar_url": "https://avatars2.githubusercontent.com/u/5782892?v=4", "gravatar_id": "", "url": "https://api.github.com/users/shea-parkes", "html_url": "https://github.com/shea-parkes", "followers_url": "https://api.github.com/users/shea-parkes/followers", "following_url": "https://api.github.com/users/shea-parkes/following{/other_user}", "gists_url": "https://api.github.com/users/shea-parkes/gists{/gist_id}", "starred_url": "https://api.github.com/users/shea-parkes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/shea-parkes/subscriptions", "organizations_url": "https://api.github.com/users/shea-parkes/orgs", "repos_url": "https://api.github.com/users/shea-parkes/repos", "events_url": "https://api.github.com/users/shea-parkes/events{/privacy}", "received_events_url": "https://api.github.com/users/shea-parkes/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2020-02-25T15:29:02Z", "updated_at": "2020-02-27T19:25:32Z", "closed_at": "2020-02-27T19:25:32Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "There is a special case logic gate in classify.py:\r\n\r\n```\r\n# special case pypy3 bug(?)\r\nelif not os.path.exists(spec.origin):\r\n    return True, '(builtin)', True\r\n```\r\n\r\nIf you are using a zipped third-party package, then this will falsely identify it as part of the standard library.\r\n\r\nHere's a code snippet showing the value of `spec.origin` in such a case:\r\n```\r\nPython 3.7.5 (default, Oct 31 2019, 15:18:51) [MSC v.1916 64 bit (AMD64)]\r\nType 'copyright', 'credits' or 'license' for more information\r\nIPython 7.9.0 -- An enhanced Interactive Python. Type '?' for help.\r\n\r\nIn [1]: import importlib.util\r\n\r\nIn [2]: spec = importlib.util.find_spec('py4j')\r\n\r\nIn [3]: spec\r\nOut[3]: ModuleSpec(name='py4j', loader=<zipimporter object \"C:\\DevApps\\spark\\spark-2.4.4-bin\\python\\lib\\py4j-0.10.7-src.zip\">, origin='C:\\\\DevApps\\\\spark\\\\spark-2.4.4-bin\\\\python\\\\lib\\\\py4j-0.10.7-src.zip\\\\py4j\\\\__init__.py', submodule_search_locations=['C:\\\\DevApps\\\\spark\\\\spark-2.4.4-bin\\\\python\\\\lib\\\\py4j-0.10.7-src.zip\\\\py4j'])\r\n\r\nIn [4]: spec.origin\r\nOut[4]: 'C:\\\\DevApps\\\\spark\\\\spark-2.4.4-bin\\\\python\\\\lib\\\\py4j-0.10.7-src.zip\\\\py4j\\\\__init__.py'\r\n```\r\n\r\nThat `spec.origin` doesn't exist on the filesystem, so `os.path.exists(spec.origin)` is `False`.\r\n\r\nI realize we're using `%PythonPath%` which isn't really supported, but I do believe this would also be an issue in other scenarios.  (Sourcing `py4j` from a zip included with a Spark distribution is actually a fairly common example I believe.)\r\n\r\nWould it be reasonable to get another logic gate in there to identify the zipped library scenario?  I'd be happy to try and make the addition if you like.\r\n\r\nThanks for the great tool.  We're fine with mixing our third-party and first-party imports due to using `%PythonPath%`.  We really appreciate the `black` compatibility (and the focus on clean diffs).", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/28", "repository_url": "https://api.github.com/repos/asottile/aspy.refactor_imports", "labels_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/28/labels{/name}", "comments_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/28/comments", "events_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/28/events", "html_url": "https://github.com/asottile/aspy.refactor_imports/issues/28", "id": 374021347, "node_id": "MDU6SXNzdWUzNzQwMjEzNDc=", "number": 28, "title": "py3, windows, classify_import('ConfigParser') => erroneously \"BUILTIN\"", "user": {"login": "asottile", "id": 1810591, "node_id": "MDQ6VXNlcjE4MTA1OTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1810591?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asottile", "html_url": "https://github.com/asottile", "followers_url": "https://api.github.com/users/asottile/followers", "following_url": "https://api.github.com/users/asottile/following{/other_user}", "gists_url": "https://api.github.com/users/asottile/gists{/gist_id}", "starred_url": "https://api.github.com/users/asottile/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asottile/subscriptions", "organizations_url": "https://api.github.com/users/asottile/orgs", "repos_url": "https://api.github.com/users/asottile/repos", "events_url": "https://api.github.com/users/asottile/events{/privacy}", "received_events_url": "https://api.github.com/users/asottile/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 110148728, "node_id": "MDU6TGFiZWwxMTAxNDg3Mjg=", "url": "https://api.github.com/repos/asottile/aspy.refactor_imports/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 1, "created_at": "2018-10-25T16:03:32Z", "updated_at": "2019-01-28T17:05:21Z", "closed_at": "2019-01-28T17:05:20Z", "author_association": "OWNER", "active_lock_reason": null, "body": "something something case insensitive filesystem something", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/17", "repository_url": "https://api.github.com/repos/asottile/aspy.refactor_imports", "labels_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/17/labels{/name}", "comments_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/17/comments", "events_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/17/events", "html_url": "https://github.com/asottile/aspy.refactor_imports/issues/17", "id": 236141155, "node_id": "MDU6SXNzdWUyMzYxNDExNTU=", "number": 17, "title": "Relative import sorted incorrect.", "user": {"login": "coldnight", "id": 2527265, "node_id": "MDQ6VXNlcjI1MjcyNjU=", "avatar_url": "https://avatars1.githubusercontent.com/u/2527265?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coldnight", "html_url": "https://github.com/coldnight", "followers_url": "https://api.github.com/users/coldnight/followers", "following_url": "https://api.github.com/users/coldnight/following{/other_user}", "gists_url": "https://api.github.com/users/coldnight/gists{/gist_id}", "starred_url": "https://api.github.com/users/coldnight/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coldnight/subscriptions", "organizations_url": "https://api.github.com/users/coldnight/orgs", "repos_url": "https://api.github.com/users/coldnight/repos", "events_url": "https://api.github.com/users/coldnight/events{/privacy}", "received_events_url": "https://api.github.com/users/coldnight/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 110148733, "node_id": "MDU6TGFiZWwxMTAxNDg3MzM=", "url": "https://api.github.com/repos/asottile/aspy.refactor_imports/labels/question", "name": "question", "color": "cc317c", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2017-06-15T10:11:54Z", "updated_at": "2017-06-20T13:27:11Z", "closed_at": "2017-06-20T13:27:11Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "I am using [this](https://github.com/coldnight/reorder_python_imports), and I noticed the relative import sorted incorrect. Here is the code\r\n\r\n```python\r\nimport pprint\r\nfrom aspy.refactor_imports.import_obj import FromImport\r\n\r\nobjs = sorted([\r\n    FromImport.from_str('from a import foo'),\r\n    FromImport.from_str('from a.b import baz'),\r\n    FromImport.from_str('from a import bar'),\r\n    FromImport.from_str('from a import bar as buz'),\r\n    FromImport.from_str('from a import bar as baz'),\r\n    FromImport.from_str('from .a import bar as baz'),\r\n    FromImport.from_str('from . import bar as baz'),\r\n    FromImport.from_str('from .aa.bb import bar as baz'),\r\n])\r\npprint.pprint([i.to_text() for i in objs])\r\n```\r\n\r\nExcepted: \r\n\r\n```text\r\n[u'from a import bar\\n',\r\n u'from a import bar as baz\\n',\r\n u'from a import bar as buz\\n',\r\n u'from a import foo\\n',\r\n u'from a.b import baz\\n',\r\n u'from .aa.bb import bar as baz\\n',\r\n u'from .a import bar as baz\\n',\r\n u'from . import bar as baz\\n',\r\n]\r\n```\r\n\r\nGot: \r\n\r\n```text\r\n[u'from . import bar as baz\\n',\r\n u'from .a import bar as baz\\n',\r\n u'from .aa.bb import bar as baz\\n',\r\n u'from a import bar\\n',\r\n u'from a import bar as baz\\n',\r\n u'from a import bar as buz\\n',\r\n u'from a import foo\\n',\r\n u'from a.b import baz\\n']\r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/13", "repository_url": "https://api.github.com/repos/asottile/aspy.refactor_imports", "labels_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/13/labels{/name}", "comments_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/13/comments", "events_url": "https://api.github.com/repos/asottile/aspy.refactor_imports/issues/13/events", "html_url": "https://github.com/asottile/aspy.refactor_imports/issues/13", "id": 210264295, "node_id": "MDU6SXNzdWUyMTAyNjQyOTU=", "number": 13, "title": "Modules as a result of PYTHONPATH are reported as BUILTIN", "user": {"login": "asottile", "id": 1810591, "node_id": "MDQ6VXNlcjE4MTA1OTE=", "avatar_url": "https://avatars3.githubusercontent.com/u/1810591?v=4", "gravatar_id": "", "url": "https://api.github.com/users/asottile", "html_url": "https://github.com/asottile", "followers_url": "https://api.github.com/users/asottile/followers", "following_url": "https://api.github.com/users/asottile/following{/other_user}", "gists_url": "https://api.github.com/users/asottile/gists{/gist_id}", "starred_url": "https://api.github.com/users/asottile/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/asottile/subscriptions", "organizations_url": "https://api.github.com/users/asottile/orgs", "repos_url": "https://api.github.com/users/asottile/repos", "events_url": "https://api.github.com/users/asottile/events{/privacy}", "received_events_url": "https://api.github.com/users/asottile/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 110148728, "node_id": "MDU6TGFiZWwxMTAxNDg3Mjg=", "url": "https://api.github.com/repos/asottile/aspy.refactor_imports/labels/bug", "name": "bug", "color": "fc2929", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2017-02-25T21:44:28Z", "updated_at": "2017-02-25T23:05:04Z", "closed_at": "2017-02-25T23:05:04Z", "author_association": "OWNER", "active_lock_reason": null, "body": "Noticed this here: https://github.com/Yelp/beans/commit/b4eabf05f7296a52242d30eb8a6ced8f67d4c054", "performed_via_github_app": null, "score": 1.0}]}