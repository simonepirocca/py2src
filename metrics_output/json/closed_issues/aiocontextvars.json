{"total_count": 6, "incomplete_results": false, "items": [{"url": "https://api.github.com/repos/fantix/aiocontextvars/issues/143", "repository_url": "https://api.github.com/repos/fantix/aiocontextvars", "labels_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/143/labels{/name}", "comments_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/143/comments", "events_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/143/events", "html_url": "https://github.com/fantix/aiocontextvars/issues/143", "id": 551485222, "node_id": "MDU6SXNzdWU1NTE0ODUyMjI=", "number": 143, "title": "aiocontextvars ContextVar value not kept independently for the different async functions that set it", "user": {"login": "ocelotl", "id": 5069942, "node_id": "MDQ6VXNlcjUwNjk5NDI=", "avatar_url": "https://avatars1.githubusercontent.com/u/5069942?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ocelotl", "html_url": "https://github.com/ocelotl", "followers_url": "https://api.github.com/users/ocelotl/followers", "following_url": "https://api.github.com/users/ocelotl/following{/other_user}", "gists_url": "https://api.github.com/users/ocelotl/gists{/gist_id}", "starred_url": "https://api.github.com/users/ocelotl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ocelotl/subscriptions", "organizations_url": "https://api.github.com/users/ocelotl/orgs", "repos_url": "https://api.github.com/users/ocelotl/repos", "events_url": "https://api.github.com/users/ocelotl/events{/privacy}", "received_events_url": "https://api.github.com/users/ocelotl/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2020-01-17T15:39:25Z", "updated_at": "2020-01-17T17:29:00Z", "closed_at": "2020-01-17T17:29:00Z", "author_association": "NONE", "active_lock_reason": null, "body": "* aiocontextvars version: 0.2.2\r\n* Python version: 3.5.0\r\n* Operating System: Ubuntu 18.04.3\r\n\r\n### Description\r\n\r\nMismatching results when running an `asyncio` script with Python 3.5.0 and aiocontextvars vs. Python 3.7.5rc1 and native contextvars package.\r\n\r\n### What I Did\r\n\r\nI created a virtual environment with Python 3.5.0 and installed aiocontextvars via `pip3`. I activated the virtual environment and ran the script below. I ran the same script with Python 3.7.5rc1 and got different results. The results that I got from running with Python 3.7.5rc1 are the ones I expected. When I run the script with aiocontextvars it seems like the `ContextVar` value is not kept independently for the different `async` functions that set its value.\r\n\r\n```\r\n(3-5-0) ocelotl@harrison:~$ cat async_contextvar.py \r\nfrom asyncio import sleep, gather, get_event_loop\r\nfrom contextvars import ContextVar\r\n\r\nlocal_name = ContextVar(\"async_name\")\r\n\r\n\r\nasync def waiting(async_name, first_sleep, second_sleep):\r\n\r\n    await sleep(first_sleep)\r\n\r\n    local_name.set(async_name)\r\n\r\n    print(\"async_name:\\t{}\".format(async_name))\r\n    print(\"local_name:\\t{}\".format(local_name.get()))\r\n    print()\r\n\r\n    await sleep(second_sleep)\r\n\r\n    print(\"async_name:\\t{}\".format(async_name))\r\n    print(\"local_name:\\t{}\".format(local_name.get()))\r\n    print()\r\n\r\n\r\nasync def main():\r\n    await gather(waiting(\"A\", 0, 1), waiting(\"B\", 0.1, 3), waiting(\"C\", 2, 1))\r\n\r\nloop = get_event_loop()\r\nloop.run_until_complete(main())\r\nloop.close()\r\n```\r\n```\r\n(3-5-0) ocelotl@harrison:~$ lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 18.04.3 LTS\r\nRelease:        18.04\r\nCodename:       bionic\r\n(3-5-0) ocelotl@harrison:~$ python3 --version\r\nPython 3.5.0\r\n(3-5-0) ocelotl@harrison:~$ pip3 freeze\r\naiocontextvars==0.2.2\r\ncontextvars==2.4\r\nimmutables==0.11\r\nYou are using pip version 7.1.2, however version 19.3.1 is available.\r\nYou should consider upgrading via the 'pip install --upgrade pip' command.\r\n(3-5-0) ocelotl@harrison:~$ python3 async_contextvar.py \r\nasync_name:     A\r\nlocal_name:     A\r\n\r\nasync_name:     B\r\nlocal_name:     B\r\n\r\nasync_name:     A\r\nlocal_name:     B\r\n\r\nasync_name:     C\r\nlocal_name:     C\r\n\r\nasync_name:     C\r\nlocal_name:     C\r\n\r\nasync_name:     B\r\nlocal_name:     C\r\n\r\n(3-5-0) ocelotl@harrison:~$ \r\n```\r\n```\r\nocelotl@harrison:~$ lsb_release -a\r\nNo LSB modules are available.\r\nDistributor ID: Ubuntu\r\nDescription:    Ubuntu 18.04.3 LTS\r\nRelease:        18.04\r\nCodename:       bionic\r\nocelotl@harrison:~$ python3 --version\r\nPython 3.7.5rc1\r\nocelotl@harrison:~$ python3 async_contextvar.py \r\nasync_name:     A\r\nlocal_name:     A\r\n\r\nasync_name:     B\r\nlocal_name:     B\r\n\r\nasync_name:     A\r\nlocal_name:     A\r\n\r\nasync_name:     C\r\nlocal_name:     C\r\n\r\nasync_name:     C\r\nlocal_name:     C\r\n\r\nasync_name:     B\r\nlocal_name:     B\r\n\r\nocelotl@harrison:~$ \r\n```", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/fantix/aiocontextvars/issues/72", "repository_url": "https://api.github.com/repos/fantix/aiocontextvars", "labels_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/72/labels{/name}", "comments_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/72/comments", "events_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/72/events", "html_url": "https://github.com/fantix/aiocontextvars/issues/72", "id": 427835242, "node_id": "MDU6SXNzdWU0Mjc4MzUyNDI=", "number": 72, "title": "Update contextvars to version 2.4", "user": {"login": "decaz", "id": 31096, "node_id": "MDQ6VXNlcjMxMDk2", "avatar_url": "https://avatars1.githubusercontent.com/u/31096?v=4", "gravatar_id": "", "url": "https://api.github.com/users/decaz", "html_url": "https://github.com/decaz", "followers_url": "https://api.github.com/users/decaz/followers", "following_url": "https://api.github.com/users/decaz/following{/other_user}", "gists_url": "https://api.github.com/users/decaz/gists{/gist_id}", "starred_url": "https://api.github.com/users/decaz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/decaz/subscriptions", "organizations_url": "https://api.github.com/users/decaz/orgs", "repos_url": "https://api.github.com/users/decaz/repos", "events_url": "https://api.github.com/users/decaz/events{/privacy}", "received_events_url": "https://api.github.com/users/decaz/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2019-04-01T17:54:53Z", "updated_at": "2019-04-03T18:01:38Z", "closed_at": "2019-04-03T18:01:38Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "`contextvars==2.4` was released.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/fantix/aiocontextvars/issues/14", "repository_url": "https://api.github.com/repos/fantix/aiocontextvars", "labels_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/14/labels{/name}", "comments_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/14/comments", "events_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/14/events", "html_url": "https://github.com/fantix/aiocontextvars/issues/14", "id": 358872872, "node_id": "MDU6SXNzdWUzNTg4NzI4NzI=", "number": 14, "title": "Is uvloop compatible with this library?", "user": {"login": "iomintz", "id": 538336, "node_id": "MDQ6VXNlcjUzODMzNg==", "avatar_url": "https://avatars0.githubusercontent.com/u/538336?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iomintz", "html_url": "https://github.com/iomintz", "followers_url": "https://api.github.com/users/iomintz/followers", "following_url": "https://api.github.com/users/iomintz/following{/other_user}", "gists_url": "https://api.github.com/users/iomintz/gists{/gist_id}", "starred_url": "https://api.github.com/users/iomintz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iomintz/subscriptions", "organizations_url": "https://api.github.com/users/iomintz/orgs", "repos_url": "https://api.github.com/users/iomintz/repos", "events_url": "https://api.github.com/users/iomintz/events{/privacy}", "received_events_url": "https://api.github.com/users/iomintz/received_events", "type": "User", "site_admin": false}, "labels": [{"id": 726513522, "node_id": "MDU6TGFiZWw3MjY1MTM1MjI=", "url": "https://api.github.com/repos/fantix/aiocontextvars/labels/question", "name": "question", "color": "cc317c", "default": true, "description": null}], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 2, "created_at": "2018-09-11T03:27:57Z", "updated_at": "2018-09-11T03:32:54Z", "closed_at": "2018-09-11T03:32:54Z", "author_association": "NONE", "active_lock_reason": null, "body": "\"Because above hack is done by replacing asyncio.get_event_loop and loop.create_task, therefore tasks and loops created by custom/private API won't behave correctly as expected, e.g. uvloop.new_event_loop() or asyncio.Task(). Also, event loops created before importing aiocontextvars are not patched either. So over all, you should import aiocontextvars at the beginning before creating event loops, and always use asyncio.* to operate loops/policies, and public asyncio API to create tasks.\"\r\n\r\nDoes this mean I can't use uvloop at all, or just don't use the uvloop.new_event_loop()?", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/fantix/aiocontextvars/issues/10", "repository_url": "https://api.github.com/repos/fantix/aiocontextvars", "labels_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/10/labels{/name}", "comments_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/10/comments", "events_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/10/events", "html_url": "https://github.com/fantix/aiocontextvars/issues/10", "id": 358325259, "node_id": "MDU6SXNzdWUzNTgzMjUyNTk=", "number": 10, "title": "Patching process throws error when setting event loop to None", "user": {"login": "jjjacksn", "id": 1919264, "node_id": "MDQ6VXNlcjE5MTkyNjQ=", "avatar_url": "https://avatars1.githubusercontent.com/u/1919264?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jjjacksn", "html_url": "https://github.com/jjjacksn", "followers_url": "https://api.github.com/users/jjjacksn/followers", "following_url": "https://api.github.com/users/jjjacksn/following{/other_user}", "gists_url": "https://api.github.com/users/jjjacksn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jjjacksn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jjjacksn/subscriptions", "organizations_url": "https://api.github.com/users/jjjacksn/orgs", "repos_url": "https://api.github.com/users/jjjacksn/repos", "events_url": "https://api.github.com/users/jjjacksn/events{/privacy}", "received_events_url": "https://api.github.com/users/jjjacksn/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 0, "created_at": "2018-09-08T20:23:02Z", "updated_at": "2018-09-09T03:33:52Z", "closed_at": "2018-09-09T03:33:52Z", "author_association": "CONTRIBUTOR", "active_lock_reason": null, "body": "* aiocontextvars version: 0.2.0 (master @ b36af92f5c716af79ba217b2ea93130cdb8f406f) \r\n* Python version: 3.6.6\r\n* Operating System: macOS High Sierra (10.13.6)\r\n\r\n### Description\r\n\r\nThe patching process introduced by `aiocontextvars` is not correctly handling setting the event loop to None and raises an AttributeError. I discovered this while adding aiocontextvars to my project which also uses `aiohttp` and their test utilities. aiohttp's test utils set the event loop to None as part of test teardown (see [here](https://github.com/aio-libs/aiohttp/blob/master/aiohttp/test_utils.py#L447)).\r\n\r\n### What I Did\r\n\r\nMinimally reproducing code: \r\n```\r\n>>> import asyncio\r\n>>> import aiocontextvars\r\n>>> asyncio.set_event_loop(None)\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/jdot/code/vendor/aiocontextvars/aiocontextvars/__init__.py\", line 67, in set_event_loop\r\n    return _set_event_loop(_patch_loop(loop))\r\n  File \"/Users/jdot/code/vendor/aiocontextvars/aiocontextvars/__init__.py\", line 57, in _patch_loop\r\n    loop._orig_create_task = loop.create_task\r\nAttributeError: 'NoneType' object has no attribute 'create_task'\r\n```\r\n\r\nI believe this can be fixed with a one line change.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/fantix/aiocontextvars/issues/2", "repository_url": "https://api.github.com/repos/fantix/aiocontextvars", "labels_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/2/labels{/name}", "comments_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/2/comments", "events_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/2/events", "html_url": "https://github.com/fantix/aiocontextvars/issues/2", "id": 302078140, "node_id": "MDU6SXNzdWUzMDIwNzgxNDA=", "number": 2, "title": "Make it compatible with PEP-567", "user": {"login": "fantix", "id": 1751601, "node_id": "MDQ6VXNlcjE3NTE2MDE=", "avatar_url": "https://avatars1.githubusercontent.com/u/1751601?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fantix", "html_url": "https://github.com/fantix", "followers_url": "https://api.github.com/users/fantix/followers", "following_url": "https://api.github.com/users/fantix/following{/other_user}", "gists_url": "https://api.github.com/users/fantix/gists{/gist_id}", "starred_url": "https://api.github.com/users/fantix/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fantix/subscriptions", "organizations_url": "https://api.github.com/users/fantix/orgs", "repos_url": "https://api.github.com/users/fantix/repos", "events_url": "https://api.github.com/users/fantix/events{/privacy}", "received_events_url": "https://api.github.com/users/fantix/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 6, "created_at": "2018-03-04T11:31:52Z", "updated_at": "2018-10-24T06:22:19Z", "closed_at": "2018-10-24T06:22:19Z", "author_association": "OWNER", "active_lock_reason": null, "body": "[PEP-567](https://www.python.org/dev/peps/pep-0567/) is accepted for Python 3.7. ~We should make this library compatible.~ [contextvars](https://github.com/MagicStack/contextvars/issues/2) should replace this library.", "performed_via_github_app": null, "score": 1.0}, {"url": "https://api.github.com/repos/fantix/aiocontextvars/issues/1", "repository_url": "https://api.github.com/repos/fantix/aiocontextvars", "labels_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/1/labels{/name}", "comments_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/1/comments", "events_url": "https://api.github.com/repos/fantix/aiocontextvars/issues/1/events", "html_url": "https://github.com/fantix/aiocontextvars/issues/1", "id": 275163402, "node_id": "MDU6SXNzdWUyNzUxNjM0MDI=", "number": 1, "title": "Minimal Documentation", "user": {"login": "s0undt3ch", "id": 300048, "node_id": "MDQ6VXNlcjMwMDA0OA==", "avatar_url": "https://avatars3.githubusercontent.com/u/300048?v=4", "gravatar_id": "", "url": "https://api.github.com/users/s0undt3ch", "html_url": "https://github.com/s0undt3ch", "followers_url": "https://api.github.com/users/s0undt3ch/followers", "following_url": "https://api.github.com/users/s0undt3ch/following{/other_user}", "gists_url": "https://api.github.com/users/s0undt3ch/gists{/gist_id}", "starred_url": "https://api.github.com/users/s0undt3ch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/s0undt3ch/subscriptions", "organizations_url": "https://api.github.com/users/s0undt3ch/orgs", "repos_url": "https://api.github.com/users/s0undt3ch/repos", "events_url": "https://api.github.com/users/s0undt3ch/events{/privacy}", "received_events_url": "https://api.github.com/users/s0undt3ch/received_events", "type": "User", "site_admin": false}, "labels": [], "state": "closed", "locked": false, "assignee": null, "assignees": [], "milestone": null, "comments": 4, "created_at": "2017-11-19T14:33:39Z", "updated_at": "2017-12-03T09:52:30Z", "closed_at": "2017-12-03T08:34:17Z", "author_association": "NONE", "active_lock_reason": null, "body": "It would be useful to at least have some minimal usage examples in the read me file. Of course, documentation would even be better.", "performed_via_github_app": null, "score": 1.0}]}